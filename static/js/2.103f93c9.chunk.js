(window.webpackJsonp=window.webpackJsonp||[]).push([[2],[function(e,t,n){"use strict";var r=n(32),i=n.n(r);function o(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(u){return void n(u)}s.done?t(l):Promise.resolve(l).then(r,i)}var a,s=n(9),l=n(8),u=n(5),c=n(1),h=n(13),d=n(6),f=n(2),p=n(4);n.d(t,"a",function(){return M}),n.d(t,"b",function(){return _c}),n.d(t,"c",function(){return Su}),n.d(t,"d",function(){return T}),n.d(t,"e",function(){return zs}),n.d(t,"f",function(){return An}),n.d(t,"g",function(){return Bi}),n.d(t,"h",function(){return Qr}),n.d(t,"i",function(){return _i}),n.d(t,"j",function(){return _l}),n.d(t,"k",function(){return _e}),n.d(t,"l",function(){return Uc}),n.d(t,"m",function(){return jr}),n.d(t,"n",function(){return ce}),n.d(t,"o",function(){return Fu}),n.d(t,"p",function(){return gc}),n.d(t,"q",function(){return bl}),n.d(t,"r",function(){return S}),n.d(t,"s",function(){return sn}),n.d(t,"t",function(){return Ou}),n.d(t,"u",function(){return ds}),n.d(t,"v",function(){return x}),n.d(t,"w",function(){return as}),n.d(t,"x",function(){return Pc}),n.d(t,"y",function(){return ps}),n.d(t,"z",function(){return _s}),n.d(t,"A",function(){return du}),n.d(t,"B",function(){return Bt}),n.d(t,"C",function(){return Ut}),n.d(t,"D",function(){return rl}),n.d(t,"E",function(){return Zs}),n.d(t,"F",function(){return sl}),n.d(t,"G",function(){return al}),n.d(t,"H",function(){return xe}),n.d(t,"I",function(){return Se}),n.d(t,"J",function(){return Te}),n.d(t,"K",function(){return Cu}),n.d(t,"L",function(){return xc}),n.d(t,"M",function(){return m}),n.d(t,"N",function(){return Xr}),n.d(t,"O",function(){return dn}),n.d(t,"P",function(){return Qn}),n.d(t,"Q",function(){return Fi}),n.d(t,"R",function(){return Yr}),n.d(t,"S",function(){return iu}),n.d(t,"T",function(){return ru}),n.d(t,"U",function(){return nu}),n.d(t,"V",function(){return ve}),n.d(t,"W",function(){return ye}),n.d(t,"X",function(){return Ee}),n.d(t,"Y",function(){return be}),n.d(t,"Z",function(){return yu}),n.d(t,"ab",function(){return Er}),n.d(t,"bb",function(){return pc}),n.d(t,"cb",function(){return Wi}),n.d(t,"db",function(){return ro}),n.d(t,"eb",function(){return ro}),n.d(t,"fb",function(){return fc}),n.d(t,"gb",function(){return fl}),n.d(t,"hb",function(){return ll}),n.d(t,"ib",function(){return Jc}),n.d(t,"jb",function(){return En}),n.d(t,"kb",function(){return Eu}),n.d(t,"lb",function(){return ke}),n.d(t,"mb",function(){return Ue}),n.d(t,"nb",function(){return ge}),n.d(t,"ob",function(){return fs}),n.d(t,"pb",function(){return ji}),n.d(t,"qb",function(){return Ws}),n.d(t,"rb",function(){return Gs}),n.d(t,"sb",function(){return Gn}),n.d(t,"tb",function(){return $l}),n.d(t,"ub",function(){return hc}),n.d(t,"vb",function(){return $t}),n.d(t,"wb",function(){return Bu}),n.d(t,"xb",function(){return zt}),n.d(t,"yb",function(){return Gt}),n.d(t,"zb",function(){return Vi}),n.d(t,"Ab",function(){return fn}),n.d(t,"Bb",function(){return xn}),n.d(t,"Cb",function(){return Tu}),n.d(t,"Db",function(){return bn}),n.d(t,"Eb",function(){return cs}),n.d(t,"Fb",function(){return Ht});var m={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},g=0,_=1,v=2,y=1,b=2,E=3,x=0,T=1,S=2,A=0,P=1,M=2,R=3,C=4,w=5,O=100,I=101,D=102,L=103,F=104,N=200,B=201,U=202,k=203,V=204,G=205,z=206,j=207,H=208,W=209,X=210,Y=0,K=1,q=2,Q=3,Z=4,J=5,$=6,ee=7,te=0,ne=1,re=2,ie=0,oe=1,ae=2,se=3,le=4,ue=5,ce=301,he=302,de=303,fe=304,pe=306,me=307,ge=1e3,_e=1001,ve=1002,ye=1003,be=1004,Ee=1005,xe=1006,Te=1007,Se=1008,Ae=1009,Pe=1010,Me=1011,Re=1012,Ce=1013,we=1014,Oe=1015,Ie=1016,De=1017,Le=1018,Fe=1019,Ne=1020,Be=1021,Ue=1022,ke=1023,Ve=1024,Ge=1025,ze=1026,je=1027,He=1028,We=1029,Xe=1030,Ye=1031,Ke=1032,qe=1033,Qe=33776,Ze=33777,Je=33778,$e=33779,et=35840,tt=35841,nt=35842,rt=35843,it=36196,ot=37492,at=37496,st=37808,lt=37809,ut=37810,ct=37811,ht=37812,dt=37813,ft=37814,pt=37815,mt=37816,gt=37817,_t=37818,vt=37819,yt=37820,bt=37821,Et=36492,xt=37840,Tt=37841,St=37842,At=37843,Pt=37844,Mt=37845,Rt=37846,Ct=37847,wt=37848,Ot=37849,It=37850,Dt=37851,Lt=37852,Ft=37853,Nt=2201,Bt=2300,Ut=2301,kt=2400,Vt=2500,Gt=1,zt=2,jt=3e3,Ht=3001,Wt=3007,Xt=3002,Yt=3003,Kt=3004,qt=3005,Qt=3006,Zt=3200,Jt=3201,$t=0,en=1,tn=7680,nn=519,rn=35044,on=35048,an="300 es";function sn(){}Object.assign(sn.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var ln=[],un=0;un<256;un++)ln[un]=(un<16?"0":"")+un.toString(16);var cn,hn=1234567,dn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(ln[255&e]+ln[e>>8&255]+ln[e>>16&255]+ln[e>>24&255]+"-"+ln[255&t]+ln[t>>8&255]+"-"+ln[t>>16&15|64]+ln[t>>24&255]+"-"+ln[63&n|128]+ln[n>>8&255]+"-"+ln[n>>16&255]+ln[n>>24&255]+ln[255&r]+ln[r>>8&255]+ln[r>>16&255]+ln[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},damp:function(e,t,n,r){return dn.lerp(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(dn.euclideanModulo(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(hn=e%2147483647),((hn=16807*hn%2147483647)-1)/2147483646},degToRad:function(e){return e*dn.DEG2RAD},radToDeg:function(e){return e*dn.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),u=o((t+r)/2),c=a((t+r)/2),h=o((t-r)/2),d=a((t-r)/2),f=o((r-t)/2),p=a((r-t)/2);switch(i){case"XYX":e.set(s*c,l*h,l*d,s*u);break;case"YZY":e.set(l*d,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*d,s*c,s*u);break;case"XZX":e.set(s*c,l*p,l*f,s*u);break;case"YXY":e.set(l*f,s*c,l*p,s*u);break;case"ZYZ":e.set(l*p,l*f,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}},fn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(f.a)(this,e),Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=n}return Object(p.a)(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}]),e}(),pn=function(){function e(){Object(f.a)(this,e),Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Object(p.a)(e,[{key:"set",value:function(e,t,n,r,i,o,a,s,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=i,u[5]=s,u[6]=n,u[7]=o,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],f=n[8],p=r[0],m=r[3],g=r[6],_=r[1],v=r[4],y=r[7],b=r[2],E=r[5],x=r[8];return i[0]=o*p+a*_+s*b,i[3]=o*m+a*v+s*E,i[6]=o*g+a*y+s*x,i[1]=l*p+u*_+c*b,i[4]=l*m+u*v+c*E,i[7]=l*g+u*y+c*x,i[2]=h*p+d*_+f*b,i[5]=h*m+d*v+f*E,i[8]=h*g+d*y+f*x,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-n*i*u+n*a*s+r*i*l-r*o*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=u*o-a*l,h=a*s-u*i,d=l*i-o*s,f=t*c+n*h+r*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return e[0]=c*p,e[1]=(r*l-u*n)*p,e[2]=(a*n-r*o)*p,e[3]=h*p,e[4]=(u*t-r*s)*p,e[5]=(r*i-a*t)*p,e[6]=d*p,e[7]=(n*s-l*t)*p,e[8]=(o*t-n*i)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,o,a){var s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*o+l*a)+o+e,-r*l,r*s,-r*(-l*o+s*a)+a+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],l=r[4],u=r[7];return r[0]=t*i+n*s,r[3]=t*o+n*l,r[6]=t*a+n*u,r[1]=-n*i+t*s,r[4]=-n*o+t*l,r[7]=-n*a+t*u,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}]),e}(),mn={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===cn&&(cn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),cn.width=e.width,cn.height=e.height;var n=cn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=cn}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},gn=0;function _n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_n.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_n.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_e,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xe,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Se,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ke,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Ae,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:jt;Object.defineProperty(this,"id",{value:gn++}),this.uuid=dn.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=s,this.offset=new fn(0,0),this.repeat=new fn(1,1),this.center=new fn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}function vn(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?mn.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}_n.DEFAULT_IMAGE=void 0,_n.DEFAULT_MAPPING=300,_n.prototype=Object.assign(Object.create(sn.prototype),{constructor:_n,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=dn.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)r[o].isDataTexture?i.push(vn(r[o].image)):i.push(vn(r[o]))}else i=vn(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ge:e.x=e.x-Math.floor(e.x);break;case _e:e.x=e.x<0?0:1;break;case ve:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ge:e.y=e.y-Math.floor(e.y);break;case _e:e.y=e.y<0?0:1;break;case ve:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(_n.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});var yn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(f.a)(this,e),Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=n,this.z=r,this.w=i}return Object(p.a)(e,[{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,i,o=e.elements,a=o[0],s=o[4],l=o[8],u=o[1],c=o[5],h=o[9],d=o[2],f=o[6],p=o[10];if(Math.abs(s-u)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(s+u)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(c+1)/2,_=(p+1)/2,v=(s+u)/4,y=(l+d)/4,b=(h+f)/4;return m>g&&m>_?m<.01?(n=0,r=.707106781,i=.707106781):(r=v/(n=Math.sqrt(m)),i=y/n):g>_?g<.01?(n=.707106781,r=0,i=.707106781):(n=v/(r=Math.sqrt(g)),i=b/r):_<.01?(n=.707106781,r=.707106781,i=0):(n=y/(i=Math.sqrt(_)),r=b/i),this.set(n,r,i,t),this}var E=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(u-s)*(u-s));return Math.abs(E)<.001&&(E=1),this.x=(f-h)/E,this.y=(l-d)/E,this.z=(u-s)/E,this.w=Math.acos((a+c+p-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}}]),e}(),bn=function(e){function t(e,n,r){var i;return Object(f.a)(this,t),i=Object(u.a)(this,Object(c.a)(t).call(this)),Object.defineProperty(Object(h.a)(i),"isWebGLRenderTarget",{value:!0}),i.width=e,i.height=n,i.scissor=new yn(0,0,e,n),i.scissorTest=!1,i.viewport=new yn(0,0,e,n),r=r||{},i.texture=new _n(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),i.texture.image={},i.texture.image.width=e,i.texture.image.height=n,i.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,i.texture.minFilter=void 0!==r.minFilter?r.minFilter:xe,i.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,i.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,i.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,i}return Object(d.a)(t,e),Object(p.a)(t,[{key:"setSize",value:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),t}(sn),En=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(f.a)(this,e),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=n,this._z=r,this._w=i}return Object(p.a)(e,[{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,o=e._order,a=Math.cos,s=Math.sin,l=a(n/2),u=a(r/2),c=a(i/2),h=s(n/2),d=s(r/2),f=s(i/2);switch(o){case"XYZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"YXZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"ZXY":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"ZYX":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"YZX":this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f;break;case"XZY":this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],a=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+a+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-s)*d,this._y=(i-l)*d,this._z=(o-r)*d}else if(n>a&&n>c){var f=2*Math.sqrt(1+n-a-c);this._w=(u-s)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(i+l)/f}else if(a>c){var p=2*Math.sqrt(1+a-n-c);this._w=(i-l)/p,this._x=(r+o)/p,this._y=.25*p,this._z=(s+u)/p}else{var m=2*Math.sqrt(1+c-n-a);this._w=(o-r)/m,this._x=(i+l)/m,this._y=(s+u)/m,this._z=.25*m}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(dn.clamp(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+r*l-i*s,this._y=r*u+o*s+i*a-n*l,this._z=i*u+o*l+n*s-r*a,this._w=o*u-n*a-r*s-i*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-t;return this._w=l*o+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,a),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}],[{key:"slerp",value:function(e,t,n,r){return n.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,n,r,i,o,a){var s=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3],h=i[o+0],d=i[o+1],f=i[o+2],p=i[o+3];if(c!==p||s!==h||l!==d||u!==f){var m=1-a,g=s*h+l*d+u*f+c*p,_=g>=0?1:-1,v=1-g*g;if(v>Number.EPSILON){var y=Math.sqrt(v),b=Math.atan2(y,g*_);m=Math.sin(m*b)/y,a=Math.sin(a*b)/y}var E=a*_;if(s=s*m+h*E,l=l*m+d*E,u=u*m+f*E,c=c*m+p*E,m===1-a){var x=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=x,l*=x,u*=x,c*=x}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,i,o){var a=n[r],s=n[r+1],l=n[r+2],u=n[r+3],c=i[o],h=i[o+1],d=i[o+2],f=i[o+3];return e[t]=a*f+u*c+s*d-l*h,e[t+1]=s*f+u*h+l*c-a*d,e[t+2]=l*f+u*d+a*h-s*c,e[t+3]=u*f-a*c-s*h-l*d,e}}]),e}(),xn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(f.a)(this,e),Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=n,this.z=r}return Object(p.a)(e,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Sn.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Sn.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*r-a*n,u=s*n+a*t-i*r,c=s*r+i*n-o*t,h=-i*t-o*n-a*r;return this.x=l*s+h*-i+u*-a-c*-o,this.y=u*s+h*-o+c*-i-l*-a,this.z=c*s+h*-a+l*-o-u*-i,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Tn.copy(this).projectOnVector(e),this.sub(Tn)}},{key:"reflect",value:function(e){return this.sub(Tn.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(dn.clamp(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}]),e}(),Tn=new xn,Sn=new En,An=function(){function e(t,n){Object(f.a)(this,e),Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new xn(1/0,1/0,1/0),this.max=void 0!==n?n:new xn(-1/0,-1/0,-1/0)}return Object(p.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>o&&(o=c),h>a&&(a=h)}return this.min.set(t,n,r),this.max.set(i,o,a),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Rn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new xn),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new xn),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Cn.copy(t.boundingBox),Cn.applyMatrix4(e.matrixWorld),this.union(Cn));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new xn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Rn),Rn.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(Nn),Bn.subVectors(this.max,Nn),wn.subVectors(e.a,Nn),On.subVectors(e.b,Nn),In.subVectors(e.c,Nn),Dn.subVectors(On,wn),Ln.subVectors(In,On),Fn.subVectors(wn,In);var t=[0,-Dn.z,Dn.y,0,-Ln.z,Ln.y,0,-Fn.z,Fn.y,Dn.z,0,-Dn.x,Ln.z,0,-Ln.x,Fn.z,0,-Fn.x,-Dn.y,Dn.x,0,-Ln.y,Ln.x,0,-Fn.y,Fn.x,0];return!!Pn(t,wn,On,In,Bn)&&(!!Pn(t=[1,0,0,0,1,0,0,0,1],wn,On,In,Bn)&&(Un.crossVectors(Dn,Ln),Pn(t=[Un.x,Un.y,Un.z],wn,On,In,Bn)))}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new xn),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Rn.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Rn).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()?this:(Mn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Mn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Mn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Mn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Mn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Mn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Mn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Mn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Mn),this)}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function Pn(e,t,n,r,i){for(var o=0,a=e.length-3;o<=a;o+=3){kn.fromArray(e,o);var s=i.x*Math.abs(kn.x)+i.y*Math.abs(kn.y)+i.z*Math.abs(kn.z),l=t.dot(kn),u=n.dot(kn),c=r.dot(kn);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}var Mn=[new xn,new xn,new xn,new xn,new xn,new xn,new xn,new xn],Rn=new xn,Cn=new An,wn=new xn,On=new xn,In=new xn,Dn=new xn,Ln=new xn,Fn=new xn,Nn=new xn,Bn=new xn,Un=new xn,kn=new xn,Vn=new An,Gn=function(){function e(t,n){Object(f.a)(this,e),this.center=void 0!==t?t:new xn,this.radius=void 0!==n?n:-1}return Object(p.a)(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):Vn.setFromPoints(e).getCenter(n);for(var r=0,i=0,o=e.length;i<o;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new xn),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new An),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),zn=new xn,jn=new xn,Hn=new xn,Wn=new xn,Xn=new xn,Yn=new xn,Kn=new xn,qn=function(){function e(t,n){Object(f.a)(this,e),this.origin=void 0!==t?t:new xn,this.direction=void 0!==n?n:new xn(0,0,-1)}return Object(p.a)(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new xn),t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,zn)),this}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new xn),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=zn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(zn.copy(this.direction).multiplyScalar(t).add(this.origin),zn.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){jn.copy(e).add(t).multiplyScalar(.5),Hn.copy(t).sub(e).normalize(),Wn.copy(this.origin).sub(jn);var i,o,a,s,l=.5*e.distanceTo(t),u=-this.direction.dot(Hn),c=Wn.dot(this.direction),h=-Wn.dot(Hn),d=Wn.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(o=u*c-h,s=l*f,(i=u*h-c)>=0)if(o>=-s)if(o<=s){var p=1/f;a=(i*=p)*(i+u*(o*=p)+2*c)+o*(u*i+o+2*h)+d}else o=l,a=-(i=Math.max(0,-(u*o+c)))*i+o*(o+2*h)+d;else o=-l,a=-(i=Math.max(0,-(u*o+c)))*i+o*(o+2*h)+d;else o<=-s?a=-(i=Math.max(0,-(-u*l+c)))*i+(o=i>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d:o<=s?(i=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+d):a=-(i=Math.max(0,-(u*l+c)))*i+(o=i>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+d;else o=u>0?-l:l,a=-(i=Math.max(0,-(u*o+c)))*i+o*(o+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Hn).multiplyScalar(o).add(jn),a}},{key:"intersectSphere",value:function(e,t){zn.subVectors(e.center,this.origin);var n=zn.dot(this.direction),r=zn.dot(zn)-n*n,i=e.radius*e.radius;if(r>i)return null;var o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,i,o,a,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),n>o||i>r?null:((i>n||n!==n)&&(n=i),(o<r||r!==r)&&(r=o),c>=0?(a=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(a=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||a>r?null:((a>n||n!==n)&&(n=a),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,zn)}},{key:"intersectTriangle",value:function(e,t,n,r,i){Xn.subVectors(t,e),Yn.subVectors(n,e),Kn.crossVectors(Xn,Yn);var o,a=this.direction.dot(Kn);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Wn.subVectors(this.origin,e);var s=o*this.direction.dot(Yn.crossVectors(Wn,Yn));if(s<0)return null;var l=o*this.direction.dot(Xn.cross(Wn));if(l<0)return null;if(s+l>a)return null;var u=-o*Wn.dot(Kn);return u<0?null:this.at(u/a,i)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),Qn=function(){function e(){Object(f.a)(this,e),Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Object(p.a)(e,[{key:"set",value:function(e,t,n,r,i,o,a,s,l,u,c,h,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/Zn.setFromMatrixColumn(e,0).length(),i=1/Zn.setFromMatrixColumn(e,1).length(),o=1/Zn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=o*u,d=o*c,f=a*u,p=a*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-a*s,t[2]=p-h*l,t[6]=f+d*l,t[10]=o*s}else if("YXZ"===e.order){var m=s*u,g=s*c,_=l*u,v=l*c;t[0]=m+v*a,t[4]=_*a-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-a,t[2]=g*a-_,t[6]=v+m*a,t[10]=o*s}else if("ZXY"===e.order){var y=s*u,b=s*c,E=l*u,x=l*c;t[0]=y-x*a,t[4]=-o*c,t[8]=E+b*a,t[1]=b+E*a,t[5]=o*u,t[9]=x-y*a,t[2]=-o*l,t[6]=a,t[10]=o*s}else if("ZYX"===e.order){var T=o*u,S=o*c,A=a*u,P=a*c;t[0]=s*u,t[4]=A*l-S,t[8]=T*l+P,t[1]=s*c,t[5]=P*l+T,t[9]=S*l-A,t[2]=-l,t[6]=a*s,t[10]=o*s}else if("YZX"===e.order){var M=o*s,R=o*l,C=a*s,w=a*l;t[0]=s*u,t[4]=w-M*c,t[8]=C*c+R,t[1]=c,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=R*c+C,t[10]=M-w*c}else if("XZY"===e.order){var O=o*s,I=o*l,D=a*s,L=a*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=O*c+L,t[5]=o*u,t[9]=I*c-D,t[2]=D*c-I,t[6]=a*u,t[10]=L*c+O}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose($n,e,er)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return rr.subVectors(e,t),0===rr.lengthSq()&&(rr.z=1),rr.normalize(),tr.crossVectors(n,rr),0===tr.lengthSq()&&(1===Math.abs(n.z)?rr.x+=1e-4:rr.z+=1e-4,rr.normalize(),tr.crossVectors(n,rr)),tr.normalize(),nr.crossVectors(rr,tr),r[0]=tr.x,r[4]=nr.x,r[8]=rr.x,r[1]=tr.y,r[5]=nr.y,r[9]=rr.y,r[2]=tr.z,r[6]=nr.z,r[10]=rr.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],_=n[3],v=n[7],y=n[11],b=n[15],E=r[0],x=r[4],T=r[8],S=r[12],A=r[1],P=r[5],M=r[9],R=r[13],C=r[2],w=r[6],O=r[10],I=r[14],D=r[3],L=r[7],F=r[11],N=r[15];return i[0]=o*E+a*A+s*C+l*D,i[4]=o*x+a*P+s*w+l*L,i[8]=o*T+a*M+s*O+l*F,i[12]=o*S+a*R+s*I+l*N,i[1]=u*E+c*A+h*C+d*D,i[5]=u*x+c*P+h*w+d*L,i[9]=u*T+c*M+h*O+d*F,i[13]=u*S+c*R+h*I+d*N,i[2]=f*E+p*A+m*C+g*D,i[6]=f*x+p*P+m*w+g*L,i[10]=f*T+p*M+m*O+g*F,i[14]=f*S+p*R+m*I+g*N,i[3]=_*E+v*A+y*C+b*D,i[7]=_*x+v*P+y*w+b*L,i[11]=_*T+v*M+y*O+b*F,i[15]=_*S+v*R+y*I+b*N,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],a=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*s*c-r*l*c-i*a*h+n*l*h+r*a*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*o*h-r*o*d+r*l*u-i*s*u)+e[11]*(+t*l*c-t*a*d-i*o*c+n*o*d+i*a*u-n*l*u)+e[15]*(-r*a*u-t*s*c+t*a*h+r*o*c-n*o*h+n*s*u)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],_=c*m*l-p*h*l+p*s*d-a*m*d-c*s*g+a*h*g,v=f*h*l-u*m*l-f*s*d+o*m*d+u*s*g-o*h*g,y=u*p*l-f*c*l+f*a*d-o*p*d-u*a*g+o*c*g,b=f*c*s-u*p*s-f*a*h+o*p*h+u*a*m-o*c*m,E=t*_+n*v+r*y+i*b;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var x=1/E;return e[0]=_*x,e[1]=(p*h*i-c*m*i-p*r*d+n*m*d+c*r*g-n*h*g)*x,e[2]=(a*m*i-p*s*i+p*r*l-n*m*l-a*r*g+n*s*g)*x,e[3]=(c*s*i-a*h*i-c*r*l+n*h*l+a*r*d-n*s*d)*x,e[4]=v*x,e[5]=(u*m*i-f*h*i+f*r*d-t*m*d-u*r*g+t*h*g)*x,e[6]=(f*s*i-o*m*i-f*r*l+t*m*l+o*r*g-t*s*g)*x,e[7]=(o*h*i-u*s*i+u*r*l-t*h*l-o*r*d+t*s*d)*x,e[8]=y*x,e[9]=(f*c*i-u*p*i-f*n*d+t*p*d+u*n*g-t*c*g)*x,e[10]=(o*p*i-f*a*i+f*n*l-t*p*l-o*n*g+t*a*g)*x,e[11]=(u*a*i-o*c*i-u*n*l+t*c*l+o*n*d-t*a*d)*x,e[12]=b*x,e[13]=(u*p*r-f*c*r+f*n*h-t*p*h-u*n*m+t*c*m)*x,e[14]=(f*a*r-o*p*r-f*n*s+t*p*s+o*n*m-t*a*m)*x,e[15]=(o*c*r-u*a*r+u*n*s-t*c*s-o*n*h+t*a*h)*x,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,a=e.y,s=e.z,l=i*o,u=i*a;return this.set(l*o+n,l*a-r*s,l*s+r*a,0,l*a+r*s,u*a+n,u*s-r*o,0,l*s-r*a,u*s+r*o,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,i=t._x,o=t._y,a=t._z,s=t._w,l=i+i,u=o+o,c=a+a,h=i*l,d=i*u,f=i*c,p=o*u,m=o*c,g=a*c,_=s*l,v=s*u,y=s*c,b=n.x,E=n.y,x=n.z;return r[0]=(1-(p+g))*b,r[1]=(d+y)*b,r[2]=(f-v)*b,r[3]=0,r[4]=(d-y)*E,r[5]=(1-(h+g))*E,r[6]=(m+_)*E,r[7]=0,r[8]=(f+v)*x,r[9]=(m-_)*x,r[10]=(1-(h+p))*x,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,i=Zn.set(r[0],r[1],r[2]).length(),o=Zn.set(r[4],r[5],r[6]).length(),a=Zn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Jn.copy(this);var s=1/i,l=1/o,u=1/a;return Jn.elements[0]*=s,Jn.elements[1]*=s,Jn.elements[2]*=s,Jn.elements[4]*=l,Jn.elements[5]*=l,Jn.elements[6]*=l,Jn.elements[8]*=u,Jn.elements[9]*=u,Jn.elements[10]*=u,t.setFromRotationMatrix(Jn),n.x=i,n.y=o,n.z=a,this}},{key:"makePerspective",value:function(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(t-e),l=2*i/(n-r),u=(t+e)/(t-e),c=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,i,o){var a=this.elements,s=1/(t-e),l=1/(n-r),u=1/(o-i),c=(t+e)*s,h=(n+r)*l,d=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),Zn=new xn,Jn=new Qn,$n=new xn(0,0,0),er=new xn(1,1,1),tr=new xn,nr=new xn,rr=new xn,ir=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;Object(f.a)(this,e),Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=n,this._z=r,this._order=i}return Object(p.a)(e,[{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e,t,n){var r=dn.clamp,i=e.elements,o=i[0],a=i[4],s=i[8],l=i[1],u=i[5],c=i[9],h=i[2],d=i[6],f=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,f));break;case"XZY":this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return or.makeRotationFromQuaternion(e),this.setFromRotationMatrix(or,t,n)}},{key:"setFromVector3",value:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)}},{key:"reorder",value:function(e){return ar.setFromEuler(this),this.setFromQuaternion(ar,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new xn(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}]),e}();ir.DefaultOrder="XYZ",ir.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var or=new Qn,ar=new En,sr=function(){function e(){Object(f.a)(this,e),this.mask=1}return Object(p.a)(e,[{key:"set",value:function(e){this.mask=1<<e|0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}}]),e}(),lr=0,ur=new xn,cr=new En,hr=new Qn,dr=new xn,fr=new xn,pr=new xn,mr=new En,gr=new xn(1,0,0),_r=new xn(0,1,0),vr=new xn(0,0,1),yr={type:"added"},br={type:"removed"};function Er(){Object.defineProperty(this,"id",{value:lr++}),this.uuid=dn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Er.DefaultUp.clone();var e=new xn,t=new ir,n=new En,r=new xn(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Qn},normalMatrix:{value:new pn}}),this.matrix=new Qn,this.matrixWorld=new Qn,this.matrixAutoUpdate=Er.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new sr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Er.DefaultUp=new xn(0,1,0),Er.DefaultMatrixAutoUpdate=!0,Er.prototype=Object.assign(Object.create(sn.prototype),{constructor:Er,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return cr.setFromAxisAngle(e,t),this.quaternion.multiply(cr),this},rotateOnWorldAxis:function(e,t){return cr.setFromAxisAngle(e,t),this.quaternion.premultiply(cr),this},rotateX:function(e){return this.rotateOnAxis(gr,e)},rotateY:function(e){return this.rotateOnAxis(_r,e)},rotateZ:function(e){return this.rotateOnAxis(vr,e)},translateOnAxis:function(e,t){return ur.copy(e).applyQuaternion(this.quaternion),this.position.add(ur.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(gr,e)},translateY:function(e){return this.translateOnAxis(_r,e)},translateZ:function(e){return this.translateOnAxis(vr,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(hr.copy(this.matrixWorld).invert())},lookAt:function(e,t,n){e.isVector3?dr.copy(e):dr.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),fr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hr.lookAt(fr,dr,this.up):hr.lookAt(dr,fr,this.up),this.quaternion.setFromRotationMatrix(hr),r&&(hr.extractRotation(r.matrixWorld),cr.setFromRotationMatrix(hr),this.quaternion.premultiply(cr.invert()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(yr)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(br)),this},clear:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(br)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),hr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),hr.multiply(e.parent.matrixWorld)),e.applyMatrix4(hr),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new xn),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new En),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fr,e,pr),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new xn),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fr,mr,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new xn),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var u=a[s];i(e.shapes,u)}else i(e.shapes,a)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,d=this.material.length;h<d;h++)c.push(i(e.materials,this.material[h]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(var f=0;f<this.children.length;f++)r.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var m=this.animations[p];r.animations.push(i(e.animations,m))}}if(t){var g=T(e.geometries),_=T(e.materials),v=T(e.textures),y=T(e.images),b=T(e.shapes),E=T(e.skeletons),x=T(e.animations);g.length>0&&(n.geometries=g),_.length>0&&(n.materials=_),v.length>0&&(n.textures=v),y.length>0&&(n.images=y),b.length>0&&(n.shapes=b),E.length>0&&(n.skeletons=E),x.length>0&&(n.animations=x)}return n.object=r,n;function T(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}});var xr=new xn,Tr=new xn,Sr=new pn,Ar=function(){function e(t,n){Object(f.a)(this,e),Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new xn(1,0,0),this.constant=void 0!==n?n:0}return Object(p.a)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=xr.subVectors(n,t).cross(Tr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new xn),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new xn);var n=e.delta(xr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new xn),e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||Sr.getNormalMatrix(e),r=this.coplanarPoint(xr).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),Pr=new xn,Mr=new xn,Rr=new xn,Cr=new xn,wr=new xn,Or=new xn,Ir=new xn,Dr=new xn,Lr=new xn,Fr=new xn,Nr=function(){function e(t,n,r){Object(f.a)(this,e),this.a=void 0!==t?t:new xn,this.b=void 0!==n?n:new xn,this.c=void 0!==r?r:new xn}return Object(p.a)(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return Pr.subVectors(this.c,this.b),Mr.subVectors(this.a,this.b),.5*Pr.cross(Mr).length()}},{key:"getMidpoint",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new xn),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Ar),e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,i,o){return e.getUV(t,this.a,this.b,this.c,n,r,i,o)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new xn);var n,r,i=this.a,o=this.b,a=this.c;wr.subVectors(o,i),Or.subVectors(a,i),Dr.subVectors(e,i);var s=wr.dot(Dr),l=Or.dot(Dr);if(s<=0&&l<=0)return t.copy(i);Lr.subVectors(e,o);var u=wr.dot(Lr),c=Or.dot(Lr);if(u>=0&&c<=u)return t.copy(o);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(i).addScaledVector(wr,n);Fr.subVectors(e,a);var d=wr.dot(Fr),f=Or.dot(Fr);if(f>=0&&d<=f)return t.copy(a);var p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return r=l/(l-f),t.copy(i).addScaledVector(Or,r);var m=u*f-d*c;if(m<=0&&c-u>=0&&d-f>=0)return Ir.subVectors(a,o),r=(c-u)/(c-u+(d-f)),t.copy(o).addScaledVector(Ir,r);var g=1/(m+p+h);return n=p*g,r=h*g,t.copy(i).addScaledVector(wr,n).addScaledVector(Or,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new xn),r.subVectors(n,t),Pr.subVectors(e,t),r.cross(Pr);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,i){Pr.subVectors(r,t),Mr.subVectors(n,t),Rr.subVectors(e,t);var o=Pr.dot(Pr),a=Pr.dot(Mr),s=Pr.dot(Rr),l=Mr.dot(Mr),u=Mr.dot(Rr),c=o*l-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new xn),0===c)return i.set(-2,-1,-1);var h=1/c,d=(l*s-a*u)*h,f=(o*u-a*s)*h;return i.set(1-d-f,f,d)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,Cr),Cr.x>=0&&Cr.y>=0&&Cr.x+Cr.y<=1}},{key:"getUV",value:function(e,t,n,r,i,o,a,s){return this.getBarycoord(e,t,n,r,Cr),s.set(0,0),s.addScaledVector(i,Cr.x),s.addScaledVector(o,Cr.y),s.addScaledVector(a,Cr.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return Pr.subVectors(n,t),Mr.subVectors(e,t),Pr.cross(Mr).dot(r)<0}}]),e}(),Br={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ur={h:0,s:0,l:0},kr={h:0,s:0,l:0};function Vr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Gr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function zr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var jr=function(){function e(t,n,r){return Object(f.a)(this,e),Object.defineProperty(this,"isColor",{value:!0}),void 0===n&&void 0===r?this.set(t):this.setRGB(t,n,r)}return Object(p.a)(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(e,t,n){if(e=dn.euclideanModulo(e,1),t=dn.clamp(t,0,1),n=dn.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Vr(i,r,e+1/3),this.g=Vr(i,r,e),this.b=Vr(i,r,e-1/3)}return this}},{key:"setStyle",value:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(a,s,l)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){var u=n[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}},{key:"setColorName",value:function(e){var t=Br[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=Gr(e.r),this.g=Gr(e.g),this.b=Gr(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=zr(e.r),this.g=zr(e.g),this.b=zr(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),l=(s+a)/2;if(s===a)t=0,n=0;else{var u=a-s;switch(n=l<=.5?u/(a+s):u/(2-a-s),a){case r:t=(i-o)/u+(i<o?6:0);break;case i:t=(o-r)/u+2;break;case o:t=(r-i)/u+4}t/=6}return e.h=t,e.s=n,e.l=l,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(Ur),Ur.h+=e,Ur.s+=t,Ur.l+=n,this.setHSL(Ur.h,Ur.s,Ur.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Ur),e.getHSL(kr);var n=dn.lerp(Ur.h,kr.h,t),r=dn.lerp(Ur.s,kr.s,t),i=dn.lerp(Ur.l,kr.l,t);return this.setHSL(n,r,i),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),e}();jr.NAMES=Br,jr.prototype.r=1,jr.prototype.g=1,jr.prototype.b=1;var Hr=function(){function e(t,n,r,i,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(f.a)(this,e),this.a=t,this.b=n,this.c=r,this.normal=i&&i.isVector3?i:new xn,this.vertexNormals=Array.isArray(i)?i:[],this.color=o&&o.isColor?o:new jr,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=a}return Object(p.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,i=e.vertexColors.length;r<i;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this}}]),e}(),Wr=0;function Xr(){Object.defineProperty(this,"id",{value:Wr++}),this.uuid=dn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=P,this.side=x,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=V,this.blendDst=G,this.blendEquation=O,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Q,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=nn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tn,this.stencilZFail=tn,this.stencilZPass=tn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Yr(e){Xr.call(this),this.type="MeshBasicMaterial",this.color=new jr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Xr.prototype=Object.assign(Object.create(sn.prototype),{constructor:Xr,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==P&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==x&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Xr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Yr.prototype=Object.create(Xr.prototype),Yr.prototype.constructor=Yr,Yr.prototype.isMeshBasicMaterial=!0,Yr.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var Kr=new xn,qr=new fn;function Qr(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=rn,this.updateRange={offset:0,count:-1},this.version=0}function Zr(e,t,n){Qr.call(this,new Int8Array(e),t,n)}function Jr(e,t,n){Qr.call(this,new Uint8Array(e),t,n)}function $r(e,t,n){Qr.call(this,new Uint8ClampedArray(e),t,n)}function ei(e,t,n){Qr.call(this,new Int16Array(e),t,n)}function ti(e,t,n){Qr.call(this,new Uint16Array(e),t,n)}function ni(e,t,n){Qr.call(this,new Int32Array(e),t,n)}function ri(e,t,n){Qr.call(this,new Uint32Array(e),t,n)}function ii(e,t,n){Qr.call(this,new Uint16Array(e),t,n)}function oi(e,t,n){Qr.call(this,new Float32Array(e),t,n)}function ai(e,t,n){Qr.call(this,new Float64Array(e),t,n)}function si(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(Qr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Qr.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new jr),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new fn),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new xn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new yn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)qr.fromBufferAttribute(this,t),qr.applyMatrix3(e),this.setXY(t,qr.x,qr.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)Kr.fromBufferAttribute(this,r),Kr.applyMatrix3(e),this.setXYZ(r,Kr.x,Kr.y,Kr.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)Kr.x=this.getX(t),Kr.y=this.getY(t),Kr.z=this.getZ(t),Kr.applyMatrix4(e),this.setXYZ(t,Kr.x,Kr.y,Kr.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)Kr.x=this.getX(t),Kr.y=this.getY(t),Kr.z=this.getZ(t),Kr.applyNormalMatrix(e),this.setXYZ(t,Kr.x,Kr.y,Kr.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)Kr.x=this.getX(t),Kr.y=this.getY(t),Kr.z=this.getZ(t),Kr.transformDirection(e),this.setXYZ(t,Kr.x,Kr.y,Kr.z);return this},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Zr.prototype=Object.create(Qr.prototype),Zr.prototype.constructor=Zr,Jr.prototype=Object.create(Qr.prototype),Jr.prototype.constructor=Jr,$r.prototype=Object.create(Qr.prototype),$r.prototype.constructor=$r,ei.prototype=Object.create(Qr.prototype),ei.prototype.constructor=ei,ti.prototype=Object.create(Qr.prototype),ti.prototype.constructor=ti,ni.prototype=Object.create(Qr.prototype),ni.prototype.constructor=ni,ri.prototype=Object.create(Qr.prototype),ri.prototype.constructor=ri,ii.prototype=Object.create(Qr.prototype),ii.prototype.constructor=ii,ii.prototype.isFloat16BufferAttribute=!0,oi.prototype=Object.create(Qr.prototype),oi.prototype.constructor=oi,ai.prototype=Object.create(Qr.prototype),ai.prototype.constructor=ai;var li={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ui(e,t){return new li[e](t)}var ci=0,hi=new Qn,di=new Er,fi=new xn,pi=new An,mi=new An,gi=new xn;function _i(){Object.defineProperty(this,"id",{value:ci++}),this.uuid=dn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}_i.prototype=Object.assign(Object.create(sn.prototype),{constructor:_i,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(si(e)>65535?ri:ti)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new pn).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return hi.makeRotationX(e),this.applyMatrix4(hi),this},rotateY:function(e){return hi.makeRotationY(e),this.applyMatrix4(hi),this},rotateZ:function(e){return hi.makeRotationZ(e),this.applyMatrix4(hi),this},translate:function(e,t,n){return hi.makeTranslation(e,t,n),this.applyMatrix4(hi),this},scale:function(e,t,n){return hi.makeScale(e,t,n),this.applyMatrix4(hi),this},lookAt:function(e){return di.lookAt(e),di.updateMatrix(),this.applyMatrix4(di.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(fi).negate(),this.translate(fi.x,fi.y,fi.z),this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new oi(t,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new An);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new xn(-1/0,-1/0,-1/0),new xn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];pi.setFromBufferAttribute(i),this.morphTargetsRelative?(gi.addVectors(this.boundingBox.min,pi.min),this.boundingBox.expandByPoint(gi),gi.addVectors(this.boundingBox.max,pi.max),this.boundingBox.expandByPoint(gi)):(this.boundingBox.expandByPoint(pi.min),this.boundingBox.expandByPoint(pi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Gn);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new xn,1/0);if(e){var n=this.boundingSphere.center;if(pi.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var o=t[r];mi.setFromBufferAttribute(o),this.morphTargetsRelative?(gi.addVectors(pi.min,mi.min),pi.expandByPoint(gi),gi.addVectors(pi.max,mi.max),pi.expandByPoint(gi)):(pi.expandByPoint(mi.min),pi.expandByPoint(mi.max))}pi.getCenter(n);for(var a=0,s=0,l=e.count;s<l;s++)gi.fromBufferAttribute(e,s),a=Math.max(a,n.distanceToSquared(gi));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],d=this.morphTargetsRelative,f=0,p=h.count;f<p;f++)gi.fromBufferAttribute(h,f),d&&(fi.fromBufferAttribute(e,f),gi.add(fi)),a=Math.max(a,n.distanceToSquared(gi));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,a=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Qr(new Float32Array(4*a),4));for(var s=t.tangent.array,l=[],u=[],c=0;c<a;c++)l[c]=new xn,u[c]=new xn;var h=new xn,d=new xn,f=new xn,p=new fn,m=new fn,g=new fn,_=new xn,v=new xn,y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(var b=0,E=y.length;b<E;++b)for(var x=y[b],T=x.start,S=T,A=T+x.count;S<A;S+=3)N(n[S+0],n[S+1],n[S+2]);for(var P=new xn,M=new xn,R=new xn,C=new xn,w=0,O=y.length;w<O;++w)for(var I=y[w],D=I.start,L=D,F=D+I.count;L<F;L+=3)B(n[L+0]),B(n[L+1]),B(n[L+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function N(e,t,n){h.fromArray(r,3*e),d.fromArray(r,3*t),f.fromArray(r,3*n),p.fromArray(o,2*e),m.fromArray(o,2*t),g.fromArray(o,2*n),d.sub(h),f.sub(h),m.sub(p),g.sub(p);var i=1/(m.x*g.y-g.x*m.y);isFinite(i)&&(_.copy(d).multiplyScalar(g.y).addScaledVector(f,-m.y).multiplyScalar(i),v.copy(f).multiplyScalar(m.x).addScaledVector(d,-g.x).multiplyScalar(i),l[e].add(_),l[t].add(_),l[n].add(_),u[e].add(v),u[t].add(v),u[n].add(v))}function B(e){R.fromArray(i,3*e),C.copy(R);var t=l[e];P.copy(t),P.sub(R.multiplyScalar(R.dot(t))).normalize(),M.crossVectors(C,t);var n=M.dot(u[e])<0?-1:1;s[4*e]=P.x,s[4*e+1]=P.y,s[4*e+2]=P.z,s[4*e+3]=n}},computeVertexNormals:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new Qr(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var o=new xn,a=new xn,s=new xn,l=new xn,u=new xn,c=new xn,h=new xn,d=new xn;if(e)for(var f=0,p=e.count;f<p;f+=3){var m=e.getX(f+0),g=e.getX(f+1),_=e.getX(f+2);o.fromBufferAttribute(t,m),a.fromBufferAttribute(t,g),s.fromBufferAttribute(t,_),h.subVectors(s,a),d.subVectors(o,a),h.cross(d),l.fromBufferAttribute(n,m),u.fromBufferAttribute(n,g),c.fromBufferAttribute(n,_),l.add(h),u.add(h),c.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,u.x,u.y,u.z),n.setXYZ(_,c.x,c.y,c.z)}else for(var v=0,y=t.count;v<y;v+=3)o.fromBufferAttribute(t,v+0),a.fromBufferAttribute(t,v+1),s.fromBufferAttribute(t,v+2),h.subVectors(s,a),d.subVectors(o,a),h.cross(d),n.setXYZ(v+0,h.x,h.y,h.z),n.setXYZ(v+1,h.x,h.y,h.z),n.setXYZ(v+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,o=e.attributes[r],a=o.array,s=o.itemSize*t,l=Math.min(a.length,i.length-s),u=0,c=s;u<l;u++,c++)i[c]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)gi.fromBufferAttribute(e,t),gi.normalize(),e.setXYZ(t,gi.x,gi.y,gi.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r),a=0,s=0,l=0,u=t.length;l<u;l++){a=t[l]*r;for(var c=0;c<r;c++)o[s++]=n[a++]}return new Qr(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new _i,n=this.index.array,r=this.attributes;for(var i in r){var o=e(r[i],n);t.setAttribute(i,o)}var a=this.morphAttributes;for(var s in a){for(var l=[],u=a[s],c=0,h=u.length;c<h;c++){var d=e(u[c],n);l.push(d)}t.morphAttributes[s]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,p=0,m=f.length;p<m;p++){var g=f[p];t.addGroup(g.start,g.count,g.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var o in i){var a=i[o],s=a.toJSON(e.data);""!==a.name&&(s.name=a.name),e.data.attributes[o]=s}var l={},u=!1;for(var c in this.morphAttributes){for(var h=this.morphAttributes[c],d=[],f=0,p=h.length;f<p;f++){var m=h[f],g=m.toJSON(e.data);""!==m.name&&(g.name=m.name),d.push(g)}d.length>0&&(l[c]=d,u=!0)}u&&(e.data.morphAttributes=l,e.data.morphTargetsRelative=this.morphTargetsRelative);var _=this.groups;_.length>0&&(e.data.groups=JSON.parse(JSON.stringify(_)));var v=this.boundingSphere;return null!==v&&(e.data.boundingSphere={center:v.center.toArray(),radius:v.radius}),e},clone:function(){return(new _i).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var i in r){var o=r[i];this.setAttribute(i,o.clone(t))}var a=e.morphAttributes;for(var s in a){for(var l=[],u=a[s],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,f=0,p=d.length;f<p;f++){var m=d[f];this.addGroup(m.start,m.count,m.materialIndex)}var g=e.boundingBox;null!==g&&(this.boundingBox=g.clone());var _=e.boundingSphere;return null!==_&&(this.boundingSphere=_.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var vi=new Qn,yi=new qn,bi=new Gn,Ei=new xn,xi=new xn,Ti=new xn,Si=new xn,Ai=new xn,Pi=new xn,Mi=new xn,Ri=new xn,Ci=new xn,wi=new fn,Oi=new fn,Ii=new fn,Di=new xn,Li=new xn;function Fi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _i,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yr;Er.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function Ni(e,t,n,r,i,o,a,s,l,u,c,h){Ei.fromBufferAttribute(i,u),xi.fromBufferAttribute(i,c),Ti.fromBufferAttribute(i,h);var d=e.morphTargetInfluences;if(t.morphTargets&&o&&d){Mi.set(0,0,0),Ri.set(0,0,0),Ci.set(0,0,0);for(var f=0,p=o.length;f<p;f++){var m=d[f],g=o[f];0!==m&&(Si.fromBufferAttribute(g,u),Ai.fromBufferAttribute(g,c),Pi.fromBufferAttribute(g,h),a?(Mi.addScaledVector(Si,m),Ri.addScaledVector(Ai,m),Ci.addScaledVector(Pi,m)):(Mi.addScaledVector(Si.sub(Ei),m),Ri.addScaledVector(Ai.sub(xi),m),Ci.addScaledVector(Pi.sub(Ti),m)))}Ei.add(Mi),xi.add(Ri),Ti.add(Ci)}e.isSkinnedMesh&&(e.boneTransform(u,Ei),e.boneTransform(c,xi),e.boneTransform(h,Ti));var _=function(e,t,n,r,i,o,a,s){if(null===(t.side===T?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,t.side!==S,s)))return null;Li.copy(s),Li.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Li);return l<n.near||l>n.far?null:{distance:l,point:Li.clone(),object:e}}(e,t,n,r,Ei,xi,Ti,Di);if(_){s&&(wi.fromBufferAttribute(s,u),Oi.fromBufferAttribute(s,c),Ii.fromBufferAttribute(s,h),_.uv=Nr.getUV(Di,Ei,xi,Ti,wi,Oi,Ii,new fn)),l&&(wi.fromBufferAttribute(l,u),Oi.fromBufferAttribute(l,c),Ii.fromBufferAttribute(l,h),_.uv2=Nr.getUV(Di,Ei,xi,Ti,wi,Oi,Ii,new fn));var v=new Hr(u,c,h);Nr.getNormal(Ei,xi,Ti,v.normal),_.face=v}return _}Fi.prototype=Object.assign(Object.create(Er.prototype),{constructor:Fi,isMesh:!0,copy:function(e){return Er.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),bi.copy(r.boundingSphere),bi.applyMatrix4(o),!1!==e.ray.intersectsSphere(bi)&&(vi.copy(o).invert(),yi.copy(e.ray).applyMatrix4(vi),null===r.boundingBox||!1!==yi.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a=r.index,s=r.attributes.position,l=r.morphAttributes.position,u=r.morphTargetsRelative,c=r.attributes.uv,h=r.attributes.uv2,d=r.groups,f=r.drawRange;if(null!==a)if(Array.isArray(i))for(var p=0,m=d.length;p<m;p++)for(var g=d[p],_=i[g.materialIndex],v=Math.max(g.start,f.start),y=Math.min(g.start+g.count,f.start+f.count);v<y;v+=3){var b=a.getX(v),E=a.getX(v+1),x=a.getX(v+2);(n=Ni(this,_,e,yi,s,l,u,c,h,b,E,x))&&(n.faceIndex=Math.floor(v/3),n.face.materialIndex=g.materialIndex,t.push(n))}else for(var T=Math.max(0,f.start),S=Math.min(a.count,f.start+f.count);T<S;T+=3){var A=a.getX(T),P=a.getX(T+1),M=a.getX(T+2);(n=Ni(this,i,e,yi,s,l,u,c,h,A,P,M))&&(n.faceIndex=Math.floor(T/3),t.push(n))}else if(void 0!==s)if(Array.isArray(i))for(var R=0,C=d.length;R<C;R++)for(var w=d[R],O=i[w.materialIndex],I=Math.max(w.start,f.start),D=Math.min(w.start+w.count,f.start+f.count);I<D;I+=3){(n=Ni(this,O,e,yi,s,l,u,c,h,I,I+1,I+2))&&(n.faceIndex=Math.floor(I/3),n.face.materialIndex=w.materialIndex,t.push(n))}else for(var L=Math.max(0,f.start),F=Math.min(s.count,f.start+f.count);L<F;L+=3){(n=Ni(this,i,e,yi,s,l,u,c,h,L,L+1,L+2))&&(n.faceIndex=Math.floor(L/3),t.push(n))}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});var Bi=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(f.a)(this,t),(e=Object(u.a)(this,Object(c.a)(t).call(this))).type="BoxGeometry",e.parameters={width:n,height:r,depth:i,widthSegments:o,heightSegments:a,depthSegments:s};var l=Object(h.a)(e);o=Math.floor(o),a=Math.floor(a),s=Math.floor(s);var d=[],p=[],m=[],g=[],_=0,v=0;function y(e,t,n,r,i,o,a,s,u,c,h){for(var f=o/u,y=a/c,b=o/2,E=a/2,x=s/2,T=u+1,S=c+1,A=0,P=0,M=new xn,R=0;R<S;R++)for(var C=R*y-E,w=0;w<T;w++){var O=w*f-b;M[e]=O*r,M[t]=C*i,M[n]=x,p.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=s>0?1:-1,m.push(M.x,M.y,M.z),g.push(w/u),g.push(1-R/c),A+=1}for(var I=0;I<c;I++)for(var D=0;D<u;D++){var L=_+D+T*I,F=_+D+T*(I+1),N=_+(D+1)+T*(I+1),B=_+(D+1)+T*I;d.push(L,F,B),d.push(F,N,B),P+=6}l.addGroup(v,P,h),v+=P,_+=A}return y("z","y","x",-1,-1,i,r,n,s,a,0),y("z","y","x",1,-1,i,r,-n,s,a,1),y("x","z","y",1,1,n,i,r,o,s,2),y("x","z","y",1,-1,n,i,-r,o,s,3),y("x","y","z",1,-1,n,r,i,o,a,4),y("x","y","z",-1,-1,n,r,-i,o,a,5),e.setIndex(d),e.setAttribute("position",new oi(p,3)),e.setAttribute("normal",new oi(m,3)),e.setAttribute("uv",new oi(g,2)),e}return Object(d.a)(t,e),t}(_i);function Ui(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function ki(e){for(var t={},n=0;n<e.length;n++){var r=Ui(e[n]);for(var i in r)t[i]=r[i]}return t}var Vi={clone:Ui,merge:ki},Gi="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",zi="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ji(e){Xr.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Gi,this.fragmentShader=zi,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Hi(){Er.call(this),this.type="Camera",this.matrixWorldInverse=new Qn,this.projectionMatrix=new Qn,this.projectionMatrixInverse=new Qn}function Wi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;Hi.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ji.prototype=Object.create(Xr.prototype),ji.prototype.constructor=ji,ji.prototype.isShaderMaterial=!0,ji.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ui(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},ji.prototype.toJSON=function(e){var t=Xr.prototype.toJSON.call(this,e);for(var n in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},Hi.prototype=Object.assign(Object.create(Er.prototype),{constructor:Hi,isCamera:!0,copy:function(e,t){return Er.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new xn),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Er.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){Er.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),Wi.prototype=Object.assign(Object.create(Hi.prototype),{constructor:Wi,isPerspectiveCamera:!0,copy:function(e,t){return Hi.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*dn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*dn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*dn.RAD2DEG*Math.atan(Math.tan(.5*dn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*dn.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/a,t-=o.offsetY*n/s,r*=o.width/a,n*=o.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){var t=Er.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var Xi=90,Yi=1;function Ki(e,t,n){if(Er.call(this),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;var r=new Wi(Xi,Yi,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new xn(1,0,0)),this.add(r);var i=new Wi(Xi,Yi,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new xn(-1,0,0)),this.add(i);var o=new Wi(Xi,Yi,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new xn(0,1,0)),this.add(o);var a=new Wi(Xi,Yi,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new xn(0,-1,0)),this.add(a);var s=new Wi(Xi,Yi,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new xn(0,0,1)),this.add(s);var l=new Wi(Xi,Yi,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new xn(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var u=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function qi(e,t,n,r,i,o,a,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:ce,a=void 0!==a?a:Ue,_n.call(this,e,t,n,r,i,o,a,s,l,u),this.flipY=!1,this._needsFlipEnvMap=!0}Ki.prototype=Object.create(Er.prototype),Ki.prototype.constructor=Ki,qi.prototype=Object.create(_n.prototype),qi.prototype.constructor=qi,qi.prototype.isCubeTexture=!0,Object.defineProperty(qi.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Qi=function(e){function t(e,n,r){var i;return Object(f.a)(this,t),Number.isInteger(n)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),n=r),i=Object(u.a)(this,Object(c.a)(t).call(this,e,e,n)),Object.defineProperty(Object(h.a)(i),"isWebGLCubeRenderTarget",{value:!0}),n=n||{},i.texture=new qi(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),i.texture._needsFlipEnvMap=!1,i}return Object(d.a)(t,e),Object(p.a)(t,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.format=ke,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new Bi(5,5,5),a=new ji({name:"CubemapFromEquirect",uniforms:Ui(n),vertexShader:r,fragmentShader:i,side:T,blending:A});a.uniforms.tEquirect.value=t;var s=new Fi(o,a),l=t.minFilter;return t.minFilter===Se&&(t.minFilter=xe),new Ki(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var i=e.getRenderTarget(),o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(i)}}]),t}(bn);function Zi(e,t,n,r,i,o,a,s,l,u,c,h){_n.call(this,null,o,a,s,l,u,r,i,c,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:ye,this.minFilter=void 0!==u?u:ye,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Zi.prototype=Object.create(_n.prototype),Zi.prototype.constructor=Zi,Zi.prototype.isDataTexture=!0;var Ji=new Gn,$i=new xn,eo=function(){function e(t,n,r,i,o,a){Object(f.a)(this,e),this.planes=[void 0!==t?t:new Ar,void 0!==n?n:new Ar,void 0!==r?r:new Ar,void 0!==i?i:new Ar,void 0!==o?o:new Ar,void 0!==a?a:new Ar]}return Object(p.a)(e,[{key:"set",value:function(e,t,n,r,i,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],g=n[13],_=n[14],v=n[15];return t[0].setComponents(a-r,c-s,p-h,v-m).normalize(),t[1].setComponents(a+r,c+s,p+h,v+m).normalize(),t[2].setComponents(a+i,c+l,p+d,v+g).normalize(),t[3].setComponents(a-i,c-l,p-d,v-g).normalize(),t[4].setComponents(a-o,c-u,p-f,v-_).normalize(),t[5].setComponents(a+o,c+u,p+f,v+_).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Ji.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Ji)}},{key:"intersectsSprite",value:function(e){return Ji.center.set(0,0,0),Ji.radius=.7071067811865476,Ji.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ji)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if($i.x=r.normal.x>0?e.max.x:e.min.x,$i.y=r.normal.y>0?e.max.y:e.min.y,$i.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint($i)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}]),e}();function to(){var e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function no(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){var o=r.get(t);(!o||o.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var a=r.get(t);void 0===a?r.set(t,function(t,r){var i=t.array,o=t.usage,a=e.createBuffer();e.bindBuffer(r,a),e.bufferData(r,i,o),t.onUploadCallback();var s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121),{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):a.version<t.version&&(function(t,r,i){var o=r.array,a=r.updateRange;e.bindBuffer(i,t),-1===a.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):e.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(a.buffer,t,i),a.version=t.version)}}}}var ro=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(f.a)(this,t),(e=Object(u.a)(this,Object(c.a)(t).call(this))).type="PlaneGeometry",e.parameters={width:n,height:r,widthSegments:i,heightSegments:o};for(var a=n/2,s=r/2,l=Math.floor(i),h=Math.floor(o),d=l+1,p=h+1,m=n/l,g=r/h,_=[],v=[],y=[],b=[],E=0;E<p;E++)for(var x=E*g-s,T=0;T<d;T++){var S=T*m-a;v.push(S,-x,0),y.push(0,0,1),b.push(T/l),b.push(1-E/h)}for(var A=0;A<h;A++)for(var P=0;P<l;P++){var M=P+d*A,R=P+d*(A+1),C=P+1+d*(A+1),w=P+1+d*A;_.push(M,R,w),_.push(R,C,w)}return e.setIndex(_),e.setAttribute("position",new oi(v,3)),e.setAttribute("normal",new oi(y,3)),e.setAttribute("uv",new oi(b,2)),e}return Object(d.a)(t,e),t}(_i),io={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},oo={common:{diffuse:{value:new jr(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new pn},uv2Transform:{value:new pn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new fn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jr(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new pn}},sprite:{diffuse:{value:new jr(15658734)},opacity:{value:1},center:{value:new fn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new pn}}},ao={basic:{uniforms:ki([oo.common,oo.specularmap,oo.envmap,oo.aomap,oo.lightmap,oo.fog]),vertexShader:io.meshbasic_vert,fragmentShader:io.meshbasic_frag},lambert:{uniforms:ki([oo.common,oo.specularmap,oo.envmap,oo.aomap,oo.lightmap,oo.emissivemap,oo.fog,oo.lights,{emissive:{value:new jr(0)}}]),vertexShader:io.meshlambert_vert,fragmentShader:io.meshlambert_frag},phong:{uniforms:ki([oo.common,oo.specularmap,oo.envmap,oo.aomap,oo.lightmap,oo.emissivemap,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.fog,oo.lights,{emissive:{value:new jr(0)},specular:{value:new jr(1118481)},shininess:{value:30}}]),vertexShader:io.meshphong_vert,fragmentShader:io.meshphong_frag},standard:{uniforms:ki([oo.common,oo.envmap,oo.aomap,oo.lightmap,oo.emissivemap,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.roughnessmap,oo.metalnessmap,oo.fog,oo.lights,{emissive:{value:new jr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:io.meshphysical_vert,fragmentShader:io.meshphysical_frag},toon:{uniforms:ki([oo.common,oo.aomap,oo.lightmap,oo.emissivemap,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.gradientmap,oo.fog,oo.lights,{emissive:{value:new jr(0)}}]),vertexShader:io.meshtoon_vert,fragmentShader:io.meshtoon_frag},matcap:{uniforms:ki([oo.common,oo.bumpmap,oo.normalmap,oo.displacementmap,oo.fog,{matcap:{value:null}}]),vertexShader:io.meshmatcap_vert,fragmentShader:io.meshmatcap_frag},points:{uniforms:ki([oo.points,oo.fog]),vertexShader:io.points_vert,fragmentShader:io.points_frag},dashed:{uniforms:ki([oo.common,oo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:io.linedashed_vert,fragmentShader:io.linedashed_frag},depth:{uniforms:ki([oo.common,oo.displacementmap]),vertexShader:io.depth_vert,fragmentShader:io.depth_frag},normal:{uniforms:ki([oo.common,oo.bumpmap,oo.normalmap,oo.displacementmap,{opacity:{value:1}}]),vertexShader:io.normal_vert,fragmentShader:io.normal_frag},sprite:{uniforms:ki([oo.sprite,oo.fog]),vertexShader:io.sprite_vert,fragmentShader:io.sprite_frag},background:{uniforms:{uvTransform:{value:new pn},t2D:{value:null}},vertexShader:io.background_vert,fragmentShader:io.background_frag},cube:{uniforms:ki([oo.envmap,{opacity:{value:1}}]),vertexShader:io.cube_vert,fragmentShader:io.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:io.equirect_vert,fragmentShader:io.equirect_frag},distanceRGBA:{uniforms:ki([oo.common,oo.displacementmap,{referencePosition:{value:new xn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:io.distanceRGBA_vert,fragmentShader:io.distanceRGBA_frag},shadow:{uniforms:ki([oo.lights,oo.fog,{color:{value:new jr(0)},opacity:{value:1}}]),vertexShader:io.shadow_vert,fragmentShader:io.shadow_frag}};function so(e,t,n,r,i){var o,a,s=new jr(0),l=0,u=null,c=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return s},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),d(s,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){d(s,l=e)},render:function(n,i,f,p){var m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));var g=e.xr,_=g.getSession&&g.getSession();_&&"additive"===_.environmentBlendMode&&(m=null),null===m?d(s,l):m&&m.isColor&&(d(m,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===pe)?(void 0===a&&((a=new Fi(new Bi(1,1,1),new ji({name:"BackgroundCubeMaterial",uniforms:Ui(ao.cube.uniforms),vertexShader:ao.cube.vertexShader,fragmentShader:ao.cube.fragmentShader,side:T,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),m.isWebGLCubeRenderTarget&&(m=m.texture),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,u===m&&c===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===o&&((o=new Fi(new ro(2,2),new ji({name:"BackgroundMaterial",uniforms:Ui(ao.background.uniforms),vertexShader:ao.background.vertexShader,fragmentShader:ao.background.fragmentShader,side:x,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&c===m.version&&h===e.toneMapping||(o.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function lo(e,t,n,r){var i=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},l=d(null),u=l;function c(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],r=[],o=0;o<i;o++)t[o]=0,n[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function f(){for(var e=u.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function p(e){m(e,0)}function m(n,i){var o=u.newAttributes,a=u.enabledAttributes,s=u.attributeDivisors;(o[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==i)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function g(){for(var t=u.newAttributes,n=u.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function _(t,n,i,o,a,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,o,a,s):e.vertexAttribIPointer(t,n,i,a,s)}function v(){y(),u!==l&&c((u=l).object)}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,v,y){var b=!1;if(a){var E=function(t,n,i){var a=!0===i.wireframe,l=s[t.id];void 0===l&&(l={},s[t.id]=l);var u=l[n.id];void 0===u&&(u={},l[n.id]=u);var c=u[a];return void 0===c&&(c=d(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),u[a]=c),c}(v,h,l);u!==E&&c((u=E).object),(b=function(e,t){var n=u.attributes,r=e.attributes,i=0;for(var o in r){var a=n[o],s=r[o];if(void 0===a)return!0;if(a.attribute!==s)return!0;if(a.data!==s.data)return!0;i++}return u.attributesNum!==i||u.index!==t}(v,y))&&function(e,t){var n={},r=e.attributes,i=0;for(var o in r){var a=r[o],s={};s.attribute=a,a.data&&(s.data=a.data),n[o]=s,i++}u.attributes=n,u.attributesNum=i,u.index=t}(v,y)}else{var x=!0===l.wireframe;u.geometry===v.id&&u.program===h.id&&u.wireframe===x||(u.geometry=v.id,u.program=h.id,u.wireframe=x,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==y&&n.update(y,34963),b&&(function(i,o,a,s){if(!1!==r.isWebGL2||!i.isInstancedMesh&&!s.isInstancedBufferGeometry||null!==t.get("ANGLE_instanced_arrays")){f();var l=s.attributes,u=a.getAttributes(),c=o.defaultAttributeValues;for(var h in u){var d=u[h];if(d>=0){var v=l[h];if(void 0!==v){var y=v.normalized,b=v.itemSize,E=n.get(v);if(void 0===E)continue;var x=E.buffer,T=E.type,S=E.bytesPerElement;if(v.isInterleavedBufferAttribute){var A=v.data,P=A.stride,M=v.offset;A&&A.isInstancedInterleavedBuffer?(m(d,A.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=A.meshPerAttribute*A.count)):p(d),e.bindBuffer(34962,x),_(d,b,T,y,P*S,M*S)}else v.isInstancedBufferAttribute?(m(d,v.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=v.meshPerAttribute*v.count)):p(d),e.bindBuffer(34962,x),_(d,b,T,y,0,0)}else if("instanceMatrix"===h){var R=n.get(i.instanceMatrix);if(void 0===R)continue;var C=R.buffer,w=R.type;m(d+0,1),m(d+1,1),m(d+2,1),m(d+3,1),e.bindBuffer(34962,C),e.vertexAttribPointer(d+0,4,w,!1,64,0),e.vertexAttribPointer(d+1,4,w,!1,64,16),e.vertexAttribPointer(d+2,4,w,!1,64,32),e.vertexAttribPointer(d+3,4,w,!1,64,48)}else if("instanceColor"===h){var O=n.get(i.instanceColor);if(void 0===O)continue;var I=O.buffer,D=O.type;m(d,1),e.bindBuffer(34962,I),e.vertexAttribPointer(d,3,D,!1,12,0)}else if(void 0!==c){var L=c[h];if(void 0!==L)switch(L.length){case 2:e.vertexAttrib2fv(d,L);break;case 3:e.vertexAttrib3fv(d,L);break;case 4:e.vertexAttrib4fv(d,L);break;default:e.vertexAttrib1fv(d,L)}}}}g()}}(i,l,h,v),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:v,resetDefaultState:y,dispose:function(){for(var e in v(),s){var t=s[e];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var i in r)h(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:f,enableAttribute:p,disableUnusedAttributes:g}}function uo(e,t,n,r){var i,o=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=function(r,a,s){if(0!==s){var l,u;if(o)l=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](i,r,a,s),n.update(a,i,s)}}}function co(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),_=c>0,v=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:_,floatFragmentTextures:v,floatVertexTextures:_&&v,maxSamples:o?e.getParameter(36183):0}}function ho(e){var t=this,n=null,r=0,i=!1,o=!1,a=new Ar,s=new pn,l={value:null,needsUpdate:!1};function u(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,n,r,i){var o=null!==e?e.length:0,u=null;if(0!==o){if(u=l.value,!0!==i||null===u){var c=r+4*o,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,f=r;d!==o;++d,f+=4)a.copy(e[d]).applyMatrix4(h,s),a.normal.toArray(u,f),u[f+3]=a.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){var a=0!==e.length||t||0!==r||i;return i=t,n=c(e,o,0),r=e.length,a},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1,u()},this.setState=function(t,a,s){var h=t.clippingPlanes,d=t.clipIntersection,f=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||o&&!f)o?c(null):u();else{var m=o?0:r,g=4*m,_=p.clippingState||null;l.value=_,_=c(h,a,g,s);for(var v=0;v!==g;++v)_[v]=n[v];p.clippingState=_,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=m}}}function fo(e){var t=new WeakMap;function n(e,t){return t===de?e.mapping=ce:t===fe&&(e.mapping=he),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){var o=i.mapping;if(o===de||o===fe){if(t.has(i))return n(t.get(i).texture,i.mapping);var a=i.image;if(a&&a.height>0){var s=e.getRenderList(),l=e.getRenderTarget(),u=new Qi(a.height/2);return u.fromEquirectangularTexture(e,i),t.set(i,u),e.setRenderTarget(l),e.setRenderList(s),i.addEventListener("dispose",r),n(u.texture,i.mapping)}return null}}return i},dispose:function(){t=new WeakMap}}}function po(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function mo(e,t,n,r){var i={},o=new WeakMap;function a(e){var s=e.target;for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);s.removeEventListener("dispose",a),delete i[s.id];var u=o.get(s);u&&(t.remove(u),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,i=e.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],d=s[l+2];n.push(c,h,h,d,d,c)}}else{var f=i.array;a=i.version;for(var p=0,m=f.length/3-1;p<m;p+=3){var g=p+0,_=p+1,v=p+2;n.push(g,_,_,v,v,g)}}var y=new(si(n)>65535?ri:ti)(n,1);y.version=a;var b=o.get(e);b&&t.remove(b),o.set(e,y)}return{get:function(e,t){return!0===i[t.id]?t:(t.addEventListener("dispose",a),i[t.id]=!0,n.memory.geometries++,t)},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var i=e.morphAttributes;for(var o in i)for(var a=i[o],s=0,l=a.length;s<l;s++)t.update(a[s],34962)},getWireframeAttribute:function(e){var t=o.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return o.get(e)}}}function go(e,t,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,o,t*a),n.update(r,i,1)},this.renderInstances=function(r,l,u){if(0!==u){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](i,l,o,r*a,u),n.update(l,i,u)}}}function _o(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function vo(e,t){return e[0]-t[0]}function yo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function bo(e){for(var t={},n=new Float32Array(8),r=[],i=0;i<8;i++)r[i]=[i,0];return{update:function(i,o,a,s){var l=i.morphTargetInfluences,u=void 0===l?0:l.length,c=t[o.id];if(void 0===c){c=[];for(var h=0;h<u;h++)c[h]=[h,0];t[o.id]=c}for(var d=0;d<u;d++){var f=c[d];f[0]=d,f[1]=l[d]}c.sort(yo);for(var p=0;p<8;p++)p<u&&c[p][1]?(r[p][0]=c[p][0],r[p][1]=c[p][1]):(r[p][0]=Number.MAX_SAFE_INTEGER,r[p][1]=0);r.sort(vo);for(var m=a.morphTargets&&o.morphAttributes.position,g=a.morphNormals&&o.morphAttributes.normal,_=0,v=0;v<8;v++){var y=r[v],b=y[0],E=y[1];b!==Number.MAX_SAFE_INTEGER&&E?(m&&o.getAttribute("morphTarget"+v)!==m[b]&&o.setAttribute("morphTarget"+v,m[b]),g&&o.getAttribute("morphNormal"+v)!==g[b]&&o.setAttribute("morphNormal"+v,g[b]),n[v]=E,_+=E):(m&&!0===o.hasAttribute("morphTarget"+v)&&o.deleteAttribute("morphTarget"+v),g&&!0===o.hasAttribute("morphNormal"+v)&&o.deleteAttribute("morphNormal"+v),n[v]=0)}var x=o.morphTargetsRelative?1:1-_;s.getUniforms().setValue(e,"morphTargetBaseInfluence",x),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function Eo(e,t,n,r){var i=new WeakMap;function o(e){var t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var a=r.render.frame,s=e.geometry,l=t.get(e,s);return i.get(l)!==a&&(t.update(l),i.set(l,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}function xo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;_n.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=ye,this.minFilter=ye,this.wrapR=_e,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function To(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;_n.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=ye,this.minFilter=ye,this.wrapR=_e,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ao.physical={uniforms:ki([ao.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new fn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new jr(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:io.meshphysical_vert,fragmentShader:io.meshphysical_frag},xo.prototype=Object.create(_n.prototype),xo.prototype.constructor=xo,xo.prototype.isDataTexture2DArray=!0,To.prototype=Object.create(_n.prototype),To.prototype.constructor=To,To.prototype.isDataTexture3D=!0;var So=new _n,Ao=new xo,Po=new To,Mo=new qi,Ro=[],Co=[],wo=new Float32Array(16),Oo=new Float32Array(9),Io=new Float32Array(4);function Do(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,o=Ro[i];if(void 0===o&&(o=new Float32Array(i),Ro[i]=o),0!==t){r.toArray(o,0);for(var a=1,s=0;a!==t;++a)s+=n,e[a].toArray(o,s)}return o}function Lo(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Fo(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function No(e,t){var n=Co[t];void 0===n&&(n=new Int32Array(t),Co[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Bo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Uo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Lo(n,t))return;e.uniform2fv(this.addr,t),Fo(n,t)}}function ko(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Lo(n,t))return;e.uniform3fv(this.addr,t),Fo(n,t)}}function Vo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Lo(n,t))return;e.uniform4fv(this.addr,t),Fo(n,t)}}function Go(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Lo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Fo(n,t)}else{if(Lo(n,r))return;Io.set(r),e.uniformMatrix2fv(this.addr,!1,Io),Fo(n,r)}}function zo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Lo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Fo(n,t)}else{if(Lo(n,r))return;Oo.set(r),e.uniformMatrix3fv(this.addr,!1,Oo),Fo(n,r)}}function jo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Lo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Fo(n,t)}else{if(Lo(n,r))return;wo.set(r),e.uniformMatrix4fv(this.addr,!1,wo),Fo(n,r)}}function Ho(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||So,i)}function Wo(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Ao,i)}function Xo(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Po,i)}function Yo(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Mo,i)}function Ko(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function qo(e,t){var n=this.cache;Lo(n,t)||(e.uniform2iv(this.addr,t),Fo(n,t))}function Qo(e,t){var n=this.cache;Lo(n,t)||(e.uniform3iv(this.addr,t),Fo(n,t))}function Zo(e,t){var n=this.cache;Lo(n,t)||(e.uniform4iv(this.addr,t),Fo(n,t))}function Jo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function $o(e,t){e.uniform1fv(this.addr,t)}function ea(e,t){e.uniform1iv(this.addr,t)}function ta(e,t){e.uniform2iv(this.addr,t)}function na(e,t){e.uniform3iv(this.addr,t)}function ra(e,t){e.uniform4iv(this.addr,t)}function ia(e,t){var n=Do(t,this.size,2);e.uniform2fv(this.addr,n)}function oa(e,t){var n=Do(t,this.size,3);e.uniform3fv(this.addr,n)}function aa(e,t){var n=Do(t,this.size,4);e.uniform4fv(this.addr,n)}function sa(e,t){var n=Do(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function la(e,t){var n=Do(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ua(e,t){var n=Do(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ca(e,t,n){var r=t.length,i=No(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTexture2D(t[o]||So,i[o])}function ha(e,t,n){var r=t.length,i=No(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTextureCube(t[o]||Mo,i[o])}function da(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Bo;case 35664:return Uo;case 35665:return ko;case 35666:return Vo;case 35674:return Go;case 35675:return zo;case 35676:return jo;case 5124:case 35670:return Ko;case 35667:case 35671:return qo;case 35668:case 35672:return Qo;case 35669:case 35673:return Zo;case 5125:return Jo;case 35678:case 36198:case 36298:case 36306:case 35682:return Ho;case 35679:case 36299:case 36307:return Xo;case 35680:case 36300:case 36308:case 36293:return Yo;case 36289:case 36303:case 36311:case 36292:return Wo}}(t.type)}function fa(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return $o;case 35664:return ia;case 35665:return oa;case 35666:return aa;case 35674:return sa;case 35675:return la;case 35676:return ua;case 5124:case 35670:return ea;case 35667:case 35671:return ta;case 35668:case 35672:return na;case 35669:case 35673:return ra;case 35678:case 36198:case 36298:case 36306:case 35682:return ca;case 35680:case 36300:case 36308:case 36293:return ha}}(t.type)}function pa(e){this.id=e,this.seq=[],this.map={}}fa.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Fo(t,e)},pa.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(e,t[a.id],n)}};var ma=/(\w+)(\])?(\[|\.)?/g;function ga(e,t){e.seq.push(t),e.map[t.id]=t}function _a(e,t,n){var r=e.name,i=r.length;for(ma.lastIndex=0;;){var o=ma.exec(r),a=ma.lastIndex,s=o[1],l="]"===o[2],u=o[3];if(l&&(s|=0),void 0===u||"["===u&&a+2===i){ga(n,void 0===u?new da(s,e,t):new fa(s,e,t));break}var c=n.map[s];void 0===c&&ga(n,c=new pa(s)),n=c}}function va(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);_a(i,e.getUniformLocation(t,i.name),this)}}function ya(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}va.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},va.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},va.upload=function(e,t,n,r){for(var i=0,o=t.length;i!==o;++i){var a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}},va.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var o=e[r];o.id in t&&n.push(o)}return n};var ba=0;function Ea(e){switch(e){case jt:return["Linear","( value )"];case Ht:return["sRGB","( value )"];case Xt:return["RGBE","( value )"];case Kt:return["RGBM","( value, 7.0 )"];case qt:return["RGBM","( value, 16.0 )"];case Qt:return["RGBD","( value, 256.0 )"];case Wt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Yt:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function xa(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function Ta(e,t){var n=Ea(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Sa(e,t){var n=Ea(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Aa(e,t){var n;switch(t){case oe:n="Linear";break;case ae:n="Reinhard";break;case se:n="OptimizedCineon";break;case le:n="ACESFilmic";break;case ue:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Pa(e){return""!==e}function Ma(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ra(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Ca=/^[ \t]*#include +<([\w\d.\/]+)>/gm;function wa(e){return e.replace(Ca,Oa)}function Oa(e,t){var n=io[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return wa(n)}var Ia=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Da=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function La(e){return e.replace(Da,Na).replace(Ia,Fa)}function Fa(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Na(e,t,n,r)}function Na(e,t,n,r){for(var i="",o=parseInt(t);o<parseInt(n);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function Ba(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ua(e,t,n,r){var i,o,a=e.getContext(),s=n.defines,l=n.vertexShader,u=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===y?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===b?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===E&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ce:case he:t="ENVMAP_TYPE_CUBE";break;case pe:case me:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case he:case me:t="ENVMAP_MODE_REFRACTION"}return t}(n),f=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case te:t="ENVMAP_BLENDING_MULTIPLY";break;case ne:t="ENVMAP_BLENDING_MIX";break;case re:t="ENVMAP_BLENDING_ADD"}return t}(n),p=e.gammaFactor>0?e.gammaFactor:1,m=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Pa).join("\n")}(n),g=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),_=a.createProgram(),v=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[g].filter(Pa).join("\n")).length>0&&(i+="\n"),(o=[m,g].filter(Pa).join("\n")).length>0&&(o+="\n")):(i=[Ba(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Pa).join("\n"),o=[m,Ba(n),"#define SHADER_NAME "+n.shaderName,g,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ie?"#define TONE_MAPPING":"",n.toneMapping!==ie?io.tonemapping_pars_fragment:"",n.toneMapping!==ie?Aa("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",io.encodings_pars_fragment,n.map?Ta("mapTexelToLinear",n.mapEncoding):"",n.matcap?Ta("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Ta("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Ta("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Ta("lightMapTexelToLinear",n.lightMapEncoding):"",Sa("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Pa).join("\n")),l=Ra(l=Ma(l=wa(l),n),n),u=Ra(u=Ma(u=wa(u),n),n),l=La(l),u=La(u),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(v="#version 300 es\n",i=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,o=["#define varying in",n.glslVersion===an?"":"out highp vec4 pc_fragColor;",n.glslVersion===an?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o);var x,T,S=v+o+u,A=ya(a,35633,v+i+l),P=ya(a,35632,S);if(a.attachShader(_,A),a.attachShader(_,P),void 0!==n.index0AttributeName?a.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&a.bindAttribLocation(_,0,"position"),a.linkProgram(_),e.debug.checkShaderErrors){var M=a.getProgramInfoLog(_).trim(),R=a.getShaderInfoLog(A).trim(),C=a.getShaderInfoLog(P).trim(),w=!0,O=!0;if(!1===a.getProgramParameter(_,35714)){w=!1;var I=xa(a,A,"vertex"),D=xa(a,P,"fragment");console.error("THREE.WebGLProgram: shader error: ",a.getError(),"35715",a.getProgramParameter(_,35715),"gl.getProgramInfoLog",M,I,D)}else""!==M?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",M):""!==R&&""!==C||(O=!1);O&&(this.diagnostics={runnable:w,programLog:M,vertexShader:{log:R,prefix:i},fragmentShader:{log:C,prefix:o}})}return a.deleteShader(A),a.deleteShader(P),this.getUniforms=function(){return void 0===x&&(x=new va(a,_)),x},this.getAttributes=function(){return void 0===T&&(T=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var o=e.getActiveAttrib(t,i).name;n[o]=e.getAttribLocation(t,o)}return n}(a,_)),T},this.destroy=function(){r.releaseStatesOfProgram(this),a.deleteProgram(_),this.program=void 0},this.name=n.shaderName,this.id=ba++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=A,this.fragmentShader=P,this}function ka(e,t,n,r,i,o){var a=[],s=r.isWebGL2,l=r.logarithmicDepthBuffer,u=r.floatVertexTextures,c=r.maxVertexUniforms,h=r.vertexTextures,d=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){var t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=jt,t}return{getParameters:function(i,a,p,g,_){var v,y,b=g.fog,E=i.isMeshStandardMaterial?g.environment:null,x=t.get(i.envMap||E),A=f[i.type],P=_.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(u)return 1024;var n=c,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(_):0;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead."),A){var M=ao[A];v=M.vertexShader,y=M.fragmentShader}else v=i.vertexShader,y=i.fragmentShader;var R=e.getRenderTarget();return{isWebGL2:s,shaderID:A,shaderName:i.type,vertexShader:v,fragmentShader:y,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:h,outputEncoding:null!==R?m(R.texture):e.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(x.mapping===pe||x.mapping===me),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===en,tangentSpaceNormalMap:i.normalMapType===$t,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.displacementMap||!!i.transmissionMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap)&&!!i.displacementMap,fog:!!b,useFog:i.fog,fogExp2:b&&b.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:i.skinning&&P>0,maxBones:P,useVertexTexture:u,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:ie,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===S,flipSided:i.side===T,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);if(!1===t.isRawShaderMaterial){for(var i=0;i<p.length;i++)n.push(t[p[i]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=f[e.type];if(n){var r=ao[n];t=Vi.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,o=0,s=a.length;o<s;o++){var l=a[o];if(l.cacheKey===n){++(r=l).usedTimes;break}}return void 0===r&&(r=new Ua(e,n,t,i),a.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function Va(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ga(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function za(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ja(e){var t=[],n=0,r=[],i=[],o={id:-1};function a(r,i,a,s,l,u){var c=t[n],h=e.get(a);return void 0===c?(c={id:r.id,object:r,geometry:i,material:a,program:h.program||o,groupOrder:s,renderOrder:r.renderOrder,z:l,group:u},t[n]=c):(c.id=r.id,c.object=r,c.geometry=i,c.material=a,c.program=h.program||o,c.groupOrder=s,c.renderOrder=r.renderOrder,c.z=l,c.group=u),n++,c}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,t,n,o,s,l){var u=a(e,t,n,o,s,l);(!0===n.transparent?i:r).push(u)},unshift:function(e,t,n,o,s,l){var u=a(e,t,n,o,s,l);(!0===n.transparent?i:r).unshift(u)},finish:function(){for(var e=n,r=t.length;e<r;e++){var i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Ga),i.length>1&&i.sort(t||za)}}}function Ha(e){var t=new WeakMap;return{get:function(n,r){var i,o=t.get(n);return void 0===o?(i=new ja(e),t.set(n,new WeakMap),t.get(n).set(r,i)):void 0===(i=o.get(r))&&(i=new ja(e),o.set(r,i)),i},dispose:function(){t=new WeakMap}}}function Wa(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new xn,color:new jr};break;case"SpotLight":n={position:new xn,direction:new xn,color:new jr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new xn,color:new jr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new xn,skyColor:new jr,groundColor:new jr};break;case"RectAreaLight":n={color:new jr,position:new xn,halfWidth:new xn,halfHeight:new xn}}return e[t.id]=n,n}}}var Xa=0;function Ya(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ka(e,t){for(var n=new Wa,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new fn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},o=0;o<9;o++)i.probe.push(new xn);var a=new xn,s=new Qn,l=new Qn;return{setup:function(o){for(var a=0,s=0,l=0,u=0;u<9;u++)i.probe[u].set(0,0,0);var c=0,h=0,d=0,f=0,p=0,m=0,g=0,_=0;o.sort(Ya);for(var v=0,y=o.length;v<y;v++){var b=o[v],E=b.color,x=b.intensity,T=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)a+=E.r*x,s+=E.g*x,l+=E.b*x;else if(b.isLightProbe)for(var A=0;A<9;A++)i.probe[A].addScaledVector(b.sh.coefficients[A],x);else if(b.isDirectionalLight){var P=n.get(b);if(P.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){var M=b.shadow,R=r.get(b);R.shadowBias=M.bias,R.shadowNormalBias=M.normalBias,R.shadowRadius=M.radius,R.shadowMapSize=M.mapSize,i.directionalShadow[c]=R,i.directionalShadowMap[c]=S,i.directionalShadowMatrix[c]=b.shadow.matrix,m++}i.directional[c]=P,c++}else if(b.isSpotLight){var C=n.get(b);if(C.position.setFromMatrixPosition(b.matrixWorld),C.color.copy(E).multiplyScalar(x),C.distance=T,C.coneCos=Math.cos(b.angle),C.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),C.decay=b.decay,b.castShadow){var w=b.shadow,O=r.get(b);O.shadowBias=w.bias,O.shadowNormalBias=w.normalBias,O.shadowRadius=w.radius,O.shadowMapSize=w.mapSize,i.spotShadow[d]=O,i.spotShadowMap[d]=S,i.spotShadowMatrix[d]=b.shadow.matrix,_++}i.spot[d]=C,d++}else if(b.isRectAreaLight){var I=n.get(b);I.color.copy(E).multiplyScalar(x),I.halfWidth.set(.5*b.width,0,0),I.halfHeight.set(0,.5*b.height,0),i.rectArea[f]=I,f++}else if(b.isPointLight){var D=n.get(b);if(D.color.copy(b.color).multiplyScalar(b.intensity),D.distance=b.distance,D.decay=b.decay,b.castShadow){var L=b.shadow,F=r.get(b);F.shadowBias=L.bias,F.shadowNormalBias=L.normalBias,F.shadowRadius=L.radius,F.shadowMapSize=L.mapSize,F.shadowCameraNear=L.camera.near,F.shadowCameraFar=L.camera.far,i.pointShadow[h]=F,i.pointShadowMap[h]=S,i.pointShadowMatrix[h]=b.shadow.matrix,g++}i.point[h]=D,h++}else if(b.isHemisphereLight){var N=n.get(b);N.skyColor.copy(b.color).multiplyScalar(x),N.groundColor.copy(b.groundColor).multiplyScalar(x),i.hemi[p]=N,p++}}f>0&&(t.isWebGL2?(i.rectAreaLTC1=oo.LTC_FLOAT_1,i.rectAreaLTC2=oo.LTC_FLOAT_2):!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=oo.LTC_FLOAT_1,i.rectAreaLTC2=oo.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=oo.LTC_HALF_1,i.rectAreaLTC2=oo.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=s,i.ambient[2]=l;var B=i.hash;B.directionalLength===c&&B.pointLength===h&&B.spotLength===d&&B.rectAreaLength===f&&B.hemiLength===p&&B.numDirectionalShadows===m&&B.numPointShadows===g&&B.numSpotShadows===_||(i.directional.length=c,i.spot.length=d,i.rectArea.length=f,i.point.length=h,i.hemi.length=p,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=_,B.directionalLength=c,B.pointLength=h,B.spotLength=d,B.rectAreaLength=f,B.hemiLength=p,B.numDirectionalShadows=m,B.numPointShadows=g,B.numSpotShadows=_,i.version=Xa++)},setupView:function(e,t){for(var n=0,r=0,o=0,u=0,c=0,h=t.matrixWorldInverse,d=0,f=e.length;d<f;d++){var p=e[d];if(p.isDirectionalLight){var m=i.directional[n];m.direction.setFromMatrixPosition(p.matrixWorld),a.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(a),m.direction.transformDirection(h),n++}else if(p.isSpotLight){var g=i.spot[o];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),g.direction.setFromMatrixPosition(p.matrixWorld),a.setFromMatrixPosition(p.target.matrixWorld),g.direction.sub(a),g.direction.transformDirection(h),o++}else if(p.isRectAreaLight){var _=i.rectArea[u];_.position.setFromMatrixPosition(p.matrixWorld),_.position.applyMatrix4(h),l.identity(),s.copy(p.matrixWorld),s.premultiply(h),l.extractRotation(s),_.halfWidth.set(.5*p.width,0,0),_.halfHeight.set(0,.5*p.height,0),_.halfWidth.applyMatrix4(l),_.halfHeight.applyMatrix4(l),u++}else if(p.isPointLight){var v=i.point[r];v.position.setFromMatrixPosition(p.matrixWorld),v.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){var y=i.hemi[c];y.direction.setFromMatrixPosition(p.matrixWorld),y.direction.transformDirection(h),y.direction.normalize(),c++}}},state:i}}function qa(e,t){var n=new Ka(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Qa(e,t){var n=new WeakMap;return{get:function(r){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(i=new qa(e,t),n.set(r,[]),n.get(r).push(i)):o>=n.get(r).length?(i=new qa(e,t),n.get(r).push(i)):i=n.get(r)[o],i},dispose:function(){n=new WeakMap}}}function Za(e){Xr.call(this),this.type="MeshDepthMaterial",this.depthPacking=Zt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Ja(e){Xr.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new xn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Za.prototype=Object.create(Xr.prototype),Za.prototype.constructor=Za,Za.prototype.isMeshDepthMaterial=!0,Za.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Ja.prototype=Object.create(Xr.prototype),Ja.prototype.constructor=Ja,Ja.prototype.isMeshDistanceMaterial=!0,Ja.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var $a="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",es="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function ts(e,t,n){var r=new eo,i=new fn,o=new fn,a=new yn,s=[],l=[],u={},c={0:T,1:x,2:S},h=new ji({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new fn},radius:{value:4}},vertexShader:es,fragmentShader:$a}),d=h.clone();d.defines.HORIZONTAL_PASS=1;var f=new _i;f.setAttribute("position",new Qr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var p=new Fi(f,h),m=this;function g(n,r){var i=t.update(p);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,p,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,d,p,null)}function _(e,t,n){var r=e<<0|t<<1|n<<2,i=s[r];return void 0===i&&(i=new Za({depthPacking:Jt,morphTargets:e,skinning:t}),s[r]=i),i}function v(e,t,n){var r=e<<0|t<<1|n<<2,i=l[r];return void 0===i&&(i=new Ja({morphTargets:e,skinning:t}),l[r]=i),i}function b(t,n,r,i,o,a,s){var l=null,h=_,d=t.customDepthMaterial;if(!0===i.isPointLight&&(h=v,d=t.customDistanceMaterial),void 0===d){var f=!1;!0===r.morphTargets&&(f=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);var p=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=h(f,p,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var m=l.uuid,g=r.uuid,y=u[m];void 0===y&&(y={},u[m]=y);var b=y[g];void 0===b&&(b=l.clone(),y[g]=b),l=b}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=s===E?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:c[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function P(n,i,o,a,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===E)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var c=l.groups,h=0,d=c.length;h<d;h++){var f=c[h],p=u[f.materialIndex];if(p&&p.visible){var m=b(n,l,p,a,o.near,o.far,s);e.renderBufferDirect(o,null,l,m,n,f)}}else if(u.visible){var g=b(n,l,u,a,o.near,o.far,s);e.renderBufferDirect(o,null,l,g,n,null)}}for(var _=n.children,v=0,y=_.length;v<y;v++)P(_[v],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=y,this.render=function(t,s,l){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(A),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=0,p=t.length;f<p;f++){var _=t[f],v=_.shadow;if(void 0!==v){if(!1!==v.autoUpdate||!1!==v.needsUpdate){i.copy(v.mapSize);var y=v.getFrameExtents();if(i.multiply(y),o.copy(v.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(o.x=Math.floor(n/y.x),i.x=o.x*y.x,v.mapSize.x=o.x),i.y>n&&(o.y=Math.floor(n/y.y),i.y=o.y*y.y,v.mapSize.y=o.y)),null===v.map&&!v.isPointLightShadow&&this.type===E){var b={minFilter:xe,magFilter:xe,format:ke};v.map=new bn(i.x,i.y,b),v.map.texture.name=_.name+".shadowMap",v.mapPass=new bn(i.x,i.y,b),v.camera.updateProjectionMatrix()}if(null===v.map){var x={minFilter:ye,magFilter:ye,format:ke};v.map=new bn(i.x,i.y,x),v.map.texture.name=_.name+".shadowMap",v.camera.updateProjectionMatrix()}e.setRenderTarget(v.map),e.clear();for(var T=v.getViewportCount(),S=0;S<T;S++){var M=v.getViewport(S);a.set(o.x*M.x,o.y*M.y,o.x*M.z,o.y*M.w),d.viewport(a),v.updateMatrices(_,S),r=v.getFrustum(),P(s,l,v.camera,_,this.type)}v.isPointLightShadow||this.type!==E||g(v,l),v.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",_,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function ns(e,t,n){var r,i,o=n.isWebGL2;var a=new function(){var t=!1,n=new yn,r=null,i=new yn(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,a,s){!0===s&&(t*=a,r*=a,o*=a),n.set(t,r,o,a),!1===i.equals(n)&&(e.clearColor(t,r,o,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},l=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?_e(2929):ve(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case Y:e.depthFunc(512);break;case K:e.depthFunc(519);break;case q:e.depthFunc(513);break;case Q:e.depthFunc(515);break;case Z:e.depthFunc(514);break;case J:e.depthFunc(518);break;case $:e.depthFunc(516);break;case ee:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},u=new function(){var t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?_e(2960):ve(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&o===a||(e.stencilFunc(t,n,a),r=t,i=n,o=a)},setOp:function(t,n,r){a===t&&s===n&&l===r||(e.stencilOp(t,n,r),a=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,u=null}}},c={},h=null,d=null,f=null,p=null,m=null,y=null,b=null,E=null,x=null,te=!1,ne=null,re=null,ie=null,oe=null,ae=null,se=e.getParameter(35661),le=!1,ue=0,ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(ue=parseFloat(/^WebGL (\d)/.exec(ce)[1]),le=ue>=1):-1!==ce.indexOf("OpenGL ES")&&(ue=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),le=ue>=2);var he=null,de={},fe=new yn,pe=new yn;function me(t,n,r){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var a=0;a<r;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,i);return o}var ge={};function _e(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function ve(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}ge[3553]=me(3553,3553,1),ge[34067]=me(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),u.setClear(0),_e(2929),l.setFunc(Q),Te(!1),Se(_),_e(2884),xe(A);var ye=(r={},Object(s.a)(r,O,32774),Object(s.a)(r,I,32778),Object(s.a)(r,D,32779),r);if(o)ye[L]=32775,ye[F]=32776;else{var be=t.get("EXT_blend_minmax");null!==be&&(ye[L]=be.MIN_EXT,ye[F]=be.MAX_EXT)}var Ee=(i={},Object(s.a)(i,N,0),Object(s.a)(i,B,1),Object(s.a)(i,U,768),Object(s.a)(i,V,770),Object(s.a)(i,X,776),Object(s.a)(i,H,774),Object(s.a)(i,z,772),Object(s.a)(i,k,769),Object(s.a)(i,G,771),Object(s.a)(i,W,775),Object(s.a)(i,j,773),i);function xe(t,n,r,i,o,a,s,l){if(t!==A){if(d||(_e(3042),d=!0),t===w)o=o||n,a=a||r,s=s||i,n===p&&o===b||(e.blendEquationSeparate(ye[n],ye[o]),p=n,b=o),r===m&&i===y&&a===E&&s===x||(e.blendFuncSeparate(Ee[r],Ee[i],Ee[a],Ee[s]),m=r,y=i,E=a,x=s),f=t,te=null;else if(t!==f||l!==te){if(p===O&&b===O||(e.blendEquation(32774),p=O,b=O),l)switch(t){case P:e.blendFuncSeparate(1,771,1,771);break;case M:e.blendFunc(1,1);break;case R:e.blendFuncSeparate(0,0,769,771);break;case C:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case P:e.blendFuncSeparate(770,771,1,771);break;case M:e.blendFunc(770,1);break;case R:e.blendFunc(0,769);break;case C:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,y=null,E=null,x=null,f=t,te=l}}else d&&(ve(3042),d=!1)}function Te(t){ne!==t&&(t?e.frontFace(2304):e.frontFace(2305),ne=t)}function Se(t){t!==g?(_e(2884),t!==re&&(t===_?e.cullFace(1029):t===v?e.cullFace(1028):e.cullFace(1032))):ve(2884),re=t}function Ae(t,n,r){t?(_e(32823),oe===n&&ae===r||(e.polygonOffset(n,r),oe=n,ae=r)):ve(32823)}function Pe(t){void 0===t&&(t=33984+se-1),he!==t&&(e.activeTexture(t),he=t)}return{buffers:{color:a,depth:l,stencil:u},enable:_e,disable:ve,useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:xe,setMaterial:function(e,t){e.side===S?ve(2884):_e(2884);var n=e.side===T;t&&(n=!n),Te(n),e.blending===P&&!1===e.transparent?xe(A):xe(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),l.setFunc(e.depthFunc),l.setTest(e.depthTest),l.setMask(e.depthWrite),a.setMask(e.colorWrite);var r=e.stencilWrite;u.setTest(r),r&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ae(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Te,setCullFace:Se,setLineWidth:function(t){t!==ie&&(le&&e.lineWidth(t),ie=t)},setPolygonOffset:Ae,setScissorTest:function(e){e?_e(3089):ve(3089)},activeTexture:Pe,bindTexture:function(t,n){null===he&&Pe();var r=de[he];void 0===r&&(r={type:void 0,texture:void 0},de[he]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ge[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=de[he];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===pe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),pe.copy(t))},reset:function(){c={},he=null,de={},h=null,d=null,f=null,p=null,m=null,y=null,b=null,E=null,x=null,te=!1,ne=null,re=null,ie=null,oe=null,ae=null,a.reset(),l.reset(),u.reset()}}}function rs(e,t,n,r,i,o,a){var l,u,c,h=i.isWebGL2,d=i.maxTextures,f=i.maxCubemapSize,p=i.maxTextureSize,m=i.maxSamples,g=new WeakMap,_=!1;try{_="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(G){}function v(e,t){return _?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function y(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var o=t?dn.floorPowerOfTwo:Math.floor,a=o(i*e.width),s=o(i*e.height);void 0===c&&(c=v(a,s));var l=n?v(a,s):c;return l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return dn.isPowerOfTwo(e.width)&&dn.isPowerOfTwo(e.height)}function E(e,t){return e.generateMipmaps&&t&&e.minFilter!==ye&&e.minFilter!==xe}function x(t,n,i,o){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function T(n,r,i){if(!1===h)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=r;return 6403===r&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===r&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===r&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function S(e){return e===ye||e===be||e===Ee?9728:9729}function A(t){var n=t.target;n.removeEventListener("dispose",A),function(t){var n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&g.delete(n),a.memory.textures--}function P(t){var n=t.target;n.removeEventListener("dispose",P),function(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var o=0;o<6;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}(n),a.memory.textures--}var M=0;function R(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=a.render.frame;g.get(e)!==t&&(g.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var o=e.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void L(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function C(t,i){var a=r.get(t);t.version>0&&a.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;D(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);for(var a=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,l=[],u=0;u<6;u++)l[u]=a||s?s?r.image[u].image:r.image[u]:y(r.image[u],!1,!0,f);var c,d=l[0],p=b(d)||h,m=o.convert(r.format),g=o.convert(r.type),_=T(r.internalFormat,m,g);if(I(34067,r,p),a){for(var v=0;v<6;v++){c=l[v].mipmaps;for(var S=0;S<c.length;S++){var A=c[S];r.format!==ke&&r.format!==Ue?null!==m?n.compressedTexImage2D(34069+v,S,_,A.width,A.height,0,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+v,S,_,A.width,A.height,0,m,g,A.data)}}t.__maxMipLevel=c.length-1}else{c=r.mipmaps;for(var P=0;P<6;P++)if(s){n.texImage2D(34069+P,0,_,l[P].width,l[P].height,0,m,g,l[P].data);for(var M=0;M<c.length;M++){var R=c[M],C=R.image[P].image;n.texImage2D(34069+P,M+1,_,C.width,C.height,0,m,g,C.data)}}else{n.texImage2D(34069+P,0,_,m,g,l[P]);for(var w=0;w<c.length;w++){var O=c[w];n.texImage2D(34069+P,w+1,_,m,g,O.image[P])}}t.__maxMipLevel=c.length}E(r,p)&&x(34067,r,d.width,d.height);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(a,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,a.__webglTexture))}var w=(l={},Object(s.a)(l,ge,10497),Object(s.a)(l,_e,33071),Object(s.a)(l,ve,33648),l),O=(u={},Object(s.a)(u,ye,9728),Object(s.a)(u,be,9984),Object(s.a)(u,Ee,9986),Object(s.a)(u,xe,9729),Object(s.a)(u,Te,9985),Object(s.a)(u,Se,9987),u);function I(n,o,a){a?(e.texParameteri(n,10242,w[o.wrapS]),e.texParameteri(n,10243,w[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,w[o.wrapR]),e.texParameteri(n,10240,O[o.magFilter]),e.texParameteri(n,10241,O[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===_e&&o.wrapT===_e||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,S(o.magFilter)),e.texParameteri(n,10241,S(o.minFilter)),o.minFilter!==ye&&o.minFilter!==xe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(o.type===Oe&&null===t.get("OES_texture_float_linear"))return;if(o.type===Ie&&null===(h||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function D(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",A),t.__webglTexture=e.createTexture(),a.memory.textures++)}function L(t,r,i){var a=3553;r.isDataTexture2DArray&&(a=35866),r.isDataTexture3D&&(a=32879),D(t,r),n.activeTexture(33984+i),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var s,l=function(e){return!h&&(e.wrapS!==_e||e.wrapT!==_e||e.minFilter!==ye&&e.minFilter!==xe)}(r)&&!1===b(r.image),u=y(r.image,l,!1,p),c=b(u)||h,d=o.convert(r.format),f=o.convert(r.type),m=T(r.internalFormat,d,f);I(a,r,c);var g=r.mipmaps;if(r.isDepthTexture)m=6402,h?m=r.type===Oe?36012:r.type===we?33190:r.type===Ne?35056:33189:r.type===Oe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===ze&&6402===m&&r.type!==Re&&r.type!==we&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Re,f=o.convert(r.type)),r.format===je&&6402===m&&(m=34041,r.type!==Ne&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Ne,f=o.convert(r.type))),n.texImage2D(3553,0,m,u.width,u.height,0,d,f,null);else if(r.isDataTexture)if(g.length>0&&c){for(var _=0,v=g.length;_<v;_++)s=g[_],n.texImage2D(3553,_,m,s.width,s.height,0,d,f,s.data);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,u.width,u.height,0,d,f,u.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(var S=0,A=g.length;S<A;S++)s=g[S],r.format!==ke&&r.format!==Ue?null!==d?n.compressedTexImage2D(3553,S,m,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,S,m,s.width,s.height,0,d,f,s.data);t.__maxMipLevel=g.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,u.width,u.height,u.depth,0,d,f,u.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,u.width,u.height,u.depth,0,d,f,u.data),t.__maxMipLevel=0;else if(g.length>0&&c){for(var P=0,M=g.length;P<M;P++)s=g[P],n.texImage2D(3553,P,m,d,f,s);r.generateMipmaps=!1,t.__maxMipLevel=g.length-1}else n.texImage2D(3553,0,m,d,f,u),t.__maxMipLevel=0;E(r,c)&&x(a,r,u.width,u.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function F(t,i,a,s){var l=o.convert(i.texture.format),u=o.convert(i.texture.type),c=T(i.texture.internalFormat,l,u);n.texImage2D(s,0,c,i.width,i.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function N(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var i=33189;if(r){var a=n.depthTexture;a&&a.isDepthTexture&&(a.type===Oe?i=36012:a.type===we&&(i=33190));var s=U(n);e.renderbufferStorageMultisample(36161,s,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){var l=U(n);e.renderbufferStorageMultisample(36161,l,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var u=o.convert(n.texture.format),c=o.convert(n.texture.type),h=T(n.texture.internalFormat,u,c);if(r){var d=U(n);e.renderbufferStorageMultisample(36161,d,h,n.width,n.height)}else e.renderbufferStorage(36161,h,n.width,n.height)}e.bindRenderbuffer(36161,null)}function B(t){var n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),R(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===ze)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==je)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(36160,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=e.createRenderbuffer(),N(n.__webglDepthbuffer[o],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),N(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function U(e){return h&&e.isWebGLMultisampleRenderTarget?Math.min(m,e.samples):0}var k=!1,V=!1;this.allocateTextureUnit=function(){var e=M;return e>=d&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+d),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=R,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?L(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?L(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=C,this.setupRenderTarget=function(t){var i=r.get(t),s=r.get(t.texture);t.addEventListener("dispose",P),s.__webglTexture=e.createTexture(),a.memory.textures++;var l=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,c=b(t)||h;if(!h||t.texture.format!==Ue||t.texture.type!==Oe&&t.texture.type!==Ie||(t.texture.format=ke,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){i.__webglFramebuffer=[];for(var d=0;d<6;d++)i.__webglFramebuffer[d]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),u)if(h){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);var f=o.convert(t.texture.format),p=o.convert(t.texture.type),m=T(t.texture.internalFormat,f,p),g=U(t);e.renderbufferStorageMultisample(36161,g,m,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),N(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,s.__webglTexture),I(34067,t.texture,c);for(var _=0;_<6;_++)F(i.__webglFramebuffer[_],t,36064,34069+_);E(t.texture,c)&&x(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,s.__webglTexture),I(3553,t.texture,c),F(i.__webglFramebuffer,t,36064,3553),E(t.texture,c)&&x(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&B(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(E(t,b(e)||h)){var i=e.isWebGLCubeRenderTarget?34067:3553,o=r.get(t).__webglTexture;n.bindTexture(i,o),x(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(h){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,o=t.height,a=16384;t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024),e.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),R(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===V&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),V=!0),e=e.texture),C(e,t)}}function is(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===Ae)return 5121;if(e===De)return 32819;if(e===Le)return 32820;if(e===Fe)return 33635;if(e===Pe)return 5120;if(e===Me)return 5122;if(e===Re)return 5123;if(e===Ce)return 5124;if(e===we)return 5125;if(e===Oe)return 5126;if(e===Ie)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(e===Be)return 6406;if(e===Ue)return 6407;if(e===ke)return 6408;if(e===Ve)return 6409;if(e===Ge)return 6410;if(e===ze)return 6402;if(e===je)return 34041;if(e===He)return 6403;if(e===We)return 36244;if(e===Xe)return 33319;if(e===Ye)return 33320;if(e===Ke)return 36248;if(e===qe)return 36249;if(e===Qe||e===Ze||e===Je||e===$e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===Qe)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ze)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Je)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===$e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===nt||e===rt){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===et)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===rt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===it)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===ot||e===at)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(e===ot)return n.COMPRESSED_RGB8_ETC2;if(e===at)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===st||e===lt||e===ut||e===ct||e===ht||e===dt||e===ft||e===pt||e===mt||e===gt||e===_t||e===vt||e===yt||e===bt||e===xt||e===Tt||e===St||e===At||e===Pt||e===Mt||e===Rt||e===Ct||e===wt||e===Ot||e===It||e===Dt||e===Lt||e===Ft?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Et?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:e===Ne?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function os(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Wi.call(this),this.cameras=e}function as(){Er.call(this),this.type="Group"}function ss(){this._targetRay=null,this._grip=null,this._hand=null}function ls(e,t){var n=this,r=null,a=1,s=null,l="local-floor",u=null,c=[],h=new Map,d=new Wi;d.layers.enable(1),d.viewport=new yn;var f=new Wi;f.layers.enable(2),f.viewport=new yn;var p=[d,f],m=new os;m.layers.enable(1),m.layers.enable(2);var g=null,_=null;function v(e){var t=h.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){h.forEach(function(e,t){e.disconnect(t)}),h.clear(),g=null,_=null,e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),A.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function b(e){for(var t=r.inputSources,n=0;n<c.length;n++)h.set(t[n],c[n]);for(var i=0;i<e.removed.length;i++){var o=e.removed[i],a=h.get(o);a&&(a.dispatchEvent({type:"disconnected",data:o}),h.delete(o))}for(var s=0;s<e.added.length;s++){var l=e.added[s],u=h.get(l);u&&u.dispatchEvent({type:"connected",data:l})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=c[e];return void 0===t&&(t=new ss,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){var t=c[e];return void 0===t&&(t=new ss,c[e]=t),t.getGripSpace()},this.getHand=function(e){var t=c[e];return void 0===t&&(t=new ss,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){l=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getSession=function(){return r},this.setSession=function(){var e,u=(e=i.a.mark(function e(o){var u,c,h;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=o)){e.next=24;break}if(r.addEventListener("select",v),r.addEventListener("selectstart",v),r.addEventListener("selectend",v),r.addEventListener("squeeze",v),r.addEventListener("squeezestart",v),r.addEventListener("squeezeend",v),r.addEventListener("end",y),r.addEventListener("inputsourceschange",b),!0===(u=t.getContextAttributes()).xrCompatible){e.next=14;break}return e.next=14,t.makeXRCompatible();case 14:return c={antialias:u.antialias,alpha:u.alpha,depth:u.depth,stencil:u.stencil,framebufferScaleFactor:a},h=new XRWebGLLayer(r,t,c),r.updateRenderState({baseLayer:h}),e.next=19,r.requestReferenceSpace(l);case 19:s=e.sent,A.setContext(r),A.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"});case 24:case"end":return e.stop()}},e)}),function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,l,"next",e)}function l(e){o(a,r,i,s,l,"throw",e)}s(void 0)})});return function(e){return u.apply(this,arguments)}}();var E=new xn,x=new xn;function T(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){m.near=f.near=d.near=e.near,m.far=f.far=d.far=e.far,g===m.near&&_===m.far||(r.updateRenderState({depthNear:m.near,depthFar:m.far}),g=m.near,_=m.far);var t=e.parent,n=m.cameras;T(m,t);for(var i=0;i<n.length;i++)T(n[i],t);e.matrixWorld.copy(m.matrixWorld),e.matrix.copy(m.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);for(var o=e.children,a=0,s=o.length;a<s;a++)o[a].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){E.setFromMatrixPosition(t.matrixWorld),x.setFromMatrixPosition(n.matrixWorld);var r=E.distanceTo(x),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(o[8]+1)/o[0],d=a*c,f=a*h,p=r/(-c+h),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var g=a+p,_=s+p,v=d-m,y=f+(r-m),b=l*s/_*g,T=u*s/_*g;e.projectionMatrix.makePerspective(v,y,b,T,g,_)}(m,d,f):m.projectionMatrix.copy(d.projectionMatrix),m};var S=null;var A=new to;A.setAnimationLoop(function(t,n){if(null!==(u=n.getViewerPose(s))){var i=u.views,o=r.renderState.baseLayer;e.setFramebuffer(o.framebuffer);var a=!1;i.length!==m.cameras.length&&(m.cameras.length=0,a=!0);for(var l=0;l<i.length;l++){var h=i[l],d=o.getViewport(h),f=p[l];f.matrix.fromArray(h.transform.matrix),f.projectionMatrix.fromArray(h.projectionMatrix),f.viewport.set(d.x,d.y,d.width,d.height),0===l&&m.matrix.copy(f.matrix),!0===a&&m.cameras.push(f)}}for(var g=r.inputSources,_=0;_<c.length;_++){var v=c[_],y=g[_];v.update(y,n,s)}S&&S(t,n)}),this.setAnimationLoop=function(e){S=e},this.dispose=function(){}}function us(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);var r,i,o=e.get(n).envMap;if(o){t.envMap.value=o,t.flipEnvMap.value=o.isCubeTexture&&o._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;var a=e.get(o).__maxMipLevel;void 0!==a&&(t.maxMipLevel.value=a)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?i=n.aoMap:n.lightMap&&(i=n.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uv2Transform.value.copy(i.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===T&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===T&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===T&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===T&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===T&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===T&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===T&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,r):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===T&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===T&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===T&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===T&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){var i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){var n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function cs(e){var t=void 0!==(e=e||{}).canvas?e.canvas:function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,d=null,f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=jt,this.physicallyCorrectLights=!1,this.toneMapping=ie,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p=this,m=!1,g=null,_=0,v=0,y=null,b=null,E=-1,x=null,T=new yn,S=new yn,A=null,P=t.width,M=t.height,R=1,C=null,w=null,O=new yn(0,0,P,M),I=new yn(0,0,P,M),D=!1,L=new eo,F=!1,N=!1,B=new Qn,U=new xn,k={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===y?R:1}var G,z,j,H,W,X,Y,K,q,Q,Z,J,$,ee,te,ne,re,oe,ae,se,le,ue=n;function ce(e,n){for(var r=0;r<e.length;r++){var i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{var he={alpha:r,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",_e,!1),null===ue){var de=["webgl2","webgl","experimental-webgl"];if(!0===p.isWebGL1Renderer&&de.shift(),null===(ue=ce(de,he)))throw ce(de)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Me){throw console.error("THREE.WebGLRenderer: "+Me.message),Me}function fe(){G=new po(ue),z=new co(ue,G,e),G.init(z),se=new is(ue,G,z),(j=new ns(ue,G,z)).scissor(S.copy(I).multiplyScalar(R).floor()),j.viewport(T.copy(O).multiplyScalar(R).floor()),H=new _o(ue),W=new Va,X=new rs(ue,G,j,W,z,se,H),Y=new fo(p),K=new no(ue,z),le=new lo(ue,G,K,z),q=new mo(ue,K,H,le),Q=new Eo(ue,q,K,H),re=new bo(ue),te=new ho(W),Z=new ka(p,Y,G,z,le,te),J=new us(W),$=new Ha(W),ee=new Qa(G,z),ne=new so(p,Y,j,Q,s),oe=new uo(ue,G,H,z),ae=new go(ue,G,H,z),H.programs=Z.programs,p.capabilities=z,p.extensions=G,p.properties=W,p.renderLists=$,p.state=j,p.info=H}fe();var pe=new ls(p,ue);this.xr=pe;var me=new ts(p,Q,z.maxTextureSize);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,fe()}function ve(e){var t=e.target;t.removeEventListener("dispose",ve),function(e){ye(e),W.remove(e)}(t)}function ye(e){var t=W.get(e).program;void 0!==t&&Z.releaseProgram(t)}this.shadowMap=me,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){var e=G.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=G.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return R},this.setPixelRatio=function(e){void 0!==e&&(R=e,this.setSize(P,M,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new fn),e.set(P,M)},this.setSize=function(e,n,r){pe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=e,M=n,t.width=Math.floor(e*R),t.height=Math.floor(n*R),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new fn),e.set(P*R,M*R).floor()},this.setDrawingBufferSize=function(e,n,r){P=e,M=n,R=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new yn),e.copy(T)},this.getViewport=function(e){return e.copy(O)},this.setViewport=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),j.viewport(T.copy(O).multiplyScalar(R).floor())},this.getScissor=function(e){return e.copy(I)},this.setScissor=function(e,t,n,r){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,n,r),j.scissor(S.copy(I).multiplyScalar(R).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){j.setScissorTest(D=e)},this.setOpaqueSort=function(e){C=e},this.setTransparentSort=function(e){w=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new jr),e.copy(ne.getClearColor())},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),ue.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",_e,!1),$.dispose(),ee.dispose(),W.dispose(),Y.dispose(),Q.dispose(),le.dispose(),pe.dispose(),Ee.stop()},this.renderBufferImmediate=function(e,t){le.initAttributes();var n=W.get(e);e.hasPositions&&!n.position&&(n.position=ue.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ue.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ue.createBuffer()),e.hasColors&&!n.color&&(n.color=ue.createBuffer());var r=t.getAttributes();e.hasPositions&&(ue.bindBuffer(34962,n.position),ue.bufferData(34962,e.positionArray,35048),le.enableAttribute(r.position),ue.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(ue.bindBuffer(34962,n.normal),ue.bufferData(34962,e.normalArray,35048),le.enableAttribute(r.normal),ue.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(ue.bindBuffer(34962,n.uv),ue.bufferData(34962,e.uvArray,35048),le.enableAttribute(r.uv),ue.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(ue.bindBuffer(34962,n.color),ue.bufferData(34962,e.colorArray,35048),le.enableAttribute(r.color),ue.vertexAttribPointer(r.color,3,5126,!1,0,0)),le.disableUnusedAttributes(),ue.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=k);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Pe(e,t,r,i);j.setMaterial(r,a);var l=n.index,u=n.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;var c,h=1;!0===r.wireframe&&(l=q.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&re.update(i,n,r,s),le.setup(i,r,s,n,l);var d=oe;null!==l&&(c=K.get(l),(d=ae).setIndex(c));var f=null!==l?l.count:u.count,p=n.drawRange.start*h,m=n.drawRange.count*h,g=null!==o?o.start*h:0,_=null!==o?o.count*h:1/0,v=Math.max(p,g),y=Math.min(f,p+m,g+_)-1,b=Math.max(0,y-v+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*V()),d.setMode(1)):d.setMode(4);else if(i.isLine){var E=r.linewidth;void 0===E&&(E=1),j.setLineWidth(E*V()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(v,b,i.count);else if(n.isInstancedBufferGeometry){var x=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(v,b,x)}else d.render(v,b)}},this.compile=function(e,t){(d=ee.get(e)).init(),e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))}),d.setupLights();var n=new WeakMap;e.traverse(function(t){var r=t.material;if(r)if(Array.isArray(r))for(var i=0;i<r.length;i++){var o=r[i];!1===n.has(o)&&(Se(o,e,t),n.set(o))}else!1===n.has(r)&&(Se(r,e,t),n.set(r))})};var be=null;var Ee=new to;function xe(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,o=e.length;i<o;i++){var a=e[i],s=a.object,l=a.geometry,u=null===r?a.material:r,c=a.group;if(n.isArrayCamera)for(var h=n.cameras,f=0,p=h.length;f<p;f++){var m=h[f];s.layers.test(m.layers)&&(j.viewport(T.copy(m.viewport)),d.setupLightsView(m),Te(s,t,m,l,u,c))}else Te(s,t,n,l,u,c)}}function Te(e,t,n,r,i,o){if(e.onBeforeRender(p,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var a=Pe(n,t,i,e);j.setMaterial(i),le.reset(),function(e,t){e.render(function(e){p.renderBufferImmediate(e,t)})}(e,a)}else p.renderBufferDirect(n,t,r,i,e,o);e.onAfterRender(p,t,n,r,i,o)}function Se(e,t,n){!0!==t.isScene&&(t=k);var r=W.get(e),i=d.state.lights,o=d.state.shadowsArray,a=i.state.version,s=Z.getParameters(e,i.state,o,t,n),l=Z.getProgramCacheKey(s),u=r.program,c=!0;if(r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=Y.get(e.envMap||r.environment),void 0===u)e.addEventListener("dispose",ve);else if(u.cacheKey!==l)ye(e);else if(r.lightsStateVersion!==a)c=!1;else{if(void 0!==s.shaderID)return;c=!1}c&&(s.uniforms=Z.getUniforms(e),e.onBeforeCompile(s,p),u=Z.acquireProgram(s,l),r.program=u,r.uniforms=s.uniforms,r.outputEncoding=s.outputEncoding);var h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,h.clippingPlanes=te.uniform),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);var f=r.program.getUniforms(),m=va.seqWithValue(f.seq,h);r.uniformsList=m}function Pe(e,t,n,r){!0!==t.isScene&&(t=k),X.resetTextureUnits();var i=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=null===y?p.outputEncoding:y.texture.encoding,s=Y.get(n.envMap||o),l=W.get(n),u=d.state.lights;if(!0===F&&(!0===N||e!==x)){var c=e===x&&n.id===E;te.setState(n,e,c)}n.version===l.__version?n.fog&&l.fog!==i?Se(n,t,r):l.environment!==o?Se(n,t,r):l.needsLights&&l.lightsStateVersion!==u.state.version?Se(n,t,r):void 0===l.numClippingPlanes||l.numClippingPlanes===te.numPlanes&&l.numIntersection===te.numIntersection?l.outputEncoding!==a?Se(n,t,r):l.envMap!==s&&Se(n,t,r):Se(n,t,r):(Se(n,t,r),l.__version=n.version);var h,f,m=!1,g=!1,_=!1,v=l.program,b=v.getUniforms(),T=l.uniforms;if(j.useProgram(v.program)&&(m=!0,g=!0,_=!0),n.id!==E&&(E=n.id,g=!0),m||x!==e){if(b.setValue(ue,"projectionMatrix",e.projectionMatrix),z.logarithmicDepthBuffer&&b.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),x!==e&&(x=e,g=!0,_=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var S=b.map.cameraPosition;void 0!==S&&S.setValue(ue,U.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&b.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&b.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){b.setOptional(ue,r,"bindMatrix"),b.setOptional(ue,r,"bindMatrixInverse");var A=r.skeleton;if(A){var P=A.bones;if(z.floatVertexTextures){if(null===A.boneTexture){var C=Math.sqrt(4*P.length);C=dn.ceilPowerOfTwo(C),C=Math.max(C,4);var w=new Float32Array(C*C*4);w.set(A.boneMatrices);var O=new Zi(w,C,C,ke,Oe);A.boneMatrices=w,A.boneTexture=O,A.boneTextureSize=C}b.setValue(ue,"boneTexture",A.boneTexture,X),b.setValue(ue,"boneTextureSize",A.boneTextureSize)}else b.setOptional(ue,A,"boneMatrices")}}return(g||l.receiveShadow!==r.receiveShadow)&&(l.receiveShadow=r.receiveShadow,b.setValue(ue,"receiveShadow",r.receiveShadow)),g&&(b.setValue(ue,"toneMappingExposure",p.toneMappingExposure),l.needsLights&&(f=_,(h=T).ambientLightColor.needsUpdate=f,h.lightProbe.needsUpdate=f,h.directionalLights.needsUpdate=f,h.directionalLightShadows.needsUpdate=f,h.pointLights.needsUpdate=f,h.pointLightShadows.needsUpdate=f,h.spotLights.needsUpdate=f,h.spotLightShadows.needsUpdate=f,h.rectAreaLights.needsUpdate=f,h.hemisphereLights.needsUpdate=f),i&&n.fog&&J.refreshFogUniforms(T,i),J.refreshMaterialUniforms(T,n,R,M),va.upload(ue,l.uniformsList,T,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(va.upload(ue,l.uniformsList,T,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&b.setValue(ue,"center",r.center),b.setValue(ue,"modelViewMatrix",r.modelViewMatrix),b.setValue(ue,"normalMatrix",r.normalMatrix),b.setValue(ue,"modelMatrix",r.matrixWorld),v}Ee.setAnimationLoop(function(e){pe.isPresenting||be&&be(e)}),"undefined"!==typeof window&&Ee.setContext(window),this.setAnimationLoop=function(e){be=e,pe.setAnimationLoop(e),null===e?Ee.stop():Ee.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0===t||!0===t.isCamera){if(!0!==m){le.resetDefaultState(),E=-1,x=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===pe.enabled&&!0===pe.isPresenting&&(t=pe.getCamera(t)),!0===e.isScene&&e.onBeforeRender(p,e,t,n||y),(d=ee.get(e,f.length)).init(),f.push(d),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),L.setFromProjectionMatrix(B),N=this.localClippingEnabled,F=te.init(this.clippingPlanes,N,t),(h=$.get(e,t)).init(),function e(t,n,r,i){if(!1===t.visible)return;var o=t.layers.test(n.layers);if(o)if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(n);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||L.intersectsSprite(t)){i&&U.setFromMatrixPosition(t.matrixWorld).applyMatrix4(B);var a=Q.update(t),s=t.material;s.visible&&h.push(t,a,s,r,U.z,null)}}else if(t.isImmediateRenderObject)i&&U.setFromMatrixPosition(t.matrixWorld).applyMatrix4(B),h.push(t,null,t.material,r,U.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==H.render.frame&&(t.skeleton.update(),t.skeleton.frame=H.render.frame),!t.frustumCulled||L.intersectsObject(t))){i&&U.setFromMatrixPosition(t.matrixWorld).applyMatrix4(B);var l=Q.update(t),u=t.material;if(Array.isArray(u))for(var c=l.groups,f=0,p=c.length;f<p;f++){var m=c[f],g=u[m.materialIndex];g&&g.visible&&h.push(t,l,g,r,U.z,m)}else u.visible&&h.push(t,l,u,r,U.z,null)}var _=t.children;for(var v=0,y=_.length;v<y;v++)e(_[v],n,r,i)}(e,t,0,p.sortObjects),h.finish(),!0===p.sortObjects&&h.sort(C,w),!0===F&&te.beginShadows();var i=d.state.shadowsArray;me.render(i,e,t),d.setupLights(),d.setupLightsView(t),!0===F&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ne.render(h,e,t,r);var o=h.opaque,a=h.transparent;o.length>0&&xe(o,e,t),a.length>0&&xe(a,e,t),!0===e.isScene&&e.onAfterRender(p,e,t),null!==y&&(X.updateRenderTargetMipmap(y),X.updateMultisampleRenderTarget(y)),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),f.pop(),d=f.length>0?f[f.length-1]:null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){g!==e&&null===y&&ue.bindFramebuffer(36160,e),g=e},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return v},this.getRenderList=function(){return h},this.setRenderList=function(e){h=e},this.getRenderTarget=function(){return y},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y=e,_=t,v=n,e&&void 0===W.get(e).__webglFramebuffer&&X.setupRenderTarget(e);var r=g,i=!1;if(e){var o=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=o[t],i=!0):r=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:o,T.copy(e.viewport),S.copy(e.scissor),A=e.scissorTest}else T.copy(O).multiplyScalar(R).floor(),S.copy(I).multiplyScalar(R).floor(),A=D;if(b!==r&&(ue.bindFramebuffer(36160,r),b=r),j.viewport(T),j.scissor(S),j.setScissorTest(A),i){var a=W.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,a.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,r,i,o,a){if(e&&e.isWebGLRenderTarget){var s=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){var l=!1;s!==b&&(ue.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(c!==ke&&se.convert(c)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var d=h===Ie&&(G.has("EXT_color_buffer_half_float")||z.isWebGL2&&G.has("EXT_color_buffer_float"));if(h!==Ae&&se.convert(h)!==ue.getParameter(35738)&&(h!==Oe||!(z.isWebGL2||G.has("OES_texture_float")||G.has("WEBGL_color_buffer_float")))&&!d)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ue.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ue.readPixels(t,n,r,i,se.convert(c),se.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&ue.bindFramebuffer(36160,b)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r),a=se.convert(t.format);X.setTexture2D(t,0),ue.copyTexImage2D(3553,n,a,e.x,e.y,i,o,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.image.width,o=t.image.height,a=se.convert(n.format),s=se.convert(n.type);X.setTexture2D(n,0),ue.pixelStorei(37440,n.flipY),ue.pixelStorei(37441,n.premultiplyAlpha),ue.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,r,e.x,e.y,i,o,a,s,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):ue.texSubImage2D(3553,r,e.x,e.y,a,s,t.image),0===r&&n.generateMipmaps&&ue.generateMipmap(3553),j.unbindTexture()},this.initTexture=function(e){X.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){j.reset(),le.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function hs(e){cs.call(this,e)}os.prototype=Object.assign(Object.create(Wi.prototype),{constructor:os,isArrayCamera:!0}),as.prototype=Object.assign(Object.create(Er.prototype),{constructor:as,isGroup:!0}),Object.assign(ss.prototype,{constructor:ss,getHandSpace:function(){return null===this._hand&&(this._hand=new as,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new as,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new as,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){var r=null,i=null,o=null,a=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(l&&e.hand){o=!0;var u=!0,c=!1,h=void 0;try{for(var d,f=e.hand.values()[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var p=d.value,m=t.getJointPose(p,n);if(void 0===l.joints[p.jointName]){var g=new as;g.matrixAutoUpdate=!1,g.visible=!1,l.joints[p.jointName]=g,l.add(g)}var _=l.joints[p.jointName];null!==m&&(_.matrix.fromArray(m.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=m.radius),_.visible=null!==m}}catch(E){c=!0,h=E}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}var v=l.joints["index-finger-tip"],y=l.joints["thumb-tip"],b=v.position.distanceTo(y.position);l.inputState.pinching&&b>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&b<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&null!==(r=t.getPose(e.targetRaySpace,n))&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)),null!==s&&e.gripSpace&&null!==(i=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale));return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==o),this}}),Object.assign(ls.prototype,sn.prototype),hs.prototype=Object.assign(Object.create(cs.prototype),{constructor:hs,isWebGL1Renderer:!0});var ds=function(){function e(t,n,r){Object(f.a)(this,e),Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new jr(t),this.near=void 0!==n?n:1,this.far=void 0!==r?r:1e3}return Object(p.a)(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}(),fs=function(e){function t(){var e;return Object(f.a)(this,t),e=Object(u.a)(this,Object(c.a)(t).call(this)),Object.defineProperty(Object(h.a)(e),"isScene",{value:!0}),e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:Object(h.a)(e)})),e}return Object(d.a)(t,e),Object(p.a)(t,[{key:"copy",value:function(e,n){return Object(l.a)(Object(c.a)(t.prototype),"copy",this).call(this,e,n),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var n=Object(l.a)(Object(c.a)(t.prototype),"toJSON",this).call(this,e);return null!==this.background&&(n.object.background=this.background.toJSON(e)),null!==this.environment&&(n.object.environment=this.environment.toJSON(e)),null!==this.fog&&(n.object.fog=this.fog.toJSON()),n}}]),t}(Er);function ps(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=rn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=dn.generateUUID()}Object.defineProperty(ps.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ps.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=dn.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new ps(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=dn.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var ms,gs=new xn;function _s(e,t,n,r){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function vs(e){Xr.call(this),this.type="SpriteMaterial",this.color=new jr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(_s.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(_s.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)gs.x=this.getX(t),gs.y=this.getY(t),gs.z=this.getZ(t),gs.applyMatrix4(e),this.setXYZ(t,gs.x,gs.y,gs.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return new Qr(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new _s(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),vs.prototype=Object.create(Xr.prototype),vs.prototype.constructor=vs,vs.prototype.isSpriteMaterial=!0,vs.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var ys=new xn,bs=new xn,Es=new xn,xs=new fn,Ts=new fn,Ss=new Qn,As=new xn,Ps=new xn,Ms=new xn,Rs=new fn,Cs=new fn,ws=new fn;function Os(e){if(Er.call(this),this.type="Sprite",void 0===ms){ms=new _i;var t=new ps(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);ms.setIndex([0,1,2,0,2,3]),ms.setAttribute("position",new _s(t,3,0,!1)),ms.setAttribute("uv",new _s(t,2,3,!1))}this.geometry=ms,this.material=void 0!==e?e:new vs,this.center=new fn(.5,.5)}function Is(e,t,n,r,i,o){xs.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Ts.x=o*xs.x-i*xs.y,Ts.y=i*xs.x+o*xs.y):Ts.copy(xs),e.copy(t),e.x+=Ts.x,e.y+=Ts.y,e.applyMatrix4(Ss)}Os.prototype=Object.assign(Object.create(Er.prototype),{constructor:Os,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),bs.setFromMatrixScale(this.matrixWorld),Ss.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Es.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&bs.multiplyScalar(-Es.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var o=this.center;Is(As.set(-.5,-.5,0),Es,o,bs,n,r),Is(Ps.set(.5,-.5,0),Es,o,bs,n,r),Is(Ms.set(.5,.5,0),Es,o,bs,n,r),Rs.set(0,0),Cs.set(1,0),ws.set(1,1);var a=e.ray.intersectTriangle(As,Ps,Ms,!1,ys);if(null!==a||(Is(Ps.set(-.5,.5,0),Es,o,bs,n,r),Cs.set(0,1),null!==(a=e.ray.intersectTriangle(As,Ms,Ps,!1,ys)))){var s=e.ray.origin.distanceTo(ys);s<e.near||s>e.far||t.push({distance:s,point:ys.clone(),uv:Nr.getUV(ys,As,Ps,Ms,Rs,Cs,ws,new fn),face:null,object:this})}},copy:function(e){return Er.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});var Ds=new xn,Ls=new xn;function Fs(){Er.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Fs.prototype=Object.assign(Object.create(Er.prototype),{constructor:Fs,isLOD:!0,copy:function(e){Er.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);var n,r=this.levels;for(n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){var n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ds.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Ds);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Ds.setFromMatrixPosition(e.matrixWorld),Ls.setFromMatrixPosition(this.matrixWorld);var n,r,i=Ds.distanceTo(Ls)/e.zoom;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}},toJSON:function(e){var t=Er.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}});var Ns=new xn,Bs=new yn,Us=new yn,ks=new xn,Vs=new Qn;function Gs(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Fi.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Qn,this.bindMatrixInverse=new Qn}function zs(){Er.call(this),this.type="Bone"}Gs.prototype=Object.assign(Object.create(Fi.prototype),{constructor:Gs,isSkinnedMesh:!0,copy:function(e){return Fi.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new yn,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Fi.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){var n=this.skeleton,r=this.geometry;Bs.fromBufferAttribute(r.attributes.skinIndex,e),Us.fromBufferAttribute(r.attributes.skinWeight,e),Ns.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var i=0;i<4;i++){var o=Us.getComponent(i);if(0!==o){var a=Bs.getComponent(i);Vs.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(ks.copy(Ns).applyMatrix4(Vs),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}),zs.prototype=Object.assign(Object.create(Er.prototype),{constructor:zs,isBone:!0});var js=new Qn,Hs=new Qn;function Ws(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=dn.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Ws.prototype,{init:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Qn)}},calculateInverses:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new Qn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}},pose:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var o=this.bones[r];o&&(o.parent&&o.parent.isBone?(o.matrix.copy(o.parent.matrixWorld).invert(),o.matrix.multiply(o.matrixWorld)):o.matrix.copy(o.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale))}},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=e.length;i<o;i++){var a=e[i]?e[i].matrixWorld:Hs;js.multiplyMatrices(a,t[i]),js.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new Ws(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(var n=0,r=e.bones.length;n<r;n++){var i=e.bones[n],o=t[i];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),o=new zs),this.bones.push(o),this.boneInverses.push((new Qn).fromArray(e.boneInverses[n]))}return this.init(),this},toJSON:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,r=0,i=t.length;r<i;r++){var o=t[r];e.bones.push(o.uuid);var a=n[r];e.boneInverses.push(a.toArray())}return e}});var Xs=new Qn,Ys=new Qn,Ks=[],qs=new Fi;function Qs(e,t,n){Fi.call(this,e,t),this.instanceMatrix=new Qr(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function Zs(e){Xr.call(this),this.type="LineBasicMaterial",this.color=new jr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}Qs.prototype=Object.assign(Object.create(Fi.prototype),{constructor:Qs,isInstancedMesh:!0,copy:function(e){return Fi.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,r=this.count;if(qs.geometry=this.geometry,qs.material=this.material,void 0!==qs.material)for(var i=0;i<r;i++){this.getMatrixAt(i,Xs),Ys.multiplyMatrices(n,Xs),qs.matrixWorld=Ys,qs.raycast(e,Ks);for(var o=0,a=Ks.length;o<a;o++){var s=Ks[o];s.instanceId=i,s.object=this,t.push(s)}Ks.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new Qr(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Zs.prototype=Object.create(Xr.prototype),Zs.prototype.constructor=Zs,Zs.prototype.isLineBasicMaterial=!0,Zs.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var Js=new xn,$s=new xn,el=new Qn,tl=new qn,nl=new Gn;function rl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _i,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Zs;Er.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}rl.prototype=Object.assign(Object.create(Er.prototype),{constructor:rl,isLine:!0,copy:function(e){return Er.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)Js.fromBufferAttribute(t,r-1),$s.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Js.distanceTo($s);e.setAttribute("lineDistance",new oi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),nl.copy(n.boundingSphere),nl.applyMatrix4(r),nl.radius+=i,!1!==e.ray.intersectsSphere(nl)){el.copy(r).invert(),tl.copy(e.ray).applyMatrix4(el);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new xn,l=new xn,u=new xn,c=new xn,h=this.isLineSegments?2:1;if(n.isBufferGeometry){var d=n.index,f=n.attributes.position;if(null!==d)for(var p=d.array,m=0,g=p.length-1;m<g;m+=h){var _=p[m],v=p[m+1];if(s.fromBufferAttribute(f,_),l.fromBufferAttribute(f,v),!(tl.distanceSqToSegment(s,l,c,u)>a)){c.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(c);y<e.near||y>e.far||t.push({distance:y,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var b=0,E=f.count-1;b<E;b+=h){if(s.fromBufferAttribute(f,b),l.fromBufferAttribute(f,b+1),!(tl.distanceSqToSegment(s,l,c,u)>a)){c.applyMatrix4(this.matrixWorld);var x=e.ray.origin.distanceTo(c);x<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var il=new xn,ol=new xn;function al(e,t){rl.call(this,e,t),this.type="LineSegments"}function sl(e,t){rl.call(this,e,t),this.type="LineLoop"}function ll(e){Xr.call(this),this.type="PointsMaterial",this.color=new jr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}al.prototype=Object.assign(Object.create(rl.prototype),{constructor:al,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)il.fromBufferAttribute(t,r),ol.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+il.distanceTo(ol);e.setAttribute("lineDistance",new oi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}),sl.prototype=Object.assign(Object.create(rl.prototype),{constructor:sl,isLineLoop:!0}),ll.prototype=Object.create(Xr.prototype),ll.prototype.constructor=ll,ll.prototype.isPointsMaterial=!0,ll.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var ul=new Qn,cl=new qn,hl=new Gn,dl=new xn;function fl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _i,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ll;Er.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function pl(e,t,n,r,i,o,a){var s=cl.distanceSqToPoint(e);if(s<n){var l=new xn;cl.closestPointToPoint(e,l),l.applyMatrix4(r);var u=i.ray.origin.distanceTo(l);if(u<i.near||u>i.far)return;o.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:a})}}function ml(e,t,n,r,i,o,a,s,l){_n.call(this,e,t,n,r,i,o,a,s,l),this.format=void 0!==a?a:Ue,this.minFilter=void 0!==o?o:xe,this.magFilter=void 0!==i?i:xe,this.generateMipmaps=!1;var u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)})}function gl(e,t,n,r,i,o,a,s,l,u,c,h){_n.call(this,null,o,a,s,l,u,r,i,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function _l(e,t,n,r,i,o,a,s,l){_n.call(this,e,t,n,r,i,o,a,s,l),this.needsUpdate=!0}function vl(e,t,n,r,i,o,a,s,l,u){if((u=void 0!==u?u:ze)!==ze&&u!==je)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===ze&&(n=Re),void 0===n&&u===je&&(n=Ne),_n.call(this,null,r,i,o,a,s,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:ye,this.minFilter=void 0!==s?s:ye,this.flipY=!1,this.generateMipmaps=!1}fl.prototype=Object.assign(Object.create(Er.prototype),{constructor:fl,isPoints:!0,copy:function(e){return Er.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),hl.copy(n.boundingSphere),hl.applyMatrix4(r),hl.radius+=i,!1!==e.ray.intersectsSphere(hl)){ul.copy(r).invert(),cl.copy(e.ray).applyMatrix4(ul);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){var s=n.index,l=n.attributes.position;if(null!==s)for(var u=s.array,c=0,h=u.length;c<h;c++){var d=u[c];dl.fromBufferAttribute(l,d),pl(dl,d,a,r,e,t,this)}else for(var f=0,p=l.count;f<p;f++)dl.fromBufferAttribute(l,f),pl(dl,f,a,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),ml.prototype=Object.assign(Object.create(_n.prototype),{constructor:ml,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),gl.prototype=Object.create(_n.prototype),gl.prototype.constructor=gl,gl.prototype.isCompressedTexture=!0,_l.prototype=Object.create(_n.prototype),_l.prototype.constructor=_l,_l.prototype.isCanvasTexture=!0,vl.prototype=Object.create(_n.prototype),vl.prototype.constructor=vl,vl.prototype.isDepthTexture=!0;var yl=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(f.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this))).type="PolyhedronGeometry",r.parameters={vertices:e,indices:n,radius:i,detail:o};var a=[],s=[];function l(e,t,n,r){for(var i=r+1,o=[],a=0;a<=i;a++){o[a]=[];for(var s=e.clone().lerp(n,a/i),l=t.clone().lerp(n,a/i),u=i-a,c=0;c<=u;c++)o[a][c]=0===c&&a===i?s:s.clone().lerp(l,c/u)}for(var d=0;d<i;d++)for(var f=0;f<2*(i-d)-1;f++){var p=Math.floor(f/2);f%2===0?(h(o[d][p+1]),h(o[d+1][p]),h(o[d][p])):(h(o[d][p+1]),h(o[d+1][p+1]),h(o[d+1][p]))}}function h(e){a.push(e.x,e.y,e.z)}function d(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function p(e,t,n,r){r<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=r/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}return function(e){for(var t=new xn,r=new xn,i=new xn,o=0;o<n.length;o+=3)d(n[o+0],t),d(n[o+1],r),d(n[o+2],i),l(t,r,i,e)}(o),function(e){for(var t=new xn,n=0;n<a.length;n+=3)t.x=a[n+0],t.y=a[n+1],t.z=a[n+2],t.normalize().multiplyScalar(e),a[n+0]=t.x,a[n+1]=t.y,a[n+2]=t.z}(i),function(){for(var e=new xn,t=0;t<a.length;t+=3){e.x=a[t+0],e.y=a[t+1],e.z=a[t+2];var n=m(e)/2/Math.PI+.5,r=(i=e,Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5);s.push(n,1-r)}var i;(function(){for(var e=new xn,t=new xn,n=new xn,r=new xn,i=new fn,o=new fn,l=new fn,u=0,c=0;u<a.length;u+=9,c+=6){e.set(a[u+0],a[u+1],a[u+2]),t.set(a[u+3],a[u+4],a[u+5]),n.set(a[u+6],a[u+7],a[u+8]),i.set(s[c+0],s[c+1]),o.set(s[c+2],s[c+3]),l.set(s[c+4],s[c+5]),r.copy(e).add(t).add(n).divideScalar(3);var h=m(r);p(i,c+0,e,h),p(o,c+2,t,h),p(l,c+4,n,h)}})(),function(){for(var e=0;e<s.length;e+=6){var t=s[e+0],n=s[e+2],r=s[e+4],i=Math.max(t,n,r),o=Math.min(t,n,r);i>.9&&o<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),r<.2&&(s[e+4]+=1))}}()}(),r.setAttribute("position",new oi(a,3)),r.setAttribute("normal",new oi(a.slice(),3)),r.setAttribute("uv",new oi(s,2)),0===o?r.computeVertexNormals():r.normalizeNormals(),r}return Object(d.a)(t,e),t}(_i),bl=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(f.a)(this,t);var i=(1+Math.sqrt(5))/2,o=1/i,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o];return(e=Object(u.a)(this,Object(c.a)(t).call(this,a,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],n,r))).type="DodecahedronGeometry",e.parameters={radius:n,detail:r},e}return Object(d.a)(t,e),t}(yl),El=(new xn,new xn,new xn,new Nr,function(e,t,n){n=n||2;var r,i,o,a,s,l,u,c=t&&t.length,h=c?t[0]*n:e.length,d=xl(e,0,h,n,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,n,r){var i,o,a,s,l,u=[];for(i=0,o=t.length;i<o;i++)a=t[i]*r,s=i<o-1?t[i+1]*r:e.length,(l=xl(e,a,s,r,!1))===l.next&&(l.steiner=!0),u.push(Dl(l));for(u.sort(Cl),i=0;i<u.length;i++)wl(u[i],n),n=Tl(n,n.next);return n}(e,t,d,n)),e.length>80*n){r=o=e[0],i=a=e[1];for(var p=n;p<h;p+=n)(s=e[p])<r&&(r=s),(l=e[p+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-r,a-i))?1/u:0}return Sl(d,f,n,r,i,u),f});function xl(e,t,n,r,i){var o,a;if(i===function(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)a=jl(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=jl(o,e[o],e[o+1],a);return a&&Bl(a,a.next)&&(Hl(a),a=a.next),a}function Tl(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Bl(r,r.next)&&0!==Nl(r.prev,r,r.next))r=r.next;else{if(Hl(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Sl(e,t,n,r,i,o,a){if(e){!a&&o&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Il(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,l,u=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(a>1)}(i)}(e,r,i,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?Pl(e,r,i,o):Al(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Hl(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?Sl(e=Ml(Tl(e),t,n),t,n,r,i,o,2):2===a&&Rl(e,t,n,r,i,o):Sl(Tl(e),t,n,r,i,o,1);break}}}function Al(e){var t=e.prev,n=e,r=e.next;if(Nl(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Ll(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Nl(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Pl(e,t,n,r){var i=e.prev,o=e,a=e.next;if(Nl(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,u=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=Il(s,l,t,n,r),d=Il(u,c,t,n,r),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&Ll(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Nl(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&Ll(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Nl(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&Ll(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Nl(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&Ll(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Nl(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ml(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!Bl(i,o)&&Ul(i,r,r.next,o)&&Gl(i,o)&&Gl(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Hl(r),Hl(r.next),r=e=o),r=r.next}while(r!==e);return Tl(r)}function Rl(e,t,n,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Fl(a,s)){var l=zl(a,s);return a=Tl(a,a.next),l=Tl(l,l.next),Sl(a,t,n,r,i,o),void Sl(l,t,n,r,i,o)}s=s.next}a=a.next}while(a!==e)}function Cl(e,t){return e.x-t.x}function wl(e,t){if(t=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===a)return n;var l,u=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Ll(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),Gl(r,e)&&(l<d||l===d&&(r.x>n.x||r.x===n.x&&Ol(n,r)))&&(n=r,d=l)),r=r.next}while(r!==u);return n}(e,t)){var n=zl(t,e);Tl(t,t.next),Tl(n,n.next)}}function Ol(e,t){return Nl(e.prev,e,t.prev)<0&&Nl(t.next,e,e.next)<0}function Il(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Dl(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ll(e,t,n,r,i,o,a,s){return(i-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Fl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ul(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Gl(e,t)&&Gl(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Nl(e.prev,e,t.prev)||Nl(e,t.prev,t))||Bl(e,t)&&Nl(e.prev,e,e.next)>0&&Nl(t.prev,t,t.next)>0)}function Nl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Bl(e,t){return e.x===t.x&&e.y===t.y}function Ul(e,t,n,r){var i=Vl(Nl(e,t,n)),o=Vl(Nl(e,t,r)),a=Vl(Nl(n,r,e)),s=Vl(Nl(n,r,t));return i!==o&&a!==s||(!(0!==i||!kl(e,n,t))||(!(0!==o||!kl(e,r,t))||(!(0!==a||!kl(n,e,r))||!(0!==s||!kl(n,t,r)))))}function kl(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Vl(e){return e>0?1:e<0?-1:0}function Gl(e,t){return Nl(e.prev,e,e.next)<0?Nl(e,t,e.next)>=0&&Nl(e,e.prev,t)>=0:Nl(e,t,e.prev)<0||Nl(e,e.next,t)<0}function zl(e,t){var n=new Wl(e.i,e.x,e.y),r=new Wl(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function jl(e,t,n,r){var i=new Wl(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Hl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Wl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Xl={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return Xl.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];Yl(e),Kl(n,e);var o=e.length;t.forEach(Yl);for(var a=0;a<t.length;a++)r.push(o),o+=t[a].length,Kl(n,t[a]);for(var s=El(n,r),l=0;l<s.length;l+=3)i.push(s.slice(l,l+3));return i}};function Yl(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Kl(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var ql=function(e){function t(e,n){var r;Object(f.a)(this,t),(r=Object(u.a)(this,Object(c.a)(t).call(this))).type="ExtrudeGeometry",r.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];for(var i=Object(h.a)(r),o=[],a=[],s=0,l=e.length;s<l;s++){d(e[s])}function d(e){var t=[],r=void 0!==n.curveSegments?n.curveSegments:12,s=void 0!==n.steps?n.steps:1,l=void 0!==n.depth?n.depth:100,u=void 0===n.bevelEnabled||n.bevelEnabled,c=void 0!==n.bevelThickness?n.bevelThickness:6,h=void 0!==n.bevelSize?n.bevelSize:c-2,d=void 0!==n.bevelOffset?n.bevelOffset:0,f=void 0!==n.bevelSegments?n.bevelSegments:3,p=n.extrudePath,m=void 0!==n.UVGenerator?n.UVGenerator:Ql;void 0!==n.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=n.amount);var g,_,v,y,b,E=!1;p&&(g=p.getSpacedPoints(s),E=!0,u=!1,_=p.computeFrenetFrames(s,!1),v=new xn,y=new xn,b=new xn),u||(f=0,c=0,h=0,d=0);var x=e.extractPoints(r),T=x.shape,S=x.holes;if(!Xl.isClockWise(T)){T=T.reverse();for(var A=0,P=S.length;A<P;A++){var M=S[A];Xl.isClockWise(M)&&(S[A]=M.reverse())}}for(var R=Xl.triangulateShape(T,S),C=T,w=0,O=S.length;w<O;w++){var I=S[w];T=T.concat(I)}function D(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var L=T.length,F=R.length;function N(e,t,n){var r,i,o,a=e.x-t.x,s=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=a*a+s*s,h=a*u-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),f=Math.sqrt(l*l+u*u),p=t.x-s/d,m=t.y+a/d,g=((n.x-u/f-p)*u-(n.y+l/f-m)*l)/(a*u-s*l),_=(r=p+a*g-e.x)*r+(i=m+s*g-e.y)*i;if(_<=2)return new fn(r,i);o=Math.sqrt(_/2)}else{var v=!1;a>Number.EPSILON?l>Number.EPSILON&&(v=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(v=!0):Math.sign(s)===Math.sign(u)&&(v=!0),v?(r=-s,i=a,o=Math.sqrt(c)):(r=a,i=s,o=Math.sqrt(c/2))}return new fn(r/o,i/o)}for(var B=[],U=0,k=C.length,V=k-1,G=U+1;U<k;U++,V++,G++)V===k&&(V=0),G===k&&(G=0),B[U]=N(C[U],C[V],C[G]);for(var z,j=[],H=B.concat(),W=0,X=S.length;W<X;W++){var Y=S[W];z=[];for(var K=0,q=Y.length,Q=q-1,Z=K+1;K<q;K++,Q++,Z++)Q===q&&(Q=0),Z===q&&(Z=0),z[K]=N(Y[K],Y[Q],Y[Z]);j.push(z),H=H.concat(z)}for(var J=0;J<f;J++){for(var $=J/f,ee=c*Math.cos($*Math.PI/2),te=h*Math.sin($*Math.PI/2)+d,ne=0,re=C.length;ne<re;ne++){var ie=D(C[ne],B[ne],te);Oe(ie.x,ie.y,-ee)}for(var oe=0,ae=S.length;oe<ae;oe++){var se=S[oe];z=j[oe];for(var le=0,ue=se.length;le<ue;le++){var ce=D(se[le],z[le],te);Oe(ce.x,ce.y,-ee)}}}for(var he=h+d,de=0;de<L;de++){var fe=u?D(T[de],H[de],he):T[de];E?(y.copy(_.normals[0]).multiplyScalar(fe.x),v.copy(_.binormals[0]).multiplyScalar(fe.y),b.copy(g[0]).add(y).add(v),Oe(b.x,b.y,b.z)):Oe(fe.x,fe.y,0)}for(var pe=1;pe<=s;pe++)for(var me=0;me<L;me++){var ge=u?D(T[me],H[me],he):T[me];E?(y.copy(_.normals[pe]).multiplyScalar(ge.x),v.copy(_.binormals[pe]).multiplyScalar(ge.y),b.copy(g[pe]).add(y).add(v),Oe(b.x,b.y,b.z)):Oe(ge.x,ge.y,l/s*pe)}for(var _e=f-1;_e>=0;_e--){for(var ve=_e/f,ye=c*Math.cos(ve*Math.PI/2),be=h*Math.sin(ve*Math.PI/2)+d,Ee=0,xe=C.length;Ee<xe;Ee++){var Te=D(C[Ee],B[Ee],be);Oe(Te.x,Te.y,l+ye)}for(var Se=0,Ae=S.length;Se<Ae;Se++){var Pe=S[Se];z=j[Se];for(var Me=0,Re=Pe.length;Me<Re;Me++){var Ce=D(Pe[Me],z[Me],be);E?Oe(Ce.x,Ce.y+g[s-1].y,g[s-1].x+ye):Oe(Ce.x,Ce.y,l+ye)}}}function we(e,t){for(var n=e.length;--n>=0;){var r=n,i=n-1;i<0&&(i=e.length-1);for(var o=0,a=s+2*f;o<a;o++){var l=L*o,u=L*(o+1);De(t+r+l,t+i+l,t+i+u,t+r+u)}}}function Oe(e,n,r){t.push(e),t.push(n),t.push(r)}function Ie(e,t,n){Le(e),Le(t),Le(n);var r=o.length/3,a=m.generateTopUV(i,o,r-3,r-2,r-1);Fe(a[0]),Fe(a[1]),Fe(a[2])}function De(e,t,n,r){Le(e),Le(t),Le(r),Le(t),Le(n),Le(r);var a=o.length/3,s=m.generateSideWallUV(i,o,a-6,a-3,a-2,a-1);Fe(s[0]),Fe(s[1]),Fe(s[3]),Fe(s[1]),Fe(s[2]),Fe(s[3])}function Le(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function Fe(e){a.push(e.x),a.push(e.y)}!function(){var e=o.length/3;if(u){for(var t=0,n=L*t,r=0;r<F;r++){var a=R[r];Ie(a[2]+n,a[1]+n,a[0]+n)}n=L*(t=s+2*f);for(var l=0;l<F;l++){var c=R[l];Ie(c[0]+n,c[1]+n,c[2]+n)}}else{for(var h=0;h<F;h++){var d=R[h];Ie(d[2],d[1],d[0])}for(var p=0;p<F;p++){var m=R[p];Ie(m[0]+L*s,m[1]+L*s,m[2]+L*s)}}i.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;we(C,t),t+=C.length;for(var n=0,r=S.length;n<r;n++){var a=S[n];we(a,t),t+=a.length}i.addGroup(e,o.length/3-e,1)}()}return r.setAttribute("position",new oi(o,3)),r.setAttribute("uv",new oi(a,2)),r.computeVertexNormals(),r}return Object(d.a)(t,e),Object(p.a)(t,[{key:"toJSON",value:function(){var e=_i.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var o=e[r];n.shapes.push(o.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}]),t}(_i),Ql={generateTopUV:function(e,t,n,r,i){var o=t[3*n],a=t[3*n+1],s=t[3*r],l=t[3*r+1],u=t[3*i],c=t[3*i+1];return[new fn(o,a),new fn(s,l),new fn(u,c)]},generateSideWallUV:function(e,t,n,r,i,o){var a=t[3*n],s=t[3*n+1],l=t[3*n+2],u=t[3*r],c=t[3*r+1],h=t[3*r+2],d=t[3*i],f=t[3*i+1],p=t[3*i+2],m=t[3*o],g=t[3*o+1],_=t[3*o+2];return Math.abs(s-c)<.01?[new fn(a,1-l),new fn(u,1-h),new fn(d,1-p),new fn(m,1-_)]:[new fn(s,1-l),new fn(c,1-h),new fn(f,1-p),new fn(g,1-_)]}};function Zl(e,t,n){_i.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};var r=[],i=[],o=[],a=[],s=new xn,l=new xn,u=new xn,c=new xn,h=new xn;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var d=t+1,f=0;f<=n;f++)for(var p=f/n,m=0;m<=t;m++){var g=m/t;e(g,p,l),i.push(l.x,l.y,l.z),g-1e-5>=0?(e(g-1e-5,p,u),c.subVectors(l,u)):(e(g+1e-5,p,u),c.subVectors(u,l)),p-1e-5>=0?(e(g,p-1e-5,u),h.subVectors(l,u)):(e(g,p+1e-5,u),h.subVectors(u,l)),s.crossVectors(c,h).normalize(),o.push(s.x,s.y,s.z),a.push(g,p)}for(var _=0;_<n;_++)for(var v=0;v<t;v++){var y=_*d+v,b=_*d+v+1,E=(_+1)*d+v+1,x=(_+1)*d+v;r.push(y,b,x),r.push(b,E,x)}this.setIndex(r),this.setAttribute("position",new oi(i,3)),this.setAttribute("normal",new oi(o,3)),this.setAttribute("uv",new oi(a,2))}Zl.prototype=Object.create(_i.prototype),Zl.prototype.constructor=Zl;var Jl=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;Object(f.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this))).type="ShapeGeometry",n.parameters={shapes:e,curveSegments:r};var i=[],o=[],a=[],s=[],l=0,h=0;if(!1===Array.isArray(e))p(e);else for(var d=0;d<e.length;d++)p(e[d]),n.addGroup(l,h,d),l+=h,h=0;function p(e){var t=o.length/3,n=e.extractPoints(r),l=n.shape,u=n.holes;!1===Xl.isClockWise(l)&&(l=l.reverse());for(var c=0,d=u.length;c<d;c++){var f=u[c];!0===Xl.isClockWise(f)&&(u[c]=f.reverse())}for(var p=Xl.triangulateShape(l,u),m=0,g=u.length;m<g;m++){var _=u[m];l=l.concat(_)}for(var v=0,y=l.length;v<y;v++){var b=l[v];o.push(b.x,b.y,0),a.push(0,0,1),s.push(b.x,b.y)}for(var E=0,x=p.length;E<x;E++){var T=p[E],S=T[0]+t,A=T[1]+t,P=T[2]+t;i.push(S,A,P),h+=3}}return n.setIndex(i),n.setAttribute("position",new oi(o,3)),n.setAttribute("normal",new oi(a,3)),n.setAttribute("uv",new oi(s,2)),n}return Object(d.a)(t,e),Object(p.a)(t,[{key:"toJSON",value:function(){var e=_i.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}]),t}(_i);var $l=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;Object(f.a)(this,t),(e=Object(u.a)(this,Object(c.a)(t).call(this))).type="SphereGeometry",e.parameters={radius:n,widthSegments:r,heightSegments:i,phiStart:o,phiLength:a,thetaStart:s,thetaLength:l},r=Math.max(3,Math.floor(r)),i=Math.max(2,Math.floor(i));for(var h=Math.min(s+l,Math.PI),d=0,p=[],m=new xn,g=new xn,_=[],v=[],y=[],b=[],E=0;E<=i;E++){var x=[],T=E/i,S=0;0==E&&0==s?S=.5/r:E==i&&h==Math.PI&&(S=-.5/r);for(var A=0;A<=r;A++){var P=A/r;m.x=-n*Math.cos(o+P*a)*Math.sin(s+T*l),m.y=n*Math.cos(s+T*l),m.z=n*Math.sin(o+P*a)*Math.sin(s+T*l),v.push(m.x,m.y,m.z),g.copy(m).normalize(),y.push(g.x,g.y,g.z),b.push(P+S,1-T),x.push(d++)}p.push(x)}for(var M=0;M<i;M++)for(var R=0;R<r;R++){var C=p[M][R+1],w=p[M][R],O=p[M+1][R],I=p[M+1][R+1];(0!==M||s>0)&&_.push(C,w,I),(M!==i-1||h<Math.PI)&&_.push(w,O,I)}return e.setIndex(_),e.setAttribute("position",new oi(v,3)),e.setAttribute("normal",new oi(y,3)),e.setAttribute("uv",new oi(b,2)),e}return Object(d.a)(t,e),t}(_i);function eu(e){Xr.call(this),this.type="ShadowMaterial",this.color=new jr(0),this.transparent=!0,this.setValues(e)}function tu(e){ji.call(this,e),this.type="RawShaderMaterial"}function nu(e){Xr.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new jr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$t,this.normalScale=new fn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function ru(e){nu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new fn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=dn.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function iu(e){Xr.call(this),this.type="MeshPhongMaterial",this.color=new jr(16777215),this.specular=new jr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$t,this.normalScale=new fn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ou(e){Xr.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$t,this.normalScale=new fn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function au(e){Xr.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$t,this.normalScale=new fn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function su(e){Xr.call(this),this.type="MeshLambertMaterial",this.color=new jr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=te,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function lu(e){Xr.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=$t,this.normalScale=new fn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function uu(e){Zs.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}eu.prototype=Object.create(Xr.prototype),eu.prototype.constructor=eu,eu.prototype.isShadowMaterial=!0,eu.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this},tu.prototype=Object.create(ji.prototype),tu.prototype.constructor=tu,tu.prototype.isRawShaderMaterial=!0,nu.prototype=Object.create(Xr.prototype),nu.prototype.constructor=nu,nu.prototype.isMeshStandardMaterial=!0,nu.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},ru.prototype=Object.create(nu.prototype),ru.prototype.constructor=ru,ru.prototype.isMeshPhysicalMaterial=!0,ru.prototype.copy=function(e){return nu.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new jr).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},iu.prototype=Object.create(Xr.prototype),iu.prototype.constructor=iu,iu.prototype.isMeshPhongMaterial=!0,iu.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ou.prototype=Object.create(Xr.prototype),ou.prototype.constructor=ou,ou.prototype.isMeshToonMaterial=!0,ou.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},au.prototype=Object.create(Xr.prototype),au.prototype.constructor=au,au.prototype.isMeshNormalMaterial=!0,au.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},su.prototype=Object.create(Xr.prototype),su.prototype.constructor=su,su.prototype.isMeshLambertMaterial=!0,su.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},lu.prototype=Object.create(Xr.prototype),lu.prototype.constructor=lu,lu.prototype.isMeshMatcapMaterial=!0,lu.prototype.copy=function(e){return Xr.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},uu.prototype=Object.create(Zs.prototype),uu.prototype.constructor=uu,uu.prototype.isLineDashedMaterial=!0,uu.prototype.copy=function(e){return Zs.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var cu=Object.freeze({__proto__:null,ShadowMaterial:eu,SpriteMaterial:vs,RawShaderMaterial:tu,ShaderMaterial:ji,PointsMaterial:ll,MeshPhysicalMaterial:ru,MeshStandardMaterial:nu,MeshPhongMaterial:iu,MeshToonMaterial:ou,MeshNormalMaterial:au,MeshLambertMaterial:su,MeshDepthMaterial:Za,MeshDistanceMaterial:Ja,MeshBasicMaterial:Yr,MeshMatcapMaterial:lu,LineDashedMaterial:uu,LineBasicMaterial:Zs,Material:Xr}),hu={arraySlice:function(e,t,n){return hu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort(function(t,n){return e[t]-e[n]}),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*t,l=0;l!==t;++l)i[a++]=e[s+l];return i},flattenJSON:function(e,t,n,r){for(var i=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(t.push(o.time),n.push.apply(n,a)),o=e[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(t.push(o.time),a.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(t.push(o.time),n.push(a)),o=e[i++]}while(void 0!==o)}},subclip:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,o=e.clone();o.name=t;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],u=l.getValueSize(),c=[],h=[],d=0;d<l.times.length;++d){var f=l.times[d]*i;if(!(f<n||f>=r)){c.push(l.times[d]);for(var p=0;p<u;++p)h.push(l.values[d*u+p])}}0!==c.length&&(l.times=hu.convertArray(c,l.times.constructor),l.values=hu.convertArray(h,l.values.constructor),a.push(l))}o.tracks=a;for(var m=1/0,g=0;g<o.tracks.length;++g)m>o.tracks[g].times[0]&&(m=o.tracks[g].times[0]);for(var _=0;_<o.tracks.length;++_)o.tracks[_].shift(-1*m);return o.resetDuration(),o},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var i=n.tracks.length,o=t/r,a=function(t){var r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)return"continue";var a=e.tracks.find(function(e){return e.name===r.name&&e.ValueTypeName===i});if(void 0===a)return"continue";var s=0,l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);var u=0,c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);var h=r.times.length-1,d=void 0;if(o<=r.times[0]){var f=s,p=l-s;d=hu.arraySlice(r.values,f,p)}else if(o>=r.times[h]){var m=h*l+s,g=m+l-s;d=hu.arraySlice(r.values,m,g)}else{var _=r.createInterpolant(),v=s,y=l-s;_.evaluate(o),d=hu.arraySlice(_.resultBuffer,v,y)}"quaternion"===i&&(new En).fromArray(d).normalize().conjugate().toArray(d);for(var b=a.times.length,E=0;E<b;++E){var x=E*c+u;if("quaternion"===i)En.multiplyQuaternionsFlat(a.values,x,d,0,a.values,x);else for(var T=c-2*u,S=0;S<T;++S)a.values[x+S]-=d[S]}},s=0;s<i;++s)a(s);return e.blendMode=2501,e}};function du(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function fu(e,t,n,r){du.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function pu(e,t,n,r){du.call(this,e,t,n,r)}function mu(e,t,n,r){du.call(this,e,t,n,r)}function gu(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=hu.convertArray(t,this.TimeBufferType),this.values=hu.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function _u(e,t,n){gu.call(this,e,t,n)}function vu(e,t,n,r){gu.call(this,e,t,n,r)}function yu(e,t,n,r){gu.call(this,e,t,n,r)}function bu(e,t,n,r){du.call(this,e,t,n,r)}function Eu(e,t,n,r){gu.call(this,e,t,n,r)}function xu(e,t,n,r){gu.call(this,e,t,n,r)}function Tu(e,t,n,r){gu.call(this,e,t,n,r)}function Su(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vt;this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=dn.generateUUID(),this.duration<0&&this.resetDuration()}function Au(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yu;case"vector":case"vector2":case"vector3":case"vector4":return Tu;case"color":return vu;case"quaternion":return Eu;case"bool":case"boolean":return _u;case"string":return xu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];hu.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(du.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var o;n:{r:if(!(e<r)){for(var a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===a)break;if(i=r,e<(r=t[++n]))break t}o=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(var l=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===l)break;if(r=i,e>=(i=t[--n-1]))break t}o=n,n=0}for(;n<o;){var u=n+o>>>1;e<t[u]?o=u:n=u+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,o=0;o!==r;++o)t[o]=n[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(du.prototype,{beforeStart_:du.prototype.copySampleValue_,afterEnd_:du.prototype.copySampleValue_}),fu.prototype=Object.assign(Object.create(du.prototype),{constructor:fu,DefaultSettings_:{endingStart:kt,endingEnd:kt},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,o=e+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-n;break;case 2402:a=t+r[i=r.length-2]-r[i+1];break;default:i=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*n-t;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(s-n),this._offsetPrev=i*u,this._offsetNext=o*u},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(r-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,_=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,v=(-1-d)*m+(1.5+d)*p+.5*f,y=d*m-d*p,b=0;b!==a;++b)i[b]=g*o[u+b]+_*o[l+b]+v*o[s+b]+y*o[c+b];return i}}),pu.prototype=Object.assign(Object.create(du.prototype),{constructor:pu,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=e*a,l=s-a,u=(n-t)/(r-t),c=1-u,h=0;h!==a;++h)i[h]=o[l+h]*c+o[s+h]*u;return i}}),mu.prototype=Object.assign(Object.create(du.prototype),{constructor:mu,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(gu,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:hu.convertArray(e.times,Array),values:hu.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(gu.prototype,{constructor:gu,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ut,InterpolantFactoryMethodDiscrete:function(e){return new mu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new pu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new fu(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Bt:t=this.InterpolantFactoryMethodDiscrete;break;case Ut:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Bt;case this.InterpolantFactoryMethodLinear:return Ut;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=hu.arraySlice(n,i,o),this.values=hu.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),e=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),e=!1;break}o=s}if(void 0!==r&&hu.isTypedArray(r))for(var l=0,u=r.length;l!==u;++l){var c=r[l];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,c),e=!1;break}}return e},optimize:function(){for(var e=hu.arraySlice(this.times),t=hu.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),i=e.length-1,o=1,a=1;a<i;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==e[0]))if(r)s=!0;else for(var u=a*n,c=u-n,h=u+n,d=0;d!==n;++d){var f=t[u+d];if(f!==t[c+d]||f!==t[h+d]){s=!0;break}}if(s){if(a!==o){e[o]=e[a];for(var p=a*n,m=o*n,g=0;g!==n;++g)t[m+g]=t[p+g]}++o}}if(i>0){e[o]=e[i];for(var _=i*n,v=o*n,y=0;y!==n;++y)t[v+y]=t[_+y];++o}return o!==e.length?(this.times=hu.arraySlice(e,0,o),this.values=hu.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this},clone:function(){var e=hu.arraySlice(this.times,0),t=hu.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),_u.prototype=Object.assign(Object.create(gu.prototype),{constructor:_u,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Bt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),vu.prototype=Object.assign(Object.create(gu.prototype),{constructor:vu,ValueTypeName:"color"}),yu.prototype=Object.assign(Object.create(gu.prototype),{constructor:yu,ValueTypeName:"number"}),bu.prototype=Object.assign(Object.create(du.prototype),{constructor:bu,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-t)/(r-t),l=e*a,u=l+a;l!==u;l+=4)En.slerpFlat(i,0,o,l-a,o,l,s);return i}}),Eu.prototype=Object.assign(Object.create(gu.prototype),{constructor:Eu,ValueTypeName:"quaternion",DefaultInterpolation:Ut,InterpolantFactoryMethodLinear:function(e){return new bu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),xu.prototype=Object.assign(Object.create(gu.prototype),{constructor:xu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Bt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Tu.prototype=Object.assign(Object.create(gu.prototype),{constructor:Tu,ValueTypeName:"vector"}),Object.assign(Su,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,o=n.length;i!==o;++i)t.push(Au(n[i]).scale(r));var a=new Su(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,o=n.length;i!==o;++i)t.push(gu.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var u=hu.getKeyframeOrder(s);s=hu.sortedArray(s,1,u),l=hu.sortedArray(l,1,u),r||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new yu(".morphTargetInfluences["+t[a].name+"]",s,l).scale(1/n))}return new Su(e,-1,o)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(i);if(l&&l.length>1){var u=l[1],c=r[u];c||(r[u]=c=[]),c.push(s)}}var h=[];for(var d in r)h.push(Su.CreateFromMorphTargetSequence(d,r[d],t,n));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var o=[],a=[];hu.flattenJSON(n,o,a,r),0!==o.length&&i.push(new e(t,o,a))}},r=[],i=e.name||"default",o=e.fps||30,a=e.blendMode,s=e.length||-1,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},d=void 0;for(d=0;d<c.length;d++)if(c[d].morphTargets)for(var f=0;f<c[d].morphTargets.length;f++)h[c[d].morphTargets[f]]=-1;for(var p in h){for(var m=[],g=[],_=0;_!==c[d].morphTargets.length;++_){var v=c[d];m.push(v.time),g.push(v.morphTarget===p?1:0)}r.push(new yu(".morphTargetInfluence["+p+"]",m,g))}s=h.length*(o||1)}else{var y=".bones["+t[u].name+"]";n(Tu,y+".position",c,"pos",r),n(Eu,y+".quaternion",c,"rot",r),n(Tu,y+".scale",c,"scl",r)}}return 0===r.length?null:new Su(i,s,r,a)}}),Object.assign(Su.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Su(this.name,this.duration,e,this.blendMode)},toJSON:function(){return Su.toJSON(this)}});var Pu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Mu(e,t,n){var r=this,i=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,a),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var Ru=new Mu;function Cu(e){this.manager=void 0!==e?e:Ru,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Cu.prototype,{load:function(){},loadAsync:function(e,t){var n=this;return new Promise(function(r,i){n.load(e,r,t,i)})},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var wu={};function Ou(e){Cu.call(this,e)}function Iu(e){Cu.call(this,e)}function Du(e){Cu.call(this,e)}function Lu(e){Cu.call(this,e)}function Fu(e){Cu.call(this,e)}function Nu(e){Cu.call(this,e)}function Bu(e){Cu.call(this,e)}function Uu(){this.type="Curve",this.arcLengthDivisions=200}function ku(e,t,n,r,i,o,a,s){Uu.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Vu(e,t,n,r,i,o){ku.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function Gu(){var e=0,t=0,n=0,r=0;function i(i,o,a,s){e=i,t=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,a,s){var l=(t-e)/o-(n-e)/(o+a)+(n-t)/a,u=(n-t)/a-(r-t)/(a+s)+(r-n)/s;i(t,n,l*=a,u*=a)},calc:function(i){var o=i*i;return e+t*i+n*o+r*(o*i)}}}Ou.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Ou,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Pu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;if(void 0===wu[e]){var a,s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var l=s[1],u=!!s[2],c=s[3];c=decodeURIComponent(c),u&&(c=atob(c));try{var h,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var f=new Uint8Array(c.length),p=0;p<c.length;p++)f[p]=c.charCodeAt(p);h="blob"===d?new Blob([f.buffer],{type:l}):f.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(c,l);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout(function(){t&&t(h),i.manager.itemEnd(e)},0)}catch(_){setTimeout(function(){r&&r(_),i.manager.itemError(e),i.manager.itemEnd(e)},0)}}else{for(var g in wu[e]=[],wu[e].push({onLoad:t,onProgress:n,onError:r}),(a=new XMLHttpRequest).open("GET",e,!0),a.addEventListener("load",function(t){var n=this.response,r=wu[e];if(delete wu[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Pu.add(e,n);for(var o=0,a=r.length;o<a;o++){var s=r[o];s.onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(var l=0,u=r.length;l<u;l++){var c=r[l];c.onError&&c.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}},!1),a.addEventListener("progress",function(t){for(var n=wu[e],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(t)}},!1),a.addEventListener("error",function(t){var n=wu[e];delete wu[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),a.addEventListener("abort",function(t){var n=wu[e];delete wu[e];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)},!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)a.setRequestHeader(g,this.requestHeader[g]);a.send(null)}return i.manager.itemStart(e),a}wu[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),Iu.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Iu,load:function(e,t,n,r){var i=this,o=new Ou(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(e)}},n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=Su.parse(e[n]);t.push(r)}return t}}),Du.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Du,load:function(e,t,n,r){var i=this,o=[],a=new gl,s=new Ou(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);var l=0;function u(u){s.load(e[u],function(e){var n=i.parse(e,!0);o[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(a.minFilter=xe),a.image=o,a.format=n.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(var c=0,h=e.length;c<h;++c)u(c);else s.load(e,function(e){var n=i.parse(e,!0);if(n.isCubemap){for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}a.image=o}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=xe),a.format=n.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}}),Lu.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Lu,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Pu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Pu.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}),Fu.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Fu,load:function(e,t,n,r){var i=new qi,o=new Lu(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(e[n],function(e){i.images[n]=e,6===++a&&(i.needsUpdate=!0,t&&t(i))},void 0,r)}for(var l=0;l<e.length;++l)s(l);return i}}),Nu.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Nu,load:function(e,t,n,r){var i=this,o=new Zi,a=new Ou(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(e,function(e){var n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:_e,o.wrapT=void 0!==n.wrapT?n.wrapT:_e,o.magFilter=void 0!==n.magFilter?n.magFilter:xe,o.minFilter=void 0!==n.minFilter?n.minFilter:xe,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=Se),1===n.mipmapCount&&(o.minFilter=xe),o.needsUpdate=!0,t&&t(o,n))},n,r),o}}),Bu.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Bu,load:function(e,t,n,r){var i=new _n,o=new Lu(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?Ue:ke,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}),Object.assign(Uu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),i=0;n.push(0);for(var o=1;o<=e;o++)i+=(t=this.getPoint(o/e)).distanceTo(r),n.push(i),r=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[i=Math.floor(s+(l-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(r[i=l]===n)return i/(o-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(o-1)},getTangent:function(e,t){var n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),o=this.getPoint(r),a=t||(i.isVector2?new fn:new xn);return a.copy(o).sub(i).normalize(),a},getTangentAt:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){for(var n=new xn,r=[],i=[],o=[],a=new xn,s=new Qn,l=0;l<=e;l++){var u=l/e;r[l]=this.getTangentAt(u,new xn),r[l].normalize()}i[0]=new xn,o[0]=new xn;var c=Number.MAX_VALUE,h=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);h<=c&&(c=h,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),f<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(var p=1;p<=e;p++){if(i[p]=i[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(r[p-1],r[p]),a.length()>Number.EPSILON){a.normalize();var m=Math.acos(dn.clamp(r[p-1].dot(r[p]),-1,1));i[p].applyMatrix4(s.makeRotationAxis(a,m))}o[p].crossVectors(r[p],i[p])}if(!0===t){var g=Math.acos(dn.clamp(i[0].dot(i[e]),-1,1));g/=e,r[0].dot(a.crossVectors(i[0],i[e]))>0&&(g=-g);for(var _=1;_<=e;_++)i[_].applyMatrix4(s.makeRotationAxis(r[_],g*_)),o[_].crossVectors(r[_],i[_])}return{tangents:r,normals:i,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),ku.prototype=Object.create(Uu.prototype),ku.prototype.constructor=ku,ku.prototype.isEllipseCurve=!0,ku.prototype.getPoint=function(e,t){for(var n=t||new fn,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return n.set(s,l)},ku.prototype.copy=function(e){return Uu.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ku.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},ku.prototype.fromJSON=function(e){return Uu.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Vu.prototype=Object.create(ku.prototype),Vu.prototype.constructor=Vu,Vu.prototype.isArcCurve=!0;var zu=new xn,ju=new Gu,Hu=new Gu,Wu=new Gu;function Xu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;Uu.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}function Yu(e,t,n,r,i){var o=.5*(r-t),a=.5*(i-n),s=e*e;return(2*n-2*r+o+a)*(e*s)+(-3*n+3*r-2*o-a)*s+o*e+n}function Ku(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function qu(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function Qu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new fn,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new fn;Uu.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function Zu(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new xn,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new xn;Uu.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function Ju(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fn;Uu.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function $u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xn;Uu.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function ec(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new fn;Uu.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}function tc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new xn;Uu.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}function nc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Uu.call(this),this.type="SplineCurve",this.points=e}Xu.prototype=Object.create(Uu.prototype),Xu.prototype.constructor=Xu,Xu.prototype.isCatmullRomCurve3=!0,Xu.prototype.getPoint=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xn,i=this.points,o=i.length,a=(o-(this.closed?0:1))*e,s=Math.floor(a),l=a-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/o)+1)*o:0===l&&s===o-1&&(s=o-2,l=1),this.closed||s>0?t=i[(s-1)%o]:(zu.subVectors(i[0],i[1]).add(i[0]),t=zu);var u=i[s%o],c=i[(s+1)%o];if(this.closed||s+2<o?n=i[(s+2)%o]:(zu.subVectors(i[o-1],i[o-2]).add(i[o-1]),n=zu),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(u),h),f=Math.pow(u.distanceToSquared(c),h),p=Math.pow(c.distanceToSquared(n),h);f<1e-4&&(f=1),d<1e-4&&(d=f),p<1e-4&&(p=f),ju.initNonuniformCatmullRom(t.x,u.x,c.x,n.x,d,f,p),Hu.initNonuniformCatmullRom(t.y,u.y,c.y,n.y,d,f,p),Wu.initNonuniformCatmullRom(t.z,u.z,c.z,n.z,d,f,p)}else"catmullrom"===this.curveType&&(ju.initCatmullRom(t.x,u.x,c.x,n.x,this.tension),Hu.initCatmullRom(t.y,u.y,c.y,n.y,this.tension),Wu.initCatmullRom(t.z,u.z,c.z,n.z,this.tension));return r.set(ju.calc(l),Hu.calc(l),Wu.calc(l)),r},Xu.prototype.copy=function(e){Uu.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Xu.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Xu.prototype.fromJSON=function(e){Uu.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new xn).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Qu.prototype=Object.create(Uu.prototype),Qu.prototype.constructor=Qu,Qu.prototype.isCubicBezierCurve=!0,Qu.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fn,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return t.set(qu(e,n.x,r.x,i.x,o.x),qu(e,n.y,r.y,i.y,o.y)),t},Qu.prototype.copy=function(e){return Uu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Qu.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Qu.prototype.fromJSON=function(e){return Uu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Zu.prototype=Object.create(Uu.prototype),Zu.prototype.constructor=Zu,Zu.prototype.isCubicBezierCurve3=!0,Zu.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xn,n=this.v0,r=this.v1,i=this.v2,o=this.v3;return t.set(qu(e,n.x,r.x,i.x,o.x),qu(e,n.y,r.y,i.y,o.y),qu(e,n.z,r.z,i.z,o.z)),t},Zu.prototype.copy=function(e){return Uu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Zu.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Zu.prototype.fromJSON=function(e){return Uu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ju.prototype=Object.create(Uu.prototype),Ju.prototype.constructor=Ju,Ju.prototype.isLineCurve=!0,Ju.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fn;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Ju.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ju.prototype.getTangent=function(e,t){var n=t||new fn;return n.copy(this.v2).sub(this.v1).normalize(),n},Ju.prototype.copy=function(e){return Uu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ju.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ju.prototype.fromJSON=function(e){return Uu.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},$u.prototype=Object.create(Uu.prototype),$u.prototype.constructor=$u,$u.prototype.isLineCurve3=!0,$u.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xn;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},$u.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},$u.prototype.copy=function(e){return Uu.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},$u.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},$u.prototype.fromJSON=function(e){return Uu.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ec.prototype=Object.create(Uu.prototype),ec.prototype.constructor=ec,ec.prototype.isQuadraticBezierCurve=!0,ec.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fn,n=this.v0,r=this.v1,i=this.v2;return t.set(Ku(e,n.x,r.x,i.x),Ku(e,n.y,r.y,i.y)),t},ec.prototype.copy=function(e){return Uu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ec.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ec.prototype.fromJSON=function(e){return Uu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},tc.prototype=Object.create(Uu.prototype),tc.prototype.constructor=tc,tc.prototype.isQuadraticBezierCurve3=!0,tc.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new xn,n=this.v0,r=this.v1,i=this.v2;return t.set(Ku(e,n.x,r.x,i.x),Ku(e,n.y,r.y,i.y),Ku(e,n.z,r.z,i.z)),t},tc.prototype.copy=function(e){return Uu.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},tc.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},tc.prototype.fromJSON=function(e){return Uu.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},nc.prototype=Object.create(Uu.prototype),nc.prototype.constructor=nc,nc.prototype.isSplineCurve=!0,nc.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fn,n=this.points,r=(n.length-1)*e,i=Math.floor(r),o=r-i,a=n[0===i?i:i-1],s=n[i],l=n[i>n.length-2?n.length-1:i+1],u=n[i>n.length-3?n.length-1:i+2];return t.set(Yu(o,a.x,s.x,l.x,u.x),Yu(o,a.y,s.y,l.y,u.y)),t},nc.prototype.copy=function(e){Uu.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},nc.prototype.toJSON=function(){var e=Uu.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},nc.prototype.fromJSON=function(e){Uu.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new fn).fromArray(r))}return this};var rc=Object.freeze({__proto__:null,ArcCurve:Vu,CatmullRomCurve3:Xu,CubicBezierCurve:Qu,CubicBezierCurve3:Zu,EllipseCurve:ku,LineCurve:Ju,LineCurve3:$u,QuadraticBezierCurve:ec,QuadraticBezierCurve3:tc,SplineCurve:nc});function ic(){Uu.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function oc(e){ic.call(this),this.type="Path",this.currentPoint=new fn,e&&this.setFromPoints(e)}function ac(e){oc.call(this,e),this.uuid=dn.generateUUID(),this.type="Shape",this.holes=[]}function sc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Er.call(this),this.type="Light",this.color=new jr(e),this.intensity=t}function lc(e,t,n){sc.call(this,e,n),this.type="HemisphereLight",this.position.copy(Er.DefaultUp),this.updateMatrix(),this.groundColor=new jr(t)}function uc(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new fn(512,512),this.map=null,this.mapPass=null,this.matrix=new Qn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new eo,this._frameExtents=new fn(1,1),this._viewportCount=1,this._viewports=[new yn(0,0,1,1)]}function cc(){uc.call(this,new Wi(50,1,.5,500)),this.focus=1}function hc(e,t,n,r,i,o){sc.call(this,e,t),this.type="SpotLight",this.position.copy(Er.DefaultUp),this.updateMatrix(),this.target=new Er,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new cc}function dc(){uc.call(this,new Wi(90,1,.5,500)),this._frameExtents=new fn(4,2),this._viewportCount=6,this._viewports=[new yn(2,1,1,1),new yn(0,1,1,1),new yn(3,1,1,1),new yn(1,1,1,1),new yn(3,0,1,1),new yn(1,0,1,1)],this._cubeDirections=[new xn(1,0,0),new xn(-1,0,0),new xn(0,0,1),new xn(0,0,-1),new xn(0,1,0),new xn(0,-1,0)],this._cubeUps=[new xn(0,1,0),new xn(0,1,0),new xn(0,1,0),new xn(0,1,0),new xn(0,0,1),new xn(0,0,-1)]}function fc(e,t,n,r){sc.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new dc}function pc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;Hi.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}function mc(){uc.call(this,new pc(-5,5,5,-5,.5,500))}function gc(e,t){sc.call(this,e,t),this.type="DirectionalLight",this.position.copy(Er.DefaultUp),this.updateMatrix(),this.target=new Er,this.shadow=new mc}function _c(e,t){sc.call(this,e,t),this.type="AmbientLight"}function vc(e,t,n,r){sc.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}ic.prototype=Object.assign(Object.create(Uu.prototype),{constructor:ic,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ju(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,o=this.curves[r],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Uu.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Uu.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Uu.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new rc[r.type]).fromJSON(r))}return this}}),oc.prototype=Object.assign(Object.create(ic.prototype),{constructor:oc,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Ju(this.currentPoint.clone(),new fn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new ec(this.currentPoint.clone(),new fn(e,t),new fn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,o){var a=new Qu(this.currentPoint.clone(),new fn(e,t),new fn(n,r),new fn(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(e){var t=new nc([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,r,i,o),this},absarc:function(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this},ellipse:function(e,t,n,r,i,o,a,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,r,i,o,a,s),this},absellipse:function(e,t,n,r,i,o,a,s){var l=new ku(e,t,n,r,i,o,a,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return ic.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=ic.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return ic.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),ac.prototype=Object.assign(Object.create(oc.prototype),{constructor:ac,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){oc.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=oc.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){oc.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new oc).fromJSON(r))}return this}}),sc.prototype=Object.assign(Object.create(Er.prototype),{constructor:sc,isLight:!0,copy:function(e){return Er.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Er.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),lc.prototype=Object.assign(Object.create(sc.prototype),{constructor:lc,isHemisphereLight:!0,copy:function(e){return sc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(uc.prototype,{_projScreenMatrix:new Qn,_lightPositionWorld:new xn,_lookTarget:new xn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),cc.prototype=Object.assign(Object.create(uc.prototype),{constructor:cc,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*dn.RAD2DEG*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),uc.prototype.updateMatrices.call(this,e)}}),hc.prototype=Object.assign(Object.create(sc.prototype),{constructor:hc,isSpotLight:!0,copy:function(e){return sc.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),dc.prototype=Object.assign(Object.create(uc.prototype),{constructor:dc,isPointLightShadow:!0,updateMatrices:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),o.copy(n.position),o.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),fc.prototype=Object.assign(Object.create(sc.prototype),{constructor:fc,isPointLight:!0,copy:function(e){return sc.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),pc.prototype=Object.assign(Object.create(Hi.prototype),{constructor:pc,isOrthographicCamera:!0,copy:function(e,t){return Hi.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,o=n+e,a=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(i+=l*this.view.offsetX)+l*this.view.width,s=(a-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){var t=Er.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),mc.prototype=Object.assign(Object.create(uc.prototype),{constructor:mc,isDirectionalLightShadow:!0,updateMatrices:function(e){uc.prototype.updateMatrices.call(this,e)}}),gc.prototype=Object.assign(Object.create(sc.prototype),{constructor:gc,isDirectionalLight:!0,copy:function(e){return sc.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),_c.prototype=Object.assign(Object.create(sc.prototype),{constructor:_c,isAmbientLight:!0}),vc.prototype=Object.assign(Object.create(sc.prototype),{constructor:vc,isRectAreaLight:!0,copy:function(e){return sc.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=sc.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var yc=function(){function e(){Object(f.a)(this,e),Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new xn)}return Object(p.a)(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}]),e}();function bc(e,t){sc.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new yc}function Ec(e){Cu.call(this,e),this.textures={}}bc.prototype=Object.assign(Object.create(sc.prototype),{constructor:bc,isLightProbe:!0,copy:function(e){return sc.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){var t=sc.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),Ec.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Ec,load:function(e,t,n,r){var i=this,o=new Ou(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(e)}},n,r)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new cu[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new jr).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var i in e.uniforms){var o=e.uniforms[i];switch(r.uniforms[i]={},o.type){case"t":r.uniforms[i].value=n(o.value);break;case"c":r.uniforms[i].value=(new jr).setHex(o.value);break;case"v2":r.uniforms[i].value=(new fn).fromArray(o.value);break;case"v3":r.uniforms[i].value=(new xn).fromArray(o.value);break;case"v4":r.uniforms[i].value=(new yn).fromArray(o.value);break;case"m3":r.uniforms[i].value=(new pn).fromArray(o.value);break;case"m4":r.uniforms[i].value=(new Qn).fromArray(o.value);break;default:r.uniforms[i].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var a in e.extensions)r.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new fn).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new fn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});var xc={decodeText:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(i){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function Tc(){_i.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Sc(e,t,n,r){"number"===typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Qr.call(this,e,t,n),this.meshPerAttribute=r||1}function Ac(e){Cu.call(this,e)}Tc.prototype=Object.assign(Object.create(_i.prototype),{constructor:Tc,isInstancedBufferGeometry:!0,copy:function(e){return _i.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=_i.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),Sc.prototype=Object.assign(Object.create(Qr.prototype),{constructor:Sc,isInstancedBufferAttribute:!0,copy:function(e){return Qr.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Qr.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Ac.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Ac,load:function(e,t,n,r){var i=this,o=new Ou(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),i.manager.itemError(e)}},n,r)},parse:function(e){var t={},n={};function r(e,r){if(void 0!==t[r])return t[r];var i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];var r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),a=new ps(ui(i.type,o),i.stride);return a.uuid=i.uuid,t[r]=a,a}var i=e.isInstancedBufferGeometry?new Tc:new _i,o=e.data.index;if(void 0!==o){var a=ui(o.type,o.array);i.setIndex(new Qr(a,1))}var s=e.data.attributes;for(var l in s){var u=s[l],c=void 0;if(u.isInterleavedBufferAttribute){c=new _s(r(e.data,u.data),u.itemSize,u.offset,u.normalized)}else{var h=ui(u.type,u.array);c=new(u.isInstancedBufferAttribute?Sc:Qr)(h,u.itemSize,u.normalized)}void 0!==u.name&&(c.name=u.name),i.setAttribute(l,c)}var d=e.data.morphAttributes;if(d)for(var f in d){for(var p=d[f],m=[],g=0,_=p.length;g<_;g++){var v=p[g],y=void 0;if(v.isInterleavedBufferAttribute)y=new _s(r(e.data,v.data),v.itemSize,v.offset,v.normalized);else y=new Qr(ui(v.type,v.array),v.itemSize,v.normalized);void 0!==v.name&&(y.name=v.name),m.push(y)}i.morphAttributes[f]=m}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var b=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==b)for(var E=0,x=b.length;E!==x;++E){var T=b[E];i.addGroup(T.start,T.count,T.materialIndex)}var S=e.data.boundingSphere;if(void 0!==S){var A=new xn;void 0!==S.center&&A.fromArray(S.center),i.boundingSphere=new Gn(A,S.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}});function Pc(e){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Cu.call(this,e),this.options={premultiplyAlpha:"none"}}function Mc(){this.type="ShapePath",this.color=new jr,this.subPaths=[],this.currentPath=null}Pc.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Pc,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=Pu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;var a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,i.options)}).then(function(n){Pu.add(e,n),t&&t(n),i.manager.itemEnd(e)}).catch(function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)}}),Object.assign(Mc.prototype,{moveTo:function(e,t){return this.currentPath=new oc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],o=new ac;o.curves=i.curves,t.push(o)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=t[i],s=t[o],l=s.x-a.x,u=s.y-a.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(a=t[o],l=-l,s=t[i],u=-u),e.y<a.y||e.y>s.y)continue;if(e.y===a.y){if(e.x===a.x)return!0}else{var c=u*(e.x-a.x)-l*(e.y-a.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==a.y)continue;if(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x)return!0}}return r}var i,o,a,s=Xl.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return n(l);var u=[];if(1===l.length)return o=l[0],(a=new ac).curves=o.curves,u.push(a),u;var c=!s(l[0].getPoints());c=e?!c:c;var h,d,f=[],p=[],m=[],g=0;p[g]=void 0,m[g]=[];for(var _=0,v=l.length;_<v;_++)i=s(h=(o=l[_]).getPoints()),(i=e?!i:i)?(!c&&p[g]&&g++,p[g]={s:new ac,p:h},p[g].s.curves=o.curves,c&&g++,m[g]=[]):m[g].push({h:o,p:h[0]});if(!p[0])return n(l);if(p.length>1){for(var y=!1,b=[],E=0,x=p.length;E<x;E++)f[E]=[];for(var T=0,S=p.length;T<S;T++)for(var A=m[T],P=0;P<A.length;P++){for(var M=A[P],R=!0,C=0;C<p.length;C++)r(M.p,p[C].p)&&(T!==C&&b.push({froms:T,tos:C,hole:P}),R?(R=!1,f[C].push(M)):y=!0);R&&f[T].push(M)}b.length>0&&(y||(m=f))}for(var w=0,O=p.length;w<O;w++){a=p[w].s,u.push(a);for(var I=0,D=(d=m[w]).length;I<D;I++)a.holes.push(d[I].h)}return u}});var Rc,Cc=function(){function e(t){Object(f.a)(this,e),Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=t}return Object(p.a)(e,[{key:"generateShapes",value:function(e){for(var t=[],n=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[],s=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)s=0,l-=o;else{var h=wc(c,i,s,l,n);s+=h.offsetX,a.push(h.path)}}return a}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,this.data),r=0,i=n.length;r<i;r++)Array.prototype.push.apply(t,n[r].toShapes());return t}}]),e}();function wc(e,t,n,r,i){var o=i.glyphs[e]||i.glyphs["?"];if(o){var a,s,l,u,c,h,d,f,p=new Mc;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,_=m.length;g<_;){switch(m[g++]){case"m":a=m[g++]*t+n,s=m[g++]*t+r,p.moveTo(a,s);break;case"l":a=m[g++]*t+n,s=m[g++]*t+r,p.lineTo(a,s);break;case"q":l=m[g++]*t+n,u=m[g++]*t+r,c=m[g++]*t+n,h=m[g++]*t+r,p.quadraticCurveTo(c,h,l,u);break;case"b":l=m[g++]*t+n,u=m[g++]*t+r,c=m[g++]*t+n,h=m[g++]*t+r,d=m[g++]*t+n,f=m[g++]*t+r,p.bezierCurveTo(c,h,d,f,l,u)}}return{offsetX:o.ha*t,path:p}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function Oc(e){Cu.call(this,e)}Oc.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Oc,load:function(e,t,n,r){var i=this,o=new Ou(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,function(e){var n;try{n=JSON.parse(e)}catch(o){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)},n,r)},parse:function(e){return new Cc(e)}});var Ic={getContext:function(){return void 0===Rc&&(Rc=new(window.AudioContext||window.webkitAudioContext)),Rc},setContext:function(e){Rc=e}};function Dc(e){Cu.call(this,e)}function Lc(e,t,n){bc.call(this,void 0,n);var r=(new jr).set(e),i=(new jr).set(t),o=new xn(r.r,r.g,r.b),a=new xn(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function Fc(e,t){bc.call(this,void 0,t);var n=(new jr).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Dc.prototype=Object.assign(Object.create(Cu.prototype),{constructor:Dc,load:function(e,t,n,r){var i=this,o=new Ou(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,function(n){try{var o=n.slice(0);Ic.getContext().decodeAudioData(o,function(e){t(e)})}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}},n,r)}}),Lc.prototype=Object.assign(Object.create(bc.prototype),{constructor:Lc,isHemisphereLightProbe:!0,copy:function(e){return bc.prototype.copy.call(this,e),this},toJSON:function(e){return bc.prototype.toJSON.call(this,e)}}),Fc.prototype=Object.assign(Object.create(bc.prototype),{constructor:Fc,isAmbientLightProbe:!0,copy:function(e){return bc.prototype.copy.call(this,e),this},toJSON:function(e){return bc.prototype.toJSON.call(this,e)}});var Nc=new Qn,Bc=new Qn;Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Wi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Wi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),o=t.eyeSep/2,a=o*t.near/t.focus,s=t.near*Math.tan(dn.DEG2RAD*t.fov*.5)/t.zoom;Bc.elements[12]=-o,Nc.elements[12]=o,n=-s*t.aspect+a,r=s*t.aspect+a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-a,r=s*t.aspect-a,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Bc),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Nc)}});var Uc=function(){function e(t){Object(f.a)(this,e),this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Object(p.a)(e,[{key:"start",value:function(){this.startTime=kc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=kc();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function kc(){return("undefined"===typeof performance?Date:performance).now()}var Vc=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(u.a)(this,Object(c.a)(t).call(this))).type="Audio",n.listener=e,n.context=e.context,n.gain=n.context.createGain(),n.gain.connect(e.getInput()),n.autoplay=!1,n.buffer=null,n.detune=0,n.loop=!1,n.loopStart=0,n.loopEnd=0,n.offset=0,n.duration=void 0,n.playbackRate=1,n.isPlaying=!1,n.hasPlaybackControl=!0,n.source=null,n.sourceType="empty",n._startedAt=0,n._progress=0,n._connected=!1,n.filters=[],n}return Object(d.a)(t,e),Object(p.a)(t,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),t}(Er),Gc=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;Object(f.a)(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return Object(p.a)(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}();function zc(e,t,n){var r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(zc.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=t}else{var s=t/(o+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=o},accumulateAdditive:function(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=t*this._origIndex;this._mixBufferRegion(n,r,s,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(var l=t,u=t+t;l!==u;++l)if(n[l]!==n[l+t]){a.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(var i=n,o=r;i!==o;++i)t[i]=t[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,r){En.slerpFlat(e,t,e,t,e,n,r)},_slerpAdditive:function(e,t,n,r,i){var o=this._workIndex*i;En.multiplyQuaternionsFlat(e,o,e,t,e,n),En.slerpFlat(e,t,e,t,e,o,r)},_lerp:function(e,t,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=t+a;e[s]=e[s]*o+e[n+a]*r}},_lerpAdditive:function(e,t,n,r,i){for(var o=0;o!==i;++o){var a=t+o;e[a]=e[a]+e[n+o]*r}}});var jc=new RegExp("[\\[\\]\\.:\\/]","g"),Hc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Wc=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Xc=/(WCOD+)?/.source.replace("WCOD",Hc),Yc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Kc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),qc=new RegExp("^"+Wc+Xc+Yc+Kc+"$"),Qc=["material","materials","bones"];function Zc(e,t,n){var r=n||Jc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Jc(e,t,n){this.path=t,this.parsedPath=n||Jc.parseTrackName(t),this.node=Jc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(Zc.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Jc,{Composite:Zc,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Jc.Composite(e,t,n):new Jc(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(jc,"")},parseTrackName:function(e){var t=qc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Qc.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===t||i.uuid===t)return i;var o=e(i.children);if(o)return o}return null}(e.children);if(r)return r}return null}}),Object.assign(Jc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=Jc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var a=0;a<e.length;a++)if(e[a].name===o){o=a;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Jc.prototype,{_getValue_unbound:Jc.prototype.getValue,_setValue_unbound:Jc.prototype.setValue}),Object.assign(function(){this.uuid=dn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length,a=void 0,s=e.length,l=this.nCachedObjects_,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,f=t[d];if(void 0===f){f=s++,t[d]=f,e.push(h);for(var p=0,m=o;p!==m;++p)i[p].push(new Jc(h,n[p],r[p]))}else if(f<l){a=e[f];var g=--l,_=e[g];t[_.uuid]=f,e[f]=_,t[d]=g,e[g]=h;for(var v=0,y=o;v!==y;++v){var b=i[v],E=b[g],x=b[f];b[f]=E,void 0===x&&(x=new Jc(h,n[v],r[v])),b[g]=x}}else e[f]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,u=t[l];if(void 0!==u&&u>=i){var c=i++,h=e[c];t[h.uuid]=u,e[u]=h,t[l]=c,e[c]=s;for(var d=0,f=r;d!==f;++d){var p=n[d],m=p[c],g=p[u];p[u]=m,p[c]=g}}}this.nCachedObjects_=i},uncache:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,o=e.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,u=t[l];if(void 0!==u)if(delete t[l],u<i){var c=--i,h=e[c],d=--o,f=e[d];t[h.uuid]=u,e[u]=h,t[f.uuid]=c,e[c]=f,e.pop();for(var p=0,m=r;p!==m;++p){var g=n[p],_=g[c],v=g[d];g[u]=_,g[c]=v,g.pop()}}else{var y=--o,b=e[y];y>0&&(t[b.uuid]=u),e[u]=b,e.pop();for(var E=0,x=r;E!==x;++E){var T=n[E];T[u]=T[y],T.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);r=i.length,n[e]=r,o.push(e),a.push(t),i.push(c);for(var h=u,d=s.length;h!==d;++h){var f=s[h];c[h]=new Jc(f,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}});var $c=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;Object(f.a)(this,e),this._mixer=t,this._clip=n,this._localRoot=r,this.blendMode=i;for(var o=n.tracks,a=o.length,s=new Array(a),l={endingStart:kt,endingEnd:kt},u=0;u!==a;++u){var c=o[u].createInterpolant(null);s[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Nt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return Object(p.a)(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,o=i/r,a=r/i;e.warp(1,o,t),this.warp(a,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var r=this._mixer,i=r.time,o=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/o,l[1]=t/o,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*n;if(o<0||0===n)return;this._startTime=null,t=n*o}t*=this._updateTimeScale(e);var a=this._updateTime(t),s=this._updateWeight(e);if(s>0){var l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case 2501:for(var c=0,h=l.length;c!==h;++c)l[c].evaluate(a),u[c].accumulateAdditive(s);break;case Vt:default:for(var d=0,f=l.length;d!==f;++d)l[d].evaluate(a),u[d].accumulate(r,s)}}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,r=this.time+e,i=this._loopCount,o=2202===n;if(0===e)return-1===i?r:o&&1===(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){var a=Math.floor(r/t);r-=t*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&1===(1&i))return t-r}return r}},{key:"_setEndings",value:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:kt:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:kt:2402)}},{key:"_scheduleFading",value:function(e,t,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=t,a[1]=i+e,s[1]=n,this}}]),e}();function eh(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}eh.prototype=Object.assign(Object.create(sn.prototype),{constructor:eh,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,a=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==i;++c){var h=r[c],d=h.name,f=u[d];if(void 0!==f)o[c]=f;else{if(void 0!==(f=o[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new zc(Jc.create(n,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),o[c]=f}a[c].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=this._bindings,o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new pu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){var r=t||this._root,i=r.uuid,o="string"===typeof e?Su.findByName(r,e):e,a=null!==o?o.uuid:e,s=this._actionsByClip[a],l=null;if(void 0===n&&(n=null!==o?o.blendMode:Vt),void 0!==s){var u=s.actionByRoot[i];if(void 0!==u&&u.blendMode===n)return u;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;var c=new $c(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,a,i),c},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"===typeof e?Su.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,a=0;a!==n;++a){t[a]._update(r,e,i,o)}for(var s=this._bindings,l=this._nActiveBindings,u=0;u!==l;++u)s[u].apply(o);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});var th=function(){function e(t){Object(f.a)(this,e),"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return Object(p.a)(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}();function nh(e,t,n){ps.call(this,e,t),this.meshPerAttribute=n||1}function rh(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function ih(e,t,n,r){this.ray=new qn(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new sr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function oh(e,t){return e.distance-t.distance}function ah(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var i=e.children,o=0,a=i.length;o<a;o++)ah(i[o],t,n,!0)}nh.prototype=Object.assign(Object.create(ps.prototype),{constructor:nh,isInstancedInterleavedBuffer:!0,copy:function(e){return ps.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){var t=ps.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){var t=ps.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(rh.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(rh.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(ih.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,n){var r=n||[];return ah(e,this,r,t),r.sort(oh),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,o=e.length;i<o;i++)ah(e[i],this,r,t);return r.sort(oh),r}});var sh=new fn,lh=function(){function e(t,n){Object(f.a)(this,e),Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new fn(1/0,1/0),this.max=void 0!==n?n:new fn(-1/0,-1/0)}return Object(p.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=sh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new fn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new fn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new fn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new fn),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return sh.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),uh=new xn,ch=new xn,hh=function(){function e(t,n){Object(f.a)(this,e),this.start=void 0!==t?t:new xn,this.end=void 0!==n?n:new xn}return Object(p.a)(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new xn),e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new xn),e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new xn),this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){uh.subVectors(e,this.start),ch.subVectors(this.end,this.start);var n=ch.dot(ch),r=ch.dot(uh)/n;return t&&(r=dn.clamp(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new xn),this.delta(n).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}();function dh(e){Er.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}dh.prototype=Object.create(Er.prototype),dh.prototype.constructor=dh,dh.prototype.isImmediateRenderObject=!0;var fh=new xn,ph=new Qn,mh=new Qn,gh=function(e){function t(e){var n;Object(f.a)(this,t);for(var r=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),i=new _i,o=[],a=[],s=new jr(0,0,1),l=new jr(0,1,0),h=0;h<r.length;h++){var d=r[h];d.parent&&d.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),a.push(s.r,s.g,s.b),a.push(l.r,l.g,l.b))}i.setAttribute("position",new oi(o,3)),i.setAttribute("color",new oi(a,3));var p=new Zs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(n=Object(u.a)(this,Object(c.a)(t).call(this,i,p))).type="SkeletonHelper",n.isSkeletonHelper=!0,n.root=e,n.bones=r,n.matrix=e.matrixWorld,n.matrixAutoUpdate=!1,n}return Object(d.a)(t,e),Object(p.a)(t,[{key:"updateMatrixWorld",value:function(e){var n=this.bones,r=this.geometry,i=r.getAttribute("position");mh.copy(this.root.matrixWorld).invert();for(var o=0,a=0;o<n.length;o++){var s=n[o];s.parent&&s.parent.isBone&&(ph.multiplyMatrices(mh,s.matrixWorld),fh.setFromMatrixPosition(ph),i.setXYZ(a,fh.x,fh.y,fh.z),ph.multiplyMatrices(mh,s.parent.matrixWorld),fh.setFromMatrixPosition(ph),i.setXYZ(a+1,fh.x,fh.y,fh.z),a+=2)}r.getAttribute("position").needsUpdate=!0,Object(l.a)(Object(c.a)(t.prototype),"updateMatrixWorld",this).call(this,e)}}]),t}(al);var _h=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;Object(f.a)(this,t),i=new jr(i),o=new jr(o);for(var a=r/2,s=n/r,l=n/2,h=[],d=[],p=0,m=0,g=-l;p<=r;p++,g+=s){h.push(-l,0,g,l,0,g),h.push(g,0,-l,g,0,l);var _=p===a?i:o;_.toArray(d,m),m+=3,_.toArray(d,m),m+=3,_.toArray(d,m),m+=3,_.toArray(d,m),m+=3}var v=new _i;v.setAttribute("position",new oi(h,3)),v.setAttribute("color",new oi(d,3));var y=new Zs({vertexColors:!0,toneMapped:!1});return(e=Object(u.a)(this,Object(c.a)(t).call(this,v,y))).type="GridHelper",e}return Object(d.a)(t,e),t}(al);var vh=new Float32Array(1),yh=(new Int32Array(vh.buffer),4),bh=8,Eh=(Math.pow(2,bh),[.125,.215,.35,.446,.526,.582]),xh=bh-yh+1+Eh.length,Th=(a={},Object(s.a)(a,jt,0),Object(s.a)(a,Ht,1),Object(s.a)(a,Xt,2),Object(s.a)(a,Kt,3),Object(s.a)(a,qt,4),Object(s.a)(a,Qt,5),Object(s.a)(a,Wt,6),new Yr({side:T,depthWrite:!1,depthTest:!1})),Sh=(new Fi(new Bi,Th),Ah());Sh._lodPlanes,Sh._sizeLods,Sh._sigmas,Math.sqrt(5);function Ah(){for(var e=[],t=[],n=[],r=bh,i=0;i<xh;i++){var o=Math.pow(2,r);t.push(o);var a=1/o;i>bh-yh?a=Eh[i-bh+yh-1]:0==i&&(a=0),n.push(a);for(var s=1/(o-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=new Float32Array(108),d=new Float32Array(72),f=new Float32Array(36),p=0;p<6;p++){var m=p%3*2/3-1,g=p>2?0:-1,_=[m,g,0,m+2/3,g,0,m+2/3,g+1,0,m,g,0,m+2/3,g+1,0,m,g+1,0];h.set(_,18*p),d.set(c,12*p);var v=[p,p,p,p,p,p];f.set(v,6*p)}var y=new _i;y.setAttribute("position",new Qr(h,3)),y.setAttribute("uv",new Qr(d,2)),y.setAttribute("faceIndex",new Qr(f,1)),e.push(y),r>yh&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Ph(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Xu.call(this,e),this.type="catmullrom"}Uu.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Uu.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(oc.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(Xu.prototype),Object.create(Xu.prototype),Ph.prototype=Object.create(Xu.prototype),Object.assign(Ph.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),_h.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},gh.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Cu.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),xc.extractUrlBase(e)}}),Cu.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(lh.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(An.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Gn.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),eo.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},hh.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(dn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),dn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),dn.ceilPowerOfTwo(e)}}),Object.assign(pn.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Object.assign(Qn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new xn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Ar.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Object.assign(En.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(qn.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Nr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Nr,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Nr.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Nr.getNormal(e,t,n,r)}}),Object.assign(ac.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ql(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jl(this,e)}}),Object.assign(fn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(xn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(yn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Er.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Er.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Fi.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Fi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Fs.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ws.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Gs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Uu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Wi.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(sc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Qr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===on},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(on)}}}),Object.assign(Qr.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?on:rn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(_i.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Qr(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(_i.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Tc.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(ih.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(ps.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===on},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(ps.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?on:rn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ql.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),Object.assign(fs.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(th.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Xr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new jr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(iu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ru.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(ji.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(cs.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(cs.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Ht:jt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(ts.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(bn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Vc.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Dc).load(e,function(e){t.setBuffer(e)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Gc.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ki.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Ki.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)};mn.crossOrigin=void 0,mn.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Bu;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},mn.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Fu;i.setCrossOrigin(this.crossOrigin);var o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},mn.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},mn.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"125"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="125")},function(e,t,n){"use strict";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";e.exports=n(46)},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i="function"===typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)})(e)}var o=n(13);function a(e,t){return!t||"object"!==i(t)&&"function"!==typeof t?Object(o.a)(e):t}n.d(t,"a",function(){return a})},function(e,t,n){"use strict";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,"a",function(){return i})},function(e,t,n){(function(t){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=129)}([function(e,t,n){"use strict";n.d(t,"u",function(){return a}),n.d(t,"v",function(){return s}),n.d(t,"h",function(){return l}),n.d(t,"e",function(){return u}),n.d(t,"f",function(){return c}),n.d(t,"w",function(){return h}),n.d(t,"x",function(){return d}),n.d(t,"y",function(){return f}),n.d(t,"r",function(){return p}),n.d(t,"q",function(){return m}),n.d(t,"j",function(){return g}),n.d(t,"n",function(){return _}),n.d(t,"z",function(){return v}),n.d(t,"i",function(){return y}),n.d(t,"s",function(){return r}),n.d(t,"c",function(){return E}),n.d(t,"d",function(){return x}),n.d(t,"k",function(){return b}),n.d(t,"a",function(){return T}),n.d(t,"b",function(){return S}),n.d(t,"l",function(){return A}),n.d(t,"m",function(){return P}),n.d(t,"g",function(){return M}),n.d(t,"p",function(){return R}),n.d(t,"o",function(){return C}),n.d(t,"t",function(){return w});var r,i=n(34),o=n(12),a=1/2.2,s=2.2,l=.001,u=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.r=e,this.g=t,this.b=n}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.getClassName=function(){return"Color3"},e.prototype.getHashCode=function(){var e=this.r||0;return e=397*(e=397*e^(this.g||0))^(this.b||0)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},e.prototype.toColor4=function(e){return void 0===e&&(e=1),new c(this.r,this.g,this.b,e)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},e.prototype.equalsFloats=function(e,t,n){return this.r===e&&this.g===t&&this.b===n},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},e.prototype.clampToRef=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=1),n.r=o.a.Clamp(this.r,e,t),n.g=o.a.Clamp(this.g,e,t),n.b=o.a.Clamp(this.b,e,t),this},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)},e.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},e.prototype.copyFromFloats=function(e,t,n){return this.r=e,this.g=t,this.b=n,this},e.prototype.set=function(e,t,n){return this.copyFromFloats(e,t,n)},e.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,n=255*this.b|0;return"#"+o.a.ToHex(e)+o.a.ToHex(t)+o.a.ToHex(n)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,s),e.g=Math.pow(this.g,s),e.b=Math.pow(this.b,s),this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,a),e.g=Math.pow(this.g,a),e.b=Math.pow(this.b,a),this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var n=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),i=parseInt(t.substring(5,7),16);return e.FromInts(n,r,i)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1],t[n+2])},e.FromInts=function(t,n,r){return new e(t/255,n/255,r/255)},e.Lerp=function(t,n,r){var i=new e(0,0,0);return e.LerpToRef(t,n,r,i),i},e.LerpToRef=function(e,t,n,r){r.r=e.r+(t.r-e.r)*n,r.g=e.g+(t.g-e.g)*n,r.b=e.b+(t.b-e.b)*n},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},Object.defineProperty(e,"BlackReadOnly",{get:function(){return e._BlackReadOnly},enumerable:!0,configurable:!0}),e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e.Teal=function(){return new e(0,1,1)},e.Random=function(){return new e(Math.random(),Math.random(),Math.random())},e._BlackReadOnly=e.Black(),e}(),c=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),this.r=e,this.g=t,this.b=n,this.a=r}return e.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},e.prototype.clampToRef=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=1),n.r=o.a.Clamp(this.r,e,t),n.g=o.a.Clamp(this.g,e,t),n.b=o.a.Clamp(this.b,e,t),n.a=o.a.Clamp(this.a,e,t),this},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){var e=this.r||0;return e=397*(e=397*(e=397*e^(this.g||0))^(this.b||0))^(this.a||0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.copyFromFloats=function(e,t,n,r){return this.r=e,this.g=t,this.b=n,this.a=r,this},e.prototype.set=function(e,t,n,r){return this.copyFromFloats(e,t,n,r)},e.prototype.toHexString=function(){var e=255*this.r|0,t=255*this.g|0,n=255*this.b|0,r=255*this.a|0;return"#"+o.a.ToHex(e)+o.a.ToHex(t)+o.a.ToHex(n)+o.a.ToHex(r)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,s),e.g=Math.pow(this.g,s),e.b=Math.pow(this.b,s),e.a=this.a,this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,a),e.g=Math.pow(this.g,a),e.b=Math.pow(this.b,a),e.a=this.a,this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length)return new e(0,0,0,0);var n=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),i=parseInt(t.substring(5,7),16),o=parseInt(t.substring(7,9),16);return e.FromInts(n,r,i,o)},e.Lerp=function(t,n,r){var i=new e(0,0,0,0);return e.LerpToRef(t,n,r,i),i},e.LerpToRef=function(e,t,n,r){r.r=e.r+(t.r-e.r)*n,r.g=e.g+(t.g-e.g)*n,r.b=e.b+(t.b-e.b)*n,r.a=e.a+(t.a-e.a)*n},e.FromColor3=function(t,n){return void 0===n&&(n=1),new e(t.r,t.g,t.b,n)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1],t[n+2],t[n+3])},e.FromInts=function(t,n,r,i){return new e(t/255,n/255,r/255,i/255)},e.CheckColors4=function(e,t){if(e.length===3*t){for(var n=[],r=0;r<e.length;r+=3){var i=r/3*4;n[i]=e[r],n[i+1]=e[r+1],n[i+2]=e[r+2],n[i+3]=1}return n}return e},e}(),h=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},e.prototype.getClassName=function(){return"Vector2"},e.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.addVector3=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},e.prototype.multiplyByFloats=function(t,n){return new e(this.x*t,this.y*n)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},e.prototype.scale=function(t){var n=new e(0,0);return this.scaleToRef(t,n),n},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=l),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.One=function(){return new e(1,1)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1])},e.FromArrayToRef=function(e,t,n){n.x=e[t],n.y=e[t+1]},e.CatmullRom=function(t,n,r,i,o){var a=o*o,s=o*a;return new e(.5*(2*n.x+(-t.x+r.x)*o+(2*t.x-5*n.x+4*r.x-i.x)*a+(-t.x+3*n.x-3*r.x+i.x)*s),.5*(2*n.y+(-t.y+r.y)*o+(2*t.y-5*n.y+4*r.y-i.y)*a+(-t.y+3*n.y-3*r.y+i.y)*s))},e.Clamp=function(t,n,r){var i=t.x;i=(i=i>r.x?r.x:i)<n.x?n.x:i;var o=t.y;return new e(i,o=(o=o>r.y?r.y:o)<n.y?n.y:o)},e.Hermite=function(t,n,r,i,o){var a=o*o,s=o*a,l=2*s-3*a+1,u=-2*s+3*a,c=s-2*a+o,h=s-a;return new e(t.x*l+r.x*u+n.x*c+i.x*h,t.y*l+r.y*u+n.y*c+i.y*h)},e.Lerp=function(t,n,r){return new e(t.x+(n.x-t.x)*r,t.y+(n.y-t.y)*r)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Normalize=function(e){var t=e.clone();return t.normalize(),t},e.Minimize=function(t,n){return new e(t.x<n.x?t.x:n.x,t.y<n.y?t.y:n.y)},e.Maximize=function(t,n){return new e(t.x>n.x?t.x:n.x,t.y>n.y?t.y:n.y)},e.Transform=function(t,n){var r=e.Zero();return e.TransformToRef(t,n,r),r},e.TransformToRef=function(e,t,n){var r=t.m,i=e.x*r[0]+e.y*r[4]+r[12],o=e.x*r[1]+e.y*r[5]+r[13];n.x=i,n.y=o},e.PointInTriangle=function(e,t,n,r){var i=.5*(-n.y*r.x+t.y*(-n.x+r.x)+t.x*(n.y-r.y)+n.x*r.y),o=i<0?-1:1,a=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*o,s=(t.x*n.y-t.y*n.x+(t.y-n.y)*e.x+(n.x-t.x)*e.y)*o;return a>0&&s>0&&a+s<2*i*o},e.Distance=function(t,n){return Math.sqrt(e.DistanceSquared(t,n))},e.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},e.Center=function(e,t){var n=e.add(t);return n.scaleInPlace(.5),n},e.DistanceOfPointFromSegment=function(t,n,r){var i=e.DistanceSquared(n,r);if(0===i)return e.Distance(t,n);var o=r.subtract(n),a=Math.max(0,Math.min(1,e.Dot(t.subtract(n),o)/i)),s=n.add(o.multiplyByFloats(a,a));return e.Distance(t,s)},e}(),d=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},e.prototype.getClassName=function(){return"Vector3"},e.prototype.getHashCode=function(){var e=this.x||0;return e=397*(e=397*e^(this.y||0))^(this.z||0)},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},e.prototype.toQuaternion=function(){return m.RotationYawPitchRoll(this.y,this.x,this.z)},e.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.addInPlaceFromFloats=function(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},e.prototype.addToRef=function(e,t){return t.copyFromFloats(this.x+e.x,this.y+e.y,this.z+e.z)},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e.x,e.y,e.z,t)},e.prototype.subtractFromFloats=function(t,n,r){return new e(this.x-t,this.y-n,this.z-r)},e.prototype.subtractFromFloatsToRef=function(e,t,n,r){return r.copyFromFloats(this.x-e,this.y-t,this.z-n)},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t)},e.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this.x*e,this.y*e,this.z*e)},e.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this.x*e,this.y*e,this.z*e)},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=l),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)&&o.a.WithinEpsilon(this.z,e.z,t)},e.prototype.equalsToFloats=function(e,t,n){return this.x===e&&this.y===t&&this.z===n},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},e.prototype.multiply=function(e){return this.multiplyByFloats(e.x,e.y,e.z)},e.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this.x*e.x,this.y*e.y,this.z*e.z)},e.prototype.multiplyByFloats=function(t,n,r){return new e(this.x*t,this.y*n,this.z*r)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z)},e.prototype.divideToRef=function(e,t){return t.copyFromFloats(this.x/e.x,this.y/e.y,this.z/e.z)},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e.x,e.y,e.z)},e.prototype.minimizeInPlaceFromFloats=function(e,t,n){return e<this.x&&(this.x=e),t<this.y&&(this.y=t),n<this.z&&(this.z=n),this},e.prototype.maximizeInPlaceFromFloats=function(e,t,n){return e>this.x&&(this.x=e),t>this.y&&(this.y=t),n>this.z&&(this.z=n),this},e.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this.x),n=Math.abs(this.y);if(!o.a.WithinEpsilon(t,n,e))return!0;var r=Math.abs(this.z);return!o.a.WithinEpsilon(t,r,e)||!o.a.WithinEpsilon(n,r,e)},Object.defineProperty(e.prototype,"isNonUniform",{get:function(){var e=Math.abs(this.x),t=Math.abs(this.y);if(e!==t)return!0;var n=Math.abs(this.z);return e!==n||t!==n},enumerable:!0,configurable:!0}),e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(){return this.normalizeFromLength(this.length())},e.prototype.reorderInPlace=function(e){var t=this;return"xyz"===(e=e.toLowerCase())?this:(O.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(n,r){t[n]=O.Vector3[0][e[r]]}),this)},e.prototype.rotateByQuaternionToRef=function(t,n){return t.toRotationMatrix(O.Matrix[0]),e.TransformCoordinatesToRef(this,O.Matrix[0],n),n},e.prototype.rotateByQuaternionAroundPointToRef=function(e,t,n){return this.subtractToRef(t,O.Vector3[0]),O.Vector3[0].rotateByQuaternionToRef(e,O.Vector3[0]),t.addToRef(O.Vector3[0],n),n},e.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},e.prototype.normalizeToNew=function(){var t=new e(0,0,0);return this.normalizeToRef(t),t},e.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/t,e)},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},e.prototype.copyFrom=function(e){return this.copyFromFloats(e.x,e.y,e.z)},e.prototype.copyFromFloats=function(e,t,n){return this.x=e,this.y=t,this.z=n,this},e.prototype.set=function(e,t,n){return this.copyFromFloats(e,t,n)},e.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},e.GetClipFactor=function(t,n,r,i){var o=e.Dot(t,r)-i;return o/(o-(e.Dot(n,r)-i))},e.GetAngleBetweenVectors=function(t,n,r){var i=t.normalizeToRef(O.Vector3[1]),o=n.normalizeToRef(O.Vector3[2]),a=e.Dot(i,o),s=O.Vector3[3];return e.CrossToRef(i,o,s),e.Dot(s,r)>0?Math.acos(a):-Math.acos(a)},e.FromArray=function(t,n){return void 0===n&&(n=0),new e(t[n],t[n+1],t[n+2])},e.FromFloatArray=function(t,n){return e.FromArray(t,n)},e.FromArrayToRef=function(e,t,n){n.x=e[t],n.y=e[t+1],n.z=e[t+2]},e.FromFloatArrayToRef=function(t,n,r){return e.FromArrayToRef(t,n,r)},e.FromFloatsToRef=function(e,t,n,r){r.copyFromFloats(e,t,n)},e.Zero=function(){return new e(0,0,0)},e.One=function(){return new e(1,1,1)},e.Up=function(){return new e(0,1,0)},Object.defineProperty(e,"UpReadOnly",{get:function(){return e._UpReadOnly},enumerable:!0,configurable:!0}),e.Down=function(){return new e(0,-1,0)},e.Forward=function(){return new e(0,0,1)},e.Backward=function(){return new e(0,0,-1)},e.Right=function(){return new e(1,0,0)},e.Left=function(){return new e(-1,0,0)},e.TransformCoordinates=function(t,n){var r=e.Zero();return e.TransformCoordinatesToRef(t,n,r),r},e.TransformCoordinatesToRef=function(t,n,r){e.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,n,r)},e.TransformCoordinatesFromFloatsToRef=function(e,t,n,r,i){var o=r.m,a=e*o[0]+t*o[4]+n*o[8]+o[12],s=e*o[1]+t*o[5]+n*o[9]+o[13],l=e*o[2]+t*o[6]+n*o[10]+o[14],u=1/(e*o[3]+t*o[7]+n*o[11]+o[15]);i.x=a*u,i.y=s*u,i.z=l*u},e.TransformNormal=function(t,n){var r=e.Zero();return e.TransformNormalToRef(t,n,r),r},e.TransformNormalToRef=function(e,t,n){this.TransformNormalFromFloatsToRef(e.x,e.y,e.z,t,n)},e.TransformNormalFromFloatsToRef=function(e,t,n,r,i){var o=r.m;i.x=e*o[0]+t*o[4]+n*o[8],i.y=e*o[1]+t*o[5]+n*o[9],i.z=e*o[2]+t*o[6]+n*o[10]},e.CatmullRom=function(t,n,r,i,o){var a=o*o,s=o*a;return new e(.5*(2*n.x+(-t.x+r.x)*o+(2*t.x-5*n.x+4*r.x-i.x)*a+(-t.x+3*n.x-3*r.x+i.x)*s),.5*(2*n.y+(-t.y+r.y)*o+(2*t.y-5*n.y+4*r.y-i.y)*a+(-t.y+3*n.y-3*r.y+i.y)*s),.5*(2*n.z+(-t.z+r.z)*o+(2*t.z-5*n.z+4*r.z-i.z)*a+(-t.z+3*n.z-3*r.z+i.z)*s))},e.Clamp=function(t,n,r){var i=new e;return e.ClampToRef(t,n,r,i),i},e.ClampToRef=function(e,t,n,r){var i=e.x;i=(i=i>n.x?n.x:i)<t.x?t.x:i;var o=e.y;o=(o=o>n.y?n.y:o)<t.y?t.y:o;var a=e.z;a=(a=a>n.z?n.z:a)<t.z?t.z:a,r.copyFromFloats(i,o,a)},e.Hermite=function(t,n,r,i,o){var a=o*o,s=o*a,l=2*s-3*a+1,u=-2*s+3*a,c=s-2*a+o,h=s-a;return new e(t.x*l+r.x*u+n.x*c+i.x*h,t.y*l+r.y*u+n.y*c+i.y*h,t.z*l+r.z*u+n.z*c+i.z*h)},e.Lerp=function(t,n,r){var i=new e(0,0,0);return e.LerpToRef(t,n,r,i),i},e.LerpToRef=function(e,t,n,r){r.x=e.x+(t.x-e.x)*n,r.y=e.y+(t.y-e.y)*n,r.z=e.z+(t.z-e.z)*n},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},e.Cross=function(t,n){var r=e.Zero();return e.CrossToRef(t,n,r),r},e.CrossToRef=function(e,t,n){var r=e.y*t.z-e.z*t.y,i=e.z*t.x-e.x*t.z,o=e.x*t.y-e.y*t.x;n.copyFromFloats(r,i,o)},e.Normalize=function(t){var n=e.Zero();return e.NormalizeToRef(t,n),n},e.NormalizeToRef=function(e,t){e.normalizeToRef(t)},e.Project=function(t,n,r,i){var o=i.width,a=i.height,s=i.x,l=i.y,u=O.Matrix[1];g.FromValuesToRef(o/2,0,0,0,0,-a/2,0,0,0,0,.5,0,s+o/2,a/2+l,.5,1,u);var c=O.Matrix[0];return n.multiplyToRef(r,c),c.multiplyToRef(u,c),e.TransformCoordinates(t,c)},e._UnprojectFromInvertedMatrixToRef=function(t,n,r){e.TransformCoordinatesToRef(t,n,r);var i=n.m,a=t.x*i[3]+t.y*i[7]+t.z*i[11]+i[15];o.a.WithinEpsilon(a,1)&&r.scaleInPlace(1/a)},e.UnprojectFromTransform=function(t,n,r,i,o){var a=O.Matrix[0];i.multiplyToRef(o,a),a.invert(),t.x=t.x/n*2-1,t.y=-(t.y/r*2-1);var s=new e;return e._UnprojectFromInvertedMatrixToRef(t,a,s),s},e.Unproject=function(t,n,r,i,o,a){var s=e.Zero();return e.UnprojectToRef(t,n,r,i,o,a,s),s},e.UnprojectToRef=function(t,n,r,i,o,a,s){e.UnprojectFloatsToRef(t.x,t.y,t.z,n,r,i,o,a,s)},e.UnprojectFloatsToRef=function(t,n,r,i,o,a,s,l,u){var c=O.Matrix[0];a.multiplyToRef(s,c),c.multiplyToRef(l,c),c.invert();var h=O.Vector3[0];h.x=t/i*2-1,h.y=-(n/o*2-1),h.z=2*r-1,e._UnprojectFromInvertedMatrixToRef(h,c,u)},e.Minimize=function(e,t){var n=e.clone();return n.minimizeInPlace(t),n},e.Maximize=function(e,t){var n=e.clone();return n.maximizeInPlace(t),n},e.Distance=function(t,n){return Math.sqrt(e.DistanceSquared(t,n))},e.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.z-t.z;return n*n+r*r+i*i},e.Center=function(e,t){var n=e.add(t);return n.scaleInPlace(.5),n},e.RotationFromAxis=function(t,n,r){var i=e.Zero();return e.RotationFromAxisToRef(t,n,r,i),i},e.RotationFromAxisToRef=function(e,t,n,r){var i=O.Quaternion[0];m.RotationQuaternionFromAxisToRef(e,t,n,i),i.toEulerAnglesToRef(r)},e._UpReadOnly=e.Up(),e}(),f=function(){function e(e,t,n,r){this.x=e,this.y=t,this.z=n,this.w=r}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Vector4"},e.prototype.getHashCode=function(){var e=this.x||0;return e=397*(e=397*(e=397*e^(this.y||0))^(this.z||0))^(this.w||0)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},e.prototype.subtractFromFloats=function(t,n,r,i){return new e(this.x-t,this.y-n,this.z-r,this.w-i)},e.prototype.subtractFromFloatsToRef=function(e,t,n,r,i){return i.x=this.x-e,i.y=this.y-t,i.z=this.z-n,i.w=this.w-r,this},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z,-this.w)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=l),e&&o.a.WithinEpsilon(this.x,e.x,t)&&o.a.WithinEpsilon(this.y,e.y,t)&&o.a.WithinEpsilon(this.z,e.z,t)&&o.a.WithinEpsilon(this.w,e.w,t)},e.prototype.equalsToFloats=function(e,t,n,r){return this.x===e&&this.y===t&&this.z===n&&this.w===r},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},e.prototype.multiplyByFloats=function(t,n,r,i){return new e(this.x*t,this.y*n,this.z*r,this.w*i)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},e.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},e.prototype.toVector3=function(){return new d(this.x,this.y,this.z)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},e.prototype.set=function(e,t,n,r){return this.copyFromFloats(e,t,n,r)},e.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},e.FromArray=function(t,n){return n||(n=0),new e(t[n],t[n+1],t[n+2],t[n+3])},e.FromArrayToRef=function(e,t,n){n.x=e[t],n.y=e[t+1],n.z=e[t+2],n.w=e[t+3]},e.FromFloatArrayToRef=function(t,n,r){e.FromArrayToRef(t,n,r)},e.FromFloatsToRef=function(e,t,n,r,i){i.x=e,i.y=t,i.z=n,i.w=r},e.Zero=function(){return new e(0,0,0,0)},e.One=function(){return new e(1,1,1,1)},e.Normalize=function(t){var n=e.Zero();return e.NormalizeToRef(t,n),n},e.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},e.Minimize=function(e,t){var n=e.clone();return n.minimizeInPlace(t),n},e.Maximize=function(e,t){var n=e.clone();return n.maximizeInPlace(t),n},e.Distance=function(t,n){return Math.sqrt(e.DistanceSquared(t,n))},e.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.z-t.z,o=e.w-t.w;return n*n+r*r+i*i+o*o},e.Center=function(e,t){var n=e.add(t);return n.scaleInPlace(.5),n},e.TransformNormal=function(t,n){var r=e.Zero();return e.TransformNormalToRef(t,n,r),r},e.TransformNormalToRef=function(e,t,n){var r=t.m,i=e.x*r[0]+e.y*r[4]+e.z*r[8],o=e.x*r[1]+e.y*r[5]+e.z*r[9],a=e.x*r[2]+e.y*r[6]+e.z*r[10];n.x=i,n.y=o,n.z=a,n.w=e.w},e.TransformNormalFromFloatsToRef=function(e,t,n,r,i,o){var a=i.m;o.x=e*a[0]+t*a[4]+n*a[8],o.y=e*a[1]+t*a[5]+n*a[9],o.z=e*a[2]+t*a[6]+n*a[10],o.w=r},e.FromVector3=function(t,n){return void 0===n&&(n=0),new e(t.x,t.y,t.z,n)},e}(),p=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){var e=this.width||0;return e=397*e^(this.height||0)},e.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.multiplyByFloats=function(t,n){return new e(this.width*t,this.height*n)},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(e){return!!e&&this.width===e.width&&this.height===e.height},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(t){return new e(this.width+t.width,this.height+t.height)},e.prototype.subtract=function(t){return new e(this.width-t.width,this.height-t.height)},e.Lerp=function(t,n,r){return new e(t.width+(n.width-t.width)*r,t.height+(n.height-t.height)*r)},e}(),m=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=e,this.y=t,this.z=n,this.w=r}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var e=this.x||0;return e=397*(e=397*(e=397*e^(this.y||0))^(this.z||0))^(this.w||0)},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},e.prototype.set=function(e,t,n,r){return this.copyFromFloats(e,t,n,r)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.multiply=function(t){var n=new e(0,0,0,1);return this.multiplyToRef(t,n),n},e.prototype.multiplyToRef=function(e,t){var n=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,r=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,i=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,o=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(n,r,i,o),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this.x,-this.y,-this.z,this.w)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=d.Zero();return this.toEulerAnglesToRef(t),t},e.prototype.toEulerAnglesToRef=function(e){var t=this.z,n=this.x,r=this.y,i=this.w,o=i*i,a=t*t,s=n*n,l=r*r,u=r*t-n*i;return u<-.4999999?(e.y=2*Math.atan2(r,i),e.x=Math.PI/2,e.z=0):u>.4999999?(e.y=2*Math.atan2(r,i),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(n*r+t*i),-a-s+l+o),e.x=Math.asin(-2*(t*r-n*i)),e.y=Math.atan2(2*(t*n+r*i),a-s-l+o)),this},e.prototype.toRotationMatrix=function(e){return g.FromQuaternionToRef(this,e),this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var n=new e;return e.FromRotationMatrixToRef(t,n),n},e.FromRotationMatrixToRef=function(e,t){var n,r=e.m,i=r[0],o=r[4],a=r[8],s=r[1],l=r[5],u=r[9],c=r[2],h=r[6],d=r[10],f=i+l+d;f>0?(n=.5/Math.sqrt(f+1),t.w=.25/n,t.x=(h-u)*n,t.y=(a-c)*n,t.z=(s-o)*n):i>l&&i>d?(n=2*Math.sqrt(1+i-l-d),t.w=(h-u)/n,t.x=.25*n,t.y=(o+s)/n,t.z=(a+c)/n):l>d?(n=2*Math.sqrt(1+l-i-d),t.w=(a-c)/n,t.x=(o+s)/n,t.y=.25*n,t.z=(u+h)/n):(n=2*Math.sqrt(1+d-i-l),t.w=(s-o)/n,t.x=(a+c)/n,t.y=(u+h)/n,t.z=.25*n)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},e.AreClose=function(t,n){return e.Dot(t,n)>=0},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(t){return new e(-t.x,-t.y,-t.z,t.w)},e.InverseToRef=function(e,t){return t.set(-e.x,-e.y,-e.z,e.w),t},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(e){return e&&0===e.x&&0===e.y&&0===e.z&&1===e.w},e.RotationAxis=function(t,n){return e.RotationAxisToRef(t,n,new e)},e.RotationAxisToRef=function(e,t,n){var r=Math.sin(t/2);return e.normalize(),n.w=Math.cos(t/2),n.x=e.x*r,n.y=e.y*r,n.z=e.z*r,n},e.FromArray=function(t,n){return n||(n=0),new e(t[n],t[n+1],t[n+2],t[n+3])},e.FromEulerAngles=function(t,n,r){var i=new e;return e.RotationYawPitchRollToRef(n,t,r,i),i},e.FromEulerAnglesToRef=function(t,n,r,i){return e.RotationYawPitchRollToRef(n,t,r,i),i},e.FromEulerVector=function(t){var n=new e;return e.RotationYawPitchRollToRef(t.y,t.x,t.z,n),n},e.FromEulerVectorToRef=function(t,n){return e.RotationYawPitchRollToRef(t.y,t.x,t.z,n),n},e.RotationYawPitchRoll=function(t,n,r){var i=new e;return e.RotationYawPitchRollToRef(t,n,r,i),i},e.RotationYawPitchRollToRef=function(e,t,n,r){var i=.5*n,o=.5*t,a=.5*e,s=Math.sin(i),l=Math.cos(i),u=Math.sin(o),c=Math.cos(o),h=Math.sin(a),d=Math.cos(a);r.x=d*u*l+h*c*s,r.y=h*c*l-d*u*s,r.z=d*c*s-h*u*l,r.w=d*c*l+h*u*s},e.RotationAlphaBetaGamma=function(t,n,r){var i=new e;return e.RotationAlphaBetaGammaToRef(t,n,r,i),i},e.RotationAlphaBetaGammaToRef=function(e,t,n,r){var i=.5*(n+e),o=.5*(n-e),a=.5*t;r.x=Math.cos(o)*Math.sin(a),r.y=Math.sin(o)*Math.sin(a),r.z=Math.sin(i)*Math.cos(a),r.w=Math.cos(i)*Math.cos(a)},e.RotationQuaternionFromAxis=function(t,n,r){var i=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,n,r,i),i},e.RotationQuaternionFromAxisToRef=function(t,n,r,i){var o=O.Matrix[0];g.FromXYZAxesToRef(t.normalize(),n.normalize(),r.normalize(),o),e.FromRotationMatrixToRef(o,i)},e.Slerp=function(t,n,r){var i=e.Identity();return e.SlerpToRef(t,n,r,i),i},e.SlerpToRef=function(e,t,n,r){var i,o,a=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,s=!1;if(a<0&&(s=!0,a=-a),a>.999999)o=1-n,i=s?-n:n;else{var l=Math.acos(a),u=1/Math.sin(l);o=Math.sin((1-n)*l)*u,i=s?-Math.sin(n*l)*u:Math.sin(n*l)*u}r.x=o*e.x+i*t.x,r.y=o*e.y+i*t.y,r.z=o*e.z+i*t.z,r.w=o*e.w+i*t.w},e.Hermite=function(t,n,r,i,o){var a=o*o,s=o*a,l=2*s-3*a+1,u=-2*s+3*a,c=s-2*a+o,h=s-a;return new e(t.x*l+r.x*u+n.x*c+i.x*h,t.y*l+r.y*u+n.y*c+i.y*h,t.z*l+r.z*u+n.z*c+i.z*h,t.w*l+r.w*u+n.w*c+i.w*h)},e}(),g=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,this._m=new Float32Array(16),this._updateIdentityStatus(!1)}return Object.defineProperty(e.prototype,"m",{get:function(){return this._m},enumerable:!0,configurable:!0}),e.prototype._markAsUpdated=function(){this.updateFlag=e._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},e.prototype._updateIdentityStatus=function(t,n,r,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!0),this.updateFlag=e._updateFlagSeed++,this._isIdentity=t,this._isIdentity3x2=t||r,this._isIdentityDirty=!this._isIdentity&&n,this._isIdentity3x2Dirty=!this._isIdentity3x2&&i},e.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity},e.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]?this._isIdentity3x2=!1:0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},e.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e=this._m,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15],_=h*g-m*d,v=c*g-p*d,y=c*m-p*h,b=u*g-f*d,E=u*m-h*f,x=u*p-f*c;return t*+(a*_-s*v+l*y)+n*-(o*_-s*b+l*E)+r*+(o*v-a*b+l*x)+i*-(o*y-a*E+s*x)},e.prototype.toArray=function(){return this._m},e.prototype.asArray=function(){return this._m},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},e.prototype.add=function(t){var n=new e;return this.addToRef(t,n),n},e.prototype.addToRef=function(e,t){for(var n=this._m,r=t._m,i=e.m,o=0;o<16;o++)r[o]=n[o]+i[o];return t._markAsUpdated(),this},e.prototype.addToSelf=function(e){for(var t=this._m,n=e.m,r=0;r<16;r++)t[r]+=n[r];return this._markAsUpdated(),this},e.prototype.invertToRef=function(t){if(!0===this._isIdentity)return e.IdentityToRef(t),this;var n=this._m,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],g=n[13],_=n[14],v=n[15],y=f*v-_*p,b=d*v-g*p,E=d*_-g*f,x=h*v-m*p,T=h*_-f*m,S=h*g-m*d,A=+(l*y-u*b+c*E),P=-(s*y-u*x+c*T),M=+(s*b-l*x+c*S),R=-(s*E-l*T+u*S),C=r*A+i*P+o*M+a*R;if(0===C)return t.copyFrom(this),this;var w=1/C,O=u*v-_*c,I=l*v-g*c,D=l*_-g*u,L=s*v-m*c,F=s*_-m*u,N=s*g-m*l,B=u*p-f*c,U=l*p-d*c,k=l*f-d*u,V=s*p-h*c,G=s*f-h*u,z=s*d-h*l,j=-(i*y-o*b+a*E),H=+(r*y-o*x+a*T),W=-(r*b-i*x+a*S),X=+(r*E-i*T+o*S),Y=+(i*O-o*I+a*D),K=-(r*O-o*L+a*F),q=+(r*I-i*L+a*N),Q=-(r*D-i*F+o*N),Z=-(i*B-o*U+a*k),J=+(r*B-o*V+a*G),$=-(r*U-i*V+a*z),ee=+(r*k-i*G+o*z);return e.FromValuesToRef(A*w,j*w,Y*w,Z*w,P*w,H*w,K*w,J*w,M*w,W*w,q*w,$*w,R*w,X*w,Q*w,ee*w,t),this},e.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this._markAsUpdated(),this},e.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this._markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(e,t,n){return this._m[12]=e,this._m[13]=t,this._m[14]=n,this._markAsUpdated(),this},e.prototype.addTranslationFromFloats=function(e,t,n){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=n,this._markAsUpdated(),this},e.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e.x,e.y,e.z)},e.prototype.getTranslation=function(){return new d(this._m[12],this._m[13],this._m[14])},e.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},e.prototype.removeRotationAndScaling=function(){var t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this},e.prototype.multiply=function(t){var n=new e;return this.multiplyToRef(t,n),n},e.prototype.copyFrom=function(e){e.copyToArray(this._m);var t=e;return this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this},e.prototype.copyToArray=function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)e[t+n]=this._m[n];return this},e.prototype.multiplyToRef=function(e,t){return this._isIdentity?(t.copyFrom(e),this):e._isIdentity?(t.copyFrom(this),this):(this.multiplyToArray(e,t._m,0),t._markAsUpdated(),this)},e.prototype.multiplyToArray=function(e,t,n){var r=this._m,i=e.m,o=r[0],a=r[1],s=r[2],l=r[3],u=r[4],c=r[5],h=r[6],d=r[7],f=r[8],p=r[9],m=r[10],g=r[11],_=r[12],v=r[13],y=r[14],b=r[15],E=i[0],x=i[1],T=i[2],S=i[3],A=i[4],P=i[5],M=i[6],R=i[7],C=i[8],w=i[9],O=i[10],I=i[11],D=i[12],L=i[13],F=i[14],N=i[15];return t[n]=o*E+a*A+s*C+l*D,t[n+1]=o*x+a*P+s*w+l*L,t[n+2]=o*T+a*M+s*O+l*F,t[n+3]=o*S+a*R+s*I+l*N,t[n+4]=u*E+c*A+h*C+d*D,t[n+5]=u*x+c*P+h*w+d*L,t[n+6]=u*T+c*M+h*O+d*F,t[n+7]=u*S+c*R+h*I+d*N,t[n+8]=f*E+p*A+m*C+g*D,t[n+9]=f*x+p*P+m*w+g*L,t[n+10]=f*T+p*M+m*O+g*F,t[n+11]=f*S+p*R+m*I+g*N,t[n+12]=_*E+v*A+y*C+b*D,t[n+13]=_*x+v*P+y*w+b*L,t[n+14]=_*T+v*M+y*O+b*F,t[n+15]=_*S+v*R+y*I+b*N,this},e.prototype.equals=function(e){var t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;var n=this.m,r=t.m;return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]&&n[8]===r[8]&&n[9]===r[9]&&n[10]===r[10]&&n[11]===r[11]&&n[12]===r[12]&&n[13]===r[13]&&n[14]===r[14]&&n[15]===r[15]},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=this._m[0]||0,t=1;t<16;t++)e=397*e^(this._m[t]||0);return e},e.prototype.decompose=function(t,n,r){if(this._isIdentity)return r&&r.setAll(0),t&&t.setAll(1),n&&n.copyFromFloats(0,0,0,1),!0;var i=this._m;if(r&&r.copyFromFloats(i[12],i[13],i[14]),(t=t||O.Vector3[0]).x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),t.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),t.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),this.determinant()<=0&&(t.y*=-1),0===t.x||0===t.y||0===t.z)return n&&n.copyFromFloats(0,0,0,1),!1;if(n){var o=1/t.x,a=1/t.y,s=1/t.z;e.FromValuesToRef(i[0]*o,i[1]*o,i[2]*o,0,i[4]*a,i[5]*a,i[6]*a,0,i[8]*s,i[9]*s,i[10]*s,0,0,0,0,1,O.Matrix[0]),m.FromRotationMatrixToRef(O.Matrix[0],n)}return!0},e.prototype.getRow=function(e){if(e<0||e>3)return null;var t=4*e;return new f(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])},e.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(t){return e.TransposeToRef(this,t),this},e.prototype.setRowFromFloats=function(e,t,n,r,i){if(e<0||e>3)return this;var o=4*e;return this._m[o+0]=t,this._m[o+1]=n,this._m[o+2]=r,this._m[o+3]=i,this._markAsUpdated(),this},e.prototype.scale=function(t){var n=new e;return this.scaleToRef(t,n),n},e.prototype.scaleToRef=function(e,t){for(var n=0;n<16;n++)t._m[n]=this._m[n]*e;return t._markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(e,t){for(var n=0;n<16;n++)t._m[n]+=this._m[n]*e;return t._markAsUpdated(),this},e.prototype.toNormalMatrix=function(t){var n=O.Matrix[0];this.invertToRef(n),n.transposeToRef(t);var r=t._m;e.FromValuesToRef(r[0],r[1],r[2],0,r[4],r[5],r[6],0,r[8],r[9],r[10],0,0,0,0,1,t)},e.prototype.getRotationMatrix=function(){var t=new e;return this.getRotationMatrixToRef(t),t},e.prototype.getRotationMatrixToRef=function(t){var n=O.Vector3[0];if(!this.decompose(n))return e.IdentityToRef(t),this;var r=this._m,i=1/n.x,o=1/n.y,a=1/n.z;return e.FromValuesToRef(r[0]*i,r[1]*i,r[2]*i,0,r[4]*o,r[5]*o,r[6]*o,0,r[8]*a,r[9]*a,r[10]*a,0,0,0,0,1,t),this},e.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},e.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},e.FromArray=function(t,n){void 0===n&&(n=0);var r=new e;return e.FromArrayToRef(t,n,r),r},e.FromArrayToRef=function(e,t,n){for(var r=0;r<16;r++)n._m[r]=e[r+t];n._markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(e,t,n,r){for(var i=0;i<16;i++)r._m[i]=e[i+t]*n;r._markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._identityReadOnly},enumerable:!0,configurable:!0}),e.FromValuesToRef=function(e,t,n,r,i,o,a,s,l,u,c,h,d,f,p,m,g){var _=g._m;_[0]=e,_[1]=t,_[2]=n,_[3]=r,_[4]=i,_[5]=o,_[6]=a,_[7]=s,_[8]=l,_[9]=u,_[10]=c,_[11]=h,_[12]=d,_[13]=f,_[14]=p,_[15]=m,g._markAsUpdated()},e.FromValues=function(t,n,r,i,o,a,s,l,u,c,h,d,f,p,m,g){var _=new e,v=_._m;return v[0]=t,v[1]=n,v[2]=r,v[3]=i,v[4]=o,v[5]=a,v[6]=s,v[7]=l,v[8]=u,v[9]=c,v[10]=h,v[11]=d,v[12]=f,v[13]=p,v[14]=m,v[15]=g,_._markAsUpdated(),_},e.Compose=function(t,n,r){var i=new e;return e.ComposeToRef(t,n,r,i),i},e.ComposeToRef=function(e,t,n,r){var i=r._m,o=t.x,a=t.y,s=t.z,l=t.w,u=o+o,c=a+a,h=s+s,d=o*u,f=o*c,p=o*h,m=a*c,g=a*h,_=s*h,v=l*u,y=l*c,b=l*h,E=e.x,x=e.y,T=e.z;i[0]=(1-(m+_))*E,i[1]=(f+b)*E,i[2]=(p-y)*E,i[3]=0,i[4]=(f-b)*x,i[5]=(1-(d+_))*x,i[6]=(g+v)*x,i[7]=0,i[8]=(p+y)*T,i[9]=(g-v)*T,i[10]=(1-(d+m))*T,i[11]=0,i[12]=n.x,i[13]=n.y,i[14]=n.z,i[15]=1,r._markAsUpdated()},e.Identity=function(){var t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},e.Zero=function(){var t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},e.RotationX=function(t){var n=new e;return e.RotationXToRef(t,n),n},e.Invert=function(t){var n=new e;return t.invertToRef(n),n},e.RotationXToRef=function(t,n){var r=Math.sin(t),i=Math.cos(t);e.FromValuesToRef(1,0,0,0,0,i,r,0,0,-r,i,0,0,0,0,1,n),n._updateIdentityStatus(1===i&&0===r)},e.RotationY=function(t){var n=new e;return e.RotationYToRef(t,n),n},e.RotationYToRef=function(t,n){var r=Math.sin(t),i=Math.cos(t);e.FromValuesToRef(i,0,-r,0,0,1,0,0,r,0,i,0,0,0,0,1,n),n._updateIdentityStatus(1===i&&0===r)},e.RotationZ=function(t){var n=new e;return e.RotationZToRef(t,n),n},e.RotationZToRef=function(t,n){var r=Math.sin(t),i=Math.cos(t);e.FromValuesToRef(i,r,0,0,-r,i,0,0,0,0,1,0,0,0,0,1,n),n._updateIdentityStatus(1===i&&0===r)},e.RotationAxis=function(t,n){var r=new e;return e.RotationAxisToRef(t,n,r),r},e.RotationAxisToRef=function(e,t,n){var r=Math.sin(-t),i=Math.cos(-t),o=1-i;e.normalize();var a=n._m;a[0]=e.x*e.x*o+i,a[1]=e.x*e.y*o-e.z*r,a[2]=e.x*e.z*o+e.y*r,a[3]=0,a[4]=e.y*e.x*o+e.z*r,a[5]=e.y*e.y*o+i,a[6]=e.y*e.z*o-e.x*r,a[7]=0,a[8]=e.z*e.x*o-e.y*r,a[9]=e.z*e.y*o+e.x*r,a[10]=e.z*e.z*o+i,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n._markAsUpdated()},e.RotationAlignToRef=function(e,t,n){var r=d.Cross(t,e),i=d.Dot(t,e),o=1/(1+i),a=n._m;a[0]=r.x*r.x*o+i,a[1]=r.y*r.x*o-r.z,a[2]=r.z*r.x*o+r.y,a[3]=0,a[4]=r.x*r.y*o+r.z,a[5]=r.y*r.y*o+i,a[6]=r.z*r.y*o-r.x,a[7]=0,a[8]=r.x*r.z*o-r.y,a[9]=r.y*r.z*o+r.x,a[10]=r.z*r.z*o+i,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n._markAsUpdated()},e.RotationYawPitchRoll=function(t,n,r){var i=new e;return e.RotationYawPitchRollToRef(t,n,r,i),i},e.RotationYawPitchRollToRef=function(e,t,n,r){m.RotationYawPitchRollToRef(e,t,n,O.Quaternion[0]),O.Quaternion[0].toRotationMatrix(r)},e.Scaling=function(t,n,r){var i=new e;return e.ScalingToRef(t,n,r,i),i},e.ScalingToRef=function(t,n,r,i){e.FromValuesToRef(t,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1,i),i._updateIdentityStatus(1===t&&1===n&&1===r)},e.Translation=function(t,n,r){var i=new e;return e.TranslationToRef(t,n,r,i),i},e.TranslationToRef=function(t,n,r,i){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,n,r,1,i),i._updateIdentityStatus(0===t&&0===n&&0===r)},e.Lerp=function(t,n,r){var i=new e;return e.LerpToRef(t,n,r,i),i},e.LerpToRef=function(e,t,n,r){for(var i=r._m,o=e.m,a=t.m,s=0;s<16;s++)i[s]=o[s]*(1-n)+a[s]*n;r._markAsUpdated()},e.DecomposeLerp=function(t,n,r){var i=new e;return e.DecomposeLerpToRef(t,n,r,i),i},e.DecomposeLerpToRef=function(t,n,r,i){var o=O.Vector3[0],a=O.Quaternion[0],s=O.Vector3[1];t.decompose(o,a,s);var l=O.Vector3[2],u=O.Quaternion[1],c=O.Vector3[3];n.decompose(l,u,c);var h=O.Vector3[4];d.LerpToRef(o,l,r,h);var f=O.Quaternion[2];m.SlerpToRef(a,u,r,f);var p=O.Vector3[5];d.LerpToRef(s,c,r,p),e.ComposeToRef(h,f,p,i)},e.LookAtLH=function(t,n,r){var i=new e;return e.LookAtLHToRef(t,n,r,i),i},e.LookAtLHToRef=function(t,n,r,i){var o=O.Vector3[0],a=O.Vector3[1],s=O.Vector3[2];n.subtractToRef(t,s),s.normalize(),d.CrossToRef(r,s,o);var l=o.lengthSquared();0===l?o.x=1:o.normalizeFromLength(Math.sqrt(l)),d.CrossToRef(s,o,a),a.normalize();var u=-d.Dot(o,t),c=-d.Dot(a,t),h=-d.Dot(s,t);e.FromValuesToRef(o.x,a.x,s.x,0,o.y,a.y,s.y,0,o.z,a.z,s.z,0,u,c,h,1,i)},e.LookAtRH=function(t,n,r){var i=new e;return e.LookAtRHToRef(t,n,r,i),i},e.LookAtRHToRef=function(t,n,r,i){var o=O.Vector3[0],a=O.Vector3[1],s=O.Vector3[2];t.subtractToRef(n,s),s.normalize(),d.CrossToRef(r,s,o);var l=o.lengthSquared();0===l?o.x=1:o.normalizeFromLength(Math.sqrt(l)),d.CrossToRef(s,o,a),a.normalize();var u=-d.Dot(o,t),c=-d.Dot(a,t),h=-d.Dot(s,t);e.FromValuesToRef(o.x,a.x,s.x,0,o.y,a.y,s.y,0,o.z,a.z,s.z,0,u,c,h,1,i)},e.OrthoLH=function(t,n,r,i){var o=new e;return e.OrthoLHToRef(t,n,r,i,o),o},e.OrthoLHToRef=function(t,n,r,i,o){var a=2/t,s=2/n,l=2/(i-r),u=-(i+r)/(i-r);e.FromValuesToRef(a,0,0,0,0,s,0,0,0,0,l,0,0,0,u,1,o),o._updateIdentityStatus(1===a&&1===s&&1===l&&0===u)},e.OrthoOffCenterLH=function(t,n,r,i,o,a){var s=new e;return e.OrthoOffCenterLHToRef(t,n,r,i,o,a,s),s},e.OrthoOffCenterLHToRef=function(t,n,r,i,o,a,s){var l=2/(n-t),u=2/(i-r),c=2/(a-o),h=-(a+o)/(a-o),d=(t+n)/(t-n),f=(i+r)/(r-i);e.FromValuesToRef(l,0,0,0,0,u,0,0,0,0,c,0,d,f,h,1,s),s._markAsUpdated()},e.OrthoOffCenterRH=function(t,n,r,i,o,a){var s=new e;return e.OrthoOffCenterRHToRef(t,n,r,i,o,a,s),s},e.OrthoOffCenterRHToRef=function(t,n,r,i,o,a,s){e.OrthoOffCenterLHToRef(t,n,r,i,o,a,s),s._m[10]*=-1},e.PerspectiveLH=function(t,n,r,i){var o=new e,a=2*r/t,s=2*r/n,l=(i+r)/(i-r),u=-2*i*r/(i-r);return e.FromValuesToRef(a,0,0,0,0,s,0,0,0,0,l,1,0,0,u,0,o),o._updateIdentityStatus(!1),o},e.PerspectiveFovLH=function(t,n,r,i){var o=new e;return e.PerspectiveFovLHToRef(t,n,r,i,o),o},e.PerspectiveFovLHToRef=function(t,n,r,i,o,a){void 0===a&&(a=!0);var s=r,l=i,u=1/Math.tan(.5*t),c=a?u/n:u,h=a?u:u*n,d=(l+s)/(l-s),f=-2*l*s/(l-s);e.FromValuesToRef(c,0,0,0,0,h,0,0,0,0,d,1,0,0,f,0,o),o._updateIdentityStatus(!1)},e.PerspectiveFovRH=function(t,n,r,i){var o=new e;return e.PerspectiveFovRHToRef(t,n,r,i,o),o},e.PerspectiveFovRHToRef=function(t,n,r,i,o,a){void 0===a&&(a=!0);var s=r,l=i,u=1/Math.tan(.5*t),c=a?u/n:u,h=a?u:u*n,d=-(l+s)/(l-s),f=-2*l*s/(l-s);e.FromValuesToRef(c,0,0,0,0,h,0,0,0,0,d,-1,0,0,f,0,o),o._updateIdentityStatus(!1)},e.PerspectiveFovWebVRToRef=function(e,t,n,r,i){void 0===i&&(i=!1);var o=i?-1:1,a=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),u=Math.tan(e.rightDegrees*Math.PI/180),c=2/(l+u),h=2/(a+s),d=r._m;d[0]=c,d[1]=d[2]=d[3]=d[4]=0,d[5]=h,d[6]=d[7]=0,d[8]=(l-u)*c*.5,d[9]=-(a-s)*h*.5,d[10]=-n/(t-n),d[11]=1*o,d[12]=d[13]=d[15]=0,d[14]=-2*n*t/(n-t),r._markAsUpdated()},e.GetFinalMatrix=function(t,n,r,i,o,a){var s=t.width,l=t.height,u=t.x,c=t.y,h=e.FromValues(s/2,0,0,0,0,-l/2,0,0,0,0,a-o,0,u+s/2,l/2+c,o,1),d=O.Matrix[0];return n.multiplyToRef(r,d),d.multiplyToRef(i,d),d.multiply(h)},e.GetAsMatrix2x2=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[4],t[5]])},e.GetAsMatrix3x3=function(e){var t=e.m;return new Float32Array([t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]])},e.Transpose=function(t){var n=new e;return e.TransposeToRef(t,n),n},e.TransposeToRef=function(e,t){var n=t._m,r=e.m;n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15],t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},e.Reflection=function(t){var n=new e;return e.ReflectionToRef(t,n),n},e.ReflectionToRef=function(t,n){t.normalize();var r=t.normal.x,i=t.normal.y,o=t.normal.z,a=-2*r,s=-2*i,l=-2*o;e.FromValuesToRef(a*r+1,s*r,l*r,0,a*i,s*i+1,l*i,0,a*o,s*o,l*o+1,0,a*t.d,s*t.d,l*t.d,1,n)},e.FromXYZAxesToRef=function(t,n,r,i){e.FromValuesToRef(t.x,t.y,t.z,0,n.x,n.y,n.z,0,r.x,r.y,r.z,0,0,0,0,1,i)},e.FromQuaternionToRef=function(e,t){var n=e.x*e.x,r=e.y*e.y,i=e.z*e.z,o=e.x*e.y,a=e.z*e.w,s=e.z*e.x,l=e.y*e.w,u=e.y*e.z,c=e.x*e.w;t._m[0]=1-2*(r+i),t._m[1]=2*(o+a),t._m[2]=2*(s-l),t._m[3]=0,t._m[4]=2*(o-a),t._m[5]=1-2*(i+n),t._m[6]=2*(u+c),t._m[7]=0,t._m[8]=2*(s+l),t._m[9]=2*(u-c),t._m[10]=1-2*(r+n),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t._markAsUpdated()},e._updateFlagSeed=0,e._identityReadOnly=e.Identity(),e}(),_=function(){function e(e,t,n,r){this.normal=new d(e,t,n),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=397*e^(this.d||0)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var n=O.Matrix[0];g.TransposeToRef(t,n);var r=n.m,i=this.normal.x,o=this.normal.y,a=this.normal.z,s=this.d;return new e(i*r[0]+o*r[1]+a*r[2]+s*r[3],i*r[4]+o*r[5]+a*r[6]+s*r[7],i*r[8]+o*r[9]+a*r[10]+s*r[11],i*r[12]+o*r[13]+a*r[14]+s*r[15])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,n){var r,i=t.x-e.x,o=t.y-e.y,a=t.z-e.z,s=n.x-e.x,l=n.y-e.y,u=n.z-e.z,c=o*u-a*l,h=a*s-i*u,d=i*l-o*s,f=Math.sqrt(c*c+h*h+d*d);return r=0!==f?1/f:0,this.normal.x=c*r,this.normal.y=h*r,this.normal.z=d*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return d.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return d.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,n,r){var i=new e(0,0,0,0);return i.copyFromPoints(t,n,r),i},e.FromPositionAndNormal=function(t,n){var r=new e(0,0,0,0);return n.normalize(),r.normal=n,r.d=-(n.x*t.x+n.y*t.y+n.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,n){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return d.Dot(n,t)+r},e}(),v=function(){function e(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r}return e.prototype.toGlobal=function(t,n){return new e(this.x*t,this.y*n,this.width*t,this.height*n)},e.prototype.toGlobalToRef=function(e,t,n){return n.x=this.x*e,n.y=this.y*t,n.width=this.width*e,n.height=this.height*t,this},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}(),y=function(){function e(){}return e.GetPlanes=function(t){for(var n=[],r=0;r<6;r++)n.push(new _(0,0,0,0));return e.GetPlanesToRef(t,n),n},e.GetNearPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]+n[2],t.normal.y=n[7]+n[6],t.normal.z=n[11]+n[10],t.d=n[15]+n[14],t.normalize()},e.GetFarPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]-n[2],t.normal.y=n[7]-n[6],t.normal.z=n[11]-n[10],t.d=n[15]-n[14],t.normalize()},e.GetLeftPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]+n[0],t.normal.y=n[7]+n[4],t.normal.z=n[11]+n[8],t.d=n[15]+n[12],t.normalize()},e.GetRightPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]-n[0],t.normal.y=n[7]-n[4],t.normal.z=n[11]-n[8],t.d=n[15]-n[12],t.normalize()},e.GetTopPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]-n[1],t.normal.y=n[7]-n[5],t.normal.z=n[11]-n[9],t.d=n[15]-n[13],t.normalize()},e.GetBottomPlaneToRef=function(e,t){var n=e.m;t.normal.x=n[3]+n[1],t.normal.y=n[7]+n[5],t.normal.z=n[11]+n[9],t.d=n[15]+n[13],t.normalize()},e.GetPlanesToRef=function(t,n){e.GetNearPlaneToRef(t,n[0]),e.GetFarPlaneToRef(t,n[1]),e.GetLeftPlaneToRef(t,n[2]),e.GetRightPlaneToRef(t,n[3]),e.GetTopPlaneToRef(t,n[4]),e.GetBottomPlaneToRef(t,n[5])},e}();!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(r||(r={}));var b,E=function(){function e(){}return e.X=new d(1,0,0),e.Y=new d(0,1,0),e.Z=new d(0,0,1),e}(),x=function(){function e(){}return e.Interpolate=function(e,t,n,r,i){for(var o=1-3*r+3*t,a=3*r-6*t,s=3*t,l=e,u=0;u<5;u++){var c=l*l;l-=1/(3*o*c+2*a*l+s)*(o*(c*l)+a*c+s*l-e),l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*n+3*(1-l)*Math.pow(l,2)*i+Math.pow(l,3)},e}();!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(b||(b={}));var T=function(){function e(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.prototype.degrees=function(){return 180*this._radians/Math.PI},e.prototype.radians=function(){return this._radians},e.BetweenTwoPoints=function(t,n){var r=n.subtract(t);return new e(Math.atan2(r.y,r.x))},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}(),S=function(e,t,n){this.startPoint=e,this.midPoint=t,this.endPoint=n;var r=Math.pow(t.x,2)+Math.pow(t.y,2),i=(Math.pow(e.x,2)+Math.pow(e.y,2)-r)/2,o=(r-Math.pow(n.x,2)-Math.pow(n.y,2))/2,a=(e.x-t.x)*(t.y-n.y)-(t.x-n.x)*(e.y-t.y);this.centerPoint=new h((i*(t.y-n.y)-o*(e.y-t.y))/a,((e.x-t.x)*o-(t.x-n.x)*i)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=T.BetweenTwoPoints(this.centerPoint,this.startPoint);var s=this.startAngle.degrees(),l=T.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=T.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();l-s>180&&(l-=360),l-s<-180&&(l+=360),u-l>180&&(u-=360),u-l<-180&&(u+=360),this.orientation=l-s<0?b.CW:b.CCW,this.angle=T.FromDegrees(this.orientation===b.CW?s-u:u-s)},A=function(){function e(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new h(e,t))}return e.prototype.addLineTo=function(e,t){if(this.closed)return this;var n=new h(e,t),r=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(r).length(),this},e.prototype.addArcTo=function(e,t,n,r,i){if(void 0===i&&(i=36),this.closed)return this;var o=this._points[this._points.length-1],a=new h(e,t),s=new h(n,r),l=new S(o,a,s),u=l.angle.radians()/i;l.orientation===b.CW&&(u*=-1);for(var c=l.startAngle.radians()+u,d=0;d<i;d++){var f=Math.cos(c)*l.radius+l.centerPoint.x,p=Math.sin(c)*l.radius+l.centerPoint.y;this.addLineTo(f,p),c+=u}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(e){if(e<0||e>1)return h.Zero();for(var t=e*this.length(),n=0,r=0;r<this._points.length;r++){var i=(r+1)%this._points.length,o=this._points[r],a=this._points[i].subtract(o),s=a.length()+n;if(t>=n&&t<=s){var l=a.normalize(),u=t-n;return new h(o.x+l.x*u,o.y+l.y*u)}n=s}return h.Zero()},e.StartingAt=function(t,n){return new e(t,n)},e}(),P=function(){function e(e,t,n){void 0===t&&(t=null),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<e.length;r++)this._curve[r]=e[r].clone();this._raw=n||!1,this._compute(t)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.update=function(e,t){void 0===t&&(t=null);for(var n=0;n<e.length;n++)this._curve[n].x=e[n].x,this._curve[n].y=e[n].y,this._curve[n].z=e[n].z;return this._compute(t),this},e.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._raw||this._tangents[t-1].normalize();var n,r,i,o,a=this._tangents[0],s=this._normalVector(a,e);this._normals[0]=s,this._raw||this._normals[0].normalize(),this._binormals[0]=d.Cross(a,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var l=1;l<t;l++)n=this._getLastNonNullVector(l),l<t-1&&(r=this._getFirstNonNullVector(l),this._tangents[l]=n.add(r),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+n.length(),i=this._tangents[l],o=this._binormals[l-1],this._normals[l]=d.Cross(o,i),this._raw||this._normals[l].normalize(),this._binormals[l]=d.Cross(i,this._normals[l]),this._raw||this._binormals[l].normalize()},e.prototype._getFirstNonNullVector=function(e){for(var t=1,n=this._curve[e+t].subtract(this._curve[e]);0===n.length()&&e+t+1<this._curve.length;)t++,n=this._curve[e+t].subtract(this._curve[e]);return n},e.prototype._getLastNonNullVector=function(e){for(var t=1,n=this._curve[e].subtract(this._curve[e-t]);0===n.length()&&e>t+1;)t++,n=this._curve[e].subtract(this._curve[e-t]);return n},e.prototype._normalVector=function(e,t){var n,r,i=e.length();return 0===i&&(i=1),null==t?(r=o.a.WithinEpsilon(Math.abs(e.y)/i,1,l)?o.a.WithinEpsilon(Math.abs(e.x)/i,1,l)?o.a.WithinEpsilon(Math.abs(e.z)/i,1,l)?d.Zero():new d(0,0,1):new d(1,0,0):new d(0,-1,0),n=d.Cross(e,r)):(n=d.Cross(e,t),d.CrossToRef(n,e,n)),n.normalize(),n},e}(),M=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,n,r,i){i=i>2?i:3;for(var o=new Array,a=function(e,t,n,r){return(1-e)*(1-e)*t+2*e*(1-e)*n+e*e*r},s=0;s<=i;s++)o.push(new d(a(s/i,t.x,n.x,r.x),a(s/i,t.y,n.y,r.y),a(s/i,t.z,n.z,r.z)));return new e(o)},e.CreateCubicBezier=function(t,n,r,i,o){o=o>3?o:4;for(var a=new Array,s=function(e,t,n,r,i){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*n+3*e*e*(1-e)*r+e*e*e*i},l=0;l<=o;l++)a.push(new d(s(l/o,t.x,n.x,r.x,i.x),s(l/o,t.y,n.y,r.y,i.y),s(l/o,t.z,n.z,r.z,i.z)));return new e(a)},e.CreateHermiteSpline=function(t,n,r,i,o){for(var a=new Array,s=1/o,l=0;l<=o;l++)a.push(d.Hermite(t,n,r,i,l*s));return new e(a)},e.CreateCatmullRomSpline=function(t,n,r){var i=new Array,o=1/n,a=0;if(r){for(var s=t.length,l=0;l<s;l++){a=0;for(var u=0;u<n;u++)i.push(d.CatmullRom(t[l%s],t[(l+1)%s],t[(l+2)%s],t[(l+3)%s],a)),a+=o}i.push(i[0])}else{var c=new Array;for(c.push(t[0].clone()),Array.prototype.push.apply(c,t),c.push(t[t.length-1].clone()),l=0;l<c.length-3;l++)for(a=0,u=0;u<n;u++)i.push(d.CatmullRom(c[l],c[l+1],c[l+2],c[l+3],a)),a+=o;l--,i.push(d.CatmullRom(c[l],c[l+1],c[l+2],c[l+3],a))}return new e(i)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(t){for(var n=this._points[this._points.length-1],r=this._points.slice(),i=t.getPoints(),o=1;o<i.length;o++)r.push(i[o].subtract(i[0]).add(n));return new e(r)},e.prototype._computeLength=function(e){for(var t=0,n=1;n<e.length;n++)t+=e[n].subtract(e[n-1]).length();return t},e}(),R=function(){function e(e,t){void 0===e&&(e=d.Zero()),void 0===t&&(t=d.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}(),C=function(){function e(e,t,n){void 0===e&&(e=d.Zero()),void 0===t&&(t=d.Up()),void 0===n&&(n=h.Zero()),this.position=e,this.normal=t,this.uv=n}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}(),w=function(){function e(){}return e.Color3=i.a.BuildArray(3,u.Black),e.Color4=i.a.BuildArray(3,function(){return new c(0,0,0,0)}),e.Vector2=i.a.BuildArray(3,h.Zero),e.Vector3=i.a.BuildArray(13,d.Zero),e.Vector4=i.a.BuildArray(3,f.Zero),e.Quaternion=i.a.BuildArray(2,m.Zero),e.Matrix=i.a.BuildArray(8,g.Identity),e}(),O=function(){function e(){}return e.Vector3=i.a.BuildArray(6,d.Zero),e.Matrix=i.a.BuildArray(2,g.Identity),e.Quaternion=i.a.BuildArray(3,m.Zero),e}()},function(e,t,n){"use strict";n.d(t,"d",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"e",function(){return l});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function a(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function s(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}l((r=r.apply(e,t||[])).next())})}function l(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}},function(e,t,n){"use strict";n.d(t,"b",function(){return h}),n.d(t,"c",function(){return d}),n.d(t,"m",function(){return f}),n.d(t,"e",function(){return p}),n.d(t,"h",function(){return m}),n.d(t,"n",function(){return g}),n.d(t,"o",function(){return _}),n.d(t,"k",function(){return v}),n.d(t,"g",function(){return y}),n.d(t,"f",function(){return b}),n.d(t,"i",function(){return E}),n.d(t,"l",function(){return x}),n.d(t,"j",function(){return T}),n.d(t,"d",function(){return S}),n.d(t,"a",function(){return A});var r=n(29),i=n(0),o=n(19),a={},s={},l=function(e,t,n){var i=e();r.a&&r.a.AddTagsTo(i,t.tags);var o=u(i);for(var a in o){var s=o[a],l=t[a],c=s.type;if(null!=l&&"uniqueId"!==a)switch(c){case 0:case 6:case 11:i[a]=l;break;case 1:i[a]=n||l.isRenderTarget?l:l.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[a]=n?l:l.clone()}}return i};function u(e){var t=e.getClassName();if(s[t])return s[t];s[t]={};for(var n=s[t],r=e,i=t;i;){var o=a[i];for(var l in o)n[l]=o[l];var u=void 0,c=!1;do{if(!(u=Object.getPrototypeOf(r)).getClassName){c=!0;break}if(u.getClassName()!==i)break;r=u}while(u);if(c)break;i=u.getClassName(),r=u}return n}function c(e,t){return function(n,r){var i=function(e){var t=e.getClassName();return a[t]||(a[t]={}),a[t]}(n);i[r]||(i[r]={type:e,sourceName:t})}}function h(e,t){return void 0===t&&(t=null),function(e,t){return void 0===t&&(t=null),function(n,r){var i=t||"_"+r;Object.defineProperty(n,r,{get:function(){return this[i]},set:function(t){this[i]!==t&&(this[i]=t,n[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function d(e){return c(0,e)}function f(e){return c(1,e)}function p(e){return c(2,e)}function m(e){return c(3,e)}function g(e){return c(4,e)}function _(e){return c(5,e)}function v(e){return c(6,e)}function y(e){return c(7,e)}function b(e){return c(8,e)}function E(e){return c(9,e)}function x(e){return c(10,e)}function T(e){return c(12,e)}function S(e){return c(11,e)}var A=function(){function e(){}return e.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var n=0;n<e.animations.length;n++){var r=e.animations[n];t.animations.push(r.serialize())}}},e.Serialize=function(e,t){t||(t={}),r.a&&(t.tags=r.a.GetTags(e));var n=u(e);for(var i in n){var o=n[i],a=o.sourceName||i,s=o.type,l=e[i];if(null!=l)switch(s){case 0:t[a]=l;break;case 1:t[a]=l.serialize();break;case 2:t[a]=l.asArray();break;case 3:t[a]=l.serialize();break;case 4:case 5:t[a]=l.asArray();break;case 6:t[a]=l.id;break;case 7:t[a]=l.serialize();break;case 8:t[a]=l.asArray();break;case 9:t[a]=l.serialize();break;case 10:t[a]=l.asArray();break;case 11:t[a]=l.id;case 12:t[a]=l.asArray()}}return t},e.Parse=function(t,n,o,a){void 0===a&&(a=null);var s=t();a||(a=""),r.a&&r.a.AddTagsTo(s,n.tags);var l=u(s);for(var c in l){var h=l[c],d=n[h.sourceName||c],f=h.type;if(null!=d){var p=s;switch(f){case 0:p[c]=d;break;case 1:o&&(p[c]=e._TextureParser(d,o,a));break;case 2:p[c]=i.e.FromArray(d);break;case 3:p[c]=e._FresnelParametersParser(d);break;case 4:p[c]=i.w.FromArray(d);break;case 5:p[c]=i.x.FromArray(d);break;case 6:o&&(p[c]=o.getLastMeshByID(d));break;case 7:p[c]=e._ColorCurvesParser(d);break;case 8:p[c]=i.f.FromArray(d);break;case 9:p[c]=e._ImageProcessingConfigurationParser(d);break;case 10:p[c]=i.q.FromArray(d);break;case 11:o&&(p[c]=o.getCameraByID(d));case 12:p[c]=i.j.FromArray(d)}}}return s},e.Clone=function(e,t){return l(e,t,!1)},e.Instanciate=function(e,t){return l(e,t,!0)},e._ImageProcessingConfigurationParser=function(e){throw o.a.WarnImport("ImageProcessingConfiguration")},e._FresnelParametersParser=function(e){throw o.a.WarnImport("FresnelParameters")},e._ColorCurvesParser=function(e){throw o.a.WarnImport("ColorCurves")},e._TextureParser=function(e,t,n){throw o.a.WarnImport("Texture")},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=1,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=2,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST=8,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR=11,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e.MATERIAL_TextureDirtyFlag=1,e.MATERIAL_LightDirtyFlag=2,e.MATERIAL_FresnelDirtyFlag=4,e.MATERIAL_AttributesDirtyFlag=8,e.MATERIAL_MiscDirtyFlag=16,e.MATERIAL_AllDirtyFlag=31,e.MATERIAL_TriangleFillMode=0,e.MATERIAL_WireFrameFillMode=1,e.MATERIAL_PointFillMode=2,e.MATERIAL_PointListDrawMode=3,e.MATERIAL_LineListDrawMode=4,e.MATERIAL_LineLoopDrawMode=5,e.MATERIAL_LineStripDrawMode=6,e.MATERIAL_TriangleStripDrawMode=7,e.MATERIAL_TriangleFanDrawMode=8,e.MATERIAL_ClockWiseSideOrientation=0,e.MATERIAL_CounterClockWiseSideOrientation=1,e.ACTION_NothingTrigger=0,e.ACTION_OnPickTrigger=1,e.ACTION_OnLeftPickTrigger=2,e.ACTION_OnRightPickTrigger=3,e.ACTION_OnCenterPickTrigger=4,e.ACTION_OnPickDownTrigger=5,e.ACTION_OnDoublePickTrigger=6,e.ACTION_OnPickUpTrigger=7,e.ACTION_OnPickOutTrigger=16,e.ACTION_OnLongPressTrigger=8,e.ACTION_OnPointerOverTrigger=9,e.ACTION_OnPointerOutTrigger=10,e.ACTION_OnEveryFrameTrigger=11,e.ACTION_OnIntersectionEnterTrigger=12,e.ACTION_OnIntersectionExitTrigger=13,e.ACTION_OnKeyDownTrigger=14,e.ACTION_OnKeyUpTrigger=15,e.PARTICLES_BILLBOARDMODE_Y=2,e.PARTICLES_BILLBOARDMODE_ALL=7,e.PARTICLES_BILLBOARDMODE_STRETCHED=8,e.PARTICLES_BaseAssetsUrl="https://assets.babylonjs.com/particles",e.MESHES_CULLINGSTRATEGY_STANDARD=0,e.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e.SCENELOADER_NO_LOGGING=0,e.SCENELOADER_MINIMAL_LOGGING=1,e.SCENELOADER_SUMMARY_LOGGING=2,e.SCENELOADER_DETAILED_LOGGING=3,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r=function(){function e(e,t,n,r,i,o,a){void 0===r&&(r=0),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=n,this._instanced=o,this._data=t,this.byteStride=a?r:r*Float32Array.BYTES_PER_ELEMENT,i||this.create()}return e.prototype.createVertexBuffer=function(e,t,n,r,o,a){void 0===a&&(a=!1);var s=a?t:t*Float32Array.BYTES_PER_ELEMENT,l=r?a?r:r*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new i(this._engine,this,e,this._updatable,!0,l,void 0===o?this._instanced:o,s,n,void 0,void 0,!0)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(e){this.create(e)},e.prototype.updateDirectly=function(e,t,n,r){void 0===r&&(r=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,r?t:t*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this._data=null)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},e}(),i=function(){function e(t,n,i,o,a,s,l,u,c,h,d,f){if(void 0===d&&(d=!1),void 0===f&&(f=!1),n instanceof r?(this._buffer=n,this._ownsBuffer=!1):(this._buffer=new r(t,n,o,s,a,l,f),this._ownsBuffer=!0),this._kind=i,null==h){var p=this.getData();this.type=e.FLOAT,p instanceof Int8Array?this.type=e.BYTE:p instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:p instanceof Int16Array?this.type=e.SHORT:p instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:p instanceof Int32Array?this.type=e.INT:p instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=h;var m=e.GetTypeByteLength(this.type);f?(this._size=c||(s?s/m:e.DeduceStride(i)),this.byteStride=s||this._buffer.byteStride||this._size*m,this.byteOffset=u||0):(this._size=c||s||e.DeduceStride(i),this.byteStride=s?s*m:this._buffer.byteStride||this._size*m,this.byteOffset=(u||0)*m),this.normalized=d,this._instanced=void 0!==l&&l,this._instanceDivisor=l?1:0}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(){return this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(e){this._buffer.create(e)},e.prototype.update=function(e){this._buffer.update(e)},e.prototype.updateDirectly=function(e,t,n){void 0===n&&(n=!1),this._buffer.updateDirectly(e,t,void 0,n)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,n){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,n)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},e.ForEach=function(t,n,r,i,o,a,s,l){if(t instanceof Array)for(var u=n/4,c=r/4,h=0;h<a;h+=i){for(var d=0;d<i;d++)l(t[u+d],h+d);u+=c}else{var f=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),p=e.GetTypeByteLength(o);for(h=0;h<a;h+=i){var m=n;for(d=0;d<i;d++)l(e._GetFloatValue(f,o,m,s),h+d),m+=p;n+=r}}},e._GetFloatValue=function(t,n,r,i){switch(n){case e.BYTE:var o=t.getInt8(r);return i&&(o=Math.max(o/127,-1)),o;case e.UNSIGNED_BYTE:return o=t.getUint8(r),i&&(o/=255),o;case e.SHORT:return o=t.getInt16(r,!0),i&&(o=Math.max(o/16383,-1)),o;case e.UNSIGNED_SHORT:return o=t.getUint16(r,!0),i&&(o/=65535),o;case e.FLOAT:return t.getFloat32(r,!0);default:throw new Error("Invalid component type "+n)}},e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}()},function(e,t,n){"use strict";n.d(t,"c",function(){return s}),n.d(t,"b",function(){return l}),n.d(t,"a",function(){return u});var r=n(8),i=n(3),o=n(35),a=n(6),s=function(){function e(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return e.prototype.unBindMesh=function(){this._mesh=null},e.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},e.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(e.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),e.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0&&this._mesh.material){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var n=this._mesh.getScene(),r=0;r<n.meshes.length;r++){var i=n.meshes[r];if(i.material&&i.computeBonesUsingShaders&&0!==i.numBoneInfluencers)if(i.material.getEffect()===t)i.computeBonesUsingShaders=!1;else if(i.subMeshes)for(var o=0,a=i.subMeshes;o<a.length;o++)if(a[o].effect===t){i.computeBonesUsingShaders=!1;break}}}else{var s=this._defines[this._currentRank];if(s)for(r=0;r<s.length;r++)e=e.replace("#define "+s[r],"");this._currentRank++}return e},e}(),l=function(){},u=function(){function e(t,n,i,o,a,s,l,u,c,h){var d,f,p=this;if(void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new r.c,this.onErrorObservable=new r.c,this._onBindObservable=null,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=t,n.attributes){var m=n;if(this._engine=i,this._attributesNames=m.attributes,this._uniformsNames=m.uniformsNames.concat(m.samplers),this._samplerList=m.samplers.slice(),this.defines=m.defines,this.onError=m.onError,this.onCompiled=m.onCompiled,this._fallbacks=m.fallbacks,this._indexParameters=m.indexParameters,this._transformFeedbackVaryings=m.transformFeedbackVaryings,m.uniformBuffersNames)for(var g=0;g<m.uniformBuffersNames.length;g++)this._uniformBuffersNames[m.uniformBuffersNames[g]]=g}else this._engine=a,this.defines=null==s?"":s,this._uniformsNames=i.concat(o),this._samplerList=o?o.slice():[],this._attributesNames=n,this.onError=c,this.onCompiled=u,this._indexParameters=h,this._fallbacks=l;this.uniqueId=e._uniqueIdSeed++,t.vertexElement?(d=document.getElementById(t.vertexElement))||(d=t.vertexElement):d=t.vertex||t,t.fragmentElement?(f=document.getElementById(t.fragmentElement))||(f=t.fragmentElement):f=t.fragment||t,this._loadVertexShader(d,function(e){p._processIncludes(e,function(e){p._processShaderConversion(e,!1,function(e){p._loadFragmentShader(f,function(n){p._processIncludes(n,function(n){p._processShaderConversion(n,!0,function(n){if(t){var r=t.vertexElement||t.vertex||t,i=t.fragmentElement||t.fragment||t;p._vertexSourceCode="#define SHADER_NAME vertex:"+r+"\n"+e,p._fragmentSourceCode="#define SHADER_NAME fragment:"+i+"\n"+n}else p._vertexSourceCode=e,p._fragmentSourceCode=n;p._prepareEffect()})})})})})})}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new r.c),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add(function(t){e(t)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){t._checkIsReady()},16))},e.prototype._checkIsReady=function(){var e=this;this.isReady()||setTimeout(function(){e._checkIsReady()},16)},e.prototype._loadVertexShader=function(t,n){var r;o.a.IsWindowObjectExist()&&t instanceof HTMLElement?n(o.a.GetDOMTextContent(t)):"base64:"!==t.substr(0,7)?e.ShadersStore[t+"VertexShader"]?n(e.ShadersStore[t+"VertexShader"]):(r="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(r+".vertex.fx",n)):n(window.atob(t.substr(7)))},e.prototype._loadFragmentShader=function(t,n){var r;o.a.IsWindowObjectExist()&&t instanceof HTMLElement?n(o.a.GetDOMTextContent(t)):"base64:"!==t.substr(0,7)?e.ShadersStore[t+"PixelShader"]?n(e.ShadersStore[t+"PixelShader"]):e.ShadersStore[t+"FragmentShader"]?n(e.ShadersStore[t+"FragmentShader"]):(r="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(r+".fragment.fx",n)):n(window.atob(t.substr(7)))},e.prototype._dumpShadersSource=function(e,t,n){var r=(this._engine.webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"")+(n?n+"\n":"");t=r+t;var i=2,o=/\n/gm,s="\n1\t"+(e=r+e).replace(o,function(){return"\n"+i+++"\t"});i=2;var l="\n1\t"+t.replace(o,function(){return"\n"+i+++"\t"});this.name.vertexElement?(a.a.Error("Vertex shader: "+this.name.vertexElement+s),a.a.Error("Fragment shader: "+this.name.fragmentElement+l)):this.name.vertex?(a.a.Error("Vertex shader: "+this.name.vertex+s),a.a.Error("Fragment shader: "+this.name.fragment+l)):(a.a.Error("Vertex shader: "+this.name+s),a.a.Error("Fragment shader: "+this.name+l))},e.prototype._processShaderConversion=function(e,t,n){var r=this._processPrecision(e);if(1!=this._engine.webGLVersion)if(-1===r.indexOf("#version 3")){var i=-1!==r.search(/#extension.+GL_EXT_draw_buffers.+require/),o=r.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"");o=(o=(o=(o=o.replace(/varying(?![\n\r])\s/g,t?"in ":"out ")).replace(/attribute[ \t]/g,"in ")).replace(/[ \t]attribute/g," in")).replace(/texture2D\s*\(/g,"texture("),t&&(o=(o=(o=(o=(o=(o=(o=o.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i?"":"out vec4 glFragColor;\n")+"void main(")),-1!==this.defines.indexOf("#define MULTIVIEW\n")&&!t&&(o="#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+o),n(o)}else n(r.replace("#version 300 es",""));else n(r)},e.prototype._processIncludes=function(t,n){for(var r=this,i=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=i.exec(t),a=new String(t);null!=o;){var s=o[1];if(-1!==s.indexOf("__decl__")&&(s=s.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(s=(s=s.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),s+="Declaration"),!e.IncludesShadersStore[s]){var l=e.ShadersRepository+"ShadersInclude/"+s+".fx";return void this._engine._loadFile(l,function(t){e.IncludesShadersStore[s]=t,r._processIncludes(a,n)})}var u=e.IncludesShadersStore[s];if(o[2])for(var c=o[3].split(","),h=0;h<c.length;h+=2){var d=new RegExp(c[h],"g"),f=c[h+1];u=u.replace(d,f)}if(o[4]){var p=o[5];if(-1!==p.indexOf("..")){var m=p.split(".."),g=parseInt(m[0]),_=parseInt(m[1]),v=u.slice(0);u="",isNaN(_)&&(_=this._indexParameters[m[1]]);for(var y=g;y<_;y++)this._engine.supportsUniformBuffers||(v=v.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),u+=v.replace(/\{X\}/g,y.toString())+"\n"}else this._engine.supportsUniformBuffers||(u=u.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),u=u.replace(/\{X\}/g,p)}a=a.replace(o[0],u),o=i.exec(t)}n(a)},e.prototype._processPrecision=function(e){var t=this._engine._shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=t?"precision highp float;\n"+e:"precision mediump float;\n"+e:t||(e=e.replace("precision highp float","precision mediump float")),e},e.prototype._rebuildProgram=function(e,t,n,r){var o=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){r&&r(t)},this.onCompiled=function(){for(var e=o.getEngine().scenes,t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(i.a.MATERIAL_AllDirtyFlag);o._pipelineContext._handlesSpectorRebuildCallback(n)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,n=this.defines,r=this._fallbacks;this._valueCache={};var i=this._pipelineContext;try{var o=this._engine;this._pipelineContext=o.createPipelineContext();var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?o._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,s,null,this._transformFeedbackVaryings):o._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,s,n,this._transformFeedbackVaryings),o._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(o.supportsUniformBuffers)for(var n in e._uniformBuffersNames)e.bindUniformBlock(n,e._uniformBuffersNames[n]);var r;for(o.getUniforms(e._pipelineContext,e._uniformsNames).forEach(function(t,n){e._uniforms[e._uniformsNames[n]]=t}),e._attributes=o.getAttributes(e._pipelineContext,t),r=0;r<e._samplerList.length;r++)null==e.getUniform(e._samplerList[r])&&(e._samplerList.splice(r,1),r--);e._samplerList.forEach(function(t,n){e._samplers[t]=n}),o.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)}),this._pipelineContext.isAsync&&this._checkIsReady()}catch(e){this._compilationError=e.message,a.a.Error("Unable to compile effect:"),a.a.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),a.a.Error("Attributes: "+t.map(function(e){return" "+e})),a.a.Error("Error: "+this._compilationError),i&&(this._pipelineContext=i,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),r&&r.isMoreFallbacks?(a.a.Error("Trying next fallback."),this.defines=r.reduce(this.defines,this),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureArray=function(e,t){var n=e+"Ex";if(-1===this._samplerList.indexOf(n))for(var r=this._samplers[e],i=1;i<t.length;i++)this._samplerList.splice(r+i,0,n),this._samplers[n]=r+i;this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},e.prototype._cacheMatrix=function(e,t){var n=this._valueCache[e],r=t.updateFlag;return(void 0===n||n!==r)&&(this._valueCache[e]=r,!0)},e.prototype._cacheFloat2=function(e,t,n){var r=this._valueCache[e];if(!r)return r=[t,n],this._valueCache[e]=r,!0;var i=!1;return r[0]!==t&&(r[0]=t,i=!0),r[1]!==n&&(r[1]=n,i=!0),i},e.prototype._cacheFloat3=function(e,t,n,r){var i=this._valueCache[e];if(!i)return i=[t,n,r],this._valueCache[e]=i,!0;var o=!1;return i[0]!==t&&(i[0]=t,o=!0),i[1]!==n&&(i[1]=n,o=!0),i[2]!==r&&(i[2]=r,o=!0),o},e.prototype._cacheFloat4=function(e,t,n,r,i){var o=this._valueCache[e];if(!o)return o=[t,n,r,i],this._valueCache[e]=o,!0;var a=!1;return o[0]!==t&&(o[0]=t,a=!0),o[1]!==n&&(o[1]=n,a=!0),o[2]!==r&&(o[2]=r,a=!0),o[3]!==i&&(o[3]=i,a=!0),a},e.prototype.bindUniformBuffer=function(t,n){var r=this._uniformBuffersNames[n];void 0!==r&&e._baseCache[r]!==t&&(e._baseCache[r]=t,this._engine.bindUniformBufferBase(t,r))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){var n=this._valueCache[e];return void 0!==n&&n===t?this:(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t),this)},e.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},e.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},e.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},e.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},e.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray(this._uniforms[e],t),this},e.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray2(this._uniforms[e],t),this},e.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray3(this._uniforms[e],t),this},e.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray4(this._uniforms[e],t),this},e.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},e.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrix(this._uniforms[e],t),this},e.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},e.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},e.prototype.setFloat=function(e,t){var n=this._valueCache[e];return void 0!==n&&n===t?this:(this._valueCache[e]=t,this._engine.setFloat(this._uniforms[e],t),this)},e.prototype.setBool=function(e,t){var n=this._valueCache[e];return void 0!==n&&n===t?this:(this._valueCache[e]=t,this._engine.setBool(this._uniforms[e],t?1:0),this)},e.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this._uniforms[e],t.x,t.y),this},e.prototype.setFloat2=function(e,t,n){return this._cacheFloat2(e,t,n)&&this._engine.setFloat2(this._uniforms[e],t,n),this},e.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z),this},e.prototype.setFloat3=function(e,t,n,r){return this._cacheFloat3(e,t,n,r)&&this._engine.setFloat3(this._uniforms[e],t,n,r),this},e.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w),this},e.prototype.setFloat4=function(e,t,n,r,i){return this._cacheFloat4(e,t,n,r,i)&&this._engine.setFloat4(this._uniforms[e],t,n,r,i),this},e.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setColor3(this._uniforms[e],t),this},e.prototype.setColor4=function(e,t,n){return this._cacheFloat4(e,t.r,t.g,t.b,n)&&this._engine.setColor4(this._uniforms[e],t,n),this},e.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setDirectColor4(this._uniforms[e],t),this},e.prototype.dispose=function(){this._engine._releaseEffect(this)},e.RegisterShader=function(t,n,r){n&&(e.ShadersStore[t+"PixelShader"]=n),r&&(e.ShadersStore[t+"VertexShader"]=r)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},n=new Date;return"["+t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(t){var n=e._FormatMessage(t);console.log("BJS - "+n);var r="<div style='color:white'>"+n+"</div><br>";e._AddLogEntry(r)},e._WarnDisabled=function(e){},e._WarnEnabled=function(t){var n=e._FormatMessage(t);console.warn("BJS - "+n);var r="<div style='color:orange'>"+n+"</div><br>";e._AddLogEntry(r)},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(t){e.errorsCount++;var n=e._FormatMessage(t);console.error("BJS - "+n);var r="<div style='color:red'>"+n+"</div><br>";e._AddLogEntry(r)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){(t&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(t&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(t&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!0,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(1),i=n(2),o=n(8),a=n(9),s=n(0),l=n(44),u=n(3),c=n(22),h=n(19),d=function(e){function t(n,r,i,s,l,c,h,d,f,p){void 0===i&&(i=!1),void 0===s&&(s=!0),void 0===l&&(l=t.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===f&&(f=!1);var m=e.call(this,r)||this;if(m.url=null,m.uOffset=0,m.vOffset=0,m.uScale=1,m.vScale=1,m.uAng=0,m.vAng=0,m.wAng=0,m.uRotationCenter=.5,m.vRotationCenter=.5,m.wRotationCenter=.5,m.inspectableCustomProperties=null,m._noMipmap=!1,m._invertY=!1,m._rowGenerationMatrix=null,m._cachedTextureMatrix=null,m._projectionModeMatrix=null,m._t0=null,m._t1=null,m._t2=null,m._cachedUOffset=-1,m._cachedVOffset=-1,m._cachedUScale=0,m._cachedVScale=0,m._cachedUAng=-1,m._cachedVAng=-1,m._cachedWAng=-1,m._cachedProjectionMatrixId=-1,m._cachedCoordinatesMode=-1,m._initialSamplingMode=t.BILINEAR_SAMPLINGMODE,m._buffer=null,m._deleteBuffer=!1,m._format=null,m._delayedOnLoad=null,m._delayedOnError=null,m.onLoadObservable=new o.c,m._isBlocking=!0,m.name=n||"",m.url=n,m._noMipmap=i,m._invertY=s,m._initialSamplingMode=l,m._buffer=d,m._deleteBuffer=f,p&&(m._format=p),!(r=m.getScene()))return m;r.getEngine().onBeforeTextureInitObservable.notifyObservers(m);var g=function(){m._texture&&m._texture._invertVScale&&(m.vScale=-1),m.onLoadObservable.hasObservers()&&m.onLoadObservable.notifyObservers(m),c&&c(),!m.isBlocking&&r&&r.resetCachedMaterial()};return m.url?(m._texture=m._getFromCache(m.url,i,l,s),m._texture?m._texture.isReady?a.h.SetImmediate(function(){return g()}):m._texture.onLoadedObservable.add(g):r.useDelayedTextureLoading?(m.delayLoadState=u.a.DELAYLOADSTATE_NOTLOADED,m._delayedOnLoad=g,m._delayedOnError=h):(m._texture=r.getEngine().createTexture(m.url,i,s,r,l,g,h,m._buffer,void 0,m._format),f&&delete m._buffer),m):(m._delayedOnLoad=g,m._delayedOnError=h,m)}return r.d(t,e),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invertY",{get:function(){return this._invertY},enumerable:!0,configurable:!0}),t.prototype.updateURL=function(e,t,n){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(u.a.MATERIAL_TextureDirtyFlag)),this.url=e,this._buffer=t,this.delayLoadState=u.a.DELAYLOADSTATE_NOTLOADED,n&&(this._delayedOnLoad=n),this.delayLoad()},t.prototype.delayLoad=function(){if(this.delayLoadState===u.a.DELAYLOADSTATE_NOTLOADED){var e=this.getScene();e&&(this.delayLoadState=u.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?a.h.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer),this._delayedOnLoad=null,this._delayedOnError=null)}},t.prototype._prepareRowForTextureGeneration=function(e,t,n,r){e*=this.uScale,t*=this.vScale,e-=this.uRotationCenter*this.uScale,t-=this.vRotationCenter*this.vScale,n-=this.wRotationCenter,s.x.TransformCoordinatesFromFloatsToRef(e,t,n,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this.uScale+this.uOffset,r.y+=this.vRotationCenter*this.vScale+this.vOffset,r.z+=this.wRotationCenter},t.prototype.getTextureMatrix=function(){var e=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=s.j.Zero(),this._rowGenerationMatrix=new s.j,this._t0=s.x.Zero(),this._t1=s.x.Zero(),this._t2=s.x.Zero()),s.j.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),s.j.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);var t=this.getScene();return t?(t.markAllMaterialsAsDirty(u.a.MATERIAL_TextureDirtyFlag,function(t){return t.hasTexture(e)}),this._cachedTextureMatrix):this._cachedTextureMatrix},t.prototype.getReflectionTextureMatrix=function(){var e=this,n=this.getScene();if(!n)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==t.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===n.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=s.j.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=s.j.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case t.PLANAR_MODE:s.j.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case t.PROJECTION_MODE:s.j.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var r=n.getProjectionMatrix();this._cachedProjectionMatrixId=r.updateFlag,r.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:s.j.IdentityToRef(this._cachedTextureMatrix)}return n.markAllMaterialsAsDirty(u.a.MATERIAL_TextureDirtyFlag,function(t){return-1!==t.getActiveTextures().indexOf(e)}),this._cachedTextureMatrix},t.prototype.clone=function(){var e=this;return i.a.Clone(function(){return new t(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode,void 0,void 0,e._texture?e._texture._buffer:void 0)},this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(t.base64String=this._buffer,t.name=t.name.replace("data:","")),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t},t.prototype.getClassName=function(){return"Texture"},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},t.Parse=function(e,n,r){if(e.customType){var o=a.h.Instantiate(e.customType).Parse(e,n,r);return e.samplingMode&&o.updateSamplingMode&&o._samplingMode&&o._samplingMode!==e.samplingMode&&o.updateSamplingMode(e.samplingMode),o}if(e.isCube&&!e.isRenderTarget)return t._CubeTextureParser(e,n,r);if(!e.name&&!e.isRenderTarget)return null;var l=i.a.Parse(function(){var i,o=!0;if(e.noMipmap&&(o=!1),e.mirrorPlane){var a=t._CreateMirror(e.name,e.renderTargetSize,n,o);return a._waitingRenderList=e.renderList,a.mirrorPlane=s.n.FromArray(e.mirrorPlane),a}if(e.isRenderTarget){var l=null;if(e.isCube){if(n.reflectionProbes)for(var u=0;u<n.reflectionProbes.length;u++){var c=n.reflectionProbes[u];if(c.name===e.name)return c.cubeTexture}}else(l=t._CreateRenderTargetTexture(e.name,e.renderTargetSize,n,o))._waitingRenderList=e.renderList;return l}if(e.base64String)i=t.CreateFromBase64String(e.base64String,e.name,n,!o);else{var h=r+e.name;t.UseSerializedUrlIfAny&&e.url&&(h=e.url),i=new t(h,n,!o,e.invertY)}return i},e,n);if(e.samplingMode){var u=e.samplingMode;l&&l.samplingMode!==u&&l.updateSamplingMode(u)}if(l&&e.animations)for(var h=0;h<e.animations.length;h++){var d=e.animations[h],f=c.a.GetClass("BABYLON.Animation");f&&l.animations.push(f.Parse(d))}return l},t.CreateFromBase64String=function(e,n,r,i,o,a,s,l,c){return void 0===a&&(a=t.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=u.a.TEXTUREFORMAT_RGBA),new t("data:"+n,r,i,o,a,s,l,e,!1,c)},t.LoadFromDataString=function(e,n,r,i,o,a,s,l,c,h){return void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=!0),void 0===s&&(s=t.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===c&&(c=null),void 0===h&&(h=u.a.TEXTUREFORMAT_RGBA),"data:"!==e.substr(0,5)&&(e="data:"+e),new t(e,r,o,a,s,l,c,n,i,h)},t._CubeTextureParser=function(e,t,n){throw h.a.WarnImport("CubeTexture")},t._CreateMirror=function(e,t,n,r){throw h.a.WarnImport("MirrorTexture")},t._CreateRenderTargetTexture=function(e,t,n,r){throw h.a.WarnImport("RenderTargetTexture")},t.NEAREST_SAMPLINGMODE=u.a.TEXTURE_NEAREST_SAMPLINGMODE,t.NEAREST_NEAREST_MIPLINEAR=u.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,t.BILINEAR_SAMPLINGMODE=u.a.TEXTURE_BILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPNEAREST=u.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,t.TRILINEAR_SAMPLINGMODE=u.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t.LINEAR_LINEAR_MIPLINEAR=u.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,t.NEAREST_NEAREST_MIPNEAREST=u.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,t.NEAREST_LINEAR_MIPNEAREST=u.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,t.NEAREST_LINEAR_MIPLINEAR=u.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,t.NEAREST_LINEAR=u.a.TEXTURE_NEAREST_LINEAR,t.NEAREST_NEAREST=u.a.TEXTURE_NEAREST_NEAREST,t.LINEAR_NEAREST_MIPNEAREST=u.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,t.LINEAR_NEAREST_MIPLINEAR=u.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,t.LINEAR_LINEAR=u.a.TEXTURE_LINEAR_LINEAR,t.LINEAR_NEAREST=u.a.TEXTURE_LINEAR_NEAREST,t.EXPLICIT_MODE=u.a.TEXTURE_EXPLICIT_MODE,t.SPHERICAL_MODE=u.a.TEXTURE_SPHERICAL_MODE,t.PLANAR_MODE=u.a.TEXTURE_PLANAR_MODE,t.CUBIC_MODE=u.a.TEXTURE_CUBIC_MODE,t.PROJECTION_MODE=u.a.TEXTURE_PROJECTION_MODE,t.SKYBOX_MODE=u.a.TEXTURE_SKYBOX_MODE,t.INVCUBIC_MODE=u.a.TEXTURE_INVCUBIC_MODE,t.EQUIRECTANGULAR_MODE=u.a.TEXTURE_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MODE=u.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=u.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,t.CLAMP_ADDRESSMODE=u.a.TEXTURE_CLAMP_ADDRESSMODE,t.WRAP_ADDRESSMODE=u.a.TEXTURE_WRAP_ADDRESSMODE,t.MIRROR_ADDRESSMODE=u.a.TEXTURE_MIRROR_ADDRESSMODE,t.UseSerializedUrlIfAny=!1,r.c([Object(i.c)()],t.prototype,"url",void 0),r.c([Object(i.c)()],t.prototype,"uOffset",void 0),r.c([Object(i.c)()],t.prototype,"vOffset",void 0),r.c([Object(i.c)()],t.prototype,"uScale",void 0),r.c([Object(i.c)()],t.prototype,"vScale",void 0),r.c([Object(i.c)()],t.prototype,"uAng",void 0),r.c([Object(i.c)()],t.prototype,"vAng",void 0),r.c([Object(i.c)()],t.prototype,"wAng",void 0),r.c([Object(i.c)()],t.prototype,"uRotationCenter",void 0),r.c([Object(i.c)()],t.prototype,"vRotationCenter",void 0),r.c([Object(i.c)()],t.prototype,"wRotationCenter",void 0),r.c([Object(i.c)()],t.prototype,"isBlocking",null),t}(l.a);i.a._TextureParser=d.Parse},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"d",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var r=function(){function e(e,t,n,r){void 0===t&&(t=!1),this.initalize(e,t,n,r)}return e.prototype.initalize=function(e,t,n,r){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=n,this.currentTarget=r,this},e}(),i=function(e,t,n){void 0===n&&(n=null),this.callback=e,this.mask=t,this.scope=n,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},o=function(){function e(){}return e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,n,r,i){void 0===r&&(r=-1),void 0===i&&(i=null);var o=new e;o._observers=new Array,o._observables=t;for(var a=0,s=t;a<s.length;a++){var l=s[a].add(n,r,!1,i);l&&o._observers.push(l)}return o},e}(),a=function(){function e(e){this._observers=new Array,this._eventState=new r(0),e&&(this._onObserverAdded=e)}return e.prototype.add=function(e,t,n,r,o){if(void 0===t&&(t=-1),void 0===n&&(n=!1),void 0===r&&(r=null),void 0===o&&(o=!1),!e)return null;var a=new i(e,t,r);return a.unregisterOnNextCall=o,n?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),a},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},e.prototype.removeCallback=function(e,t){for(var n=0;n<this._observers.length;n++)if(this._observers[n].callback===e&&(!t||t===this._observers[n].scope))return this._deferUnregister(this._observers[n]),!0;return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,n,r){if(void 0===t&&(t=-1),!this._observers.length)return!0;var i=this._eventState;i.mask=t,i.target=n,i.currentTarget=r,i.skipNextObservers=!1,i.lastReturnValue=e;for(var o=0,a=this._observers;o<a.length;o++){var s=a[o];if(!s._willBeUnregistered&&(s.mask&t&&(s.scope?i.lastReturnValue=s.callback.apply(s.scope,[e,i]):i.lastReturnValue=s.callback(e,i),s.unregisterOnNextCall&&this._deferUnregister(s)),i.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,n,r){var i=this;void 0===t&&(t=-1);var o=Promise.resolve(e);if(!this._observers.length)return o;var a=this._eventState;return a.mask=t,a.target=n,a.currentTarget=r,a.skipNextObservers=!1,this._observers.forEach(function(n){a.skipNextObservers||n._willBeUnregistered||n.mask&t&&(o=n.scope?o.then(function(t){return a.lastReturnValue=t,n.callback.apply(n.scope,[e,a])}):o.then(function(t){return a.lastReturnValue=t,n.callback(e,a)}),n.unregisterOnNextCall&&i._deferUnregister(n))}),o.then(function(){return e})},e.prototype.notifyObserver=function(e,t,n){void 0===n&&(n=-1);var r=this._eventState;r.mask=n,r.skipNextObservers=!1,e.callback(t,r)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,n=this._observers;t<n.length;t++){var r=n[t];if(r.mask&e||r.mask===e)return!0}return!1},e}()},function(e,t,n){"use strict";n.d(t,"c",function(){return g}),n.d(t,"b",function(){return _}),n.d(t,"d",function(){return v}),n.d(t,"e",function(){return y}),n.d(t,"g",function(){return b}),n.d(t,"h",function(){return E}),n.d(t,"f",function(){return x}),n.d(t,"i",function(){return T}),n.d(t,"a",function(){return S});var r=n(1),i=n(0),o=n(12),a=n(8),s=n(59),l=n(3),u=n(35),c=n(6),h=n(22),d=n(32),f=n(47),p=n(19),m=n(60),g=function(){function e(){}return e.prototype.getColorToRef=function(e){this.color2?i.f.LerpToRef(this.color1,this.color2,Math.random(),e):e.copyFrom(this.color1)},e}(),_=function(){},v=function(){function e(){}return e.prototype.getFactor=function(){return void 0===this.factor2?this.factor1:o.a.Lerp(this.factor1,this.factor2,Math.random())},e}(),y=function(e){function t(n,r){var i=e.call(this,n)||this;return i.request=r,i.name="LoadFileError",t._setPrototypeOf(i,t.prototype),i}return r.d(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t}(Error),b=function(){function e(){}return e.ExponentialBackoff=function(e,t){return void 0===e&&(e=3),void 0===t&&(t=500),function(n,r,i){return 0!==r.status||i>=e||-1!==n.indexOf("file:")?-1:Math.pow(2,i)*t}},e}(),E=function(){function e(){}return e.FetchToRef=function(e,t,n,r,i,o){var a=4*((Math.abs(e)*n%n|0)+(Math.abs(t)*r%r|0)*n);o.r=i[a]/255,o.g=i[a+1]/255,o.b=i[a+2]/255,o.a=i[a+3]/255},e.Mix=function(e,t,n){return e*(1-n)+t*n},e.Instantiate=function(t){if(e.RegisteredExternalClasses&&e.RegisteredExternalClasses[t])return e.RegisteredExternalClasses[t];var n=h.a.GetClass(t);if(n)return n;c.a.Warn(t+" not found, you may have missed an import.");for(var r=t.split("."),i=window||this,o=0,a=r.length;o<a;o++)i=i[r[o]];return"function"!=typeof i?null:i},e.Slice=function(e,t,n){return e.slice?e.slice(t,n):Array.prototype.slice.call(e,t,n)},e.SetImmediate=function(e){u.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},e.IsExponentOfTwo=function(e){var t=1;do{t*=2}while(t<e);return t===e},e.FloatRound=function(t){return Math.fround?Math.fround(t):e._tmpFloatArray[0]=t},e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var n=e.CeilingPOT(t),r=e.FloorPOT(t);return n-t>t-r?r:n},e.GetExponentOfTwo=function(t,n,r){var i;switch(void 0===r&&(r=l.a.SCALEMODE_NEAREST),r){case l.a.SCALEMODE_FLOOR:i=e.FloorPOT(t);break;case l.a.SCALEMODE_NEAREST:i=e.NearestPOT(t);break;case l.a.SCALEMODE_CEILING:default:i=e.CeilingPOT(t)}return Math.min(i,n)},e.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},e.GetFolderPath=function(e,t){void 0===t&&(t=!1);var n=e.lastIndexOf("/");return n<0?t?e:"":e.substring(0,n+1)},e.ToDegrees=function(e){return 180*e/Math.PI},e.ToRadians=function(e){return e*Math.PI/180},e.EncodeArrayBufferTobase64=function(e){for(var t,n,r,i,o,a,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0,h=new Uint8Array(e);c<h.length;)i=(t=h[c++])>>2,o=(3&t)<<4|(n=c<h.length?h[c++]:Number.NaN)>>4,a=(15&n)<<2|(r=c<h.length?h[c++]:Number.NaN)>>6,s=63&r,isNaN(n)?a=s=64:isNaN(r)&&(s=64),u+=l.charAt(i)+l.charAt(o)+l.charAt(a)+l.charAt(s);return"data:image/png;base64,"+u},e.ExtractMinAndMaxIndexed=function(e,t,n,r,o){void 0===o&&(o=null);for(var a=new i.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new i.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=n;l<n+r;l++){var u=3*t[l],c=e[u],h=e[u+1],d=e[u+2];a.minimizeInPlaceFromFloats(c,h,d),s.maximizeInPlaceFromFloats(c,h,d)}return o&&(a.x-=a.x*o.x+o.y,a.y-=a.y*o.x+o.y,a.z-=a.z*o.x+o.y,s.x+=s.x*o.x+o.y,s.y+=s.y*o.x+o.y,s.z+=s.z*o.x+o.y),{minimum:a,maximum:s}},e.ExtractMinAndMax=function(e,t,n,r,o){void 0===r&&(r=null);var a=new i.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new i.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);o||(o=3);for(var l=t,u=t*o;l<t+n;l++,u+=o){var c=e[u],h=e[u+1],d=e[u+2];a.minimizeInPlaceFromFloats(c,h,d),s.maximizeInPlaceFromFloats(c,h,d)}return r&&(a.x-=a.x*r.x+r.y,a.y-=a.y*r.x+r.y,a.z-=a.z*r.x+r.y,s.x+=s.x*r.x+r.y,s.y+=s.y*r.x+r.y,s.z+=s.z*r.x+r.y),{minimum:a,maximum:s}},e.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},e.GetPointerPrefix=function(){var e="pointer";return!u.a.IsWindowObjectExist()||window.PointerEvent||navigator.pointerEnabled||(e="mouse"),e},e.QueueNewFrame=function(e,t){return u.a.IsWindowObjectExist()?(t||(t=window),t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):setTimeout(e,16)},e.RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},e.ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},e.SetCorsBehavior=function(t,n){if((!t||0!==t.indexOf("data:"))&&e.CorsBehavior)if("string"==typeof e.CorsBehavior||e.CorsBehavior instanceof String)n.crossOrigin=e.CorsBehavior;else{var r=e.CorsBehavior(t);r&&(n.crossOrigin=r)}},e.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},e.LoadImage=function(t,n,r,i){var o,a=!1;t instanceof ArrayBuffer?(o=URL.createObjectURL(new Blob([t])),a=!0):t instanceof Blob?(o=URL.createObjectURL(t),a=!0):(o=e.CleanUrl(t),o=e.PreprocessUrl(t));var l=new Image;e.SetCorsBehavior(o,l);var u=function e(){l.removeEventListener("load",e),l.removeEventListener("error",h),n(l),a&&l.src&&URL.revokeObjectURL(l.src)},h=function e(n){l.removeEventListener("load",u),l.removeEventListener("error",e),c.a.Error("Error while trying to load image: "+t),r&&r("Error while trying to load image: "+t,n),a&&l.src&&URL.revokeObjectURL(l.src)};l.addEventListener("load",u),l.addEventListener("error",h);var d=function(){l.src=o};if("data:"!==o.substr(0,5)&&i&&i.enableTexturesOffline)i.open(function(){i&&i.loadImage(o,l)},d);else{if(-1!==o.indexOf("file:")){var f=decodeURIComponent(o.substring(5).toLowerCase());if(s.a.FilesToLoad[f]){try{var p;try{p=URL.createObjectURL(s.a.FilesToLoad[f])}catch(e){p=URL.createObjectURL(s.a.FilesToLoad[f])}l.src=p,a=!0}catch(e){l.src=""}return l}}d()}return l},e.LoadFile=function(t,n,r,i,o,l){if(t=e.CleanUrl(t),-1!==(t=e.PreprocessUrl(t)).indexOf("file:")){var c=decodeURIComponent(t.substring(5).toLowerCase());if(s.a.FilesToLoad[c])return e.ReadFile(s.a.FilesToLoad[c],n,r,o)}var h=e.BaseUrl+t,d=!1,f={onCompleteObservable:new a.c,abort:function(){return d=!0}},p=function(){var t=new m.a,i=null;f.abort=function(){d=!0,t.readyState!==(XMLHttpRequest.DONE||4)&&t.abort(),null!==i&&(clearTimeout(i),i=null)},function a(s){t.open("GET",h),o&&(t.responseType="arraybuffer"),r&&t.addEventListener("progress",r);var c=function e(){t.removeEventListener("loadend",e),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear()};t.addEventListener("loadend",c),t.addEventListener("readystatechange",function r(){if(!d&&t.readyState===(XMLHttpRequest.DONE||4)){if(t.removeEventListener("readystatechange",r),t.status>=200&&t.status<300||0===t.status&&(!u.a.IsWindowObjectExist()||e.IsFileURL()))return void n(o?t.response:t.responseText,t.responseURL);var f=e.DefaultRetryStrategy;if(f){var p=f(h,t,s);if(-1!==p)return t.removeEventListener("loadend",c),t=new m.a,void(i=setTimeout(function(){return a(s+1)},p))}var g=new y("Error status: "+t.status+" "+t.statusText+" - Unable to load "+h,t);if(!l)throw g;l(t,g)}}),t.send()}(0)};if(i&&i.enableSceneOffline){var g=function(e){e&&e.status>400?l&&l(e):d||p()};i.open(function(){d||i&&i.loadFile(t,function(e){d||n(e),f.onCompleteObservable.notifyObservers(f)},r?function(e){d||r(e)}:void 0,g,o)},g)}else p();return f},e.LoadScript=function(e,t,n,r){if(u.a.IsWindowObjectExist()){var i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),r&&(o.id=r),o.onload=function(){t&&t()},o.onerror=function(t){n&&n("Unable to load script '"+e+"'",t)},i.appendChild(o)}},e.LoadScriptAsync=function(e,t){return new Promise(function(n,r){if(u.a.IsWindowObjectExist()){var i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),t&&(o.id=t),o.onload=function(){n(!0)},o.onerror=function(e){n(!1)},i.appendChild(o)}else n(!1)})},e.ReadFileAsDataURL=function(e,t,n){var r=new FileReader,i={onCompleteObservable:new a.c,abort:function(){return r.abort()}};return r.onloadend=function(e){i.onCompleteObservable.notifyObservers(i)},r.onload=function(e){t(e.target.result)},r.onprogress=n,r.readAsDataURL(e),i},e.ReadFile=function(e,t,n,r){var i=new FileReader,o={onCompleteObservable:new a.c,abort:function(){return i.abort()}};return i.onloadend=function(e){return o.onCompleteObservable.notifyObservers(o)},i.onerror=function(n){c.a.Log("Error while reading file: "+e.name),t(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},i.onload=function(e){t(e.target.result)},n&&(i.onprogress=n),r?i.readAsArrayBuffer(e):i.readAsText(e),o},e.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},e.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},e.CheckExtends=function(e,t,n){t.minimizeInPlace(e),n.maximizeInPlace(e)},e.DeepCopy=function(e,t,n,r){d.a.DeepCopy(e,t,n,r)},e.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var n=e[t];window.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch(e){}}},e.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var n=e[t];window.removeEventListener(n.name,n.handler);try{window.parent&&window.parent.removeEventListener(n.name,n.handler)}catch(e){}}},e.DumpFramebuffer=function(t,n,r,i,o,a){void 0===o&&(o="image/png");for(var s=4*t,l=n/2,u=r.readPixels(0,0,t,n),c=0;c<l;c++)for(var h=0;h<s;h++){var d=h+c*s,f=h+(n-c-1)*s,p=u[d];u[d]=u[f],u[f]=p}e._ScreenshotCanvas||(e._ScreenshotCanvas=document.createElement("canvas")),e._ScreenshotCanvas.width=t,e._ScreenshotCanvas.height=n;var m=e._ScreenshotCanvas.getContext("2d");if(m){var g=m.createImageData(t,n);g.data.set(u),m.putImageData(g,0,0),e.EncodeScreenshotCanvasData(i,o,a)}},e.ToBlob=function(e,t,n){void 0===n&&(n="image/png"),e.toBlob||(e.toBlob=function(e,t,n){var r=this;setTimeout(function(){for(var i=atob(r.toDataURL(t,n).split(",")[1]),o=i.length,a=new Uint8Array(o),s=0;s<o;s++)a[s]=i.charCodeAt(s);e(new Blob([a]))})}),e.toBlob(function(e){t(e)},n)},e.EncodeScreenshotCanvasData=function(t,n,r){void 0===n&&(n="image/png"),t?t(e._ScreenshotCanvas.toDataURL(n)):this.ToBlob(e._ScreenshotCanvas,function(t){if("download"in document.createElement("a")){if(!r){var n=new Date,i=(n.getFullYear()+"-"+(n.getMonth()+1)).slice(2)+"-"+n.getDate()+"_"+n.getHours()+"-"+("0"+n.getMinutes()).slice(-2);r="screenshot_"+i+".png"}e.Download(t,r)}else{var o=URL.createObjectURL(t),a=window.open("");if(!a)return;var s=a.document.createElement("img");s.onload=function(){URL.revokeObjectURL(o)},s.src=o,a.document.body.appendChild(s)}},n)},e.Download=function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var n=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=n,r.download=t,r.addEventListener("click",function(){r.parentElement&&r.parentElement.removeChild(r)}),r.click(),window.URL.revokeObjectURL(n)}},e.CreateScreenshot=function(e,t,n,r,i){throw void 0===i&&(i="image/png"),p.a.WarnImport("ScreenshotTools")},e.CreateScreenshotUsingRenderTarget=function(e,t,n,r,i,o,a,s){throw void 0===i&&(i="image/png"),void 0===o&&(o=1),void 0===a&&(a=!1),p.a.WarnImport("ScreenshotTools")},e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},e.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},e.DecodeBase64=function(e){for(var t=atob(e.split(",")[1]),n=t.length,r=new Uint8Array(new ArrayBuffer(n)),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r.buffer},e.GetAbsoluteUrl=function(e){var t=document.createElement("a");return t.href=e,t.href},Object.defineProperty(e,"errorsCount",{get:function(){return c.a.errorsCount},enumerable:!0,configurable:!0}),e.Log=function(e){c.a.Log(e)},e.Warn=function(e){c.a.Warn(e)},e.Error=function(e){c.a.Error(e)},Object.defineProperty(e,"LogCache",{get:function(){return c.a.LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){c.a.ClearLogCache()},Object.defineProperty(e,"LogLevels",{set:function(e){c.a.LogLevels=e},enumerable:!0,configurable:!0}),e.IsFileURL=function(){return"file:"===location.protocol},Object.defineProperty(e,"PerformanceLogLevel",{set:function(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),e._StartPerformanceCounterDisabled=function(e,t){},e._EndPerformanceCounterDisabled=function(e,t){},e._StartUserMark=function(t,n){if(void 0===n&&(n=!0),!e._performance){if(!u.a.IsWindowObjectExist())return;e._performance=window.performance}n&&e._performance.mark&&e._performance.mark(t+"-Begin")},e._EndUserMark=function(t,n){void 0===n&&(n=!0),n&&e._performance.mark&&(e._performance.mark(t+"-End"),e._performance.measure(t,t+"-Begin",t+"-End"))},e._StartPerformanceConsole=function(t,n){void 0===n&&(n=!0),n&&(e._StartUserMark(t,n),console.time&&console.time(t))},e._EndPerformanceConsole=function(t,n){void 0===n&&(n=!0),n&&(e._EndUserMark(t,n),console.time&&console.timeEnd(t))},Object.defineProperty(e,"Now",{get:function(){return f.a.Now},enumerable:!0,configurable:!0}),e.GetClassName=function(e,t){void 0===t&&(t=!1);var n=null;return!t&&e.getClassName?n=e.getClassName():(e instanceof Object&&(n=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),n||(n=typeof e)),n},e.First=function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(t(i))return i}return null},e.getFullClassName=function(e,t){void 0===t&&(t=!1);var n=null,r=null;if(!t&&e.getClassName)n=e.getClassName();else{if(e instanceof Object){var i=t?e:Object.getPrototypeOf(e);n=i.constructor.__bjsclassName__,r=i.constructor.__bjsmoduleName__}n||(n=typeof e)}return n?(null!=r?r+".":"")+n:null},e.DelayAsync=function(e){return new Promise(function(t){setTimeout(function(){t()},e)})},e.GetCurrentGradient=function(e,t,n){for(var r=0;r<t.length-1;r++){var i=t[r],o=t[r+1];if(e>=i.gradient&&e<=o.gradient)return void n(i,o,(e-i.gradient)/(o.gradient-i.gradient))}var a=t.length-1;n(t[a],t[a],1)},e.BaseUrl="",e.UseCustomRequestHeaders=!1,e.CustomRequestHeaders=m.a.CustomRequestHeaders,e.DefaultRetryStrategy=b.ExponentialBackoff(),e.CorsBehavior="anonymous",e.UseFallbackTexture=!0,e.RegisteredExternalClasses={},e.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",e._tmpFloatArray=new Float32Array(1),e.GetDOMTextContent=u.a.GetDOMTextContent,e.PreprocessUrl=function(e){return e},e.NoneLogLevel=c.a.NoneLogLevel,e.MessageLogLevel=c.a.MessageLogLevel,e.WarningLogLevel=c.a.WarningLogLevel,e.ErrorLogLevel=c.a.ErrorLogLevel,e.AllLogLevel=c.a.AllLogLevel,e.IsWindowObjectExist=u.a.IsWindowObjectExist,e.PerformanceNoneLogLevel=0,e.PerformanceUserMarkLogLevel=1,e.PerformanceConsoleLogLevel=2,e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,e.EndPerformanceCounter=e._EndPerformanceCounterDisabled,e}(),x=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,n){e.Enabled&&(this._current+=t,n&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=f.a.Now)},e.prototype.endMonitoring=function(t){if(void 0===t&&(t=!0),e.Enabled){t&&this.fetchNewFrame();var n=f.a.Now;this._current=n-this._startMonitoringTime,t&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=f.a.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}();function T(e,t){return function(n){n.__bjsclassName__=e,n.__bjsmoduleName__=null!=t?t:null}}var S=function(){function e(e,t,n,r){void 0===r&&(r=0),this.iterations=e,this.index=r-1,this._done=!1,this._fn=t,this._successCallback=n}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,n,r,i){void 0===i&&(i=0);var o=new e(t,n,r,i);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,n,r,i,o,a){return void 0===a&&(a=0),e.Run(Math.ceil(t/n),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var i=0;i<n;++i){var a=e.index*n+i;if(a>=t)break;if(r(a),o&&o()){e.breakLoop();break}}e.executeNext()},a)},i)},e}()},function(e,t,n){"use strict";n.d(t,"d",function(){return S}),n.d(t,"a",function(){return A}),n.d(t,"c",function(){return P}),n.d(t,"b",function(){return M});var r=n(1),i=n(8),o=n(105),a=n(61),s=n(106),l=n(9),u=n(0),c=n(12),h=n(5),d=n(20),f=n(26),p=n(94),m=n(3),g=n(35),_=n(6),v=n(23),y=n(92),b=n(19),E=n(107),x=n(73),T=function(){},S=function(){},A=function(){},P=function(){},M=function(){function e(t,n,r,a){var c=this;void 0===a&&(a=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.scenes=new Array,this.onNewSceneAddedObservable=new i.c,this.postProcesses=new Array,this.validateShaderPrograms=!1,this.onResizeObservable=new i.c,this.onCanvasBlurObservable=new i.c,this.onCanvasFocusObservable=new i.c,this.onCanvasPointerOutObservable=new i.c,this.onBeforeTextureInitObservable=new i.c,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new i.c,this.customAnimationFrameRequester=null,this.onEndFrameObservable=new i.c,this.onBeforeShaderCompilationObservable=new i.c,this.onAfterShaderCompilationObservable=new i.c,this._windowIsBackground=!1,this._webGLVersion=1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._colorWrite=!0,this._drawCalls=new l.f,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new i.c,this.onContextRestoredObservable=new i.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new o.a,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._depthCullingState=new p.b,this._stencilState=new p.c,this._alphaState=new p.a,this._alphaMode=e.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this._viewportCached=new u.y(0,0,0,0),this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},s.a.Apply();var h=null;if(e.Instances.push(this),t){if(r=r||{},t.getContext){if(h=t,this._renderingCanvas=h,null!=n&&(r.antialias=n),void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),void 0===r.preserveDrawingBuffer&&(r.preserveDrawingBuffer=!1),void 0===r.audioEngine&&(r.audioEngine=!0),void 0===r.stencil&&(r.stencil=!0),!1===r.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._deterministicLockstep=r.deterministicLockstep,this._lockstepMaxSteps=r.lockstepMaxSteps,this._doNotHandleContextLost=!!r.doNotHandleContextLost,navigator&&navigator.userAgent)for(var d=navigator.userAgent,f=0,m=e.ExceptionList;f<m.length;f++){var v=m[f],y=v.key,b=v.targets;if(new RegExp(y).test(d)){if(v.capture&&v.captureConstraint){var E=v.capture,x=v.captureConstraint,S=new RegExp(E).exec(d);if(S&&S.length>0&&parseInt(S[S.length-1])>=x)continue}for(var A=0,P=b;A<P.length;A++)switch(P[A]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}if(!r.disableWebGL2Support)try{this._gl=h.getContext("webgl2",r)||h.getContext("experimental-webgl2",r),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!h)throw new Error("The provided canvas is null or undefined.");try{this._gl=h.getContext("webgl",r)||h.getContext("experimental-webgl",r)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._onCanvasFocus=function(){c.onCanvasFocusObservable.notifyObservers(c)},this._onCanvasBlur=function(){c.onCanvasBlurObservable.notifyObservers(c)},h.addEventListener("focus",this._onCanvasFocus),h.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){c.disablePerformanceMonitorInBackground&&c._performanceMonitor.disable(),c._windowIsBackground=!0},this._onFocus=function(){c.disablePerformanceMonitorInBackground&&c._performanceMonitor.enable(),c._windowIsBackground=!1},this._onCanvasPointerOut=function(e){c.onCanvasPointerOutObservable.notifyObservers(e)},g.a.IsWindowObjectExist()&&(window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus)),h.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),c._contextWasLost=!0,_.a.Warn("WebGL context lost."),c.onContextLostObservable.notifyObservers(c)},this._onContextRestored=function(){setTimeout(function(){c._initGLContext(),c._rebuildEffects(),c._rebuildInternalTextures(),c._rebuildBuffers(),c.wipeCaches(!0),_.a.Warn("WebGL context successfully restored."),c.onContextRestoredObservable.notifyObservers(c),c._contextWasLost=!1},0)},h.addEventListener("webglcontextlost",this._onContextLost,!1),h.addEventListener("webglcontextrestored",this._onContextRestored,!1)),r.doNotHandleTouchAction||this._disableTouchAction()}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var M=this._gl.getContextAttributes();M&&(r.stencil=M.stencil)}void 0!==r.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=r.useHighPrecisionFloats);var R=g.a.IsWindowObjectExist()&&window.devicePixelRatio||1,C=r.limitDeviceRatio||R;if(this._hardwareScalingLevel=a?1/Math.min(C,R):1,this.resize(),this._isStencilEnable=!!r.stencil,this._initGLContext(),h){var w=document;this._onFullscreenChange=function(){void 0!==w.fullscreen?c.isFullscreen=w.fullscreen:void 0!==w.mozFullScreen?c.isFullscreen=w.mozFullScreen:void 0!==w.webkitIsFullScreen?c.isFullscreen=w.webkitIsFullScreen:void 0!==w.msIsFullScreen&&(c.isFullscreen=w.msIsFullScreen),c.isFullscreen&&c._pointerLockRequested&&h&&(h.requestPointerLock=h.requestPointerLock||h.msRequestPointerLock||h.mozRequestPointerLock||h.webkitRequestPointerLock,h.requestPointerLock&&h.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){c.isPointerLock=w.mozPointerLockElement===h||w.webkitPointerLockElement===h||w.msPointerLockElement===h||w.pointerLockElement===h},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._connectVREvents(h,w)}!e.audioEngine&&r.audioEngine&&e.AudioEngineFactory&&(e.audioEngine=e.AudioEngineFactory(this.getRenderingCanvas()));for(var O=0;O<this._caps.maxVertexAttribs;O++)this._currentBufferPointers[O]=new T;this._prepareVRComponent(),r.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),console.log("Babylon.js v"+e.Version+" - "+this.description),this.enableOfflineSupport=void 0!==e.OfflineProviderFactory}}return Object.defineProperty(e,"Instances",{get:function(){return v.a.Instances},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedEngine",{get:function(){return v.a.LastCreatedEngine},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return v.a.LastCreatedScene},enumerable:!0,configurable:!0}),e.MarkAllMaterialsAsDirty=function(t,n){for(var r=0;r<e.Instances.length;r++)for(var i=e.Instances[r],o=0;o<i.scenes.length;o++)i.scenes[o].markAllMaterialsAsDirty(t,n)},Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@4.0.3"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"4.0.3"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return h.a.ShadersRepository},set:function(e){h.a.ShadersRepository=e},enumerable:!0,configurable:!0}),e.DefaultLoadingScreenFactory=function(e){throw b.a.WarnImport("LoadingScreen")},Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,e.TEXTUREFORMAT_RGBA,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,e.TEXTUREFORMAT_RGBA,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var t=new Uint8Array(4),n=[t,t,t,t,t,t];this._emptyCubeTexture=this.createRawCubeTexture(n,1,e.TEXTUREFORMAT_RGBA,e.TEXTURETYPE_UNSIGNED_INT,!1,!1,e.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),e.prototype.initWebVR=function(){throw b.a.WarnImport("WebVRCamera")},e.prototype._prepareVRComponent=function(){},e.prototype._connectVREvents=function(e,t){},e.prototype._submitVRFrame=function(){},e.prototype.disableVR=function(){},e.prototype.isVRPresenting=function(){return!1},e.prototype._requestVRFrame=function(){},e.prototype._disableTouchAction=function(){this._renderingCanvas&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)this._compiledEffects[e]._prepareEffect();h.a.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var n=t[e];n.resetCachedMaterial(),n._rebuildGeometries(),n._rebuildTextures()}for(var r=0,i=this._uniformBuffers;r<i.length;r++)i[r]._rebuild()},e.prototype._initGLContext=function(){this._caps=new P,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxCombinedTexturesImageUnits=this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!1,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloat=!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),this._caps.multiview=this._gl.getExtension("OVR_multiview2"),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var n=0;n<16;n++)this._gl["COLOR_ATTACHMENT"+n+"_WEBGL"]=t["COLOR_ATTACHMENT"+n+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._caps.parallelShaderCompile=this._gl.getExtension("KHR_parallel_shader_compile"),this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var r=this._gl.getExtension("WEBGL_depth_texture");null!=r&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=r.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var i=this._gl.getExtension("OES_vertex_array_object");null!=i?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=i.createVertexArrayOES.bind(i),this._gl.bindVertexArray=i.bindVertexArrayOES.bind(i),this._gl.deleteVertexArray=i.deleteVertexArrayOES.bind(i)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var o=this._gl.getExtension("ANGLE_instanced_arrays");null!=o?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=o.drawArraysInstancedANGLE.bind(o),this._gl.drawElementsInstanced=o.drawElementsInstancedANGLE.bind(o),this._gl.vertexAttribDivisor=o.vertexAttribDivisorANGLE.bind(o)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var a=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),s=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);a&&s&&(this._caps.highPrecisionShaderSupported=0!==a.precision&&0!==s.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var l=0;l<this._maxSimultaneousTextures;l++)this._nextFreeTextureSlots.push(l)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},e.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var n=e.viewport;return this.getRenderWidth(t)*n.width/(this.getRenderHeight(t)*n.height)},e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},e.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},e.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},e.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},e.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},e.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},e.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},e.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},e.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},e.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},e.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},e.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},e.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},e.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},e.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},e.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=l.h.QueueNewFrame(this.customAnimationFrameRequester.renderFunction||this._bindedRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=l.h.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=l.h.QueueNewFrame(this._bindedRenderFunction)))},e.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},e.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&l.h.RequestFullscreen(this._renderingCanvas))},e.prototype.exitFullscreen=function(){this.isFullscreen&&l.h.ExitFullscreen()},e.prototype.clear=function(e,t,n,r){void 0===r&&(r=!1),this.applyStates();var i=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),i|=this._gl.COLOR_BUFFER_BIT),n&&(this._gl.clearDepth(1),i|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),i|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(i)},e.prototype.scissorClear=function(e,t,n,r,i){this.enableScissor(e,t,n,r),this.clear(i,!0,!0,!0),this.disableScissor()},e.prototype.enableScissor=function(e,t,n,r){var i=this._gl;i.enable(i.SCISSOR_TEST),i.scissor(e,t,n,r)},e.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},e.prototype._viewport=function(e,t,n,r){e===this._viewportCached.x&&t===this._viewportCached.y&&n===this._viewportCached.z&&r===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=n,this._viewportCached.w=r,this._gl.viewport(e,t,n,r))},e.prototype.setViewport=function(e,t,n){var r=t||this.getRenderWidth(),i=n||this.getRenderHeight(),o=e.x||0,a=e.y||0;this._cachedViewport=e,this._viewport(o*r,a*i,r*e.width,i*e.height)},e.prototype.setDirectViewport=function(e,t,n,r){var i=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,n,r),i},e.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},e.prototype.resize=function(){if(!this.isVRPresenting()){var e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)}},e.prototype.setSize=function(e,t){if(this._renderingCanvas&&(this._renderingCanvas.width!==e||this._renderingCanvas.height!==t)){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var n=0;n<this.scenes.length;n++)for(var r=this.scenes[n],i=0;i<r.cameras.length;i++)r.cameras[i]._currentRenderId=0;this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},e.prototype.bindFramebuffer=function(e,t,n,r,i,o,a){void 0===a&&(a=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var s=this._gl;e.isCube&&(void 0===t&&(t=0),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,a),o&&(o._generateStencilBuffer?s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,o._webGLTexture,a):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,o._webGLTexture,a))),this._cachedViewport&&!i?this.setViewport(this._cachedViewport,n,r):(n||(n=e.width,a&&(n/=Math.pow(2,a))),r||(r=e.height,a&&(r/=Math.pow(2,a))),this._viewport(0,0,n,r)),this.wipeCaches()},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype.unBindFramebuffer=function(e,t,n){void 0===t&&(t=!1),this._currentRenderTarget=null;var r=this._gl;e._MSAAFramebuffer&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,e._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e._framebuffer),r.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(r.TEXTURE_2D,e,!0),r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null)),n&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),n()),this._bindUnboundFramebuffer(null)},e.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,e,!0),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var n=new x.a(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},e.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var n=new x.a(t);return this.bindUniformBuffer(n),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),n.references=1,n},e.prototype.updateUniformBuffer=function(e,t,n,r){this.bindUniformBuffer(e),void 0===n&&(n=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,n,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(n,n+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(n,n+r)),this.bindUniformBuffer(null)},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create vertex buffer");var n=new x.a(t);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),n.references=1,n},e.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic vertex buffer");var n=new x.a(t);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),n.references=1,n},e.prototype.updateDynamicIndexBuffer=function(e,t,n){var r;void 0===n&&(n=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),r=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},e.prototype.updateDynamicVertexBuffer=function(e,t,n,r){this.bindArrayBuffer(e),void 0===n&&(n=0),void 0===r?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(n,n+r)):(t=t instanceof ArrayBuffer?new Uint8Array(t,n,r):new Uint8Array(t.buffer,t.byteOffset+n,r),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var n,r=this._gl.createBuffer(),i=new x.a(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var o=!1;if(e instanceof Uint16Array)n=e;else if(this._caps.uintIndices)if(e instanceof Uint32Array)n=e,o=!0;else{for(var a=0;a<e.length;a++)if(e[a]>65535){o=!0;break}n=o?new Uint32Array(e):new Uint16Array(e)}else n=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=o,i},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},e.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},e.prototype.bindUniformBlock=function(e,t,n){var r=e.program,i=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,i,n)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,n,r,i,o,a){var s=this._currentBufferPointers[t],l=!1;s.active?(s.buffer!==e&&(s.buffer=e,l=!0),s.size!==n&&(s.size=n,l=!0),s.type!==r&&(s.type=r,l=!0),s.normalized!==i&&(s.normalized=i,l=!0),s.stride!==o&&(s.stride=o,l=!0),s.offset!==a&&(s.offset=a,l=!0)):(l=!0,s.active=!0,s.index=t,s.size=n,s.type=r,s.normalized=i,s.stride=o,s.offset=a,s.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,n,r,i,o,a))},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t){var n=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var r=0;r<n.length;r++){var i=t.getAttributeLocation(r);if(i>=0){var o=e[n[r]];if(!o)continue;this._gl.enableVertexAttribArray(i),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[i]=!0);var a=o.getBuffer();a&&(this._vertexAttribPointer(a,i,o.getSize(),o.type,o.normalized,o.byteStride,o.byteOffset),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(i,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(i),this._currentInstanceBuffers.push(a))))}}},e.prototype.recordVertexArrayObject=function(e,t,n){var r=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(r),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,n),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),r},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,n,r,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;var o=i.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var a=0,s=0;s<o;s++)if(s<n.length){var l=i.getAttributeLocation(s);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[l]=!0,this._vertexAttribPointer(e,l,n[s],this._gl.FLOAT,!1,r,a)),a+=4*n[s]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,n){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===n||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n,this._bindVertexBuffersAttributes(e,n)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,n=this._currentInstanceLocations.length;t<n;t++){var r=this._currentInstanceBuffers[t];e!=r&&r.references&&(e=r,this.bindArrayBuffer(r));var i=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(i,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._gl.deleteBuffer(e.underlyingResource),!0)},e.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var n=new x.a(t);return n.capacity=e,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),n},e.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},e.prototype.updateAndBindInstancesBuffer=function(e,t,n){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==n[0].index){for(var r=0,i=0;i<n.length;i++)r+=4*(o=n[i]).attributeSize;for(i=0;i<n.length;i++){var o=n[i];this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this._vertexAttribPointer(e,o.index,o.attributeSize,o.attribyteType||this._gl.FLOAT,o.normalized||!1,r,o.offset),this._gl.vertexAttribDivisor(o.index,1),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e)}}else for(var a=0;a<4;a++){var s=n[a];this._vertexAttribArraysEnabled[s]||(this._gl.enableVertexAttribArray(s),this._vertexAttribArraysEnabled[s]=!0),this._vertexAttribPointer(e,s,4,this._gl.FLOAT,!1,64,16*a),this._gl.vertexAttribDivisor(s,1),this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(e)}},e.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},e.prototype.draw=function(e,t,n,r){this.drawElementsType(e?d.a.TriangleFillMode:d.a.WireFrameFillMode,t,n,r)},e.prototype.drawPointClouds=function(e,t,n){this.drawArraysType(d.a.PointFillMode,e,t,n)},e.prototype.drawUnIndexed=function(e,t,n,r){this.drawArraysType(e?d.a.TriangleFillMode:d.a.WireFrameFillMode,t,n,r)},e.prototype.drawElementsType=function(e,t,n,r){this.applyStates(),this._drawCalls.addCount(1,!1);var i=this._drawMode(e),o=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,a=this._uintIndicesCurrentlySet?4:2;r?this._gl.drawElementsInstanced(i,n,o,t*a,r):this._gl.drawElements(i,n,o,t*a)},e.prototype.drawArraysType=function(e,t,n,r){this.applyStates(),this._drawCalls.addCount(1,!1);var i=this._drawMode(e);r?this._gl.drawArraysInstanced(i,t,n,r):this._gl.drawArrays(i,t,n)},e.prototype._drawMode=function(e){switch(e){case d.a.TriangleFillMode:return this._gl.TRIANGLES;case d.a.PointFillMode:return this._gl.POINTS;case d.a.WireFrameFillMode:return this._gl.LINES;case d.a.PointListDrawMode:return this._gl.POINTS;case d.a.LineListDrawMode:return this._gl.LINES;case d.a.LineLoopDrawMode:return this._gl.LINE_LOOP;case d.a.LineStripDrawMode:return this._gl.LINE_STRIP;case d.a.TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case d.a.TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),this._gl.deleteProgram(t.program))},e.prototype.createEffect=function(e,t,n,r,i,o,a,s,l){var u=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(i||t.defines);if(this._compiledEffects[u]){var c=this._compiledEffects[u];return a&&c.isReady()&&a(c),c}var d=new h.a(e,t,n,r,this,i,o,a,s,l);return d._key=u,this._compiledEffects[u]=d,d},e.prototype._compileShader=function(e,t,n,r){return this._compileRawShader(r+(n?n+"\n":"")+e,t)},e.prototype._compileRawShader=function(e,t){var n=this._gl,r=n.createShader("vertex"===t?n.VERTEX_SHADER:n.FRAGMENT_SHADER);if(!r)throw new Error("Something went wrong while compile the shader.");return n.shaderSource(r,e),n.compileShader(r),r},e.prototype.createRawShaderProgram=function(e,t,n,r,i){void 0===i&&(i=null),r=r||this._gl;var o=this._compileRawShader(t,"vertex"),a=this._compileRawShader(n,"fragment");return this._createShaderProgram(e,o,a,r,i)},e.prototype.createShaderProgram=function(e,t,n,r,i,o){void 0===o&&(o=null),i=i||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",s=this._compileShader(t,"vertex",r,a),l=this._compileShader(n,"fragment",r,a),u=this._createShaderProgram(e,s,l,i,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),u},e.prototype.createPipelineContext=function(){var e=new E.a;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},e.prototype._createShaderProgram=function(e,t,n,r,i){void 0===i&&(i=null);var o=r.createProgram();if(e.program=o,!o)throw new Error("Unable to create program");if(r.attachShader(o,t),r.attachShader(o,n),this.webGLVersion>1&&i){var a=this.createTransformFeedback();this.bindTransformFeedback(a),this.setTranformFeedbackVaryings(o,i),e.transformFeedback=a}return r.linkProgram(o),this.webGLVersion>1&&i&&this.bindTransformFeedback(null),e.context=r,e.vertexShader=t,e.fragmentShader=n,e.isParallelCompiled||this._finalizePipelineContext(e),o},e.prototype._finalizePipelineContext=function(e){var t=e.context,n=e.vertexShader,r=e.fragmentShader,i=e.program;if(!t.getProgramParameter(i,t.LINK_STATUS)){var o,a;if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(n)))throw new Error(o);if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)&&(o=this._gl.getShaderInfoLog(r)))throw new Error(o);if(a=t.getProgramInfoLog(i))throw new Error(a)}if(this.validateShaderPrograms&&(t.validateProgram(i),!t.getProgramParameter(i,t.VALIDATE_STATUS)&&(a=t.getProgramInfoLog(i))))throw new Error(a);t.deleteShader(n),t.deleteShader(r),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,n,r,i,o,a){var s=e;s.program=r?this.createRawShaderProgram(s,t,n,void 0,a):this.createShaderProgram(s,t,n,o,void 0,a),s.program.__SPECTOR_rebuildProgram=i},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var n=e;n.isParallelCompiled?n.onCompiled=t:t()},e.prototype.getUniforms=function(e,t){for(var n=new Array,r=e,i=0;i<t.length;i++)n.push(this._gl.getUniformLocation(r.program,t[i]));return n},e.prototype.getAttributes=function(e,t){for(var n=[],r=e,i=0;i<t.length;i++)try{n.push(this._gl.getAttribLocation(r.program,t[i]))}catch(e){n.push(-1)}return n},e.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},e.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},e.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},e.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},e.prototype.setFloatArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setFloatArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setFloatArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setFloatArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},e.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},e.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},e.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},e.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},e.prototype.setFloat2=function(e,t,n){e&&this._gl.uniform2f(e,t,n)},e.prototype.setFloat3=function(e,t,n,r){e&&this._gl.uniform3f(e,t,n,r)},e.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setFloat4=function(e,t,n,r,i){e&&this._gl.uniform4f(e,t,n,r,i)},e.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},e.prototype.setColor4=function(e,t,n){e&&this._gl.uniform4f(e,t.r,t.g,t.b,n)},e.prototype.setDirectColor4=function(e,t){e&&this._gl.uniform4f(e,t.r,t.g,t.b,t.a)},e.prototype.setState=function(e,t,n,r){void 0===t&&(t=0),void 0===r&&(r=!1),(this._depthCullingState.cull!==e||n)&&(this._depthCullingState.cull=e);var i=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==i||n)&&(this._depthCullingState.cullFace=i),this.setZOffset(t);var o=r?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==o||n)&&(this._depthCullingState.frontFace=o)},e.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},e.prototype.getZOffset=function(){return this._depthCullingState.zOffset},e.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},e.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},e.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e),this._colorWrite=e},e.prototype.getColorWrite=function(){return this._colorWrite},e.prototype.setAlphaConstants=function(e,t,n,r){this._alphaState.setAlphaBlendConstants(e,t,n,r)},e.prototype.setAlphaMode=function(t,n){if(void 0===n&&(n=!1),this._alphaMode!==t){switch(t){case e.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case e.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case e.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case e.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case e.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}n||this.setDepthWrite(t===e.ALPHA_DISABLE),this._alphaMode=t}},e.prototype.getAlphaMode=function(){return this._alphaMode},e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,e&&(this.resetTextureCache(),this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._unpackFlipYCached=null),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null))},e.prototype.setTextureFormatToUse=function(e){for(var t=0,n=this.texturesSupported.length;t<n;t++)for(var r=0,i=e.length;r<i;r++)if(this._texturesSupported[t]===e[r].toLowerCase())return this._textureFormatInUse=this._texturesSupported[t];return this._textureFormatInUse=null,null},e.prototype._getSamplingParameters=function(t,n){var r=this._gl,i=r.NEAREST,o=r.NEAREST;switch(t){case e.TEXTURE_BILINEAR_SAMPLINGMODE:i=r.LINEAR,o=n?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case e.TEXTURE_TRILINEAR_SAMPLINGMODE:i=r.LINEAR,o=n?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case e.TEXTURE_NEAREST_SAMPLINGMODE:i=r.NEAREST,o=n?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case e.TEXTURE_NEAREST_NEAREST_MIPNEAREST:i=r.NEAREST,o=n?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case e.TEXTURE_NEAREST_LINEAR_MIPNEAREST:i=r.NEAREST,o=n?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case e.TEXTURE_NEAREST_LINEAR_MIPLINEAR:i=r.NEAREST,o=n?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case e.TEXTURE_NEAREST_LINEAR:i=r.NEAREST,o=r.LINEAR;break;case e.TEXTURE_NEAREST_NEAREST:i=r.NEAREST,o=r.NEAREST;break;case e.TEXTURE_LINEAR_NEAREST_MIPNEAREST:i=r.LINEAR,o=n?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case e.TEXTURE_LINEAR_NEAREST_MIPLINEAR:i=r.LINEAR,o=n?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case e.TEXTURE_LINEAR_LINEAR:i=r.LINEAR,o=r.LINEAR;break;case e.TEXTURE_LINEAR_NEAREST:i=r.LINEAR,o=r.NEAREST}return{min:o,mag:i}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype.createTexture=function(t,n,r,i,o,a,s,u,c,h,d,p){var m=this;void 0===o&&(o=e.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===s&&(s=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===p&&(p=[]);for(var g=String(t),_="data:"===g.substr(0,5),v="blob:"===g.substr(0,5),y=_&&-1!==g.indexOf(";base64,"),b=c||new f.a(this,f.a.DATASOURCE_URL),E=g.lastIndexOf("."),x=d||(E>-1?g.substring(E).toLowerCase():""),T=null,S=0,A=e._TextureLoaders;S<A.length;S++){var P=A[S];if(-1===p.indexOf(P)&&P.canLoad(x,this._textureFormatInUse,c,y,!!u)){T=P;break}}T&&(g=T.transformUrl(g,this._textureFormatInUse)),i&&i._addPendingData(b),b.url=g,b.generateMipMaps=!n,b.samplingMode=o,b.invertY=r,this._doNotHandleContextLost||(b._buffer=u);var M=null;a&&!c&&(M=b.onLoadedObservable.add(a)),c||this._internalTexturesCache.push(b);var R=function(e,r){i&&i._removePendingData(b);var a=!1;T&&T.getFallbackTextureUrl(g,m._textureFormatInUse)&&(a=!0,p.push(T),l.h.Warn(T.constructor.name+" failed when trying to load "+b.url+", falling back to the next supported loader"),m.createTexture(t,n,b.invertY,i,o,null,null,u,b,void 0,void 0,p)),a||(M&&b.onLoadedObservable.remove(M),l.h.UseFallbackTexture&&m.createTexture(l.h.fallbackTexture,n,b.invertY,i,o,null,null,u,b)),s&&s(e||"Unknown error",r)};if(T){var C=function(e){T.loadData(e,b,function(e,t,n,r,a,s){s?R("TextureLoader failed to load data"):m._prepareWebGLTexture(b,i,e,t,b.invertY,!n,r,function(){return a(),!1},o)})};u?C(u):this._loadFile(g,C,void 0,i?i.offlineProvider:void 0,!0,function(e,t){R("Unable to load "+(e&&e.responseURL,t))})}else{var w=function(t){v&&!m._doNotHandleContextLost&&(b._buffer=t),m._prepareWebGLTexture(b,i,t.width,t.height,b.invertY,n,!1,function(n,r,o){var a=m._gl,s=t.width===n&&t.height===r,l=h?m._getInternalFormat(h):".jpg"===x?a.RGB:a.RGBA;if(s)return a.texImage2D(a.TEXTURE_2D,0,l,l,a.UNSIGNED_BYTE,t),!1;var u=m._caps.maxTextureSize;if(t.width>u||t.height>u||null===e._RescalePostProcessFactory)return m._prepareWorkingCanvas(),!(!m._workingCanvas||!m._workingContext)&&(m._workingCanvas.width=n,m._workingCanvas.height=r,m._workingContext.drawImage(t,0,0,t.width,t.height,0,0,n,r),a.texImage2D(a.TEXTURE_2D,0,l,l,a.UNSIGNED_BYTE,m._workingCanvas),b.width=n,b.height=r,!1);var c=new f.a(m,f.a.DATASOURCE_TEMP);return m._bindTextureDirectly(a.TEXTURE_2D,c,!0),a.texImage2D(a.TEXTURE_2D,0,l,l,a.UNSIGNED_BYTE,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),m._rescaleTexture(c,b,i,l,function(){m._releaseTexture(c),m._bindTextureDirectly(a.TEXTURE_2D,b,!0),o()}),!0},o)};!_||y?u instanceof HTMLImageElement?w(u):l.h.LoadImage(g,w,R,i?i.offlineProvider:null):"string"==typeof u||u instanceof ArrayBuffer||u instanceof Blob?l.h.LoadImage(u,w,R,i?i.offlineProvider:null):w(u)}return b},e.prototype._rescaleTexture=function(t,n,r,i,o){var a=this,s=this.createRenderTargetTexture({width:n.width,height:n.height},{generateMipMaps:!1,type:e.TEXTURETYPE_UNSIGNED_INT,samplingMode:e.TEXTURE_BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&e._RescalePostProcessFactory&&(this._rescalePostProcess=e._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){a._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};var e=r;e||(e=a.scenes[a.scenes.length-1]),e.postProcessManager.directRender([a._rescalePostProcess],s,!0),a._bindTextureDirectly(a._gl.TEXTURE_2D,n,!0),a._gl.copyTexImage2D(a._gl.TEXTURE_2D,0,i,0,0,n.width,n.height,0),a.unBindFramebuffer(s),a._releaseTexture(s),o&&o()})},e.prototype.createRawTexture=function(t,n,r,i,o,a,s,l,u){throw void 0===l&&(l=null),void 0===u&&(u=e.TEXTURETYPE_UNSIGNED_INT),b.a.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype.createDynamicTexture=function(e,t,n,r){var i=new f.a(this,f.a.DATASOURCE_DYNAMIC);return i.baseWidth=e,i.baseHeight=t,n&&(e=this.needPOTTextures?l.h.GetExponentOfTwo(e,this._caps.maxTextureSize):e,t=this.needPOTTextures?l.h.GetExponentOfTwo(t,this._caps.maxTextureSize):t),i.width=e,i.height=t,i.isReady=!1,i.generateMipMaps=n,i.samplingMode=r,this.updateTextureSamplingMode(r,i),this._internalTexturesCache.push(i),i},e.prototype.updateTextureSamplingMode=function(e,t){var n=this._getSamplingParameters(e,t.generateMipMaps);t.isCube?(this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,n.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):t.is3D?(this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,n.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,n.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t.samplingMode=e},e.prototype.updateDynamicTexture=function(e,t,n,r,i,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0,o),this._unpackFlipY(n),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var a=i?this._getInternalFormat(i):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,a,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.isReady=!0}},e.prototype.updateVideoTexture=function(e,t,n){if(e&&!e._isDisabled){var r=this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0);this._unpackFlipY(!n);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=document.createElement("canvas");var i=e._workingCanvas.getContext("2d");if(!i)throw new Error("Unable to get 2d context");e._workingContext=i,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),r||this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}catch(t){e._isDisabled=!0}}},e.prototype.updateTextureComparisonFunction=function(t,n){if(1!==this.webGLVersion){var r=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),0===n?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,e.LEQUAL),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,n),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),0===n?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,e.LEQUAL),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=n}else _.a.Error("WebGL 1 does not support texture comparison.")},e.prototype._setupDepthStencilTexture=function(t,n,r,i,o){var a=n.width||n,s=n.height||n;t.baseWidth=a,t.baseHeight=s,t.width=a,t.height=s,t.isReady=!0,t.samples=1,t.generateMipMaps=!1,t._generateDepthBuffer=!0,t._generateStencilBuffer=r,t.samplingMode=i?e.TEXTURE_BILINEAR_SAMPLINGMODE:e.TEXTURE_NEAREST_SAMPLINGMODE,t.type=e.TEXTURETYPE_UNSIGNED_INT,t._comparisonFunction=o;var l=this._gl,u=t.isCube?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D,c=this._getSamplingParameters(t.samplingMode,!1);l.texParameteri(u,l.TEXTURE_MAG_FILTER,c.mag),l.texParameteri(u,l.TEXTURE_MIN_FILTER,c.min),l.texParameteri(u,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(u,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),0===o?(l.texParameteri(u,l.TEXTURE_COMPARE_FUNC,e.LEQUAL),l.texParameteri(u,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(u,l.TEXTURE_COMPARE_FUNC,o),l.texParameteri(u,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE))},e.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var n=e.width||e;return this._createDepthStencilCubeTexture(n,t)}return this._createDepthStencilTexture(e,t)},e.prototype._createDepthStencilTexture=function(e,t){var n=new f.a(this,f.a.DATASOURCE_DEPTHTEXTURE);if(!this._caps.depthTextureExtension)return _.a.Error("Depth texture is not supported by your browser or hardware."),n;var i=r.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),o=this._gl;return this._bindTextureDirectly(o.TEXTURE_2D,n,!0),this._setupDepthStencilTexture(n,e,i.generateStencil,i.bilinearFiltering,i.comparisonFunction),this.webGLVersion>1?i.generateStencil?o.texImage2D(o.TEXTURE_2D,0,o.DEPTH24_STENCIL8,n.width,n.height,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_COMPONENT24,n.width,n.height,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null):i.generateStencil?o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_STENCIL,n.width,n.height,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_2D,0,o.DEPTH_COMPONENT,n.width,n.height,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null),this._bindTextureDirectly(o.TEXTURE_2D,null),n},e.prototype.setFrameBufferDepthStencilTexture=function(e){var t=e.getInternalTexture();if(t&&t._framebuffer&&e.depthStencilTexture){var n=this._gl,r=e.depthStencilTexture;this._bindUnboundFramebuffer(t._framebuffer),r.isCube?r._generateStencilBuffer?n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_CUBE_MAP_POSITIVE_X,r._webGLTexture,0):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_CUBE_MAP_POSITIVE_X,r._webGLTexture,0):r._generateStencilBuffer?n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,r._webGLTexture,0):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r._webGLTexture,0),this._bindUnboundFramebuffer(null)}},e.prototype.createRenderTargetTexture=function(t,n){var r=new y.a;void 0!==n&&"object"==typeof n?(r.generateMipMaps=n.generateMipMaps,r.generateDepthBuffer=void 0===n.generateDepthBuffer||n.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&n.generateStencilBuffer,r.type=void 0===n.type?e.TEXTURETYPE_UNSIGNED_INT:n.type,r.samplingMode=void 0===n.samplingMode?e.TEXTURE_TRILINEAR_SAMPLINGMODE:n.samplingMode,r.format=void 0===n.format?e.TEXTUREFORMAT_RGBA:n.format):(r.generateMipMaps=n,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=e.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=e.TEXTURE_TRILINEAR_SAMPLINGMODE,r.format=e.TEXTUREFORMAT_RGBA),(r.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(r.type!==e.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=e.TEXTURE_NEAREST_SAMPLINGMODE);var i=this._gl,o=new f.a(this,f.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(i.TEXTURE_2D,o,!0);var a=t.width||t,s=t.height||t,l=this._getSamplingParameters(r.samplingMode,!!r.generateMipMaps);r.type!==e.TEXTURETYPE_FLOAT||this._caps.textureFloat||(r.type=e.TEXTURETYPE_UNSIGNED_INT,_.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,l.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,l.min),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(r.type,r.format),a,s,0,this._getInternalFormat(r.format),this._getWebGLTextureType(r.type),null);var u=this._currentFramebuffer,c=i.createFramebuffer();return this._bindUnboundFramebuffer(c),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,o._webGLTexture,0),o._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!r.generateStencilBuffer,r.generateDepthBuffer,a,s),r.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),this._bindUnboundFramebuffer(u),o._framebuffer=c,o.baseWidth=a,o.baseHeight=s,o.width=a,o.height=s,o.isReady=!0,o.samples=1,o.generateMipMaps=!!r.generateMipMaps,o.samplingMode=r.samplingMode,o.type=r.type,o.format=r.format,o._generateDepthBuffer=r.generateDepthBuffer,o._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(o),o},e.prototype._setupFramebufferDepthAttachments=function(e,t,n,r,i){void 0===i&&(i=1);var o=null,a=this._gl;return e?(o=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,o),i>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,i,a.DEPTH24_STENCIL8,n,r):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,n,r),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,o)):t&&(o=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,o),i>1?a.renderbufferStorageMultisample(a.RENDERBUFFER,i,a.DEPTH_COMPONENT16,n,r):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,n,r),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,o)),o},e.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var n=this._gl;if(t=Math.min(t,n.getParameter(n.MAX_SAMPLES)),e._depthStencilBuffer&&(n.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(n.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(n.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1){var r=n.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=r,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var i=n.createRenderbuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,i),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,i),e._MSAARenderBuffer=i}else this._bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),n.bindRenderbuffer(n.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),t},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,n,r,i,o,a){void 0===o&&(o=0),void 0===a&&(a=0);var s=this._gl,l=s.TEXTURE_2D;e.isCube&&(l=s.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._gl.compressedTexImage2D(l,a,t,n,r,0,i)},e.prototype._uploadDataToTextureDirectly=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this._gl,o=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),s=this._getRGBABufferInternalSizedFormat(e.type,a);this._unpackFlipY(e.invertY);var l=i.TEXTURE_2D;e.isCube&&(l=i.TEXTURE_CUBE_MAP_POSITIVE_X+n);var u=Math.round(c.a.Log2(e.width)),h=Math.round(c.a.Log2(e.height)),d=Math.pow(2,Math.max(u-r,0)),f=Math.pow(2,Math.max(h-r,0));i.texImage2D(l,r,s,d,f,0,a,o,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this._gl,o=e.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(o,e,!0),this._uploadDataToTextureDirectly(e,t,n,r),this._bindTextureDirectly(o,null,!0)},e.prototype._uploadImageToTexture=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this._gl,o=this._getWebGLTextureType(e.type),a=this._getInternalFormat(e.format),s=this._getRGBABufferInternalSizedFormat(e.type,a),l=e.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(l,e,!0),this._unpackFlipY(e.invertY);var u=i.TEXTURE_2D;e.isCube&&(u=i.TEXTURE_CUBE_MAP_POSITIVE_X+n),i.texImage2D(u,r,s,a,o,t),this._bindTextureDirectly(l,null,!0)},e.prototype._setCubeMapTextureParams=function(e){var t=this._gl;t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,e?t.LINEAR_MIPMAP_LINEAR:t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)},e.prototype.createRawCubeTexture=function(e,t,n,r,i,o,a,s){throw void 0===s&&(s=null),b.a.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(t,n,r,i,o,a,s,l,u,c){throw void 0===u&&(u=null),void 0===c&&(c=e.TEXTURETYPE_UNSIGNED_INT),b.a.WarnImport("Engine.RawTexture")},e.prototype._prepareWebGLTextureContinuation=function(e,t,n,r,i){var o=this._gl;if(o){var a=this._getSamplingParameters(i,!n);o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,a.mag),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,a.min),n||r||o.generateMipmap(o.TEXTURE_2D),this._bindTextureDirectly(o.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,n,r,i,o,a,s,u,c){var h=this;void 0===c&&(c=e.TEXTURE_TRILINEAR_SAMPLINGMODE);var d=this.getCaps().maxTextureSize,f=Math.min(d,this.needPOTTextures?l.h.GetExponentOfTwo(r,d):r),p=Math.min(d,this.needPOTTextures?l.h.GetExponentOfTwo(i,d):i),m=this._gl;m&&(t._webGLTexture?(this._bindTextureDirectly(m.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===o||!!o),t.baseWidth=r,t.baseHeight=i,t.width=f,t.height=p,t.isReady=!0,u(f,p,function(){h._prepareWebGLTextureContinuation(t,n,a,s,c)})||this._prepareWebGLTextureContinuation(t,n,a,s,c)):n&&n._removePendingData(t))},e.prototype._convertRGBtoRGBATextureData=function(t,n,r,i){var o;o=i===e.TEXTURETYPE_FLOAT?new Float32Array(n*r*4):new Uint32Array(n*r*4);for(var a=0;a<n;a++)for(var s=0;s<r;s++){var l=3*(s*n+a),u=4*(s*n+a);o[u+0]=t[l+0],o[u+1]=t[l+1],o[u+2]=t[l+2],o[u+3]=1}return o},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){var t=this._gl;this._releaseFramebufferObjects(e),t.deleteTexture(e._webGLTexture),this.unbindAllTextures();var n=this._internalTexturesCache.indexOf(e);-1!==n&&this._internalTexturesCache.splice(n,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),this.scenes.forEach(function(t){t.postProcesses.forEach(function(t){t._outputTexture==e&&(t._outputTexture=null)}),t.cameras.forEach(function(t){t._postProcesses.forEach(function(t){t&&t._outputTexture==e&&(t._outputTexture=null)})})})},e.prototype.setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this.setProgram(t.program);for(var n=e.getSamplers(),r=0;r<n.length;r++){var i=e.getUniform(n[r]);i&&(this._boundUniforms[r]=i)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);var i=!1,o=t&&t._associatedChannel>-1;return n&&o&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||r?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):n&&(i=!0,this._activateCurrentTexture()),o&&!n&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),i},e.prototype._bindTexture=function(e,t){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},e.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._bindTexture(e,t?t._outputTexture:null)},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},e.prototype.setTexture=function(e,t,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,n))},e.prototype.setDepthStencilTexture=function(e,t,n){void 0!==e&&(t&&(this._boundUniforms[e]=t),n&&n.depthStencilTexture?this._setTexture(e,n,!1,!0):this._setTexture(e,null))},e.prototype._bindSamplerUniformToChannel=function(e,t){var n=this._boundUniforms[e];n._currentState!==t&&(this._gl.uniform1i(n,t),n._currentState=t)},e.prototype._getTextureWrapMode=function(t){switch(t){case e.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case e.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case e.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),!n)return null!=this._boundTexturesCache[t]&&(this._activeChannel=t,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;if(n.video)this._activeChannel=t,n.update();else if(n.delayLoadState===e.DELAYLOADSTATE_NOTLOADED)return n.delayLoad(),!1;var o;o=i?n.depthStencilTexture:n.isReady()?n.getInternalTexture():n.isCube?this.emptyCubeTexture:n.is3D?this.emptyTexture3D:this.emptyTexture,!r&&o&&(o._associatedChannel=t);var a=!0;if(this._boundTexturesCache[t]===o&&(r||this._bindSamplerUniformToChannel(o._associatedChannel,t),a=!1),this._activeChannel=t,o&&o.isMultiview)a&&this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,o,r);else if(o&&o.is3D)a&&this._bindTextureDirectly(this._gl.TEXTURE_3D,o,r),o&&o._cachedWrapU!==n.wrapU&&(o._cachedWrapU=n.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(n.wrapU),o)),o&&o._cachedWrapV!==n.wrapV&&(o._cachedWrapV=n.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(n.wrapV),o)),o&&o._cachedWrapR!==n.wrapR&&(o._cachedWrapR=n.wrapR,this._setTextureParameterInteger(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n.wrapR),o)),this._setAnisotropicLevel(this._gl.TEXTURE_3D,n);else if(o&&o.isCube){if(a&&this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,o,r),o._cachedCoordinatesMode!==n.coordinatesMode){o._cachedCoordinatesMode=n.coordinatesMode;var s=n.coordinatesMode!==e.TEXTURE_CUBIC_MODE&&n.coordinatesMode!==e.TEXTURE_SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,s,o),this._setTextureParameterInteger(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,s)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,n)}else a&&this._bindTextureDirectly(this._gl.TEXTURE_2D,o,r),o&&o._cachedWrapU!==n.wrapU&&(o._cachedWrapU=n.wrapU,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(n.wrapU),o)),o&&o._cachedWrapV!==n.wrapV&&(o._cachedWrapV=n.wrapV,this._setTextureParameterInteger(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(n.wrapV),o)),this._setAnisotropicLevel(this._gl.TEXTURE_2D,n);return!0},e.prototype.setTextureArray=function(e,t,n){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===n.length||(this._textureUnits=new Int32Array(n.length));for(var r=0;r<n.length;r++){var i=n[r].getInternalTexture();i?(this._textureUnits[e+r]=e+r,i._associatedChannel=e+r):this._textureUnits[e+r]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<n.length;o++)this._setTexture(this._textureUnits[o],n[o],!0)}},e.prototype._setAnisotropicLevel=function(t,n){var r=n.getInternalTexture();if(r){var i=this._caps.textureAnisotropicFilterExtension,o=n.anisotropicFilteringLevel;r.samplingMode!==e.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&r.samplingMode!==e.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&r.samplingMode!==e.TEXTURE_LINEAR_LINEAR&&(o=1),i&&r._cachedAnisotropicFilteringLevel!==o&&(this._setTextureParameterFloat(t,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o,this._caps.maxAnisotropy),r),r._cachedAnisotropicFilteringLevel=o)}},e.prototype._setTextureParameterFloat=function(e,t,n,r){this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameterf(e,t,n)},e.prototype._setTextureParameterInteger=function(e,t,n,r){r&&this._bindTextureDirectly(e,r,!0,!0),this._gl.texParameteri(e,t,n)},e.prototype.readPixels=function(e,t,n,r){var i=new Uint8Array(r*n*4);return this._gl.readPixels(e,t,n,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,i),i},e.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new a.a),this._externalData.add(e,t)},e.prototype.getExternalData=function(e){return this._externalData||(this._externalData=new a.a),this._externalData.get(e)},e.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new a.a),this._externalData.getOrAddWithFactory(e,t)},e.prototype.removeExternalData=function(e){return this._externalData||(this._externalData=new a.a),this._externalData.remove(e)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||(this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();1===e.Instances.length&&e.audioEngine&&e.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),g.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange));var t=e.Instances.indexOf(this);t>=0&&e.Instances.splice(t,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._bindedRenderFunction=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),h.a.ResetCache();for(var n=0,r=this._activeRequests;n<r.length;n++)r[n].abort()},e.prototype.displayLoadingUI=function(){if(g.a.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},e.prototype.hideLoadingUI=function(){if(g.a.IsWindowObjectExist()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},e.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},e.prototype.getError=function(){return this._gl.getError()},e.prototype.getFps=function(){return this._fps},e.prototype.getDeltaTime=function(){return this._deltaTime},e.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},e.prototype._readTexturePixels=function(e,t,n,r,i,o){void 0===r&&(r=-1),void 0===i&&(i=0),void 0===o&&(o=null);var a=this._gl;if(!this._dummyFramebuffer){var s=a.createFramebuffer();if(!s)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=s}a.bindFramebuffer(a.FRAMEBUFFER,this._dummyFramebuffer),r>-1?a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._webGLTexture,i):a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e._webGLTexture,i);var l=void 0!==e.type?this._getWebGLTextureType(e.type):a.UNSIGNED_BYTE;switch(l){case a.UNSIGNED_BYTE:o||(o=new Uint8Array(4*t*n)),l=a.UNSIGNED_BYTE;break;default:o||(o=new Float32Array(4*t*n)),l=a.FLOAT}return a.readPixels(0,0,t,n,a.RGBA,l,o),a.bindFramebuffer(a.FRAMEBUFFER,this._currentFramebuffer),o},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.TEXTURETYPE_FLOAT)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.TEXTURETYPE_HALF_FLOAT)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var n=!0,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if((n=(n=n&&o===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),n=n&&t.getError()===t.NO_ERROR),n){t.bindFramebuffer(t.FRAMEBUFFER,null);var a=t.RGBA,s=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,a,s,l),n=n&&t.getError()===t.NO_ERROR}for(t.deleteTexture(r),t.deleteFramebuffer(i),t.bindFramebuffer(t.FRAMEBUFFER,null);!n&&t.getError()!==t.NO_ERROR;);return n},e.prototype._getWebGLTextureType=function(t){if(1===this._webGLVersion){switch(t){case e.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case e.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case e.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE}return this._gl.UNSIGNED_BYTE}switch(t){case e.TEXTURETYPE_BYTE:return this._gl.BYTE;case e.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case e.TEXTURETYPE_SHORT:return this._gl.SHORT;case e.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case e.TEXTURETYPE_INT:return this._gl.INT;case e.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case e.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case e.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case e.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(t){var n=this._gl.RGBA;switch(t){case e.TEXTUREFORMAT_ALPHA:n=this._gl.ALPHA;break;case e.TEXTUREFORMAT_LUMINANCE:n=this._gl.LUMINANCE;break;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:n=this._gl.LUMINANCE_ALPHA;break;case e.TEXTUREFORMAT_RED:n=this._gl.RED;break;case e.TEXTUREFORMAT_RG:n=this._gl.RG;break;case e.TEXTUREFORMAT_RGB:n=this._gl.RGB;break;case e.TEXTUREFORMAT_RGBA:n=this._gl.RGBA}if(this._webGLVersion>1)switch(t){case e.TEXTUREFORMAT_RED_INTEGER:n=this._gl.RED_INTEGER;break;case e.TEXTUREFORMAT_RG_INTEGER:n=this._gl.RG_INTEGER;break;case e.TEXTUREFORMAT_RGB_INTEGER:n=this._gl.RGB_INTEGER;break;case e.TEXTUREFORMAT_RGBA_INTEGER:n=this._gl.RGBA_INTEGER}return n},e.prototype._getRGBABufferInternalSizedFormat=function(t,n){if(1===this._webGLVersion){if(void 0!==n)switch(n){case e.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case e.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA}return this._gl.RGBA}switch(t){case e.TEXTURETYPE_BYTE:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case e.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case e.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case e.TEXTURETYPE_UNSIGNED_BYTE:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R8;case e.TEXTUREFORMAT_RG:return this._gl.RG8;case e.TEXTUREFORMAT_RGB:return this._gl.RGB8;case e.TEXTUREFORMAT_RGBA:return this._gl.RGBA8;case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case e.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case e.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case e.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case e.TEXTURETYPE_SHORT:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case e.TEXTURETYPE_UNSIGNED_SHORT:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case e.TEXTURETYPE_INT:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case e.TEXTURETYPE_UNSIGNED_INTEGER:switch(n){case e.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case e.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case e.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case e.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case e.TEXTURETYPE_FLOAT:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R32F;case e.TEXTUREFORMAT_RG:return this._gl.RG32F;case e.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case e.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case e.TEXTURETYPE_HALF_FLOAT:switch(n){case e.TEXTUREFORMAT_RED:return this._gl.R16F;case e.TEXTUREFORMAT_RG:return this._gl.RG16F;case e.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case e.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(n){case e.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case e.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(t){return t===e.TEXTURETYPE_FLOAT?this._gl.RGBA32F:t===e.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(e,t,n,r,i,o){var a=this,s=l.h.LoadFile(e,t,n,r,i,o);return this._activeRequests.push(s),s.onCompleteObservable.add(function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)}),s},e.prototype._loadFileAsync=function(e,t,n){var r=this;return new Promise(function(i,o){r._loadFile(e,function(e){i(e)},void 0,t,n,function(e,t){o(t)})})},e.isSupported=function(){try{var e=document.createElement("canvas");return null!=(e.getContext("webgl")||e.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(e){return!1}},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.ALPHA_DISABLE=m.a.ALPHA_DISABLE,e.ALPHA_ADD=m.a.ALPHA_ADD,e.ALPHA_COMBINE=m.a.ALPHA_COMBINE,e.ALPHA_SUBTRACT=m.a.ALPHA_SUBTRACT,e.ALPHA_MULTIPLY=m.a.ALPHA_MULTIPLY,e.ALPHA_MAXIMIZED=m.a.ALPHA_MAXIMIZED,e.ALPHA_ONEONE=m.a.ALPHA_ONEONE,e.ALPHA_PREMULTIPLIED=m.a.ALPHA_PREMULTIPLIED,e.ALPHA_PREMULTIPLIED_PORTERDUFF=m.a.ALPHA_PREMULTIPLIED_PORTERDUFF,e.ALPHA_INTERPOLATE=m.a.ALPHA_INTERPOLATE,e.ALPHA_SCREENMODE=m.a.ALPHA_SCREENMODE,e.DELAYLOADSTATE_NONE=m.a.DELAYLOADSTATE_NONE,e.DELAYLOADSTATE_LOADED=m.a.DELAYLOADSTATE_LOADED,e.DELAYLOADSTATE_LOADING=m.a.DELAYLOADSTATE_LOADING,e.DELAYLOADSTATE_NOTLOADED=m.a.DELAYLOADSTATE_NOTLOADED,e.NEVER=m.a.NEVER,e.ALWAYS=m.a.ALWAYS,e.LESS=m.a.LESS,e.EQUAL=m.a.EQUAL,e.LEQUAL=m.a.LEQUAL,e.GREATER=m.a.GREATER,e.GEQUAL=m.a.GEQUAL,e.NOTEQUAL=m.a.NOTEQUAL,e.KEEP=m.a.KEEP,e.REPLACE=m.a.REPLACE,e.INCR=m.a.INCR,e.DECR=m.a.DECR,e.INVERT=m.a.INVERT,e.INCR_WRAP=m.a.INCR_WRAP,e.DECR_WRAP=m.a.DECR_WRAP,e.TEXTURE_CLAMP_ADDRESSMODE=m.a.TEXTURE_CLAMP_ADDRESSMODE,e.TEXTURE_WRAP_ADDRESSMODE=m.a.TEXTURE_WRAP_ADDRESSMODE,e.TEXTURE_MIRROR_ADDRESSMODE=m.a.TEXTURE_MIRROR_ADDRESSMODE,e.TEXTUREFORMAT_ALPHA=m.a.TEXTUREFORMAT_ALPHA,e.TEXTUREFORMAT_LUMINANCE=m.a.TEXTUREFORMAT_LUMINANCE,e.TEXTUREFORMAT_LUMINANCE_ALPHA=m.a.TEXTUREFORMAT_LUMINANCE_ALPHA,e.TEXTUREFORMAT_RGB=m.a.TEXTUREFORMAT_RGB,e.TEXTUREFORMAT_RGBA=m.a.TEXTUREFORMAT_RGBA,e.TEXTUREFORMAT_RED=m.a.TEXTUREFORMAT_RED,e.TEXTUREFORMAT_R=m.a.TEXTUREFORMAT_R,e.TEXTUREFORMAT_RG=m.a.TEXTUREFORMAT_RG,e.TEXTUREFORMAT_RED_INTEGER=m.a.TEXTUREFORMAT_RED_INTEGER,e.TEXTUREFORMAT_R_INTEGER=m.a.TEXTUREFORMAT_R_INTEGER,e.TEXTUREFORMAT_RG_INTEGER=m.a.TEXTUREFORMAT_RG_INTEGER,e.TEXTUREFORMAT_RGB_INTEGER=m.a.TEXTUREFORMAT_RGB_INTEGER,e.TEXTUREFORMAT_RGBA_INTEGER=m.a.TEXTUREFORMAT_RGBA_INTEGER,e.TEXTURETYPE_UNSIGNED_BYTE=m.a.TEXTURETYPE_UNSIGNED_BYTE,e.TEXTURETYPE_UNSIGNED_INT=m.a.TEXTURETYPE_UNSIGNED_INT,e.TEXTURETYPE_FLOAT=m.a.TEXTURETYPE_FLOAT,e.TEXTURETYPE_HALF_FLOAT=m.a.TEXTURETYPE_HALF_FLOAT,e.TEXTURETYPE_BYTE=m.a.TEXTURETYPE_BYTE,e.TEXTURETYPE_SHORT=m.a.TEXTURETYPE_SHORT,e.TEXTURETYPE_UNSIGNED_SHORT=m.a.TEXTURETYPE_UNSIGNED_SHORT,e.TEXTURETYPE_INT=m.a.TEXTURETYPE_INT,e.TEXTURETYPE_UNSIGNED_INTEGER=m.a.TEXTURETYPE_UNSIGNED_INTEGER,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=m.a.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=m.a.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=m.a.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=m.a.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV,e.TEXTURETYPE_UNSIGNED_INT_24_8=m.a.TEXTURETYPE_UNSIGNED_INT_24_8,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=m.a.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=m.a.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=m.a.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV,e.TEXTURE_NEAREST_SAMPLINGMODE=m.a.TEXTURE_NEAREST_SAMPLINGMODE,e.TEXTURE_BILINEAR_SAMPLINGMODE=m.a.TEXTURE_BILINEAR_SAMPLINGMODE,e.TEXTURE_TRILINEAR_SAMPLINGMODE=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=m.a.TEXTURE_NEAREST_NEAREST_MIPLINEAR,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=m.a.TEXTURE_LINEAR_LINEAR_MIPNEAREST,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=m.a.TEXTURE_LINEAR_LINEAR_MIPLINEAR,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=m.a.TEXTURE_NEAREST_NEAREST_MIPNEAREST,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=m.a.TEXTURE_NEAREST_LINEAR_MIPNEAREST,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=m.a.TEXTURE_NEAREST_LINEAR_MIPLINEAR,e.TEXTURE_NEAREST_LINEAR=m.a.TEXTURE_NEAREST_LINEAR,e.TEXTURE_NEAREST_NEAREST=m.a.TEXTURE_NEAREST_NEAREST,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=m.a.TEXTURE_LINEAR_NEAREST_MIPNEAREST,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=m.a.TEXTURE_LINEAR_NEAREST_MIPLINEAR,e.TEXTURE_LINEAR_LINEAR=m.a.TEXTURE_LINEAR_LINEAR,e.TEXTURE_LINEAR_NEAREST=m.a.TEXTURE_LINEAR_NEAREST,e.TEXTURE_EXPLICIT_MODE=m.a.TEXTURE_EXPLICIT_MODE,e.TEXTURE_SPHERICAL_MODE=m.a.TEXTURE_SPHERICAL_MODE,e.TEXTURE_PLANAR_MODE=m.a.TEXTURE_PLANAR_MODE,e.TEXTURE_CUBIC_MODE=m.a.TEXTURE_CUBIC_MODE,e.TEXTURE_PROJECTION_MODE=m.a.TEXTURE_PROJECTION_MODE,e.TEXTURE_SKYBOX_MODE=m.a.TEXTURE_SKYBOX_MODE,e.TEXTURE_INVCUBIC_MODE=m.a.TEXTURE_INVCUBIC_MODE,e.TEXTURE_EQUIRECTANGULAR_MODE=m.a.TEXTURE_EQUIRECTANGULAR_MODE,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=m.a.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=m.a.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,e.SCALEMODE_FLOOR=m.a.SCALEMODE_FLOOR,e.SCALEMODE_NEAREST=m.a.SCALEMODE_NEAREST,e.SCALEMODE_CEILING=m.a.SCALEMODE_CEILING,e.CollisionsEpsilon=.001,e._RescalePostProcessFactory=null,e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return P}),n.d(t,"c",function(){return R}),n.d(t,"a",function(){return w});var r=n(1),i=n(8),o=n(9),a=n(32),s=n(29),l=n(0),u=n(25),c=n(4),h=n(13),d=n(57),f=n(24),p=n(49),m=n(43),g=n(20),_=n(66),v=n(55),y=n(3),b=n(2),E=n(6),x=n(22),T=n(19),S=n(14),A=n(110),P=function(){},M=function(){this.visibleInstances={},this.batchCache=new R,this.instancesBufferSize=2048},R=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},C=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},w=function(e){function t(n,r,i,o,l,u){void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=!0);var c=e.call(this,n,r)||this;if(c._internalMeshDataInfo=new C,c.delayLoadState=y.a.DELAYLOADSTATE_NONE,c.instances=new Array,c._creationDataStorage=null,c._geometry=null,c._instanceDataStorage=new M,c._effectiveMaterial=null,c._shouldGenerateFlatShading=!1,c._originalBuilderSideOrientation=t.DEFAULTSIDE,c.overrideMaterialSideOrientation=null,r=c.getScene(),o){if(o._geometry&&o._geometry.applyToMesh(c),a.a.DeepCopy(o,c,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable"],["_poseMatrix"]),c._internalMeshDataInfo._source=o,r.useClonedMeshhMap&&(o._internalMeshDataInfo.meshMap||(o._internalMeshDataInfo.meshMap={}),o._internalMeshDataInfo.meshMap[c.uniqueId]=c),c._originalBuilderSideOrientation=o._originalBuilderSideOrientation,c._creationDataStorage=o._creationDataStorage,o._ranges){var h=o._ranges;for(var n in h)h.hasOwnProperty(n)&&h[n]&&c.createAnimationRange(n,h[n].from,h[n].to)}var d;if(o.metadata&&o.metadata.clone?c.metadata=o.metadata.clone():c.metadata=o.metadata,s.a&&s.a.HasTags(o)&&s.a.AddTagsTo(c,s.a.GetTags(o,!0)),c.parent=o.parent,c.setPivotMatrix(o.getPivotMatrix()),c.id=n+"."+o.id,c.material=o.material,!l)for(var f=o.getDescendants(!0),p=0;p<f.length;p++){var m=f[p];m.clone&&m.clone(n+"."+m.name,c)}if(r.getPhysicsEngine){var g=r.getPhysicsEngine();if(u&&g){var _=g.getImpostorForPhysicsObject(o);_&&(c.physicsImpostor=_.clone(c))}}for(d=0;d<r.particleSystems.length;d++){var v=r.particleSystems[d];v.emitter===o&&v.clone(v.name,c)}c.refreshBoundingInfo(),c.computeWorldMatrix(!0)}return null!==i&&(c.parent=i),c._instanceDataStorage.hardwareInstancedRendering=c.getEngine().getCaps().instancedArrays,c}return r.d(t,e),t._GetDefaultSideOrientation=function(e){return e||t.FRONTSIDE},Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new i.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new i.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new i.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new i.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(e){this._internalMeshDataInfo._morphTargetManager!==e&&(this._internalMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(t.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){var n=e.prototype.toString.call(this,t);if(n+=", n vertices: "+this.getTotalVertices(),n+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var r=0;r<this.animations.length;r++)n+=", animation[0]: "+this.animations[r].toString(t);if(t)if(this._geometry){var i=this.getIndices(),o=this.getVerticesData(c.b.PositionKind);o&&i&&(n+=", flat shading: "+(o.length/3===i.length?"YES":"NO"))}else n+=", flat shading: UNKNOWN";return n},t.prototype._unBindEffect=function(){e.prototype._unBindEffect.call(this);for(var t=0,n=this.instances;t<n.length;t++)n[t]._unBindEffect()},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!0,configurable:!0}),t.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},t.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},t.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return E.a.Warn("You cannot use a mesh as LOD level twice"),this;var n=new A.a(e,t);return this._internalMeshDataInfo._LODLevels.push(n),t&&(t._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,n=0;n<t._LODLevels.length;n++){var r=t._LODLevels[n];if(r.distance===e)return r.mesh}return null},t.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,n=0;n<t._LODLevels.length;n++)t._LODLevels[n].mesh===e&&(t._LODLevels.splice(n,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(e,t){var n=this._internalMeshDataInfo;if(!n._LODLevels||0===n._LODLevels.length)return this;var r=(t||this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.globalPosition).length();if(n._LODLevels[n._LODLevels.length-1].distance>r)return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,n._LODLevels[n._LODLevels.length-1].mesh),this;for(var i=0;i<n._LODLevels.length;i++){var o=n._LODLevels[i];if(o.distance<r)return o.mesh&&(o.mesh._preActivate(),o.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(r,this,o.mesh),o.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(e,t,n){return this._geometry?this._geometry.getVerticesData(e,t,n):null},t.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},t.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(t){e.push(t)}),e}return this._geometry.getVerticesDataKinds()},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),this.delayLoadState===y.a.DELAYLOADSTATE_LOADING)return!1;if(!e.prototype.isReady.call(this,t))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!t)return!0;var r=this.getEngine(),i=this.getScene(),o=n||r.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var a=this.material||i.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(var s=0,l=this.subMeshes;s<l.length;s++){var u=(m=l[s]).getMaterial();if(u)if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(this,m,o))return!1}else if(!u.isReady(this,o))return!1}else if(!a.isReady(this,o))return!1;for(var c=0,h=this.lightSources;c<h.length;c++){var d=h[c].getShadowGenerator();if(d)for(var f=0,p=this.subMeshes;f<p.length;f++){var m=p[f];if(!d.isReady(m,o))return!1}}for(var g=0,_=this._internalMeshDataInfo._LODLevels;g<_.length;g++){var v=_[g];if(v.mesh&&!v.mesh.isReady(o))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),t.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t?this:(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null,this)},t.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},t.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},t.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var n=this.getIndices();if(!n)return null;var r=n.length,i=!1;if(e)i=!0;else for(var o=0,a=this.subMeshes;o<a.length;o++){var s=a[o];if(s.indexStart+s.indexCount>=r){i=!0;break}if(s.verticesStart+s.verticesCount>=t){i=!0;break}}if(!i)return this.subMeshes[0]}return this.releaseSubMeshes(),new p.b(0,0,t,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),n=t/e|0,r=0;n%3!=0;)n++;this.releaseSubMeshes();for(var i=0;i<e&&!(r>=t);i++)p.b.CreateFromIndices(0,r,Math.min(n,t-r),this),r+=n;this.synchronizeInstances()}},t.prototype.setVerticesData=function(e,t,n,r){if(void 0===n&&(n=!1),this._geometry)this._geometry.setVerticesData(e,t,n,r);else{var i=new h.a;i.set(t,e);var o=this.getScene();new d.a(d.a.RandomId(),o,i,n,this)}return this},t.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var n=this.getVertexBuffer(e);n&&n.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},t.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=d.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},t.prototype.updateVerticesData=function(e,t,n,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,n,!1)):this._geometry.updateVerticesData(e,t,n),this):this},t.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var n=this.getVerticesData(c.b.PositionKind);if(!n)return this;if(e(n),this.updateVerticesData(c.b.PositionKind,n,!1,!1),t){var r=this.getIndices(),i=this.getVerticesData(c.b.NormalKind);if(!i)return this;h.a.ComputeNormals(n,r,i),this.updateVerticesData(c.b.NormalKind,i,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(d.a.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},t.prototype.setIndices=function(e,t,n){if(void 0===t&&(t=null),void 0===n&&(n=!1),this._geometry)this._geometry.setIndices(e,t,n);else{var r=new h.a;r.indices=e;var i=this.getScene();new d.a(d.a.RandomId(),i,r,n,this)}return this},t.prototype.updateIndices=function(e,t,n){return void 0===n&&(n=!1),this._geometry?(this._geometry.updateIndices(e,t,n),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(e,t,n){if(!this._geometry)return this;var r,i=this.getScene().getEngine();if(this._unIndexed)r=null;else switch(n){case g.a.PointFillMode:r=null;break;case g.a.WireFrameFillMode:r=e._getLinesIndexBuffer(this.getIndices(),i);break;default:case g.a.TriangleFillMode:r=this._geometry.getIndexBuffer()}return this._geometry._bind(t,r),this},t.prototype._draw=function(e,t,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var r=this.getScene().getEngine();return this._unIndexed||t==g.a.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,n):t==g.a.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,n):r.drawElementsType(t,e.indexStart,e.indexCount,n),this},t.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},t.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},t.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},t.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},t.prototype._getInstancesRenderList=function(e){if(this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var t=this.getScene(),n=t._isInIntermediateRendering(),r=n?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,i=this._instanceDataStorage.batchCache;if(i.mustReturn=!1,i.renderSelf[e]=!r&&this.isEnabled()&&this.isVisible,i.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances){var o=this._instanceDataStorage.visibleInstances,a=t.getRenderId(),s=n?o.intermediateDefaultRenderId:o.defaultRenderId;i.visibleInstances[e]=o[a],!i.visibleInstances[e]&&s&&(i.visibleInstances[e]=o[s])}return i.hardwareInstancedRendering[e]=this._instanceDataStorage.hardwareInstancedRendering&&null!==i.visibleInstances[e]&&void 0!==i.visibleInstances[e],this._instanceDataStorage.previousBatch=i,i},t.prototype._renderWithInstances=function(e,t,n,r,i){var o=n.visibleInstances[e._id];if(!o)return this;for(var a=this._instanceDataStorage,s=a.instancesBufferSize,l=a.instancesBuffer,u=16*(o.length+1)*4;a.instancesBufferSize<u;)a.instancesBufferSize*=2;a.instancesData&&s==a.instancesBufferSize||(a.instancesData=new Float32Array(a.instancesBufferSize/4));var h=0,d=0,f=this._effectiveMesh.getWorldMatrix();if(n.renderSelf[e._id]&&(f.copyToArray(a.instancesData,h),h+=16,d++),o)for(var p=0;p<o.length;p++)o[p].getWorldMatrix().copyToArray(a.instancesData,h),h+=16,d++;return l&&s==a.instancesBufferSize?l.updateDirectly(a.instancesData,0,d):(l&&l.dispose(),l=new c.a(i,a.instancesData,!0,16,!1,!0),a.instancesBuffer=l,this.setVerticesBuffer(l.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(l.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(l.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(l.createVertexBuffer("world3",12,4))),this._bind(e,r,t),this._draw(e,t,d),i.unbindInstanceAttributes(),this},t.prototype._processRendering=function(e,t,n,r,i,o,a){var s=this.getScene().getEngine();if(i)this._renderWithInstances(e,n,r,t,s);else{r.renderSelf[e._id]&&(o&&o(!1,this._effectiveMesh.getWorldMatrix(),a),this._draw(e,n,this._instanceDataStorage.overridenInstanceCount));var l=r.visibleInstances[e._id];if(l)for(var u=0;u<l.length;u++){var c=l[u].getWorldMatrix();o&&o(!0,c,a),this._draw(e,n)}}return this},t.prototype._freeze=function(){if(this._instanceDataStorage.isFrozen=!0,this.subMeshes)for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e)},t.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1},t.prototype.render=function(e,t){var n=this.getScene();if(n._isInIntermediateRendering()?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var r=this._getInstancesRenderList(e._id);if(r.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var i,o=n.getEngine(),a=r.hardwareInstancedRendering[e._id],s=this._instanceDataStorage,l=e.getMaterial();if(!l)return this;if(!s.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==l)if(this._effectiveMaterial=l,this._effectiveMaterial._storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,e,a))return this}else if(!this._effectiveMaterial.isReady(this,a))return this;t&&o.setAlphaMode(this._effectiveMaterial.alphaMode);for(var u=0,c=n._beforeRenderingMeshStage;u<c.length;u++)c[u].action(this,e,r);if(!(i=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var h,d=this._effectiveMesh;s.isFrozen?h=s.sideOrientation:(null==(h=this.overrideMaterialSideOrientation)&&(h=this._effectiveMaterial.sideOrientation,d._getWorldMatrixDeterminant()<0&&(h=h===g.a.ClockWiseSideOrientation?g.a.CounterClockWiseSideOrientation:g.a.ClockWiseSideOrientation)),s.sideOrientation=h);var f=this._effectiveMaterial._preBind(i,h);this._effectiveMaterial.forceDepthWrite&&o.setDepthWrite(!0);var p=n.forcePointsCloud?g.a.PointFillMode:n.forceWireframe?g.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),a||this._bind(e,i,p);var m=d.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(m,this,e):this._effectiveMaterial.bind(m,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(o.setState(!0,this._effectiveMaterial.zOffset,!1,!f),this._processRendering(e,i,p,r,a,this._onBeforeDraw,this._effectiveMaterial),o.setState(!0,this._effectiveMaterial.zOffset,!1,f)),this._processRendering(e,i,p,r,a,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var _=0,v=n._afterRenderingMeshStage;_<v.length;_++)v[_].action(this,e,r);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},t.prototype._onBeforeDraw=function(e,t,n){e&&n&&n.bindOnlyWorldMatrix(t)},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(c.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(c.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},t.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(c.b.MatricesWeightsKind),t=e.length,n=0;n<t;n+=4){var r=e[n]+e[n+1]+e[n+2]+e[n+3];if(0===r)e[n]=1;else{var i=1/r;e[n]*=i,e[n+1]*=i,e[n+2]*=i,e[n+3]*=i}}this.setVerticesData(c.b.MatricesWeightsKind,e)},t.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(c.b.MatricesWeightsExtraKind),t=this.getVerticesData(c.b.MatricesWeightsKind),n=t.length,r=0;r<n;r+=4){var i=t[r]+t[r+1]+t[r+2]+t[r+3];if(0===(i+=e[r]+e[r+1]+e[r+2]+e[r+3]))t[r]=1;else{var o=1/i;t[r]*=o,t[r+1]*=o,t[r+2]*=o,t[r+3]*=o,e[r]*=o,e[r+1]*=o,e[r+2]*=o,e[r+3]*=o}}this.setVerticesData(c.b.MatricesWeightsKind,t),this.setVerticesData(c.b.MatricesWeightsKind,e)},t.prototype.validateSkinning=function(){var e=this.getVerticesData(c.b.MatricesWeightsExtraKind),t=this.getVerticesData(c.b.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var n=t.length,r=0,i=0,o=0,a=0,s=null===e?4:8,l=new Array,u=0;u<=s;u++)l[u]=0;for(u=0;u<n;u+=4){for(var h=t[u],d=h,f=0===d?0:1,p=1;p<s;p++){var m=p<4?t[u+p]:e[u+p-4];m>h&&r++,0!==m&&f++,d+=m,h=m}if(l[f]++,f>o&&(o=f),0===d)i++;else{var g=1/d,_=0;for(p=0;p<s;p++)_+=p<4?Math.abs(t[u+p]-t[u+p]*g):Math.abs(e[u+p-4]-e[u+p-4]*g);_>.001&&a++}}var v=this.skeleton.bones.length,y=this.getVerticesData(c.b.MatricesIndicesKind),b=this.getVerticesData(c.b.MatricesIndicesExtraKind),E=0;for(u=0;u<n;u++)for(p=0;p<s;p++){var x=p<4?y[p]:b[p-4];(x>=v||x<0)&&E++}return{skinned:!0,valid:0===i&&0===a&&0===E,report:"Number of Weights = "+n/4+"\nMaximum influences = "+o+"\nMissing Weights = "+i+"\nNot Sorted = "+r+"\nNot Normalized = "+a+"\nWeightCounts = ["+l+"]\nNumber of bones = "+v+"\nBad Bone Indices = "+E}},t.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===y.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=y.a.DELAYLOADSTATE_LOADING,this._queueLoad(e)),this},t.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var n=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return o.h.LoadFile(this.delayLoadingFile,function(n){n instanceof ArrayBuffer?t._delayLoadingFunction(n,t):t._delayLoadingFunction(JSON.parse(n),t),t.instances.forEach(function(e){e.refreshBoundingInfo(),e._syncSubMeshes()}),t.delayLoadState=y.a.DELAYLOADSTATE_LOADED,e._removePendingData(t)},function(){},e.offlineProvider,n),this},t.prototype.isInFrustum=function(t){return this.delayLoadState!==y.a.DELAYLOADSTATE_LOADING&&!!e.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0)},t.prototype.setMaterialByID=function(e){var t,n=this.getScene().materials;for(t=n.length-1;t>-1;t--)if(n[t].id===e)return this.material=n[t],this;var r=this.getScene().multiMaterials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;return this},t.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},t.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(c.b.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var n,r=this.getVerticesData(c.b.PositionKind),i=new Array;for(n=0;n<r.length;n+=3)l.x.TransformCoordinates(l.x.FromArray(r,n),e).toArray(i,n);if(this.setVerticesData(c.b.PositionKind,i,this.getVertexBuffer(c.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(c.b.NormalKind)){for(r=this.getVerticesData(c.b.NormalKind),i=[],n=0;n<r.length;n+=3)l.x.TransformNormal(l.x.FromArray(r,n),e).normalize().toArray(i,n);this.setVerticesData(c.b.NormalKind,i,this.getVertexBuffer(c.b.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},t.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=l.q.Identity()),this._worldMatrix=l.j.Identity(),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},t.prototype.clone=function(e,n,r,i){return void 0===e&&(e=""),void 0===i&&(i=!0),new t(e,this.getScene(),n,this,r,i)},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var r=this._internalMeshDataInfo;if(r._onBeforeDrawObservable&&r._onBeforeDrawObservable.clear(),r._onBeforeBindObservable&&r._onBeforeBindObservable.clear(),r._onBeforeRenderObservable&&r._onBeforeRenderObservable.clear(),r._onAfterRenderObservable&&r._onAfterRenderObservable.clear(),this._scene.useClonedMeshhMap){if(r.meshMap)for(var i in r.meshMap)(s=r.meshMap[i])&&(s._internalMeshDataInfo._source=null,r.meshMap[i]=void 0);r._source&&r._source._internalMeshDataInfo.meshMap&&(r._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var o=0,a=this.getScene().meshes;o<a.length;o++){var s;(s=a[o])._internalMeshDataInfo&&s._internalMeshDataInfo._source&&s._internalMeshDataInfo._source===this&&(s._internalMeshDataInfo._source=null)}for(r._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();e.prototype.dispose.call(this,t,n)},t.prototype.applyDisplacementMap=function(e,t,n,r,i,a,s){var l=this;void 0===s&&(s=!1);var u=this.getScene();return o.h.LoadImage(e,function(e){var o=document.createElement("canvas"),u=o.getContext("2d"),c=e.width,h=e.height;o.width=c,o.height=h,u.drawImage(e,0,0);var d=u.getImageData(0,0,c,h).data;l.applyDisplacementMapFromBuffer(d,c,h,t,n,i,a,s),r&&r(l)},function(){},u.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(e,t,n,r,i,o,a,s){if(void 0===s&&(s=!1),!this.isVerticesDataPresent(c.b.PositionKind)||!this.isVerticesDataPresent(c.b.NormalKind)||!this.isVerticesDataPresent(c.b.UVKind))return E.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var u=this.getVerticesData(c.b.PositionKind,!0,!0),d=this.getVerticesData(c.b.NormalKind),f=this.getVerticesData(c.b.UVKind),p=l.x.Zero(),m=l.x.Zero(),g=l.w.Zero();o=o||l.w.Zero(),a=a||new l.w(1,1);for(var _=0;_<u.length;_+=3){l.x.FromArrayToRef(u,_,p),l.x.FromArrayToRef(d,_,m),l.w.FromArrayToRef(f,_/3*2,g);var v=4*((Math.abs(g.x*a.x+o.x)*t%t|0)+(Math.abs(g.y*a.y+o.y)*n%n|0)*t),y=e[v]/255*.3+e[v+1]/255*.59+e[v+2]/255*.11;m.normalize(),m.scaleInPlace(r+(i-r)*y),(p=p.add(m)).toArray(u,_)}return h.a.ComputeNormals(u,this.getIndices(),d),s?(this.setVerticesData(c.b.PositionKind,u),this.setVerticesData(c.b.NormalKind,d)):(this.updateVerticesData(c.b.PositionKind,u),this.updateVerticesData(c.b.NormalKind,d)),this},t.prototype.convertToFlatShadedMesh=function(){var e,t,n=this.getVerticesDataKinds(),r={},i={},o={},a=!1;for(e=0;e<n.length;e++){t=n[e];var s=this.getVertexBuffer(t);t!==c.b.NormalKind?(r[t]=s,i[t]=r[t].getData(),o[t]=[]):(a=s.isUpdatable(),n.splice(e,1),e--)}var u,h=this.subMeshes.slice(0),d=this.getIndices(),f=this.getTotalIndices();for(u=0;u<f;u++){var m=d[u];for(e=0;e<n.length;e++)for(var g=r[t=n[e]].getStrideSize(),_=0;_<g;_++)o[t].push(i[t][m*g+_])}var v=[],y=o[c.b.PositionKind];for(u=0;u<f;u+=3){d[u]=u,d[u+1]=u+1,d[u+2]=u+2;for(var b=l.x.FromArray(y,3*u),E=l.x.FromArray(y,3*(u+1)),x=l.x.FromArray(y,3*(u+2)),T=b.subtract(E),S=x.subtract(E),A=l.x.Normalize(l.x.Cross(T,S)),P=0;P<3;P++)v.push(A.x),v.push(A.y),v.push(A.z)}for(this.setIndices(d),this.setVerticesData(c.b.NormalKind,v,a),e=0;e<n.length;e++)t=n[e],this.setVerticesData(t,o[t],r[t].isUpdatable());this.releaseSubMeshes();for(var M=0;M<h.length;M++){var R=h[M];p.b.AddToMesh(R.materialIndex,R.indexStart,R.indexCount,R.indexStart,R.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var e,t,n=this.getVerticesDataKinds(),r={},i={},o={};for(e=0;e<n.length;e++){t=n[e];var a=this.getVertexBuffer(t);r[t]=a,i[t]=r[t].getData(),o[t]=[]}var s,l=this.subMeshes.slice(0),u=this.getIndices(),c=this.getTotalIndices();for(s=0;s<c;s++){var h=u[s];for(e=0;e<n.length;e++)for(var d=r[t=n[e]].getStrideSize(),f=0;f<d;f++)o[t].push(i[t][h*d+f])}for(s=0;s<c;s+=3)u[s]=s,u[s+1]=s+1,u[s+2]=s+2;for(this.setIndices(u),e=0;e<n.length;e++)t=n[e],this.setVerticesData(t,o[t],r[t].isUpdatable());this.releaseSubMeshes();for(var m=0;m<l.length;m++){var g=l[m];p.b.AddToMesh(g.materialIndex,g.indexStart,g.indexCount,g.indexStart,g.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,n,r=h.a.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(c.b.NormalKind)&&r.normals)for(t=0;t<r.normals.length;t++)r.normals[t]*=-1;if(r.indices)for(t=0;t<r.indices.length;t+=3)n=r.indices[t+1],r.indices[t+1]=r.indices[t+2],r.indices[t+2]=n;return r.applyToMesh(this),this},t.prototype.increaseVertices=function(e){var t=h.a.ExtractFromMesh(this),n=t.uvs,r=t.indices,i=t.positions,o=t.normals;if(null===r||null===i||null===o||null===n)E.a.Warn("VertexData contains null entries");else{for(var a,s,u=e+1,c=new Array,d=0;d<u+1;d++)c[d]=new Array;var f,p=new l.x(0,0,0),m=new l.x(0,0,0),g=new l.w(0,0),_=new Array,v=new Array,y=new Array,b=i.length,x=n.length;for(d=0;d<r.length;d+=3){v[0]=r[d],v[1]=r[d+1],v[2]=r[d+2];for(var T=0;T<3;T++)if(a=v[T],s=v[(T+1)%3],void 0===y[a]&&void 0===y[s]?(y[a]=new Array,y[s]=new Array):(void 0===y[a]&&(y[a]=new Array),void 0===y[s]&&(y[s]=new Array)),void 0===y[a][s]&&void 0===y[s][a]){y[a][s]=[],p.x=(i[3*s]-i[3*a])/u,p.y=(i[3*s+1]-i[3*a+1])/u,p.z=(i[3*s+2]-i[3*a+2])/u,m.x=(o[3*s]-o[3*a])/u,m.y=(o[3*s+1]-o[3*a+1])/u,m.z=(o[3*s+2]-o[3*a+2])/u,g.x=(n[2*s]-n[2*a])/u,g.y=(n[2*s+1]-n[2*a+1])/u,y[a][s].push(a);for(var S=1;S<u;S++)y[a][s].push(i.length/3),i[b]=i[3*a]+S*p.x,o[b++]=o[3*a]+S*m.x,i[b]=i[3*a+1]+S*p.y,o[b++]=o[3*a+1]+S*m.y,i[b]=i[3*a+2]+S*p.z,o[b++]=o[3*a+2]+S*m.z,n[x++]=n[2*a]+S*g.x,n[x++]=n[2*a+1]+S*g.y;y[a][s].push(s),y[s][a]=new Array,f=y[a][s].length;for(var A=0;A<f;A++)y[s][a][A]=y[a][s][f-1-A]}for(c[0][0]=r[d],c[1][0]=y[r[d]][r[d+1]][1],c[1][1]=y[r[d]][r[d+2]][1],S=2;S<u;S++)for(c[S][0]=y[r[d]][r[d+1]][S],c[S][S]=y[r[d]][r[d+2]][S],p.x=(i[3*c[S][S]]-i[3*c[S][0]])/S,p.y=(i[3*c[S][S]+1]-i[3*c[S][0]+1])/S,p.z=(i[3*c[S][S]+2]-i[3*c[S][0]+2])/S,m.x=(o[3*c[S][S]]-o[3*c[S][0]])/S,m.y=(o[3*c[S][S]+1]-o[3*c[S][0]+1])/S,m.z=(o[3*c[S][S]+2]-o[3*c[S][0]+2])/S,g.x=(n[2*c[S][S]]-n[2*c[S][0]])/S,g.y=(n[2*c[S][S]+1]-n[2*c[S][0]+1])/S,T=1;T<S;T++)c[S][T]=i.length/3,i[b]=i[3*c[S][0]]+T*p.x,o[b++]=o[3*c[S][0]]+T*m.x,i[b]=i[3*c[S][0]+1]+T*p.y,o[b++]=o[3*c[S][0]+1]+T*m.y,i[b]=i[3*c[S][0]+2]+T*p.z,o[b++]=o[3*c[S][0]+2]+T*m.z,n[x++]=n[2*c[S][0]]+T*g.x,n[x++]=n[2*c[S][0]+1]+T*g.y;for(c[u]=y[r[d+1]][r[d+2]],_.push(c[0][0],c[1][0],c[1][1]),S=1;S<u;S++){for(T=0;T<S;T++)_.push(c[S][T],c[S+1][T],c[S+1][T+1]),_.push(c[S][T],c[S+1][T+1],c[S][T+1]);_.push(c[S][T],c[S+1][T],c[S+1][T+1])}}t.indices=_,t.applyToMesh(this)}},t.prototype.forceSharedVertices=function(){var e=h.a.ExtractFromMesh(this),t=e.uvs,n=e.indices,r=e.positions,i=e.normals;if(null===n||null===r||null===i||null===t)E.a.Warn("VertexData contains null entries");else{for(var o,a,s=new Array,l=new Array,u=new Array,c=new Array,d=0,f=new Array,p=0;p<n.length;p+=3){a=[n[p],n[p+1],n[p+2]],c=new Array;for(var m=0;m<3;m++){c[m]="";for(var g=0;g<3;g++)Math.abs(r[3*a[m]+g])<1e-8&&(r[3*a[m]+g]=0),c[m]+=r[3*a[m]+g]+"|";c[m]=c[m].slice(0,-1)}if(c[0]!=c[1]&&c[0]!=c[2]&&c[1]!=c[2])for(m=0;m<3;m++){if((o=f.indexOf(c[m]))<0){for(f.push(c[m]),o=d++,g=0;g<3;g++)s.push(r[3*a[m]+g]);for(g=0;g<2;g++)u.push(t[2*a[m]+g])}l.push(o)}}var _=new Array;h.a.ComputeNormals(s,l,_),e.positions=s,e.indices=l,e.normals=_,e.uvs=u,e.applyToMesh(this)}},t._instancedMeshFactory=function(e,t){throw T.a.WarnImport("InstancedMesh")},t._PhysicsImpostorParser=function(e,t,n){throw T.a.WarnImport("PhysicsImpostor")},t.prototype.createInstance=function(e){return t._instancedMeshFactory(e,this)},t.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++)this.instances[e]._syncSubMeshes();return this},t.prototype.optimizeIndices=function(e){var t=this,n=this.getIndices(),r=this.getVerticesData(c.b.PositionKind);if(!r||!n)return this;for(var i=new Array,a=0;a<r.length;a+=3)i.push(l.x.FromArray(r,a));var s=new Array;return o.a.SyncAsyncForLoop(i.length,40,function(e){for(var t=i.length-1-e,n=i[t],r=0;r<t;++r){var o=i[r];if(n.equals(o)){s[t]=r;break}}},function(){for(var r=0;r<n.length;++r)n[r]=s[n[r]]||n[r];var i=t.subMeshes.slice(0);t.setIndices(n),t.subMeshes=i,e&&e(t)}),this},t.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),s.a&&s.a.HasTags(this)&&(e.tags=s.a.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){var n=t.id;e.geometryId=n,e.subMeshes=[];for(var r=0;r<this.subMeshes.length;r++){var i=this.subMeshes[r];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}if(this.material?e.materialId=this.material.id:this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id),this.getScene()._getComponent(S.a.NAME_PHYSICSENGINE)){var o=this.getPhysicsImpostor();o&&(e.physicsMass=o.getParam("mass"),e.physicsFriction=o.getParam("friction"),e.physicsRestitution=o.getParam("mass"),e.physicsImpostor=o.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var a=0;a<this.instances.length;a++){var l=this.instances[a];if(!l.doNotSerialize){var u={name:l.name,id:l.id,position:l.position.asArray(),scaling:l.scaling.asArray()};l.parent&&(u.parentId=l.parent.id),l.rotationQuaternion?u.rotationQuaternion=l.rotationQuaternion.asArray():l.rotation&&(u.rotation=l.rotation.asArray()),e.instances.push(u),b.a.AppendSerializedAnimations(l,u),u.ranges=l.serializeAnimationRanges()}}b.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return E.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var n=e.getActiveTarget(t),r=n.getPositions();if(!r)return void E.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(c.b.PositionKind+t,r,!1,3);var i=n.getNormals();i&&this.geometry.setVerticesData(c.b.NormalKind+t,i,!1,3);var o=n.getTangents();o&&this.geometry.setVerticesData(c.b.TangentKind+t,o,!1,3)}}else for(t=0;this.geometry.isVerticesDataPresent(c.b.PositionKind+t);)this.geometry.removeVerticesData(c.b.PositionKind+t),this.geometry.isVerticesDataPresent(c.b.NormalKind+t)&&this.geometry.removeVerticesData(c.b.NormalKind+t),this.geometry.isVerticesDataPresent(c.b.TangentKind+t)&&this.geometry.removeVerticesData(c.b.TangentKind+t),t++}},t.Parse=function(e,n,r){var i;if((i=e.type&&"GroundMesh"===e.type?t._GroundMeshParser(e,n):new t(e.name,n)).id=e.id,s.a&&s.a.AddTagsTo(i,e.tags),i.position=l.x.FromArray(e.position),void 0!==e.metadata&&(i.metadata=e.metadata),e.rotationQuaternion?i.rotationQuaternion=l.q.FromArray(e.rotationQuaternion):e.rotation&&(i.rotation=l.x.FromArray(e.rotation)),i.scaling=l.x.FromArray(e.scaling),e.localMatrix?i.setPreTransformMatrix(l.j.FromArray(e.localMatrix)):e.pivotMatrix&&i.setPivotMatrix(l.j.FromArray(e.pivotMatrix)),i.setEnabled(e.isEnabled),i.isVisible=e.isVisible,i.infiniteDistance=e.infiniteDistance,i.showBoundingBox=e.showBoundingBox,i.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(i.applyFog=e.applyFog),void 0!==e.pickable&&(i.isPickable=e.pickable),void 0!==e.alphaIndex&&(i.alphaIndex=e.alphaIndex),i.receiveShadows=e.receiveShadows,i.billboardMode=e.billboardMode,void 0!==e.visibility&&(i.visibility=e.visibility),i.checkCollisions=e.checkCollisions,void 0!==e.isBlocker&&(i.isBlocker=e.isBlocker),i._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(i._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(i._waitingParentId=e.parentId),void 0!==e.actions&&(i._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(i.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(i.overlayColor=l.e.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(i.renderOverlay=e.renderOverlay),i.isUnIndexed=!!e.isUnIndexed,i.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(i.delayLoadState=y.a.DELAYLOADSTATE_NOTLOADED,i.delayLoadingFile=r+e.delayLoadingFile,i._boundingInfo=new m.a(l.x.FromArray(e.boundingBoxMinimum),l.x.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(i._binaryInfo=e._binaryInfo),i._delayInfo=[],e.hasUVs&&i._delayInfo.push(c.b.UVKind),e.hasUVs2&&i._delayInfo.push(c.b.UV2Kind),e.hasUVs3&&i._delayInfo.push(c.b.UV3Kind),e.hasUVs4&&i._delayInfo.push(c.b.UV4Kind),e.hasUVs5&&i._delayInfo.push(c.b.UV5Kind),e.hasUVs6&&i._delayInfo.push(c.b.UV6Kind),e.hasColors&&i._delayInfo.push(c.b.ColorKind),e.hasMatricesIndices&&i._delayInfo.push(c.b.MatricesIndicesKind),e.hasMatricesWeights&&i._delayInfo.push(c.b.MatricesWeightsKind),i._delayLoadingFunction=d.a._ImportGeometry,v.a.ForceFullSceneLoadingForIncremental&&i._checkDelayState()):d.a._ImportGeometry(e,i),e.materialId?i.setMaterialByID(e.materialId):i.material=null,e.morphTargetManagerId>-1&&(i.morphTargetManager=n.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId>-1&&(i.skeleton=n.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(i.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var o=0;o<e.animations.length;o++){var a=e.animations[o];(g=x.a.GetClass("BABYLON.Animation"))&&i.animations.push(g.Parse(a))}u.a.ParseAnimationRanges(i,e,n)}if(e.autoAnimate&&n.beginAnimation(i,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?i.layerMask=Math.abs(parseInt(e.layerMask)):i.layerMask=268435455,e.physicsImpostor&&t._PhysicsImpostorParser(n,i,e),e.lodMeshIds&&(i._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var h=0;h<e.instances.length;h++){var f=e.instances[h],p=i.createInstance(f.name);if(f.id&&(p.id=f.id),s.a&&(f.tags?s.a.AddTagsTo(p,f.tags):s.a.AddTagsTo(p,e.tags)),p.position=l.x.FromArray(f.position),void 0!==f.metadata&&(p.metadata=f.metadata),f.parentId&&(p._waitingParentId=f.parentId),f.rotationQuaternion?p.rotationQuaternion=l.q.FromArray(f.rotationQuaternion):f.rotation&&(p.rotation=l.x.FromArray(f.rotation)),p.scaling=l.x.FromArray(f.scaling),null!=f.checkCollisions&&null!=f.checkCollisions&&(p.checkCollisions=f.checkCollisions),null!=f.pickable&&null!=f.pickable&&(p.isPickable=f.pickable),null!=f.showBoundingBox&&null!=f.showBoundingBox&&(p.showBoundingBox=f.showBoundingBox),null!=f.showSubMeshesBoundingBox&&null!=f.showSubMeshesBoundingBox&&(p.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox),null!=f.alphaIndex&&null!=f.showSubMeshesBoundingBox&&(p.alphaIndex=f.alphaIndex),f.physicsImpostor&&t._PhysicsImpostorParser(n,p,f),f.animations){for(o=0;o<f.animations.length;o++){var g;a=f.animations[o],(g=x.a.GetClass("BABYLON.Animation"))&&p.animations.push(g.Parse(a))}u.a.ParseAnimationRanges(p,f,n),f.autoAnimate&&n.beginAnimation(p,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}}return i},t.CreateRibbon=function(e,t,n,r,i,o,a,s,l){throw T.a.WarnImport("MeshBuilder")},t.CreateDisc=function(e,t,n,r,i,o){throw void 0===r&&(r=null),T.a.WarnImport("MeshBuilder")},t.CreateBox=function(e,t,n,r,i){throw void 0===n&&(n=null),T.a.WarnImport("MeshBuilder")},t.CreateSphere=function(e,t,n,r,i,o){throw T.a.WarnImport("MeshBuilder")},t.CreateHemisphere=function(e,t,n,r){throw T.a.WarnImport("MeshBuilder")},t.CreateCylinder=function(e,t,n,r,i,o,a,s,l){throw T.a.WarnImport("MeshBuilder")},t.CreateTorus=function(e,t,n,r,i,o,a){throw T.a.WarnImport("MeshBuilder")},t.CreateTorusKnot=function(e,t,n,r,i,o,a,s,l,u){throw T.a.WarnImport("MeshBuilder")},t.CreateLines=function(e,t,n,r,i){throw void 0===n&&(n=null),void 0===r&&(r=!1),void 0===i&&(i=null),T.a.WarnImport("MeshBuilder")},t.CreateDashedLines=function(e,t,n,r,i,o,a,s){throw void 0===o&&(o=null),T.a.WarnImport("MeshBuilder")},t.CreatePolygon=function(e,t,n,r,i,o,a){throw void 0===a&&(a=earcut),T.a.WarnImport("MeshBuilder")},t.ExtrudePolygon=function(e,t,n,r,i,o,a,s){throw void 0===s&&(s=earcut),T.a.WarnImport("MeshBuilder")},t.ExtrudeShape=function(e,t,n,r,i,o,a,s,l,u){throw void 0===a&&(a=null),T.a.WarnImport("MeshBuilder")},t.ExtrudeShapeCustom=function(e,t,n,r,i,o,a,s,l,u,c,h){throw T.a.WarnImport("MeshBuilder")},t.CreateLathe=function(e,t,n,r,i,o,a){throw T.a.WarnImport("MeshBuilder")},t.CreatePlane=function(e,t,n,r,i){throw T.a.WarnImport("MeshBuilder")},t.CreateGround=function(e,t,n,r,i,o){throw T.a.WarnImport("MeshBuilder")},t.CreateTiledGround=function(e,t,n,r,i,o,a,s,l){throw T.a.WarnImport("MeshBuilder")},t.CreateGroundFromHeightMap=function(e,t,n,r,i,o,a,s,l,u,c){throw T.a.WarnImport("MeshBuilder")},t.CreateTube=function(e,t,n,r,i,o,a,s,l,u){throw T.a.WarnImport("MeshBuilder")},t.CreatePolyhedron=function(e,t,n){throw T.a.WarnImport("MeshBuilder")},t.CreateIcoSphere=function(e,t,n){throw T.a.WarnImport("MeshBuilder")},t.CreateDecal=function(e,t,n,r,i,o){throw T.a.WarnImport("MeshBuilder")},t.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(c.b.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(c.b.PositionKind)||this.setVerticesData(c.b.PositionKind,t,!0)}return e._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(c.b.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(c.b.NormalKind)||this.setVerticesData(c.b.NormalKind,t,!0)}return e._sourceNormals},t.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(c.b.PositionKind))return this;if(!this.isVerticesDataPresent(c.b.NormalKind))return this;if(!this.isVerticesDataPresent(c.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(c.b.MatricesWeightsKind))return this;var t=this._internalMeshDataInfo;if(!t._sourcePositions){var n=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=n}t._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(c.b.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var i=this.getVerticesData(c.b.NormalKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));var o=this.getVerticesData(c.b.MatricesIndicesKind),a=this.getVerticesData(c.b.MatricesWeightsKind);if(!a||!o)return this;for(var s,u=this.numBoneInfluencers>4,h=u?this.getVerticesData(c.b.MatricesIndicesExtraKind):null,d=u?this.getVerticesData(c.b.MatricesWeightsExtraKind):null,f=e.getTransformMatrices(this),p=l.x.Zero(),m=new l.j,g=new l.j,_=0,v=0;v<r.length;v+=3,_+=4){var y;for(s=0;s<4;s++)(y=a[_+s])>0&&(l.j.FromFloat32ArrayToRefScaled(f,Math.floor(16*o[_+s]),y,g),m.addToSelf(g));if(u)for(s=0;s<4;s++)(y=d[_+s])>0&&(l.j.FromFloat32ArrayToRefScaled(f,Math.floor(16*h[_+s]),y,g),m.addToSelf(g));l.x.TransformCoordinatesFromFloatsToRef(t._sourcePositions[v],t._sourcePositions[v+1],t._sourcePositions[v+2],m,p),p.toArray(r,v),l.x.TransformNormalFromFloatsToRef(t._sourceNormals[v],t._sourceNormals[v+1],t._sourceNormals[v+2],m,p),p.toArray(i,v),m.reset()}return this.updateVerticesData(c.b.PositionKind,r),this.updateVerticesData(c.b.NormalKind,i),this},t.MinMax=function(e){var t=null,n=null;return e.forEach(function(e){var r=e.getBoundingInfo().boundingBox;t&&n?(t.minimizeInPlace(r.minimumWorld),n.maximizeInPlace(r.maximumWorld)):(t=r.minimumWorld,n=r.maximumWorld)}),t&&n?{min:t,max:n}:{min:l.x.Zero(),max:l.x.Zero()}},t.Center=function(e){var n=e instanceof Array?t.MinMax(e):e;return l.x.Center(n.min,n.max)},t.MergeMeshes=function(e,n,r,i,o,a){var s;if(void 0===n&&(n=!0),!r){var l=0;for(s=0;s<e.length;s++)if(e[s]&&(l+=e[s].getTotalVertices())>65536)return E.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(a){var u,c,d=null;o=!1}var f,m=new Array,g=new Array,v=null,y=new Array,b=null;for(s=0;s<e.length;s++)if(e[s]){var x=e[s];if(x.isAnInstance)return E.a.Warn("Cannot merge instance meshes."),null;var T=x.computeWorldMatrix(!0);if((f=h.a.ExtractFromMesh(x,!0,!0)).transform(T),v?v.merge(f,r):(v=f,b=x),o&&y.push(x.getTotalIndices()),a)if(x.material){var S=x.material;if(S instanceof _.a){for(c=0;c<S.subMaterials.length;c++)m.indexOf(S.subMaterials[c])<0&&m.push(S.subMaterials[c]);for(u=0;u<x.subMeshes.length;u++)g.push(m.indexOf(S.subMaterials[x.subMeshes[u].materialIndex])),y.push(x.subMeshes[u].indexCount)}else for(m.indexOf(S)<0&&m.push(S),u=0;u<x.subMeshes.length;u++)g.push(m.indexOf(S)),y.push(x.subMeshes[u].indexCount)}else for(u=0;u<x.subMeshes.length;u++)g.push(0),y.push(x.subMeshes[u].indexCount)}if(b=b,i||(i=new t(b.name+"_merged",b.getScene())),v.applyToMesh(i),i.checkCollisions=b.checkCollisions,n)for(s=0;s<e.length;s++)e[s]&&e[s].dispose();if(o||a){i.releaseSubMeshes(),s=0;for(var A=0;s<y.length;)p.b.CreateFromIndices(0,A,y[s],i),A+=y[s],s++}if(a){for((d=new _.a(b.name+"_merged",b.getScene())).subMaterials=m,u=0;u<i.subMeshes.length;u++)i.subMeshes[u].materialIndex=g[u];i.material=d}else i.material=b.material;return i},t.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},t.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var n=this.instances[this.instances.length-1];this.instances[t]=n,n._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.FRONTSIDE=h.a.FRONTSIDE,t.BACKSIDE=h.a.BACKSIDE,t.DOUBLESIDE=h.a.DOUBLESIDE,t.DEFAULTSIDE=h.a.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t._GroundMeshParser=function(e,t){throw T.a.WarnImport("GroundMesh")},t}(f.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.WithinEpsilon=function(e,t,n){void 0===n&&(n=1.401298e-45);var r=e-t;return-n<=r&&r<=n},e.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),Math.min(n,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,n){return(e-t)/(n-t)},e.Denormalize=function(e,t,n){return e*(n-t)+t},e.DeltaAngle=function(t,n){var r=e.Repeat(n-t,360);return r>180&&(r-=360),r},e.PingPong=function(t,n){var r=e.Repeat(t,2*n);return n-Math.abs(r-n)},e.SmoothStep=function(t,n,r){var i=e.Clamp(r);return n*(i=-2*i*i*i+3*i*i)+t*(1-i)},e.MoveTowards=function(t,n,r){return Math.abs(n-t)<=r?n:t+e.Sign(n-t)*r},e.MoveTowardsAngle=function(t,n,r){var i=e.DeltaAngle(t,n),o=0;return-r<i&&i<r?o=n:(n=t+i,o=e.MoveTowards(t,n,r)),o},e.Lerp=function(e,t,n){return e+(t-e)*n},e.LerpAngle=function(t,n,r){var i=e.Repeat(n-t,360);return i>180&&(i-=360),t+i*e.Clamp(r)},e.InverseLerp=function(t,n,r){return t!=n?e.Clamp((r-t)/(n-t)):0},e.Hermite=function(e,t,n,r,i){var o=i*i,a=i*o;return e*(2*a-3*o+1)+n*(-2*a+3*o)+t*(a-2*o+i)+r*(a-o)},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,n){return(e-t)/(n-t)},e.PercentToRange=function(e,t,n){return(n-t)*e+t},e.NormalizeRadians=function(t){return t-=e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e.TwoPi=2*Math.PI,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(4),o=n(19),a=function(){function e(){}return e.prototype.set=function(e,t){switch(t){case i.b.PositionKind:this.positions=e;break;case i.b.NormalKind:this.normals=e;break;case i.b.TangentKind:this.tangents=e;break;case i.b.UVKind:this.uvs=e;break;case i.b.UV2Kind:this.uvs2=e;break;case i.b.UV3Kind:this.uvs3=e;break;case i.b.UV4Kind:this.uvs4=e;break;case i.b.UV5Kind:this.uvs5=e;break;case i.b.UV6Kind:this.uvs6=e;break;case i.b.ColorKind:this.colors=e;break;case i.b.MatricesIndicesKind:this.matricesIndices=e;break;case i.b.MatricesWeightsKind:this.matricesWeights=e;break;case i.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case i.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},e.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},e.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},e.prototype.updateMesh=function(e){return this._update(e),this},e.prototype.updateGeometry=function(e){return this._update(e),this},e.prototype._applyTo=function(e,t){return void 0===t&&(t=!1),this.positions&&e.setVerticesData(i.b.PositionKind,this.positions,t),this.normals&&e.setVerticesData(i.b.NormalKind,this.normals,t),this.tangents&&e.setVerticesData(i.b.TangentKind,this.tangents,t),this.uvs&&e.setVerticesData(i.b.UVKind,this.uvs,t),this.uvs2&&e.setVerticesData(i.b.UV2Kind,this.uvs2,t),this.uvs3&&e.setVerticesData(i.b.UV3Kind,this.uvs3,t),this.uvs4&&e.setVerticesData(i.b.UV4Kind,this.uvs4,t),this.uvs5&&e.setVerticesData(i.b.UV5Kind,this.uvs5,t),this.uvs6&&e.setVerticesData(i.b.UV6Kind,this.uvs6,t),this.colors&&e.setVerticesData(i.b.ColorKind,this.colors,t),this.matricesIndices&&e.setVerticesData(i.b.MatricesIndicesKind,this.matricesIndices,t),this.matricesWeights&&e.setVerticesData(i.b.MatricesWeightsKind,this.matricesWeights,t),this.matricesIndicesExtra&&e.setVerticesData(i.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),this.matricesWeightsExtra&&e.setVerticesData(i.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),this.indices?e.setIndices(this.indices,null,t):e.setIndices([],null),this},e.prototype._update=function(e,t,n){return this.positions&&e.updateVerticesData(i.b.PositionKind,this.positions,t,n),this.normals&&e.updateVerticesData(i.b.NormalKind,this.normals,t,n),this.tangents&&e.updateVerticesData(i.b.TangentKind,this.tangents,t,n),this.uvs&&e.updateVerticesData(i.b.UVKind,this.uvs,t,n),this.uvs2&&e.updateVerticesData(i.b.UV2Kind,this.uvs2,t,n),this.uvs3&&e.updateVerticesData(i.b.UV3Kind,this.uvs3,t,n),this.uvs4&&e.updateVerticesData(i.b.UV4Kind,this.uvs4,t,n),this.uvs5&&e.updateVerticesData(i.b.UV5Kind,this.uvs5,t,n),this.uvs6&&e.updateVerticesData(i.b.UV6Kind,this.uvs6,t,n),this.colors&&e.updateVerticesData(i.b.ColorKind,this.colors,t,n),this.matricesIndices&&e.updateVerticesData(i.b.MatricesIndicesKind,this.matricesIndices,t,n),this.matricesWeights&&e.updateVerticesData(i.b.MatricesWeightsKind,this.matricesWeights,t,n),this.matricesIndicesExtra&&e.updateVerticesData(i.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,n),this.matricesWeightsExtra&&e.updateVerticesData(i.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,n),this.indices&&e.setIndices(this.indices,null),this},e.prototype.transform=function(e){var t,n=e.m[0]*e.m[5]*e.m[10]<0,i=r.x.Zero();if(this.positions){var o=r.x.Zero();for(t=0;t<this.positions.length;t+=3)r.x.FromArrayToRef(this.positions,t,o),r.x.TransformCoordinatesToRef(o,e,i),this.positions[t]=i.x,this.positions[t+1]=i.y,this.positions[t+2]=i.z}if(this.normals){var a=r.x.Zero();for(t=0;t<this.normals.length;t+=3)r.x.FromArrayToRef(this.normals,t,a),r.x.TransformNormalToRef(a,e,i),this.normals[t]=i.x,this.normals[t+1]=i.y,this.normals[t+2]=i.z}if(this.tangents){var s=r.y.Zero(),l=r.y.Zero();for(t=0;t<this.tangents.length;t+=4)r.y.FromArrayToRef(this.tangents,t,s),r.y.TransformNormalToRef(s,e,l),this.tangents[t]=l.x,this.tangents[t+1]=l.y,this.tangents[t+2]=l.z,this.tangents[t+3]=l.w}if(n&&this.indices)for(t=0;t<this.indices.length;t+=3){var u=this.indices[t+1];this.indices[t+1]=this.indices[t+2],this.indices[t+2]=u}return this},e.prototype.merge=function(e,t){if(void 0===t&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var n=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var r=this.indices.length+e.indices.length,i=t||this.indices instanceof Uint32Array?new Uint32Array(r):new Uint16Array(r);i.set(this.indices);for(var o=this.indices.length,a=0;a<e.indices.length;a++)i[o+a]=e.indices[a]+n;this.indices=i}else for(a=0;a<e.indices.length;a++)this.indices.push(e.indices[a]+n)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},e.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var n=t.length+e.length,r=e instanceof Float32Array,i=t instanceof Float32Array;if(r){var o=new Float32Array(n);return o.set(e),o.set(t,e.length),o}if(i){var a=e.slice(0),s=0;for(n=t.length;s<n;s++)a.push(t[s]);return a}return e.concat(t)},e.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var e=function(e,t){var n=i.b.DeduceStride(e);if(t.length%n!=0)throw new Error("The "+e+"s array count must be a multiple of "+n);return t.length/n},t=e(i.b.PositionKind,this.positions),n=function(n,r){var i=e(n,r);if(i!==t)throw new Error("The "+n+"s element count ("+i+") does not match the positions count ("+t+")")};this.normals&&n(i.b.NormalKind,this.normals),this.tangents&&n(i.b.TangentKind,this.tangents),this.uvs&&n(i.b.UVKind,this.uvs),this.uvs2&&n(i.b.UV2Kind,this.uvs2),this.uvs3&&n(i.b.UV3Kind,this.uvs3),this.uvs4&&n(i.b.UV4Kind,this.uvs4),this.uvs5&&n(i.b.UV5Kind,this.uvs5),this.uvs6&&n(i.b.UV6Kind,this.uvs6),this.colors&&n(i.b.ColorKind,this.colors),this.matricesIndices&&n(i.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&n(i.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&n(i.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&n(i.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},e.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},e.ExtractFromMesh=function(t,n,r){return e._ExtractFrom(t,n,r)},e.ExtractFromGeometry=function(t,n,r){return e._ExtractFrom(t,n,r)},e._ExtractFrom=function(t,n,r){var o=new e;return t.isVerticesDataPresent(i.b.PositionKind)&&(o.positions=t.getVerticesData(i.b.PositionKind,n,r)),t.isVerticesDataPresent(i.b.NormalKind)&&(o.normals=t.getVerticesData(i.b.NormalKind,n,r)),t.isVerticesDataPresent(i.b.TangentKind)&&(o.tangents=t.getVerticesData(i.b.TangentKind,n,r)),t.isVerticesDataPresent(i.b.UVKind)&&(o.uvs=t.getVerticesData(i.b.UVKind,n,r)),t.isVerticesDataPresent(i.b.UV2Kind)&&(o.uvs2=t.getVerticesData(i.b.UV2Kind,n,r)),t.isVerticesDataPresent(i.b.UV3Kind)&&(o.uvs3=t.getVerticesData(i.b.UV3Kind,n,r)),t.isVerticesDataPresent(i.b.UV4Kind)&&(o.uvs4=t.getVerticesData(i.b.UV4Kind,n,r)),t.isVerticesDataPresent(i.b.UV5Kind)&&(o.uvs5=t.getVerticesData(i.b.UV5Kind,n,r)),t.isVerticesDataPresent(i.b.UV6Kind)&&(o.uvs6=t.getVerticesData(i.b.UV6Kind,n,r)),t.isVerticesDataPresent(i.b.ColorKind)&&(o.colors=t.getVerticesData(i.b.ColorKind,n,r)),t.isVerticesDataPresent(i.b.MatricesIndicesKind)&&(o.matricesIndices=t.getVerticesData(i.b.MatricesIndicesKind,n,r)),t.isVerticesDataPresent(i.b.MatricesWeightsKind)&&(o.matricesWeights=t.getVerticesData(i.b.MatricesWeightsKind,n,r)),t.isVerticesDataPresent(i.b.MatricesIndicesExtraKind)&&(o.matricesIndicesExtra=t.getVerticesData(i.b.MatricesIndicesExtraKind,n,r)),t.isVerticesDataPresent(i.b.MatricesWeightsExtraKind)&&(o.matricesWeightsExtra=t.getVerticesData(i.b.MatricesWeightsExtraKind,n,r)),o.indices=t.getIndices(n,r),o},e.CreateRibbon=function(e){throw o.a.WarnImport("ribbonBuilder")},e.CreateBox=function(e){throw o.a.WarnImport("boxBuilder")},e.CreateSphere=function(e){throw o.a.WarnImport("sphereBuilder")},e.CreateCylinder=function(e){throw o.a.WarnImport("cylinderBuilder")},e.CreateTorus=function(e){throw o.a.WarnImport("torusBuilder")},e.CreateLineSystem=function(e){throw o.a.WarnImport("linesBuilder")},e.CreateDashedLines=function(e){throw o.a.WarnImport("linesBuilder")},e.CreateGround=function(e){throw o.a.WarnImport("groundBuilder")},e.CreateTiledGround=function(e){throw o.a.WarnImport("groundBuilder")},e.CreateGroundFromHeightMap=function(e){throw o.a.WarnImport("groundBuilder")},e.CreatePlane=function(e){throw o.a.WarnImport("planeBuilder")},e.CreateDisc=function(e){throw o.a.WarnImport("discBuilder")},e.CreatePolygon=function(e,t,n,r,i,a){throw o.a.WarnImport("polygonBuilder")},e.CreateIcoSphere=function(e){throw o.a.WarnImport("icoSphereBuilder")},e.CreatePolyhedron=function(e){throw o.a.WarnImport("polyhedronBuilder")},e.CreateTorusKnot=function(e){throw o.a.WarnImport("torusKnotBuilder")},e.ComputeNormals=function(e,t,n,i){var o=0,a=0,s=0,l=0,u=0,c=0,h=0,d=0,f=0,p=0,m=0,g=0,_=0,v=0,y=0,b=0,E=0,x=0,T=0,S=0,A=!1,P=!1,M=!1,R=!1,C=1,w=0,O=null;if(i&&(A=!!i.facetNormals,P=!!i.facetPositions,M=!!i.facetPartitioning,C=!0===i.useRightHandedSystem?-1:1,w=i.ratio||0,R=!!i.depthSort,O=i.distanceTo,R)){void 0===O&&(O=r.x.Zero());var I=i.depthSortedFacets}var D=0,L=0,F=0,N=0;if(M&&i&&i.bbSize){var B=0,U=0,k=0,V=0,G=0,z=0,j=0,H=0,W=0,X=0,Y=0,K=0,q=0,Q=0,Z=0,J=0,$=i.bbSize.x>i.bbSize.y?i.bbSize.x:i.bbSize.y;$=$>i.bbSize.z?$:i.bbSize.z,D=i.subDiv.X*w/i.bbSize.x,L=i.subDiv.Y*w/i.bbSize.y,F=i.subDiv.Z*w/i.bbSize.z,N=i.subDiv.max*i.subDiv.max,i.facetPartitioning.length=0}for(o=0;o<e.length;o++)n[o]=0;var ee=t.length/3|0;for(o=0;o<ee;o++){if(_=1+(g=3*t[3*o]),v=g+2,b=1+(y=3*t[3*o+1]),E=y+2,T=1+(x=3*t[3*o+2]),S=x+2,a=e[g]-e[y],s=e[_]-e[b],l=e[v]-e[E],u=e[x]-e[y],c=e[T]-e[b],d=C*(s*(h=e[S]-e[E])-l*c),f=C*(l*u-a*h),p=C*(a*c-s*u),d/=m=0===(m=Math.sqrt(d*d+f*f+p*p))?1:m,f/=m,p/=m,A&&i&&(i.facetNormals[o].x=d,i.facetNormals[o].y=f,i.facetNormals[o].z=p),P&&i&&(i.facetPositions[o].x=(e[g]+e[y]+e[x])/3,i.facetPositions[o].y=(e[_]+e[b]+e[T])/3,i.facetPositions[o].z=(e[v]+e[E]+e[S])/3),M&&i&&(B=Math.floor((i.facetPositions[o].x-i.bInfo.minimum.x*w)*D),U=Math.floor((i.facetPositions[o].y-i.bInfo.minimum.y*w)*L),k=Math.floor((i.facetPositions[o].z-i.bInfo.minimum.z*w)*F),V=Math.floor((e[g]-i.bInfo.minimum.x*w)*D),G=Math.floor((e[_]-i.bInfo.minimum.y*w)*L),z=Math.floor((e[v]-i.bInfo.minimum.z*w)*F),j=Math.floor((e[y]-i.bInfo.minimum.x*w)*D),H=Math.floor((e[b]-i.bInfo.minimum.y*w)*L),W=Math.floor((e[E]-i.bInfo.minimum.z*w)*F),X=Math.floor((e[x]-i.bInfo.minimum.x*w)*D),Y=Math.floor((e[T]-i.bInfo.minimum.y*w)*L),K=Math.floor((e[S]-i.bInfo.minimum.z*w)*F),Q=V+i.subDiv.max*G+N*z,Z=j+i.subDiv.max*H+N*W,J=X+i.subDiv.max*Y+N*K,q=B+i.subDiv.max*U+N*k,i.facetPartitioning[q]=i.facetPartitioning[q]?i.facetPartitioning[q]:new Array,i.facetPartitioning[Q]=i.facetPartitioning[Q]?i.facetPartitioning[Q]:new Array,i.facetPartitioning[Z]=i.facetPartitioning[Z]?i.facetPartitioning[Z]:new Array,i.facetPartitioning[J]=i.facetPartitioning[J]?i.facetPartitioning[J]:new Array,i.facetPartitioning[Q].push(o),Z!=Q&&i.facetPartitioning[Z].push(o),J!=Z&&J!=Q&&i.facetPartitioning[J].push(o),q!=Q&&q!=Z&&q!=J&&i.facetPartitioning[q].push(o)),R&&i&&i.facetPositions){var te=I[o];te.ind=3*o,te.sqDistance=r.x.DistanceSquared(i.facetPositions[o],O)}n[g]+=d,n[_]+=f,n[v]+=p,n[y]+=d,n[b]+=f,n[E]+=p,n[x]+=d,n[T]+=f,n[S]+=p}for(o=0;o<n.length/3;o++)d=n[3*o],f=n[3*o+1],p=n[3*o+2],d/=m=0===(m=Math.sqrt(d*d+f*f+p*p))?1:m,f/=m,p/=m,n[3*o]=d,n[3*o+1]=f,n[3*o+2]=p},e._ComputeSides=function(t,n,i,o,a,s,l){var u,c,h=i.length,d=o.length;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:var f;for(u=0;u<h;u+=3)f=i[u],i[u]=i[u+2],i[u+2]=f;for(c=0;c<d;c++)o[c]=-o[c];break;case e.DOUBLESIDE:for(var p=n.length,m=p/3,g=0;g<p;g++)n[p+g]=n[g];for(u=0;u<h;u+=3)i[u+h]=i[u+2]+m,i[u+1+h]=i[u+1]+m,i[u+2+h]=i[u]+m;for(c=0;c<d;c++)o[d+c]=-o[c];var _=a.length,v=0;for(v=0;v<_;v++)a[v+_]=a[v];for(s=s||new r.y(0,0,1,1),l=l||new r.y(0,0,1,1),v=0,u=0;u<_/2;u++)a[v]=s.x+(s.z-s.x)*a[v],a[v+1]=s.y+(s.w-s.y)*a[v+1],a[v+_]=l.x+(l.z-l.x)*a[v+_],a[v+_+1]=l.y+(l.w-l.y)*a[v+_+1],v+=2}},e.ImportVertexData=function(t,n){var o=new e,a=t.positions;a&&o.set(a,i.b.PositionKind);var s=t.normals;s&&o.set(s,i.b.NormalKind);var l=t.tangents;l&&o.set(l,i.b.TangentKind);var u=t.uvs;u&&o.set(u,i.b.UVKind);var c=t.uv2s;c&&o.set(c,i.b.UV2Kind);var h=t.uv3s;h&&o.set(h,i.b.UV3Kind);var d=t.uv4s;d&&o.set(d,i.b.UV4Kind);var f=t.uv5s;f&&o.set(f,i.b.UV5Kind);var p=t.uv6s;p&&o.set(p,i.b.UV6Kind);var m=t.colors;m&&o.set(r.f.CheckColors4(m,a.length/3),i.b.ColorKind);var g=t.matricesIndices;g&&o.set(g,i.b.MatricesIndicesKind);var _=t.matricesWeights;_&&o.set(_,i.b.MatricesWeightsKind);var v=t.indices;v&&(o.indices=v),n.setAllVerticesData(o,t.updatable)},e.FRONTSIDE=0,e.BACKSIDE=1,e.DOUBLESIDE=2,e.DEFAULTSIDE=0,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n(1),i=function(){function e(){}return e.NAME_EFFECTLAYER="EffectLayer",e.NAME_LAYER="Layer",e.NAME_LENSFLARESYSTEM="LensFlareSystem",e.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",e.NAME_PARTICLESYSTEM="ParticleSystem",e.NAME_GAMEPAD="Gamepad",e.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",e.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",e.NAME_DEPTHRENDERER="DepthRenderer",e.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",e.NAME_SPRITE="Sprite",e.NAME_OUTLINERENDERER="Outline",e.NAME_PROCEDURALTEXTURE="ProceduralTexture",e.NAME_SHADOWGENERATOR="ShadowGenerator",e.NAME_OCTREE="Octree",e.NAME_PHYSICSENGINE="PhysicsEngine",e.NAME_AUDIO="Audio",e.STEP_ISREADYFORMESH_EFFECTLAYER=0,e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,e.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,e.STEP_BEFORECAMERADRAW_LAYER=1,e.STEP_BEFORERENDERTARGETDRAW_LAYER=0,e.STEP_BEFORERENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGMESH_OUTLINE=0,e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,e.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,e.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,e.STEP_AFTERRENDERTARGETDRAW_LAYER=0,e.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,e.STEP_AFTERCAMERADRAW_LAYER=3,e.STEP_AFTERRENDER_AUDIO=0,e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=0,e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=2,e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,e.STEP_POINTERMOVE_SPRITE=0,e.STEP_POINTERDOWN_SPRITE=0,e.STEP_POINTERUP_SPRITE=0,e}(),o=function(e){function t(t){return e.apply(this,t)||this}return r.d(t,e),t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,t,n){var r=0;for(Number.MAX_VALUE;r<this.length&&!(e<this[r].index);r++);this.splice(r,0,{index:e,component:t,action:n.bind(t)})},t.prototype.clear=function(){this.length=0},t}(Array)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(6),i=n(16),o=n(0),a=n(23),s=n(4),l=n(38),u=function(){function e(){}return e.BindEyePosition=function(e,t){if(t._forcedViewPosition)e.setVector3("vEyePosition",t._forcedViewPosition);else{var n=t.activeCamera.globalPosition;n||(n=t.activeCamera.devicePosition),e.setVector3("vEyePosition",t._mirroredCameraPosition?t._mirroredCameraPosition:n)}},e.PrepareDefinesForMergedUV=function(e,t,n){t._needUVs=!0,t[n]=!0,e.getTextureMatrix().isIdentityAs3x2()?(t[n+"DIRECTUV"]=e.coordinatesIndex+1,0===e.coordinatesIndex?t.MAINUV1=!0:t.MAINUV2=!0):t[n+"DIRECTUV"]=0},e.BindTextureMatrix=function(e,t,n){var r=e.getTextureMatrix();r.isIdentityAs3x2()||t.updateMatrix(n+"Matrix",r)},e.PrepareDefinesForMisc=function(e,t,n,r,o,a,s){s._areMiscDirty&&(s.LOGARITHMICDEPTH=n,s.POINTSIZE=r,s.FOG=t.fogEnabled&&e.applyFog&&t.fogMode!==i.a.FOGMODE_NONE&&o,s.NONUNIFORMSCALING=e.nonUniformScaling,s.ALPHATEST=a)},e.PrepareDefinesForFrameBoundValues=function(e,t,n,r,i){void 0===i&&(i=null);var o,a,s,l,u=!1;o=null==i?void 0!==e.clipPlane&&null!==e.clipPlane:i,a=null==i?void 0!==e.clipPlane2&&null!==e.clipPlane2:i,s=null==i?void 0!==e.clipPlane3&&null!==e.clipPlane3:i,l=null==i?void 0!==e.clipPlane4&&null!==e.clipPlane4:i,n.CLIPPLANE!==o&&(n.CLIPPLANE=o,u=!0),n.CLIPPLANE2!==a&&(n.CLIPPLANE2=a,u=!0),n.CLIPPLANE3!==s&&(n.CLIPPLANE3=s,u=!0),n.CLIPPLANE4!==l&&(n.CLIPPLANE4=l,u=!0),n.DEPTHPREPASS!==!t.getColorWrite()&&(n.DEPTHPREPASS=!n.DEPTHPREPASS,u=!0),n.INSTANCES!==r&&(n.INSTANCES=r,u=!0),u&&n.markAsUnprocessed()},e.PrepareDefinesForAttributes=function(e,t,n,r,i,o){if(void 0===i&&(i=!1),void 0===o&&(o=!0),!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;if(t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(s.b.NormalKind),t._needNormals&&e.isVerticesDataPresent(s.b.TangentKind)&&(t.TANGENT=!0),t._needUVs?(t.UV1=e.isVerticesDataPresent(s.b.UVKind),t.UV2=e.isVerticesDataPresent(s.b.UV2Kind)):(t.UV1=!1,t.UV2=!1),n){var a=e.useVertexColors&&e.isVerticesDataPresent(s.b.ColorKind);t.VERTEXCOLOR=a,t.VERTEXALPHA=e.hasVertexAlpha&&a&&o}if(r)if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var l=void 0!==t.BONETEXTURE;e.skeleton.isUsingTextureForMatrices&&l?t.BONETEXTURE=!0:(t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!l&&void 0)}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0;if(i){var u=e.morphTargetManager;u?(t.MORPHTARGETS_TANGENT=u.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=u.supportsNormals&&t.NORMAL,t.MORPHTARGETS=u.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=u.numInfluencers):(t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}return!0},e.PrepareDefinesForMultiview=function(e,t){if(e.activeCamera){var n=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=n&&t.markAsUnprocessed()}},e.PrepareDefinesForLights=function(e,t,n,r,i,o){if(void 0===i&&(i=4),void 0===o&&(o=!1),!n._areLightsDirty)return n._needNormals;var a=0,s=!1,u=!1,c=!1,h=!1,d=!1;if(e.lightsEnabled&&!o)for(var f=0,p=t.lightSources;f<p.length;f++){var m=p[f];switch(s=!0,void 0===n["LIGHT"+a]&&(u=!0),n["LIGHT"+a]=!0,n["SPOTLIGHT"+a]=!1,n["HEMILIGHT"+a]=!1,n["POINTLIGHT"+a]=!1,n["DIRLIGHT"+a]=!1,m.prepareLightSpecificDefines(n,a),n["LIGHT_FALLOFF_PHYSICAL"+a]=!1,n["LIGHT_FALLOFF_GLTF"+a]=!1,n["LIGHT_FALLOFF_STANDARD"+a]=!1,m.falloffType){case l.a.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+a]=!0;break;case l.a.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+a]=!0;break;case l.a.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+a]=!0}if(r&&!m.specular.equalsFloats(0,0,0)&&(d=!0),n["SHADOW"+a]=!1,n["SHADOWPCF"+a]=!1,n["SHADOWPCSS"+a]=!1,n["SHADOWPOISSON"+a]=!1,n["SHADOWESM"+a]=!1,n["SHADOWCUBE"+a]=!1,n["SHADOWLOWQUALITY"+a]=!1,n["SHADOWMEDIUMQUALITY"+a]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&m.shadowEnabled){var g=m.getShadowGenerator();if(g){var _=g.getShadowMap();_&&_.renderList&&_.renderList.length>0&&(h=!0,g.prepareDefines(n,a))}}if(m.lightmapMode!=l.a.LIGHTMAP_DEFAULT?(c=!0,n["LIGHTMAPEXCLUDED"+a]=!0,n["LIGHTMAPNOSPECULAR"+a]=m.lightmapMode==l.a.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+a]=!1,n["LIGHTMAPNOSPECULAR"+a]=!1),++a===i)break}n.SPECULARTERM=d,n.SHADOWS=h;for(var v=a;v<i;v++)void 0!==n["LIGHT"+v]&&(n["LIGHT"+v]=!1,n["HEMILIGHT"+v]=!1,n["POINTLIGHT"+v]=!1,n["DIRLIGHT"+v]=!1,n["SPOTLIGHT"+v]=!1,n["SHADOW"+v]=!1,n["SHADOWPCF"+v]=!1,n["SHADOWPCSS"+v]=!1,n["SHADOWPOISSON"+v]=!1,n["SHADOWESM"+v]=!1,n["SHADOWCUBE"+v]=!1,n["SHADOWLOWQUALITY"+v]=!1,n["SHADOWMEDIUMQUALITY"+v]=!1);var y=e.getEngine().getCaps();return void 0===n.SHADOWFLOAT&&(u=!0),n.SHADOWFLOAT=h&&(y.textureFloatRender&&y.textureFloatLinearFiltering||y.textureHalfFloatRender&&y.textureHalfFloatLinearFiltering),n.LIGHTMAPEXCLUDED=c,u&&n.rebuild(),s},e.PrepareUniformsAndSamplersList=function(e,t,n,r){var i;void 0===r&&(r=4);var o=null;if(e.uniformsNames){var a=e;i=a.uniformsNames,o=a.uniformBuffersNames,t=a.samplers,n=a.defines,r=a.maxSimultaneousLights}else i=e,t||(t=[]);for(var s=0;s<r&&n["LIGHT"+s];s++)i.push("vLightData"+s,"vLightDiffuse"+s,"vLightSpecular"+s,"vLightDirection"+s,"vLightFalloff"+s,"vLightGround"+s,"lightMatrix"+s,"shadowsInfo"+s,"depthValues"+s),o&&o.push("Light"+s),t.push("shadowSampler"+s),t.push("depthSampler"+s),n["PROJECTEDLIGHTTEXTURE"+s]&&(t.push("projectionLightSampler"+s),i.push("textureProjectionMatrix"+s));n.NUM_MORPH_INFLUENCERS&&i.push("morphTargetInfluences")},e.HandleFallbacksForShadows=function(e,t,n,r){void 0===n&&(n=4),void 0===r&&(r=0);for(var i=0,o=0;o<n&&e["LIGHT"+o];o++)o>0&&(i=r+o,t.addFallback(i,"LIGHT"+o)),e.SHADOWS||(e["SHADOW"+o]&&t.addFallback(r,"SHADOW"+o),e["SHADOWPCF"+o]&&t.addFallback(r,"SHADOWPCF"+o),e["SHADOWPCSS"+o]&&t.addFallback(r,"SHADOWPCSS"+o),e["SHADOWPOISSON"+o]&&t.addFallback(r,"SHADOWPOISSON"+o),e["SHADOWESM"+o]&&t.addFallback(r,"SHADOWESM"+o));return i++},e.PrepareAttributesForMorphTargets=function(e,t,n){var i=n.NUM_MORPH_INFLUENCERS;if(i>0&&a.a.LastCreatedEngine)for(var o=a.a.LastCreatedEngine.getCaps().maxVertexAttribs,l=t.morphTargetManager,u=l&&l.supportsNormals&&n.NORMAL,c=l&&l.supportsTangents&&n.TANGENT,h=0;h<i;h++)e.push(s.b.PositionKind+h),u&&e.push(s.b.NormalKind+h),c&&e.push(s.b.TangentKind+h),e.length>o&&r.a.Error("Cannot add more vertex attributes for mesh "+t.name)},e.PrepareAttributesForBones=function(e,t,n,r){n.NUM_BONE_INFLUENCERS>0&&(r.addCPUSkinningFallback(0,t),e.push(s.b.MatricesIndicesKind),e.push(s.b.MatricesWeightsKind),n.NUM_BONE_INFLUENCERS>4&&(e.push(s.b.MatricesIndicesExtraKind),e.push(s.b.MatricesWeightsExtraKind)))},e.PrepareAttributesForInstances=function(e,t){t.INSTANCES&&(e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"))},e.BindLightShadow=function(e,t,n,r){if(e.shadowEnabled&&t.receiveShadows){var i=e.getShadowGenerator();i&&i.bindShadowLight(n,r)}},e.BindLightProperties=function(e,t,n){e.transferToEffect(t,n+"")},e.BindLights=function(t,n,r,i,a,s){void 0===a&&(a=4),void 0===s&&(s=!1);for(var l=Math.min(n.lightSources.length,a),u=0;u<l;u++){var c=n.lightSources[u],h=u.toString(),d=c.getScaledIntensity();c._uniformBuffer.bindToEffect(r,"Light"+u),e.BindLightProperties(c,r,u),c.diffuse.scaleToRef(d,o.t.Color3[0]),c._uniformBuffer.updateColor4("vLightDiffuse",o.t.Color3[0],s?c.radius:c.range,h),i.SPECULARTERM&&(c.specular.scaleToRef(d,o.t.Color3[1]),c._uniformBuffer.updateColor3("vLightSpecular",o.t.Color3[1],h)),t.shadowsEnabled&&this.BindLightShadow(c,n,h,r),c._uniformBuffer.update()}},e.BindFogParameters=function(e,t,n,r){void 0===r&&(r=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==i.a.FOGMODE_NONE&&(n.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),r?(e.fogColor.toLinearSpaceToRef(this._tempFogColor),n.setColor3("vFogColor",this._tempFogColor)):n.setColor3("vFogColor",e.fogColor))},e.BindBonesParameters=function(e,t){if(t&&e&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){var n=e.skeleton;if(n.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){var r=n.getTransformMatrixTexture();t.setTexture("boneSampler",r),t.setFloat("boneTextureWidth",4*(n.bones.length+1))}else{var i=n.getTransformMatrices(e);i&&t.setMatrices("mBones",i)}}},e.BindMorphTargetParameters=function(e,t){var n=e.morphTargetManager;e&&n&&t.setFloatArray("morphTargetInfluences",n.influences)},e.BindLogDepth=function(e,t,n){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(n.activeCamera.maxZ+1)/Math.LN2))},e.BindClipPlane=function(e,t){if(t.clipPlane){var n=t.clipPlane;e.setFloat4("vClipPlane",n.normal.x,n.normal.y,n.normal.z,n.d)}t.clipPlane2&&(n=t.clipPlane2,e.setFloat4("vClipPlane2",n.normal.x,n.normal.y,n.normal.z,n.d)),t.clipPlane3&&(n=t.clipPlane3,e.setFloat4("vClipPlane3",n.normal.x,n.normal.y,n.normal.z,n.d)),t.clipPlane4&&(n=t.clipPlane4,e.setFloat4("vClipPlane4",n.normal.x,n.normal.y,n.normal.z,n.d))},e._tempFogColor=o.e.Black(),e}()},function(e,t,n){"use strict";var r=n(1),i=n(9),o=n(47),a=n(8),s=n(28),l=n(61),u=n(29),c=n(0),h=n(42),d=n(24),f=n(21),p=n(30),m=n(31),g=n(63),_=n(38),v=n(50),y=n(36),b=n(83),E=n(91),x=n(14),T=n(3),S=n(35),A=n(6),P=n(23),M=n(19),R=n(17),C=n(79),w=n(51),O=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),e}(),I=function(){function e(e){this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new c.w(0,0),this._previousStartingPointerPosition=new c.w(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._scene=e}return Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return new c.w(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!0,configurable:!0}),e.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getRenderingCanvasClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},e.prototype._processPointerMove=function(e,t){var n=this._scene,r=n.getEngine().getRenderingCanvas();if(r){r.tabIndex=1,r.style.cursor=n.defaultCursor;var i=!!(e&&e.hit&&e.pickedMesh);i?(n.setPointerOverMesh(e.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(this._pointerOverMesh.actionManager.hoverCursor?r.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:r.style.cursor=n.hoverCursor)):n.setPointerOverMesh(null);for(var o=0,a=n._pointerMoveStage;o<a.length;o++)e=a[o].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,i,r);if(e){var s=t.type===this._wheelEventName?R.a.POINTERWHEEL:R.a.POINTERMOVE;if(n.onPointerMove&&n.onPointerMove(t,e,s),n.onPointerObservable.hasObservers()){var l=new R.b(s,t,e);this._setRayOnPointerInfo(l),n.onPointerObservable.notifyObservers(l,s)}}}},e.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,c.j.Identity(),t.activeCamera)))},e.prototype._checkPrePointerObservable=function(e,t,n){var r=this._scene,i=new R.d(n,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(i.ray=e.ray),r.onPrePointerObservable.notifyObservers(i,n),!!i.skipOnPointerObservable},e.prototype.simulatePointerMove=function(e,t){var n=new PointerEvent("pointermove",t);this._checkPrePointerObservable(e,n,R.a.POINTERMOVE)||this._processPointerMove(e,n)},e.prototype.simulatePointerDown=function(e,t){var n=new PointerEvent("pointerdown",t);this._checkPrePointerObservable(e,n,R.a.POINTERDOWN)||this._processPointerDown(e,n)},e.prototype._processPointerDown=function(t,n){var r=this,i=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh.actionManager;if(o){if(o.hasPickTriggers)switch(o.processTrigger(T.a.ACTION_OnPickDownTrigger,y.a.CreateNew(t.pickedMesh,n)),n.button){case 0:o.processTrigger(T.a.ACTION_OnLeftPickTrigger,y.a.CreateNew(t.pickedMesh,n));break;case 1:o.processTrigger(T.a.ACTION_OnCenterPickTrigger,y.a.CreateNew(t.pickedMesh,n));break;case 2:o.processTrigger(T.a.ACTION_OnRightPickTrigger,y.a.CreateNew(t.pickedMesh,n))}o.hasSpecificTrigger(T.a.ACTION_OnLongPressTrigger)&&window.setTimeout(function(){var t=i.pick(r._unTranslatedPointerX,r._unTranslatedPointerY,function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(T.a.ACTION_OnLongPressTrigger)&&e==r._pickedDownMesh},!1,i.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&o&&0!==r._totalPointersPressed&&Date.now()-r._startingPointerTime>e.LongPressDelay&&!r._isPointerSwiping()&&(r._startingPointerTime=0,o.processTrigger(T.a.ACTION_OnLongPressTrigger,y.a.CreateNew(t.pickedMesh,n)))},e.LongPressDelay)}}else for(var a=0,s=i._pointerDownStage;a<s.length;a++)t=s[a].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,n);if(t){var l=R.a.POINTERDOWN;if(i.onPointerDown&&i.onPointerDown(n,t,l),i.onPointerObservable.hasObservers()){var u=new R.b(l,n,t);this._setRayOnPointerInfo(u),i.onPointerObservable.notifyObservers(u,l)}}},e.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold},e.prototype.simulatePointerUp=function(e,t,n){var r=new PointerEvent("pointerup",t),i=new O;n?i.doubleClick=!0:i.singleClick=!0,this._checkPrePointerObservable(e,r,R.a.POINTERUP)||this._processPointerUp(e,r,i)},e.prototype._processPointerUp=function(e,t,n){var r=this._scene;if(e&&e&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(r.onPointerPick&&r.onPointerPick(t,e),n.singleClick&&!n.ignore&&r.onPointerObservable.hasObservers())){var i=R.a.POINTERPICK,o=new R.b(i,t,e);this._setRayOnPointerInfo(o),r.onPointerObservable.notifyObservers(o,i)}var a=e.pickedMesh._getActionManagerForTrigger();if(a&&!n.ignore){a.processTrigger(T.a.ACTION_OnPickUpTrigger,y.a.CreateNew(e.pickedMesh,t)),!n.hasSwiped&&n.singleClick&&a.processTrigger(T.a.ACTION_OnPickTrigger,y.a.CreateNew(e.pickedMesh,t));var s=e.pickedMesh._getActionManagerForTrigger(T.a.ACTION_OnDoublePickTrigger);n.doubleClick&&s&&s.processTrigger(T.a.ACTION_OnDoublePickTrigger,y.a.CreateNew(e.pickedMesh,t))}}else if(!n.ignore)for(var l=0,u=r._pointerUpStage;l<u.length;l++)e=u[l].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var c=this._pickedDownMesh._getActionManagerForTrigger(T.a.ACTION_OnPickOutTrigger);c&&c.processTrigger(T.a.ACTION_OnPickOutTrigger,y.a.CreateNew(this._pickedDownMesh,t))}var h=0;r.onPointerObservable.hasObservers()&&(n.ignore||n.hasSwiped||(n.singleClick&&r.onPointerObservable.hasSpecificMask(R.a.POINTERTAP)?h=R.a.POINTERTAP:n.doubleClick&&r.onPointerObservable.hasSpecificMask(R.a.POINTERDOUBLETAP)&&(h=R.a.POINTERDOUBLETAP),!h)||(o=new R.b(h,t,e),this._setRayOnPointerInfo(o),r.onPointerObservable.notifyObservers(o,h)),n.ignore||(h=R.a.POINTERUP,o=new R.b(h,t,e),this._setRayOnPointerInfo(o),r.onPointerObservable.notifyObservers(o,h))),r.onPointerUp&&!n.ignore&&r.onPointerUp(t,e,h)},e.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},e.prototype.attachControl=function(t,n,r){var o=this;void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===r&&(r=!0);var a=this._scene,s=a.getEngine().getRenderingCanvas();if(s){var l=a.getEngine();this._initActionManager=function(e,t){if(!o._meshPickProceed){var n=a.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers);o._currentPickResult=n,n&&(e=n.hit&&n.pickedMesh?n.pickedMesh._getActionManagerForTrigger():null),o._meshPickProceed=!0}return e},this._delayedSimpleClick=function(t,n,r){(Date.now()-o._previousStartingPointerTime>e.DoubleClickDelay&&!o._doubleClickOccured||t!==o._previousButtonPressed)&&(o._doubleClickOccured=!1,n.singleClick=!0,n.ignore=!1,r(n,o._currentPickResult))},this._initClickEvent=function(t,n,r,i){var a=new O;o._currentPickResult=null;var s=null,l=t.hasSpecificMask(R.a.POINTERPICK)||n.hasSpecificMask(R.a.POINTERPICK)||t.hasSpecificMask(R.a.POINTERTAP)||n.hasSpecificMask(R.a.POINTERTAP)||t.hasSpecificMask(R.a.POINTERDOUBLETAP)||n.hasSpecificMask(R.a.POINTERDOUBLETAP);!l&&C.a&&(s=o._initActionManager(s,a))&&(l=s.hasPickTriggers);var u=!1;if(l){var c=r.button;if(a.hasSwiped=o._isPointerSwiping(),!a.hasSwiped){var h=!e.ExclusiveDoubleClickMode;h||(h=!t.hasSpecificMask(R.a.POINTERDOUBLETAP)&&!n.hasSpecificMask(R.a.POINTERDOUBLETAP))&&!C.a.HasSpecificTrigger(T.a.ACTION_OnDoublePickTrigger)&&(s=o._initActionManager(s,a))&&(h=!s.hasSpecificTrigger(T.a.ACTION_OnDoublePickTrigger)),h?(Date.now()-o._previousStartingPointerTime>e.DoubleClickDelay||c!==o._previousButtonPressed)&&(a.singleClick=!0,i(a,o._currentPickResult),u=!0):(o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,o._delayedSimpleClickTimeout=window.setTimeout(o._delayedSimpleClick.bind(o,c,a,i),e.DoubleClickDelay));var d=t.hasSpecificMask(R.a.POINTERDOUBLETAP)||n.hasSpecificMask(R.a.POINTERDOUBLETAP);!d&&C.a.HasSpecificTrigger(T.a.ACTION_OnDoublePickTrigger)&&(s=o._initActionManager(s,a))&&(d=s.hasSpecificTrigger(T.a.ACTION_OnDoublePickTrigger)),d&&(c===o._previousButtonPressed&&Date.now()-o._previousStartingPointerTime<e.DoubleClickDelay&&!o._doubleClickOccured?(a.hasSwiped||o._isPointerSwiping()?(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=c,e.ExclusiveDoubleClickMode?(o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,i(a,o._previousPickResult)):i(a,o._currentPickResult)):(o._previousStartingPointerTime=0,o._doubleClickOccured=!0,a.doubleClick=!0,a.ignore=!1,e.ExclusiveDoubleClickMode&&o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,i(a,o._currentPickResult)),u=!0):(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=c))}}u||i(a,o._currentPickResult)},this._onPointerMove=function(e){if(o._updatePointerPosition(e),!o._checkPrePointerObservable(null,e,e.type===o._wheelEventName?R.a.POINTERWHEEL:R.a.POINTERMOVE)&&(a.cameraToUseForPointers||a.activeCamera)){a.pointerMovePredicate||(a.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||a.constantlyUpdateMeshUnderPointer||null!==e.actionManager&&void 0!==e.actionManager)&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))});var t=a.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,a.pointerMovePredicate,!1,a.cameraToUseForPointers);o._processPointerMove(t,e)}},this._onPointerDown=function(e){if(o._totalPointersPressed++,o._pickedDownMesh=null,o._meshPickProceed=!1,o._updatePointerPosition(e),a.preventDefaultOnPointerDown&&s&&(e.preventDefault(),s.focus()),o._startingPointerPosition.x=o._pointerX,o._startingPointerPosition.y=o._pointerY,o._startingPointerTime=Date.now(),!o._checkPrePointerObservable(null,e,R.a.POINTERDOWN)&&(a.cameraToUseForPointers||a.activeCamera)){o._pointerCaptures[e.pointerId]=!0,a.pointerDownPredicate||(a.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),o._pickedDownMesh=null;var t=a.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers);o._processPointerDown(t,e)}},this._onPointerUp=function(e){0!==o._totalPointersPressed&&(o._totalPointersPressed--,o._pickedUpMesh=null,o._meshPickProceed=!1,o._updatePointerPosition(e),a.preventDefaultOnPointerUp&&s&&(e.preventDefault(),s.focus()),o._initClickEvent(a.onPrePointerObservable,a.onPointerObservable,e,function(t,n){if(a.onPrePointerObservable.hasObservers()&&!t.ignore){if(!t.hasSwiped){if(t.singleClick&&a.onPrePointerObservable.hasSpecificMask(R.a.POINTERTAP)&&o._checkPrePointerObservable(null,e,R.a.POINTERTAP))return;if(t.doubleClick&&a.onPrePointerObservable.hasSpecificMask(R.a.POINTERDOUBLETAP)&&o._checkPrePointerObservable(null,e,R.a.POINTERDOUBLETAP))return}if(o._checkPrePointerObservable(null,e,R.a.POINTERUP))return}o._pointerCaptures[e.pointerId]&&(o._pointerCaptures[e.pointerId]=!1,(a.cameraToUseForPointers||a.activeCamera)&&(a.pointerUpPredicate||(a.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!a.cameraToUseForPointers||0!=(a.cameraToUseForPointers.layerMask&e.layerMask))}),!o._meshPickProceed&&(C.a&&C.a.HasTriggers||a.onPointerObservable.hasObservers())&&o._initActionManager(null,t),n||(n=o._currentPickResult),o._processPointerUp(n,e,t),o._previousPickResult=o._currentPickResult))}))},this._onKeyDown=function(e){var t=w.a.KEYDOWN;if(a.onPreKeyboardObservable.hasObservers()){var n=new w.c(t,e);if(a.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnPointerObservable)return}a.onKeyboardObservable.hasObservers()&&(n=new w.b(t,e),a.onKeyboardObservable.notifyObservers(n,t)),a.actionManager&&a.actionManager.processTrigger(T.a.ACTION_OnKeyDownTrigger,y.a.CreateNewFromScene(a,e))},this._onKeyUp=function(e){var t=w.a.KEYUP;if(a.onPreKeyboardObservable.hasObservers()){var n=new w.c(t,e);if(a.onPreKeyboardObservable.notifyObservers(n,t),n.skipOnPointerObservable)return}a.onKeyboardObservable.hasObservers()&&(n=new w.b(t,e),a.onKeyboardObservable.notifyObservers(n,t)),a.actionManager&&a.actionManager.processTrigger(T.a.ACTION_OnKeyUpTrigger,y.a.CreateNewFromScene(a,e))},this._onCanvasFocusObserver=l.onCanvasFocusObservable.add(function(){s&&(s.addEventListener("keydown",o._onKeyDown,!1),s.addEventListener("keyup",o._onKeyUp,!1))}),this._onCanvasBlurObserver=l.onCanvasBlurObservable.add(function(){s&&(s.removeEventListener("keydown",o._onKeyDown),s.removeEventListener("keyup",o._onKeyUp))});var u=i.h.GetPointerPrefix();r&&(s.addEventListener(u+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",s.addEventListener(this._wheelEventName,this._onPointerMove,!1)),n&&s.addEventListener(u+"down",this._onPointerDown,!1),t&&window.addEventListener(u+"up",this._onPointerUp,!1)}},e.prototype.detachControl=function(){var e=i.h.GetPointerPrefix(),t=this._scene.getEngine().getRenderingCanvas(),n=this._scene.getEngine();t&&(t.removeEventListener(e+"move",this._onPointerMove),t.removeEventListener(e+"down",this._onPointerDown),window.removeEventListener(e+"up",this._onPointerUp),this._onCanvasBlurObserver&&n.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&n.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),t.removeEventListener("keydown",this._onKeyDown),t.removeEventListener("keyup",this._onKeyUp),t.style.cursor=this._scene.defaultCursor)},e.prototype.setPointerOverMesh=function(e){var t;this._pointerOverMesh!==e&&(this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(T.a.ACTION_OnPointerOutTrigger))&&t.processTrigger(T.a.ACTION_OnPointerOutTrigger,y.a.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=e,this._pointerOverMesh&&(t=this._pointerOverMesh._getActionManagerForTrigger(T.a.ACTION_OnPointerOverTrigger))&&t.processTrigger(T.a.ACTION_OnPointerOverTrigger,y.a.CreateNew(this._pointerOverMesh)))},e.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},e.DragMovementThreshold=10,e.LongPressDelay=500,e.DoubleClickDelay=300,e.ExclusiveDoubleClickMode=!1,e}();n.d(t,"a",function(){return D});var D=function(e){function t(n,r){var o=e.call(this)||this;return o._inputManager=new I(o),o.cameraToUseForPointers=null,o._isScene=!0,o.autoClear=!0,o.autoClearDepthAndStencil=!0,o.clearColor=new c.f(.2,.2,.3,1),o.ambientColor=new c.e(0,0,0),o._forceWireframe=!1,o._forcePointsCloud=!1,o.animationsEnabled=!0,o._animationPropertiesOverride=null,o.useConstantAnimationDeltaTime=!1,o.constantlyUpdateMeshUnderPointer=!1,o.hoverCursor="pointer",o.defaultCursor="",o.preventDefaultOnPointerDown=!0,o.preventDefaultOnPointerUp=!0,o.metadata=null,o.reservedDataStore=null,o.disableOfflineSupportExceptionRules=new Array,o.onDisposeObservable=new a.c,o._onDisposeObserver=null,o.onBeforeRenderObservable=new a.c,o._onBeforeRenderObserver=null,o.onAfterRenderObservable=new a.c,o._onAfterRenderObserver=null,o.onBeforeAnimationsObservable=new a.c,o.onAfterAnimationsObservable=new a.c,o.onBeforeDrawPhaseObservable=new a.c,o.onAfterDrawPhaseObservable=new a.c,o.onReadyObservable=new a.c,o.onBeforeCameraRenderObservable=new a.c,o._onBeforeCameraRenderObserver=null,o.onAfterCameraRenderObservable=new a.c,o._onAfterCameraRenderObserver=null,o.onBeforeActiveMeshesEvaluationObservable=new a.c,o.onAfterActiveMeshesEvaluationObservable=new a.c,o.onBeforeParticlesRenderingObservable=new a.c,o.onAfterParticlesRenderingObservable=new a.c,o.onDataLoadedObservable=new a.c,o.onNewCameraAddedObservable=new a.c,o.onCameraRemovedObservable=new a.c,o.onNewLightAddedObservable=new a.c,o.onLightRemovedObservable=new a.c,o.onNewGeometryAddedObservable=new a.c,o.onGeometryRemovedObservable=new a.c,o.onNewTransformNodeAddedObservable=new a.c,o.onTransformNodeRemovedObservable=new a.c,o.onNewMeshAddedObservable=new a.c,o.onMeshRemovedObservable=new a.c,o.onNewSkeletonAddedObservable=new a.c,o.onSkeletonRemovedObservable=new a.c,o.onNewMaterialAddedObservable=new a.c,o.onMaterialRemovedObservable=new a.c,o.onNewTextureAddedObservable=new a.c,o.onTextureRemovedObservable=new a.c,o.onBeforeRenderTargetsRenderObservable=new a.c,o.onAfterRenderTargetsRenderObservable=new a.c,o.onBeforeStepObservable=new a.c,o.onAfterStepObservable=new a.c,o.onActiveCameraChanged=new a.c,o.onBeforeRenderingGroupObservable=new a.c,o.onAfterRenderingGroupObservable=new a.c,o.onMeshImportedObservable=new a.c,o._registeredForLateAnimationBindings=new s.b(256),o.onPrePointerObservable=new a.c,o.onPointerObservable=new a.c,o.onPreKeyboardObservable=new a.c,o.onKeyboardObservable=new a.c,o._useRightHandedSystem=!1,o._timeAccumulator=0,o._currentStepId=0,o._currentInternalStep=0,o._fogEnabled=!0,o._fogMode=t.FOGMODE_NONE,o.fogColor=new c.e(.2,.2,.3),o.fogDensity=.1,o.fogStart=0,o.fogEnd=1e3,o._shadowsEnabled=!0,o._lightsEnabled=!0,o.activeCameras=new Array,o._texturesEnabled=!0,o.particlesEnabled=!0,o.spritesEnabled=!0,o._skeletonsEnabled=!0,o.lensFlaresEnabled=!0,o.collisionsEnabled=!0,o.gravity=new c.x(0,-9.807,0),o.postProcessesEnabled=!0,o.postProcesses=new Array,o.renderTargetsEnabled=!0,o.dumpNextRenderTargets=!1,o.customRenderTargets=new Array,o.importedMeshesFiles=new Array,o.probesEnabled=!0,o._meshesForIntersections=new s.b(256),o.proceduralTexturesEnabled=!0,o._totalVertices=new i.f,o._activeIndices=new i.f,o._activeParticles=new i.f,o._activeBones=new i.f,o._animationTime=0,o.animationTimeScale=1,o._renderId=0,o._frameId=0,o._executeWhenReadyTimeoutId=-1,o._intermediateRendering=!1,o._viewUpdateFlag=-1,o._projectionUpdateFlag=-1,o._toBeDisposed=new Array(256),o._activeRequests=new Array,o._pendingData=new Array,o._isDisposed=!1,o.dispatchAllSubMeshesOfActiveMeshes=!1,o._activeMeshes=new s.a(256),o._processedMaterials=new s.a(256),o._renderTargets=new s.b(256),o._activeParticleSystems=new s.a(256),o._activeSkeletons=new s.b(32),o._softwareSkinnedMeshes=new s.b(32),o._activeAnimatables=new Array,o._transformMatrix=c.j.Zero(),o.requireLightSorting=!1,o._components=[],o._serializableComponents=[],o._transientComponents=[],o._beforeCameraUpdateStage=x.b.Create(),o._beforeClearStage=x.b.Create(),o._gatherRenderTargetsStage=x.b.Create(),o._gatherActiveCameraRenderTargetsStage=x.b.Create(),o._isReadyForMeshStage=x.b.Create(),o._beforeEvaluateActiveMeshStage=x.b.Create(),o._evaluateSubMeshStage=x.b.Create(),o._activeMeshStage=x.b.Create(),o._cameraDrawRenderTargetStage=x.b.Create(),o._beforeCameraDrawStage=x.b.Create(),o._beforeRenderTargetDrawStage=x.b.Create(),o._beforeRenderingGroupDrawStage=x.b.Create(),o._beforeRenderingMeshStage=x.b.Create(),o._afterRenderingMeshStage=x.b.Create(),o._afterRenderingGroupDrawStage=x.b.Create(),o._afterCameraDrawStage=x.b.Create(),o._afterRenderTargetDrawStage=x.b.Create(),o._afterRenderStage=x.b.Create(),o._pointerMoveStage=x.b.Create(),o._pointerDownStage=x.b.Create(),o._pointerUpStage=x.b.Create(),o.geometriesByUniqueId=null,o._defaultMeshCandidates={data:[],length:0},o._defaultSubMeshCandidates={data:[],length:0},o._preventFreeActiveMeshesAndRenderingGroups=!1,o._activeMeshesFrozen=!1,o._allowPostProcessClearColor=!0,o.getDeterministicFrameTime=function(){return 1e3/60},o._blockMaterialDirtyMechanism=!1,o._engine=n||P.a.LastCreatedEngine,r&&r.virtual||(P.a._LastCreatedScene=o,o._engine.scenes.push(o)),o._uid=null,o._renderingManager=new E.b(o),b.a&&(o.postProcessManager=new b.a(o)),S.a.IsWindowObjectExist()&&o.attachControl(),o._createUbo(),m.a&&(o._imageProcessingConfiguration=new m.a),o.setDefaultCandidateProviders(),r&&!0===r.useGeometryUniqueIdsMap&&(o.geometriesByUniqueId={}),o.useMaterialMeshMap=r&&r.useGeometryUniqueIdsMap||!1,o.useClonedMeshhMap=r&&r.useClonedMeshhMap||!1,r&&r.virtual||o._engine.onNewSceneAddedObservable.notifyObservers(o),o}return r.d(t,e),t.DefaultMaterialFactory=function(e){throw M.a.WarnImport("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw M.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return I.DragMovementThreshold},set:function(e){I.DragMovementThreshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return I.LongPressDelay},set:function(e){I.LongPressDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return I.DoubleClickDelay},set:function(e){I.DoubleClickDelay=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return I.ExclusiveDoubleClickMode},set:function(e){I.ExclusiveDoubleClickMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(T.a.MATERIAL_AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,t=this._transientComponents;e<t.length;e++)t[e].register();this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var t=e;t.addFromContainer&&this._serializableComponents.push(t)},t.prototype._getComponent=function(e){for(var t=0,n=this._components;t<n.length;t++){var r=n[t];if(r.name===e)return r}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!0,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,t,n){return void 0===n&&(n=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==n},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this._sceneUbo=new g.a(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},t.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},t.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},t.prototype.simulatePointerUp=function(e,t,n){return this._inputManager.simulatePointerUp(e,t,n),this},t.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._inputManager.isPointerCaptured(e)},t.prototype.attachControl=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),this._inputManager.attachControl(e,t,n)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(){if(this._isDisposed)return!1;var e,t=this.getEngine();if(!t.areAllEffectsReady())return!1;if(this._pendingData.length>0)return!1;for(e=0;e<this.meshes.length;e++){var n=this.meshes[e];if(n.isEnabled()&&n.subMeshes&&0!==n.subMeshes.length){if(!n.isReady(!0))return!1;for(var r="InstancedMesh"===n.getClassName()||"InstancedLinesMesh"===n.getClassName()||t.getCaps().instancedArrays&&n.instances.length>0,i=0,o=this._isReadyForMeshStage;i<o.length;i++)if(!o[i].action(n,r))return!1}}for(e=0;e<this.geometries.length;e++)if(this.geometries[e].delayLoadState===T.a.DELAYLOADSTATE_LOADING)return!1;if(this.activeCameras&&this.activeCameras.length>0){for(var a=0,s=this.activeCameras;a<s.length;a++)if(!s[a].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var l=0,u=this.particleSystems;l<u.length;l++)if(!u[l].isReady())return!1;return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var t=this;this.registerBeforeRender(function n(){e(),setTimeout(function(){t.unregisterBeforeRender(n)})})},t.prototype.executeOnceBeforeRender=function(e,t){var n=this;void 0!==t?setTimeout(function(){n._executeOnceBeforeRender(e)},t):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this.isLoading,n=this._pendingData.indexOf(e);-1!==n&&this._pendingData.splice(n,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),t.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},t.prototype.whenReadyAsync=function(){var e=this;return new Promise(function(t){e.executeWhenReady(function(){t()})})},t.prototype._checkIsReady=function(){var e=this;if(this._registerTransientComponents(),this.isReady())return this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1);this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150)},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=o.a.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t,n,r){this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?c.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=c.i.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,r):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.getUniqueId=function(){var e=t._uniqueIdCounter;return t._uniqueIdCounter++,e},t.prototype.addMesh=function(e,t){var n=this;void 0===t&&(t=!1),this.meshes.push(e),e._resyncLightSources(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){n.addMesh(e)})},t.prototype.removeMesh=function(e,t){var n=this;void 0===t&&(t=!1);var r=this.meshes.indexOf(e);return-1!==r&&(this.meshes[r]=this.meshes[this.meshes.length-1],this.meshes.pop()),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach(function(e){n.removeMesh(e)}),r},t.prototype.addTransformNode=function(e){e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),this.onNewTransformNodeAddedObservable.notifyObservers(e)},t.prototype.removeTransformNode=function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=n,n._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t},t.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e)),t},t.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var n=0,r=this.meshes;n<r.length;n++)r[n]._removeLightSource(e);this.lights.splice(t,1),this.sortLightsByPriority()}return this.onLightRemovedObservable.notifyObservers(e),t},t.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var n=this.activeCameras.indexOf(e);return-1!==n&&this.activeCameras.splice(n,1),this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},t.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&this.particleSystems.splice(t,1),t},t.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},t.prototype.stopAnimation=function(e,t,n){},t.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},t.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),t},t.prototype.removeMaterial=function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[t]=n,n._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t},t.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},t.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},t.prototype.addLight=function(e){this.lights.push(e),this.sortLightsByPriority();for(var t=0,n=this.meshes;t<n.length;t++){var r=n[t];-1===r.lightSources.indexOf(e)&&(r.lightSources.push(e),r._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(_.a.CompareLightsPriority)},t.prototype.addCamera=function(e){this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e)},t.prototype.addSkeleton=function(e){this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e)},t.prototype.addParticleSystem=function(e){this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this.multiMaterials.push(e)},t.prototype.addMaterial=function(e){e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e)},t.prototype.addMorphTargetManager=function(e){this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e)},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e)},t.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var n=this._engine.getRenderingCanvas();n&&(this.activeCamera&&this.activeCamera.detachControl(n),this.activeCamera=e,t&&e.attachControl(n))},t.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},t.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},t.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var n=this.skeletons[t],r=0;r<n.bones.length;r++)if(n.bones[r].id===e)return n.bones[r];return null},t.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var n=this.skeletons[t],r=0;r<n.bones.length;r++)if(n.bones[r].name===e)return n.bones[r];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},t.prototype.getGeometryByID=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},t.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var t=this.geometriesByUniqueId[e];if(void 0!==t)return this.geometries[t]}else for(var n=0;n<this.geometries.length;n++)if(this.geometries[n].uniqueId===e)return this.geometries[n];return null},t.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueID(e.uniqueId))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},t.prototype.removeGeometry=function(e){var t;if(this.geometriesByUniqueId){if(void 0===(t=this.geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];this.geometries[t]=n,this.geometriesByUniqueId&&(this.geometriesByUniqueId[n.uniqueId]=t,this.geometriesByUniqueId[e.uniqueId]=void 0)}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshesByID=function(e){return this.meshes.filter(function(t){return t.id===e})},t.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},t.prototype.getTransformNodeByUniqueID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},t.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter(function(t){return t.id===e})},t.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var n=this.getTransformNodeByID(e);if(n)return n;var r=this.getLightByID(e);if(r)return r;var i=this.getCameraByID(e);if(i)return i;var o=this.getBoneByID(e);return o||null},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var n=this.getTransformNodeByName(e);if(n)return n;var r=this.getLightByName(e);if(r)return r;var i=this.getCameraByName(e);if(i)return i;var o=this.getBoneByName(e);return o||null},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},t.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},t.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var n=this.morphTargetManagers[t],r=0;r<n.numTargets;++r){var i=n.getTarget(r);if(i.id===e)return i}return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=i.h.RandomId()),this._uid},enumerable:!0,configurable:!0}),t.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new l.a),this._externalData.add(e,t)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new l.a),this._externalData.getOrAddWithFactory(e,t)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,t,n){if(n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var r=0,i=this._evaluateSubMeshStage;r<i.length;r++)i[r].action(t,e);var o=e.getMaterial();null!=o&&(o.hasRenderTargetTextures&&null!=o.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(o)&&(this._processedMaterials.push(o),this._renderTargets.concatWithNoDuplicate(o.getRenderTargetTextures())),this._activeIndices.addCount(e.indexCount,!1),this._renderingManager.dispatch(e,t,o))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!0,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(){if(!this.activeCamera)return this;this._frustumPlanes||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0;for(var e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._freeze();return this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length)for(var e=this._activeMeshes.length,t=0;t<e;t++)(a=this._activeMeshes.data[t]).computeWorldMatrix();else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var n=0,r=this._beforeEvaluateActiveMeshStage;n<r.length;n++)r[n].action();var i=this.getActiveMeshCandidates(),o=i.length;for(t=0;t<o;t++){var a;if(!(a=i.data[t]).isBlocked&&(this._totalVertices.addCount(a.getTotalVertices(),!1),a.isReady()&&a.isEnabled()&&0!==a.scaling.lengthSquared())){a.computeWorldMatrix(),a.actionManager&&a.actionManager.hasSpecificTriggers2(T.a.ACTION_OnIntersectionEnterTrigger,T.a.ACTION_OnIntersectionExitTrigger)&&this._meshesForIntersections.pushNoDuplicate(a);var s=this.customLODSelector?this.customLODSelector(a,this.activeCamera):a.getLOD(this.activeCamera);null!=s&&(s!==a&&s.billboardMode!==h.a.BILLBOARDMODE_NONE&&s.computeWorldMatrix(),a._preActivate(),a.isVisible&&a.visibility>0&&0!=(a.layerMask&this.activeCamera.layerMask)&&(a.alwaysSelectAsActiveMesh||a.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(a),this.activeCamera._activeMeshes.push(a),s!==a&&s._activate(this._renderId,!1),a._activate(this._renderId,!1)&&(a.isAnInstance||(s._internalAbstractMeshDataInfo._onlyForInstances=!1),s._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(a,s)),a._postActivate()))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var l=0;l<this.particleSystems.length;l++){var u=this.particleSystems[l];if(u.isStarted()&&u.emitter){var c=u.emitter;c.position&&!c.isEnabled()||(this._activeParticleSystems.push(u),u.animate(),this._renderingManager.dispatchParticles(u))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,t){this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t));for(var n=0,r=this._activeMeshStage;n<r.length;n++)r[n].action(e,t);if(null!=t&&void 0!==t.subMeshes&&null!==t.subMeshes&&t.subMeshes.length>0)for(var i=this.getActiveSubMeshCandidates(t),o=i.length,a=0;a<o;a++){var s=i.data[a];this._evaluateSubMesh(s,t,e)}},t.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget)if(this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var e=this.activeCamera.outputRenderTarget.getInternalTexture();e?this.getEngine().bindFramebuffer(e):A.a.Error("Camera contains invalid customDefaultRenderTarget")}else this.getEngine().restoreDefaultFramebuffer()},t.prototype._renderForCamera=function(e,t){if(!e||!e._skipRendering){var n=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");n.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.getEngine().getCaps().multiview&&e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1?this.setTransformMatrix(e._rigCameras[0].getViewMatrix(),e._rigCameras[0].getProjectionMatrix(),e._rigCameras[1].getViewMatrix(),e._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var r=0;r<this._softwareSkinnedMeshes.length;r++){var o=this._softwareSkinnedMeshes.data[r];o.applySkeleton(o.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets);for(var a=0,s=this._gatherActiveCameraRenderTargetsStage;a<s.length;a++)s[a].action(this._renderTargets);if(this.renderTargetsEnabled){this._intermediateRendering=!0;var l=!1;if(this._renderTargets.length>0){i.h.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var u=0;u<this._renderTargets.length;u++){var c=this._renderTargets.data[u];if(c._shouldRender()){this._renderId++;var h=c.activeCamera&&c.activeCamera!==this.activeCamera;c.render(h,this.dumpNextRenderTargets),l=!0}}i.h.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var d=0,f=this._cameraDrawRenderTargetStage;d<f.length;d++)l=f[d].action(this.activeCamera)||l;this._intermediateRendering=!1,l&&this._bindFrameBuffer()}this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._prepareFrame();for(var p=0,m=this._beforeCameraDrawStage;p<m.length;p++)m[p].action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var g=0,_=this._afterCameraDrawStage;g<_.length;g++)_[g].action(this.activeCamera);this.postProcessManager&&!e._multiviewTexture&&this.postProcessManager._finalizeFrame(e.isIntermediate),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e){if(e.cameraRigMode===f.a.RIG_MODE_NONE||e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview)this._renderForCamera(e);else{if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else for(var t=0;t<e._rigCameras.length;t++)this._renderForCamera(e._rigCameras[t],e);this._activeCamera=e,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix())}},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var n=0;t.actionManager&&n<t.actionManager.actions.length;n++){var r=t.actionManager.actions[n];if(r.trigger===T.a.ACTION_OnIntersectionEnterTrigger||r.trigger===T.a.ACTION_OnIntersectionExitTrigger){var i=r.getTriggerParameter(),o=i instanceof d.a?i:i.mesh,a=o.intersectsMesh(t,i.usePreciseIntersection),s=t._intersectionsInProgress.indexOf(o);a&&-1===s?r.trigger===T.a.ACTION_OnIntersectionEnterTrigger?(r._executeCurrent(y.a.CreateNew(t,void 0,o)),t._intersectionsInProgress.push(o)):r.trigger===T.a.ACTION_OnIntersectionExitTrigger&&t._intersectionsInProgress.push(o):!a&&s>-1&&(r.trigger===T.a.ACTION_OnIntersectionExitTrigger&&r._executeCurrent(y.a.CreateNew(t,void 0,o)),t.actionManager.hasSpecificTrigger(T.a.ACTION_OnIntersectionExitTrigger,function(e){var t=e instanceof d.a?e:e.mesh;return o===t})&&r.trigger!==T.a.ACTION_OnIntersectionExitTrigger||t._intersectionsInProgress.splice(s,1))}}}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,n=this.getDeterministicFrameTime(),r=0,i=this._engine.getLockstepMaxSteps(),o=Math.floor(e/60);o=Math.min(o,i);do{this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=.06*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(n),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,r++,e-=n}while(e>0&&r<o);this._timeAccumulator=e<0?0:e}else e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime)),this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._advancePhysicsEngineStep(e)},t.prototype.render=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t=!1),!this.isDisposed){this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(T.a.ACTION_OnEveryFrameTrigger),t||this.animate();for(var n=0,r=this._beforeCameraUpdateStage;n<r.length;n++)r[n].action();if(e)if(this.activeCameras.length>0)for(var o=0;o<this.activeCameras.length;o++){var a=this.activeCameras[o];if(a.update(),a.cameraRigMode!==f.a.RIG_MODE_NONE)for(var s=0;s<a._rigCameras.length;s++)a._rigCameras[s].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==f.a.RIG_MODE_NONE))for(s=0;s<this.activeCamera._rigCameras.length;s++)this.activeCamera._rigCameras[s].update();this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var l=this.getEngine(),u=this.activeCamera;if(this.renderTargetsEnabled){i.h.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var c=0;c<this.customRenderTargets.length;c++){var h=this.customRenderTargets[c];if(h._shouldRender()){if(this._renderId++,this.activeCamera=h.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");l.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),h.render(u!==this.activeCamera,this.dumpNextRenderTargets)}}i.h.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=u,this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var d=0,p=this._beforeClearStage;d<p.length;d++)p[d].action();(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var m=0,g=this._gatherRenderTargetsStage;m<g.length;m++)g[m].action(this._renderTargets);if(this.activeCameras.length>0)for(o=0;o<this.activeCameras.length;o++)o>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[o]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var _=0,v=this._afterRenderStage;_<v.length;_++)v[_].action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(s=0;s<this._toBeDisposed.length;s++){var y=this._toBeDisposed[s];y&&y.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._activeMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,t=this._components;e<t.length;e++)t[e].dispose();this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var n=0,r=this._activeRequests;n<r.length;n++)r[n].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var i,o=this._engine.getRenderingCanvas();if(o)for(i=0;i<this.cameras.length;i++)this.cameras[i].detachControl(o);for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),(i=this._engine.scenes.indexOf(this))>-1&&this._engine.scenes.splice(i,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;if(t)for(var n in t._indices=[],t._vertexBuffers)t._vertexBuffers.hasOwnProperty(n)&&(t._vertexBuffers[n]._buffer._data=null)}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var n=t[e];n._buffer&&(n._buffer=null)}},t.prototype.getWorldExtends=function(e){var t=new c.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new c.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var r=e.getBoundingInfo(),o=r.boundingBox.minimumWorld,a=r.boundingBox.maximumWorld;i.h.CheckExtends(o,t,n),i.h.CheckExtends(a,t,n)}}),{min:t,max:n}},t.prototype.createPickingRay=function(e,t,n,r,i){throw void 0===i&&(i=!1),M.a.WarnImport("Ray")},t.prototype.createPickingRayToRef=function(e,t,n,r,i,o){throw void 0===o&&(o=!1),M.a.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,t,n){throw M.a.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,t,n,r){throw M.a.WarnImport("Ray")},t.prototype.pick=function(e,t,n,r,i,o){var a=new v.a;return a._pickingUnavailable=!0,a},t.prototype.pickWithRay=function(e,t,n,r){throw M.a.WarnImport("Ray")},t.prototype.multiPick=function(e,t,n,r,i){throw M.a.WarnImport("Ray")},t.prototype.multiPickWithRay=function(e,t,n){throw M.a.WarnImport("Ray")},t.prototype.setPointerOverMesh=function(e){this._inputManager.setPointerOverMesh(e)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++)t[e]._rebuild();for(var n=0,r=this.meshes;n<r.length;n++)r[n]._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(var i=0,o=this._components;i<o.length;i++)o[i].rebuild();for(var a=0,s=this.particleSystems;a<s.length;a++)s[a].rebuild()},t.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++)t[e]._rebuild();this.markAllMaterialsAsDirty(T.a.MATERIAL_TextureDirtyFlag)},t.prototype._getByTags=function(e,t,n){if(void 0===t)return e;var r=[];for(var i in n=n||function(e){},e){var o=e[i];u.a&&u.a.MatchesQuery(o,t)&&(r.push(o),n(o))}return r},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t.prototype.setRenderingOrder=function(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,n,r)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,n,r)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(T.a.MATERIAL_AllDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var n=0,r=this.materials;n<r.length;n++){var i=r[n];t&&!t(i)||i.markAsDirty(e)}},t.prototype._loadFile=function(e,t,n,r,o,a){var s=this,l=i.h.LoadFile(e,t,n,r?this.offlineProvider:void 0,o,a);return this._activeRequests.push(l),l.onCompleteObservable.add(function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)}),l},t.prototype._loadFileAsync=function(e,t,n){var r=this;return new Promise(function(i,o){r._loadFile(e,function(e){i(e)},void 0,t,n,function(e,t){o(t)})})},t._uniqueIdCounter=0,t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(p.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return l});var r=n(1),i=n(0),o=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}(),a=function(e,t){this.type=e,this.event=t},s=function(e){function t(t,n,r,o){var a=e.call(this,t,n)||this;return a.ray=null,a.skipOnPointerObservable=!1,a.localPosition=new i.w(r,o),a}return r.d(t,e),t}(a),l=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.pickInfo=r,i}return r.d(t,e),t}(a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(10),i=n(3),o=function(){function e(){}return Object.defineProperty(e,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_FresnelDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,r.b.MarkAllMaterialsAsDirty(i.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),e._DiffuseTextureEnabled=!0,e._AmbientTextureEnabled=!0,e._OpacityTextureEnabled=!0,e._ReflectionTextureEnabled=!0,e._EmissiveTextureEnabled=!0,e._SpecularTextureEnabled=!0,e._BumpTextureEnabled=!0,e._LightmapTextureEnabled=!0,e._RefractionTextureEnabled=!0,e._ColorGradingTextureEnabled=!0,e._FresnelEnabled=!0,e._ClearCoatTextureEnabled=!0,e._ClearCoatBumpTextureEnabled=!0,e._ClearCoatTintTextureEnabled=!0,e._SheenTextureEnabled=!0,e._AnisotropicTextureEnabled=!0,e._ThicknessTextureEnabled=!0,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r=n(1),i=n(2),o=n(9),a=n(8),s=n(0),l=n(23),u=n(49),c=n(63),h=n(3),d=n(6),f=function(){function e(t,n,r){this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new a.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=h.a.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._wasPreviouslyReady=!1,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._indexInSceneMaterialArray=-1,this.meshMap=null,this.name=t,this.id=t||o.h.RandomId(),this._scene=n||l.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=e.ClockWiseSideOrientation:this.sideOrientation=e.CounterClockWiseSideOrientation,this._uniformBuffer=new c.a(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,r||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alpha=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new a.c),this._onBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new a.c),this._onUnBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return"Name: "+this.name},e.prototype.getClassName=function(){return"Material"},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),e.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(e,t){return!0},e.prototype.isReadyForSubMesh=function(e,t,n){return!1},e.prototype.getEffect=function(){return this._effect},e.prototype.getScene=function(){return this._scene},e.prototype.needAlphaBlending=function(){return this.alpha<1},e.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.markDirty=function(){this._wasPreviouslyReady=!1},e.prototype._preBind=function(t,n){void 0===n&&(n=null);var r=this._scene.getEngine(),i=(null==n?this.sideOrientation:n)===e.ClockWiseSideOrientation;return r.enableEffect(t||this._effect),r.setState(this.backFaceCulling,this.zOffset,!1,i),i},e.prototype.bind=function(e,t){},e.prototype.bindForSubMesh=function(e,t,n){},e.prototype.bindOnlyWorldMatrix=function(e){},e.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},e.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},e.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},e.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},e.prototype._afterBind=function(e){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}},e.prototype.unbind=function(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)},e.prototype.getActiveTextures=function(){return[]},e.prototype.hasTexture=function(e){return!1},e.prototype.clone=function(e){return null},e.prototype.getBindedMeshes=function(){var e=this;if(this.meshMap){var t=new Array;for(var n in this.meshMap){var r=this.meshMap[n];r&&t.push(r)}return t}return this._scene.meshes.filter(function(t){return t.material===e})},e.prototype.forceCompilation=function(e,t,n){var i=this,o=r.a({clipPlane:!1},n),a=new u.a,l=this.getScene();!function n(){if(i._scene&&i._scene.getEngine()){a._materialDefines&&(a._materialDefines._renderId=-1);var r=l.clipPlane;o.clipPlane&&(l.clipPlane=new s.n(0,0,0,1)),i._storeEffectOnSubMeshes?i.isReadyForSubMesh(e,a)?t&&t(i):setTimeout(n,16):i.isReady()?t&&t(i):setTimeout(n,16),o.clipPlane&&(l.clipPlane=r)}}()},e.prototype.forceCompilationAsync=function(e,t){var n=this;return new Promise(function(r){n.forceCompilation(e,function(){r()},t)})},e.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},e.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,n=this.getScene().meshes;t<n.length;t++){var r=n[t];if(r.subMeshes)for(var i=0,o=r.subMeshes;i<o.length;i++){var a=o[i];a.getMaterial()===this&&a._materialDefines&&e(a._materialDefines)}}},e.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)},e.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)},e.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)},e.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)},e.prototype.dispose=function(e,t,n){var r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),!0!==n)if(this.meshMap)for(var i in this.meshMap)(s=this.meshMap[i])&&(s.material=null,this.releaseVertexArrayObject(s,e));else for(var o=0,a=r.meshes;o<a.length;o++){var s;(s=a[o]).material!==this||s.sourceMesh||(s.material=null,this.releaseVertexArrayObject(s,e))}this._uniformBuffer.dispose(),e&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear()},e.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var n=e.geometry;if(this._storeEffectOnSubMeshes)for(var r=0,i=e.subMeshes;r<i.length;r++){var o=i[r];n._releaseVertexArrayObject(o._materialEffect),t&&o._materialEffect&&o._materialEffect.dispose()}else n._releaseVertexArrayObject(this._effect)}},e.prototype.serialize=function(){return i.a.Serialize(this)},e.Parse=function(e,t,n){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return d.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";return o.h.Instantiate(e.customType).Parse(e,t,n)},e.TriangleFillMode=h.a.MATERIAL_TriangleFillMode,e.WireFrameFillMode=h.a.MATERIAL_WireFrameFillMode,e.PointFillMode=h.a.MATERIAL_PointFillMode,e.PointListDrawMode=h.a.MATERIAL_PointListDrawMode,e.LineListDrawMode=h.a.MATERIAL_LineListDrawMode,e.LineLoopDrawMode=h.a.MATERIAL_LineLoopDrawMode,e.LineStripDrawMode=h.a.MATERIAL_LineStripDrawMode,e.TriangleStripDrawMode=h.a.MATERIAL_TriangleStripDrawMode,e.TriangleFanDrawMode=h.a.MATERIAL_TriangleFanDrawMode,e.ClockWiseSideOrientation=h.a.MATERIAL_ClockWiseSideOrientation,e.CounterClockWiseSideOrientation=h.a.MATERIAL_CounterClockWiseSideOrientation,e.TextureDirtyFlag=h.a.MATERIAL_TextureDirtyFlag,e.LightDirtyFlag=h.a.MATERIAL_LightDirtyFlag,e.FresnelDirtyFlag=h.a.MATERIAL_FresnelDirtyFlag,e.AttributesDirtyFlag=h.a.MATERIAL_AttributesDirtyFlag,e.MiscDirtyFlag=h.a.MATERIAL_MiscDirtyFlag,e.AllDirtyFlag=h.a.MATERIAL_AllDirtyFlag,e._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},e._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},e._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},e._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},e._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},e._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},e._FresnelAndMiscDirtyCallBack=function(t){e._FresnelDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._TextureAndMiscDirtyCallBack=function(t){e._TextureDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._DirtyCallbackArray=[],e._RunDirtyCallBacks=function(t){for(var n=0,r=e._DirtyCallbackArray;n<r.length;n++)(0,r[n])(t)},r.c([Object(i.c)()],e.prototype,"id",void 0),r.c([Object(i.c)()],e.prototype,"uniqueId",void 0),r.c([Object(i.c)()],e.prototype,"name",void 0),r.c([Object(i.c)()],e.prototype,"checkReadyOnEveryCall",void 0),r.c([Object(i.c)()],e.prototype,"checkReadyOnlyOnce",void 0),r.c([Object(i.c)()],e.prototype,"state",void 0),r.c([Object(i.c)("alpha")],e.prototype,"_alpha",void 0),r.c([Object(i.c)("backFaceCulling")],e.prototype,"_backFaceCulling",void 0),r.c([Object(i.c)()],e.prototype,"sideOrientation",void 0),r.c([Object(i.c)("alphaMode")],e.prototype,"_alphaMode",void 0),r.c([Object(i.c)()],e.prototype,"_needDepthPrePass",void 0),r.c([Object(i.c)()],e.prototype,"disableDepthWrite",void 0),r.c([Object(i.c)()],e.prototype,"forceDepthWrite",void 0),r.c([Object(i.c)()],e.prototype,"separateCullingPass",void 0),r.c([Object(i.c)("fogEnabled")],e.prototype,"_fogEnabled",void 0),r.c([Object(i.c)()],e.prototype,"pointSize",void 0),r.c([Object(i.c)()],e.prototype,"zOffset",void 0),r.c([Object(i.c)()],e.prototype,"wireframe",null),r.c([Object(i.c)()],e.prototype,"pointsCloud",null),r.c([Object(i.c)()],e.prototype,"fillMode",null),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r=n(1),i=n(2),o=n(28),a=n(9),s=n(8),l=n(0),u=n(25),c=n(6),h=n(22),d=n(19),f=function(e){function t(n,r,i,a){void 0===a&&(a=!0);var u=e.call(this,n,i)||this;return u._position=l.x.Zero(),u.upVector=l.x.Up(),u.orthoLeft=null,u.orthoRight=null,u.orthoBottom=null,u.orthoTop=null,u.fov=.8,u.minZ=1,u.maxZ=1e4,u.inertia=.9,u.mode=t.PERSPECTIVE_CAMERA,u.isIntermediate=!1,u.viewport=new l.z(0,0,1,1),u.layerMask=268435455,u.fovMode=t.FOVMODE_VERTICAL_FIXED,u.cameraRigMode=t.RIG_MODE_NONE,u.customRenderTargets=new Array,u.outputRenderTarget=null,u.onViewMatrixChangedObservable=new s.c,u.onProjectionMatrixChangedObservable=new s.c,u.onAfterCheckInputsObservable=new s.c,u.onRestoreStateObservable=new s.c,u._rigCameras=new Array,u._webvrViewMatrix=l.j.Identity(),u._skipRendering=!1,u._projectionMatrix=new l.j,u._postProcesses=new Array,u._activeMeshes=new o.a(256),u._globalPosition=l.x.Zero(),u._computedViewMatrix=l.j.Identity(),u._doNotComputeProjectionMatrix=!1,u._transformMatrix=l.j.Zero(),u._refreshFrustumPlanes=!0,u._isCamera=!0,u._isLeftCamera=!1,u._isRightCamera=!0,u.getScene().addCamera(u),a&&!u.getScene().activeCamera&&(u.getScene().activeCamera=u),u.position=r,u}return r.d(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!0,configurable:!0}),t.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},t.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},t.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},t.prototype.getClassName=function(){return"Camera"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t},Object.defineProperty(t.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},t.prototype.isReady=function(t){if(void 0===t&&(t=!1),t)for(var n=0,r=this._postProcesses;n<r.length;n++){var i=r[n];if(i&&!i.isReady())return!1}return e.prototype.isReady.call(this,t)},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=new l.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new l.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},t.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},t.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},t.prototype._isSynchronizedViewMatrix=function(){return!!e.prototype._isSynchronized.call(this)&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()},t.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var n=this.getEngine();return e=this.mode===t.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===n.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===n.getRenderWidth()&&this._cache.renderHeight===n.getRenderHeight()},t.prototype.attachControl=function(e,t){},t.prototype.detachControl=function(e){},t.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras()},t.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),t.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null},t.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var t=0,n=this._rigCameras.length;t<n;t++){var r=this._rigCameras[t],i=r._rigPostProcess;i?("pass"===i.getEffectName()&&(r.isIntermediate=0===this._postProcesses.length),r._postProcesses=this._postProcesses.slice(0).concat(i),i.markTextureDirty()):r._postProcesses=this._postProcesses.slice(0)}},t.prototype.attachPostProcess=function(e,t){return void 0===t&&(t=null),!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(c.a.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(e))},t.prototype.detachPostProcess=function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._cascadePostProcessesToRigCams()},t.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},t.prototype._getViewMatrix=function(){return l.j.Identity()},t.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},t.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)},t.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},t.prototype.getProjectionMatrix=function(e){if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var n=this.getEngine(),r=this.getScene();if(this.mode===t.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=n.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),r.useRightHandedSystem?l.j.PerspectiveFovRHToRef(this.fov,n.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED):l.j.PerspectiveFovLHToRef(this.fov,n.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED);else{var i=n.getRenderWidth()/2,o=n.getRenderHeight()/2;r.useRightHandedSystem?l.j.OrthoOffCenterRHToRef(this.orthoLeft||-i,this.orthoRight||i,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix):l.j.OrthoOffCenterLHToRef(this.orthoLeft||-i,this.orthoRight||i,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=n.getRenderWidth(),this._cache.renderHeight=n.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},t.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},t.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?l.i.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=l.i.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},t.prototype.isInFrustum=function(e,t){if(void 0===t&&(t=!1),this._updateFrustumPlanes(),t&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach(function(t){t._updateFrustumPlanes(),n=n||e.isInFrustum(t._frustumPlanes)}),n}return e.isInFrustum(this._frustumPlanes)},t.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},t.prototype.getForwardRay=function(e,t,n){throw void 0===e&&(e=100),d.a.WarnImport("Ray")},t.prototype.dispose=function(n,r){for(void 0===r&&(r=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var o=this._postProcesses.length;--o>=0;){var a=this._postProcesses[o];a&&a.dispose(this)}for(o=this.customRenderTargets.length;--o>=0;)this.customRenderTargets[o].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),e.prototype.dispose.call(this,n,r)},Object.defineProperty(t.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),t.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},t.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},t.prototype.setCameraRigMode=function(e,n){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var r=this._rigCameras.pop();r&&r.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=n.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.h.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){var i=this.createRigCamera(this.name+"_L",0);i&&(i._isLeftCamera=!0);var o=this.createRigCamera(this.name+"_R",1);o&&(o._isRightCamera=!0),i&&o&&(this._rigCameras.push(i),this._rigCameras.push(o))}switch(this.cameraRigMode){case t.RIG_MODE_STEREOSCOPIC_ANAGLYPH:t._setStereoscopicAnaglyphRigMode(this);break;case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case t.RIG_MODE_STEREOSCOPIC_OVERUNDER:t._setStereoscopicRigMode(this);break;case t.RIG_MODE_VR:t._setVRRigMode(this,n);break;case t.RIG_MODE_WEBVR:t._setWebVRRigMode(this,n)}this._cascadePostProcessesToRigCams(),this.update()}},t._setStereoscopicRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},t._setStereoscopicAnaglyphRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},t._setVRRigMode=function(e,t){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},t._setWebVRRigMode=function(e,t){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},t.prototype._getVRProjectionMatrix=function(){return l.j.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},t.prototype._updateCameraRotationMatrix=function(){},t.prototype._updateWebVRCameraRotationMatrix=function(){},t.prototype._getWebVRProjectionMatrix=function(){return l.j.Identity()},t.prototype._getWebVRViewMatrix=function(){return l.j.Identity()},t.prototype.setCameraRigParameter=function(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=a.h.ToRadians(t/.0637))},t.prototype.createRigCamera=function(e,t){return null},t.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},t.prototype._setupInputs=function(){},t.prototype.serialize=function(){var e=i.a.Serialize(this);return e.type=this.getClassName(),this.parent&&(e.parentId=this.parent.id),this.inputs&&this.inputs.serialize(e),i.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.prototype.clone=function(e){return i.a.Clone(t.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},t.prototype.getDirection=function(e){var t=l.x.Zero();return this.getDirectionToRef(e,t),t},t.prototype.getDirectionToRef=function(e,t){l.x.TransformNormalToRef(e,this.getWorldMatrix(),t)},t.GetConstructorFromName=function(e,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=!0);var a=u.a.Construct(e,n,r,{interaxial_distance:i,isStereoscopicSideBySide:o});return a||function(){return t._createDefaultParsedCamera(n,r)}},t.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},t.Parse=function(e,n){var r=e.type,o=t.GetConstructorFromName(r,e.name,n,e.interaxial_distance,e.isStereoscopicSideBySide),a=i.a.Parse(o,e,n);if(e.parentId&&(a._waitingParentId=e.parentId),a.inputs&&(a.inputs.parse(e),a._setupInputs()),a.setPosition&&(a.position.copyFromFloats(0,0,0),a.setPosition(l.x.FromArray(e.position))),e.target&&a.setTarget&&a.setTarget(l.x.FromArray(e.target)),e.cameraRigMode){var s=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};a.setCameraRigMode(e.cameraRigMode,s)}if(e.animations){for(var c=0;c<e.animations.length;c++){var d=e.animations[c],f=h.a.GetClass("BABYLON.Animation");f&&a.animations.push(f.Parse(d))}u.a.ParseAnimationRanges(a,e,n)}return e.autoAnimate&&n.beginAnimation(a,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),a},t._createDefaultParsedCamera=function(e,t){throw d.a.WarnImport("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_VR=20,t.RIG_MODE_WEBVR=21,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,r.c([Object(i.o)("position")],t.prototype,"_position",void 0),r.c([Object(i.o)()],t.prototype,"upVector",void 0),r.c([Object(i.c)()],t.prototype,"orthoLeft",void 0),r.c([Object(i.c)()],t.prototype,"orthoRight",void 0),r.c([Object(i.c)()],t.prototype,"orthoBottom",void 0),r.c([Object(i.c)()],t.prototype,"orthoTop",void 0),r.c([Object(i.c)()],t.prototype,"fov",void 0),r.c([Object(i.c)()],t.prototype,"minZ",void 0),r.c([Object(i.c)()],t.prototype,"maxZ",void 0),r.c([Object(i.c)()],t.prototype,"inertia",void 0),r.c([Object(i.c)()],t.prototype,"mode",void 0),r.c([Object(i.c)()],t.prototype,"layerMask",void 0),r.c([Object(i.c)()],t.prototype,"fovMode",void 0),r.c([Object(i.c)()],t.prototype,"cameraRigMode",void 0),r.c([Object(i.c)()],t.prototype,"interaxialDistance",void 0),r.c([Object(i.c)()],t.prototype,"isStereoscopicSideBySide",void 0),t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},e.RegisteredTypes={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n(1),i=n(9),o=n(8),a=n(0),s=n(10),l=n(4),u=n(13),c=n(42),h=n(50),d=n(43),f=n(3),p=n(108),m=n(19),g=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=a.x.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},_=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new g,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1},v=function(e){function t(n,r){void 0===r&&(r=null);var i=e.call(this,n,r,!1)||this;return i._internalAbstractMeshDataInfo=new _,i.cullingStrategy=t.CULLINGSTRATEGY_STANDARD,i.onCollideObservable=new o.c,i.onCollisionPositionChangeObservable=new o.c,i.onMaterialChangedObservable=new o.c,i.definedFacingForward=!0,i._occlusionQuery=null,i._renderingGroup=null,i.alphaIndex=Number.MAX_VALUE,i.isVisible=!0,i.isPickable=!0,i.showSubMeshesBoundingBox=!1,i.isBlocker=!1,i.enablePointerMoveEvents=!1,i.renderingGroupId=0,i._material=null,i.outlineColor=a.e.Red(),i.outlineWidth=.02,i.overlayColor=a.e.Red(),i.overlayAlpha=.5,i.useOctreeForRenderingSelection=!0,i.useOctreeForPicking=!0,i.useOctreeForCollisions=!0,i.alwaysSelectAsActiveMesh=!1,i.doNotSyncBoundingInfo=!1,i.actionManager=null,i._meshCollisionData=new p.a,i.ellipsoid=new a.x(.5,1,.5),i.ellipsoidOffset=new a.x(0,0,0),i.edgesWidth=1,i.edgesColor=new a.f(1,0,0,1),i._edgesRenderer=null,i._masterMesh=null,i._boundingInfo=null,i._renderId=0,i._intersectionsInProgress=new Array,i._unIndexed=!1,i._lightSources=new Array,i._waitingData={lods:null,actions:null,freezeWorldMatrix:null},i._bonesTransformMatrices=null,i.onRebuildObservable=new o.c,i._onCollisionPositionChange=function(e,t,n){void 0===n&&(n=null),t.subtractToRef(i._meshCollisionData._oldPositionForCollisions,i._meshCollisionData._diffPositionForCollisions),i._meshCollisionData._diffPositionForCollisions.length()>s.b.CollisionsEpsilon&&i.position.addInPlace(i._meshCollisionData._diffPositionForCollisions),n&&i.onCollideObservable.notifyObservers(n),i.onCollisionPositionChangeObservable.notifyObservers(i.position)},i.getScene().addMesh(i),i._resyncLightSources(),i}return r.d(t,e),Object.defineProperty(t,"BILLBOARDMODE_NONE",{get:function(){return c.a.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_X",{get:function(){return c.a.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Y",{get:function(){return c.a.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Z",{get:function(){return c.a.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_ALL",{get:function(){return c.a.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!0,configurable:!0}),t.prototype._updateNonUniformScalingState=function(t){return!!e.prototype._updateNonUniformScalingState.call(this,t)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(t.prototype,"onCollide",{set:function(e){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onCollisionPositionChange",{set:function(e){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){this._internalAbstractMeshDataInfo._visibility!==e&&(this._internalAbstractMeshDataInfo._visibility=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(e){this._material!==e&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&this._unBindEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(e){this._meshCollisionData._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(e){this._meshCollisionData._collisionGroup=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"AbstractMesh"},t.prototype.toString=function(e){var t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this._internalAbstractMeshDataInfo._skeleton;return n&&(t+=", skeleton: "+n.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t},t.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==c.a.BILLBOARDMODE_NONE?this._masterMesh:e.prototype._getEffectiveParent.call(this)},t.prototype._getActionManagerForTrigger=function(e,t){if(void 0===t&&(t=!0),this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},t.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++)t[e]._rebuild()},t.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var e=0,t=this.getScene().lights;e<t.length;e++){var n=t[e];n.isEnabled()&&n.canAffectMesh(this)&&this._lightSources.push(n)}this._markSubMeshesAsLightDirty()},t.prototype._resyncLighSource=function(e){var t=e.isEnabled()&&e.canAffectMesh(this),n=this._lightSources.indexOf(e);if(-1===n){if(!t)return;this._lightSources.push(e)}else{if(t)return;this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty()},t.prototype._unBindEffect=function(){for(var e=0,t=this.subMeshes;e<t.length;e++)t[e].setEffect(null)},t.prototype._removeLightSource=function(e){var t=this._lightSources.indexOf(e);-1!==t&&(this._lightSources.splice(t,1),this._markSubMeshesAsLightDirty())},t.prototype._markSubMeshesAsDirty=function(e){if(this.subMeshes)for(var t=0,n=this.subMeshes;t<n.length;t++){var r=n[t];r._materialDefines&&e(r._materialDefines)}},t.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsLightDirty()})},t.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},t.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++){var n=t[e].getMaterial();n&&n.markAsDirty(f.a.MATERIAL_MiscDirtyFlag)}},Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getLOD=function(e){return this},t.prototype.getTotalVertices=function(){return 0},t.prototype.getTotalIndices=function(){return 0},t.prototype.getIndices=function(){return null},t.prototype.getVerticesData=function(e){return null},t.prototype.setVerticesData=function(e,t,n,r){return this},t.prototype.updateVerticesData=function(e,t,n,r){return this},t.prototype.setIndices=function(e,t){return this},t.prototype.isVerticesDataPresent=function(e){return!1},t.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},t.prototype.normalizeToUnitCube=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!1);var n=null,r=null;t&&(this.rotationQuaternion?(r=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(n=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var i=this.getHierarchyBoundingVectors(e),o=i.max.subtract(i.min),a=Math.max(o.x,o.y,o.z);if(0===a)return this;var s=1/a;return this.scaling.scaleInPlace(s),t&&(this.rotationQuaternion&&r?this.rotationQuaternion.copyFrom(r):this.rotation&&n&&this.rotation.copyFrom(n)),this},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(t.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(l.b.MatricesIndicesKind)&&this.isVerticesDataPresent(l.b.MatricesWeightsKind)},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){},t.prototype._preActivateForIntermediateRendering=function(e){},t.prototype._activate=function(e,t){return this._renderId=e,!0},t.prototype._postActivate=function(){},t.prototype._freeze=function(){},t.prototype._unFreeze=function(){},t.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===c.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():e.prototype.getWorldMatrix.call(this)},t.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():e.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.movePOV=function(e,t,n){return this.position.addInPlace(this.calcMovePOV(e,t,n)),this},t.prototype.calcMovePOV=function(e,t,n){var r=new a.j;(this.rotationQuaternion?this.rotationQuaternion:a.q.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(r);var i=a.x.Zero(),o=this.definedFacingForward?-1:1;return a.x.TransformCoordinatesFromFloatsToRef(e*o,t,n*o,r,i),i},t.prototype.rotatePOV=function(e,t,n){return this.rotation.addInPlace(this.calcRotatePOV(e,t,n)),this},t.prototype.calcRotatePOV=function(e,t,n){var r=this.definedFacingForward?1:-1;return new a.x(e*r,t,n*r)},t.prototype.refreshBoundingInfo=function(e){return void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(e),null),this)},t.prototype._refreshBoundingInfo=function(e,t){if(e){var n=i.h.ExtractMinAndMax(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new d.a(n.minimum,n.maximum)}if(this.subMeshes)for(var r=0;r<this.subMeshes.length;r++)this.subMeshes[r].refreshBoundingInfo(e);this._updateBoundingInfo()},t.prototype._getPositionData=function(e){var t=this.getVerticesData(l.b.PositionKind);if(t&&e&&this.skeleton){t=i.h.Slice(t),this._generatePointsArray();var n=this.getVerticesData(l.b.MatricesIndicesKind),r=this.getVerticesData(l.b.MatricesWeightsKind);if(r&&n){var o=this.numBoneInfluencers>4,s=o?this.getVerticesData(l.b.MatricesIndicesExtraKind):null,u=o?this.getVerticesData(l.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var c=this.skeleton.getTransformMatrices(this),h=a.t.Vector3[0],d=a.t.Matrix[0],f=a.t.Matrix[1],p=0,m=0;m<t.length;m+=3,p+=4){var g,_;for(d.reset(),g=0;g<4;g++)(_=r[p+g])>0&&(a.j.FromFloat32ArrayToRefScaled(c,Math.floor(16*n[p+g]),_,f),d.addToSelf(f));if(o)for(g=0;g<4;g++)(_=u[p+g])>0&&(a.j.FromFloat32ArrayToRefScaled(c,Math.floor(16*s[p+g]),_,f),d.addToSelf(f));a.x.TransformCoordinatesFromFloatsToRef(t[m],t[m+1],t[m+2],d,h),h.toArray(t,m),this._positions&&this._positions[m/3].copyFrom(h)}}}return t},t.prototype._updateBoundingInfo=function(){var e=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(e.worldMatrixFromCache):this._boundingInfo=new d.a(this.absolutePosition,this.absolutePosition,e.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache),this},t.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,n=0;n<t;n++){var r=this.subMeshes[n];(t>1||!r.IsGlobal)&&r.updateBoundingInfo(e)}return this},t.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(t.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!0,configurable:!0}),t.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(e)},t.prototype.intersectsMesh=function(e,t,n){if(void 0===t&&(t=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,t))return!0;if(n)for(var r=0,i=this.getChildMeshes();r<i.length;r++)if(i[r].intersectsMesh(e,t,!0))return!0;return!1},t.prototype.intersectsPoint=function(e){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(e)},Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(e){this._meshCollisionData._checkCollisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!0,configurable:!0}),t.prototype.moveWithCollisions=function(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var t=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=t.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._meshCollisionData._oldPositionForCollisions,e,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},t.prototype._collideForSubMesh=function(e,t,n){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var r=e.verticesStart,i=e.verticesStart+e.verticesCount,o=r;o<i;o++)e._lastColliderWorldVertices.push(a.x.TransformCoordinates(this._positions[o],t))}return n._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial()),n.collisionFound&&(n.collidedMesh=this),this},t.prototype._processCollisionsForSubMeshes=function(e,t){for(var n=this._scene.getCollidingSubMeshCandidates(this,e),r=n.length,i=0;i<r;i++){var o=n.data[i];r>1&&!o._checkCollision(e)||this._collideForSubMesh(o,t,e)}return this},t.prototype._checkCollision=function(e){if(!this._boundingInfo||!this._boundingInfo._checkCollision(e))return this;var t=a.t.Matrix[0],n=a.t.Matrix[1];return a.j.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,n),this._processCollisionsForSubMeshes(e,n),this},t.prototype._generatePointsArray=function(){return!1},t.prototype.intersects=function(e,t,n){var r=new h.a,i="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,o=this._boundingInfo;if(!(this.subMeshes&&o&&e.intersectsSphere(o.boundingSphere,i)&&e.intersectsBox(o.boundingBox,i)))return r;if(!this._generatePointsArray())return r;for(var s=null,l=this._scene.getIntersectingSubMeshCandidates(this,e),u=l.length,c=0;c<u;c++){var d=l.data[c];if(!(u>1)||d.canIntersects(e)){var f=d.intersects(e,this._positions,this.getIndices(),t,n);if(f&&(t||!s||f.distance<s.distance)&&((s=f).subMeshId=c,t))break}}if(s){var p=this.getWorldMatrix(),m=a.t.Vector3[0],g=a.t.Vector3[1];a.x.TransformCoordinatesToRef(e.origin,p,m),e.direction.scaleToRef(s.distance,g);var _=a.x.TransformNormal(g,p).addInPlace(m);return r.hit=!0,r.distance=a.x.Distance(m,_),r.pickedPoint=_,r.pickedMesh=this,r.bu=s.bu||0,r.bv=s.bv||0,r.faceId=s.faceId,r.subMeshId=s.subMeshId,r}return r},t.prototype.clone=function(e,t,n){return null},t.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},t.prototype.dispose=function(t,n){var r,i=this;for(void 0===n&&(n=!1),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,r=0;r<this._intersectionsInProgress.length;r++){var o=this._intersectionsInProgress[r],a=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(a,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(e){var t=e.includedOnlyMeshes.indexOf(i);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(i))&&e.excludedMeshes.splice(t,1);var n=e.getShadowGenerator();if(n){var r=n.getShadowMap();r&&r.renderList&&-1!==(t=r.renderList.indexOf(i))&&r.renderList.splice(t,1)}}),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var s=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),this.getScene().removeMesh(this),n&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(r=0;r<this.getScene().particleSystems.length;r++)this.getScene().particleSystems[r].emitter===this&&(this.getScene().particleSystems[r].dispose(),r--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),e.prototype.dispose.call(this,t,n)},t.prototype.addChild=function(e){return e.setParent(this),this},t.prototype.removeChild=function(e){return e.setParent(null),this},t.prototype._initFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var t=0;t<e.facetNb;t++)e.facetNormals[t]=a.x.Zero(),e.facetPositions[t]=a.x.Zero();return e.facetDataEnabled=!0,this},t.prototype.updateFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var t=this.getVerticesData(l.b.PositionKind),n=this.getIndices(),r=this.getVerticesData(l.b.NormalKind),i=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,n instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(n);else{for(var o=!1,s=0;s<n.length;s++)if(n[s]>65535){o=!0;break}e.depthSortedIndices=o?new Uint32Array(n):new Uint16Array(n)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){var c=this.getScene().activeCamera;e.facetDepthSortFrom=c?c.position:a.x.Zero()}e.depthSortedFacets=[];for(var h=0;h<e.facetNb;h++){var d={ind:3*h,sqDistance:0};e.depthSortedFacets.push(d)}e.invertedMatrix=a.j.Identity(),e.facetDepthSortOrigin=a.x.Zero()}e.bbSize.x=i.maximum.x-i.minimum.x>a.h?i.maximum.x-i.minimum.x:a.h,e.bbSize.y=i.maximum.y-i.minimum.y>a.h?i.maximum.y-i.minimum.y:a.h,e.bbSize.z=i.maximum.z-i.minimum.z>a.h?i.maximum.z-i.minimum.z:a.h;var f=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(f=f>e.bbSize.z?f:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/f),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/f),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/f),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=i,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),a.x.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,u.a.ComputeNormals(t,n,r,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);var p=e.depthSortedIndices.length/3|0;for(h=0;h<p;h++){var m=e.depthSortedFacets[h].ind;e.depthSortedIndices[3*h]=n[m],e.depthSortedIndices[3*h+1]=n[m+1],e.depthSortedIndices[3*h+2]=n[m+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this},t.prototype.getFacetLocalNormals=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals},t.prototype.getFacetLocalPositions=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions},t.prototype.getFacetLocalPartitioning=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning},t.prototype.getFacetPosition=function(e){var t=a.x.Zero();return this.getFacetPositionToRef(e,t),t},t.prototype.getFacetPositionToRef=function(e,t){var n=this.getFacetLocalPositions()[e],r=this.getWorldMatrix();return a.x.TransformCoordinatesToRef(n,r,t),this},t.prototype.getFacetNormal=function(e){var t=a.x.Zero();return this.getFacetNormalToRef(e,t),t},t.prototype.getFacetNormalToRef=function(e,t){var n=this.getFacetLocalNormals()[e];return a.x.TransformNormalToRef(n,this.getWorldMatrix(),t),this},t.prototype.getFacetsAtLocalCoordinates=function(e,t,n){var r=this.getBoundingInfo(),i=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((e-r.minimum.x*i.partitioningBBoxRatio)*i.subDiv.X*i.partitioningBBoxRatio/i.bbSize.x),a=Math.floor((t-r.minimum.y*i.partitioningBBoxRatio)*i.subDiv.Y*i.partitioningBBoxRatio/i.bbSize.y),s=Math.floor((n-r.minimum.z*i.partitioningBBoxRatio)*i.subDiv.Z*i.partitioningBBoxRatio/i.bbSize.z);return o<0||o>i.subDiv.max||a<0||a>i.subDiv.max||s<0||s>i.subDiv.max?null:i.facetPartitioning[o+i.subDiv.max*a+i.subDiv.max*i.subDiv.max*s]},t.prototype.getClosestFacetAtCoordinates=function(e,t,n,r,i,o){void 0===i&&(i=!1),void 0===o&&(o=!0);var s=this.getWorldMatrix(),l=a.t.Matrix[5];s.invertToRef(l);var u=a.t.Vector3[8];a.x.TransformCoordinatesFromFloatsToRef(e,t,n,l,u);var c=this.getClosestFacetAtLocalCoordinates(u.x,u.y,u.z,r,i,o);return r&&a.x.TransformCoordinatesFromFloatsToRef(r.x,r.y,r.z,s,r),c},t.prototype.getClosestFacetAtLocalCoordinates=function(e,t,n,r,i,o){void 0===i&&(i=!1),void 0===o&&(o=!0);var a=null,s=0,l=0,u=0,c=0,h=0,d=0,f=0,p=0,m=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),_=this.getFacetsAtLocalCoordinates(e,t,n);if(!_)return null;for(var v,y,b,E=Number.MAX_VALUE,x=E,T=0;T<_.length;T++)y=g[v=_[T]],c=(e-(b=m[v]).x)*y.x+(t-b.y)*y.y+(n-b.z)*y.z,(!i||i&&o&&c>=0||i&&!o&&c<=0)&&(c=y.x*b.x+y.y*b.y+y.z*b.z,h=-(y.x*e+y.y*t+y.z*n-c)/(y.x*y.x+y.y*y.y+y.z*y.z),(x=(s=(d=e+y.x*h)-e)*s+(l=(f=t+y.y*h)-t)*l+(u=(p=n+y.z*h)-n)*u)<E&&(E=x,a=v,r&&(r.x=d,r.y=f,r.z=p)));return a},t.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},t.prototype.disableFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this},t.prototype.updateIndices=function(e,t,n){return void 0===n&&(n=!1),this},t.prototype.createNormals=function(e){var t,n=this.getVerticesData(l.b.PositionKind),r=this.getIndices();return t=this.isVerticesDataPresent(l.b.NormalKind)?this.getVerticesData(l.b.NormalKind):[],u.a.ComputeNormals(n,r,t,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(l.b.NormalKind,t,e),this},t.prototype.alignWithNormal=function(e,t){t||(t=a.c.Y);var n=a.t.Vector3[0],r=a.t.Vector3[1];return a.x.CrossToRef(t,e,r),a.x.CrossToRef(e,r,n),this.rotationQuaternion?a.q.RotationQuaternionFromAxisToRef(n,e,r,this.rotationQuaternion):a.x.RotationFromAxisToRef(n,e,r,this.rotation),this},t.prototype._checkOcclusionQuery=function(){return!1},t.prototype.disableEdgesRendering=function(){throw m.a.WarnImport("EdgesRenderer")},t.prototype.enableEdgesRendering=function(e,t){throw m.a.WarnImport("EdgesRenderer")},t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,t.CULLINGSTRATEGY_STANDARD=f.a.MESHES_CULLINGSTRATEGY_STANDARD,t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=f.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=f.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=f.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY,t}(c.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(1),i=n(0),o=n(2),a=n(8),s=n(23),l=n(19),u=n(9),c=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!0),this.state="",this.metadata=null,this.reservedDataStore=null,this.doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=i.j.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new a.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||s.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),n&&this.addToSceneRootNodes()}return e.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},e.Construct=function(e,t,n,r){var i=this._NodeConstructors[e];return i?i(t,n,r):null},e.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var n=this._parentNode._children.indexOf(this);-1!==n&&this._parentNode._children.splice(n,1),e||this._isDisposed||this.addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this.removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!0,configurable:!0}),e.prototype.addToSceneRootNodes=function(){-1===this._sceneRootNodesIndex&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},e.prototype.removeFromSceneRootNodes=function(){if(-1!==this._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._sceneRootNodesIndex]=e[t],e[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Node"},Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._scene.getEngine()},e.prototype.addBehavior=function(e,t){var n=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)?this:(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(function(){e.attach(n)}):e.attach(this),this._behaviors.push(e),this)},e.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)},Object.defineProperty(e.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),e.prototype.getBehaviorByName=function(e){for(var t=0,n=this._behaviors;t<n.length;t++){var r=n[t];if(r.name===e)return r}return null},e.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},e.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(e.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),e.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},e.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},e.prototype._getActionManagerForTrigger=function(e,t){return void 0===t&&(t=!0),this.parent?this.parent._getActionManagerForTrigger(e,!1):null},e.prototype._updateCache=function(e){},e.prototype._isSynchronized=function(){return!0},e.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},e.prototype.isSynchronizedWithParent=function(){return!this._parentNode||this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},e.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},e.prototype.isReady=function(e){return void 0===e&&(e=!1),this._isReady},e.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._isEnabled:!!this._isEnabled&&this._isParentEnabled},e.prototype._syncParentEnabledState=function(){this._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach(function(e){e._syncParentEnabledState()})},e.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},e.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},e.prototype._getDescendants=function(e,t,n){if(void 0===t&&(t=!1),this._children)for(var r=0;r<this._children.length;r++){var i=this._children[r];n&&!n(i)||e.push(i),t||i._getDescendants(e,!1,n)}},e.prototype.getDescendants=function(e,t){var n=new Array;return this._getDescendants(n,e,t),n},e.prototype.getChildMeshes=function(e,t){var n=[];return this._getDescendants(n,e,function(e){return(!t||t(e))&&void 0!==e.cullingStrategy}),n},e.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},e.prototype._setReady=function(e){e!==this._isReady&&(e?(this.onReady&&this.onReady(this),this._isReady=!0):this._isReady=!1)},e.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var n=this.animations[t];if(n.name===e)return n}return null},e.prototype.createAnimationRange=function(t,n,r){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,n,r);for(var i=0,o=this.animations.length;i<o;i++)this.animations[i]&&this.animations[i].createRange(t,n,r)}},e.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var n=0,r=this.animations.length;n<r;n++)this.animations[n]&&this.animations[n].deleteRange(e,t);this._ranges[e]=null},e.prototype.getAnimationRange=function(e){return this._ranges[e]},e.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},e.prototype.beginAnimation=function(e,t,n,r){var i=this.getAnimationRange(e);return i?this._scene.beginAnimation(this,i.from,i.to,t,n,r):null},e.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var n=this._ranges[t];if(n){var r={};r.name=t,r.from=n.from,r.to=n.to,e.push(r)}}return e},e.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=i.j.Identity()),this._worldMatrix},e.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._isDisposed=!0,!e)for(var n=0,r=this.getDescendants(!0);n<r.length;n++)r[n].dispose(e,t);this.parent?this.parent=null:this.removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var i=0,o=this._behaviors;i<o.length;i++)o[i].detach();this._behaviors=[]},e.ParseAnimationRanges=function(e,t,n){if(t.ranges)for(var r=0;r<t.ranges.length;r++){var i=t.ranges[r];e.createAnimationRange(i.name,i.from,i.to)}},e.prototype.getHierarchyBoundingVectors=function(e,t){var n,r;if(void 0===e&&(e=!0),void 0===t&&(t=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0),this.getBoundingInfo&&this.subMeshes){var o=this.getBoundingInfo();n=o.boundingBox.minimumWorld,r=o.boundingBox.maximumWorld}else n=new i.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new i.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(var a=0,s=this.getDescendants(!1);a<s.length;a++){var l=s[a];if(l.computeWorldMatrix(!0),(!t||t(l))&&l.getBoundingInfo&&0!==l.getTotalVertices()){var c=l.getBoundingInfo().boundingBox,h=c.minimumWorld,d=c.maximumWorld;u.h.CheckExtends(h,n,r),u.h.CheckExtends(d,n,r)}}return{min:n,max:r}},e._AnimationRangeFactory=function(e,t,n){throw l.a.WarnImport("AnimationRange")},e._NodeConstructors={},r.c([Object(o.c)()],e.prototype,"name",void 0),r.c([Object(o.c)()],e.prototype,"id",void 0),r.c([Object(o.c)()],e.prototype,"uniqueId",void 0),r.c([Object(o.c)()],e.prototype,"state",void 0),r.c([Object(o.c)()],e.prototype,"metadata",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(8),i=n(92),o=n(3),a=n(19),s=function(){function e(t,n,i){void 0===i&&(i=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new r.c,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._dataSource=e.DATASOURCE_UNKNOWN,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._webGLTexture=null,this._references=1,this._engine=t,this._dataSource=n,i||(this._webGLTexture=t._createTexture())}return e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(e,t,n){void 0===n&&(n=1),this.width=e,this.height=t,this.depth=n,this.baseWidth=e,this.baseHeight=t,this.baseDepth=n,this._size=e*t*n},e.prototype._rebuild=function(){var t,n=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case e.DATASOURCE_TEMP:return;case e.DATASOURCE_URL:return void(t=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){t._swapAndDie(n),n.isReady=!0},null,this._buffer,void 0,this.format));case e.DATASOURCE_RAW:return(t=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_RAW3D:return(t=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_DYNAMIC:return(t=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case e.DATASOURCE_RENDERTARGET:var r=new i.a;if(r.generateDepthBuffer=this._generateDepthBuffer,r.generateMipMaps=this.generateMipMaps,r.generateStencilBuffer=this._generateStencilBuffer,r.samplingMode=this.samplingMode,r.type=this.type,this.isCube)t=this._engine.createRenderTargetCubeTexture(this.width,r);else{var a={width:this.width,height:this.height};t=this._engine.createRenderTargetTexture(a,r)}return t._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_DEPTHTEXTURE:var s={bilinearFiltering:this.samplingMode!==o.a.TEXTURE_BILINEAR_SAMPLINGMODE,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube};return(t=this._engine.createDepthStencilTexture({width:this.width,height:this.height},s))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_CUBE:return void(t=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){t._swapAndDie(n),n.isReady=!0},null,this.format,this._extension));case e.DATASOURCE_CUBERAW:return(t=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case e.DATASOURCE_CUBERAW_RGBD:return t=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(t,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){t._swapAndDie(n),n.isReady=!0});case e.DATASOURCE_CUBEPREFILTERED:return void((t=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(n),n.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},e.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow);var t=this._engine.getLoadedTexturesCache(),n=t.indexOf(this);-1!==n&&t.splice(n,1)},e.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},e._UpdateRGBDAsync=function(e,t,n,r,i){throw a.a.WarnImport("environmentTextureTools")},e.DATASOURCE_UNKNOWN=0,e.DATASOURCE_URL=1,e.DATASOURCE_TEMP=2,e.DATASOURCE_RAW=3,e.DATASOURCE_DYNAMIC=4,e.DATASOURCE_RENDERTARGET=5,e.DATASOURCE_MULTIRENDERTARGET=6,e.DATASOURCE_CUBE=7,e.DATASOURCE_CUBERAW=8,e.DATASOURCE_CUBEPREFILTERED=9,e.DATASOURCE_RAW3D=10,e.DATASOURCE_DEPTHTEXTURE=11,e.DATASOURCE_CUBERAW_RGBD=12,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(6),i=n(34),o=n(0),a=n(24),s=n(11),l=n(37);s.a._PhysicsImpostorParser=function(e,t,n){return new u(t,n.physicsImpostor,{mass:n.physicsMass,friction:n.physicsFriction,restitution:n.physicsRestitution},e)};var u=function(){function e(e,t,n,i){var a=this;void 0===n&&(n={mass:0}),this.object=e,this.type=t,this._options=n,this._scene=i,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=o.x.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new o.q,this._tmpQuat2=new o.q,this.beforeStep=function(){a._physicsEngine&&(a.object.translate(a._deltaPosition,-1),a._deltaRotationConjugated&&a.object.rotationQuaternion&&a.object.rotationQuaternion.multiplyToRef(a._deltaRotationConjugated,a.object.rotationQuaternion),a.object.computeWorldMatrix(!1),a.object.parent&&a.object.rotationQuaternion?(a.getParentsRotation(),a._tmpQuat.multiplyToRef(a.object.rotationQuaternion,a._tmpQuat)):a._tmpQuat.copyFrom(a.object.rotationQuaternion||new o.q),a._options.disableBidirectionalTransformation||a.object.rotationQuaternion&&a._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(a,a.object.getAbsolutePosition(),a._tmpQuat),a._onBeforePhysicsStepCallbacks.forEach(function(e){e(a)}))},this.afterStep=function(){a._physicsEngine&&(a._onAfterPhysicsStepCallbacks.forEach(function(e){e(a)}),a._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(a),a.object.parent&&a.object.rotationQuaternion&&(a.getParentsRotation(),a._tmpQuat.conjugateInPlace(),a._tmpQuat.multiplyToRef(a.object.rotationQuaternion,a.object.rotationQuaternion)),a.object.setAbsolutePosition(a.object.position),a._deltaRotation&&a.object.rotationQuaternion&&a.object.rotationQuaternion.multiplyToRef(a._deltaRotation,a.object.rotationQuaternion),a.object.translate(a._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(e){if((a._onPhysicsCollideCallbacks.length||a.onCollideEvent)&&a._physicsEngine){var t=a._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&(a.onCollideEvent&&a.onCollideEvent(a,t),a._onPhysicsCollideCallbacks.filter(function(e){return-1!==e.otherImpostors.indexOf(t)}).forEach(function(e){e.callback(a,t)}))}},this.object?(!this._scene&&e.getScene&&(this._scene=e.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=o.q.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new o.q),this._options.mass=void 0===n.mass?0:n.mass,this._options.friction=void 0===n.friction?.2:n.friction,this._options.restitution=void 0===n.restitution?.2:n.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===n.pressure?200:n.pressure,this._options.stiffness=void 0===n.stiffness?1:n.stiffness,this._options.velocityIterations=void 0===n.velocityIterations?20:n.velocityIterations,this._options.positionIterations=void 0===n.positionIterations?20:n.positionIterations,this._options.fixedPoints=void 0===n.fixedPoints?0:n.fixedPoints,this._options.margin=void 0===n.margin?0:n.margin,this._options.damping=void 0===n.damping?0:n.damping,this._options.path=void 0===n.path?null:n.path,this._options.shape=void 0===n.shape?null:n.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&r.a.Warn("You must affect impostors to children before affecting impostor to parent.")):r.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):r.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(e){this.setMass(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.setBodyPressure?e.getBodyPressure(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyPressure&&t.setBodyPressure(this,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyStiffness?e.getBodyStiffness(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyStiffness&&t.setBodyStiffness(this,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyVelocityIterations?e.getBodyVelocityIterations(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyVelocityIterations&&t.setBodyVelocityIterations(this,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var e=this._physicsEngine.getPhysicsPlugin();return e.getBodyPositionIterations?e.getBodyPositionIterations(this):0},set:function(e){if(this._physicsEngine){var t=this._physicsEngine.getPhysicsPlugin();t.setBodyPositionIterations&&t.setBodyPositionIterations(this,e)}},enumerable:!0,configurable:!0}),e.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},e.prototype._getPhysicsParent=function(){return this.object.parent instanceof a.a?this.object.parent.physicsImpostor:null},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(e){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(e){this._parent=e},enumerable:!0,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var t=this.object.rotationQuaternion;this.object.rotationQuaternion=e.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var n=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=t,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),n}return e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},e.prototype.getParam=function(e){return this._options[e]},e.prototype.setParam=function(e,t){this._options[e]=t,this._bodyUpdateRequired=!0},e.prototype.setMass=function(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)},e.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):o.x.Zero()},e.prototype.setLinearVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)},e.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):o.x.Zero()},e.prototype.setAngularVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)},e.prototype.executeNativeFunction=function(e){this._physicsEngine&&e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(e){this._onBeforePhysicsStepCallbacks.push(e)},e.prototype.unregisterBeforePhysicsStep=function(e){var t=this._onBeforePhysicsStepCallbacks.indexOf(e);t>-1?this._onBeforePhysicsStepCallbacks.splice(t,1):r.a.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(e){this._onAfterPhysicsStepCallbacks.push(e)},e.prototype.unregisterAfterPhysicsStep=function(e){var t=this._onAfterPhysicsStepCallbacks.indexOf(e);t>-1?this._onAfterPhysicsStepCallbacks.splice(t,1):r.a.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(e,t){var n=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:n})},e.prototype.unregisterOnPhysicsCollide=function(e,t){var n=e instanceof Array?e:[e],i=-1;this._onPhysicsCollideCallbacks.some(function(e,r){if(e.callback===t&&e.otherImpostors.length===n.length){var o=e.otherImpostors.every(function(e){return n.indexOf(e)>-1});return o&&(i=r),o}return!1})?this._onPhysicsCollideCallbacks.splice(i,1):r.a.Warn("Function to remove was not found")},e.prototype.getParentsRotation=function(){var e=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);e;)e.rotationQuaternion?this._tmpQuat2.copyFrom(e.rotationQuaternion):o.q.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,e.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),e=e.parent;return this._tmpQuat},e.prototype.applyForce=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t),this},e.prototype.applyImpulse=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t),this},e.prototype.createJoint=function(e,t,n){var r=new l.e(t,n);return this.addJoint(e,r),this},e.prototype.addJoint=function(e,t){return this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine&&this._physicsEngine.addJoint(this,e,t),this},e.prototype.addAnchor=function(e,t,n,r,i){if(!this._physicsEngine)return this;var o=this._physicsEngine.getPhysicsPlugin();return o.appendAnchor?(this._physicsEngine&&o.appendAnchor(this,e,t,n,r,i),this):this},e.prototype.addHook=function(e,t,n,r){if(!this._physicsEngine)return this;var i=this._physicsEngine.getPhysicsPlugin();return i.appendAnchor?(this._physicsEngine&&i.appendHook(this,e,t,n,r),this):this},e.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},e.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},e.prototype.clone=function(t){return t?new e(t,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var e=this;this._physicsEngine&&(this._joints.forEach(function(t){e._physicsEngine&&e._physicsEngine.removeJoint(e,t.otherImpostor,t.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},e.prototype.setDeltaPosition=function(e){this._deltaPosition.copyFrom(e)},e.prototype.setDeltaRotation=function(e){this._deltaRotation||(this._deltaRotation=new o.q),this._deltaRotation.copyFrom(e),this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.prototype.getBoxSizeToRef=function(e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,e),this},e.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},e.prototype.syncBoneWithImpostor=function(t,n,r,i,a){var s=e._tmpVecs[0],l=this.object;if(l.rotationQuaternion)if(a){var u=e._tmpQuat;l.rotationQuaternion.multiplyToRef(a,u),t.setRotationQuaternion(u,o.s.WORLD,n)}else t.setRotationQuaternion(l.rotationQuaternion,o.s.WORLD,n);s.x=0,s.y=0,s.z=0,r&&(s.x=r.x,s.y=r.y,s.z=r.z,t.getDirectionToRef(s,n,s),null==i&&(i=r.length()),s.x*=i,s.y*=i,s.z*=i),t.getParent()?(s.addInPlace(l.getAbsolutePosition()),t.setAbsolutePosition(s,n)):(n.setAbsolutePosition(l.getAbsolutePosition()),n.position.x-=s.x,n.position.y-=s.y,n.position.z-=s.z)},e.prototype.syncImpostorWithBone=function(t,n,r,i,a,s){var l=this.object;if(l.rotationQuaternion)if(a){var u=e._tmpQuat;t.getRotationQuaternionToRef(o.s.WORLD,n,u),u.multiplyToRef(a,l.rotationQuaternion)}else t.getRotationQuaternionToRef(o.s.WORLD,n,l.rotationQuaternion);var c=e._tmpVecs[0],h=e._tmpVecs[1];s||((s=e._tmpVecs[2]).x=0,s.y=1,s.z=0),t.getDirectionToRef(s,n,h),t.getAbsolutePositionToRef(n,c),null==i&&r&&(i=r.length()),null!=i&&(c.x+=h.x*i,c.y+=h.y*i,c.z+=h.z*i),l.setAbsolutePosition(c)},e.DEFAULT_OBJECT_SIZE=new o.x(1,1,1),e.IDENTITY_QUATERNION=o.q.Identity(),e._tmpVecs=i.a.BuildArray(3,o.x.Zero),e._tmpQuat=o.q.Identity(),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=4,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e.ConvexHullImpostor=10,e.RopeImpostor=101,e.ClothImpostor=102,e.SoftbodyImpostor=103,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n(1),i=function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e.prototype.contains=function(e){return-1!==this.indexOf(e)},e._GlobalId=0,e}(),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return r.d(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var n=(e.data||e)[t];this.pushNoDuplicate(n)}}},t}(i)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(9),i=n(104),o=function(){function e(){}return e.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(n){return e.AddTagsTo(t,n)},t.removeTags=function(n){return e.RemoveTagsFrom(t,n)},t.matchesTagsQuery=function(n){return e.MatchesQuery(t,n)}},e.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},e.HasTags=function(e){return!!e._tags&&!r.h.IsEmpty(e._tags)},e.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var n=[];for(var r in e._tags)e._tags.hasOwnProperty(r)&&!0===e._tags[r]&&n.push(r);return n.join(" ")}return e._tags},e.AddTagsTo=function(t,n){n&&"string"==typeof n&&n.split(" ").forEach(function(n,r,i){e._AddTagTo(t,n)})},e._AddTagTo=function(t,n){""!==(n=n.trim())&&"true"!==n&&"false"!==n&&(n.match(/[\s]/)||n.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[n]=!0))},e.RemoveTagsFrom=function(t,n){if(e.HasTags(t)){var r=n.split(" ");for(var i in r)e._RemoveTagFrom(t,r[i])}},e._RemoveTagFrom=function(e,t){delete e._tags[t]},e.MatchesQuery=function(t,n){return void 0===n||(""===n?e.HasTags(t):i.a.Eval(n,function(n){return e.HasTags(t)&&t._tags[n]}))},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this.environmentTexture=null}return e.AddParser=function(e,t){this._BabylonFileParsers[e]=t},e.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},e.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},e.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},e.Parse=function(e,t,n,r){for(var i in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(i)&&this._BabylonFileParsers[i](e,t,n,r)},e._BabylonFileParsers={},e._IndividualBabylonFileParsers={},e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return h});var r=n(1),i=n(2),o=n(8),a=n(9),s=n(0),l=n(64),u=n(93),c=function(e){function t(){var t=e.call(this)||this;return t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.rebuild(),t}return r.d(t,e),t}(l.a),h=function(){function e(){this.colorCurves=new u.a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new s.f(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new o.c}return Object.defineProperty(e.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),e.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},e.prototype.getClassName=function(){return"ImageProcessingConfiguration"},e.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&u.a.PrepareUniforms(e)},e.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},e.prototype.prepareDefines=function(t,n){if(void 0===n&&(n=!1),n!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);switch(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case e.TONEMAPPING_ACES:t.TONEMAPPING_ACES=!0;break;default:t.TONEMAPPING_ACES=!1}t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},e.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},e.prototype.bind=function(e,t){if(void 0===t&&(t=1),this._colorCurvesEnabled&&this.colorCurves&&u.a.Bind(this.colorCurves,e),this._vignetteEnabled){var n=1/e.getEngine().getRenderWidth(),r=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",n,r);var i=Math.tan(.5*this.vignetteCameraFov),o=i*t,s=Math.sqrt(o*i);o=a.h.Mix(o,s,this.vignetteStretch),i=a.h.Mix(i,s,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,i,-o*this.vignetteCentreX,-i*this.vignetteCentreY);var l=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var c=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(c-1)/c,.5/c,c,this.colorGradingTexture.level)}},e.prototype.clone=function(){return i.a.Clone(function(){return new e},this)},e.prototype.serialize=function(){return i.a.Serialize(this)},e.Parse=function(t){return i.a.Parse(function(){return new e},t,null,null)},Object.defineProperty(e,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(e,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,r.c([Object(i.g)()],e.prototype,"colorCurves",void 0),r.c([Object(i.c)()],e.prototype,"_colorCurvesEnabled",void 0),r.c([Object(i.m)("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),r.c([Object(i.c)()],e.prototype,"_colorGradingEnabled",void 0),r.c([Object(i.c)()],e.prototype,"_colorGradingWithGreenDepth",void 0),r.c([Object(i.c)()],e.prototype,"_colorGradingBGR",void 0),r.c([Object(i.c)()],e.prototype,"_exposure",void 0),r.c([Object(i.c)()],e.prototype,"_toneMappingEnabled",void 0),r.c([Object(i.c)()],e.prototype,"_toneMappingType",void 0),r.c([Object(i.c)()],e.prototype,"_contrast",void 0),r.c([Object(i.c)()],e.prototype,"vignetteStretch",void 0),r.c([Object(i.c)()],e.prototype,"vignetteCentreX",void 0),r.c([Object(i.c)()],e.prototype,"vignetteCentreY",void 0),r.c([Object(i.c)()],e.prototype,"vignetteWeight",void 0),r.c([Object(i.f)()],e.prototype,"vignetteColor",void 0),r.c([Object(i.c)()],e.prototype,"vignetteCameraFov",void 0),r.c([Object(i.c)()],e.prototype,"_vignetteBlendMode",void 0),r.c([Object(i.c)()],e.prototype,"_vignetteEnabled",void 0),r.c([Object(i.c)()],e.prototype,"_applyByPostProcess",void 0),r.c([Object(i.c)()],e.prototype,"_isEnabled",void 0),e}();i.a._ImageProcessingConfigurationParser=h.Parse},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=function(e,t){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null:null},i=function(){function e(){}return e.DeepCopy=function(e,t,n,i){for(var o in e)if(("_"!==o[0]||i&&-1!==i.indexOf(o))&&(!n||-1===n.indexOf(o))){var a=e[o],s=typeof a;if("function"!==s)try{if("object"===s)if(a instanceof Array){if(t[o]=[],a.length>0)if("object"==typeof a[0])for(var l=0;l<a.length;l++){var u=r(a[l],t);-1===t[o].indexOf(u)&&t[o].push(u)}else t[o]=a.slice(0)}else t[o]=r(a,t);else t[o]=a}catch(e){}}},e}()},function(e,t,n){"use strict";var r=n(1),i=n(2),o=n(28),a=n(16),s=n(0),l=n(4),u=n(31),c=n(5),h=n(64),d=n(75),f=n(15),p=n(7),m=n(22),g=n(18);c.a.IncludesShadersStore.defaultFragmentDeclaration="uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",c.a.IncludesShadersStore.defaultUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nfloat visibility;\nvec4 vDiffuseColor;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};\n",n(56),n(84),n(85),n(120),n(112),c.a.IncludesShadersStore.fresnelFunction="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",n(113),n(86),n(87),n(121),n(95),n(88),n(98),n(89),n(122),n(123),n(114),n(115),n(99),c.a.ShadersStore.defaultPixelShader="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb;\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor=toGammaSpace(refractionColor);\n#endif\nrefractionColor*=vRefractionInfos.x;\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb;\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor=toGammaSpace(reflectionColor);\n#endif\nreflectionColor*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=color;\n}\n",c.a.IncludesShadersStore.defaultVertexDeclaration="\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",n(67),n(68),n(124),n(96),n(100),n(101),n(102),n(103),n(69),n(70),n(125),n(90),n(116),n(117),c.a.IncludesShadersStore.pointCloudVertex="#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",n(118),c.a.ShadersStore.defaultVertexShader="#include<__decl__defaultVertex>\n\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#endif\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";var _=n(3);n.d(t,"b",function(){return v}),n.d(t,"a",function(){return y});var v=function(e){function t(){var t=e.call(this)||this;return t.MAINUV1=!1,t.MAINUV2=!1,t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.OPACITY=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.SPECULAR=!1,t.SPECULARDIRECTUV=0,t.BUMP=!1,t.BUMPDIRECTUV=0,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.SPECULAROVERALPHA=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHAFROMDIFFUSE=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.DIFFUSEFRESNEL=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONFRESNEL=!1,t.REFRACTIONFRESNEL=!1,t.EMISSIVEFRESNEL=!1,t.FRESNEL=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.BONETEXTURE=!1,t.INSTANCES=!1,t.GLOSSINESS=!1,t.ROUGHNESS=!1,t.EMISSIVEASILLUMINATION=!1,t.LINKEMISSIVEWITHDIFFUSE=!1,t.REFLECTIONFRESNELFROMSPECULAR=!1,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.LOGARITHMICDEPTH=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFLECTIONOVERALPHA=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.NONUNIFORMSCALING=!1,t.PREMULTIPLYALPHA=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.MULTIVIEW=!1,t.IS_REFLECTION_LINEAR=!1,t.IS_REFRACTION_LINEAR=!1,t.EXPOSURE=!1,t.rebuild(),t}return r.d(t,e),t.prototype.setReflectionMode=function(e){for(var t=0,n=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<n.length;t++){var r=n[t];this[r]=r===e}},t}(h.a),y=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i._diffuseTexture=null,i._ambientTexture=null,i._opacityTexture=null,i._reflectionTexture=null,i._emissiveTexture=null,i._specularTexture=null,i._bumpTexture=null,i._lightmapTexture=null,i._refractionTexture=null,i.ambientColor=new s.e(0,0,0),i.diffuseColor=new s.e(1,1,1),i.specularColor=new s.e(1,1,1),i.emissiveColor=new s.e(0,0,0),i.specularPower=64,i._useAlphaFromDiffuseTexture=!1,i._useEmissiveAsIllumination=!1,i._linkEmissiveWithDiffuse=!1,i._useSpecularOverAlpha=!1,i._useReflectionOverAlpha=!1,i._disableLighting=!1,i._useObjectSpaceNormalMap=!1,i._useParallax=!1,i._useParallaxOcclusion=!1,i.parallaxScaleBias=.05,i._roughness=0,i.indexOfRefraction=.98,i.invertRefractionY=!0,i.alphaCutOff=.4,i._useLightmapAsShadowmap=!1,i._useReflectionFresnelFromSpecular=!1,i._useGlossinessFromSpecularMapAlpha=!1,i._maxSimultaneousLights=4,i._invertNormalMapX=!1,i._invertNormalMapY=!1,i._twoSidedLighting=!1,i._renderTargets=new o.a(16),i._worldViewProjectionMatrix=s.j.Zero(),i._globalAmbientColor=new s.e(0,0,0),i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),t.ReflectionTextureEnabled&&i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),t.RefractionTextureEnabled&&i._refractionTexture&&i._refractionTexture.isRenderTarget&&i._renderTargets.push(i._refractionTexture),i._renderTargets},i}return r.d(t,e),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(t.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(t.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},t.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},t.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},t.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},t.prototype.isReadyForSubMesh=function(e,n,r){if(void 0===r&&(r=!1),n.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;n._materialDefines||(n._materialDefines=new v);var i=this.getScene(),o=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&o._renderId===i.getRenderId())return!0;var a=i.getEngine();if(o._needNormals=f.a.PrepareDefinesForLights(i,e,o,!0,this._maxSimultaneousLights,this._disableLighting),f.a.PrepareDefinesForMultiview(i,o),o._areTexturesDirty){if(o._needUVs=!1,o.MAINUV1=!1,o.MAINUV2=!1,i.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._diffuseTexture,o,"DIFFUSE")}else o.DIFFUSE=!1;if(this._ambientTexture&&t.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._ambientTexture,o,"AMBIENT")}else o.AMBIENT=!1;if(this._opacityTexture&&t.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._opacityTexture,o,"OPACITY"),o.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else o.OPACITY=!1;if(this._reflectionTexture&&t.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(o._needNormals=!0,o.REFLECTION=!0,o.ROUGHNESS=this._roughness>0,o.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,o.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===p.a.INVCUBIC_MODE,o.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case p.a.EXPLICIT_MODE:o.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case p.a.PLANAR_MODE:o.setReflectionMode("REFLECTIONMAP_PLANAR");break;case p.a.PROJECTION_MODE:o.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case p.a.SKYBOX_MODE:o.setReflectionMode("REFLECTIONMAP_SKYBOX"),o.REFLECTIONMAP_SKYBOX_TRANSFORMED=!this._reflectionTexture.getReflectionTextureMatrix().isIdentity();break;case p.a.SPHERICAL_MODE:o.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case p.a.EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case p.a.FIXED_EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case p.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case p.a.CUBIC_MODE:case p.a.INVCUBIC_MODE:default:o.setReflectionMode("REFLECTIONMAP_CUBIC")}o.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else o.REFLECTION=!1;if(this._emissiveTexture&&t.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._emissiveTexture,o,"EMISSIVE")}else o.EMISSIVE=!1;if(this._lightmapTexture&&t.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._lightmapTexture,o,"LIGHTMAP"),o.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else o.LIGHTMAP=!1;if(this._specularTexture&&t.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;f.a.PrepareDefinesForMergedUV(this._specularTexture,o,"SPECULAR"),o.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else o.SPECULAR=!1;if(i.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&t.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;f.a.PrepareDefinesForMergedUV(this._bumpTexture,o,"BUMP"),o.PARALLAX=this._useParallax,o.PARALLAXOCCLUSION=this._useParallaxOcclusion,o.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else o.BUMP=!1;if(this._refractionTexture&&t.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;o._needUVs=!0,o.REFRACTION=!0,o.REFRACTIONMAP_3D=this._refractionTexture.isCube}else o.REFRACTION=!1;o.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else o.DIFFUSE=!1,o.AMBIENT=!1,o.OPACITY=!1,o.REFLECTION=!1,o.EMISSIVE=!1,o.LIGHTMAP=!1,o.BUMP=!1,o.REFRACTION=!1;o.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),o.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,o.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,o.SPECULAROVERALPHA=this._useSpecularOverAlpha,o.PREMULTIPLYALPHA=this.alphaMode===_.a.ALPHA_PREMULTIPLIED||this.alphaMode===_.a.ALPHA_PREMULTIPLIED_PORTERDUFF}if(o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o),o.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,o.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(o._areFresnelDirty&&(t.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(o.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,o.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,o.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,o.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,o.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,o.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,o._needNormals=!0,o.FRESNEL=!0):o.FRESNEL=!1),f.a.PrepareDefinesForMisc(e,i,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),o),f.a.PrepareDefinesForAttributes(e,o,!0,!0,!0),f.a.PrepareDefinesForFrameBoundValues(i,a,o,r),o.isDirty){o.markAsProcessed();var s=new c.c;o.REFLECTION&&s.addFallback(0,"REFLECTION"),o.SPECULAR&&s.addFallback(0,"SPECULAR"),o.BUMP&&s.addFallback(0,"BUMP"),o.PARALLAX&&s.addFallback(1,"PARALLAX"),o.PARALLAXOCCLUSION&&s.addFallback(0,"PARALLAXOCCLUSION"),o.SPECULAROVERALPHA&&s.addFallback(0,"SPECULAROVERALPHA"),o.FOG&&s.addFallback(1,"FOG"),o.POINTSIZE&&s.addFallback(0,"POINTSIZE"),o.LOGARITHMICDEPTH&&s.addFallback(0,"LOGARITHMICDEPTH"),f.a.HandleFallbacksForShadows(o,s,this._maxSimultaneousLights),o.SPECULARTERM&&s.addFallback(0,"SPECULARTERM"),o.DIFFUSEFRESNEL&&s.addFallback(1,"DIFFUSEFRESNEL"),o.OPACITYFRESNEL&&s.addFallback(2,"OPACITYFRESNEL"),o.REFLECTIONFRESNEL&&s.addFallback(3,"REFLECTIONFRESNEL"),o.EMISSIVEFRESNEL&&s.addFallback(4,"EMISSIVEFRESNEL"),o.FRESNEL&&s.addFallback(4,"FRESNEL"),o.MULTIVIEW&&s.addFallback(0,"MULTIVIEW");var h=[l.b.PositionKind];o.NORMAL&&h.push(l.b.NormalKind),o.UV1&&h.push(l.b.UVKind),o.UV2&&h.push(l.b.UV2Kind),o.VERTEXCOLOR&&h.push(l.b.ColorKind),f.a.PrepareAttributesForBones(h,e,o,s),f.a.PrepareAttributesForInstances(h,o),f.a.PrepareAttributesForMorphTargets(h,e,o);var d="default",m=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],g=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],y=["Material","Scene"];u.a&&(u.a.PrepareUniforms(m,o),u.a.PrepareSamplers(g,o)),f.a.PrepareUniformsAndSamplersList({uniformsNames:m,uniformBuffersNames:y,samplers:g,defines:o,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(d=this.customShaderNameResolve(d,m,y,g,o));var b=o.toString(),E=n.effect,x=i.getEngine().createEffect(d,{attributes:h,uniformsNames:m,uniformBuffersNames:y,samplers:g,defines:b,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:o.NUM_MORPH_INFLUENCERS}},a);x&&(this.allowShaderHotSwapping&&E&&!x.isReady()?(x=E,o.markAsUnprocessed()):(i.resetCachedMaterial(),n.setEffect(x,o),this.buildUniformLayout()))}return!(!n.effect||!n.effect.isReady())&&(o._renderId=i.getRenderId(),this._wasPreviouslyReady=!0,!0)},t.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vDiffuseColor",4),e.create()},t.prototype.unbind=function(){if(this._activeEffect){var t=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),t=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),t=!0),t&&this._markAllSubMeshesAsTexturesDirty()}e.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(e,n,r){var i=this.getScene(),o=r._materialDefines;if(o){var l=r.effect;if(l){this._activeEffect=l,o.INSTANCES||this.bindOnlyWorldMatrix(e),o.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var u=this._mustRebind(i,l,n.visibility);f.a.BindBonesParameters(n,l);var c=this._uniformBuffer;if(u){if(c.bindToEffect(l,"Material"),this.bindViewProjection(l),!c.useUbo||!this.isFrozen||!c.isSync){if(t.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(c.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),c.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&c.updateColor4("opacityParts",new s.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(c.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),c.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(c.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),c.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(c.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),c.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),i.texturesEnabled){if(this._diffuseTexture&&t.DiffuseTextureEnabled&&(c.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),f.a.BindTextureMatrix(this._diffuseTexture,c,"diffuse"),this._diffuseTexture.hasAlpha&&l.setFloat("alphaCutOff",this.alphaCutOff)),this._ambientTexture&&t.AmbientTextureEnabled&&(c.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),f.a.BindTextureMatrix(this._ambientTexture,c,"ambient")),this._opacityTexture&&t.OpacityTextureEnabled&&(c.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),f.a.BindTextureMatrix(this._opacityTexture,c,"opacity")),this._reflectionTexture&&t.ReflectionTextureEnabled&&(c.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),c.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var h=this._reflectionTexture;c.updateVector3("vReflectionPosition",h.boundingBoxPosition),c.updateVector3("vReflectionSize",h.boundingBoxSize)}if(this._emissiveTexture&&t.EmissiveTextureEnabled&&(c.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),f.a.BindTextureMatrix(this._emissiveTexture,c,"emissive")),this._lightmapTexture&&t.LightmapTextureEnabled&&(c.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),f.a.BindTextureMatrix(this._lightmapTexture,c,"lightmap")),this._specularTexture&&t.SpecularTextureEnabled&&(c.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),f.a.BindTextureMatrix(this._specularTexture,c,"specular")),this._bumpTexture&&i.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&(c.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),f.a.BindTextureMatrix(this._bumpTexture,c,"bump"),i._mirroredCameraPosition?c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&t.RefractionTextureEnabled){var d=1;this._refractionTexture.isCube||(c.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(d=this._refractionTexture.depth)),c.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,d,this.invertRefractionY?-1:1)}}this.pointsCloud&&c.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&c.updateColor4("vSpecularColor",this.specularColor,this.specularPower),c.updateColor3("vEmissiveColor",t.EmissiveTextureEnabled?this.emissiveColor:s.e.BlackReadOnly),c.updateFloat("visibility",n.visibility),c.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}i.texturesEnabled&&(this._diffuseTexture&&t.DiffuseTextureEnabled&&l.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&t.AmbientTextureEnabled&&l.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&t.OpacityTextureEnabled&&l.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&t.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?l.setTexture("reflectionCubeSampler",this._reflectionTexture):l.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&t.EmissiveTextureEnabled&&l.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&t.LightmapTextureEnabled&&l.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&t.SpecularTextureEnabled&&l.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&i.getEngine().getCaps().standardDerivatives&&t.BumpTextureEnabled&&l.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&t.RefractionTextureEnabled)&&(d=1,this._refractionTexture.isCube?l.setTexture("refractionCubeSampler",this._refractionTexture):l.setTexture("refraction2DSampler",this._refractionTexture)),f.a.BindClipPlane(l,i),i.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),f.a.BindEyePosition(l,i),l.setColor3("vAmbientColor",this._globalAmbientColor)}!u&&this.isFrozen||(i.lightsEnabled&&!this._disableLighting&&f.a.BindLights(i,n,l,o,this._maxSimultaneousLights),(i.fogEnabled&&n.applyFog&&i.fogMode!==a.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(l),f.a.BindFogParameters(i,n,l),o.NUM_MORPH_INFLUENCERS&&f.a.BindMorphTargetParameters(n,l),f.a.BindLogDepth(o,l,i),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),c.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._specularTexture&&t.push(this._specularTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this._refractionTexture&&t.push(this._refractionTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._diffuseTexture===t||this._ambientTexture===t||this._opacityTexture===t||this._reflectionTexture===t||this._emissiveTexture===t||this._specularTexture===t||this._bumpTexture===t||this._lightmapTexture===t||this._refractionTexture===t},t.prototype.dispose=function(t,n){n&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t,n)},t.prototype.clone=function(e){var n=this,r=i.a.Clone(function(){return new t(e,n.getScene())},this);return r.name=e,r.id=e,r},t.prototype.serialize=function(){return i.a.Serialize(this)},t.Parse=function(e,n,r){return i.a.Parse(function(){return new t(e.name,n)},e,n,r)},Object.defineProperty(t,"DiffuseTextureEnabled",{get:function(){return g.a.DiffuseTextureEnabled},set:function(e){g.a.DiffuseTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AmbientTextureEnabled",{get:function(){return g.a.AmbientTextureEnabled},set:function(e){g.a.AmbientTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OpacityTextureEnabled",{get:function(){return g.a.OpacityTextureEnabled},set:function(e){g.a.OpacityTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ReflectionTextureEnabled",{get:function(){return g.a.ReflectionTextureEnabled},set:function(e){g.a.ReflectionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EmissiveTextureEnabled",{get:function(){return g.a.EmissiveTextureEnabled},set:function(e){g.a.EmissiveTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SpecularTextureEnabled",{get:function(){return g.a.SpecularTextureEnabled},set:function(e){g.a.SpecularTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"BumpTextureEnabled",{get:function(){return g.a.BumpTextureEnabled},set:function(e){g.a.BumpTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LightmapTextureEnabled",{get:function(){return g.a.LightmapTextureEnabled},set:function(e){g.a.LightmapTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"RefractionTextureEnabled",{get:function(){return g.a.RefractionTextureEnabled},set:function(e){g.a.RefractionTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorGradingTextureEnabled",{get:function(){return g.a.ColorGradingTextureEnabled},set:function(e){g.a.ColorGradingTextureEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FresnelEnabled",{get:function(){return g.a.FresnelEnabled},set:function(e){g.a.FresnelEnabled=e},enumerable:!0,configurable:!0}),r.c([Object(i.m)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"diffuseTexture",void 0),r.c([Object(i.m)("ambientTexture")],t.prototype,"_ambientTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),r.c([Object(i.m)("opacityTexture")],t.prototype,"_opacityTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),r.c([Object(i.m)("reflectionTexture")],t.prototype,"_reflectionTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),r.c([Object(i.m)("emissiveTexture")],t.prototype,"_emissiveTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),r.c([Object(i.m)("specularTexture")],t.prototype,"_specularTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularTexture",void 0),r.c([Object(i.m)("bumpTexture")],t.prototype,"_bumpTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),r.c([Object(i.m)("lightmapTexture")],t.prototype,"_lightmapTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"lightmapTexture",void 0),r.c([Object(i.m)("refractionTexture")],t.prototype,"_refractionTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionTexture",void 0),r.c([Object(i.e)("ambient")],t.prototype,"ambientColor",void 0),r.c([Object(i.e)("diffuse")],t.prototype,"diffuseColor",void 0),r.c([Object(i.e)("specular")],t.prototype,"specularColor",void 0),r.c([Object(i.e)("emissive")],t.prototype,"emissiveColor",void 0),r.c([Object(i.c)()],t.prototype,"specularPower",void 0),r.c([Object(i.c)("useAlphaFromDiffuseTexture")],t.prototype,"_useAlphaFromDiffuseTexture",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFromDiffuseTexture",void 0),r.c([Object(i.c)("useEmissiveAsIllumination")],t.prototype,"_useEmissiveAsIllumination",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useEmissiveAsIllumination",void 0),r.c([Object(i.c)("linkEmissiveWithDiffuse")],t.prototype,"_linkEmissiveWithDiffuse",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkEmissiveWithDiffuse",void 0),r.c([Object(i.c)("useSpecularOverAlpha")],t.prototype,"_useSpecularOverAlpha",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),r.c([Object(i.c)("useReflectionOverAlpha")],t.prototype,"_useReflectionOverAlpha",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useReflectionOverAlpha",void 0),r.c([Object(i.c)("disableLighting")],t.prototype,"_disableLighting",void 0),r.c([Object(i.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),r.c([Object(i.c)("useObjectSpaceNormalMap")],t.prototype,"_useObjectSpaceNormalMap",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),r.c([Object(i.c)("useParallax")],t.prototype,"_useParallax",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),r.c([Object(i.c)("useParallaxOcclusion")],t.prototype,"_useParallaxOcclusion",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),r.c([Object(i.c)()],t.prototype,"parallaxScaleBias",void 0),r.c([Object(i.c)("roughness")],t.prototype,"_roughness",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),r.c([Object(i.c)()],t.prototype,"indexOfRefraction",void 0),r.c([Object(i.c)()],t.prototype,"invertRefractionY",void 0),r.c([Object(i.c)()],t.prototype,"alphaCutOff",void 0),r.c([Object(i.c)("useLightmapAsShadowmap")],t.prototype,"_useLightmapAsShadowmap",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),r.c([Object(i.h)("diffuseFresnelParameters")],t.prototype,"_diffuseFresnelParameters",void 0),r.c([Object(i.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"diffuseFresnelParameters",void 0),r.c([Object(i.h)("opacityFresnelParameters")],t.prototype,"_opacityFresnelParameters",void 0),r.c([Object(i.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],t.prototype,"opacityFresnelParameters",void 0),r.c([Object(i.h)("reflectionFresnelParameters")],t.prototype,"_reflectionFresnelParameters",void 0),r.c([Object(i.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"reflectionFresnelParameters",void 0),r.c([Object(i.h)("refractionFresnelParameters")],t.prototype,"_refractionFresnelParameters",void 0),r.c([Object(i.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"refractionFresnelParameters",void 0),r.c([Object(i.h)("emissiveFresnelParameters")],t.prototype,"_emissiveFresnelParameters",void 0),r.c([Object(i.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"emissiveFresnelParameters",void 0),r.c([Object(i.c)("useReflectionFresnelFromSpecular")],t.prototype,"_useReflectionFresnelFromSpecular",void 0),r.c([Object(i.b)("_markAllSubMeshesAsFresnelDirty")],t.prototype,"useReflectionFresnelFromSpecular",void 0),r.c([Object(i.c)("useGlossinessFromSpecularMapAlpha")],t.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useGlossinessFromSpecularMapAlpha",void 0),r.c([Object(i.c)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),r.c([Object(i.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),r.c([Object(i.c)("invertNormalMapX")],t.prototype,"_invertNormalMapX",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),r.c([Object(i.c)("invertNormalMapY")],t.prototype,"_invertNormalMapY",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),r.c([Object(i.c)("twoSidedLighting")],t.prototype,"_twoSidedLighting",void 0),r.c([Object(i.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),r.c([Object(i.c)()],t.prototype,"useLogarithmicDepth",null),t}(d.a);m.a.RegisteredTypes["BABYLON.StandardMaterial"]=y,a.a.DefaultMaterialFactory=function(e){return new y("default material",e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.BuildArray=function(e,t){for(var n=[],r=0;r<e;++r)n.push(t());return n},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.GetDOMTextContent=function(e){for(var t="",n=e.firstChild;n;)3===n.nodeType&&(t+=n.textContent),n=n.nextSibling;return t},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(e,t,n,r,i,o){this.source=e,this.pointerX=t,this.pointerY=n,this.meshUnderPointer=r,this.sourceEvent=i,this.additionalData=o}return e.CreateNew=function(t,n,r){var i=t.getScene();return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer||t,n,r)},e.CreateNewFromSprite=function(t,n,r,i){return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,r,i)},e.CreateNewFromScene=function(t,n){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,n)},e.CreateNewFromPrimitive=function(t,n,r,i){return new e(t,n.x,n.y,null,r,i)},e}()},function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"a",function(){return o}),n.d(t,"d",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"b",function(){return l});var r=n(1),i=function(){function e(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}return Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(e){this._physicsJoint,this._physicsJoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(e){this._physicsPlugin=e},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(e){e(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e}(),o=function(e){function t(t){return e.call(this,i.DistanceJoint,t)||this}return r.d(t,e),t.prototype.updateDistance=function(e,t){this._physicsPlugin.updateDistanceJoint(this,e,t)},t}(i),a=function(e){function t(t,n){return e.call(this,t,n)||this}return r.d(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(i),s=function(e){function t(t){return e.call(this,i.HingeJoint,t)||this}return r.d(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(a),l=function(e){function t(t){return e.call(this,i.Hinge2Joint,t)||this}return r.d(t,e),t.prototype.setMotor=function(e,t,n){void 0===n&&(n=0),this._physicsPlugin.setMotor(this,e||0,t,n)},t.prototype.setLimit=function(e,t,n){void 0===n&&(n=0),this._physicsPlugin.setLimit(this,e,t,n)},t}(a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(1),i=n(2),o=n(0),a=n(25),s=n(63),l=n(22),u=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.diffuse=new o.e(1,1,1),i.specular=new o.e(1,1,1),i.falloffType=t.FALLOFF_DEFAULT,i.intensity=1,i._range=Number.MAX_VALUE,i._inverseSquaredRange=0,i._photometricScale=1,i._intensityMode=t.INTENSITYMODE_AUTOMATIC,i._radius=1e-5,i.renderPriority=0,i._shadowEnabled=!0,i._excludeWithLayerMask=0,i._includeOnlyWithLayerMask=0,i._lightmapMode=0,i._excludedMeshesIds=new Array,i._includedOnlyMeshesIds=new Array,i._isLight=!0,i.getScene().addLight(i),i._uniformBuffer=new s.a(i.getScene().getEngine()),i._buildUniformLayout(),i.includedOnlyMeshes=new Array,i.excludedMeshes=new Array,i._resyncMeshes(),i}return r.d(t,e),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)t+=", animation[0]: "+this.animations[n].toString(e);return t},t.prototype._syncParentEnabledState=function(){e.prototype._syncParentEnabledState.call(this),this._resyncMeshes()},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return o.x.Zero()},t.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&(0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)},t.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var r=0,i=this.getScene().meshes;r<i.length;r++)i[r]._removeLightSource(this);this._uniformBuffer.dispose(),this.getScene().removeLight(this),e.prototype.dispose.call(this,t,n)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e){var n=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());return n?i.a.Clone(n,this):null},t.prototype.serialize=function(){var e=i.a.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(function(t){e.excludedMeshesIds.push(t.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(t){e.includedOnlyMeshesIds.push(t.id)})),i.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.GetConstructorFromName=function(e,t,n){var r=a.a.Construct("Light_Type_"+e,t,n);return r||null},t.Parse=function(e,n){var r=t.GetConstructorFromName(e.type,e.name,n);if(!r)return null;var o=i.a.Parse(r,e,n);if(e.excludedMeshesIds&&(o._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(o._waitingParentId=e.parentId),void 0!==e.falloffType&&(o.falloffType=e.falloffType),void 0!==e.lightmapMode&&(o.lightmapMode=e.lightmapMode),e.animations){for(var s=0;s<e.animations.length;s++){var u=e.animations[s],c=l.a.GetClass("BABYLON.Animation");c&&o.animations.push(c.Parse(u))}a.a.ParseAnimationRanges(o,e,n)}return e.autoAnimate&&n.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),o},t.prototype._hookArrayForExcluded=function(e){var t=this,n=e.push;e.push=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];for(var o=n.apply(e,r),a=0,s=r;a<s.length;a++)s[a]._resyncLighSource(t);return o};var r=e.splice;e.splice=function(n,i){for(var o=r.apply(e,[n,i]),a=0,s=o;a<s.length;a++)s[a]._resyncLighSource(t);return o};for(var i=0,o=e;i<o.length;i++)o[i]._resyncLighSource(this)},t.prototype._hookArrayForIncludedOnly=function(e){var t=this,n=e.push;e.push=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=n.apply(e,r);return t._resyncMeshes(),o};var r=e.splice;e.splice=function(n,i){var o=r.apply(e,[n,i]);return t._resyncMeshes(),o},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++)t[e]._resyncLighSource(this)},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var n=t[e];-1!==n.lightSources.indexOf(this)&&n._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,n=this.getTypeID(),r=this.intensityMode;switch(r===t.INTENSITYMODE_AUTOMATIC&&(r=n===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),n){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(r){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var i=this.radius;i=Math.max(i,.001),e=2*Math.PI*(1-Math.cos(i))}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,r.c([Object(i.e)()],t.prototype,"diffuse",void 0),r.c([Object(i.e)()],t.prototype,"specular",void 0),r.c([Object(i.c)()],t.prototype,"falloffType",void 0),r.c([Object(i.c)()],t.prototype,"intensity",void 0),r.c([Object(i.c)()],t.prototype,"range",null),r.c([Object(i.c)()],t.prototype,"intensityMode",null),r.c([Object(i.c)()],t.prototype,"radius",null),r.c([Object(i.c)()],t.prototype,"_renderPriority",void 0),r.c([Object(i.b)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),r.c([Object(i.c)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),r.c([Object(i.c)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),r.c([Object(i.c)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),r.c([Object(i.c)("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(34),i=n(0),o=n(50),a=n(81),s=n(16),l=n(21),u=function(){function e(e,t,n){void 0===n&&(n=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=n}return e.prototype.intersectsBoxMinMax=function(t,n,r){void 0===r&&(r=0);var i,o,a,s,l=e.TmpVector3[0].copyFromFloats(t.x-r,t.y-r,t.z-r),u=e.TmpVector3[1].copyFromFloats(n.x+r,n.y+r,n.z+r),c=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<l.x||this.origin.x>u.x)return!1}else if(i=1/this.direction.x,o=(l.x-this.origin.x)*i,(a=(u.x-this.origin.x)*i)===-1/0&&(a=1/0),o>a&&(s=o,o=a,a=s),(c=Math.max(o,c))>(h=Math.min(a,h)))return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<l.y||this.origin.y>u.y)return!1}else if(i=1/this.direction.y,o=(l.y-this.origin.y)*i,(a=(u.y-this.origin.y)*i)===-1/0&&(a=1/0),o>a&&(s=o,o=a,a=s),(c=Math.max(o,c))>(h=Math.min(a,h)))return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<l.z||this.origin.z>u.z)return!1}else if(i=1/this.direction.z,o=(l.z-this.origin.z)*i,(a=(u.z-this.origin.z)*i)===-1/0&&(a=1/0),o>a&&(s=o,o=a,a=s),(c=Math.max(o,c))>(h=Math.min(a,h)))return!1;return!0},e.prototype.intersectsBox=function(e,t){return void 0===t&&(t=0),this.intersectsBoxMinMax(e.minimum,e.maximum,t)},e.prototype.intersectsSphere=function(e,t){void 0===t&&(t=0);var n=e.center.x-this.origin.x,r=e.center.y-this.origin.y,i=e.center.z-this.origin.z,o=n*n+r*r+i*i,a=e.radius+t,s=a*a;if(o<=s)return!0;var l=n*this.direction.x+r*this.direction.y+i*this.direction.z;return!(l<0)&&o-l*l<=s},e.prototype.intersectsTriangle=function(t,n,r){var o=e.TmpVector3[0],s=e.TmpVector3[1],l=e.TmpVector3[2],u=e.TmpVector3[3],c=e.TmpVector3[4];n.subtractToRef(t,o),r.subtractToRef(t,s),i.x.CrossToRef(this.direction,s,l);var h=i.x.Dot(o,l);if(0===h)return null;var d=1/h;this.origin.subtractToRef(t,u);var f=i.x.Dot(u,l)*d;if(f<0||f>1)return null;i.x.CrossToRef(u,o,c);var p=i.x.Dot(this.direction,c)*d;if(p<0||f+p>1)return null;var m=i.x.Dot(s,c)*d;return m>this.length?null:new a.a(f,p,m)},e.prototype.intersectsPlane=function(e){var t,n=i.x.Dot(e.normal,this.direction);if(Math.abs(n)<9.99999997475243e-7)return null;var r=i.x.Dot(e.normal,this.origin);return(t=(-e.d-r)/n)<0?t<-9.99999997475243e-7?null:0:t},e.prototype.intersectsMesh=function(t,n){var r=i.t.Matrix[0];return t.getWorldMatrix().invertToRef(r),this._tmpRay?e.TransformToRef(this,r,this._tmpRay):this._tmpRay=e.Transform(this,r),t.intersects(this._tmpRay,n)},e.prototype.intersectsMeshes=function(e,t,n){n?n.length=0:n=[];for(var r=0;r<e.length;r++){var i=this.intersectsMesh(e[r],t);i.hit&&n.push(i)}return n.sort(this._comparePickingInfo),n},e.prototype._comparePickingInfo=function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0},e.prototype.intersectionSegment=function(t,n,r){var o=this.origin,a=i.t.Vector3[0],s=i.t.Vector3[1],l=i.t.Vector3[2],u=i.t.Vector3[3];n.subtractToRef(t,a),this.direction.scaleToRef(e.rayl,l),o.addToRef(l,s),t.subtractToRef(o,u);var c,h,d,f,p=i.x.Dot(a,a),m=i.x.Dot(a,l),g=i.x.Dot(l,l),_=i.x.Dot(a,u),v=i.x.Dot(l,u),y=p*g-m*m,b=y,E=y;y<e.smallnum?(h=0,b=1,f=v,E=g):(f=p*v-m*_,(h=m*v-g*_)<0?(h=0,f=v,E=g):h>b&&(h=b,f=v+m,E=g)),f<0?(f=0,-_<0?h=0:-_>p?h=b:(h=-_,b=p)):f>E&&(f=E,-_+m<0?h=0:-_+m>p?h=b:(h=-_+m,b=p)),c=Math.abs(h)<e.smallnum?0:h/b,d=Math.abs(f)<e.smallnum?0:f/E;var x=i.t.Vector3[4];l.scaleToRef(d,x);var T=i.t.Vector3[5];a.scaleToRef(c,T),T.addInPlace(u);var S=i.t.Vector3[6];return T.subtractToRef(x,S),d>0&&d<=this.length&&S.lengthSquared()<r*r?T.length():-1},e.prototype.update=function(e,t,n,r,i,o,a){return this.unprojectRayToRef(e,t,n,r,i,o,a),this},e.Zero=function(){return new e(i.x.Zero(),i.x.Zero())},e.CreateNew=function(t,n,r,i,o,a,s){return e.Zero().update(t,n,r,i,o,a,s)},e.CreateNewFromTo=function(t,n,r){void 0===r&&(r=i.j.IdentityReadOnly);var o=n.subtract(t),a=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return o.normalize(),e.Transform(new e(t,o,a),r)},e.Transform=function(t,n){var r=new e(new i.x(0,0,0),new i.x(0,0,0));return e.TransformToRef(t,n,r),r},e.TransformToRef=function(e,t,n){i.x.TransformCoordinatesToRef(e.origin,t,n.origin),i.x.TransformNormalToRef(e.direction,t,n.direction),n.length=e.length;var r=n.direction,o=r.length();if(0!==o&&1!==o){var a=1/o;r.x*=a,r.y*=a,r.z*=a,n.length*=o}},e.prototype.unprojectRayToRef=function(e,t,n,r,o,a,s){var l=i.t.Matrix[0];o.multiplyToRef(a,l),l.multiplyToRef(s,l),l.invert();var u=i.t.Vector3[0];u.x=e/n*2-1,u.y=-(t/r*2-1),u.z=-1;var c=i.t.Vector3[1].copyFromFloats(u.x,u.y,1),h=i.t.Vector3[2],d=i.t.Vector3[3];i.x._UnprojectFromInvertedMatrixToRef(u,l,h),i.x._UnprojectFromInvertedMatrixToRef(c,l,d),this.origin.copyFrom(h),d.subtractToRef(h,this.direction),this.direction.normalize()},e.TmpVector3=r.a.BuildArray(6,i.x.Zero),e.smallnum=1e-8,e.rayl=1e9,e}();s.a.prototype.createPickingRay=function(e,t,n,r,i){void 0===i&&(i=!1);var o=u.Zero();return this.createPickingRayToRef(e,t,n,o,r,i),o},s.a.prototype.createPickingRayToRef=function(e,t,n,r,o,a){void 0===a&&(a=!1);var s=this.getEngine();if(!o){if(!this.activeCamera)throw new Error("Active camera not set");o=this.activeCamera}var l=o.viewport.toGlobal(s.getRenderWidth(),s.getRenderHeight());return e=e/s.getHardwareScalingLevel()-l.x,t=t/s.getHardwareScalingLevel()-(s.getRenderHeight()-l.y-l.height),r.update(e,t,l.width,l.height,n||i.j.IdentityReadOnly,a?i.j.IdentityReadOnly:o.getViewMatrix(),o.getProjectionMatrix()),this},s.a.prototype.createPickingRayInCameraSpace=function(e,t,n){var r=u.Zero();return this.createPickingRayInCameraSpaceToRef(e,t,r,n),r},s.a.prototype.createPickingRayInCameraSpaceToRef=function(e,t,n,r){if(!o.a)return this;var a=this.getEngine();if(!r){if(!this.activeCamera)throw new Error("Active camera not set");r=this.activeCamera}var s=r.viewport.toGlobal(a.getRenderWidth(),a.getRenderHeight()),l=i.j.Identity();return e=e/a.getHardwareScalingLevel()-s.x,t=t/a.getHardwareScalingLevel()-(a.getRenderHeight()-s.y-s.height),n.update(e,t,s.width,s.height,l,l,r.getProjectionMatrix()),this},s.a.prototype._internalPick=function(e,t,n,r){if(!o.a)return null;for(var i=null,a=0;a<this.meshes.length;a++){var s=this.meshes[a];if(t){if(!t(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var l=e(s.getWorldMatrix()),u=s.intersects(l,n,r);if(u&&u.hit&&(n||null==i||!(u.distance>=i.distance))&&(i=u,n))break}return i||new o.a},s.a.prototype._internalMultiPick=function(e,t,n){if(!o.a)return null;for(var r=new Array,i=0;i<this.meshes.length;i++){var a=this.meshes[i];if(t){if(!t(a))continue}else if(!a.isEnabled()||!a.isVisible||!a.isPickable)continue;var s=e(a.getWorldMatrix()),l=a.intersects(s,!1,n);l&&l.hit&&r.push(l)}return r},s.a.prototype.pick=function(e,t,n,r,a,s){var l=this;if(!o.a)return null;var c=this._internalPick(function(n){return l._tempPickingRay||(l._tempPickingRay=u.Zero()),l.createPickingRayToRef(e,t,n,l._tempPickingRay,a||null),l._tempPickingRay},n,r,s);return c&&(c.ray=this.createPickingRay(e,t,i.j.Identity(),a||null)),c},s.a.prototype.pickWithRay=function(e,t,n,r){var o=this,a=this._internalPick(function(t){return o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=i.j.Identity()),t.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=u.Zero()),u.TransformToRef(e,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform},t,n,r);return a&&(a.ray=e),a},s.a.prototype.multiPick=function(e,t,n,r,i){var o=this;return this._internalMultiPick(function(n){return o.createPickingRay(e,t,n,r||null)},n,i)},s.a.prototype.multiPickWithRay=function(e,t,n){var r=this;return this._internalMultiPick(function(t){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=i.j.Identity()),t.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=u.Zero()),u.TransformToRef(e,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform},t,n)},l.a.prototype.getForwardRay=function(e,t,n){void 0===e&&(e=100),t||(t=this.getWorldMatrix()),n||(n=this.position);var r=this._scene.useRightHandedSystem?new i.x(0,0,-1):new i.x(0,0,1),o=i.x.TransformNormal(r,t),a=i.x.Normalize(o);return new u(n,a,e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(0),i=n(11),o=n(13),a=n(72),s=n(4);o.a.CreateLineSystem=function(e){for(var t=[],n=[],r=e.lines,i=e.colors,a=[],s=0,l=0;l<r.length;l++)for(var u=r[l],c=0;c<u.length;c++){if(n.push(u[c].x,u[c].y,u[c].z),i){var h=i[l];a.push(h[c].r,h[c].g,h[c].b,h[c].a)}c>0&&(t.push(s-1),t.push(s)),s++}var d=new o.a;return d.indices=t,d.positions=n,i&&(d.colors=a),d},o.a.CreateDashedLines=function(e){var t,n,i=e.dashSize||3,a=e.gapSize||1,s=e.dashNb||200,l=e.points,u=new Array,c=new Array,h=r.x.Zero(),d=0,f=0,p=0,m=0,g=0;for(g=0;g<l.length-1;g++)l[g+1].subtractToRef(l[g],h),d+=h.length();for(n=i*(t=d/s)/(i+a),g=0;g<l.length-1;g++){l[g+1].subtractToRef(l[g],h),f=Math.floor(h.length()/t),h.normalize();for(var _=0;_<f;_++)p=t*_,u.push(l[g].x+p*h.x,l[g].y+p*h.y,l[g].z+p*h.z),u.push(l[g].x+(p+n)*h.x,l[g].y+(p+n)*h.y,l[g].z+(p+n)*h.z),c.push(m,m+1),m+=2}var v=new o.a;return v.positions=u,v.indices=c,v},i.a.CreateLines=function(e,t,n,r,i){void 0===n&&(n=null),void 0===r&&(r=!1),void 0===i&&(i=null);var o={points:t,updatable:r,instance:i};return l.CreateLines(e,o,n)},i.a.CreateDashedLines=function(e,t,n,r,i,o,a,s){void 0===o&&(o=null);var u={points:t,dashSize:n,gapSize:r,dashNb:i,updatable:a,instance:s};return l.CreateDashedLines(e,u,o)};var l=function(){function e(){}return e.CreateLineSystem=function(e,t,n){var r=t.instance,i=t.lines,l=t.colors;if(r){var u,c,h=r.getVerticesData(s.b.PositionKind);l&&(u=r.getVerticesData(s.b.ColorKind));for(var d=0,f=0,p=0;p<i.length;p++)for(var m=i[p],g=0;g<m.length;g++)h[d]=m[g].x,h[d+1]=m[g].y,h[d+2]=m[g].z,l&&u&&(c=l[p],u[f]=c[g].r,u[f+1]=c[g].g,u[f+2]=c[g].b,u[f+3]=c[g].a,f+=4),d+=3;return r.updateVerticesData(s.b.PositionKind,h,!1,!1),l&&u&&r.updateVerticesData(s.b.ColorKind,u,!1,!1),r}var _=!!l,v=new a.b(e,n,null,void 0,void 0,_,t.useVertexAlpha);return o.a.CreateLineSystem(t).applyToMesh(v,t.updatable),v},e.CreateLines=function(t,n,r){void 0===r&&(r=null);var i=n.colors?[n.colors]:null;return e.CreateLineSystem(t,{lines:[n.points],updatable:n.updatable,instance:n.instance,colors:i,useVertexAlpha:n.useVertexAlpha},r)},e.CreateDashedLines=function(e,t,n){void 0===n&&(n=null);var s=t.points,l=t.instance,u=t.gapSize||1,c=t.dashSize||3;if(l)return l.updateMeshPositions(function(e){var t,n,i=r.x.Zero(),o=e.length/6,a=0,u=0,c=0,h=0,d=0,f=0;for(d=0;d<s.length-1;d++)s[d+1].subtractToRef(s[d],i),a+=i.length();t=a/o;var p=l._creationDataStorage.dashSize;for(n=p*t/(p+l._creationDataStorage.gapSize),d=0;d<s.length-1;d++)for(s[d+1].subtractToRef(s[d],i),u=Math.floor(i.length()/t),i.normalize(),f=0;f<u&&h<e.length;)c=t*f,e[h]=s[d].x+c*i.x,e[h+1]=s[d].y+c*i.y,e[h+2]=s[d].z+c*i.z,e[h+3]=s[d].x+(c+n)*i.x,e[h+4]=s[d].y+(c+n)*i.y,e[h+5]=s[d].z+(c+n)*i.z,h+=6,f++;for(;h<e.length;)e[h]=s[d].x,e[h+1]=s[d].y,e[h+2]=s[d].z,h+=3},!1),l;var h=new a.b(e,n);return o.a.CreateDashedLines(t).applyToMesh(h,t.updatable),h._creationDataStorage=new i.b,h._creationDataStorage.dashSize=c,h._creationDataStorage.gapSize=u,h},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(16),i=n(8),o=n(17),a=n(23),s=n(65),l=n(0),u=function(){function e(e,t){var n=this;void 0===t&&(t=!0),this.originalScene=e,this._pointerCaptures={},this._lastPointerEvents={},this._sharedGizmoLight=null,this.pickUtilitySceneFirst=!0,this.shouldRender=!0,this.onlyCheckPointerDownEvents=!0,this.processAllEvents=!1,this.onPointerOutObservable=new i.c,this.utilityLayerScene=new r.a(e.getEngine(),{virtual:!0}),this.utilityLayerScene.useRightHandedSystem=e.useRightHandedSystem,this.utilityLayerScene._allowPostProcessClearColor=!1,this.utilityLayerScene.detachControl(),t&&(this._originalPointerObserver=e.onPrePointerObservable.add(function(t,r){if(n.utilityLayerScene.activeCamera&&(n.processAllEvents||t.type===o.a.POINTERMOVE||t.type===o.a.POINTERUP||t.type===o.a.POINTERDOWN)){n.utilityLayerScene.pointerX=e.pointerX,n.utilityLayerScene.pointerY=e.pointerY;var i=t.event;if(e.isPointerCaptured(i.pointerId))n._pointerCaptures[i.pointerId]=!1;else{var a=t.ray?n.utilityLayerScene.pickWithRay(t.ray):n.utilityLayerScene.pick(e.pointerX,e.pointerY);if(!t.ray&&a&&(t.ray=a.ray),n.utilityLayerScene.onPrePointerObservable.notifyObservers(t),n.onlyCheckPointerDownEvents&&t.type!=o.a.POINTERDOWN)return t.skipOnPointerObservable||n.utilityLayerScene.onPointerObservable.notifyObservers(new o.b(t.type,t.event,a)),void(t.type===o.a.POINTERUP&&n._pointerCaptures[i.pointerId]&&(n._pointerCaptures[i.pointerId]=!1));if(n.utilityLayerScene.autoClearDepthAndStencil||n.pickUtilitySceneFirst)a&&a.hit&&(t.skipOnPointerObservable||n.utilityLayerScene.onPointerObservable.notifyObservers(new o.b(t.type,t.event,a)),t.skipOnPointerObservable=!0);else{var s=t.ray?e.pickWithRay(t.ray):e.pick(e.pointerX,e.pointerY),l=t.event;s&&a&&(0===a.distance&&s.pickedMesh?n.mainSceneTrackerPredicate&&n.mainSceneTrackerPredicate(s.pickedMesh)?(n._notifyObservers(t,s,l),t.skipOnPointerObservable=!0):t.type===o.a.POINTERDOWN?n._pointerCaptures[l.pointerId]=!0:n._lastPointerEvents[l.pointerId]&&(n.onPointerOutObservable.notifyObservers(l.pointerId),delete n._lastPointerEvents[l.pointerId]):!n._pointerCaptures[l.pointerId]&&(a.distance<s.distance||0===s.distance)?(n._notifyObservers(t,a,l),t.skipOnPointerObservable||(t.skipOnPointerObservable=a.distance>0)):!n._pointerCaptures[l.pointerId]&&a.distance>s.distance&&(n.mainSceneTrackerPredicate&&n.mainSceneTrackerPredicate(s.pickedMesh)?(n._notifyObservers(t,s,l),t.skipOnPointerObservable=!0):n._lastPointerEvents[l.pointerId]&&(n.onPointerOutObservable.notifyObservers(l.pointerId),delete n._lastPointerEvents[l.pointerId])),t.type===o.a.POINTERUP&&n._pointerCaptures[l.pointerId]&&(n._pointerCaptures[l.pointerId]=!1))}}}}),this._originalPointerObserver&&e.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver)),this.utilityLayerScene.autoClear=!1,this._afterRenderObserver=this.originalScene.onAfterRenderObservable.add(function(){n.shouldRender&&n.render()}),this._sceneDisposeObserver=this.originalScene.onDisposeObservable.add(function(){n.dispose()}),this._updateCamera()}return e.prototype._getSharedGizmoLight=function(){return this._sharedGizmoLight||(this._sharedGizmoLight=new s.a("shared gizmo light",new l.x(0,1,0),this.utilityLayerScene),this._sharedGizmoLight.intensity=2,this._sharedGizmoLight.groundColor=l.e.Gray()),this._sharedGizmoLight},Object.defineProperty(e,"DefaultUtilityLayer",{get:function(){return null==e._DefaultUtilityLayer&&(e._DefaultUtilityLayer=new e(a.a.LastCreatedScene),e._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){e._DefaultUtilityLayer=null})),e._DefaultUtilityLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DefaultKeepDepthUtilityLayer",{get:function(){return null==e._DefaultKeepDepthUtilityLayer&&(e._DefaultKeepDepthUtilityLayer=new e(a.a.LastCreatedScene),e._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,e._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(function(){e._DefaultKeepDepthUtilityLayer=null})),e._DefaultKeepDepthUtilityLayer},enumerable:!0,configurable:!0}),e.prototype._notifyObservers=function(e,t,n){e.skipOnPointerObservable||(this.utilityLayerScene.onPointerObservable.notifyObservers(new o.b(e.type,e.event,t)),this._lastPointerEvents[n.pointerId]=!0)},e.prototype.render=function(){if(this._updateCamera(),this.utilityLayerScene.activeCamera){var e=this.utilityLayerScene.activeCamera.getScene(),t=this.utilityLayerScene.activeCamera;t._scene=this.utilityLayerScene,t.leftCamera&&(t.leftCamera._scene=this.utilityLayerScene),t.rightCamera&&(t.rightCamera._scene=this.utilityLayerScene),this.utilityLayerScene.render(!1),t._scene=e,t.leftCamera&&(t.leftCamera._scene=e),t.rightCamera&&(t.rightCamera._scene=e)}},e.prototype.dispose=function(){this.onPointerOutObservable.clear(),this._afterRenderObserver&&this.originalScene.onAfterRenderObservable.remove(this._afterRenderObserver),this._sceneDisposeObserver&&this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver),this._originalPointerObserver&&this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver),this.utilityLayerScene.dispose()},e.prototype._updateCamera=function(){this.originalScene.activeCameras.length>1?this.utilityLayerScene.activeCamera=this.originalScene.activeCameras[this.originalScene.activeCameras.length-1]:this.utilityLayerScene.activeCamera=this.originalScene.activeCamera},e._DefaultUtilityLayer=null,e._DefaultKeepDepthUtilityLayer=null,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),i=n(2),o=n(8),a=n(0),s=function(e){function t(n,r,i){void 0===r&&(r=null),void 0===i&&(i=!0);var s=e.call(this,n,r)||this;return s._forward=new a.x(0,0,1),s._forwardInverted=new a.x(0,0,-1),s._up=new a.x(0,1,0),s._right=new a.x(1,0,0),s._rightInverted=new a.x(-1,0,0),s._position=a.x.Zero(),s._rotation=a.x.Zero(),s._rotationQuaternion=null,s._scaling=a.x.One(),s._isDirty=!1,s._transformToBoneReferal=null,s._billboardMode=t.BILLBOARDMODE_NONE,s._preserveParentRotationForBillboard=!1,s.scalingDeterminant=1,s._infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s.reIntegrateRotationIntoRotationQuaternion=!1,s._poseMatrix=null,s._localMatrix=a.j.Zero(),s._usePivotMatrix=!1,s._absolutePosition=a.x.Zero(),s._pivotMatrix=a.j.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s._indexInSceneTransformNodesArray=-1,s.onAfterWorldMatrixUpdateObservable=new o.c,s._nonUniformScaling=!1,i&&s.getScene().addTransformNode(s),s}return r.d(t,e),Object.defineProperty(t.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return a.x.Normalize(a.x.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return a.x.Normalize(a.x.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return a.x.Normalize(a.x.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),t.prototype.updatePoseMatrix=function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)},t.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=a.j.Identity()),this._poseMatrix},t.prototype._isSynchronized=function(){var e=this._cache;if(this.billboardMode!==e.billboardMode||this.billboardMode!==t.BILLBOARDMODE_NONE)return!1;if(e.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!e.position.equals(this._position))return!1;if(this._rotationQuaternion){if(!e.rotationQuaternion.equals(this._rotationQuaternion))return!1}else if(!e.rotation.equals(this._rotation))return!1;return!!e.scaling.equals(this._scaling)},t.prototype._initCache=function(){e.prototype._initCache.call(this);var t=this._cache;t.localMatrixUpdated=!1,t.position=a.x.Zero(),t.scaling=a.x.Zero(),t.rotation=a.x.Zero(),t.rotationQuaternion=new a.q(0,0,0,0),t.billboardMode=-1,t.infiniteDistance=!1},t.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),t.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},t.prototype.setPivotMatrix=function(e,t){return void 0===t&&(t=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=a.j.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(e){if(!e)return this;var t,n,r;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],n=arguments[1],r=arguments[2]}else t=e.x,n=e.y,r=e.z;if(this.parent){var i=a.t.Matrix[0];this.parent.getWorldMatrix().invertToRef(i),a.x.TransformCoordinatesFromFloatsToRef(t,n,r,i,this.position)}else this.position.x=t,this.position.y=n,this.position.z=r;return this},t.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=a.x.TransformNormal(e,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=a.t.Matrix[0];return this._localMatrix.invertToRef(e),a.x.TransformNormal(this.position,e)},t.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=a.x.TransformCoordinates(e,this._localMatrix),this},t.prototype.lookAt=function(e,n,r,i,o){void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=a.s.LOCAL);var s=t._lookAtVectorCache,l=o===a.s.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(l,s),this.setDirection(s,n,r,i),o===a.s.WORLD&&this.parent)if(this.rotationQuaternion){var u=a.t.Matrix[0];this.rotationQuaternion.toRotationMatrix(u);var c=a.t.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),u.multiplyToRef(c,u),this.rotationQuaternion.fromRotationMatrix(u)}else{var h=a.t.Quaternion[0];a.q.FromEulerVectorToRef(this.rotation,h),u=a.t.Matrix[0],h.toRotationMatrix(u),c=a.t.Matrix[1],this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),u.multiplyToRef(c,u),h.fromRotationMatrix(u),h.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(e){var t=a.x.Zero();return this.getDirectionToRef(e,t),t},t.prototype.getDirectionToRef=function(e,t){return a.x.TransformNormalToRef(e,this.getWorldMatrix(),t),this},t.prototype.setDirection=function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0);var i=-Math.atan2(e.z,e.x)+Math.PI/2,o=Math.sqrt(e.x*e.x+e.z*e.z),s=-Math.atan2(e.y,o);return this.rotationQuaternion?a.q.RotationYawPitchRollToRef(i+t,s+n,r,this.rotationQuaternion):(this.rotation.x=s+n,this.rotation.y=i+t,this.rotation.z=r),this},t.prototype.setPivotPoint=function(e,t){void 0===t&&(t=a.s.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(t==a.s.WORLD){var r=a.t.Matrix[0];n.invertToRef(r),e=a.x.TransformCoordinates(e,r)}return this.setPivotMatrix(a.j.Translation(-e.x,-e.y,-e.z),!0)},t.prototype.getPivotPoint=function(){var e=a.x.Zero();return this.getPivotPointToRef(e),e},t.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var e=a.x.Zero();return this.getAbsolutePivotPointToRef(e),e},t.prototype.getAbsolutePivotPointToRef=function(e){return e.x=this._pivotMatrix.m[12],e.y=this._pivotMatrix.m[13],e.z=this._pivotMatrix.m[14],this.getPivotPointToRef(e),a.x.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},t.prototype.setParent=function(e){if(!e&&!this.parent)return this;var t=a.t.Quaternion[0],n=a.t.Vector3[0],r=a.t.Vector3[1];if(e){var i=a.t.Matrix[0],o=a.t.Matrix[1];this.computeWorldMatrix(!0),e.computeWorldMatrix(!0),e.getWorldMatrix().invertToRef(o),this.getWorldMatrix().multiplyToRef(o,i),i.decompose(r,t,n)}else this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(r,t,n);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(t):t.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(r),this.position.copyFrom(n),this.parent=e,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},t.prototype.attachToBone=function(e,t){return this._transformToBoneReferal=t,this.parent=e,e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},t.prototype.rotate=function(e,n,r){var i;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),r&&r!==a.s.LOCAL){if(this.parent){var o=a.t.Matrix[0];this.parent.getWorldMatrix().invertToRef(o),e=a.x.TransformNormal(e,o)}(i=a.q.RotationAxisToRef(e,n,t._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else i=a.q.RotationAxisToRef(e,n,t._rotationAxisCache),this.rotationQuaternion.multiplyToRef(i,this.rotationQuaternion);return this},t.prototype.rotateAround=function(e,t,n){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=a.q.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var r=a.t.Vector3[0],i=a.t.Vector3[1],o=a.t.Vector3[2],s=a.t.Quaternion[0],l=a.t.Matrix[0],u=a.t.Matrix[1],c=a.t.Matrix[2],h=a.t.Matrix[3];return e.subtractToRef(this.position,r),a.j.TranslationToRef(r.x,r.y,r.z,l),a.j.TranslationToRef(-r.x,-r.y,-r.z,u),a.j.RotationAxisToRef(t,n,c),u.multiplyToRef(c,h),h.multiplyToRef(l,h),h.decompose(i,s,o),this.position.addInPlace(o),s.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(e,t,n){var r=e.scale(t);if(n&&n!==a.s.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{var i=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(i)}return this},t.prototype.addRotation=function(e,t,n){var r;this.rotationQuaternion?r=this.rotationQuaternion:(r=a.t.Quaternion[1],a.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,r));var i=a.t.Quaternion[0];return a.q.RotationYawPitchRollToRef(t,e,n,i),r.multiplyInPlace(i),this.rotationQuaternion||r.toEulerAnglesToRef(this.rotation),this},t.prototype._getEffectiveParent=function(){return this.parent},t.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var n=this.getScene().getRenderId();if(!this._isDirty&&!e&&this.isSynchronized())return this._currentRenderId=n,this._worldMatrix;this._updateCache();var r=this._cache;r.pivotMatrixUpdated=!1,r.billboardMode=this.billboardMode,r.infiniteDistance=this.infiniteDistance,this._currentRenderId=n,this._childUpdateId++,this._isDirty=!1;var i=this._getEffectiveParent(),o=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard,s=this.getScene().activeCamera,l=r.scaling,u=r.position;if(this._infiniteDistance)if(!this.parent&&s){var c=s.getWorldMatrix(),h=new a.x(c.m[12],c.m[13],c.m[14]);u.copyFromFloats(this._position.x+h.x,this._position.y+h.y,this._position.z+h.z)}else u.copyFrom(this._position);else u.copyFrom(this._position);l.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var d=r.rotationQuaternion;if(this._rotationQuaternion?(this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(a.q.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0)),d.copyFrom(this._rotationQuaternion)):(a.q.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,d),r.rotation.copyFrom(this._rotation)),this._usePivotMatrix){var f=a.t.Matrix[1];a.j.ScalingToRef(l.x,l.y,l.z,f);var p=a.t.Matrix[0];d.toRotationMatrix(p),this._pivotMatrix.multiplyToRef(f,a.t.Matrix[4]),a.t.Matrix[4].multiplyToRef(p,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(u.x,u.y,u.z)}else a.j.ComposeToRef(l,d,u,this._localMatrix);if(i&&i.getWorldMatrix){if(o){this._transformToBoneReferal?i.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),a.t.Matrix[7]):a.t.Matrix[7].copyFrom(i.getWorldMatrix());var m=a.t.Vector3[5],g=a.t.Vector3[6];a.t.Matrix[7].decompose(g,void 0,m),a.j.ScalingToRef(g.x,g.y,g.z,a.t.Matrix[7]),a.t.Matrix[7].setTranslation(m),this._localMatrix.multiplyToRef(a.t.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(i.getWorldMatrix(),a.t.Matrix[6]),a.t.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(i.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(o&&s){var _=a.t.Vector3[0];if(this._worldMatrix.getTranslationToRef(_),a.t.Matrix[1].copyFrom(s.getViewMatrix()),a.t.Matrix[1].setTranslationFromFloats(0,0,0),a.t.Matrix[1].invertToRef(a.t.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){a.t.Matrix[0].decompose(void 0,a.t.Quaternion[0],void 0);var v=a.t.Vector3[1];a.t.Quaternion[0].toEulerAnglesToRef(v),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(v.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(v.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(v.z=0),a.j.RotationYawPitchRollToRef(v.y,v.x,v.z,a.t.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(a.t.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(a.t.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniform?this._updateNonUniformScalingState(!0):i&&i._nonUniformScaling?this._updateNonUniformScalingState(i._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=a.j.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},t.prototype.getPositionInCameraSpace=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),a.x.TransformCoordinates(this.absolutePosition,e.getViewMatrix())},t.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.globalPosition).length()},t.prototype.clone=function(e,n,r){var o=this,a=i.a.Clone(function(){return new t(e,o.getScene())},this);if(a.name=e,a.id=e,n&&(a.parent=n),!r)for(var s=this.getDescendants(!0),l=0;l<s.length;l++){var u=s[l];u.clone&&u.clone(e+"."+u.name,a)}return a},t.prototype.serialize=function(e){var t=i.a.Serialize(this,e);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),this.parent&&(t.parentId=this.parent.id),t},t.Parse=function(e,n,r){var o=i.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.localMatrix?o.setPreTransformMatrix(a.j.FromArray(e.localMatrix)):e.pivotMatrix&&o.setPivotMatrix(a.j.FromArray(e.pivotMatrix)),o.setEnabled(e.isEnabled),e.parentId&&(o._waitingParentId=e.parentId),o},t.prototype.getChildTransformNodes=function(e,n){var r=[];return this._getDescendants(r,e,function(e){return(!n||n(e))&&e instanceof t}),r},t.prototype.dispose=function(t,n){if(void 0===n&&(n=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var r=0,i=this.getChildTransformNodes(!0);r<i.length;r++){var o=i[r];o.parent=null,o.computeWorldMatrix(!0)}e.prototype.dispose.call(this,t,n)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t._lookAtVectorCache=new a.x(0,0,0),t._rotationAxisCache=new a.q,r.c([Object(i.o)("position")],t.prototype,"_position",void 0),r.c([Object(i.o)("rotation")],t.prototype,"_rotation",void 0),r.c([Object(i.l)("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),r.c([Object(i.o)("scaling")],t.prototype,"_scaling",void 0),r.c([Object(i.c)("billboardMode")],t.prototype,"_billboardMode",void 0),r.c([Object(i.c)()],t.prototype,"scalingDeterminant",void 0),r.c([Object(i.c)("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),r.c([Object(i.c)()],t.prototype,"ignoreNonUniformScaling",void 0),r.c([Object(i.c)()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),t}(n(25).a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(34),i=n(0),o=n(3),a=n(77),s=n(82),l={min:0,max:0},u={min:0,max:0},c=function(e,t,n){var r=i.x.Dot(t.centerWorld,e),o=Math.abs(i.x.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(i.x.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(i.x.Dot(t.directions[2],e))*t.extendSize.z;n.min=r-o,n.max=r+o},h=function(e,t,n){return c(e,t,l),c(e,n,u),!(l.min>u.max||u.min>l.max)},d=function(){function e(e,t,n){this._isLocked=!1,this.boundingBox=new a.a(e,t,n),this.boundingSphere=new s.a(e,t,n)}return e.prototype.reConstruct=function(e,t,n){this.boundingBox.reConstruct(e,t,n),this.boundingSphere.reConstruct(e,t,n)},Object.defineProperty(e.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},e.prototype.centerOn=function(t,n){var r=e.TmpVector3[0].copyFrom(t).subtractInPlace(n),i=e.TmpVector3[1].copyFrom(t).addInPlace(n);return this.boundingBox.reConstruct(r,i,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(r,i,this.boundingBox.getWorldMatrix()),this},e.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},e.prototype.isInFrustum=function(e,t){return void 0===t&&(t=o.a.MESHES_CULLINGSTRATEGY_STANDARD),!(t!==o.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION&&t!==o.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(!(t!==o.a.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY&&t!==o.a.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY)||this.boundingBox.isInFrustum(e))},Object.defineProperty(e.prototype,"diagonalLength",{get:function(){var t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,e.TmpVector3[0]).length()},enumerable:!0,configurable:!0}),e.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},e.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},e.prototype.intersectsPoint=function(e){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e)},e.prototype.intersects=function(e,t){if(!s.a.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!a.a.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var n=this.boundingBox,r=e.boundingBox;return!!h(n.directions[0],n,r)&&!!h(n.directions[1],n,r)&&!!h(n.directions[2],n,r)&&!!h(r.directions[0],n,r)&&!!h(r.directions[1],n,r)&&!!h(r.directions[2],n,r)&&!!h(i.x.Cross(n.directions[0],r.directions[0]),n,r)&&!!h(i.x.Cross(n.directions[0],r.directions[1]),n,r)&&!!h(i.x.Cross(n.directions[0],r.directions[2]),n,r)&&!!h(i.x.Cross(n.directions[1],r.directions[0]),n,r)&&!!h(i.x.Cross(n.directions[1],r.directions[1]),n,r)&&!!h(i.x.Cross(n.directions[1],r.directions[2]),n,r)&&!!h(i.x.Cross(n.directions[2],r.directions[0]),n,r)&&!!h(i.x.Cross(n.directions[2],r.directions[1]),n,r)&&!!h(i.x.Cross(n.directions[2],r.directions[2]),n,r)},e.TmpVector3=r.a.BuildArray(2,i.x.Zero),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(1),i=n(2),o=n(8),a=n(9),s=n(71),l=n(0),u=n(23),c=n(3),h=function(){function e(t){this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=c.a.TEXTURE_EXPLICIT_MODE,this.wrapU=c.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapV=c.a.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=c.a.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new o.c,this._onDisposeObserver=null,this.delayLoadState=c.a.DELAYLOADSTATE_NONE,this._scene=null,this._texture=null,this._uid=null,this._cachedSize=l.r.Zero(),this._scene=t||u.a.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this)),this._uid=null}return Object.defineProperty(e.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(c.a.MATERIAL_TextureDirtyFlag|c.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(c.a.MATERIAL_TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"noMipmap",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid||(this._uid=a.h.RandomId()),this._uid},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return this.name},e.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getTextureMatrix=function(){return l.j.IdentityReadOnly},e.prototype.getReflectionTextureMatrix=function(){return l.j.IdentityReadOnly},e.prototype.getInternalTexture=function(){return this._texture},e.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},e.prototype.isReady=function(){return this.delayLoadState===c.a.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},e.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},e.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new l.r(this._texture._size,this._texture._size):new l.r(this._texture.baseWidth,this._texture.baseHeight):l.r.Zero()},e.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&t.getEngine().updateTextureSamplingMode(e,this._texture)}},e.prototype.scale=function(e){},Object.defineProperty(e.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._getFromCache=function(e,t,n,r){if(!this._scene)return null;for(var i=this._scene.getEngine().getLoadedTexturesCache(),o=0;o<i.length;o++){var a=i[o];if(!(void 0!==r&&r!==a.invertY||a.url!==e||a.generateMipMaps!==!t||n&&n!==a.samplingMode))return a.incrementReferences(),a}return null},e.prototype._rebuild=function(){},e.prototype.delayLoad=function(){},e.prototype.clone=function(){return null},Object.defineProperty(e.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:c.a.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:c.a.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),e.prototype.readPixels=function(e,t,n){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=null),!this._texture)return null;var r=this.getSize(),i=r.width,o=r.height,a=this.getScene();if(!a)return null;var s=a.getEngine();return 0!=t&&(i/=Math.pow(2,t),o/=Math.pow(2,t),i=Math.round(i),o=Math.round(o)),this._texture.isCube?s._readTexturePixels(this._texture,i,o,e,t,n):s._readTexturePixels(this._texture,i,o,-1,t,n)},e.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(e.prototype,"sphericalPolynomial",{get:function(){return this._texture&&s.a&&this.isReady()?(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=s.a.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial):null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},e.prototype.serialize=function(){if(!this.name)return null;var e=i.a.Serialize(this);return i.a.AppendSerializedAnimations(this,e),e},e.WhenAllReady=function(e,t){var n=e.length;if(0!==n)for(var r,i,o=function(){if((r=e[a]).isReady())0==--n&&t();else{i=r.onLoadObservable;var o=function e(){i.removeCallback(e),0==--n&&t()};i.add(o)}},a=0;a<e.length;a++)o();else t()},e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,r.c([Object(i.c)()],e.prototype,"uniqueId",void 0),r.c([Object(i.c)()],e.prototype,"name",void 0),r.c([Object(i.c)()],e.prototype,"metadata",void 0),r.c([Object(i.c)("hasAlpha")],e.prototype,"_hasAlpha",void 0),r.c([Object(i.c)()],e.prototype,"getAlphaFromRGB",void 0),r.c([Object(i.c)()],e.prototype,"level",void 0),r.c([Object(i.c)()],e.prototype,"coordinatesIndex",void 0),r.c([Object(i.c)("coordinatesMode")],e.prototype,"_coordinatesMode",void 0),r.c([Object(i.c)()],e.prototype,"wrapU",void 0),r.c([Object(i.c)()],e.prototype,"wrapV",void 0),r.c([Object(i.c)()],e.prototype,"wrapR",void 0),r.c([Object(i.c)()],e.prototype,"anisotropicFilteringLevel",void 0),r.c([Object(i.c)()],e.prototype,"isCube",null),r.c([Object(i.c)()],e.prototype,"is3D",null),r.c([Object(i.c)()],e.prototype,"gammaSpace",void 0),r.c([Object(i.c)()],e.prototype,"invertZ",void 0),r.c([Object(i.c)()],e.prototype,"lodLevelInAlpha",void 0),r.c([Object(i.c)()],e.prototype,"lodGenerationOffset",null),r.c([Object(i.c)()],e.prototype,"lodGenerationScale",null),r.c([Object(i.c)()],e.prototype,"isRenderTarget",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(){}return e._RemoveAndStorePivotPoint=function(t){t&&0===e._PivotCached&&(t.getPivotPointToRef(e._OldPivotPoint),e._OldPivotPoint.equalsToFloats(0,0,0)||(t.setPivotMatrix(r.j.IdentityReadOnly),e._OldPivotPoint.subtractToRef(t.getPivotPoint(),e._PivotTranslation),e._PivotTmpVector.copyFromFloats(1,1,1),e._PivotTmpVector.subtractInPlace(t.scaling),e._PivotTmpVector.multiplyInPlace(e._PivotTranslation),t.position.addInPlace(e._PivotTmpVector))),e._PivotCached++},e._RestorePivotPoint=function(t){t&&!e._OldPivotPoint.equalsToFloats(0,0,0)&&1===e._PivotCached&&(t.setPivotPoint(e._OldPivotPoint),e._PivotTmpVector.copyFromFloats(1,1,1),e._PivotTmpVector.subtractInPlace(t.scaling),e._PivotTmpVector.multiplyInPlace(e._PivotTranslation),t.position.subtractInPlace(e._PivotTmpVector)),this._PivotCached--},e._PivotCached=0,e._OldPivotPoint=new r.x,e._PivotTranslation=new r.x,e._PivotTmpVector=new r.x,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(11),o=n(13);o.a.CreateSphere=function(e){for(var t=e.segments||32,n=e.diameterX||e.diameter||1,i=e.diameterY||e.diameter||1,a=e.diameterZ||e.diameter||1,s=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=e.slice&&e.slice<=0?1:e.slice||1,u=0===e.sideOrientation?0:e.sideOrientation||o.a.DEFAULTSIDE,c=new r.x(n/2,i/2,a/2),h=2+t,d=2*h,f=[],p=[],m=[],g=[],_=0;_<=h;_++){for(var v=_/h,y=v*Math.PI*l,b=0;b<=d;b++){var E=b/d,x=E*Math.PI*2*s,T=r.j.RotationZ(-y),S=r.j.RotationY(x),A=r.x.TransformCoordinates(r.x.Up(),T),P=r.x.TransformCoordinates(A,S),M=P.multiply(c),R=P.divide(c).normalize();p.push(M.x,M.y,M.z),m.push(R.x,R.y,R.z),g.push(E,v)}if(_>0)for(var C=p.length/3,w=C-2*(d+1);w+d+2<C;w++)f.push(w),f.push(w+1),f.push(w+d+1),f.push(w+d+1),f.push(w+1),f.push(w+d+2)}o.a._ComputeSides(u,p,f,m,g,e.frontUVs,e.backUVs);var O=new o.a;return O.indices=f,O.positions=p,O.normals=m,O.uvs=g,O},i.a.CreateSphere=function(e,t,n,r,i,o){var s={segments:t,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:o,updatable:i};return a.CreateSphere(e,s,r)};var a=function(){function e(){}return e.CreateSphere=function(e,t,n){var r=new i.a(e,n);return t.sideOrientation=i.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,o.a.CreateSphere(t).applyToMesh(r,t.updatable),r},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(35),i=function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return r.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(11),o=n(41),a=function(){function e(e){var t=this;void 0===e&&(e=o.a.DefaultUtilityLayer),this.gizmoLayer=e,this._attachedMesh=null,this.scaleRatio=1,this._customMeshSet=!1,this.updateGizmoRotationToMatchAttachedMesh=!0,this.updateGizmoPositionToMatchAttachedMesh=!0,this._updateScale=!0,this._interactionsEnabled=!0,this._tempVector=new r.x,this._rootMesh=new i.a("gizmoRootNode",e.utilityLayerScene),this._rootMesh.rotationQuaternion=r.q.Identity(),this._beforeRenderObserver=this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.add(function(){t._update()})}return Object.defineProperty(e.prototype,"attachedMesh",{get:function(){return this._attachedMesh},set:function(e){this._attachedMesh=e,this._rootMesh.setEnabled(!!e),this._attachedMeshChanged(e)},enumerable:!0,configurable:!0}),e.prototype.setCustomMesh=function(e){if(e.getScene()!=this.gizmoLayer.utilityLayerScene)throw"When setting a custom mesh on a gizmo, the custom meshes scene must be the same as the gizmos (eg. gizmo.gizmoLayer.utilityLayerScene)";this._rootMesh.getChildMeshes().forEach(function(e){e.dispose()}),e.parent=this._rootMesh,this._customMeshSet=!0},e.prototype._attachedMeshChanged=function(e){},e.prototype._update=function(){if(this.attachedMesh){var e=this.attachedMesh._effectiveMesh||this.attachedMesh;if(this.updateGizmoPositionToMatchAttachedMesh&&this._rootMesh.position.copyFrom(e.absolutePosition),this.updateGizmoRotationToMatchAttachedMesh?e.getWorldMatrix().decompose(void 0,this._rootMesh.rotationQuaternion):this._rootMesh.rotationQuaternion.set(0,0,0,1),this._updateScale){var t=this.gizmoLayer.utilityLayerScene.activeCamera,n=t.globalPosition;t.devicePosition&&(n=t.devicePosition),this._rootMesh.position.subtractToRef(n,this._tempVector);var r=this._tempVector.length()*this.scaleRatio;this._rootMesh.scaling.set(r,r,r),e._getWorldMatrixDeterminant()<0&&(this._rootMesh.scaling.y*=-1)}}},e.prototype.dispose=function(){this._rootMesh.dispose(),this._beforeRenderObserver&&this.gizmoLayer.utilityLayerScene.onBeforeRenderObservable.remove(this._beforeRenderObserver)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"b",function(){return c});var r=n(1),i=n(9),o=n(4),a=n(81),s=n(43),l=n(3),u=function(){function e(){this._materialDefines=null,this._materialEffect=null}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){void 0===t&&(t=null),this._materialEffect!==e?(this._materialDefines=t,this._materialEffect=e):e||(this._materialDefines=null)},e}(),c=function(e){function t(t,n,r,i,o,a,s,l){void 0===l&&(l=!0);var u=e.call(this)||this;return u.materialIndex=t,u.verticesStart=n,u.verticesCount=r,u.indexStart=i,u.indexCount=o,u._linesIndexCount=0,u._linesIndexBuffer=null,u._lastColliderWorldVertices=null,u._lastColliderTransformMatrix=null,u._renderId=0,u._alphaIndex=0,u._distanceToCamera=0,u._currentMaterial=null,u._mesh=a,u._renderingMesh=s||a,a.subMeshes.push(u),u._trianglePlanes=[],u._id=a.subMeshes.length-1,l&&(u.refreshBoundingInfo(),a.computeWorldMatrix(!0)),u}return r.d(t,e),t.AddToMesh=function(e,n,r,i,o,a,s,l){return void 0===l&&(l=!0),new t(e,n,r,i,o,a,s,l)},Object.defineProperty(t.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),t.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(null==e)return this._mesh.getScene().defaultMaterial;if(e.getSubMaterial){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(o.b.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,n=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===n.length){var r=this._renderingMesh.getBoundingInfo();t={minimum:r.minimum.clone(),maximum:r.maximum.clone()}}else t=i.h.ExtractMinAndMaxIndexed(e,n,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new s.a(t.minimum,t.maximum),this},t.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},t.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t.update(e),this},t.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},t.prototype.render=function(e){return this._renderingMesh.render(this,e),this},t.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var n=[],r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)n.push(e[r],e[r+1],e[r+1],e[r+2],e[r+2],e[r]);this._linesIndexBuffer=t.createIndexBuffer(n),this._linesIndexCount=n.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},t.prototype.intersects=function(e,t,n,r,i){var o=this.getMaterial();if(!o)return null;switch(o.fillMode){case l.a.MATERIAL_PointListDrawMode:case l.a.MATERIAL_LineListDrawMode:case l.a.MATERIAL_LineLoopDrawMode:case l.a.MATERIAL_LineStripDrawMode:case l.a.MATERIAL_TriangleFanDrawMode:case l.a.MATERIAL_TriangleStripDrawMode:return null}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?n.length?this._intersectLines(e,t,n,this._mesh.intersectionThreshold,r):this._intersectUnIndexedLines(e,t,n,this._mesh.intersectionThreshold,r):!n.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,n,r,i):this._intersectTriangles(e,t,n,r,i)},t.prototype._intersectLines=function(e,t,n,r,i){for(var o=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=2){var l=t[n[s]],u=t[n[s+1]],c=e.intersectionSegment(l,u,r);if(!(c<0)&&(i||!o||c<o.distance)&&((o=new a.a(null,null,c)).faceId=s/2,i))break}return o},t.prototype._intersectUnIndexedLines=function(e,t,n,r,i){for(var o=null,s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){var l=t[s],u=t[s+1],c=e.intersectionSegment(l,u,r);if(!(c<0)&&(i||!o||c<o.distance)&&((o=new a.a(null,null,c)).faceId=s/2,i))break}return o},t.prototype._intersectTriangles=function(e,t,n,r,i){for(var o=null,a=this.indexStart;a<this.indexStart+this.indexCount;a+=3){var s=t[n[a]],l=t[n[a+1]],u=t[n[a+2]];if(!i||i(s,l,u,e)){var c=e.intersectsTriangle(s,l,u);if(c){if(c.distance<0)continue;if((r||!o||c.distance<o.distance)&&((o=c).faceId=a/3,r))break}}}return o},t.prototype._intersectUnIndexedTriangles=function(e,t,n,r,i){for(var o=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){var s=t[a],l=t[a+1],u=t[a+2];if(!i||i(s,l,u,e)){var c=e.intersectsTriangle(s,l,u);if(c){if(c.distance<0)continue;if((r||!o||c.distance<o.distance)&&((o=c).faceId=a/3,r))break}}}return o},t.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},t.prototype.clone=function(e,n){var r=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,n,!1);if(!this.IsGlobal){var i=this.getBoundingInfo();if(!i)return r;r._boundingInfo=new s.a(i.minimum,i.maximum)}return r},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},t.prototype.getClassName=function(){return"SubMesh"},t.CreateFromIndices=function(e,n,r,i,o){for(var a=Number.MAX_VALUE,s=-Number.MAX_VALUE,l=(o||i).getIndices(),u=n;u<n+r;u++){var c=l[u];c<a&&(a=c),c>s&&(s=c)}return new t(e,a,s-a+1,n,r,i,o)},t}(u)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(4),o=function(){function e(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null,this.originMesh=null,this.ray=null}return e.prototype.getNormal=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(i.b.NormalKind))return null;var n,o=this.pickedMesh.getIndices();if(!o)return null;if(t){var a=this.pickedMesh.getVerticesData(i.b.NormalKind),s=r.x.FromArray(a,3*o[3*this.faceId]),l=r.x.FromArray(a,3*o[3*this.faceId+1]),u=r.x.FromArray(a,3*o[3*this.faceId+2]);s=s.scale(this.bu),l=l.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new r.x(s.x+l.x+u.x,s.y+l.y+u.y,s.z+l.z+u.z)}else{var c=this.pickedMesh.getVerticesData(i.b.PositionKind),h=r.x.FromArray(c,3*o[3*this.faceId]),d=r.x.FromArray(c,3*o[3*this.faceId+1]),f=r.x.FromArray(c,3*o[3*this.faceId+2]),p=h.subtract(d),m=f.subtract(d);n=r.x.Cross(p,m)}if(e){var g=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(r.t.Matrix[0].copyFrom(g),(g=r.t.Matrix[0]).setTranslationFromFloats(0,0,0),g.invert(),g.transposeToRef(r.t.Matrix[1]),g=r.t.Matrix[1]),n=r.x.TransformNormal(n,g)}return n.normalize(),n},e.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(i.b.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(i.b.UVKind);if(!t)return null;var n=r.w.FromArray(t,2*e[3*this.faceId]),o=r.w.FromArray(t,2*e[3*this.faceId+1]),a=r.w.FromArray(t,2*e[3*this.faceId+2]);return n=n.scale(1-this.bu-this.bv),o=o.scale(this.bu),a=a.scale(this.bv),new r.w(n.x+o.x+a.x,n.y+o.y+a.y)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a});var r=n(1),i=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}(),o=function(e,t){this.type=e,this.event=t},a=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.type=t,r.event=n,r.skipOnPointerObservable=!1,r}return r.d(t,e),t}(o)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(11),o=n(13);o.a.CreateBox=function(e){var t,n=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],a=[],s=e.width||e.size||1,l=e.height||e.size||1,u=e.depth||e.size||1,c=e.wrap||!1,h=void 0===e.topBaseAt?1:e.topBaseAt,d=void 0===e.bottomBaseAt?0:e.bottomBaseAt,f=[2,0,3,1][h=(h+4)%4],p=[2,0,1,3][d=(d+4)%4],m=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(c){n=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],m=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var g=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],_=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],v=[17,18,19,16],y=[22,23,20,21];f>0;)g.unshift(g.pop()),v.unshift(v.pop()),f--;for(;p>0;)_.unshift(_.pop()),y.unshift(y.pop()),p--;g=g.flat(),_=_.flat(),m=m.concat(g).concat(_),n.push(v[0],v[2],v[3],v[0],v[1],v[2]),n.push(y[0],y[2],y[3],y[0],y[1],y[2])}var b=[s/2,l/2,u/2];t=m.reduce(function(e,t,n){return e.concat(t*b[n%3])},[]);for(var E=0===e.sideOrientation?0:e.sideOrientation||o.a.DEFAULTSIDE,x=e.faceUV||new Array(6),T=e.faceColors,S=[],A=0;A<6;A++)void 0===x[A]&&(x[A]=new r.y(0,0,1,1)),T&&void 0===T[A]&&(T[A]=new r.f(1,1,1,1));for(var P=0;P<6;P++)if(a.push(x[P].z,x[P].w),a.push(x[P].x,x[P].w),a.push(x[P].x,x[P].y),a.push(x[P].z,x[P].y),T)for(var M=0;M<4;M++)S.push(T[P].r,T[P].g,T[P].b,T[P].a);o.a._ComputeSides(E,t,n,i,a,e.frontUVs,e.backUVs);var R=new o.a;if(R.indices=n,R.positions=t,R.normals=i,R.uvs=a,T){var C=E===o.a.DOUBLESIDE?S.concat(S):S;R.colors=C}return R},i.a.CreateBox=function(e,t,n,r,i){void 0===n&&(n=null);var o={size:t,sideOrientation:i,updatable:r};return a.CreateBox(e,o,n)};var a=function(){function e(){}return e.CreateBox=function(e,t,n){void 0===n&&(n=null);var r=new i.a(e,n);return t.sideOrientation=i.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,o.a.CreateBox(t).applyToMesh(r,t.updatable),r},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),i=n(11),o=n(13),a=n(16);o.a.CreateCylinder=function(e){var t,n=e.height||2,i=0===e.diameterTop?0:e.diameterTop||e.diameter||1,a=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1,s=e.tessellation||24,l=e.subdivisions||1,u=!!e.hasRings,c=!!e.enclose,h=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,d=0===e.sideOrientation?0:e.sideOrientation||o.a.DEFAULTSIDE,f=e.faceUV||new Array(3),p=e.faceColors,m=2+(1+(1!==h&&c?2:0))*(u?l:1);for(t=0;t<m;t++)p&&void 0===p[t]&&(p[t]=new r.f(1,1,1,1));for(t=0;t<m;t++)f&&void 0===f[t]&&(f[t]=new r.y(0,0,1,1));var g,_,v,y,b,E,x=new Array,T=new Array,S=new Array,A=new Array,P=new Array,M=2*Math.PI*h/s,R=(a-i)/2/n,C=r.x.Zero(),w=r.x.Zero(),O=r.x.Zero(),I=r.x.Zero(),D=r.x.Zero(),L=r.c.Y,F=1,N=1,B=0,U=0;for(y=0;y<=l;y++)for(v=((_=y/l)*(i-a)+a)/2,F=u&&0!==y&&y!==l?2:1,E=0;E<F;E++){for(u&&(N+=E),c&&(N+=2*E),b=0;b<=s;b++)g=b*M,C.x=Math.cos(-g)*v,C.y=-n/2+_*n,C.z=Math.sin(-g)*v,0===i&&y===l?(w.x=S[S.length-3*(s+1)],w.y=S[S.length-3*(s+1)+1],w.z=S[S.length-3*(s+1)+2]):(w.x=C.x,w.z=C.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*R,w.normalize()),0===b&&(O.copyFrom(C),I.copyFrom(w)),T.push(C.x,C.y,C.z),S.push(w.x,w.y,w.z),U=u?B!==N?f[N].y:f[N].w:f[N].y+(f[N].w-f[N].y)*_,A.push(f[N].x+(f[N].z-f[N].x)*b/s,U),p&&P.push(p[N].r,p[N].g,p[N].b,p[N].a);1!==h&&c&&(T.push(C.x,C.y,C.z),T.push(0,C.y,0),T.push(0,C.y,0),T.push(O.x,O.y,O.z),r.x.CrossToRef(L,w,D),D.normalize(),S.push(D.x,D.y,D.z,D.x,D.y,D.z),r.x.CrossToRef(I,L,D),D.normalize(),S.push(D.x,D.y,D.z,D.x,D.y,D.z),U=u?B!==N?f[N+1].y:f[N+1].w:f[N+1].y+(f[N+1].w-f[N+1].y)*_,A.push(f[N+1].x,U),A.push(f[N+1].z,U),U=u?B!==N?f[N+2].y:f[N+2].w:f[N+2].y+(f[N+2].w-f[N+2].y)*_,A.push(f[N+2].x,U),A.push(f[N+2].z,U),p&&(P.push(p[N+1].r,p[N+1].g,p[N+1].b,p[N+1].a),P.push(p[N+1].r,p[N+1].g,p[N+1].b,p[N+1].a),P.push(p[N+2].r,p[N+2].g,p[N+2].b,p[N+2].a),P.push(p[N+2].r,p[N+2].g,p[N+2].b,p[N+2].a))),B!==N&&(B=N)}var k=1!==h&&c?s+4:s;for(y=0,N=0;N<l;N++){var V=0,G=0,z=0,j=0;for(b=0;b<s;b++)V=y*(k+1)+b,G=(y+1)*(k+1)+b,z=y*(k+1)+(b+1),j=(y+1)*(k+1)+(b+1),x.push(V,G,z),x.push(j,z,G);1!==h&&c&&(x.push(V+2,G+2,z+2),x.push(j+2,z+2,G+2),x.push(V+4,G+4,z+4),x.push(j+4,z+4,G+4)),y=u?y+2:y+1}var H=function(e){var t=e?i/2:a/2;if(0!==t){var o,l,u,c=e?f[m-1]:f[0],d=null;p&&(d=e?p[m-1]:p[0]);var g=T.length/3,_=e?n/2:-n/2,v=new r.x(0,_,0);T.push(v.x,v.y,v.z),S.push(0,e?1:-1,0),A.push(c.x+.5*(c.z-c.x),c.y+.5*(c.w-c.y)),d&&P.push(d.r,d.g,d.b,d.a);var y=new r.w(.5,.5);for(u=0;u<=s;u++){o=2*Math.PI*u*h/s;var b=Math.cos(-o),E=Math.sin(-o);l=new r.x(b*t,_,E*t);var M=new r.w(b*y.x+.5,E*y.y+.5);T.push(l.x,l.y,l.z),S.push(0,e?1:-1,0),A.push(c.x+(c.z-c.x)*M.x,c.y+(c.w-c.y)*M.y),d&&P.push(d.r,d.g,d.b,d.a)}for(u=0;u<s;u++)e?(x.push(g),x.push(g+(u+2)),x.push(g+(u+1))):(x.push(g),x.push(g+(u+1)),x.push(g+(u+2)))}};H(!1),H(!0),o.a._ComputeSides(d,T,x,S,A,e.frontUVs,e.backUVs);var W=new o.a;return W.indices=x,W.positions=T,W.normals=S,W.uvs=A,p&&(W.colors=P),W},i.a.CreateCylinder=function(e,t,n,r,o,l,u,c,h){void 0!==u&&u instanceof a.a||(void 0!==u&&(h=c||i.a.DEFAULTSIDE,c=u),u=l,l=1);var d={height:t,diameterTop:n,diameterBottom:r,tessellation:o,subdivisions:l,sideOrientation:h,updatable:c};return s.CreateCylinder(e,d,u)};var s=function(){function e(){}return e.CreateCylinder=function(e,t,n){var r=new i.a(e,n);return t.sideOrientation=i.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,o.a.CreateCylinder(t).applyToMesh(r,t.updatable),r},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(11),i=n(16),o=n(8),a=n(0),s=n(17),l=n(39),u=n(45),c=(n(80),function(){function e(e){this._useAlternatePickedPointAboveMaxDragAngleDragSpeed=-1.1,this.maxDragAngle=0,this._useAlternatePickedPointAboveMaxDragAngle=!1,this.currentDraggingPointerID=-1,this.dragging=!1,this.dragDeltaRatio=.2,this.updateDragPlane=!0,this._debugMode=!1,this._moving=!1,this.onDragObservable=new o.c,this.onDragStartObservable=new o.c,this.onDragEndObservable=new o.c,this.moveAttached=!0,this.enabled=!0,this.detachCameraControls=!0,this.useObjectOrienationForDragging=!0,this.validateDrag=function(e){return!0},this._tmpVector=new a.x(0,0,0),this._alternatePickedPoint=new a.x(0,0,0),this._worldDragAxis=new a.x(0,0,0),this._targetPosition=new a.x(0,0,0),this._attachedElement=null,this._startDragRay=new l.a(new a.x,new a.x),this._lastPointerRay={},this._dragDelta=new a.x,this._pointA=new a.x(0,0,0),this._pointB=new a.x(0,0,0),this._pointC=new a.x(0,0,0),this._lineA=new a.x(0,0,0),this._lineB=new a.x(0,0,0),this._localAxis=new a.x(0,0,0),this._lookAt=new a.x(0,0,0),this._options=e||{};var t=0;if(this._options.dragAxis&&t++,this._options.dragPlaneNormal&&t++,t>1)throw"Multiple drag modes specified in dragBehavior options. Only one expected"}return Object.defineProperty(e.prototype,"name",{get:function(){return"PointerDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(t){var n=this;this._scene=t.getScene(),this._attachedNode=t,e._planeScene||(this._debugMode?e._planeScene=this._scene:(e._planeScene=new i.a(this._scene.getEngine(),{virtual:!0}),e._planeScene.detachControl(),this._scene.onDisposeObservable.addOnce(function(){e._planeScene.dispose(),e._planeScene=null}))),this._dragPlane=r.a.CreatePlane("pointerDragPlane",this._debugMode?1:1e4,e._planeScene,!1,r.a.DOUBLESIDE),this.lastDragPosition=new a.x(0,0,0),this._pointerObserver=this._scene.onPointerObservable.add(function(t,r){var i;if(n.enabled)if(t.type==s.a.POINTERDOWN)!n.dragging&&t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh&&t.pickInfo.pickedPoint&&t.pickInfo.ray&&(i=t.pickInfo.pickedMesh,n._attachedNode==i||i.isDescendantOf(n._attachedNode))&&n._startDrag(t.event.pointerId,t.pickInfo.ray,t.pickInfo.pickedPoint);else if(t.type==s.a.POINTERUP)n.currentDraggingPointerID==t.event.pointerId&&n.releaseDrag();else if(t.type==s.a.POINTERMOVE){var o=t.event.pointerId;n.currentDraggingPointerID===e._AnyMouseID&&o!==e._AnyMouseID&&"mouse"==t.event.pointerType&&(n._lastPointerRay[n.currentDraggingPointerID]&&(n._lastPointerRay[o]=n._lastPointerRay[n.currentDraggingPointerID],delete n._lastPointerRay[n.currentDraggingPointerID]),n.currentDraggingPointerID=o),n._lastPointerRay[o]||(n._lastPointerRay[o]=new l.a(new a.x,new a.x)),t.pickInfo&&t.pickInfo.ray&&(n._lastPointerRay[o].origin.copyFrom(t.pickInfo.ray.origin),n._lastPointerRay[o].direction.copyFrom(t.pickInfo.ray.direction),n.currentDraggingPointerID==o&&n.dragging&&n._moveDrag(t.pickInfo.ray))}}),this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(){n._moving&&n.moveAttached&&(u.a._RemoveAndStorePivotPoint(n._attachedNode),n._targetPosition.subtractToRef(n._attachedNode.absolutePosition,n._tmpVector),n._tmpVector.scaleInPlace(n.dragDeltaRatio),n._attachedNode.getAbsolutePosition().addToRef(n._tmpVector,n._tmpVector),n.validateDrag(n._tmpVector)&&n._attachedNode.setAbsolutePosition(n._tmpVector),u.a._RestorePivotPoint(n._attachedNode))})},e.prototype.releaseDrag=function(){this.dragging=!1,this.onDragEndObservable.notifyObservers({dragPlanePoint:this.lastDragPosition,pointerId:this.currentDraggingPointerID}),this.currentDraggingPointerID=-1,this._moving=!1,this.detachCameraControls&&this._attachedElement&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&this._scene.activeCamera.attachControl(this._attachedElement,!0)},e.prototype.startDrag=function(t,n,r){void 0===t&&(t=e._AnyMouseID),this._startDrag(t,n,r);var i=this._lastPointerRay[t];t===e._AnyMouseID&&(i=this._lastPointerRay[Object.keys(this._lastPointerRay)[0]]),i&&this._moveDrag(i)},e.prototype._startDrag=function(e,t,n){if(this._scene.activeCamera&&!this.dragging&&this._attachedNode){u.a._RemoveAndStorePivotPoint(this._attachedNode),t?(this._startDragRay.direction.copyFrom(t.direction),this._startDragRay.origin.copyFrom(t.origin)):(this._startDragRay.origin.copyFrom(this._scene.activeCamera.position),this._attachedNode.getWorldMatrix().getTranslationToRef(this._tmpVector),this._tmpVector.subtractToRef(this._scene.activeCamera.position,this._startDragRay.direction)),this._updateDragPlanePosition(this._startDragRay,n||this._tmpVector);var r=this._pickWithRayOnDragPlane(this._startDragRay);r&&(this.dragging=!0,this.currentDraggingPointerID=e,this.lastDragPosition.copyFrom(r),this.onDragStartObservable.notifyObservers({dragPlanePoint:r,pointerId:this.currentDraggingPointerID}),this._targetPosition.copyFrom(this._attachedNode.absolutePosition),this.detachCameraControls&&this._scene.activeCamera&&!this._scene.activeCamera.leftCamera&&(this._scene.activeCamera.inputs.attachedElement?(this._attachedElement=this._scene.activeCamera.inputs.attachedElement,this._scene.activeCamera.detachControl(this._scene.activeCamera.inputs.attachedElement)):this._attachedElement=null)),u.a._RestorePivotPoint(this._attachedNode)}},e.prototype._moveDrag=function(e){this._moving=!0;var t=this._pickWithRayOnDragPlane(e);if(t){this.updateDragPlane&&this._updateDragPlanePosition(e,t);var n=0;this._options.dragAxis?(a.x.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._worldDragAxis),t.subtractToRef(this.lastDragPosition,this._tmpVector),n=a.x.Dot(this._tmpVector,this._worldDragAxis),this._worldDragAxis.scaleToRef(n,this._dragDelta)):(n=this._dragDelta.length(),t.subtractToRef(this.lastDragPosition,this._dragDelta)),this._targetPosition.addInPlace(this._dragDelta),this.onDragObservable.notifyObservers({dragDistance:n,delta:this._dragDelta,dragPlanePoint:t,dragPlaneNormal:this._dragPlane.forward,pointerId:this.currentDraggingPointerID}),this.lastDragPosition.copyFrom(t)}},e.prototype._pickWithRayOnDragPlane=function(t){var n=this;if(!t)return null;var r=Math.acos(a.x.Dot(this._dragPlane.forward,t.direction));if(r>Math.PI/2&&(r=Math.PI-r),this.maxDragAngle>0&&r>this.maxDragAngle){if(this._useAlternatePickedPointAboveMaxDragAngle){this._tmpVector.copyFrom(t.direction),this._attachedNode.absolutePosition.subtractToRef(t.origin,this._alternatePickedPoint),this._alternatePickedPoint.normalize(),this._alternatePickedPoint.scaleInPlace(this._useAlternatePickedPointAboveMaxDragAngleDragSpeed*a.x.Dot(this._alternatePickedPoint,this._tmpVector)),this._tmpVector.addInPlace(this._alternatePickedPoint);var i=a.x.Dot(this._dragPlane.forward,this._tmpVector);return this._dragPlane.forward.scaleToRef(-i,this._alternatePickedPoint),this._alternatePickedPoint.addInPlace(this._tmpVector),this._alternatePickedPoint.addInPlace(this._attachedNode.absolutePosition),this._alternatePickedPoint}return null}var o=e._planeScene.pickWithRay(t,function(e){return e==n._dragPlane});return o&&o.hit&&o.pickedMesh&&o.pickedPoint?o.pickedPoint:null},e.prototype._updateDragPlanePosition=function(e,t){this._pointA.copyFrom(t),this._options.dragAxis?(this.useObjectOrienationForDragging?a.x.TransformCoordinatesToRef(this._options.dragAxis,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragAxis),this._pointA.addToRef(this._localAxis,this._pointB),e.origin.subtractToRef(this._pointA,this._pointC),this._pointA.addToRef(this._pointC.normalize(),this._pointC),this._pointB.subtractToRef(this._pointA,this._lineA),this._pointC.subtractToRef(this._pointA,this._lineB),a.x.CrossToRef(this._lineA,this._lineB,this._lookAt),a.x.CrossToRef(this._lineA,this._lookAt,this._lookAt),this._lookAt.normalize(),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._lookAt,this._lookAt),this._dragPlane.lookAt(this._lookAt)):this._options.dragPlaneNormal?(this.useObjectOrienationForDragging?a.x.TransformCoordinatesToRef(this._options.dragPlaneNormal,this._attachedNode.getWorldMatrix().getRotationMatrix(),this._localAxis):this._localAxis.copyFrom(this._options.dragPlaneNormal),this._dragPlane.position.copyFrom(this._pointA),this._pointA.addToRef(this._localAxis,this._lookAt),this._dragPlane.lookAt(this._lookAt)):(this._dragPlane.position.copyFrom(this._pointA),this._dragPlane.lookAt(e.origin)),this._dragPlane.position.copyFrom(this._attachedNode.absolutePosition),this._dragPlane.computeWorldMatrix(!0)},e.prototype.detach=function(){this._pointerObserver&&this._scene.onPointerObservable.remove(this._pointerObserver),this._beforeRenderObserver&&this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this.releaseDrag()},e._AnyMouseID=-2,e}())},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(3),i=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(t){e._ForceFullSceneLoadingForIncremental=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(t){e._ShowLoadingScreen=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._loggingLevel},set:function(t){e._loggingLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return e._CleanBoneMatrixWeights},set:function(t){e._CleanBoneMatrixWeights=t},enumerable:!0,configurable:!0}),e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._CleanBoneMatrixWeights=!1,e._loggingLevel=r.a.SCENELOADER_NO_LOGGING,e}()},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.helperFunctions="const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);\nreturn dither;\n}\n\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D=max(rgbdMaxRange/maxRGB,1.);\nD=clamp(floor(D)/255.0,0.,1.);\n\nvec3 rgb=color.rgb*D;\n\nrgb=toGammaSpace(rgb);\nreturn vec4(rgb,D);\n}\nvec3 fromRGBD(vec4 rgbd) {\n\nrgbd.rgb=toLinearSpace(rgbd.rgb);\n\nreturn rgbd.rgb/rgbd.a;\n}"},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(0),i=n(13),o=n(4),a=n(49),s=n(55),l=n(43),u=n(3),c=n(9),h=n(29),d=function(){function e(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=null),this.delayLoadState=u.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=r,n?this.setAllVerticesData(n,r):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),i&&(this.applyToMesh(i),i.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),e.CreateGeometryForMesh=function(t){var n=new e(e.RandomId(),t.getScene());return n.applyToMesh(t),n},Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return this.delayLoadState===u.a.DELAYLOADSTATE_LOADED||this.delayLoadState===u.a.DELAYLOADSTATE_NONE},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers)this._vertexBuffers[e]._rebuild()},e.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},e.prototype.setVerticesData=function(e,t,n,r){void 0===n&&(n=!1);var i=new o.b(this._engine,t,e,n,0===this._meshes.length,r);this.setVerticesBuffer(i)},e.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},e.prototype.setVerticesBuffer=function(e,t){void 0===t&&(t=null);var n=e.getKind();if(this._vertexBuffers[n]&&this._vertexBuffers[n].dispose(),this._vertexBuffers[n]=e,n===o.b.PositionKind){var r=e.getData();null!=t?this._totalVertices=t:null!=r&&(this._totalVertices=r.length/(e.byteStride/4)),this._updateExtend(r),this._resetPointsArrayCache();for(var i=this._meshes,a=i.length,s=0;s<a;s++){var u=i[s];u._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(!1),u.computeWorldMatrix(!0)}}this.notifyUpdate(n),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},e.prototype.updateVerticesDataDirectly=function(e,t,n,r){void 0===r&&(r=!1);var i=this.getVertexBuffer(e);i&&(i.updateDirectly(t,n,r),this.notifyUpdate(e))},e.prototype.updateVerticesData=function(e,t,n){void 0===n&&(n=!1);var r=this.getVertexBuffer(e);r&&(r.update(t),e===o.b.PositionKind&&this._updateBoundingInfo(n,t),this.notifyUpdate(e))},e.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var n=0,r=this._meshes;n<r.length;n++){var i=r[n];i._boundingInfo?i._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):i._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum);for(var o=0,a=i.subMeshes;o<a.length;o++)a[o].refreshBoundingInfo()}},e.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var n=this.getVertexBuffers();n&&(t==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(n,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)):this._engine.bindBuffers(n,t,e))}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},e.prototype.getVerticesData=function(e,t,n){var r=this.getVertexBuffer(e);if(!r)return null;var i=r.getData();if(!i)return null;var a=r.getSize()*o.b.GetTypeByteLength(r.type),s=this._totalVertices*r.getSize();if(r.type!==o.b.FLOAT||r.byteStride!==a){var l=[];return r.forEach(s,function(e){return l.push(e)}),l}if(!(i instanceof Array||i instanceof Float32Array)||0!==r.byteOffset||i.length!==s){if(i instanceof Array){var u=r.byteOffset/4;return c.h.Slice(i,u,u+s)}if(i instanceof ArrayBuffer)return new Float32Array(i,r.byteOffset,s);if(u=i.byteOffset+r.byteOffset,n||t&&1!==this._meshes.length){var h=new Float32Array(s),d=new Float32Array(i.buffer,u,s);return h.set(d),h}return new Float32Array(i.buffer,u,s)}return n||t&&1!==this._meshes.length?c.h.Slice(i):i},e.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},e.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},e.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},e.prototype.updateIndices=function(e,t,n){if(void 0===n&&(n=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var r=e.length!==this._indices.length;if(n||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),r)for(var i=0,o=this._meshes;i<o.length;i++)o[i]._createGlobalSubMesh(!0)}else this.setIndices(e,null,!0)},e.prototype.setIndices=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=n,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,n)),null!=t&&(this._totalVertices=t);for(var r=0,i=this._meshes;r<i.length;r++)i[r]._createGlobalSubMesh(!0);this.notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(e,t){if(!this.isReady())return null;var n=this._indices;if(t||e&&1!==this._meshes.length){for(var r=n.length,i=[],o=0;o<r;o++)i.push(n[o]);return i}return n},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},e.prototype.releaseForMesh=function(e,t){var n=this._meshes,r=n.indexOf(e);-1!==r&&(n.splice(r,1),e._geometry=null,0===n.length&&t&&this.dispose())},e.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var n=this._meshes;e._geometry=this,this._scene.pushGeometry(this),n.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},e.prototype._updateExtend=function(e){void 0===e&&(e=null),e||(e=this.getVerticesData(o.b.PositionKind)),this._extend=c.h.ExtractMinAndMax(e,0,this._totalVertices,this.boundingBias,3)},e.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var n in this._vertexBuffers){1===t&&this._vertexBuffers[n].create();var r=this._vertexBuffers[n].getBuffer();r&&(r.references=t),n===o.b.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},e.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,n=this._meshes;t<n.length;t++)n[t]._markSubMeshesAsAttributesDirty()},e.prototype.load=function(e,t){this.delayLoadState!==u.a.DELAYLOADSTATE_LOADING&&(this.isReady()?t&&t():(this.delayLoadState=u.a.DELAYLOADSTATE_LOADING,this._queueLoad(e,t)))},e.prototype._queueLoad=function(e,t){var n=this;this.delayLoadingFile&&(e._addPendingData(this),e._loadFile(this.delayLoadingFile,function(r){if(n._delayLoadingFunction){n._delayLoadingFunction(JSON.parse(r),n),n.delayLoadState=u.a.DELAYLOADSTATE_LOADED,n._delayInfo=[],e._removePendingData(n);for(var i=n._meshes,o=i.length,a=0;a<o;a++)n._applyToMesh(i[a]);t&&t()}},void 0,!0))},e.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var n=e[t+0];e[t+0]=e[t+2],e[t+2]=n}this.setIndices(e)}var r=this.getVerticesData(o.b.PositionKind,!1);if(null!=r&&r.length>0){for(t=0;t<r.length;t+=3)r[t+2]=-r[t+2];this.setVerticesData(o.b.PositionKind,r,!1)}var i=this.getVerticesData(o.b.NormalKind,!1);if(null!=i&&i.length>0){for(t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(o.b.NormalKind,i,!1)}},e.prototype._resetPointsArrayCache=function(){this._positions=null},e.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(o.b.PositionKind);if(!e||0===e.length)return!1;this._positions=[];for(var t=0;t<e.length;t+=3)this._positions.push(r.x.FromArray(e,t));return!0},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},e.prototype.dispose=function(){var e,t=this._meshes,n=t.length;for(e=0;e<n;e++)this.releaseForMesh(t[e]);for(var r in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[r].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=u.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},e.prototype.copy=function(t){var n=new i.a;n.indices=[];var r=this.getIndices();if(r)for(var o=0;o<r.length;o++)n.indices.push(r[o]);var a,s=!1,u=!1;for(a in this._vertexBuffers){var c=this.getVerticesData(a);if(c&&(c instanceof Float32Array?n.set(new Float32Array(c),a):n.set(c.slice(0),a),!u)){var h=this.getVertexBuffer(a);h&&(u=!(s=h.isUpdatable()))}}var d=new e(t,this._scene,n,s);for(a in d.delayLoadState=this.delayLoadState,d.delayLoadingFile=this.delayLoadingFile,d._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)d._delayInfo=d._delayInfo||[],d._delayInfo.push(a);return d._boundingInfo=new l.a(this._extend.minimum,this._extend.maximum),d},e.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,h.a&&h.a.HasTags(this)&&(e.tags=h.a.GetTags(this)),e},e.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},e.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(o.b.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(o.b.PositionKind)),this.isVertexBufferUpdatable(o.b.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(o.b.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(o.b.NormalKind)),this.isVertexBufferUpdatable(o.b.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(o.b.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(o.b.TangentKind)),this.isVertexBufferUpdatable(o.b.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(o.b.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(o.b.UVKind)),this.isVertexBufferUpdatable(o.b.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(o.b.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(o.b.UV2Kind)),this.isVertexBufferUpdatable(o.b.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(o.b.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(o.b.UV3Kind)),this.isVertexBufferUpdatable(o.b.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(o.b.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(o.b.UV4Kind)),this.isVertexBufferUpdatable(o.b.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(o.b.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(o.b.UV5Kind)),this.isVertexBufferUpdatable(o.b.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(o.b.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(o.b.UV6Kind)),this.isVertexBufferUpdatable(o.b.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(o.b.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(o.b.ColorKind)),this.isVertexBufferUpdatable(o.b.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(o.b.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(o.b.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(o.b.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(o.b.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(o.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(o.b.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},e.ExtractFromMesh=function(e,t){var n=e._geometry;return n?n.copy(t):null},e.RandomId=function(){return c.h.RandomId()},e._ImportGeometry=function(t,n){var i=n.getScene(),s=t.geometryId;if(s){var l=i.getGeometryByID(s);l&&l.applyToMesh(n)}else if(t instanceof ArrayBuffer){var u=n._binaryInfo;if(u.positionsAttrDesc&&u.positionsAttrDesc.count>0){var c=new Float32Array(t,u.positionsAttrDesc.offset,u.positionsAttrDesc.count);n.setVerticesData(o.b.PositionKind,c,!1)}if(u.normalsAttrDesc&&u.normalsAttrDesc.count>0){var h=new Float32Array(t,u.normalsAttrDesc.offset,u.normalsAttrDesc.count);n.setVerticesData(o.b.NormalKind,h,!1)}if(u.tangetsAttrDesc&&u.tangetsAttrDesc.count>0){var d=new Float32Array(t,u.tangetsAttrDesc.offset,u.tangetsAttrDesc.count);n.setVerticesData(o.b.TangentKind,d,!1)}if(u.uvsAttrDesc&&u.uvsAttrDesc.count>0){var f=new Float32Array(t,u.uvsAttrDesc.offset,u.uvsAttrDesc.count);n.setVerticesData(o.b.UVKind,f,!1)}if(u.uvs2AttrDesc&&u.uvs2AttrDesc.count>0){var p=new Float32Array(t,u.uvs2AttrDesc.offset,u.uvs2AttrDesc.count);n.setVerticesData(o.b.UV2Kind,p,!1)}if(u.uvs3AttrDesc&&u.uvs3AttrDesc.count>0){var m=new Float32Array(t,u.uvs3AttrDesc.offset,u.uvs3AttrDesc.count);n.setVerticesData(o.b.UV3Kind,m,!1)}if(u.uvs4AttrDesc&&u.uvs4AttrDesc.count>0){var g=new Float32Array(t,u.uvs4AttrDesc.offset,u.uvs4AttrDesc.count);n.setVerticesData(o.b.UV4Kind,g,!1)}if(u.uvs5AttrDesc&&u.uvs5AttrDesc.count>0){var _=new Float32Array(t,u.uvs5AttrDesc.offset,u.uvs5AttrDesc.count);n.setVerticesData(o.b.UV5Kind,_,!1)}if(u.uvs6AttrDesc&&u.uvs6AttrDesc.count>0){var v=new Float32Array(t,u.uvs6AttrDesc.offset,u.uvs6AttrDesc.count);n.setVerticesData(o.b.UV6Kind,v,!1)}if(u.colorsAttrDesc&&u.colorsAttrDesc.count>0){var y=new Float32Array(t,u.colorsAttrDesc.offset,u.colorsAttrDesc.count);n.setVerticesData(o.b.ColorKind,y,!1,u.colorsAttrDesc.stride)}if(u.matricesIndicesAttrDesc&&u.matricesIndicesAttrDesc.count>0){for(var b=new Int32Array(t,u.matricesIndicesAttrDesc.offset,u.matricesIndicesAttrDesc.count),E=[],x=0;x<b.length;x++){var T=b[x];E.push(255&T),E.push((65280&T)>>8),E.push((16711680&T)>>16),E.push(T>>24)}n.setVerticesData(o.b.MatricesIndicesKind,E,!1)}if(u.matricesWeightsAttrDesc&&u.matricesWeightsAttrDesc.count>0){var S=new Float32Array(t,u.matricesWeightsAttrDesc.offset,u.matricesWeightsAttrDesc.count);n.setVerticesData(o.b.MatricesWeightsKind,S,!1)}if(u.indicesAttrDesc&&u.indicesAttrDesc.count>0){var A=new Int32Array(t,u.indicesAttrDesc.offset,u.indicesAttrDesc.count);n.setIndices(A,null)}if(u.subMeshesAttrDesc&&u.subMeshesAttrDesc.count>0){var P=new Int32Array(t,u.subMeshesAttrDesc.offset,5*u.subMeshesAttrDesc.count);for(n.subMeshes=[],x=0;x<u.subMeshesAttrDesc.count;x++){var M=P[5*x+0],R=P[5*x+1],C=P[5*x+2],w=P[5*x+3],O=P[5*x+4];a.b.AddToMesh(M,R,C,w,O,n)}}}else if(t.positions&&t.normals&&t.indices){if(n.setVerticesData(o.b.PositionKind,t.positions,t.positions._updatable),n.setVerticesData(o.b.NormalKind,t.normals,t.normals._updatable),t.tangents&&n.setVerticesData(o.b.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&n.setVerticesData(o.b.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&n.setVerticesData(o.b.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&n.setVerticesData(o.b.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&n.setVerticesData(o.b.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&n.setVerticesData(o.b.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&n.setVerticesData(o.b.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&n.setVerticesData(o.b.ColorKind,r.f.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(o.b.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(E=[],x=0;x<t.matricesIndices.length;x++){var I=t.matricesIndices[x];E.push(255&I),E.push((65280&I)>>8),E.push((16711680&I)>>16),E.push(I>>24)}n.setVerticesData(o.b.MatricesIndicesKind,E,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,n.setVerticesData(o.b.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(E=[],x=0;x<t.matricesIndicesExtra.length;x++)I=t.matricesIndicesExtra[x],E.push(255&I),E.push((65280&I)>>8),E.push((16711680&I)>>16),E.push(I>>24);n.setVerticesData(o.b.MatricesIndicesExtraKind,E,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,n),n.setVerticesData(o.b.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&n.setVerticesData(o.b.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),n.setIndices(t.indices,null)}if(t.subMeshes){n.subMeshes=[];for(var D=0;D<t.subMeshes.length;D++){var L=t.subMeshes[D];a.b.AddToMesh(L.materialIndex,L.verticesStart,L.verticesCount,L.indexStart,L.indexCount,n)}}n._shouldGenerateFlatShading&&(n.convertToFlatShadedMesh(),delete n._shouldGenerateFlatShading),n.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(n)},e._CleanMatricesWeights=function(e,t){if(s.a.CleanBoneMatrixWeights){var n=0;if(e.skeletonId>-1){var r=t.getScene().getLastSkeletonByID(e.skeletonId);if(r){n=r.bones.length;for(var i=t.getVerticesData(o.b.MatricesIndicesKind),a=t.getVerticesData(o.b.MatricesIndicesExtraKind),l=e.matricesWeights,u=e.matricesWeightsExtra,c=e.numBoneInfluencer,h=l.length,d=0;d<h;d+=4){for(var f=0,p=-1,m=0;m<4;m++)f+=g=l[d+m],g<.001&&p<0&&(p=m);if(u)for(m=0;m<4;m++){var g;f+=g=u[d+m],g<.001&&p<0&&(p=m+4)}if((p<0||p>c-1)&&(p=c-1),f>.001){var _=1/f;for(m=0;m<4;m++)l[d+m]*=_;if(u)for(m=0;m<4;m++)u[d+m]*=_}else p>=4?(u[d+p-4]=1-f,a[d+p-4]=n):(l[d+p]=1-f,i[d+p]=n)}t.setVerticesData(o.b.MatricesIndicesKind,i),e.matricesWeightsExtra&&t.setVerticesData(o.b.MatricesIndicesExtraKind,a)}}}},e.Parse=function(t,n,a){if(n.getGeometryByID(t.id))return null;var s=new e(t.id,n,void 0,t.updatable);return h.a&&h.a.AddTagsTo(s,t.tags),t.delayLoadingFile?(s.delayLoadState=u.a.DELAYLOADSTATE_NOTLOADED,s.delayLoadingFile=a+t.delayLoadingFile,s._boundingInfo=new l.a(r.x.FromArray(t.boundingBoxMinimum),r.x.FromArray(t.boundingBoxMaximum)),s._delayInfo=[],t.hasUVs&&s._delayInfo.push(o.b.UVKind),t.hasUVs2&&s._delayInfo.push(o.b.UV2Kind),t.hasUVs3&&s._delayInfo.push(o.b.UV3Kind),t.hasUVs4&&s._delayInfo.push(o.b.UV4Kind),t.hasUVs5&&s._delayInfo.push(o.b.UV5Kind),t.hasUVs6&&s._delayInfo.push(o.b.UV6Kind),t.hasColors&&s._delayInfo.push(o.b.ColorKind),t.hasMatricesIndices&&s._delayInfo.push(o.b.MatricesIndicesKind),t.hasMatricesWeights&&s._delayInfo.push(o.b.MatricesWeightsKind),s._delayLoadingFunction=i.a.ImportVertexData):i.a.ImportVertexData(t,s),n.pushGeometry(s,!0),s},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(1),i=n(8),o=n(0),a=n(42),s=n(53),l=n(54),u=n(48),c=n(41),h=n(33),d=function(e){function t(n,r,a){void 0===r&&(r=o.e.Gray()),void 0===a&&(a=c.a.DefaultUtilityLayer);var s=e.call(this,a)||this;s._pointerObserver=null,s.snapDistance=0,s.onSnapObservable=new i.c;var u=new h.a("",a.utilityLayerScene);u.diffuseColor=r,u.specularColor=r.subtract(new o.e(.1,.1,.1));var d=new h.a("",a.utilityLayerScene);d.diffuseColor=r.add(new o.e(.3,.3,.3));var f=t._CreateArrow(a.utilityLayerScene,u);f.lookAt(s._rootMesh.position.add(n)),f.scaling.scaleInPlace(1/3),f.parent=s._rootMesh;var p=0,m=new o.x,g={snapDistance:0};s.dragBehavior=new l.a({dragAxis:n}),s.dragBehavior.moveAttached=!1,s._rootMesh.addBehavior(s.dragBehavior);var _=new o.x,v=new o.j;s.dragBehavior.onDragObservable.add(function(e){if(s.attachedMesh)if(s.attachedMesh.parent?(s.attachedMesh.parent.computeWorldMatrix().invertToRef(v),v.setTranslationFromFloats(0,0,0),o.x.TransformCoordinatesToRef(e.delta,v,_)):_.copyFrom(e.delta),0==s.snapDistance)s.attachedMesh.position.addInPlace(_);else if(p+=e.dragDistance,Math.abs(p)>s.snapDistance){var t=Math.floor(Math.abs(p)/s.snapDistance);p%=s.snapDistance,_.normalizeToRef(m),m.scaleInPlace(s.snapDistance*t),s.attachedMesh.position.addInPlace(m),g.snapDistance=s.snapDistance*t,s.onSnapObservable.notifyObservers(g)}}),s._pointerObserver=a.utilityLayerScene.onPointerObservable.add(function(e){if(!s._customMeshSet){var t=e.pickInfo&&-1!=s._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?d:u;s._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)})}});var y=a._getSharedGizmoLight();return y.includedOnlyMeshes=y.includedOnlyMeshes.concat(s._rootMesh.getChildMeshes(!1)),s}return r.d(t,e),t._CreateArrow=function(e,t){var n=new a.a("arrow",e),r=s.a.CreateCylinder("cylinder",{diameterTop:0,height:.075,diameterBottom:.0375,tessellation:96},e),i=s.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},e);return i.material=t,r.parent=n,i.parent=n,r.material=t,r.rotation.x=Math.PI/2,r.position.z+=.3,i.position.z+=.1375,i.rotation.x=Math.PI/2,n},t._CreateArrowInstance=function(e,t){for(var n=new a.a("arrow",e),r=0,i=t.getChildMeshes();r<i.length;r++){var o=i[r];o.createInstance(o.name).parent=n}return n},t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.FilesToLoad={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){this._xhr=new XMLHttpRequest}return e.prototype._injectCustomRequestHeaders=function(){for(var t in e.CustomRequestHeaders){var n=e.CustomRequestHeaders[t];n&&this._xhr.setRequestHeader(t,n)}},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!0,configurable:!0}),e.prototype.addEventListener=function(e,t,n){this._xhr.addEventListener(e,t,n)},e.prototype.removeEventListener=function(e,t,n){this._xhr.removeEventListener(e,t,n)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},e.prototype.open=function(t,n){for(var r=0,i=e.CustomRequestModifiers;r<i.length;r++)(0,i[r])(this._xhr);return this._xhr.open(t,n,!0)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){this._count=0,this._data={}}return e.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach(function(e,n){return t.add(e,n)})},e.prototype.get=function(e){var t=this._data[e];if(void 0!==t)return t},e.prototype.getOrAddWithFactory=function(e,t){var n=this.get(e);return void 0!==n?n:((n=t(e))&&this.add(e,n),n)},e.prototype.getOrAdd=function(e,t){var n=this.get(e);return void 0!==n?n:(this.add(e,t),t)},e.prototype.contains=function(e){return void 0!==this._data[e]},e.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},e.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},e.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null},e.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._data)e(t,this._data[t])},e.prototype.first=function(e){for(var t in this._data){var n=e(t,this._data[t]);if(n)return n}return null},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return u});var r=n(0),i=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],o=[function(e){return 1},function(e){return e.y},function(e){return e.z},function(e){return e.x},function(e){return e.x*e.y},function(e){return e.y*e.z},function(e){return 3*e.z*e.z-1},function(e){return e.x*e.z},function(e){return e.x*e.x-e.y*e.y}],a=function(e,t){return i[e]*o[e](t)},s=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],l=function(){function e(){this.preScaled=!1,this.l00=r.x.Zero(),this.l1_1=r.x.Zero(),this.l10=r.x.Zero(),this.l11=r.x.Zero(),this.l2_2=r.x.Zero(),this.l2_1=r.x.Zero(),this.l20=r.x.Zero(),this.l21=r.x.Zero(),this.l22=r.x.Zero()}return e.prototype.addLight=function(e,t,n){var i=new r.x(t.r,t.g,t.b).scale(n);this.l00=this.l00.add(i.scale(a(0,e))),this.l1_1=this.l1_1.add(i.scale(a(1,e))),this.l10=this.l10.add(i.scale(a(2,e))),this.l11=this.l11.add(i.scale(a(3,e))),this.l2_2=this.l2_2.add(i.scale(a(4,e))),this.l2_1=this.l2_1.add(i.scale(a(5,e))),this.l20=this.l20.add(i.scale(a(6,e))),this.l21=this.l21.add(i.scale(a(7,e))),this.l22=this.l22.add(i.scale(a(8,e)))},e.prototype.scaleInPlace=function(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)},e.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(s[0]),this.l1_1.scaleInPlace(s[1]),this.l10.scaleInPlace(s[2]),this.l11.scaleInPlace(s[3]),this.l2_2.scaleInPlace(s[4]),this.l2_1.scaleInPlace(s[5]),this.l20.scaleInPlace(s[6]),this.l21.scaleInPlace(s[7]),this.l22.scaleInPlace(s[8])},e.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},e.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(i[0]),this.l1_1.scaleInPlace(i[1]),this.l10.scaleInPlace(i[2]),this.l11.scaleInPlace(i[3]),this.l2_2.scaleInPlace(i[4]),this.l2_1.scaleInPlace(i[5]),this.l20.scaleInPlace(i[6]),this.l21.scaleInPlace(i[7]),this.l22.scaleInPlace(i[8])},e.FromArray=function(t){var n=new e;return r.x.FromArrayToRef(t[0],0,n.l00),r.x.FromArrayToRef(t[1],0,n.l1_1),r.x.FromArrayToRef(t[2],0,n.l10),r.x.FromArrayToRef(t[3],0,n.l11),r.x.FromArrayToRef(t[4],0,n.l2_2),r.x.FromArrayToRef(t[5],0,n.l2_1),r.x.FromArrayToRef(t[6],0,n.l20),r.x.FromArrayToRef(t[7],0,n.l21),r.x.FromArrayToRef(t[8],0,n.l22),n},e.FromPolynomial=function(t){var n=new e;return n.l00=t.xx.scale(.376127).add(t.yy.scale(.376127)).add(t.zz.scale(.376126)),n.l1_1=t.y.scale(.977204),n.l10=t.z.scale(.977204),n.l11=t.x.scale(.977204),n.l2_2=t.xy.scale(1.16538),n.l2_1=t.yz.scale(1.16538),n.l20=t.zz.scale(1.34567).subtract(t.xx.scale(.672834)).subtract(t.yy.scale(.672834)),n.l21=t.zx.scale(1.16538),n.l22=t.xx.scale(1.16538).subtract(t.yy.scale(1.16538)),n.l1_1.scaleInPlace(-1),n.l11.scaleInPlace(-1),n.l2_1.scaleInPlace(-1),n.l21.scaleInPlace(-1),n.scaleInPlace(Math.PI),n},e}(),u=function(){function e(){this.x=r.x.Zero(),this.y=r.x.Zero(),this.z=r.x.Zero(),this.xx=r.x.Zero(),this.yy=r.x.Zero(),this.zz=r.x.Zero(),this.xy=r.x.Zero(),this.yz=r.x.Zero(),this.zx=r.x.Zero()}return Object.defineProperty(e.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=l.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!0,configurable:!0}),e.prototype.addAmbient=function(e){var t=new r.x(e.r,e.g,e.b);this.xx=this.xx.add(t),this.yy=this.yy.add(t),this.zz=this.zz.add(t)},e.prototype.scaleInPlace=function(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)},e.FromHarmonics=function(t){var n=new e;return n._harmonics=t,n.x=t.l11.scale(1.02333).scale(-1),n.y=t.l1_1.scale(1.02333).scale(-1),n.z=t.l10.scale(1.02333),n.xx=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).add(t.l22.scale(.429043)),n.yy=t.l00.scale(.886277).subtract(t.l20.scale(.247708)).subtract(t.l22.scale(.429043)),n.zz=t.l00.scale(.886277).add(t.l20.scale(.495417)),n.yz=t.l2_1.scale(.858086).scale(-1),n.zx=t.l21.scale(.858086).scale(-1),n.xy=t.l2_2.scale(.858086),n.scaleInPlace(1/Math.PI),n},e.FromArray=function(t){var n=new e;return r.x.FromArrayToRef(t[0],0,n.x),r.x.FromArrayToRef(t[1],0,n.y),r.x.FromArrayToRef(t[2],0,n.z),r.x.FromArrayToRef(t[3],0,n.xx),r.x.FromArrayToRef(t[4],0,n.yy),r.x.FromArrayToRef(t[5],0,n.zz),r.x.FromArrayToRef(t[6],0,n.yz),r.x.FromArrayToRef(t[7],0,n.zx),r.x.FromArrayToRef(t[8],0,n.xy),n},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(6),i=function(){function e(e,t,n){this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=n,this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var n=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var r=this._uniformLocationPointer-n,i=0;i<r;i++)this._data.push(0)}},e.prototype.addUniform=function(e,t){if(!this._noUBO&&void 0===this._uniformLocations[e]){var n;if(t instanceof Array)t=(n=t).length;else{t=t,n=[];for(var r=0;r<t;r++)n.push(0)}for(this._fillAlignment(t),this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t,r=0;r<t;r++)this._data.push(n[r]);this._needSync=!0}},e.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},e.prototype.addFloat2=function(e,t,n){var r=[t,n];this.addUniform(e,r)},e.prototype.addFloat3=function(e,t,n,r){var i=[t,n,r];this.addUniform(e,i)},e.prototype.addColor3=function(e,t){var n=new Array;t.toArray(n),this.addUniform(e,n)},e.prototype.addColor4=function(e,t,n){var r=new Array;t.toArray(r),r.push(n),this.addUniform(e,r)},e.prototype.addVector3=function(e,t){var n=new Array;t.toArray(n),this.addUniform(e,n)},e.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},e.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},e.prototype.update=function(){this._buffer?(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1):this.create()},e.prototype.updateUniform=function(e,t,n){var i=this._uniformLocations[e];if(void 0===i){if(this._buffer)return void r.a.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,n),i=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(a=0;a<n;a++)this._bufferData[i+a]=t[a];else{for(var o=!1,a=0;a<n;a++)this._bufferData[i+a]!==t[a]&&(o=!0,this._bufferData[i+a]=t[a]);this._needSync=this._needSync||o}},e.prototype._updateMatrix3x3ForUniform=function(t,n){for(var r=0;r<3;r++)e._tempBuffer[4*r]=n[3*r],e._tempBuffer[4*r+1]=n[3*r+1],e._tempBuffer[4*r+2]=n[3*r+2],e._tempBuffer[4*r+3]=0;this.updateUniform(t,e._tempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},e.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},e.prototype._updateMatrix2x2ForUniform=function(t,n){for(var r=0;r<2;r++)e._tempBuffer[4*r]=n[2*r],e._tempBuffer[4*r+1]=n[2*r+1],e._tempBuffer[4*r+2]=0,e._tempBuffer[4*r+3]=0;this.updateUniform(t,e._tempBuffer,8)},e.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},e.prototype._updateFloatForUniform=function(t,n){e._tempBuffer[0]=n,this.updateUniform(t,e._tempBuffer,1)},e.prototype._updateFloat2ForEffect=function(e,t,n,r){void 0===r&&(r=""),this._currentEffect.setFloat2(e+r,t,n)},e.prototype._updateFloat2ForUniform=function(t,n,r){e._tempBuffer[0]=n,e._tempBuffer[1]=r,this.updateUniform(t,e._tempBuffer,2)},e.prototype._updateFloat3ForEffect=function(e,t,n,r,i){void 0===i&&(i=""),this._currentEffect.setFloat3(e+i,t,n,r)},e.prototype._updateFloat3ForUniform=function(t,n,r,i){e._tempBuffer[0]=n,e._tempBuffer[1]=r,e._tempBuffer[2]=i,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateFloat4ForEffect=function(e,t,n,r,i,o){void 0===o&&(o=""),this._currentEffect.setFloat4(e+o,t,n,r,i)},e.prototype._updateFloat4ForUniform=function(t,n,r,i,o){e._tempBuffer[0]=n,e._tempBuffer[1]=r,e._tempBuffer[2]=i,e._tempBuffer[3]=o,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},e.prototype._updateMatrixForUniform=function(e,t){this.updateUniform(e,t.toArray(),16)},e.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},e.prototype._updateVector3ForUniform=function(t,n){n.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},e.prototype._updateVector4ForUniform=function(t,n){n.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateColor3ForEffect=function(e,t,n){void 0===n&&(n=""),this._currentEffect.setColor3(e+n,t)},e.prototype._updateColor3ForUniform=function(t,n){n.toArray(e._tempBuffer),this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateColor4ForEffect=function(e,t,n,r){void 0===r&&(r=""),this._currentEffect.setColor4(e+r,t,n)},e.prototype._updateColor4ForUniform=function(t,n,r){n.toArray(e._tempBuffer),e._tempBuffer[3]=r,this.updateUniform(t,e._tempBuffer,4)},e.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},e.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},e.prototype.bindToEffect=function(e,t){this._currentEffect=e,!this._noUBO&&this._buffer&&e.bindUniformBuffer(this._buffer,t)},e.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);-1!==t&&(e[t]=e[e.length-1],e.pop()),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._MAX_UNIFORM_SIZE=256,e._tempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var n=t[e];"_"!==n[0]&&this._keys.push(n)}},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var n=this._keys[t];if(this[n]!==e[n])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var n=this._keys[t];e[n]=this[n]}},e.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e];switch(typeof this[t]){case"number":this[t]=0;break;case"string":this[t]="";break;default:this[t]=!1}}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var n=this._keys[t],r=this[n];switch(typeof r){case"number":case"string":e+="#define "+n+" "+r+"\n";break;default:r&&(e+="#define "+n+"\n")}}return e},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(1),i=n(2),o=n(0),a=n(25),s=n(38);a.a.AddNodeConstructor("Light_Type_3",function(e,t){return function(){return new l(e,o.x.Zero(),t)}});var l=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i.groundColor=new o.e(0,0,0),i.direction=n||o.x.Up(),i}return r.d(t,e),t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.getClassName=function(){return"HemisphericLight"},t.prototype.setDirectionToTarget=function(e){return this.direction=o.x.Normalize(e.subtract(o.x.Zero())),this.direction},t.prototype.getShadowGenerator=function(){return null},t.prototype.transferToEffect=function(e,t){var n=o.x.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),t),this},t.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=o.j.Identity()),this._worldMatrix},t.prototype.getTypeID=function(){return s.a.LIGHTTYPEID_HEMISPHERICLIGHT},t.prototype.prepareLightSpecificDefines=function(e,t){e["HEMILIGHT"+t]=!0},r.c([Object(i.e)()],t.prototype,"groundColor",void 0),r.c([Object(i.o)()],t.prototype,"direction",void 0),t}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1),i=n(20),o=n(29),a=n(22),s=function(e){function t(t,n){var r=e.call(this,t,n,!0)||this;return n.multiMaterials.push(r),r.subMaterials=new Array,r._storeEffectOnSubMeshes=!0,r}return r.d(t,e),Object.defineProperty(t.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!0,configurable:!0}),t.prototype.getChildren=function(){return this.subMaterials},t.prototype._hookArray=function(e){var t=this,n=e.push;e.push=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=n.apply(e,r);return t._markAllSubMeshesAsTexturesDirty(),o};var r=e.splice;e.splice=function(n,i){var o=r.apply(e,[n,i]);return t._markAllSubMeshesAsTexturesDirty(),o}},t.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},t.prototype.getActiveTextures=function(){var t;return(t=e.prototype.getActiveTextures.call(this)).concat.apply(t,this.subMaterials.map(function(e){return e?e.getActiveTextures():[]}))},t.prototype.getClassName=function(){return"MultiMaterial"},t.prototype.isReadyForSubMesh=function(e,t,n){for(var r=0;r<this.subMaterials.length;r++){var i=this.subMaterials[r];if(i){if(i._storeEffectOnSubMeshes){if(!i.isReadyForSubMesh(e,t,n))return!1;continue}if(!i.isReady(e))return!1}}return!0},t.prototype.clone=function(e,n){for(var r=new t(e,this.getScene()),i=0;i<this.subMaterials.length;i++){var o=null,a=this.subMaterials[i];o=n&&a?a.clone(e+"-"+a.name):this.subMaterials[i],r.subMaterials.push(o)}return r},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,o.a&&(e.tags=o.a.GetTags(this)),e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var n=this.subMaterials[t];n?e.materials.push(n.id):e.materials.push(null)}return e},t.prototype.dispose=function(t,n,r){var i=this.getScene();if(i){if(r)for(var o=0;o<this.subMaterials.length;o++){var a=this.subMaterials[o];a&&a.dispose(t,n)}(o=i.multiMaterials.indexOf(this))>=0&&i.multiMaterials.splice(o,1),e.prototype.dispose.call(this,t,n)}},t.ParseMultiMaterial=function(e,n){var r=new t(e.name,n);r.id=e.id,o.a&&o.a.AddTagsTo(r,e.tags);for(var i=0;i<e.materials.length;i++){var a=e.materials[i];a?r.subMaterials.push(n.getMaterialByID(a)):r.subMaterials.push(null)}return r},t}(i.a);a.a.RegisteredTypes["BABYLON.MultiMaterial"]=s},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bonesDeclaration="#if NUM_BONE_INFLUENCERS>0\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifdef BONETEXTURE\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index*4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.instancesDeclaration="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.instancesVertex="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bonesVertex="#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif"},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(0),i=n(12),o=n(62),a=n(3),s=function(e,t,n,r){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=n,this.worldAxisForFileY=r},l=function(){function e(){}return e.ConvertCubeMapTextureToSphericalPolynomial=function(e){if(!e.isCube)return null;var t,n,r=e.getSize().width,i=e.readPixels(0),o=e.readPixels(1);e.isRenderTarget?(t=e.readPixels(3),n=e.readPixels(2)):(t=e.readPixels(2),n=e.readPixels(3));var s=e.readPixels(4),l=e.readPixels(5),u=e.gammaSpace,c=a.a.TEXTUREFORMAT_RGBA,h=a.a.TEXTURETYPE_UNSIGNED_INT;e.textureType&&e.textureType!==a.a.TEXTURETYPE_UNSIGNED_INT&&(h=a.a.TEXTURETYPE_FLOAT);var d={size:r,right:i,left:o,up:t,down:n,front:s,back:l,format:c,type:h,gammaSpace:u};return this.ConvertCubeMapToSphericalPolynomial(d)},e.ConvertCubeMapToSphericalPolynomial=function(e){for(var t=new o.a,n=0,s=2/e.size,l=s,u=.5*s-1,c=0;c<6;c++)for(var h=this.FileFaces[c],d=e[h.name],f=u,p=e.format===a.a.TEXTUREFORMAT_RGBA?4:3,m=0;m<e.size;m++){for(var g=u,_=0;_<e.size;_++){var v=h.worldAxisForFileX.scale(g).add(h.worldAxisForFileY.scale(f)).add(h.worldAxisForNormal);v.normalize();var y=Math.pow(1+g*g+f*f,-1.5),b=d[m*e.size*p+_*p+0],E=d[m*e.size*p+_*p+1],x=d[m*e.size*p+_*p+2];e.type===a.a.TEXTURETYPE_UNSIGNED_INT&&(b/=255,E/=255,x/=255),e.gammaSpace&&(b=Math.pow(i.a.Clamp(b),r.v),E=Math.pow(i.a.Clamp(E),r.v),x=Math.pow(i.a.Clamp(x),r.v));var T=new r.e(b,E,x);t.addLight(v,T,y),n+=y,g+=s}f+=l}var S=4*Math.PI*6/6/n;return t.scaleInPlace(S),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),o.b.FromHarmonics(t)},e.FileFaces=[new s("right",new r.x(1,0,0),new r.x(0,0,-1),new r.x(0,-1,0)),new s("left",new r.x(-1,0,0),new r.x(0,0,1),new r.x(0,-1,0)),new s("up",new r.x(0,1,0),new r.x(1,0,0),new r.x(0,0,1)),new s("down",new r.x(0,-1,0),new r.x(1,0,0),new r.x(0,0,-1)),new s("front",new r.x(0,0,1),new r.x(1,0,0),new r.x(0,-1,0)),new s("back",new r.x(0,0,-1),new r.x(-1,0,0),new r.x(0,-1,0))],e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return h}),n.d(t,"a",function(){return d});var r=n(1),i=n(0),o=n(4),a=n(11),s=n(111),l=n(20),u=n(76),c=(n(126),n(127),n(15)),h=function(e){function t(t,n,r,a,s,l,c){void 0===n&&(n=null),void 0===r&&(r=null);var h=e.call(this,t,n,r,a,s)||this;h.useVertexColor=l,h.useVertexAlpha=c,h.color=new i.e(1,1,1),h.alpha=1,a&&(h.color=a.color.clone(),h.alpha=a.alpha,h.useVertexColor=a.useVertexColor,h.useVertexAlpha=a.useVertexAlpha),h.intersectionThreshold=.1;var d={attributes:[o.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===c&&(d.needAlphaBlending=!1),l?(d.defines.push("#define VERTEXCOLOR"),d.attributes.push(o.b.ColorKind)):d.uniforms.push("color"),h._colorShader=new u.a("colorShader",h.getScene(),"color",d),h}return r.d(t,e),t.prototype._addClipPlaneDefine=function(e){var t="#define "+e;-1===this._colorShader.options.defines.indexOf(t)&&this._colorShader.options.defines.push(t)},t.prototype._removeClipPlaneDefine=function(e){var t="#define "+e,n=this._colorShader.options.defines.indexOf(t);-1!==n&&this._colorShader.options.defines.splice(n,1)},t.prototype.isReady=function(){var t=this.getScene();return t.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),t.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),t.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),t.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),!!this._colorShader.isReady()&&e.prototype.isReady.call(this)},t.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(t.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._bind=function(e,t,n){if(!this._geometry)return this;var r=this._colorShader.getEffect(),i=this.isUnIndexed?null:this._geometry.getIndexBuffer();return this._geometry._bind(r,i),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),c.a.BindClipPlane(r,this.getScene()),this},t.prototype._draw=function(e,t,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var r=this.getScene().getEngine();return this._unIndexed?r.drawArraysType(l.a.LineListDrawMode,e.verticesStart,e.verticesCount,n):r.drawElementsType(l.a.LineListDrawMode,e.indexStart,e.indexCount,n),this},t.prototype.dispose=function(t){this._colorShader.dispose(!1,!1,!0),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e,n,r){return new t(e,this.getScene(),n,this,r)},t.prototype.createInstance=function(e){return new d(e,this)},t}(a.a),d=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.intersectionThreshold=n.intersectionThreshold,r}return r.d(t,e),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1),i=function(e){function t(t){var n=e.call(this)||this;return n._buffer=t,n}return r.d(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}(n(78).a)},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(33),o=n(58),a=function(){function e(t,n,a,s,l,u){if(void 0===n&&(n=1),void 0===a&&(a=2),this._scaleLinesFactor=4,this._instanced=!1,this.scaleLines=1,this.scaleLines=n,!s){var c=new i.a("",t);c.disableLighting=!0,c.emissiveColor=r.e.Red().scale(.5),s=o.a._CreateArrow(t,c)}if(!l){var h=new i.a("",t);h.disableLighting=!0,h.emissiveColor=r.e.Green().scale(.5),l=o.a._CreateArrow(t,h)}if(!u){var d=new i.a("",t);d.disableLighting=!0,d.emissiveColor=r.e.Blue().scale(.5),u=o.a._CreateArrow(t,d)}this._xAxis=s,this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis=l,this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis=u,this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),null!=a&&(e._SetRenderingGroupId(this._xAxis,a),e._SetRenderingGroupId(this._yAxis,a),e._SetRenderingGroupId(this._zAxis,a)),this.scene=t,this.update(new r.x,r.x.Right(),r.x.Up(),r.x.Forward())}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zAxis",{get:function(){return this._zAxis},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t,n,r){this._xAxis.position.copyFrom(e),this._xAxis.setDirection(t),this._xAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._yAxis.position.copyFrom(e),this._yAxis.setDirection(n),this._yAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor),this._zAxis.position.copyFrom(e),this._zAxis.setDirection(r),this._zAxis.scaling.setAll(this.scaleLines*this._scaleLinesFactor)},e.prototype.createInstance=function(){var t=o.a._CreateArrowInstance(this.scene,this._xAxis),n=o.a._CreateArrowInstance(this.scene,this._yAxis),r=o.a._CreateArrowInstance(this.scene,this._zAxis),i=new e(this.scene,this.scaleLines,null,t,n,r);return i._instanced=!0,i},e.prototype.dispose=function(){this._xAxis&&(this._xAxis.dispose(!1,!this._instanced),delete this._xAxis),this._yAxis&&(this._yAxis.dispose(!1,!this._instanced),delete this._yAxis),this._zAxis&&(this._zAxis.dispose(!1,!this._instanced),delete this._zAxis),delete this.scene},e._SetRenderingGroupId=function(e,t){e.getChildMeshes().forEach(function(e){e.renderingGroupId=t})},e}(),s=n(1),l=function(e){function t(t,n,i,o){void 0===o&&(o=1);var a=e.call(this,t,o)||this;return a.pos=r.x.Zero(),a.xaxis=r.x.Zero(),a.yaxis=r.x.Zero(),a.zaxis=r.x.Zero(),a.mesh=i,a.bone=n,a}return s.d(t,e),t.prototype.update=function(){if(this.mesh&&this.bone){var t=this.bone;t.getAbsolutePositionToRef(this.mesh,this.pos),t.getDirectionToRef(r.c.X,this.mesh,this.xaxis),t.getDirectionToRef(r.c.Y,this.mesh,this.yaxis),t.getDirectionToRef(r.c.Z,this.mesh,this.zaxis),e.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},t.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,e.prototype.dispose.call(this))},t}(a),u=n(9),c=n(8),h=n(16),d=n(10);Object.defineProperty(h.a.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new f(this)),this._debugLayer},enumerable:!0,configurable:!0});var f=function(){function e(e){var t=this;this.BJSINSPECTOR=this._getGlobalInspector(),this.onPropertyChangedObservable=new c.c,this._scene=e,this._scene.onDisposeObservable.add(function(){t._scene._debugLayer&&t._scene._debugLayer.hide()})}return e.prototype._createInspector=function(e){if(!this.isVisible()){var t=s.a({overlay:!1,showExplorer:!0,showInspector:!0,embedMode:!1,handleResize:!0,enablePopup:!0},e);this.BJSINSPECTOR=this.BJSINSPECTOR||this._getGlobalInspector(),this.BJSINSPECTOR.Inspector.Show(this._scene,t)}},e.prototype.select=function(e,t){this.BJSINSPECTOR&&(this.BJSINSPECTOR.Inspector.MarkLineContainerTitleForHighlighting(t),this.BJSINSPECTOR.Inspector.OnSelectionChangeObservable.notifyObservers(e))},e.prototype._getGlobalInspector=function(){return"undefined"!=typeof INSPECTOR?INSPECTOR:"undefined"!=typeof BABYLON&&void 0!==BABYLON.Inspector?BABYLON:void 0},e.prototype.isVisible=function(){return this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.IsVisible},e.prototype.hide=function(){this.BJSINSPECTOR&&this.BJSINSPECTOR.Inspector.Hide()},e.prototype.show=function(t){var n=this;return new Promise(function(r,i){if(void 0===n.BJSINSPECTOR){var o=t&&t.inspectorURL?t.inspectorURL:e.InspectorURL;u.h.LoadScript(o,function(){n._createInspector(t),r(n)})}else n._createInspector(t),r(n)})},e.InspectorURL="https://unpkg.com/babylonjs-inspector@"+d.b.Version+"/babylon.inspector.bundle.js",e}(),p=n(11),m=n(52),g=n(46),_=n(23),v=n(27),y=n(41),b=n(53),E=function(){function e(e){this._impostors=[],this._meshes=[],this._numMeshes=0,this._debugMeshMeshes=new Array,this._scene=e||_.a.LastCreatedScene;var t=this._scene.getPhysicsEngine();t&&(this._physicsEnginePlugin=t.getPhysicsPlugin()),this._utilityLayer=new y.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0}return e.prototype._updateDebugMeshes=function(){for(var e=this._physicsEnginePlugin,t=0;t<this._numMeshes;t++){var n=this._impostors[t];if(n)if(n.isDisposed)this.hideImpostor(this._impostors[t--]);else{if(n.type===v.a.MeshImpostor)continue;var r=this._meshes[t];r&&e&&e.syncMeshWithImpostor(r,n)}}},e.prototype.showImpostor=function(e,t){if(!this._scene)return null;for(var n=0;n<this._numMeshes;n++)if(this._impostors[n]==e)return null;var r=this._getDebugMesh(e,t);return r&&(this._impostors[this._numMeshes]=e,this._meshes[this._numMeshes]=r,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++),r},e.prototype.hideImpostor=function(e){if(e&&this._scene&&this._utilityLayer){for(var t=!1,n=this._utilityLayer.utilityLayerScene,r=0;r<this._numMeshes;r++)if(this._impostors[r]==e){var i=this._meshes[r];if(!i)continue;n.removeMesh(i),i.dispose();var o=this._debugMeshMeshes.indexOf(i);o>-1&&this._debugMeshMeshes.splice(o,1),this._numMeshes--,this._numMeshes>0?(this._meshes[r]=this._meshes[this._numMeshes],this._impostors[r]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),t=!0;break}t&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},e.prototype._getDebugMaterial=function(e){return this._debugMaterial||(this._debugMaterial=new i.a("",e),this._debugMaterial.wireframe=!0,this._debugMaterial.emissiveColor=r.e.White(),this._debugMaterial.disableLighting=!0),this._debugMaterial},e.prototype._getDebugBoxMesh=function(e){return this._debugBoxMesh||(this._debugBoxMesh=m.a.CreateBox("physicsBodyBoxViewMesh",{size:1},e),this._debugBoxMesh.rotationQuaternion=r.q.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(e),this._debugBoxMesh.setEnabled(!1)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugSphereMesh=function(e){return this._debugSphereMesh||(this._debugSphereMesh=g.a.CreateSphere("physicsBodySphereViewMesh",{diameter:1},e),this._debugSphereMesh.rotationQuaternion=r.q.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(e),this._debugSphereMesh.setEnabled(!1)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugCylinderMesh=function(e){return this._debugCylinderMesh||(this._debugCylinderMesh=b.a.CreateCylinder("physicsBodyCylinderViewMesh",{diameterTop:1,diameterBottom:1,height:1},e),this._debugCylinderMesh.rotationQuaternion=r.q.Identity(),this._debugCylinderMesh.material=this._getDebugMaterial(e),this._debugCylinderMesh.setEnabled(!1)),this._debugCylinderMesh.createInstance("physicsBodyBoxViewInstance")},e.prototype._getDebugMeshMesh=function(e,t){var n=new p.a(e.name,t,null,e);return n.position=r.x.Zero(),n.setParent(e),n.material=this._getDebugMaterial(t),this._debugMeshMeshes.push(n),n},e.prototype._getDebugMesh=function(e,t){var n=this;if(!this._utilityLayer)return null;if(t&&t.parent&&t.parent.physicsImpostor)return null;var r=null,i=this._utilityLayer.utilityLayerScene;switch(e.type){case v.a.BoxImpostor:r=this._getDebugBoxMesh(i),e.getBoxSizeToRef(r.scaling);break;case v.a.SphereImpostor:r=this._getDebugSphereMesh(i);var o=e.getRadius();r.scaling.x=2*o,r.scaling.y=2*o,r.scaling.z=2*o;break;case v.a.MeshImpostor:t&&(r=this._getDebugMeshMesh(t,i));break;case v.a.NoImpostor:t&&t.getChildMeshes().filter(function(e){return e.physicsImpostor?1:0}).forEach(function(e){n._getDebugBoxMesh(i).parent=e});break;case v.a.CylinderImpostor:r=this._getDebugCylinderMesh(i);var a=e.object.getBoundingInfo();r.scaling.x=a.boundingBox.maximum.x-a.boundingBox.minimum.x,r.scaling.y=a.boundingBox.maximum.y-a.boundingBox.minimum.y,r.scaling.z=a.boundingBox.maximum.z-a.boundingBox.minimum.z}return r},e.prototype.dispose=function(){for(var e=this._numMeshes,t=0;t<e;t++)this.hideImpostor(this._impostors[0]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugCylinderMesh&&this._debugCylinderMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null,this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}(),x=n(40),T=function(){function e(e){this.ray=e}return e.CreateAndShow=function(t,n,r){var i=new e(t);return i.show(n,r),i},e.prototype.show=function(e,t){if(!this._renderFunction&&this.ray){var n=this.ray;this._renderFunction=this._render.bind(this),this._scene=e,this._renderPoints=[n.origin,n.origin.add(n.direction.scale(n.length))],this._renderLine=p.a.CreateLines("ray",this._renderPoints,e,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}t&&this._renderLine&&this._renderLine.color.copyFrom(t)},e.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},e.prototype._render=function(){var e=this.ray;if(e){var t=this._renderPoints[1],n=Math.min(e.length,1e6);t.copyFrom(e.direction),t.scaleInPlace(n),t.addInPlace(e.origin),p.a.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},e.prototype.attachToMesh=function(e,t,n,i){this._attachedToMesh=e;var o=this.ray;o&&(o.direction||(o.direction=r.x.Zero()),o.origin||(o.origin=r.x.Zero()),i&&(o.length=i),n||(n=r.x.Zero()),t||(t=new r.x(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(t),this._meshSpaceOrigin.copyFrom(n)):(this._meshSpaceDirection=t.clone(),this._meshSpaceOrigin=n.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},e.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},e.prototype._updateToMesh=function(){var e=this.ray;this._attachedToMesh&&e&&(this._attachedToMesh._isDisposed?this.detachFromMesh():(this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,e.direction),r.x.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),e.origin)))},e.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},e}(),S=function(){function e(e,t,n,i,o){void 0===i&&(i=!0),void 0===o&&(o=1),this.skeleton=e,this.mesh=t,this.autoUpdateBonesMatrices=i,this.renderingGroupId=o,this.color=r.e.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=n,this._utilityLayer=new y.a(this._scene,!1),this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!0,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(e.prototype,"debugMesh",{get:function(){return this._debugMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,e?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),e.prototype._getBonePosition=function(e,t,n,i,o,a){void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0);var s=r.t.Matrix[0],l=t.getParent();if(s.copyFrom(t.getLocalMatrix()),0!==i||0!==o||0!==a){var u=r.t.Matrix[1];r.j.IdentityToRef(u),u.setTranslationFromFloats(i,o,a),u.multiplyToRef(s,s)}l&&s.multiplyToRef(l.getAbsoluteTransform(),s),s.multiplyToRef(n,s),e.x=s.m[12],e.y=s.m[13],e.z=s.m[14]},e.prototype._getLinesForBonesWithLength=function(e,t){for(var n=e.length,i=this.mesh._effectiveMesh.position,o=0;o<n;o++){var a=e[o],s=this._debugLines[o];s||(s=[r.x.Zero(),r.x.Zero()],this._debugLines[o]=s),this._getBonePosition(s[0],a,t),this._getBonePosition(s[1],a,t,0,a.length,0),s[0].subtractInPlace(i),s[1].subtractInPlace(i)}},e.prototype._getLinesForBonesNoLength=function(e,t){for(var n=e.length,i=0,o=this.mesh._effectiveMesh,a=o.position,s=n-1;s>=0;s--){var l=e[s],u=l.getParent();if(u){var c=this._debugLines[i];c||(c=[r.x.Zero(),r.x.Zero()],this._debugLines[i]=c),l.getAbsolutePositionToRef(o,c[0]),u.getAbsolutePositionToRef(o,c[1]),c[0].subtractInPlace(a),c[1].subtractInPlace(a),i++}}},e.prototype.update=function(){if(this._utilityLayer){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms();var e=this.mesh._effectiveMesh;void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,e.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,e.getWorldMatrix());var t=this._utilityLayer.utilityLayerScene;this._debugMesh?x.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},t):(this._debugMesh=x.a.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},t),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color}},e.prototype.dispose=function(){this.isEnabled=!1,this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null),this._utilityLayer&&(this._utilityLayer.dispose(),this._utilityLayer=null)},e}();n.d(t,"AxesViewer",function(){return a}),n.d(t,"BoneAxesViewer",function(){return l}),n.d(t,"DebugLayer",function(){return f}),n.d(t,"PhysicsViewer",function(){return E}),n.d(t,"RayHelper",function(){return T}),n.d(t,"SkeletonViewer",function(){return S})},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(1),i=n(0),o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._normalMatrix=new i.j,r.allowShaderHotSwapping=!0,r._storeEffectOnSubMeshes=!0,r}return r.d(t,e),t.prototype.getEffect=function(){return this._activeEffect},t.prototype.isReady=function(e,t){return!!e&&(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t))},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindOnlyNormalMatrix=function(e){this._activeEffect.setMatrix("normalMatrix",e)},t.prototype.bind=function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])},t.prototype._afterBind=function(t,n){void 0===n&&(n=null),e.prototype._afterBind.call(this,t),this.getScene()._cachedEffect=n},t.prototype._mustRebind=function(e,t,n){return void 0===n&&(n=1),e.isCachedMaterialInvalid(this,t,n)},t}(n(20).a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(1),i=n(2),o=n(0),a=n(4),s=n(7),l=n(15),u=n(5),c=n(20),h=n(22),d=function(e){function t(t,n,i,a){void 0===a&&(a={});var s=e.call(this,t,n)||this;return s._textures={},s._textureArrays={},s._floats={},s._ints={},s._floatsArrays={},s._colors3={},s._colors3Arrays={},s._colors4={},s._vectors2={},s._vectors3={},s._vectors4={},s._matrices={},s._matrices3x3={},s._matrices2x2={},s._vectors2Arrays={},s._vectors3Arrays={},s._cachedWorldViewMatrix=new o.j,s._shaderPath=i,s._options=r.a({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},a),s}return r.d(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ShaderMaterial"},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},t.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},t.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},t.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(function(e,t){return t.toArray(e,e.length),e},[]),this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},t.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},t.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this},t.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},t.prototype._checkCache=function(e,t){return!e||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},t.prototype.isReadyForSubMesh=function(e,t,n){return this.isReady(e,n)},t.prototype.isReady=function(e,t){var n=this.getScene(),r=n.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===n.getRenderId()&&this._checkCache(e,t))return!0;for(var i=[],o=[],s=new u.c,c=0;c<this._options.defines.length;c++)i.push(this._options.defines[c]);for(c=0;c<this._options.attributes.length;c++)o.push(this._options.attributes[c]);if(e&&e.isVerticesDataPresent(a.b.ColorKind)&&(o.push(a.b.ColorKind),i.push("#define VERTEXCOLOR")),t&&(i.push("#define INSTANCES"),l.a.PrepareAttributesForInstances(o,i)),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){o.push(a.b.MatricesIndicesKind),o.push(a.b.MatricesWeightsKind),e.numBoneInfluencers>4&&(o.push(a.b.MatricesIndicesExtraKind),o.push(a.b.MatricesWeightsExtraKind));var h=e.skeleton;i.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),s.addCPUSkinningFallback(0,e),h.isUsingTextureForMatrices?(i.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(i.push("#define BonesPerMesh "+(h.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else i.push("#define NUM_BONE_INFLUENCERS 0");for(var d in this._textures)if(!this._textures[d].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&i.push("#define ALPHATEST");var f=this._effect,p=i.join("\n");return this._effect=r.createEffect(this._shaderPath,{attributes:o,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:p,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError},r),!!this._effect.isReady()&&(f!==this._effect&&n.resetCachedMaterial(),this._renderId=n.getRenderId(),!0)},t.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(t.getTransformMatrix())))},t.prototype.bind=function(e,t){if(this.bindOnlyWorldMatrix(e),this._effect&&this.getScene().getCachedMaterial()!==this){var n;for(n in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),l.a.BindBonesParameters(t,this._effect),this._textures)this._effect.setTexture(n,this._textures[n]);for(n in this._textureArrays)this._effect.setTextureArray(n,this._textureArrays[n]);for(n in this._ints)this._effect.setInt(n,this._ints[n]);for(n in this._floats)this._effect.setFloat(n,this._floats[n]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[n]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[n]);for(n in this._colors3Arrays)this._effect.setArray3(n,this._colors3Arrays[n]);for(n in this._colors4){var r=this._colors4[n];this._effect.setFloat4(n,r.r,r.g,r.b,r.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[n]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[n]);for(n in this._vectors4)this._effect.setVector4(n,this._vectors4[n]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)this._effect.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)this._effect.setMatrix2x2(n,this._matrices2x2[n]);for(n in this._vectors2Arrays)this._effect.setArray2(n,this._vectors2Arrays[n]);for(n in this._vectors3Arrays)this._effect.setArray3(n,this._vectors3Arrays[n])}this._afterBind(t)},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);for(var n in this._textures)t.push(this._textures[n]);for(var n in this._textureArrays)for(var r=this._textureArrays[n],i=0;i<r.length;i++)t.push(r[i]);return t},t.prototype.hasTexture=function(t){if(e.prototype.hasTexture.call(this,t))return!0;for(var n in this._textures)if(this._textures[n]===t)return!0;for(var n in this._textureArrays)for(var r=this._textureArrays[n],i=0;i<r.length;i++)if(r[i]===t)return!0;return!1},t.prototype.clone=function(e){return new t(e,this.getScene(),this._shaderPath,this._options)},t.prototype.dispose=function(t,n,r){if(n){var i;for(i in this._textures)this._textures[i].dispose();for(i in this._textureArrays)for(var o=this._textureArrays[i],a=0;a<o.length;a++)o[a].dispose()}this._textures={},e.prototype.dispose.call(this,t,n,r)},t.prototype.serialize=function(){var e,t=i.a.Serialize(this);for(e in t.customType="BABYLON.ShaderMaterial",t.options=this._options,t.shaderPath=this._shaderPath,t.textures={},this._textures)t.textures[e]=this._textures[e].serialize();for(e in t.textureArrays={},this._textureArrays){t.textureArrays[e]=[];for(var n=this._textureArrays[e],r=0;r<n.length;r++)t.textureArrays[e].push(n[r].serialize())}for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];for(e in t.FloatArrays={},this._floatsArrays)t.FloatArrays[e]=this._floatsArrays[e];for(e in t.colors3={},this._colors3)t.colors3[e]=this._colors3[e].asArray();for(e in t.colors3Arrays={},this._colors3Arrays)t.colors3Arrays[e]=this._colors3Arrays[e];for(e in t.colors4={},this._colors4)t.colors4[e]=this._colors4[e].asArray();for(e in t.vectors2={},this._vectors2)t.vectors2[e]=this._vectors2[e].asArray();for(e in t.vectors3={},this._vectors3)t.vectors3[e]=this._vectors3[e].asArray();for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.matrices={},this._matrices)t.matrices[e]=this._matrices[e].asArray();for(e in t.matrices3x3={},this._matrices3x3)t.matrices3x3[e]=this._matrices3x3[e];for(e in t.matrices2x2={},this._matrices2x2)t.matrices2x2[e]=this._matrices2x2[e];for(e in t.vectors2Arrays={},this._vectors2Arrays)t.vectors2Arrays[e]=this._vectors2Arrays[e];for(e in t.vectors3Arrays={},this._vectors3Arrays)t.vectors3Arrays[e]=this._vectors3Arrays[e];return t},t.Parse=function(e,n,r){var a,l=i.a.Parse(function(){return new t(e.name,n,e.shaderPath,e.options)},e,n,r);for(a in e.textures)l.setTexture(a,s.a.Parse(e.textures[a],n,r));for(a in e.textureArrays){for(var u=e.textureArrays[a],c=new Array,h=0;h<u.length;h++)c.push(s.a.Parse(u[h],n,r));l.setTextureArray(a,c)}for(a in e.floats)l.setFloat(a,e.floats[a]);for(a in e.floatsArrays)l.setFloats(a,e.floatsArrays[a]);for(a in e.colors3)l.setColor3(a,o.e.FromArray(e.colors3[a]));for(a in e.colors3Arrays){var d=e.colors3Arrays[a].reduce(function(e,t,n){return n%3==0?e.push([t]):e[e.length-1].push(t),e},[]).map(function(e){return o.e.FromArray(e)});l.setColor3Array(a,d)}for(a in e.colors4)l.setColor4(a,o.f.FromArray(e.colors4[a]));for(a in e.vectors2)l.setVector2(a,o.w.FromArray(e.vectors2[a]));for(a in e.vectors3)l.setVector3(a,o.x.FromArray(e.vectors3[a]));for(a in e.vectors4)l.setVector4(a,o.y.FromArray(e.vectors4[a]));for(a in e.matrices)l.setMatrix(a,o.j.FromArray(e.matrices[a]));for(a in e.matrices3x3)l.setMatrix3x3(a,e.matrices3x3[a]);for(a in e.matrices2x2)l.setMatrix2x2(a,e.matrices2x2[a]);for(a in e.vectors2Arrays)l.setArray2(a,e.vectors2Arrays[a]);for(a in e.vectors3Arrays)l.setArray3(a,e.vectors3Arrays[a]);return l},t}(c.a);h.a.RegisteredTypes["BABYLON.ShaderMaterial"]=d},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(34),i=n(0),o=function(){function e(e,t,n){this.vectors=r.a.BuildArray(8,i.x.Zero),this.center=i.x.Zero(),this.centerWorld=i.x.Zero(),this.extendSize=i.x.Zero(),this.extendSizeWorld=i.x.Zero(),this.directions=r.a.BuildArray(3,i.x.Zero),this.vectorsWorld=r.a.BuildArray(8,i.x.Zero),this.minimumWorld=i.x.Zero(),this.maximumWorld=i.x.Zero(),this.minimum=i.x.Zero(),this.maximum=i.x.Zero(),this.reConstruct(e,t,n)}return e.prototype.reConstruct=function(e,t,n){var r=e.x,o=e.y,a=e.z,s=t.x,l=t.y,u=t.z,c=this.vectors;this.minimum.copyFromFloats(r,o,a),this.maximum.copyFromFloats(s,l,u),c[0].copyFromFloats(r,o,a),c[1].copyFromFloats(s,l,u),c[2].copyFromFloats(s,o,a),c[3].copyFromFloats(r,l,a),c[4].copyFromFloats(r,o,u),c[5].copyFromFloats(s,l,a),c[6].copyFromFloats(r,l,u),c[7].copyFromFloats(s,o,u),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=n||i.j.IdentityReadOnly,this._update(this._worldMatrix)},e.prototype.scale=function(t){var n=e.TmpVector3,r=this.maximum.subtractToRef(this.minimum,n[0]),i=r.length();r.normalizeFromLength(i);var o=i*t,a=r.scaleInPlace(.5*o),s=this.center.subtractToRef(a,n[1]),l=this.center.addToRef(a,n[2]);return this.reConstruct(s,l,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(e){var t=this.minimumWorld,n=this.maximumWorld,r=this.directions,o=this.vectorsWorld,a=this.vectors;if(e.isIdentity()){for(t.copyFrom(this.minimum),n.copyFrom(this.maximum),s=0;s<8;++s)o[s].copyFrom(a[s]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),n.setAll(-Number.MAX_VALUE);for(var s=0;s<8;++s){var l=o[s];i.x.TransformCoordinatesToRef(a[s],e,l),t.minimizeInPlace(l),n.maximizeInPlace(l)}n.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),n.addToRef(t,this.centerWorld).scaleInPlace(.5)}i.x.FromArrayToRef(e.m,0,r[0]),i.x.FromArrayToRef(e.m,4,r[1]),i.x.FromArrayToRef(e.m,8,r[2]),this._worldMatrix=e},e.prototype.isInFrustum=function(t){return e.IsInFrustum(this.vectorsWorld,t)},e.prototype.isCompletelyInFrustum=function(t){return e.IsCompletelyInFrustum(this.vectorsWorld,t)},e.prototype.intersectsPoint=function(e){var t=this.minimumWorld,n=this.maximumWorld,r=t.x,o=t.y,a=t.z,s=n.x,l=n.y,u=n.z,c=e.x,h=e.y,d=e.z,f=-i.h;return!(s-c<f||f>c-r)&&!(l-h<f||f>h-o)&&!(u-d<f||f>d-a)},e.prototype.intersectsSphere=function(t){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)},e.prototype.intersectsMinMax=function(e,t){var n=this.minimumWorld,r=this.maximumWorld,i=n.x,o=n.y,a=n.z,s=r.x,l=r.y,u=r.z,c=e.x,h=e.y,d=e.z,f=t.x,p=t.y,m=t.z;return!(s<c||i>f)&&!(l<h||o>p)&&!(u<d||a>m)},e.Intersects=function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)},e.IntersectsSphere=function(t,n,r,o){var a=e.TmpVector3[0];return i.x.ClampToRef(r,t,n,a),i.x.DistanceSquared(r,a)<=o*o},e.IsCompletelyInFrustum=function(e,t){for(var n=0;n<6;++n)for(var r=t[n],i=0;i<8;++i)if(r.dotCoordinate(e[i])<0)return!1;return!0},e.IsInFrustum=function(e,t){for(var n=0;n<6;++n){for(var r=!0,i=t[n],o=0;o<8;++o)if(i.dotCoordinate(e[o])>=0){r=!1;break}if(r)return!1}return!0},e.TmpVector3=r.a.BuildArray(3,i.x.Zero),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(3),i=function(){function e(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(e,"HasTriggers",{get:function(){for(var t in e.Triggers)if(e.Triggers.hasOwnProperty(t))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"HasPickTriggers",{get:function(){for(var t in e.Triggers)if(e.Triggers.hasOwnProperty(t)){var n=parseInt(t);if(n>=r.a.ACTION_OnPickTrigger&&n<=r.a.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),e.HasSpecificTrigger=function(t){for(var n in e.Triggers)if(e.Triggers.hasOwnProperty(n)&&parseInt(n)===t)return!0;return!1},e.Triggers={},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(11),i=n(13);i.a.CreatePlane=function(e){var t=[],n=[],r=[],o=[],a=e.width||e.size||1,s=e.height||e.size||1,l=0===e.sideOrientation?0:e.sideOrientation||i.a.DEFAULTSIDE,u=a/2,c=s/2;n.push(-u,-c,0),r.push(0,0,-1),o.push(0,0),n.push(u,-c,0),r.push(0,0,-1),o.push(1,0),n.push(u,c,0),r.push(0,0,-1),o.push(1,1),n.push(-u,c,0),r.push(0,0,-1),o.push(0,1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),i.a._ComputeSides(l,n,t,r,o,e.frontUVs,e.backUVs);var h=new i.a;return h.indices=t,h.positions=n,h.normals=r,h.uvs=o,h},r.a.CreatePlane=function(e,t,n,r,i){var a={size:t,width:t,height:t,sideOrientation:i,updatable:r};return o.CreatePlane(e,a,n)};var o=function(){function e(){}return e.CreatePlane=function(e,t,n){void 0===n&&(n=null);var o=new r.a(e,n);return t.sideOrientation=r.a._GetDefaultSideOrientation(t.sideOrientation),o._originalBuilderSideOrientation=t.sideOrientation,i.a.CreatePlane(t).applyToMesh(o,t.updatable),t.sourcePlane&&(o.translate(t.sourcePlane.normal,-t.sourcePlane.d),o.setDirection(t.sourcePlane.normal.scale(-1))),o},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t,n){this.bu=e,this.bv=t,this.distance=n,this.faceId=0,this.subMeshId=0}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(34),i=n(0),o=function(){function e(e,t,n){this.center=i.x.Zero(),this.centerWorld=i.x.Zero(),this.minimum=i.x.Zero(),this.maximum=i.x.Zero(),this.reConstruct(e,t,n)}return e.prototype.reConstruct=function(e,t,n){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var r=i.x.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*r,this._update(n||i.j.IdentityReadOnly)},e.prototype.scale=function(t){var n=this.radius*t,r=e.TmpVector3,i=r[0].setAll(n),o=this.center.subtractToRef(i,r[1]),a=this.center.addToRef(i,r[2]);return this.reConstruct(o,a,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{i.x.TransformCoordinatesToRef(this.center,t,this.centerWorld);var n=e.TmpVector3[0];i.x.TransformNormalFromFloatsToRef(1,1,1,t,n),this.radiusWorld=Math.max(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))*this.radius}},e.prototype.isInFrustum=function(e){for(var t=this.centerWorld,n=this.radiusWorld,r=0;r<6;r++)if(e[r].dotCoordinate(t)<=-n)return!1;return!0},e.prototype.isCenterInFrustum=function(e){for(var t=this.centerWorld,n=0;n<6;n++)if(e[n].dotCoordinate(t)<0)return!1;return!0},e.prototype.intersectsPoint=function(e){var t=i.x.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)},e.Intersects=function(e,t){var n=i.x.DistanceSquared(e.centerWorld,t.centerWorld),r=e.radiusWorld+t.radiusWorld;return!(r*r<n)},e.TmpVector3=r.a.BuildArray(3,i.x.Zero),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(20),i=n(4),o=n(3),a=function(){function e(e){this._vertexBuffers={},this._scene=e}return e.prototype._prepareBuffers=function(){if(!this._vertexBuffers[i.b.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[i.b.PositionKind]=new i.b(this._scene.getEngine(),e,i.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},e.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},e.prototype._rebuild=function(){var e=this._vertexBuffers[i.b.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},e.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var n=this._scene.activeCamera;return!!n&&!(!(t=t||n._postProcesses.filter(function(e){return null!=e}))||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(n,e,null!=t),!0)},e.prototype.directRender=function(e,t,n,i,o){void 0===t&&(t=null),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===o&&(o=0);for(var a=this._scene.getEngine(),s=0;s<e.length;s++){s<e.length-1?e[s+1].activate(this._scene.activeCamera,t):t?a.bindFramebuffer(t,i,void 0,void 0,n,void 0,o):a.restoreDefaultFramebuffer();var l=e[s],u=l.apply();u&&(l.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,u),a.drawElementsType(r.a.TriangleFillMode,0,6),l.onAfterRenderObservable.notifyObservers(u))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},e.prototype._finalizeFrame=function(e,t,n,i,a){void 0===a&&(a=!1);var s=this._scene.activeCamera;if(s&&0!==(i=i||s._postProcesses.filter(function(e){return null!=e})).length&&this._scene.postProcessesEnabled){for(var l=this._scene.getEngine(),u=0,c=i.length;u<c;u++){var h=i[u];if(u<c-1?h._outputTexture=i[u+1].activate(s,t):t?(l.bindFramebuffer(t,n,void 0,void 0,a),h._outputTexture=t):(l.restoreDefaultFramebuffer(),h._outputTexture=null),e)break;var d=h.apply();d&&(h.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,d),l.drawElementsType(r.a.TriangleFillMode,0,6),h.onAfterRenderObservable.notifyObservers(d))}l.setDepthBuffer(!0),l.setDepthWrite(!0),l.setAlphaMode(o.a.ALPHA_DISABLE)}},e.prototype.dispose=function(){var e=this._vertexBuffers[i.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[i.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}()},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightFragmentDeclaration="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightUboDeclaration="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.imageProcessingDeclaration="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.imageProcessingFunctions="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x;\n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\n\n\n\n\n\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\n\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108,1.10813,-0.07276),\nvec3(-0.07367,-0.00605,1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\n\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\n\ncolor=saturate(color);\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.logDepthDeclaration="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneFragment="#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nif (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nif (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nif (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneVertex="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif"},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n(109),i=function(){},o=function(){function e(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new i,this._scene=t;for(var n=e.MIN_RENDERINGGROUPS;n<e.MAX_RENDERINGGROUPS;n++)this._autoClearDepthStencil[n]={autoClear:!0,depth:!0,stencil:!0}}return e.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},e.prototype.render=function(t,n,r,i){var o=this._renderingGroupInfo;if(o.scene=this._scene,o.camera=this._scene.activeCamera,this._scene.spriteManagers&&i)for(var a=0;a<this._scene.spriteManagers.length;a++){var s=this._scene.spriteManagers[a];this.dispatchSprites(s)}for(a=e.MIN_RENDERINGGROUPS;a<e.MAX_RENDERINGGROUPS;a++){this._depthStencilBufferAlreadyCleaned=a===e.MIN_RENDERINGGROUPS;var l=this._renderingGroups[a];if(l){var u=Math.pow(2,a);if(o.renderingGroupId=a,this._scene.onBeforeRenderingGroupObservable.notifyObservers(o,u),e.AUTOCLEAR){var c=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(a):this._autoClearDepthStencil[a];c&&c.autoClear&&this._clearDepthStencilBuffer(c.depth,c.stencil)}for(var h=0,d=this._scene._beforeRenderingGroupDrawStage;h<d.length;h++)d[h].action(a);l.render(t,i,r,n);for(var f=0,p=this._scene._afterRenderingGroupDrawStage;f<p.length;f++)p[f].action(a);this._scene.onAfterRenderingGroupObservable.notifyObservers(o,u)}}},e.prototype.reset=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.prepare()}},e.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},e.prototype.freeRenderingGroups=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var n=this._renderingGroups[t];n&&n.dispose()}},e.prototype._prepareRenderingGroup=function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new r.a(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},e.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},e.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},e.prototype.dispatch=function(e,t,n){void 0===t&&(t=e.getMesh());var r=t.renderingGroupId||0;this._prepareRenderingGroup(r),this._renderingGroups[r].dispatch(e,t,n)},e.prototype.setRenderingOrder=function(e,t,n,r){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=n,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]){var i=this._renderingGroups[e];i.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],i.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],i.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},e.prototype.setRenderingAutoClearDepthStencil=function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:n,stencil:r}},e.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0,e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(1),i=n(2),o=n(0),a=function(){function e(){this._dirty=!0,this._tempColor=new o.f(0,0,0,0),this._globalCurve=new o.f(0,0,0,0),this._highlightsCurve=new o.f(0,0,0,0),this._midtonesCurve=new o.f(0,0,0,0),this._shadowsCurve=new o.f(0,0,0,0),this._positiveCurve=new o.f(0,0,0,0),this._negativeCurve=new o.f(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(e.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"ColorCurves"},e.Bind=function(e,t,n,r,i){void 0===n&&(n="vCameraColorCurvePositive"),void 0===r&&(r="vCameraColorCurveNeutral"),void 0===i&&(i="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(n,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(i,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},e.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype.getColorGradingDataToRef=function(t,n,r,i,o){null!=t&&(t=e.clamp(t,0,360),n=e.clamp(n,-100,100),r=e.clamp(r,-100,100),i=e.clamp(i,-100,100),n=e.applyColorGradingSliderNonlinear(n),n*=.5,i=e.applyColorGradingSliderNonlinear(i),n<0&&(n*=-1,t=(t+180)%360),e.fromHSBToRef(t,n,50+.25*i,o),o.scaleToRef(2,o),o.a=1+.01*r)},e.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},e.fromHSBToRef=function(t,n,r,i){var o=e.clamp(t,0,360),a=e.clamp(n/100,0,1),s=e.clamp(r/100,0,1);if(0===a)i.r=s,i.g=s,i.b=s;else{o/=60;var l=Math.floor(o),u=o-l,c=s*(1-a),h=s*(1-a*u),d=s*(1-a*(1-u));switch(l){case 0:i.r=s,i.g=d,i.b=c;break;case 1:i.r=h,i.g=s,i.b=c;break;case 2:i.r=c,i.g=s,i.b=d;break;case 3:i.r=c,i.g=h,i.b=s;break;case 4:i.r=d,i.g=c,i.b=s;break;default:i.r=s,i.g=c,i.b=h}}i.a=1},e.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},e.prototype.clone=function(){return i.a.Clone(function(){return new e},this)},e.prototype.serialize=function(){return i.a.Serialize(this)},e.Parse=function(t){return i.a.Parse(function(){return new e},t,null,null)},r.c([Object(i.c)()],e.prototype,"_globalHue",void 0),r.c([Object(i.c)()],e.prototype,"_globalDensity",void 0),r.c([Object(i.c)()],e.prototype,"_globalSaturation",void 0),r.c([Object(i.c)()],e.prototype,"_globalExposure",void 0),r.c([Object(i.c)()],e.prototype,"_highlightsHue",void 0),r.c([Object(i.c)()],e.prototype,"_highlightsDensity",void 0),r.c([Object(i.c)()],e.prototype,"_highlightsSaturation",void 0),r.c([Object(i.c)()],e.prototype,"_highlightsExposure",void 0),r.c([Object(i.c)()],e.prototype,"_midtonesHue",void 0),r.c([Object(i.c)()],e.prototype,"_midtonesDensity",void 0),r.c([Object(i.c)()],e.prototype,"_midtonesSaturation",void 0),r.c([Object(i.c)()],e.prototype,"_midtonesExposure",void 0),e}();i.a._ColorCurvesParser=a.Parse},function(e,t,n){"use strict";var r=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,n,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===n&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=n,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,n,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===n&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=n,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),i=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),o=n(3),a=function(){function e(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.KEEP,this._stencilOpDepthFail=e.KEEP,this._stencilOpStencilDepthPass=e.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},e.ALWAYS=o.a.ALWAYS,e.KEEP=o.a.KEEP,e.REPLACE=o.a.REPLACE,e}();n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return a})},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneFragmentDeclaration="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.clipPlaneVertexDeclaration="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif"},function(e,t,n){"use strict";n.r(t);var r=n(30),i=n(8),o=n(0),a=n(22),s=function(){function e(e,t){this.triggerOptions=e,this.onBeforeExecuteObservable=new i.c,e.parameter?(this.trigger=e.trigger,this._triggerParameter=e.parameter):e.trigger?this.trigger=e.trigger:this.trigger=e,this._nextActiveAction=this,this._condition=t}return e.prototype._prepare=function(){},e.prototype.getTriggerParameter=function(){return this._triggerParameter},e.prototype._executeCurrent=function(e){if(this._nextActiveAction._condition){var t=this._nextActiveAction._condition,n=this._actionManager.getScene().getRenderId();if(t._evaluationId===n){if(!t._currentResult)return}else{if(t._evaluationId=n,!t.isValid())return void(t._currentResult=!1);t._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(e),this.skipToNextActiveAction()},e.prototype.execute=function(e){},e.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},e.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(e){},e.prototype._serialize=function(e,t){var n={type:1,children:[],name:e.name,properties:e.properties||[]};if(this._child&&this._child.serialize(n),this._condition){var r=this._condition.serialize();return r.children.push(n),t&&t.children.push(r),r}return t&&t.children.push(n),n},e._SerializeValueAsString=function(e){return"number"==typeof e?e.toString():"boolean"==typeof e?e?"true":"false":e instanceof o.w?e.x+", "+e.y:e instanceof o.x?e.x+", "+e.y+", "+e.z:e instanceof o.e?e.r+", "+e.g+", "+e.b:e instanceof o.f?e.r+", "+e.g+", "+e.b+", "+e.a:e},e._GetTargetProperty=function(e){return{name:"target",targetType:e._isMesh?"MeshProperties":e._isLight?"LightProperties":e._isCamera?"CameraProperties":"SceneProperties",value:e._isScene?"Scene":e.name}},e}();a.a.RegisteredTypes["BABYLON.Action"]=s;var l=n(36),u=n(1),c=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(){},e.prototype._serialize=function(e){return{type:2,children:[],name:e.name,properties:e.properties}},e}(),h=function(e){function t(n,r,i,o,a){void 0===a&&(a=t.IsEqual);var s=e.call(this,n)||this;return s.propertyPath=i,s.value=o,s.operator=a,s._target=r,s._effectiveTarget=s._getEffectiveTarget(r,s.propertyPath),s._property=s._getProperty(s.propertyPath),s}return u.d(t,e),Object.defineProperty(t,"IsEqual",{get:function(){return t._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsDifferent",{get:function(){return t._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsGreater",{get:function(){return t._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsLesser",{get:function(){return t._IsLesser},enumerable:!0,configurable:!0}),t.prototype.isValid=function(){switch(this.operator){case t.IsGreater:return this._effectiveTarget[this._property]>this.value;case t.IsLesser:return this._effectiveTarget[this._property]<this.value;case t.IsEqual:case t.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===t.IsEqual?e:!e}return!1},t.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)},{name:"operator",value:t.GetOperatorName(this.operator)}]})},t.GetOperatorName=function(e){switch(e){case t._IsEqual:return"IsEqual";case t._IsDifferent:return"IsDifferent";case t._IsGreater:return"IsGreater";case t._IsLesser:return"IsLesser";default:return""}},t._IsEqual=0,t._IsDifferent=1,t._IsGreater=2,t._IsLesser=3,t}(c),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r}return u.d(t,e),t.prototype.isValid=function(){return this.predicate()},t}(c),f=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.value=r,i._target=n,i}return u.d(t,e),t.prototype.isValid=function(){return this._target.state===this.value},t.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[s._GetTargetProperty(this._target),{name:"value",value:this.value}]})},t}(c);a.a.RegisteredTypes["BABYLON.ValueCondition"]=h,a.a.RegisteredTypes["BABYLON.PredicateCondition"]=d,a.a.RegisteredTypes["BABYLON.StateCondition"]=f;var p=n(6),m=n(3),g=function(e){function t(t,n,r,i){var o=e.call(this,t,i)||this;return o.propertyPath=r,o._target=o._effectiveTarget=n,o}return u.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},t)},t}(s),_=function(e){function t(t,n,r,i){var o=e.call(this,t,i)||this;return o.value=r,o._target=n,o}return u.d(t,e),t.prototype.execute=function(){this._target.state=this.value},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetStateAction",properties:[s._GetTargetProperty(this._target),{name:"value",value:this.value}]},t)},t}(s),v=function(e){function t(t,n,r,i,o){var a=e.call(this,t,o)||this;return a.propertyPath=r,a.value=i,a._target=a._effectiveTarget=n,a}return u.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetValueAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)}]},t)},t}(s),y=function(e){function t(t,n,r,i,o){var a=e.call(this,t,o)||this;return a.propertyPath=r,a.value=i,a._target=a._effectiveTarget=n,a}return u.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&p.a.Warn("Warning: IncrementValueAction can only be used with number values")},t.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)}]},t)},t}(s),b=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,a)||this;return s.from=r,s.to=i,s.loop=o,s._target=n,s}return u.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[s._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:s._SerializeValueAsString(this.loop)||!1}]},t)},t}(s),E=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i._target=n,i}return u.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[s._GetTargetProperty(this._target)]},t)},t}(s),x=function(e){function t(t,n){return void 0===t&&(t=m.a.ACTION_NothingTrigger),e.call(this,t,n)||this}return u.d(t,e),t.prototype.execute=function(){},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},t)},t}(s),T=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i.children=n,i}return u.d(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t.prototype.serialize=function(t){for(var n=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},t),r=0;r<this.children.length;r++)n.combine.push(this.children[r].serialize(null));return n},t}(s),S=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i.func=n,i}return u.d(t,e),t.prototype.execute=function(e){this.func(e)},t}(s),A=function(e){function t(t,n,r,i){var o=e.call(this,t,i)||this;return o._target=n,o._parent=r,o}return u.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){if(this._target.parent!==this._parent){var e=this._parent.getWorldMatrix().clone();e.invert(),this._target.position=o.x.TransformCoordinates(this._target.position,e),this._target.parent=this._parent}},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"SetParentAction",properties:[s._GetTargetProperty(this._target),s._GetTargetProperty(this._parent)]},t)},t}(s);a.a.RegisteredTypes["BABYLON.SetParentAction"]=A,a.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=S,a.a.RegisteredTypes["BABYLON.DoNothingAction"]=x,a.a.RegisteredTypes["BABYLON.StopAnimationAction"]=E,a.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=b,a.a.RegisteredTypes["BABYLON.IncrementValueAction"]=y,a.a.RegisteredTypes["BABYLON.SetValueAction"]=v,a.a.RegisteredTypes["BABYLON.SetStateAction"]=_,a.a.RegisteredTypes["BABYLON.SetParentAction"]=A;var P=n(23),M=n(32),R=function(e){function t(t){var n=e.call(this)||this;return n._scene=t||P.a.LastCreatedScene,t.actionManagers.push(n),n}return u.d(t,e),t.prototype.dispose=function(){for(var e=this._scene.actionManagers.indexOf(this),n=0;n<this.actions.length;n++){var r=this.actions[n];t.Triggers[r.trigger]--,0===t.Triggers[r.trigger]&&delete t.Triggers[r.trigger]}e>-1&&this._scene.actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var t=0;t<this.actions.length;t++){var n=this.actions[t];if(e.indexOf(n.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTriggers2=function(e,t){for(var n=0;n<this.actions.length;n++){var r=this.actions[n];if(e==r.trigger||t==r.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(e,t){for(var n=0;n<this.actions.length;n++){var r=this.actions[n];if(r.trigger===e){if(!t)return!0;if(t(r.getTriggerParameter()))return!0}}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var n=this.actions[e];if(n.trigger>=t.OnPickTrigger&&n.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.registerAction=function(e){return e.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(p.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(e),t.Triggers[e.trigger]?t.Triggers[e.trigger]++:t.Triggers[e.trigger]=1,e._actionManager=this,e._prepare(),e)},t.prototype.unregisterAction=function(e){var n=this.actions.indexOf(e);return-1!==n&&(this.actions.splice(n,1),t.Triggers[e.trigger]-=1,0===t.Triggers[e.trigger]&&delete t.Triggers[e.trigger],delete e._actionManager,!0)},t.prototype.processTrigger=function(e,n){for(var r=0;r<this.actions.length;r++){var i=this.actions[r];if(i.trigger===e){if(n&&(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger)){var o=i.getTriggerParameter();if(o&&o!==n.sourceEvent.keyCode){if(!o.toLowerCase)continue;var a=o.toLowerCase();if(a!==n.sourceEvent.key){var s=n.sourceEvent.charCode?n.sourceEvent.charCode:n.sourceEvent.keyCode;if(String.fromCharCode(s).toLowerCase()!==a)continue}}}i._executeCurrent(n)}}},t.prototype._getEffectiveTarget=function(e,t){for(var n=t.split("."),r=0;r<n.length-1;r++)e=e[n[r]];return e},t.prototype._getProperty=function(e){var t=e.split(".");return t[t.length-1]},t.prototype.serialize=function(e){for(var n={children:new Array,name:e,type:3,properties:new Array},r=0;r<this.actions.length;r++){var i={type:0,children:new Array,name:t.GetTriggerName(this.actions[r].trigger),properties:new Array},o=this.actions[r].triggerOptions;if(o&&"number"!=typeof o)if(o.parameter instanceof Node)i.properties.push(s._GetTargetProperty(o.parameter));else{var a={};M.a.DeepCopy(o.parameter,a,["mesh"]),o.parameter&&o.parameter.mesh&&(a._meshId=o.parameter.mesh.id),i.properties.push({name:"parameter",targetType:null,value:a})}this.actions[r].serialize(i),n.children.push(i)}return n},t.Parse=function(e,n,r){var i=new t(r);null===n?r.actionManager=i:n.actionManager=i;for(var s=function(e,t,n,r){if(null===r){var i=parseFloat(t);return"true"===t||"false"===t?"true"===t:isNaN(i)?t:i}for(var a=r.split("."),s=t.split(","),l=0;l<a.length;l++)n=n[a[l]];if("boolean"==typeof n)return"true"===s[0];if("string"==typeof n)return s[0];var u=new Array;for(l=0;l<s.length;l++)u.push(parseFloat(s[l]));return n instanceof o.x?o.x.FromArray(u):n instanceof o.y?o.y.FromArray(u):n instanceof o.e?o.e.FromArray(u):n instanceof o.f?o.f.FromArray(u):parseFloat(s[0])},l=function e(n,o,l,u,d){if(void 0===d&&(d=null),!n.detached){var f=new Array,p=null,m=null,g=n.combine&&n.combine.length>0;if(2===n.type?f.push(i):f.push(o),g){for(var _=new Array,v=0;v<n.combine.length;v++)e(n.combine[v],t.NothingTrigger,l,u,_);f.push(_)}else for(var y=0;y<n.properties.length;y++){var b=n.properties[y].value,E=n.properties[y].name,T=n.properties[y].targetType;"target"===E?b=p=null!==T&&"SceneProperties"===T?r:r.getNodeByName(b):"parent"===E?b=r.getNodeByName(b):"sound"===E?r.getSoundByName&&(b=r.getSoundByName(b)):"propertyPath"!==E?b=2===n.type&&"operator"===E?h[b]:s(0,b,p,"value"===E?m:null):m=b,f.push(b)}if(null===d?f.push(l):f.push(null),"InterpolateValueAction"===n.name){var S=f[f.length-2];f[f.length-1]=S,f[f.length-2]=l}var A=function(e,t){var n=a.a.GetClass("BABYLON."+e);if(n){var r=Object.create(n.prototype);return r.constructor.apply(r,t),r}}(n.name,f);if(A instanceof c&&null!==l){var P=new x(o,l);u?u.then(P):i.registerAction(P),u=P}for(null===d?A instanceof c?(l=A,A=u):(l=null,u?u.then(A):i.registerAction(A)):d.push(A),y=0;y<n.children.length;y++)e(n.children[y],o,l,A,null)}},u=0;u<e.children.length;u++){var d,f=e.children[u];if(f.properties.length>0){var p=f.properties[0].value,m=null===f.properties[0].targetType?p:r.getMeshByName(p);m._meshId&&(m.mesh=r.getMeshByID(m._meshId)),d={trigger:t[f.name],parameter:m}}else d=t[f.name];for(var g=0;g<f.children.length;g++)f.detached||l(f.children[g],d,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=m.a.ACTION_NothingTrigger,t.OnPickTrigger=m.a.ACTION_OnPickTrigger,t.OnLeftPickTrigger=m.a.ACTION_OnLeftPickTrigger,t.OnRightPickTrigger=m.a.ACTION_OnRightPickTrigger,t.OnCenterPickTrigger=m.a.ACTION_OnCenterPickTrigger,t.OnPickDownTrigger=m.a.ACTION_OnPickDownTrigger,t.OnDoublePickTrigger=m.a.ACTION_OnDoublePickTrigger,t.OnPickUpTrigger=m.a.ACTION_OnPickUpTrigger,t.OnPickOutTrigger=m.a.ACTION_OnPickOutTrigger,t.OnLongPressTrigger=m.a.ACTION_OnLongPressTrigger,t.OnPointerOverTrigger=m.a.ACTION_OnPointerOverTrigger,t.OnPointerOutTrigger=m.a.ACTION_OnPointerOutTrigger,t.OnEveryFrameTrigger=m.a.ACTION_OnEveryFrameTrigger,t.OnIntersectionEnterTrigger=m.a.ACTION_OnIntersectionEnterTrigger,t.OnIntersectionExitTrigger=m.a.ACTION_OnIntersectionExitTrigger,t.OnKeyDownTrigger=m.a.ACTION_OnKeyDownTrigger,t.OnKeyUpTrigger=15,t}(n(79).a),C=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i._sound=n,i}return u.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(s),w=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i._sound=n,i}return u.d(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(s);a.a.RegisteredTypes["BABYLON.PlaySoundAction"]=w,a.a.RegisteredTypes["BABYLON.StopSoundAction"]=w;var O,I=n(12),D=n(2);!function(e){e[e.STEP=1]="STEP"}(O||(O={}));var L=function(){function e(e,t,n){this.name=e,this.from=t,this.to=n}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}(),F=n(25),N=function(){},B=function(){function e(t,n,r,i,o,a){this.name=t,this.targetProperty=n,this.framePerSecond=r,this.dataType=i,this.loopMode=o,this.enableBlending=a,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=n.split("."),this.dataType=i,this.loopMode=void 0===o?e.ANIMATIONLOOPMODE_CYCLE:o}return e._PrepareAnimation=function(t,n,r,i,a,s,l,u){var c=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?c=e.ANIMATIONTYPE_FLOAT:a instanceof o.q?c=e.ANIMATIONTYPE_QUATERNION:a instanceof o.x?c=e.ANIMATIONTYPE_VECTOR3:a instanceof o.w?c=e.ANIMATIONTYPE_VECTOR2:a instanceof o.e?c=e.ANIMATIONTYPE_COLOR3:a instanceof o.r&&(c=e.ANIMATIONTYPE_SIZE),null==c)return null;var h=new e(t,n,r,c,l),d=[{frame:0,value:a},{frame:i,value:s}];return h.setKeys(d),void 0!==u&&h.setEasingFunction(u),h},e.CreateAnimation=function(t,n,r,i){var o=new e(t+"Animation",t,r,n,e.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(i),o},e.CreateAndStartAnimation=function(t,n,r,i,o,a,s,l,u,c){var h=e._PrepareAnimation(t,r,i,o,a,s,l,u);return h?n.getScene().beginDirectAnimation(n,[h],0,o,1===h.loopMode,1,c):null},e.CreateAndStartHierarchyAnimation=function(t,n,r,i,o,a,s,l,u,c,h){var d=e._PrepareAnimation(t,i,o,a,s,l,u,c);return d?n.getScene().beginDirectHierarchyAnimation(n,r,[d],0,a,1===d.loopMode,1,h):null},e.CreateMergeAndStartAnimation=function(t,n,r,i,o,a,s,l,u,c){var h=e._PrepareAnimation(t,r,i,o,a,s,l,u);return h?(n.animations.push(h),n.getScene().beginAnimation(n,0,o,1===h.loopMode,1,c)):null},e.TransitionTo=function(e,t,n,r,i,o,a,s){if(void 0===s&&(s=null),a<=0)return n[e]=t,s&&s(),null;var l=i*(a/1e3);o.setKeys([{frame:0,value:n[e].clone?n[e].clone():n[e]},{frame:l,value:t}]),n.animations||(n.animations=[]),n.animations.push(o);var u=r.beginAnimation(n,0,l,!1);return u.onAnimationEnd=s,u},Object.defineProperty(e.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++)if(!t[e].isStopped)return!0;return!1},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(t+=", ",n=!1),t+=r;t+="}"}return t},e.prototype.addEvent=function(e){this._events.push(e)},e.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},e.prototype.getEvents=function(){return this._events},e.prototype.createRange=function(e,t,n){this._ranges[e]||(this._ranges[e]=new L(e,t,n))},e.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var n=this._ranges[e];if(n){if(t)for(var r=n.from,i=n.to,o=this._keys.length-1;o>=0;o--)this._keys[o].frame>=r&&this._keys[o].frame<=i&&this._keys.splice(o,1);this._ranges[e]=null}},e.prototype.getRange=function(e){return this._ranges[e]},e.prototype.getKeys=function(){return this._keys},e.prototype.getHighestFrame=function(){for(var e=0,t=0,n=this._keys.length;t<n;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},e.prototype.getEasingFunction=function(){return this._easingFunction},e.prototype.setEasingFunction=function(e){this._easingFunction=e},e.prototype.floatInterpolateFunction=function(e,t,n){return I.a.Lerp(e,t,n)},e.prototype.floatInterpolateFunctionWithTangents=function(e,t,n,r,i){return I.a.Hermite(e,t,n,r,i)},e.prototype.quaternionInterpolateFunction=function(e,t,n){return o.q.Slerp(e,t,n)},e.prototype.quaternionInterpolateFunctionWithTangents=function(e,t,n,r,i){return o.q.Hermite(e,t,n,r,i).normalize()},e.prototype.vector3InterpolateFunction=function(e,t,n){return o.x.Lerp(e,t,n)},e.prototype.vector3InterpolateFunctionWithTangents=function(e,t,n,r,i){return o.x.Hermite(e,t,n,r,i)},e.prototype.vector2InterpolateFunction=function(e,t,n){return o.w.Lerp(e,t,n)},e.prototype.vector2InterpolateFunctionWithTangents=function(e,t,n,r,i){return o.w.Hermite(e,t,n,r,i)},e.prototype.sizeInterpolateFunction=function(e,t,n){return o.r.Lerp(e,t,n)},e.prototype.color3InterpolateFunction=function(e,t,n){return o.e.Lerp(e,t,n)},e.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},e.prototype._interpolate=function(t,n){if(n.loopMode===e.ANIMATIONLOOPMODE_CONSTANT&&n.repeatCount>0)return n.highLimitValue.clone?n.highLimitValue.clone():n.highLimitValue;var r=this._keys;if(1===r.length)return this._getKeyValue(r[0].value);var i=n.key;if(r[i].frame>=t)for(;i-1>=0&&r[i].frame>=t;)i--;for(var o=i;o<r.length;o++){var a=r[o+1];if(a.frame>=t){n.key=o;var s=r[o],l=this._getKeyValue(s.value);if(s.interpolation===O.STEP)return l;var u=this._getKeyValue(a.value),c=void 0!==s.outTangent&&void 0!==a.inTangent,h=a.frame-s.frame,d=(t-s.frame)/h,f=this.getEasingFunction();switch(null!=f&&(d=f.ease(d)),this.dataType){case e.ANIMATIONTYPE_FLOAT:var p=c?this.floatInterpolateFunctionWithTangents(l,s.outTangent*h,u,a.inTangent*h,d):this.floatInterpolateFunction(l,u,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return p;case e.ANIMATIONLOOPMODE_RELATIVE:return n.offsetValue*n.repeatCount+p}break;case e.ANIMATIONTYPE_QUATERNION:var m=c?this.quaternionInterpolateFunctionWithTangents(l,s.outTangent.scale(h),u,a.inTangent.scale(h),d):this.quaternionInterpolateFunction(l,u,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return m;case e.ANIMATIONLOOPMODE_RELATIVE:return m.addInPlace(n.offsetValue.scale(n.repeatCount))}return m;case e.ANIMATIONTYPE_VECTOR3:var g=c?this.vector3InterpolateFunctionWithTangents(l,s.outTangent.scale(h),u,a.inTangent.scale(h),d):this.vector3InterpolateFunction(l,u,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return g;case e.ANIMATIONLOOPMODE_RELATIVE:return g.add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_VECTOR2:var _=c?this.vector2InterpolateFunctionWithTangents(l,s.outTangent.scale(h),u,a.inTangent.scale(h),d):this.vector2InterpolateFunction(l,u,d);switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return _;case e.ANIMATIONLOOPMODE_RELATIVE:return _.add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_SIZE:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(l,u,d);case e.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(l,u,d).add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_COLOR3:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(l,u,d);case e.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(l,u,d).add(n.offsetValue.scale(n.repeatCount))}case e.ANIMATIONTYPE_MATRIX:switch(n.loopMode){case e.ANIMATIONLOOPMODE_CYCLE:case e.ANIMATIONLOOPMODE_CONSTANT:if(e.AllowMatricesInterpolation)return this.matrixInterpolateFunction(l,u,d,n.workValue);case e.ANIMATIONLOOPMODE_RELATIVE:return l}}break}}return this._getKeyValue(r[r.length-1].value)},e.prototype.matrixInterpolateFunction=function(t,n,r,i){return e.AllowMatrixDecomposeForInterpolation?i?(o.j.DecomposeLerpToRef(t,n,r,i),i):o.j.DecomposeLerp(t,n,r):i?(o.j.LerpToRef(t,n,r,i),i):o.j.Lerp(t,n,r)},e.prototype.clone=function(){var t=new e(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges)for(var n in t._ranges={},this._ranges){var r=this._ranges[n];r&&(t._ranges[n]=r.clone())}return t},e.prototype.setKeys=function(e){this._keys=e.slice(0)},e.prototype.serialize=function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var n=this.dataType;t.keys=[];for(var r=this.getKeys(),i=0;i<r.length;i++){var o=r[i],a={};switch(a.frame=o.frame,n){case e.ANIMATIONTYPE_FLOAT:a.values=[o.value];break;case e.ANIMATIONTYPE_QUATERNION:case e.ANIMATIONTYPE_MATRIX:case e.ANIMATIONTYPE_VECTOR3:case e.ANIMATIONTYPE_COLOR3:a.values=o.value.asArray()}t.keys.push(a)}for(var s in t.ranges=[],this._ranges){var l=this._ranges[s];if(l){var u={};u.name=s,u.from=l.from,u.to=l.to,t.ranges.push(u)}}return t},Object.defineProperty(e,"ANIMATIONTYPE_FLOAT",{get:function(){return e._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_VECTOR3",{get:function(){return e._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_VECTOR2",{get:function(){return e._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_SIZE",{get:function(){return e._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_QUATERNION",{get:function(){return e._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_MATRIX",{get:function(){return e._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONTYPE_COLOR3",{get:function(){return e._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return e._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return e._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return e._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),e._UniversalLerp=function(e,t,n){var r=e.constructor;return r.Lerp?r.Lerp(e,t,n):r.Slerp?r.Slerp(e,t,n):e.toFixed?e*(1-n)+n*t:t},e.Parse=function(t){var n,r,i=new e(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),a=t.dataType,s=[];for(t.enableBlending&&(i.enableBlending=t.enableBlending),t.blendingSpeed&&(i.blendingSpeed=t.blendingSpeed),r=0;r<t.keys.length;r++){var l,u,c=t.keys[r];switch(a){case e.ANIMATIONTYPE_FLOAT:n=c.values[0],c.values.length>=1&&(l=c.values[1]),c.values.length>=2&&(u=c.values[2]);break;case e.ANIMATIONTYPE_QUATERNION:if(n=o.q.FromArray(c.values),c.values.length>=8){var h=o.q.FromArray(c.values.slice(4,8));h.equals(o.q.Zero())||(l=h)}if(c.values.length>=12){var d=o.q.FromArray(c.values.slice(8,12));d.equals(o.q.Zero())||(u=d)}break;case e.ANIMATIONTYPE_MATRIX:n=o.j.FromArray(c.values);break;case e.ANIMATIONTYPE_COLOR3:n=o.e.FromArray(c.values);break;case e.ANIMATIONTYPE_VECTOR3:default:n=o.x.FromArray(c.values)}var f={};f.frame=c.frame,f.value=n,null!=l&&(f.inTangent=l),null!=u&&(f.outTangent=u),s.push(f)}if(i.setKeys(s),t.ranges)for(r=0;r<t.ranges.length;r++)n=t.ranges[r],i.createRange(n.name,n.from,n.to);return i},e.AppendSerializedAnimations=function(e,t){D.a.AppendSerializedAnimations(e,t)},e.AllowMatricesInterpolation=!1,e.AllowMatrixDecomposeForInterpolation=!0,e._ANIMATIONTYPE_FLOAT=0,e._ANIMATIONTYPE_VECTOR3=1,e._ANIMATIONTYPE_QUATERNION=2,e._ANIMATIONTYPE_MATRIX=3,e._ANIMATIONTYPE_COLOR3=4,e._ANIMATIONTYPE_VECTOR2=5,e._ANIMATIONTYPE_SIZE=6,e._ANIMATIONLOOPMODE_RELATIVE=0,e._ANIMATIONLOOPMODE_CYCLE=1,e._ANIMATIONLOOPMODE_CONSTANT=2,e}();a.a.RegisteredTypes["BABYLON.Animation"]=B,F.a._AnimationRangeFactory=function(e,t,n){return new L(e,t,n)};var U=function(e){function t(t,n,r,o,a,s,l,u){void 0===a&&(a=1e3);var c=e.call(this,t,s)||this;return c.duration=1e3,c.onInterpolationDoneObservable=new i.c,c.propertyPath=r,c.value=o,c.duration=a,c.stopOtherAnimations=l,c.onInterpolationDone=u,c._target=c._effectiveTarget=n,c}return u.d(t,e),t.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},t.prototype.execute=function(){var e,t=this,n=this._actionManager.getScene(),r=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)e=B.ANIMATIONTYPE_FLOAT;else if(this.value instanceof o.e)e=B.ANIMATIONTYPE_COLOR3;else if(this.value instanceof o.x)e=B.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof o.j)e=B.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof o.q))return void p.a.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");e=B.ANIMATIONTYPE_QUATERNION}var i=new B("InterpolateValueAction",this._property,1e3/this.duration*100,e,B.ANIMATIONLOOPMODE_CONSTANT);i.setKeys(r),this.stopOtherAnimations&&n.stopAnimation(this._effectiveTarget),n.beginDirectAnimation(this._effectiveTarget,[i],0,100,!1,1,function(){t.onInterpolationDoneObservable.notifyObservers(t),t.onInterpolationDone&&t.onInterpolationDone()})},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[s._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:s._SerializeValueAsString(this.value)},{name:"duration",value:s._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:s._SerializeValueAsString(this.stopOtherAnimations)||!1}]},t)},t}(s);a.a.RegisteredTypes["BABYLON.InterpolateValueAction"]=U;var k=Object.freeze(new o.q(0,0,0,0)),V=Object.freeze(o.x.Zero()),G=Object.freeze(o.w.Zero()),z=Object.freeze(o.r.Zero()),j=Object.freeze(o.e.Black()),H=function(){function e(e,t,n,r){var i=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=t,this._target=e,this._scene=n,this._host=r,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===B.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=o.j.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){var a={frame:0,value:this._minValue};this._keys.splice(0,0,a)}if(this._target instanceof Array){for(var s=0,l=0,u=this._target;l<u.length;l++){var c=u[l];this._preparePath(c,s),this._getOriginalValues(s),s++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var h=t.getEvents();h&&h.length>0&&h.forEach(function(e){i._events.push(e._clone())}),this._enableBlending=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(e.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!0,configurable:!0}),e.prototype._preparePath=function(e,t){void 0===t&&(t=0);var n=this._animation.targetPropertyPath;if(n.length>1){for(var r=e[n[0]],i=1;i<n.length-1;i++)r=r[n[i]];this._targetPath=n[n.length-1],this._activeTargets[t]=r}else this._targetPath=n[0],this._activeTargets[t]=e},Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),e.prototype.reset=function(e){if(void 0===e&&(e=!1),e)if(this._target instanceof Array)for(var t=0,n=0,r=this._target;n<r.length;n++){var i=r[n];void 0!==this._originalValue[t]&&this._setValue(i,this._activeTargets[t],this._originalValue[t],-1,t),t++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);for(this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0,t=0;t<this._events.length;t++)this._events[t].isDone=!1},e.prototype.isStopped=function(){return this._stopped},e.prototype.dispose=function(){var e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)},e.prototype.setValue=function(e,t){if(this._targetIsArray)for(var n=0;n<this._target.length;n++){var r=this._target[n];this._setValue(r,this._activeTargets[n],e,t,n)}else this._setValue(this._target,this._directTarget,e,t,0)},e.prototype._getOriginalValues=function(e){var t;void 0===e&&(e=0);var n=this._activeTargets[e];(t=n.getRestPose&&"_matrix"===this._targetPath?n.getRestPose():n[this._targetPath])&&t.clone?this._originalValue[e]=t.clone():this._originalValue[e]=t},e.prototype._setValue=function(e,t,n,r,i){if(this._currentActiveTarget=t,this._weight=r,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var a=t[this._targetPath];a.clone?this._originalBlendValue=a.clone():this._originalBlendValue=a}this._originalBlendValue.m?B.AllowMatrixDecomposeForInterpolation?this._currentValue?o.j.DecomposeLerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=o.j.DecomposeLerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue?o.j.LerpToRef(this._originalBlendValue,n,this._blendingFactor,this._currentValue):this._currentValue=o.j.Lerp(this._originalBlendValue,n,this._blendingFactor):this._currentValue=B._UniversalLerp(this._originalBlendValue,n,this._blendingFactor);var s=e&&e.animationPropertiesOverride?e.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=s}else this._currentValue=n;-1!==r?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[i]):t[this._targetPath]=this._currentValue,e.markAsDirty&&e.markAsDirty(this._animation.targetProperty)},e.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},e.prototype.goToFrame=function(e){var t=this._animation.getKeys();e<t[0].frame?e=t[0].frame:e>t[t.length-1].frame&&(e=t[t.length-1].frame),this._currentFrame=e;var n=this._animation._interpolate(e,this._animationState);this.setValue(n,-1)},e.prototype._prepareForSpeedRatioChange=function(e){var t=this._previousDelay*(this._animation.framePerSecond*e)/1e3;this._ratioOffset=this._previousRatio-t},e.prototype.animate=function(e,t,n,r,i,o){void 0===o&&(o=-1);var a=this._animation,s=a.targetPropertyPath;if(!s||s.length<1)return this._stopped=!0,!1;var l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(n<this._minFrame||n>this._maxFrame)&&(n=this._maxFrame);var u,c,h=n-t,d=e*(a.framePerSecond*i)/1e3+this._ratioOffset,f=0;if(this._previousDelay=e,this._previousRatio=d,!r&&n>=t&&d>=h)l=!1,f=a._getKeyValue(this._maxValue);else if(!r&&t>=n&&d<=h)l=!1,f=a._getKeyValue(this._minValue);else if(this._animationState.loopMode!==B.ANIMATIONLOOPMODE_CYCLE){var p=n.toString()+t.toString();if(!this._offsetsCache[p]){this._animationState.repeatCount=0,this._animationState.loopMode=B.ANIMATIONLOOPMODE_CYCLE;var m=a._interpolate(t,this._animationState),g=a._interpolate(n,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),a.dataType){case B.ANIMATIONTYPE_FLOAT:this._offsetsCache[p]=g-m;break;case B.ANIMATIONTYPE_QUATERNION:this._offsetsCache[p]=g.subtract(m);break;case B.ANIMATIONTYPE_VECTOR3:this._offsetsCache[p]=g.subtract(m);case B.ANIMATIONTYPE_VECTOR2:this._offsetsCache[p]=g.subtract(m);case B.ANIMATIONTYPE_SIZE:this._offsetsCache[p]=g.subtract(m);case B.ANIMATIONTYPE_COLOR3:this._offsetsCache[p]=g.subtract(m)}this._highLimitsCache[p]=g}f=this._highLimitsCache[p],u=this._offsetsCache[p]}if(void 0===u)switch(a.dataType){case B.ANIMATIONTYPE_FLOAT:u=0;break;case B.ANIMATIONTYPE_QUATERNION:u=k;break;case B.ANIMATIONTYPE_VECTOR3:u=V;break;case B.ANIMATIONTYPE_VECTOR2:u=G;break;case B.ANIMATIONTYPE_SIZE:u=z;break;case B.ANIMATIONTYPE_COLOR3:u=j}if(this._host&&this._host.syncRoot){var _=this._host.syncRoot;c=t+(n-t)*((_.masterFrame-_.fromFrame)/(_.toFrame-_.fromFrame))}else c=l&&0!==h?t+d%h:n;var v=this._events;if((h>0&&this.currentFrame>c||h<0&&this.currentFrame<c)&&(this._onLoop(),v.length))for(var y=0;y<v.length;y++)v[y].onlyOnce||(v[y].isDone=!1);this._currentFrame=c,this._animationState.repeatCount=0===h?0:d/h>>0,this._animationState.highLimitValue=f,this._animationState.offsetValue=u;var b=a._interpolate(c,this._animationState);if(this.setValue(b,o),v.length)for(y=0;y<v.length;y++)if(h>0&&c>=v[y].frame&&v[y].frame>=t||h<0&&c<=v[y].frame&&v[y].frame<=t){var E=v[y];E.isDone||(E.onlyOnce&&(v.splice(y,1),y--),E.isDone=!0,E.action(c))}return l||(this._stopped=!0),l},e}(),W=n(16),X=n(47),Y=n(34),K=function(e){function t(t,n,r,i,a,s,l){void 0===r&&(r=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null);var u=e.call(this,t,n.getScene(),!1)||this;return u.name=t,u.children=new Array,u.animations=new Array,u._index=null,u._absoluteTransform=new o.j,u._invertedAbsoluteTransform=new o.j,u._scalingDeterminant=1,u._worldTransform=new o.j,u._needToDecompose=!0,u._needToCompose=!1,u._linkedTransformNode=null,u._waitingTransformNodeId=null,u._skeleton=n,u._localMatrix=i?i.clone():o.j.Identity(),u._restPose=a||u._localMatrix.clone(),u._baseMatrix=s||u._localMatrix.clone(),u._index=l,n.bones.push(u),u.setParent(r,!1),(s||i)&&u._updateDifferenceMatrix(),u}return u.d(t,e),Object.defineProperty(t.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Bone"},t.prototype.getSkeleton=function(){return this._skeleton},t.prototype.getParent=function(){return this._parent},t.prototype.getChildren=function(){return this.children},t.prototype.setParent=function(e,t){if(void 0===t&&(t=!0),this._parent!==e){if(this._parent){var n=this._parent.children.indexOf(this);-1!==n&&this._parent.children.splice(n,1)}this._parent=e,this._parent&&this._parent.children.push(this),t&&this._updateDifferenceMatrix(),this.markAsDirty()}},t.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},t.prototype.getBaseMatrix=function(){return this._baseMatrix},t.prototype.getRestPose=function(){return this._restPose},t.prototype.getWorldMatrix=function(){return this._worldTransform},t.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},t.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},t.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},t.prototype.linkTransformNode=function(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},Object.defineProperty(t.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!0,configurable:!0}),t.prototype._decompose=function(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.x.Zero(),this._localRotation=o.q.Zero(),this._localPosition=o.x.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},t.prototype._compose=function(){this._needToCompose&&(this._needToCompose=!1,o.j.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix))},t.prototype.updateMatrix=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0),this._baseMatrix.copyFrom(e),t&&this._updateDifferenceMatrix(),n?(this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},t.prototype._updateDifferenceMatrix=function(e,t){if(void 0===t&&(t=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),t)for(var n=0;n<this.children.length;n++)this.children[n]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},t.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},t.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},t.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},t.prototype.translate=function(e,n,r){void 0===n&&(n=o.s.LOCAL);var i=this.getLocalMatrix();if(n==o.s.LOCAL)i.addAtIndex(12,e.x),i.addAtIndex(13,e.y),i.addAtIndex(14,e.z);else{var a=null;r&&(a=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=t._tmpMats[0],l=t._tmpVecs[0];this._parent&&(r&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.setTranslationFromFloats(0,0,0),s.invert(),o.x.TransformCoordinatesToRef(e,s,l),i.addAtIndex(12,l.x),i.addAtIndex(13,l.y),i.addAtIndex(14,l.z)}this._markAsDirtyAndDecompose()},t.prototype.setPosition=function(e,n,r){void 0===n&&(n=o.s.LOCAL);var i=this.getLocalMatrix();if(n==o.s.LOCAL)i.setTranslationFromFloats(e.x,e.y,e.z);else{var a=null;r&&(a=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=t._tmpMats[0],l=t._tmpVecs[0];this._parent&&(r&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform())),s.invert(),o.x.TransformCoordinatesToRef(e,s,l),i.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()},t.prototype.setAbsolutePosition=function(e,t){this.setPosition(e,o.s.WORLD,t)},t.prototype.scale=function(e,n,r,i){void 0===i&&(i=!1);var a=this.getLocalMatrix(),s=t._tmpMats[0];o.j.ScalingToRef(e,n,r,s),s.multiplyToRef(a,a),s.invert();for(var l=0,u=this.children;l<u.length;l++){var c=(f=u[l]).getLocalMatrix();c.multiplyToRef(s,c),c.multiplyAtIndex(12,e),c.multiplyAtIndex(13,n),c.multiplyAtIndex(14,r),f._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),i)for(var h=0,d=this.children;h<d.length;h++){var f;(f=d[h]).scale(e,n,r,i)}},t.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},t.prototype.getScale=function(){return this._decompose(),this._localScaling},t.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},t.prototype.setYawPitchRoll=function(e,n,r,i,a){if(void 0===i&&(i=o.s.LOCAL),i===o.s.LOCAL){var s=t._tmpQuat;return o.q.RotationYawPitchRollToRef(e,n,r,s),void this.setRotationQuaternion(s,i,a)}var l=t._tmpMats[0];if(this._getNegativeRotationToRef(l,a)){var u=t._tmpMats[1];o.j.RotationYawPitchRollToRef(e,n,r,u),l.multiplyToRef(u,u),this._rotateWithMatrix(u,i,a)}},t.prototype.rotate=function(e,n,r,i){void 0===r&&(r=o.s.LOCAL);var a=t._tmpMats[0];a.setTranslationFromFloats(0,0,0),o.j.RotationAxisToRef(e,n,a),this._rotateWithMatrix(a,r,i)},t.prototype.setAxisAngle=function(e,n,r,i){if(void 0===r&&(r=o.s.LOCAL),r===o.s.LOCAL){var a=t._tmpQuat;return o.q.RotationAxisToRef(e,n,a),void this.setRotationQuaternion(a,r,i)}var s=t._tmpMats[0];if(this._getNegativeRotationToRef(s,i)){var l=t._tmpMats[1];o.j.RotationAxisToRef(e,n,l),s.multiplyToRef(l,l),this._rotateWithMatrix(l,r,i)}},t.prototype.setRotation=function(e,t,n){void 0===t&&(t=o.s.LOCAL),this.setYawPitchRoll(e.y,e.x,e.z,t,n)},t.prototype.setRotationQuaternion=function(e,n,r){if(void 0===n&&(n=o.s.LOCAL),n===o.s.LOCAL)return this._decompose(),this._localRotation.copyFrom(e),void this._markAsDirtyAndCompose();var i=t._tmpMats[0];if(this._getNegativeRotationToRef(i,r)){var a=t._tmpMats[1];o.j.FromQuaternionToRef(e,a),i.multiplyToRef(a,a),this._rotateWithMatrix(a,n,r)}},t.prototype.setRotationMatrix=function(e,n,r){if(void 0===n&&(n=o.s.LOCAL),n===o.s.LOCAL){var i=t._tmpQuat;return o.q.FromRotationMatrixToRef(e,i),void this.setRotationQuaternion(i,n,r)}var a=t._tmpMats[0];if(this._getNegativeRotationToRef(a,r)){var s=t._tmpMats[1];s.copyFrom(e),a.multiplyToRef(e,s),this._rotateWithMatrix(s,n,r)}},t.prototype._rotateWithMatrix=function(e,n,r){void 0===n&&(n=o.s.LOCAL);var i=this.getLocalMatrix(),a=i.m[12],s=i.m[13],l=i.m[14],u=this.getParent(),c=t._tmpMats[3],h=t._tmpMats[4];u&&n==o.s.WORLD?(r?(c.copyFrom(r.getWorldMatrix()),u.getAbsoluteTransform().multiplyToRef(c,c)):c.copyFrom(u.getAbsoluteTransform()),h.copyFrom(c),h.invert(),i.multiplyToRef(c,i),i.multiplyToRef(e,i),i.multiplyToRef(h,i)):n==o.s.WORLD&&r?(c.copyFrom(r.getWorldMatrix()),h.copyFrom(c),h.invert(),i.multiplyToRef(c,i),i.multiplyToRef(e,i),i.multiplyToRef(h,i)):i.multiplyToRef(e,i),i.setTranslationFromFloats(a,s,l),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},t.prototype._getNegativeRotationToRef=function(e,n){var r=t._tmpMats[2];return e.copyFrom(this.getAbsoluteTransform()),n&&(e.multiplyToRef(n.getWorldMatrix(),e),o.j.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,r)),e.invert(),!isNaN(e.m[0])&&(r.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(r,e),!0)},t.prototype.getPosition=function(e,t){void 0===e&&(e=o.s.LOCAL),void 0===t&&(t=null);var n=o.x.Zero();return this.getPositionToRef(e,t,n),n},t.prototype.getPositionToRef=function(e,n,r){if(void 0===e&&(e=o.s.LOCAL),e==o.s.LOCAL){var i=this.getLocalMatrix();r.x=i.m[12],r.y=i.m[13],r.z=i.m[14]}else{var a=null;n&&(a=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=t._tmpMats[0];n&&a?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(a,s)):s=this.getAbsoluteTransform(),r.x=s.m[12],r.y=s.m[13],r.z=s.m[14]}},t.prototype.getAbsolutePosition=function(e){void 0===e&&(e=null);var t=o.x.Zero();return this.getPositionToRef(o.s.WORLD,e,t),t},t.prototype.getAbsolutePositionToRef=function(e,t){this.getPositionToRef(o.s.WORLD,e,t)},t.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var t=this.children,n=t.length,r=0;r<n;r++)t[r].computeAbsoluteTransforms()},t.prototype.getDirection=function(e,t){void 0===t&&(t=null);var n=o.x.Zero();return this.getDirectionToRef(e,t,n),n},t.prototype.getDirectionToRef=function(e,n,r){void 0===n&&(n=null);var i=null;n&&(i=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=t._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),n&&i&&a.multiplyToRef(i,a),o.x.TransformNormalToRef(e,a,r),r.normalize()},t.prototype.getRotation=function(e,t){void 0===e&&(e=o.s.LOCAL),void 0===t&&(t=null);var n=o.x.Zero();return this.getRotationToRef(e,t,n),n},t.prototype.getRotationToRef=function(e,n,r){void 0===e&&(e=o.s.LOCAL),void 0===n&&(n=null);var i=t._tmpQuat;this.getRotationQuaternionToRef(e,n,i),i.toEulerAnglesToRef(r)},t.prototype.getRotationQuaternion=function(e,t){void 0===e&&(e=o.s.LOCAL),void 0===t&&(t=null);var n=o.q.Identity();return this.getRotationQuaternionToRef(e,t,n),n},t.prototype.getRotationQuaternionToRef=function(e,n,r){if(void 0===e&&(e=o.s.LOCAL),void 0===n&&(n=null),e==o.s.LOCAL)this._decompose(),r.copyFrom(this._localRotation);else{var i=t._tmpMats[0],a=this.getAbsoluteTransform();n?a.multiplyToRef(n.getWorldMatrix(),i):i.copyFrom(a),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.decompose(void 0,r,void 0)}},t.prototype.getRotationMatrix=function(e,t){void 0===e&&(e=o.s.LOCAL);var n=o.j.Identity();return this.getRotationMatrixToRef(e,t,n),n},t.prototype.getRotationMatrixToRef=function(e,n,r){if(void 0===e&&(e=o.s.LOCAL),e==o.s.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(r);else{var i=t._tmpMats[0],a=this.getAbsoluteTransform();n?a.multiplyToRef(n.getWorldMatrix(),i):i.copyFrom(a),i.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyAtIndex(1,this._scalingDeterminant),i.multiplyAtIndex(2,this._scalingDeterminant),i.getRotationMatrixToRef(r)}},t.prototype.getAbsolutePositionFromLocal=function(e,t){void 0===t&&(t=null);var n=o.x.Zero();return this.getAbsolutePositionFromLocalToRef(e,t,n),n},t.prototype.getAbsolutePositionFromLocalToRef=function(e,n,r){void 0===n&&(n=null);var i=null;n&&(i=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=t._tmpMats[0];n&&i?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(i,a)):a=this.getAbsoluteTransform(),o.x.TransformCoordinatesToRef(e,a,r)},t.prototype.getLocalPositionFromAbsolute=function(e,t){void 0===t&&(t=null);var n=o.x.Zero();return this.getLocalPositionFromAbsoluteToRef(e,t,n),n},t.prototype.getLocalPositionFromAbsoluteToRef=function(e,n,r){void 0===n&&(n=null);var i=null;n&&(i=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=t._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),n&&i&&a.multiplyToRef(i,a),a.invert(),o.x.TransformCoordinatesToRef(e,a,r)},t._tmpVecs=Y.a.BuildArray(2,o.x.Zero),t._tmpQuat=o.q.Identity(),t._tmpMats=Y.a.BuildArray(5,o.j.Identity),t}(F.a),q=function(){function e(e,t,n,r,o,a,s,l,u){void 0===n&&(n=0),void 0===r&&(r=100),void 0===o&&(o=!1),void 0===a&&(a=1),this.target=t,this.fromFrame=n,this.toFrame=r,this.loopAnimation=o,this.onAnimationEnd=s,this.onAnimationLoop=u,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new i.c,this.onAnimationLoopObservable=new i.c,this._scene=e,l&&this.appendAnimations(t,l),this._speedRatio=a,e._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(e){this._weight=-1!==e?Math.min(Math.max(e,0),1):-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){for(var t=0;t<this._runtimeAnimations.length;t++)this._runtimeAnimations[t]._prepareForSpeedRatioChange(e);this._speedRatio=e},enumerable:!0,configurable:!0}),e.prototype.syncWith=function(e){if(this._syncRoot=e,e){var t=this._scene._activeAnimatables.indexOf(this);t>-1&&(this._scene._activeAnimatables.splice(t,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(e,t){for(var n=this,r=0;r<t.length;r++){var i=t[r],o=new H(e,i,this._scene,this);o._onLoop=function(){n.onAnimationLoopObservable.notifyObservers(n),n.onAnimationLoop&&n.onAnimationLoop()},this._runtimeAnimations.push(o)}},e.prototype.getAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)if(t[n].animation.targetProperty===e)return t[n].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)if(t[n].animation.targetProperty===e)return t[n];return null},e.prototype.reset=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(e){for(var t=this._runtimeAnimations,n=0;n<t.length;n++)t[n].animation.enableBlending=!0,t[n].animation.blendingSpeed=e},e.prototype.disableBlending=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].animation.enableBlending=!1},e.prototype.goToFrame=function(e){var t=this._runtimeAnimations;if(t[0]){var n=t[0].animation.framePerSecond,r=e-t[0].currentFrame,i=0!==this.speedRatio?1e3*r/(n*this.speedRatio):0;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=i}for(var o=0;o<t.length;o++)t[o].goToFrame(e)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(e,t){if(e||t){var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){for(var r=(o=this._runtimeAnimations).length-1;r>=0;r--){var i=o[r];e&&i.animation.name!=e||t&&!t(i.target)||(i.dispose(),o.splice(r,1))}0==o.length&&(this._scene._activeAnimatables.splice(n,1),this._raiseOnAnimationEnd())}}else if((r=this._scene._activeAnimatables.indexOf(this))>-1){this._scene._activeAnimatables.splice(r,1);var o=this._runtimeAnimations;for(r=0;r<o.length;r++)o[r].dispose();this._raiseOnAnimationEnd()}},e.prototype.waitAsync=function(){var e=this;return new Promise(function(t,n){e.onAnimationEndObservable.add(function(){t(e)},void 0,void 0,e,!0)})},e.prototype._animate=function(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;if(null===this._localDelayOffset?(this._localDelayOffset=e,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null),0===this._weight)return!0;var t,n=!1,r=this._runtimeAnimations;for(t=0;t<r.length;t++){var i=r[t].animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);n=n||i}if(this.animationStarted=n,!n){if(this.disposeOnEnd)for(t=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(t,1),t=0;t<r.length;t++)r[t].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return n},e}();W.a.prototype._animate=function(){if(this.animationsEnabled){var e=this._activeAnimatables;if(0!==e.length){var t=X.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}var n=this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale;this._animationTime+=n;var r=this._animationTime;this._animationTimeLast=t;for(var i=0;i<e.length;i++)e[i]._animate(r);this._processLateAnimationBindings()}}},W.a.prototype.beginWeightedAnimation=function(e,t,n,r,i,o,a,s,l,u){void 0===r&&(r=1),void 0===o&&(o=1);var c=this.beginAnimation(e,t,n,i,o,a,s,!1,l,u);return c.weight=r,c},W.a.prototype.beginAnimation=function(e,t,n,r,i,o,a,s,l,u){void 0===i&&(i=1),void 0===s&&(s=!0),t>n&&i>0&&(i*=-1),s&&this.stopAnimation(e,void 0,l),a||(a=new q(this,e,t,n,r,i,o,void 0,u));var c=!l||l(e);if(e.animations&&c&&a.appendAnimations(e,e.animations),e.getAnimatables)for(var h=e.getAnimatables(),d=0;d<h.length;d++)this.beginAnimation(h[d],t,n,r,i,o,a,s,l,u);return a.reset(),a},W.a.prototype.beginHierarchyAnimation=function(e,t,n,r,i,o,a,s,l,u,c){void 0===o&&(o=1),void 0===l&&(l=!0);var h=e.getDescendants(t),d=[];d.push(this.beginAnimation(e,n,r,i,o,a,s,l,u));for(var f=0,p=h;f<p.length;f++){var m=p[f];d.push(this.beginAnimation(m,n,r,i,o,a,s,l,u))}return d},W.a.prototype.beginDirectAnimation=function(e,t,n,r,i,o,a,s){return void 0===o&&(o=1),new q(this,e,n,r,i,o,a,t,s)},W.a.prototype.beginDirectHierarchyAnimation=function(e,t,n,r,i,o,a,s,l){var u=e.getDescendants(t),c=[];c.push(this.beginDirectAnimation(e,n,r,i,o,a,s,l));for(var h=0,d=u;h<d.length;h++){var f=d[h];c.push(this.beginDirectAnimation(f,n,r,i,o,a,s,l))}return c},W.a.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},W.a.prototype.getAllAnimatablesByTarget=function(e){for(var t=[],n=0;n<this._activeAnimatables.length;n++)this._activeAnimatables[n].target===e&&t.push(this._activeAnimatables[n]);return t},W.a.prototype.stopAnimation=function(e,t,n){for(var r=0,i=this.getAllAnimatablesByTarget(e);r<i.length;r++)i[r].stop(t,n)},W.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}for(var t=0,n=this.animationGroups;t<n.length;t++)n[t].stop()},W.a.prototype._registerTargetForLateAnimationBinding=function(e,t){var n=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(n),n._lateAnimationHolders||(n._lateAnimationHolders={}),n._lateAnimationHolders[e.targetPath]||(n._lateAnimationHolders[e.targetPath]={totalWeight:0,animations:[],originalValue:t}),n._lateAnimationHolders[e.targetPath].animations.push(e),n._lateAnimationHolders[e.targetPath].totalWeight+=e.weight},W.a.prototype._processLateAnimationBindingsForMatrices=function(e){var t=1,n=o.t.Vector3[0],r=o.t.Vector3[1],i=o.t.Quaternion[0],a=0,s=e.animations[0],l=e.originalValue,u=1;if(e.totalWeight<1)l.decompose(r,i,n),u=1-e.totalWeight;else if(a=1,t=e.totalWeight,s.currentValue.decompose(r,i,n),1==(u=s.weight/t))return s.currentValue;r.scaleInPlace(u),n.scaleInPlace(u),i.scaleInPlace(u);for(var c=a;c<e.animations.length;c++){var h=e.animations[c],d=(u=h.weight/t,o.t.Vector3[2]),f=o.t.Vector3[3],p=o.t.Quaternion[1];h.currentValue.decompose(f,p,d),f.scaleAndAddToRef(u,r),p.scaleAndAddToRef(u,i),d.scaleAndAddToRef(u,n)}var m=s._animationState.workValue;return o.j.ComposeToRef(r,i,n,m),m},W.a.prototype._processLateAnimationBindingsForQuaternions=function(e,t){var n=e.animations[0],r=e.originalValue;if(1===e.animations.length)return o.q.SlerpToRef(r,n.currentValue,Math.min(1,e.totalWeight),t),t;var i,a,s=1;if(e.totalWeight<1){var l=1-e.totalWeight;a=[],(i=[]).push(r),a.push(l)}else{if(2===e.animations.length)return o.q.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,t),t;i=[],a=[],s=e.totalWeight}for(var u=0;u<e.animations.length;u++){var c=e.animations[u];i.push(c.currentValue),a.push(c.weight/s)}for(var h=0,d=null,f=0;f<i.length;)d?(h+=a[f],o.q.SlerpToRef(d,i[f],a[f]/h,d),f++):(o.q.SlerpToRef(i[f],i[f+1],a[f+1]/(a[f]+a[f+1]),t),d=t,h=a[f]+a[f+1],f+=2);return d},W.a.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(var e=0;e<this._registeredForLateAnimationBindings.length;e++){var t=this._registeredForLateAnimationBindings.data[e];for(var n in t._lateAnimationHolders){var r=t._lateAnimationHolders[n],i=r.animations[0],a=r.originalValue,s=B.AllowMatrixDecomposeForInterpolation&&a.m,l=t[n];if(s)l=this._processLateAnimationBindingsForMatrices(r);else if(void 0!==a.w)l=this._processLateAnimationBindingsForQuaternions(r,l||o.q.Identity());else{var u=0,c=1;if(r.totalWeight<1)l=a.scale?a.scale(1-r.totalWeight):a*(1-r.totalWeight);else{c=r.totalWeight;var h=i.weight/c;l=1!==h?i.currentValue.scale?i.currentValue.scale(h):i.currentValue*h:i.currentValue,u=1}for(var d=u;d<r.animations.length;d++){var f=r.animations[d],p=f.weight/c;f.currentValue.scaleAndAddToRef?f.currentValue.scaleAndAddToRef(p,l):l+=f.currentValue*p}}t[n]=l}t._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},K.prototype.copyAnimationRange=function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=null),0===this.animations.length&&(this.animations.push(new B(this.name,"_matrix",e.animations[0].framePerSecond,B.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var o=e.animations[0].getRange(t);if(!o)return!1;for(var a,s,l,u=o.from,c=o.to,h=e.animations[0].getKeys(),d=e.length,f=e.getParent(),p=this.getParent(),m=r&&f&&d&&this.length&&d!==this.length,g=m&&p&&f?p.length/f.length:1,_=r&&!p&&i&&(1!==i.x||1!==i.y||1!==i.z),v=this.animations[0].getKeys(),y=0,b=h.length;y<b;y++)(a=h[y]).frame>=u&&a.frame<=c&&(r?(l=a.value.clone(),m?(s=l.getTranslation(),l.setTranslation(s.scaleInPlace(g))):_&&i?(s=l.getTranslation(),l.setTranslation(s.multiplyInPlace(i))):l=a.value):l=a.value,v.push({frame:a.frame+n,value:l}));return this.animations[0].createRange(t,u+n,c+n),!0};var Q=function(){},Z=function(){function e(e,t){void 0===t&&(t=null),this.name=e,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this.onAnimationEndObservable=new i.c,this.onAnimationLoopObservable=new i.c,this.onAnimationGroupEndObservable=new i.c,this.onAnimationGroupPauseObservable=new i.c,this.onAnimationGroupPlayObservable=new i.c,this._scene=t||P.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.animationGroups.push(this)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._to},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){if(this._speedRatio!==e){this._speedRatio=e;for(var t=0;t<this._animatables.length;t++)this._animatables[t].speedRatio=this._speedRatio}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(e){if(this._loopAnimation!==e){this._loopAnimation=e;for(var t=0;t<this._animatables.length;t++)this._animatables[t].loopAnimation=this._loopAnimation}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animatables",{get:function(){return this._animatables},enumerable:!0,configurable:!0}),e.prototype.addTargetedAnimation=function(e,t){var n={animation:e,target:t},r=e.getKeys();return this._from>r[0].frame&&(this._from=r[0].frame),this._to<r[r.length-1].frame&&(this._to=r[r.length-1].frame),this._targetedAnimations.push(n),n},e.prototype.normalize=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null),null==e&&(e=this._from),null==t&&(t=this._to);for(var n=0;n<this._targetedAnimations.length;n++){var r=this._targetedAnimations[n].animation.getKeys(),i=r[0],o=r[r.length-1];if(i.frame>e){var a={frame:e,value:i.value,inTangent:i.inTangent,outTangent:i.outTangent,interpolation:i.interpolation};r.splice(0,0,a)}o.frame<t&&(a={frame:t,value:o.value,inTangent:o.outTangent,outTangent:o.outTangent,interpolation:o.interpolation},r.push(a))}return this._from=e,this._to=t,this},e.prototype.start=function(e,t,n,r){var i=this;if(void 0===e&&(e=!1),void 0===t&&(t=1),this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=e;for(var o=function(o){var s=a._scene.beginDirectAnimation(o.target,[o.animation],void 0!==n?n:a._from,void 0!==r?r:a._to,e,t);s.onAnimationEnd=function(){i.onAnimationEndObservable.notifyObservers(o),i._checkAnimationGroupEnded(s)},s.onAnimationLoop=function(){i.onAnimationLoopObservable.notifyObservers(o)},a._animatables.push(s)},a=this,s=0,l=this._targetedAnimations;s<l.length;s++)o(l[s]);if(this._speedRatio=t,void 0!==n&&void 0!==r)if(n<r&&this._speedRatio<0){var u=r;r=n,n=u}else n>r&&this._speedRatio>0&&(this._speedRatio=-t);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var e=0;e<this._animatables.length;e++)this._animatables[e].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this},e.prototype.play=function(e){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(void 0!==e&&(this.loopAnimation=e),this.restart()):(this.stop(),this.start(e,this._speedRatio)),this._isPaused=!1,this},e.prototype.reset=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++)this._animatables[e].reset();return this},e.prototype.restart=function(){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++)this._animatables[e].restart();return this.onAnimationGroupPlayObservable.notifyObservers(this),this},e.prototype.stop=function(){if(!this._isStarted)return this;for(var e=this._animatables.slice(),t=0;t<e.length;t++)e[t].stop();return this._isStarted=!1,this},e.prototype.setWeightForAllAnimatables=function(e){for(var t=0;t<this._animatables.length;t++)this._animatables[t].weight=e;return this},e.prototype.syncAllAnimationsWith=function(e){for(var t=0;t<this._animatables.length;t++)this._animatables[t].syncWith(e);return this},e.prototype.goToFrame=function(e){if(!this._isStarted)return this;for(var t=0;t<this._animatables.length;t++)this._animatables[t].goToFrame(e);return this},e.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var e=this._scene.animationGroups.indexOf(this);e>-1&&this._scene.animationGroups.splice(e,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear()},e.prototype._checkAnimationGroupEnded=function(e){var t=this._animatables.indexOf(e);t>-1&&this._animatables.splice(t,1),0===this._animatables.length&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},e.prototype.clone=function(t,n){for(var r=new e(t||this.name,this._scene),i=0,o=this._targetedAnimations;i<o.length;i++){var a=o[i];r.addTargetedAnimation(a.animation.clone(),n?n(a.target):a.target)}return r},e.Parse=function(t,n){for(var r=new e(t.name,n),i=0;i<t.targetedAnimations.length;i++){var o=t.targetedAnimations[i],a=B.Parse(o.animation),s=o.targetId;if("influence"===o.animation.property){var l=n.getMorphTargetById(s);l&&r.addTargetedAnimation(a,l)}else{var u=n.getNodeByID(s);null!=u&&r.addTargetedAnimation(a,u)}}return null!==t.from&&null!==t.from&&r.normalize(t.from,t.to),r},e.prototype.getClassName=function(){return"AnimationGroup"},e.prototype.toString=function(e){var t="Name: "+this.name;return t+=", type: "+this.getClassName(),e&&(t+=", from: "+this._from,t+=", to: "+this._to,t+=", isStarted: "+this._isStarted,t+=", speedRatio: "+this._speedRatio,t+=", targetedAnimations length: "+this._targetedAnimations.length,t+=", animatables length: "+this._animatables),t},e}(),J=function(){this.enableBlending=!1,this.blendingSpeed=.01,this.loopMode=B.ANIMATIONLOOPMODE_CYCLE},$=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return e.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(e){throw new Error("You must implement this method")},e.prototype.ease=function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},e.EASINGMODE_EASEIN=0,e.EASINGMODE_EASEOUT=1,e.EASINGMODE_EASEINOUT=2,e}(),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}($),te=function(e){function t(t){void 0===t&&(t=1);var n=e.call(this)||this;return n.amplitude=t,n}return u.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},t}($),ne=function(e){function t(t,n){void 0===t&&(t=3),void 0===n&&(n=2);var r=e.call(this)||this;return r.bounces=t,r.bounciness=n,r}return u.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),n=this.bounciness;n<=1&&(n=1.001);var r=Math.pow(n,t),i=1-n,o=(1-r)/i+.5*r,a=e*o,s=Math.log(-a*(1-n)+1)/Math.log(n),l=Math.floor(s),u=l+1,c=(1-Math.pow(n,l))/(i*o),h=.5*(c+(1-Math.pow(n,u))/(i*o)),d=e-h,f=h-c;return-Math.pow(1/n,t-l)/(f*f)*(d-f)*(d+f)},t}($),re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.easeInCore=function(e){return e*e*e},t}($),ie=function(e){function t(t,n){void 0===t&&(t=3),void 0===n&&(n=3);var r=e.call(this)||this;return r.oscillations=t,r.springiness=n,r}return u.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return(0==n?e:(Math.exp(n*e)-1)/(Math.exp(n)-1))*Math.sin((6.283185307179586*t+1.5707963267948966)*e)},t}($),oe=function(e){function t(t){void 0===t&&(t=2);var n=e.call(this)||this;return n.exponent=t,n}return u.d(t,e),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}($),ae=function(e){function t(t){void 0===t&&(t=2);var n=e.call(this)||this;return n.power=t,n}return u.d(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)},t}($),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.easeInCore=function(e){return e*e},t}($),le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.easeInCore=function(e){return e*e*e*e},t}($),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}($),ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}($),he=function(e){function t(t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=1);var o=e.call(this)||this;return o.x1=t,o.y1=n,o.x2=r,o.y2=i,o}return u.d(t,e),t.prototype.easeInCore=function(e){return o.d.Interpolate(e,this.x1,this.y1,this.x2,this.y2)},t}($),de=function(){function e(e,t,n){this.frame=e,this.action=t,this.onlyOnce=n,this.isDone=!1}return e.prototype._clone=function(){return new e(this.frame,this.action,this.onlyOnce)},e}(),fe=n(11),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t}(r.a),me=function(e){function t(t){var n=e.call(this)||this;return n.scene=t,n.sounds=[],n.effectLayers=[],n.layers=[],n.lensFlareSystems=[],n.proceduralTextures=[],n.reflectionProbes=[],n}return u.d(t,e),t.prototype.addAllToScene=function(){var e=this;this.cameras.forEach(function(t){e.scene.addCamera(t)}),this.lights.forEach(function(t){e.scene.addLight(t)}),this.meshes.forEach(function(t){e.scene.addMesh(t)}),this.skeletons.forEach(function(t){e.scene.addSkeleton(t)}),this.animations.forEach(function(t){e.scene.addAnimation(t)}),this.animationGroups.forEach(function(t){e.scene.addAnimationGroup(t)}),this.multiMaterials.forEach(function(t){e.scene.addMultiMaterial(t)}),this.materials.forEach(function(t){e.scene.addMaterial(t)}),this.morphTargetManagers.forEach(function(t){e.scene.addMorphTargetManager(t)}),this.geometries.forEach(function(t){e.scene.addGeometry(t)}),this.transformNodes.forEach(function(t){e.scene.addTransformNode(t)}),this.actionManagers.forEach(function(t){e.scene.addActionManager(t)}),this.textures.forEach(function(t){e.scene.addTexture(t)}),this.reflectionProbes.forEach(function(t){e.scene.addReflectionProbe(t)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var t=0,n=this.scene._serializableComponents;t<n.length;t++)n[t].addFromContainer(this)},t.prototype.removeAllFromScene=function(){var e=this;this.cameras.forEach(function(t){e.scene.removeCamera(t)}),this.lights.forEach(function(t){e.scene.removeLight(t)}),this.meshes.forEach(function(t){e.scene.removeMesh(t)}),this.skeletons.forEach(function(t){e.scene.removeSkeleton(t)}),this.animations.forEach(function(t){e.scene.removeAnimation(t)}),this.animationGroups.forEach(function(t){e.scene.removeAnimationGroup(t)}),this.multiMaterials.forEach(function(t){e.scene.removeMultiMaterial(t)}),this.materials.forEach(function(t){e.scene.removeMaterial(t)}),this.morphTargetManagers.forEach(function(t){e.scene.removeMorphTargetManager(t)}),this.geometries.forEach(function(t){e.scene.removeGeometry(t)}),this.transformNodes.forEach(function(t){e.scene.removeTransformNode(t)}),this.actionManagers.forEach(function(t){e.scene.removeActionManager(t)}),this.textures.forEach(function(t){e.scene.removeTexture(t)}),this.reflectionProbes.forEach(function(t){e.scene.removeReflectionProbe(t)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var t=0,n=this.scene._serializableComponents;t<n.length;t++)n[t].removeFromContainer(this)},t.prototype.dispose=function(){this.cameras.forEach(function(e){e.dispose()}),this.cameras=[],this.lights.forEach(function(e){e.dispose()}),this.lights=[],this.meshes.forEach(function(e){e.dispose()}),this.meshes=[],this.skeletons.forEach(function(e){e.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(e){e.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(e){e.dispose()}),this.multiMaterials=[],this.materials.forEach(function(e){e.dispose()}),this.materials=[],this.geometries.forEach(function(e){e.dispose()}),this.geometries=[],this.transformNodes.forEach(function(e){e.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(e){e.dispose()}),this.actionManagers=[],this.textures.forEach(function(e){e.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(e){e.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var e=0,t=this.scene._serializableComponents;e<t.length;e++)t[e].removeFromContainer(this,!0)},t.prototype._moveAssets=function(e,t,n){if(e)for(var r=0,i=e;r<i.length;r++){var o=i[r],a=!0;if(n)for(var s=0,l=n;s<l.length;s++)if(o===l[s]){a=!1;break}a&&t.push(o)}},t.prototype.moveAllFromScene=function(e){for(var t in void 0===e&&(e=new pe),this)this.hasOwnProperty(t)&&(this[t]=this[t]||[],this._moveAssets(this.scene[t],this[t],e[t]));this.removeAllFromScene()},t.prototype.createRootMesh=function(){var e=new fe.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(t){t.parent||e.addChild(t)}),this.meshes.unshift(e),e},t}(r.a),ge=n(10),_e=function(){function e(e){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=e,this._audioEngine=ge.b.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return e.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},e.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},e.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},e.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},e.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var n=0;n<this.getFrequencyBinCount();n++){var r=t[n]/this.BARGRAPHAMPLITUDE,i=this.DEBUGCANVASSIZE.height*r,o=this.DEBUGCANVASSIZE.height-i-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),s=n/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+s+", 100%, 50%)",this._debugCanvasContext.fillRect(n*a,o,a,i)}}},e.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},e.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},e.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},e}();ge.b.AudioEngineFactory=function(e){return new ve(e)};var ve=function(){function e(e){var t=this;void 0===e&&(e=null),this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!0,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new i.c,this.onAudioLockedObservable=new i.c,this._tryToRun=!1,this._onResize=function(){t._moveButtonToTopLeft()},void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var n=document.createElement("audio");this._hostElement=e;try{n&&n.canPlayType&&n.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(e){}try{n&&n.canPlayType&&n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}}return Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._audioContextInitialized?this.unlocked||this._muteButton||this._displayMuteButton():this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),e.prototype.lock=function(){this._triggerSuspendedState()},e.prototype.unlock=function(){this._triggerRunningState()},e.prototype._resumeAudioContext=function(){var e;return this._audioContext.resume&&(e=this._audioContext.resume()),e||Promise.resolve()},e.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(e){this.canUseWebAudio=!1,p.a.Error("Web Audio: "+e.message)}},e.prototype._triggerRunningState=function(){var e=this;this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then(function(){e._tryToRun=!1,e._muteButton&&e._hideMuteButton()}).catch(function(){e._tryToRun=!1,e.unlocked=!1}),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))},e.prototype._triggerSuspendedState=function(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()},e.prototype._displayMuteButton=function(){var e=this;if(!this.useCustomUnlockedButton&&!this._muteButton){this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";var t=document.createElement("style");t.appendChild(document.createTextNode(".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E);  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }")),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",function(){e._triggerRunningState()},!0),this._muteButton.addEventListener("click",function(){e._triggerRunningState()},!0),window.addEventListener("resize",this._onResize)}},e.prototype._moveButtonToTopLeft=function(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")},e.prototype._hideMuteButton=function(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)},e.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()},e.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},e.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},e.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},e}(),ye=n(9),be=n(19),Ee=function(){function e(t,n,r,a,s){var l=this;if(void 0===a&&(a=null),this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.onEndedObservable=new i.c,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=o.x.Zero(),this._positionInEmitterSpace=!1,this._localDirection=new o.x(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,this._scene=r,e._SceneComponentInitialization(r),this._readyToPlayCallback=a,this._customAttenuationFunction=function(e,t,n,r,i){return t<n?e*(1-t/n):0},s&&(this.autoplay=s.autoplay||!1,this.loop=s.loop||!1,void 0!==s.volume&&(this._volume=s.volume),this.spatialSound=s.spatialSound||!1,this.maxDistance=s.maxDistance||100,this.useCustomAttenuation=s.useCustomAttenuation||!1,this.rolloffFactor=s.rolloffFactor||1,this.refDistance=s.refDistance||1,this.distanceModel=s.distanceModel||"linear",this._playbackRate=s.playbackRate||1,this._streaming=s.streaming||!1),ge.b.audioEngine.canUseWebAudio&&ge.b.audioEngine.audioContext){this._soundGain=ge.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var u=!0;if(n)try{"string"==typeof n?this._urlType="String":n instanceof ArrayBuffer?this._urlType="ArrayBuffer":n instanceof MediaStream?this._urlType="MediaStream":Array.isArray(n)&&(this._urlType="Array");var c=[],h=!1;switch(this._urlType){case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=ge.b.audioEngine.audioContext.createMediaStreamSource(n),this.autoplay&&this.play(),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":n.byteLength>0&&(h=!0,this._soundLoaded(n));break;case"String":c.push(n);case"Array":0===c.length&&(c=n);for(var d=0;d<c.length;d++){var f=c[d];if(-1!==f.indexOf(".mp3",f.length-4)&&ge.b.audioEngine.isMP3supported&&(h=!0),-1!==f.indexOf(".ogg",f.length-4)&&ge.b.audioEngine.isOGGsupported&&(h=!0),-1!==f.indexOf(".wav",f.length-4)&&(h=!0),-1!==f.indexOf("blob:")&&(h=!0),h){this._streaming?(this._htmlAudioElement=new Audio(f),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,ye.h.SetCorsBehavior(f,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){l._isReadyToPlay=!0,l.autoplay&&l.play(),l._readyToPlayCallback&&l._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(f,function(e){l._soundLoaded(e)},void 0,!0,!0,function(e){e&&p.a.Error("XHR "+e.status+" error on: "+f+"."),p.a.Error("Sound creation aborted."),l._scene.mainSoundTrack.RemoveSound(l)});break}}break;default:u=!1}u?h||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){l._readyToPlayCallback&&l._readyToPlayCallback()},1e3)):p.a.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){p.a.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.RemoveSound(this)}}else this._scene.mainSoundTrack.AddSound(this),ge.b.audioEngine.WarnedWebAudioUnsupported||(p.a.Error("Web Audio is not supported by your browser."),ge.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){l._readyToPlayCallback&&l._readyToPlayCallback()},1e3)}return e.prototype.dispose=function(){ge.b.audioEngine.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._streamingSource&&this._streamingSource.disconnect(),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null))},e.prototype.isReady=function(){return this._isReadyToPlay},e.prototype._soundLoaded=function(e){var t=this;ge.b.audioEngine.audioContext&&ge.b.audioEngine.audioContext.decodeAudioData(e,function(e){t._audioBuffer=e,t._isReadyToPlay=!0,t.autoplay&&t.play(),t._readyToPlayCallback&&t._readyToPlayCallback()},function(e){p.a.Error("Error while decoding audio data for: "+t.name+" / Error: "+e)})},e.prototype.setAudioBuffer=function(e){ge.b.audioEngine.canUseWebAudio&&(this._audioBuffer=e,this._isReadyToPlay=!0)},e.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},e.prototype._createSpatialParameters=function(){ge.b.audioEngine.canUseWebAudio&&ge.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=ge.b.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner)},e.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},e.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},e.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},e.prototype._switchPanningModel=function(){ge.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},e.prototype.connectToSoundTrackAudioNode=function(e){ge.b.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(e),this._isOutputConnected=!0)},e.prototype.setDirectionalCone=function(e,t,n){t<e?p.a.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=e,this._coneOuterAngle=t,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play()))},Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(e){if(e!=this._coneInnerAngle){if(this._coneOuterAngle<e)return void p.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e,ge.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(e){if(e!=this._coneOuterAngle){if(e<this._coneInnerAngle)return void p.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e,ge.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(e){this._position=e,ge.b.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},e.prototype.setLocalDirectionToMesh=function(e){this._localDirection=e,ge.b.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()},e.prototype._updateDirection=function(){if(this._connectedTransformNode&&this._soundPanner){var e=this._connectedTransformNode.getWorldMatrix(),t=o.x.TransformNormal(this._localDirection,e);t.normalize(),this._soundPanner.setOrientation(t.x,t.y,t.z)}},e.prototype.updateDistanceFromListener=function(){if(ge.b.audioEngine.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var e=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,e,this.maxDistance,this.refDistance,this.rolloffFactor)}},e.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},e.prototype.play=function(e,t){var n=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&ge.b.audioEngine.audioContext)try{this._startOffset<0&&(e=-this._startOffset,this._startOffset=0);var r=e?ge.b.audioEngine.audioContext.currentTime+e:ge.b.audioEngine.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming)this._streamingSource||(this._streamingSource=ge.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){n._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement&&(i=function(){if(ge.b.audioEngine.unlocked){var e=n._htmlAudioElement.play();void 0!==e&&e.catch(function(e){ge.b.audioEngine.lock(),(n.loop||n.autoplay)&&ge.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){i()})})}else(n.loop||n.autoplay)&&ge.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){i()})})();else{var i=function(){ge.b.audioEngine.audioContext&&(n._soundSource=ge.b.audioEngine.audioContext.createBufferSource(),n._soundSource.buffer=n._audioBuffer,n._soundSource.connect(n._inputAudioNode),n._soundSource.loop=n.loop,n._soundSource.playbackRate.value=n._playbackRate,n._soundSource.onended=function(){n._onended()},r=e?ge.b.audioEngine.audioContext.currentTime+e:ge.b.audioEngine.audioContext.currentTime,n._soundSource.start(r,n.isPaused?n._startOffset%n._soundSource.buffer.duration:t||0))};"suspended"===ge.b.audioEngine.audioContext.state?setTimeout(function(){"suspended"===ge.b.audioEngine.audioContext.state?(ge.b.audioEngine.lock(),(n.loop||n.autoplay)&&ge.b.audioEngine.onAudioUnlockedObservable.addOnce(function(){i()})):i()},500):i()}this._startTime=r,this.isPlaying=!0,this.isPaused=!1}catch(e){p.a.Error("Error while trying to play audio: "+this.name+", "+e.message)}},e.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)},e.prototype.stop=function(e){var t=this;if(this.isPlaying)if(this._streaming)this._htmlAudioElement?(this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0)):this._streamingSource.disconnect(),this.isPlaying=!1;else if(ge.b.audioEngine.audioContext&&this._soundSource){var n=e?ge.b.audioEngine.audioContext.currentTime+e:ge.b.audioEngine.audioContext.currentTime;this._soundSource.stop(n),this._soundSource.onended=function(){t.isPlaying=!1},this.isPaused||(this._startOffset=0)}},e.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement?this._htmlAudioElement.pause():this._streamingSource.disconnect():ge.b.audioEngine.audioContext&&(this.stop(0),this._startOffset+=ge.b.audioEngine.audioContext.currentTime-this._startTime))},e.prototype.setVolume=function(e,t){ge.b.audioEngine.canUseWebAudio&&this._soundGain&&(t&&ge.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(ge.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,ge.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(e,ge.b.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=e),this._volume=e},e.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},e.prototype.getVolume=function(){return this._volume},e.prototype.attachToMesh=function(e){var t=this;this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)},e.prototype.detachFromMesh=function(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)},e.prototype._onRegisterAfterWorldMatrixUpdate=function(e){if(e.getBoundingInfo){var t=e;if(this._positionInEmitterSpace)t.worldMatrixFromCache.invertToRef(o.t.Matrix[0]),this.setPosition(o.t.Matrix[0].getTranslation());else{var n=t.getBoundingInfo();this.setPosition(n.boundingSphere.centerWorld)}ge.b.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},e.prototype.clone=function(){var t=this;if(this._streaming)return null;var n={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},r=new e(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,n);return this.useCustomAttenuation&&r.setAttenuationFunction(this._customAttenuationFunction),r.setPosition(this._position),r.setPlaybackRate(this._playbackRate),function e(){t._isReadyToPlay?(r._audioBuffer=t.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play()):window.setTimeout(e,300)}(),r},e.prototype.getAudioBuffer=function(){return this._audioBuffer},e.prototype.serialize=function(){var e={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedTransformNode&&(e.connectedMeshId=this._connectedTransformNode.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e},e.Parse=function(t,n,r,i){var a,s=t.name;a=t.url?r+t.url:r+s;var l,u={autoplay:t.autoplay,loop:t.loop,volume:t.volume,spatialSound:t.spatialSound,maxDistance:t.maxDistance,rolloffFactor:t.rolloffFactor,refDistance:t.refDistance,distanceModel:t.distanceModel,playbackRate:t.playbackRate};if(i?(l=new e(s,new ArrayBuffer(0),n,null,u),function e(){i._isReadyToPlay?(l._audioBuffer=i.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play()):window.setTimeout(e,300)}()):(l=new e(s,a,n,function(){n._removePendingData(l)},u),n._addPendingData(l)),t.position){var c=o.x.FromArray(t.position);l.setPosition(c)}if(t.isDirectional&&(l.setDirectionalCone(t.coneInnerAngle||360,t.coneOuterAngle||360,t.coneOuterGain||0),t.localDirectionToMesh)){var h=o.x.FromArray(t.localDirectionToMesh);l.setLocalDirectionToMesh(h)}if(t.connectedMeshId){var d=n.getMeshByID(t.connectedMeshId);d&&l.attachToMesh(d)}return l},e._SceneComponentInitialization=function(e){throw be.a.WarnImport("AudioSceneComponent")},e}(),xe=function(){function e(e,t){void 0===t&&(t={}),this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=e,this.soundCollection=new Array,this._options=t,!this._isMainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return e.prototype._initializeSoundTrackAudioGraph=function(){ge.b.audioEngine.canUseWebAudio&&ge.b.audioEngine.audioContext&&(this._outputAudioNode=ge.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(ge.b.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},e.prototype.dispose=function(){if(ge.b.audioEngine&&ge.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},e.prototype.AddSound=function(e){this._isInitialized||this._initializeSoundTrackAudioGraph(),ge.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&e.connectToSoundTrackAudioNode(this._outputAudioNode),e.soundTrackId&&(-1===e.soundTrackId?this._scene.mainSoundTrack.RemoveSound(e):this._scene.soundTracks&&this._scene.soundTracks[e.soundTrackId].RemoveSound(e)),this.soundCollection.push(e),e.soundTrackId=this.id},e.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},e.prototype.setVolume=function(e){ge.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=e)},e.prototype.switchPanningModelToHRTF=function(){if(ge.b.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToHRTF()},e.prototype.switchPanningModelToEqualPower=function(){if(ge.b.audioEngine.canUseWebAudio)for(var e=0;e<this.soundCollection.length;e++)this.soundCollection[e].switchPanningModelToEqualPower()},e.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=e,ge.b.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,ge.b.audioEngine.masterGain))},e}(),Te=n(14);r.a.AddParser(Te.a.NAME_AUDIO,function(e,t,n,r){var i,o=[];if(n.sounds=n.sounds||[],void 0!==e.sounds&&null!==e.sounds)for(var a=0,s=e.sounds.length;a<s;a++){var l=e.sounds[a];ge.b.audioEngine.canUseWebAudio?(l.url||(l.url=l.name),o[l.url]?n.sounds.push(Ee.Parse(l,t,r,o[l.url])):(i=Ee.Parse(l,t,r),o[l.url]=i,n.sounds.push(i))):n.sounds.push(new Ee(l.name,null,t))}o=[]}),Object.defineProperty(W.a.prototype,"mainSoundTrack",{get:function(){var e=this._getComponent(Te.a.NAME_AUDIO);return e||(e=new Se(this),this._addComponent(e)),this._mainSoundTrack||(this._mainSoundTrack=new xe(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),W.a.prototype.getSoundByName=function(e){var t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===e)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks)for(var n=0;n<this.soundTracks.length;n++)for(t=0;t<this.soundTracks[n].soundCollection.length;t++)if(this.soundTracks[n].soundCollection[t].name===e)return this.soundTracks[n].soundCollection[t];return null},Object.defineProperty(W.a.prototype,"audioEnabled",{get:function(){var e=this._getComponent(Te.a.NAME_AUDIO);return e||(e=new Se(this),this._addComponent(e)),e.audioEnabled},set:function(e){var t=this._getComponent(Te.a.NAME_AUDIO);t||(t=new Se(this),this._addComponent(t)),e?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(W.a.prototype,"headphone",{get:function(){var e=this._getComponent(Te.a.NAME_AUDIO);return e||(e=new Se(this),this._addComponent(e)),e.headphone},set:function(e){var t=this._getComponent(Te.a.NAME_AUDIO);t||(t=new Se(this),this._addComponent(t)),e?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0});var Se=function(){function e(e){this.name=Te.a.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.scene=e,e.soundTracks=new Array,e.sounds=new Array}return Object.defineProperty(e.prototype,"audioEnabled",{get:function(){return this._audioEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headphone",{get:function(){return this._headphone},enumerable:!0,configurable:!0}),e.prototype.register=function(){this.scene._afterRenderStage.registerStep(Te.a.STEP_AFTERRENDER_AUDIO,this,this._afterRender)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){if(e.sounds=[],this.scene.soundTracks)for(var t=0;t<this.scene.soundTracks.length;t++)for(var n=this.scene.soundTracks[t],r=0;r<n.soundCollection.length;r++)e.sounds.push(n.soundCollection[r].serialize())},e.prototype.addFromContainer=function(e){var t=this;e.sounds&&e.sounds.forEach(function(e){e.play(),e.autoplay=!0,t.scene.mainSoundTrack.AddSound(e)})},e.prototype.removeFromContainer=function(e,t){var n=this;void 0===t&&(t=!1),e.sounds&&e.sounds.forEach(function(e){e.stop(),e.autoplay=!1,n.scene.mainSoundTrack.RemoveSound(e),t&&e.dispose()})},e.prototype.dispose=function(){var e=this.scene;if(e._mainSoundTrack&&e.mainSoundTrack.dispose(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].dispose()},e.prototype.disableAudio=function(){var e,t=this.scene;for(this._audioEnabled=!1,e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].pause();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(var n=0;n<t.soundTracks[e].soundCollection.length;n++)t.soundTracks[e].soundCollection[n].pause()},e.prototype.enableAudio=function(){var e,t=this.scene;for(this._audioEnabled=!0,e=0;e<t.mainSoundTrack.soundCollection.length;e++)t.mainSoundTrack.soundCollection[e].isPaused&&t.mainSoundTrack.soundCollection[e].play();if(t.soundTracks)for(e=0;e<t.soundTracks.length;e++)for(var n=0;n<t.soundTracks[e].soundCollection.length;n++)t.soundTracks[e].soundCollection[n].isPaused&&t.soundTracks[e].soundCollection[n].play()},e.prototype.switchAudioModeForHeadphones=function(){var e=this.scene;if(this._headphone=!0,e.mainSoundTrack.switchPanningModelToHRTF(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToHRTF()},e.prototype.switchAudioModeForNormalSpeakers=function(){var e=this.scene;if(this._headphone=!1,e.mainSoundTrack.switchPanningModelToEqualPower(),e.soundTracks)for(var t=0;t<e.soundTracks.length;t++)e.soundTracks[t].switchPanningModelToEqualPower()},e.prototype._afterRender=function(){var e=this.scene;if(this._audioEnabled&&e._mainSoundTrack&&e.soundTracks&&(0!==e._mainSoundTrack.soundCollection.length||1!==e.soundTracks.length)){var t,n=ge.b.audioEngine;if((t=e.activeCameras.length>0?e.activeCameras[0]:e.activeCamera)&&n.audioContext){n.audioContext.listener.setPosition(t.position.x,t.position.y,t.position.z),t.rigCameras&&t.rigCameras.length>0&&(t=t.rigCameras[0]);var r,i=o.j.Invert(t.getViewMatrix()),a=o.x.TransformNormal(new o.x(0,0,-1),i);for(a.normalize(),isNaN(a.x)||isNaN(a.y)||isNaN(a.z)||n.audioContext.listener.setOrientation(a.x,a.y,a.z,0,1,0),r=0;r<e.mainSoundTrack.soundCollection.length;r++){var s=e.mainSoundTrack.soundCollection[r];s.useCustomAttenuation&&s.updateDistanceFromListener()}if(e.soundTracks)for(r=0;r<e.soundTracks.length;r++)for(var l=0;l<e.soundTracks[r].soundCollection.length;l++)(s=e.soundTracks[r].soundCollection[l]).useCustomAttenuation&&s.updateDistanceFromListener()}}},e}();Ee._SceneComponentInitialization=function(e){var t=e._getComponent(Te.a.NAME_AUDIO);t||(t=new Se(e),e._addComponent(t))};var Ae=function(){function e(e,t,n){var r=this;if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=e,this._weights=n;for(var i=0,o=0,a=n;o<a.length;o++)i+=a[o];for(var s=i>0?1/i:0,l=0;l<this._weights.length;l++)this._weights[l]*=s;this._sounds=t;for(var u=0,c=this._sounds;u<c.length;u++)c[u].onEndedObservable.add(function(){r._onended()})}return Object.defineProperty(e.prototype,"directionalConeInnerAngle",{get:function(){return this._coneInnerAngle},set:function(e){if(e!==this._coneInnerAngle){if(this._coneOuterAngle<e)return void p.a.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=e;for(var t=0,n=this._sounds;t<n.length;t++)n[t].directionalConeInnerAngle=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"directionalConeOuterAngle",{get:function(){return this._coneOuterAngle},set:function(e){if(e!==this._coneOuterAngle){if(e<this._coneInnerAngle)return void p.a.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=e;for(var t=0,n=this._sounds;t<n.length;t++)n[t].directionalConeOuterAngle=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){if(e!==this._volume)for(var t=0,n=this._sounds;t<n.length;t++)n[t].setVolume(e)},enumerable:!0,configurable:!0}),e.prototype._onended=function(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1},e.prototype.pause=function(){this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause()},e.prototype.stop=function(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()},e.prototype.play=function(e){if(!this.isPaused){this.stop();for(var t=Math.random(),n=0,r=0;r<this._weights.length;r++)if(t<=(n+=this._weights[r])){this._currentIndex=r;break}}var i=this._sounds[this._currentIndex];i.isReady()?i.play(0,this.isPaused?void 0:e):i.autoplay=!0,this.isPlaying=!0,this.isPaused=!1},e}(),Pe=n(17),Me=function(){function e(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(e.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){var t=this;this._attachedCamera=e;var n=this._attachedCamera.getScene();this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(e){e.type!==Pe.a.POINTERDOWN?e.type===Pe.a.POINTERUP&&(t._isPointerDown=!1):t._isPointerDown=!0}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){var e=X.a.Now,n=0;null!=t._lastFrameTime&&(n=e-t._lastFrameTime),t._lastFrameTime=e,t._applyUserInteraction();var r=e-t._lastInteractionTime-t._idleRotationWaitTime,i=Math.max(Math.min(r/t._idleRotationSpinupTime,1),0);t._cameraRotationSpeed=t._idleRotationSpeed*i,t._attachedCamera&&(t._attachedCamera.alpha-=t._cameraRotationSpeed*(n/1e3))})},e.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},e.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},e.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},e.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=X.a.Now)},e.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},e}(),Re=function(){function e(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(e.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var n=this._attachedCamera;n&&(e?this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add(function(e){if(e){e.computeWorldMatrix(!0);var n=e.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*n,t.upperRadiusTransitionRange=.05*n}}):this._onMeshTargetChangedObserver&&n.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},e.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},e.prototype._isRadiusAtLimit=function(e){return!!this._attachedCamera&&this._attachedCamera.radius===e&&!this._radiusIsAnimating},e.prototype._applyBoundRadiusAnimation=function(t){var n=this;if(this._attachedCamera){this._radiusBounceTransition||(e.EasingFunction.setEasingMode(e.EasingMode),this._radiusBounceTransition=B.CreateAnimation("radius",B.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var r=B.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return n._clearAnimationLocks()});r&&this._animatables.push(r)}},e.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},e.EasingFunction=new te(.3),e.EasingMode=$.EASINGMODE_EASEOUT,e}(),Ce=function(){function e(){this._mode=e.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(t){var n=this;this._attachedCamera=t;var r=this._attachedCamera.getScene();e.EasingFunction.setEasingMode(e.EasingMode),this._onPrePointerObservableObserver=r.onPrePointerObservable.add(function(e){e.type!==Pe.a.POINTERDOWN?e.type===Pe.a.POINTERUP&&(n._isPointerDown=!1):n._isPointerDown=!0}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(e){e&&n.zoomOnMesh(e)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){n._applyUserInteraction(),n._maintainCameraAboveGround()})},e.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},e.prototype.zoomOnMesh=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,t,n)},e.prototype.zoomOnMeshHierarchy=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null),e.computeWorldMatrix(!0);var r=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,t,n)},e.prototype.zoomOnMeshesHierarchy=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null);for(var r=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new o.x(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=0;a<e.length;a++){var s=e[a].getHierarchyBoundingVectors(!0);ye.h.CheckExtends(s.min,r,i),ye.h.CheckExtends(s.max,r,i)}this.zoomOnBoundingInfo(r,i,t,n)},e.prototype.zoomOnBoundingInfo=function(t,n,r,i){var a,s=this;if(void 0===r&&(r=!1),void 0===i&&(i=null),this._attachedCamera){var l=t.y,u=l+(n.y-l)*this._positionScale,c=n.subtract(t).scale(.5);if(r)a=new o.x(0,u,0);else{var h=t.add(c);a=new o.x(h.x,u,h.z)}this._vectorTransition||(this._vectorTransition=B.CreateAnimation("target",B.ANIMATIONTYPE_VECTOR3,60,e.EasingFunction)),this._betaIsAnimating=!0;var d=B.TransitionTo("target",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);d&&this._animatables.push(d);var f=0;if(this._mode===e.FitFrustumSidesMode){var p=this._calculateLowerRadiusFromModelBoundingSphere(t,n);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=c.length()+this._attachedCamera.minZ),f=p}else this._mode===e.IgnoreBoundsSizeMode&&(f=this._calculateLowerRadiusFromModelBoundingSphere(t,n),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var m=n.subtract(t).length();this._attachedCamera.panningSensibility=5e3/m,this._attachedCamera.wheelPrecision=100/f}this._radiusTransition||(this._radiusTransition=B.CreateAnimation("radius",B.ANIMATIONTYPE_FLOAT,60,e.EasingFunction)),(d=B.TransitionTo("radius",f,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){s.stopAllAnimations(),i&&i(),s._attachedCamera&&s._attachedCamera.useInputToRestoreState&&s._attachedCamera.storeState()}))&&this._animatables.push(d)}},e.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,n){var r=n.subtract(t).length(),i=this._getFrustumSlope(),o=.5*r*this._radiusScale,a=o*Math.sqrt(1+1/(i.x*i.x)),s=o*Math.sqrt(1+1/(i.y*i.y)),l=Math.max(a,s),u=this._attachedCamera;return u?(u.lowerRadiusLimit&&this._mode===e.IgnoreBoundsSizeMode&&(l=l<u.lowerRadiusLimit?u.lowerRadiusLimit:l),u.upperRadiusLimit&&(l=l>u.upperRadiusLimit?u.upperRadiusLimit:l),l):0},e.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var n=X.a.Now-this._lastInteractionTime,r=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&n>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=B.CreateAnimation("beta",B.ANIMATIONTYPE_FLOAT,60,e.EasingFunction));var o=B.TransitionTo("beta",r,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});o&&this._animatables.push(o)}}},e.prototype._getFrustumSlope=function(){var e=this._attachedCamera;if(!e)return o.w.Zero();var t=e.getScene().getEngine().getAspectRatio(e),n=Math.tan(e.fov/2),r=n*t;return new o.w(r,n)},e.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},e.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=X.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},e.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(e.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),e.EasingFunction=new oe,e.EasingMode=$.EASINGMODE_EASEINOUT,e.IgnoreBoundsSizeMode=0,e.FitFrustumSidesMode=1,e}(),we=function(e,t,n,r){void 0===t&&(t=new o.x),void 0===n&&(n=0),void 0===r&&(r=!1),this.direction=e,this.rotatedDirection=t,this.diff=n,this.ignore=r},Oe=function(){function e(e){this.ui=e,this.name="AttachToBoxBehavior",this.distanceAwayFromFace=.15,this.distanceAwayFromBottomOfFace=.15,this._faceVectors=[new we(o.x.Up()),new we(o.x.Down()),new we(o.x.Left()),new we(o.x.Right()),new we(o.x.Forward()),new we(o.x.Forward().scaleInPlace(-1))],this._tmpMatrix=new o.j,this._tmpVector=new o.x,this._zeroVector=o.x.Zero(),this._lookAtTmpMatrix=new o.j}return e.prototype.init=function(){},e.prototype._closestFace=function(e){var t=this;return this._faceVectors.forEach(function(n){t._target.rotationQuaternion||(t._target.rotationQuaternion=o.q.RotationYawPitchRoll(t._target.rotation.y,t._target.rotation.x,t._target.rotation.z)),t._target.rotationQuaternion.toRotationMatrix(t._tmpMatrix),o.x.TransformCoordinatesToRef(n.direction,t._tmpMatrix,n.rotatedDirection),n.diff=o.x.GetAngleBetweenVectors(n.rotatedDirection,e,o.x.Cross(n.rotatedDirection,e))}),this._faceVectors.reduce(function(e,t){return e.ignore?t:t.ignore?e:e.diff<t.diff?e:t},this._faceVectors[0])},e.prototype._lookAtToRef=function(e,t,n){void 0===t&&(t=new o.x(0,1,0)),o.j.LookAtLHToRef(this._zeroVector,e,t,this._lookAtTmpMatrix),this._lookAtTmpMatrix.invert(),o.q.FromRotationMatrixToRef(this._lookAtTmpMatrix,n)},e.prototype.attach=function(e){var t=this;this._target=e,this._scene=this._target.getScene(),this._onRenderObserver=this._scene.onBeforeRenderObservable.add(function(){if(t._scene.activeCamera){var n=t._scene.activeCamera.position;t._scene.activeCamera.devicePosition&&(n=t._scene.activeCamera.devicePosition);var r=t._closestFace(n.subtract(e.position));t._scene.activeCamera.leftCamera?t._scene.activeCamera.leftCamera.computeWorldMatrix().getRotationMatrixToRef(t._tmpMatrix):t._scene.activeCamera.computeWorldMatrix().getRotationMatrixToRef(t._tmpMatrix),o.x.TransformCoordinatesToRef(o.x.Up(),t._tmpMatrix,t._tmpVector),t._faceVectors.forEach(function(e){r.direction.x&&e.direction.x&&(e.ignore=!0),r.direction.y&&e.direction.y&&(e.ignore=!0),r.direction.z&&e.direction.z&&(e.ignore=!0)});var i=t._closestFace(t._tmpVector);t._faceVectors.forEach(function(e){e.ignore=!1}),t.ui.position.copyFrom(e.position),r.direction.x&&(r.rotatedDirection.scaleToRef(e.scaling.x/2+t.distanceAwayFromFace,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)),r.direction.y&&(r.rotatedDirection.scaleToRef(e.scaling.y/2+t.distanceAwayFromFace,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)),r.direction.z&&(r.rotatedDirection.scaleToRef(e.scaling.z/2+t.distanceAwayFromFace,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)),t.ui.rotationQuaternion||(t.ui.rotationQuaternion=o.q.RotationYawPitchRoll(t.ui.rotation.y,t.ui.rotation.x,t.ui.rotation.z)),r.rotatedDirection.scaleToRef(-1,t._tmpVector),t._lookAtToRef(t._tmpVector,i.rotatedDirection,t.ui.rotationQuaternion),i.direction.x&&t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace-e.scaling.x/2,t._tmpVector),i.direction.y&&t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace-e.scaling.y/2,t._tmpVector),i.direction.z&&t.ui.up.scaleToRef(t.distanceAwayFromBottomOfFace-e.scaling.z/2,t._tmpVector),t.ui.position.addInPlace(t._tmpVector)}})},e.prototype.detach=function(){this._scene.onBeforeRenderObservable.remove(this._onRenderObserver)},e}(),Ie=function(){function e(){var e=this;this.delay=0,this.fadeInTime=300,this._millisecondsPerFrame=1e3/60,this._hovered=!1,this._hoverValue=0,this._ownerNode=null,this._update=function(){if(e._ownerNode){if(e._hoverValue+=e._hovered?e._millisecondsPerFrame:-e._millisecondsPerFrame,e._setAllVisibility(e._ownerNode,(e._hoverValue-e.delay)/e.fadeInTime),e._ownerNode.visibility>1)return e._setAllVisibility(e._ownerNode,1),void(e._hoverValue=e.fadeInTime+e.delay);if(e._ownerNode.visibility<0&&(e._setAllVisibility(e._ownerNode,0),e._hoverValue<0))return void(e._hoverValue=0);setTimeout(e._update,e._millisecondsPerFrame)}}}return Object.defineProperty(e.prototype,"name",{get:function(){return"FadeInOut"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e){this._ownerNode=e,this._setAllVisibility(this._ownerNode,0)},e.prototype.detach=function(){this._ownerNode=null},e.prototype.fadeIn=function(e){this._hovered=e,this._update()},e.prototype._setAllVisibility=function(e,t){var n=this;e.visibility=t,e.getChildMeshes().forEach(function(e){n._setAllVisibility(e,t)})},e}(),De=n(54),Le=function(){function e(){this._startDistance=0,this._initialScale=new o.x(0,0,0),this._targetScale=new o.x(0,0,0),this._sceneRenderObserver=null,this._dragBehaviorA=new De.a({}),this._dragBehaviorA.moveAttached=!1,this._dragBehaviorB=new De.a({}),this._dragBehaviorB.moveAttached=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return"MultiPointerScale"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype._getCurrentDistance=function(){return this._dragBehaviorA.lastDragPosition.subtract(this._dragBehaviorB.lastDragPosition).length()},e.prototype.attach=function(e){var t=this;this._ownerNode=e,this._dragBehaviorA.onDragStartObservable.add(function(n){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerID==t._dragBehaviorB.currentDraggingPointerID?t._dragBehaviorA.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))}),this._dragBehaviorB.onDragStartObservable.add(function(n){t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging&&(t._dragBehaviorA.currentDraggingPointerID==t._dragBehaviorB.currentDraggingPointerID?t._dragBehaviorB.releaseDrag():(t._initialScale.copyFrom(e.scaling),t._startDistance=t._getCurrentDistance()))}),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(e){e.onDragObservable.add(function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var e=t._getCurrentDistance()/t._startDistance;t._initialScale.scaleToRef(e,t._targetScale)}})}),e.addBehavior(this._dragBehaviorA),e.addBehavior(this._dragBehaviorB),this._sceneRenderObserver=e.getScene().onBeforeRenderObservable.add(function(){if(t._dragBehaviorA.dragging&&t._dragBehaviorB.dragging){var n=t._targetScale.subtract(e.scaling).scaleInPlace(.1);n.length()>.01&&e.scaling.addInPlace(n)}})},e.prototype.detach=function(){var e=this;this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),[this._dragBehaviorA,this._dragBehaviorB].forEach(function(t){t.onDragStartObservable.clear(),t.onDragObservable.clear(),e._ownerNode.removeBehavior(t)})},e}(),Fe=n(24),Ne=n(21),Be=n(45),Ue=function(){function e(){this._sceneRenderObserver=null,this._targetPosition=new o.x(0,0,0),this._moving=!1,this._startingOrientation=new o.q,this.zDragFactor=3,this.rotateDraggedObject=!0,this.dragging=!1,this.dragDeltaRatio=.2,this.currentDraggingPointerID=-1,this.detachCameraControls=!0,this.onDragStartObservable=new i.c,this.onDragEndObservable=new i.c}return Object.defineProperty(e.prototype,"name",{get:function(){return"SixDofDrag"},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(t){var n=this;this._ownerNode=t,this._scene=this._ownerNode.getScene(),e._virtualScene||(e._virtualScene=new W.a(this._scene.getEngine()),e._virtualScene.detachControl(),this._scene.getEngine().scenes.pop());var r=null,i=new o.x(0,0,0);this._virtualOriginMesh=new Fe.a("",e._virtualScene),this._virtualOriginMesh.rotationQuaternion=new o.q,this._virtualDragMesh=new Fe.a("",e._virtualScene),this._virtualDragMesh.rotationQuaternion=new o.q;var a=null;this._pointerObserver=this._scene.onPointerObservable.add(function(e,t){if(e.type==Pe.a.POINTERDOWN){if(!n.dragging&&e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh&&e.pickInfo.ray&&(h=e.pickInfo.pickedMesh,n._ownerNode==h||h.isDescendantOf(n._ownerNode))){n._scene.activeCamera&&n._scene.activeCamera.cameraRigMode==Ne.a.RIG_MODE_NONE&&e.pickInfo.ray.origin.copyFrom(n._scene.activeCamera.globalPosition),r=n._ownerNode,Be.a._RemoveAndStorePivotPoint(r),i.copyFrom(e.pickInfo.ray.origin),n._virtualOriginMesh.position.copyFrom(e.pickInfo.ray.origin),n._virtualOriginMesh.lookAt(e.pickInfo.ray.origin.add(e.pickInfo.ray.direction)),n._virtualOriginMesh.removeChild(n._virtualDragMesh),r.computeWorldMatrix(),n._virtualDragMesh.position.copyFrom(r.absolutePosition),r.rotationQuaternion||(r.rotationQuaternion=o.q.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z));var s=r.parent;r.setParent(null),n._virtualDragMesh.rotationQuaternion.copyFrom(r.rotationQuaternion),r.setParent(s),n._virtualOriginMesh.addChild(n._virtualDragMesh),n._targetPosition.copyFrom(n._virtualDragMesh.absolutePosition),n.dragging=!0,n.currentDraggingPointerID=e.event.pointerId,n.detachCameraControls&&n._scene.activeCamera&&!n._scene.activeCamera.leftCamera&&(n._scene.activeCamera.inputs.attachedElement?(a=n._scene.activeCamera.inputs.attachedElement,n._scene.activeCamera.detachControl(n._scene.activeCamera.inputs.attachedElement)):a=null),Be.a._RestorePivotPoint(r),n.onDragStartObservable.notifyObservers({})}}else if(e.type==Pe.a.POINTERUP)n.currentDraggingPointerID==e.event.pointerId&&(n.dragging=!1,n._moving=!1,n.currentDraggingPointerID=-1,r=null,n._virtualOriginMesh.removeChild(n._virtualDragMesh),n.detachCameraControls&&a&&n._scene.activeCamera&&!n._scene.activeCamera.leftCamera&&n._scene.activeCamera.attachControl(a,!0),n.onDragEndObservable.notifyObservers({}));else if(e.type==Pe.a.POINTERMOVE&&n.currentDraggingPointerID==e.event.pointerId&&n.dragging&&e.pickInfo&&e.pickInfo.ray&&r){var l=n.zDragFactor;n._scene.activeCamera&&n._scene.activeCamera.cameraRigMode==Ne.a.RIG_MODE_NONE&&(e.pickInfo.ray.origin.copyFrom(n._scene.activeCamera.globalPosition),l=0);var u=e.pickInfo.ray.origin.subtract(i);i.copyFrom(e.pickInfo.ray.origin);var c=-o.x.Dot(u,e.pickInfo.ray.direction);n._virtualOriginMesh.addChild(n._virtualDragMesh),n._virtualDragMesh.position.z-=n._virtualDragMesh.position.z<1?c*n.zDragFactor:c*l*n._virtualDragMesh.position.z,n._virtualDragMesh.position.z<0&&(n._virtualDragMesh.position.z=0),n._virtualOriginMesh.position.copyFrom(e.pickInfo.ray.origin),n._virtualOriginMesh.lookAt(e.pickInfo.ray.origin.add(e.pickInfo.ray.direction)),n._virtualOriginMesh.removeChild(n._virtualDragMesh),n._targetPosition.copyFrom(n._virtualDragMesh.absolutePosition),r.parent&&o.x.TransformCoordinatesToRef(n._targetPosition,o.j.Invert(r.parent.getWorldMatrix()),n._targetPosition),n._moving||n._startingOrientation.copyFrom(n._virtualDragMesh.rotationQuaternion),n._moving=!0}var h});var s=new o.q;this._sceneRenderObserver=t.getScene().onBeforeRenderObservable.add(function(){if(n.dragging&&n._moving&&r){if(Be.a._RemoveAndStorePivotPoint(r),r.position.addInPlace(n._targetPosition.subtract(r.position).scale(n.dragDeltaRatio)),n.rotateDraggedObject){s.copyFrom(n._startingOrientation),s.x=-s.x,s.y=-s.y,s.z=-s.z,n._virtualDragMesh.rotationQuaternion.multiplyToRef(s,s),o.q.RotationYawPitchRollToRef(s.toEulerAngles("xyz").y,0,0,s),s.multiplyToRef(n._startingOrientation,s);var e=r.parent;(!e||e.scaling&&!e.scaling.isNonUniformWithinEpsilon(.001))&&(r.setParent(null),o.q.SlerpToRef(r.rotationQuaternion,s,n.dragDeltaRatio,r.rotationQuaternion),r.setParent(e))}Be.a._RestorePivotPoint(r)}})},e.prototype.detach=function(){this._scene&&this._scene.onPointerObservable.remove(this._pointerObserver),this._ownerNode&&this._ownerNode.getScene().onBeforeRenderObservable.remove(this._sceneRenderObserver),this._virtualOriginMesh&&this._virtualOriginMesh.dispose(),this._virtualDragMesh&&this._virtualDragMesh.dispose(),this.onDragEndObservable.clear(),this.onDragStartObservable.clear()},e}(),ke=function(){function e(e,t,n){if(this.targetPosition=o.x.Zero(),this.poleTargetPosition=o.x.Zero(),this.poleTargetLocalOffset=o.x.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=o.q.Identity(),this._bone1Mat=o.j.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=o.x.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=t,this._bone1=t.getParent(),this._bone1){this.mesh=e;var r=t.getPosition();if(t.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,r.x>r.y&&r.x>r.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var i=this._bone1.getScale(),a=this._bone2.getScale();this._bone1Length=this._bone1.length*i.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*a.y*this.mesh.scaling.y}else if(this._bone1.children[0]){e.computeWorldMatrix(!0);var s=this._bone2.children[0].getAbsolutePosition(e),l=this._bone2.getAbsolutePosition(e),u=this._bone1.getAbsolutePosition(e);this._bone1Length=o.x.Distance(s,l),this._bone2Length=o.x.Distance(l,u)}this._bone1.getRotationMatrixToRef(o.s.WORLD,e,this._bone1Mat),this.maxAngle=Math.PI,n&&(n.targetMesh&&(this.targetMesh=n.targetMesh,this.targetMesh.computeWorldMatrix(!0)),n.poleTargetMesh?(this.poleTargetMesh=n.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):n.poleTargetBone?this.poleTargetBone=n.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),n.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(n.poleTargetLocalOffset),n.poleAngle&&(this.poleAngle=n.poleAngle),n.bendAxis&&this._bendAxis.copyFrom(n.bendAxis),n.maxAngle&&(this.maxAngle=n.maxAngle),n.slerpAmount&&(this.slerpAmount=n.slerpAmount))}}return Object.defineProperty(e.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(e){this._setMaxAngle(e)},enumerable:!0,configurable:!0}),e.prototype._setMaxAngle=function(e){e<0&&(e=0),(e>Math.PI||null==e)&&(e=Math.PI),this._maxAngle=e;var t=this._bone1Length,n=this._bone2Length;this._maxReach=Math.sqrt(t*t+n*n-2*t*n*Math.cos(e))},e.prototype.update=function(){var t=this._bone1;if(t){var n=this.targetPosition,r=this.poleTargetPosition,i=e._tmpMats[0],a=e._tmpMats[1];this.targetMesh&&n.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,r):this.poleTargetMesh&&o.x.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),r);var s=e._tmpVecs[0],l=e._tmpVecs[1],u=e._tmpVecs[2],c=e._tmpVecs[3],h=e._tmpVecs[4],d=e._tmpQuat;t.getAbsolutePositionToRef(this.mesh,s),r.subtractToRef(s,h),0==h.x&&0==h.y&&0==h.z?h.y=1:h.normalize(),n.subtractToRef(s,c),c.normalize(),o.x.CrossToRef(c,h,l),l.normalize(),o.x.CrossToRef(c,l,u),u.normalize(),o.j.FromXYZAxesToRef(u,c,l,i);var f=this._bone1Length,p=this._bone2Length,m=o.x.Distance(s,n);this._maxReach>0&&(m=Math.min(this._maxReach,m));var g=(p*p+m*m-f*f)/(2*p*m),_=(m*m+f*f-p*p)/(2*m*f);g>1&&(g=1),_>1&&(_=1),g<-1&&(g=-1),_<-1&&(_=-1);var v=Math.acos(g),y=Math.acos(_),b=-v-y;if(this._rightHandedSystem)o.j.RotationYawPitchRollToRef(0,0,this._adjustRoll,a),a.multiplyToRef(i,i),o.j.RotationAxisToRef(this._bendAxis,y,a),a.multiplyToRef(i,i);else{var E=e._tmpVecs[5];E.copyFrom(this._bendAxis),E.x*=-1,o.j.RotationAxisToRef(E,-y,a),a.multiplyToRef(i,i)}this.poleAngle&&(o.j.RotationAxisToRef(c,this.poleAngle,a),i.multiplyToRef(a,i)),this._bone1&&(this.slerpAmount<1?(this._slerping||o.q.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),o.q.FromRotationMatrixToRef(i,d),o.q.SlerpToRef(this._bone1Quat,d,this.slerpAmount,this._bone1Quat),b=this._bone2Ang*(1-this.slerpAmount)+b*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,o.s.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(i,o.s.WORLD,this.mesh),this._bone1Mat.copyFrom(i),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,b,o.s.LOCAL),this._bone2Ang=b}},e._tmpVecs=[o.x.Zero(),o.x.Zero(),o.x.Zero(),o.x.Zero(),o.x.Zero(),o.x.Zero()],e._tmpQuat=o.q.Identity(),e._tmpMats=[o.j.Identity(),o.j.Identity()],e}(),Ve=function(){function e(e,t,n,r){if(this.upAxis=o.x.Up(),this.upAxisSpace=o.s.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=o.q.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=o.x.Forward(),this.mesh=e,this.bone=t,this.target=n,r&&(r.adjustYaw&&(this.adjustYaw=r.adjustYaw),r.adjustPitch&&(this.adjustPitch=r.adjustPitch),r.adjustRoll&&(this.adjustRoll=r.adjustRoll),null!=r.maxYaw?this.maxYaw=r.maxYaw:this.maxYaw=Math.PI,null!=r.minYaw?this.minYaw=r.minYaw:this.minYaw=-Math.PI,null!=r.maxPitch?this.maxPitch=r.maxPitch:this.maxPitch=Math.PI,null!=r.minPitch?this.minPitch=r.minPitch:this.minPitch=-Math.PI,null!=r.slerpAmount&&(this.slerpAmount=r.slerpAmount),null!=r.upAxis&&(this.upAxis=r.upAxis),null!=r.upAxisSpace&&(this.upAxisSpace=r.upAxisSpace),null!=r.yawAxis||null!=r.pitchAxis)){var i=o.c.Y,a=o.c.X;null!=r.yawAxis&&(i=r.yawAxis.clone()).normalize(),null!=r.pitchAxis&&(a=r.pitchAxis.clone()).normalize();var s=o.x.Cross(a,i);this._transformYawPitch=o.j.Identity(),o.j.FromXYZAxesToRef(a,i,s,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}t.getParent()||this.upAxisSpace!=o.s.BONE||(this.upAxisSpace=o.s.LOCAL)}return Object.defineProperty(e.prototype,"minYaw",{get:function(){return this._minYaw},set:function(e){this._minYaw=e,this._minYawSin=Math.sin(e),this._minYawCos=Math.cos(e),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(e){this._maxYaw=e,this._maxYawSin=Math.sin(e),this._maxYawCos=Math.cos(e),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPitch",{get:function(){return this._minPitch},set:function(e){this._minPitch=e,this._minPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(e){this._maxPitch=e,this._maxPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)this._firstFrameSkipped=!0;else{var t=this.bone,n=e._tmpVecs[0];t.getAbsolutePositionToRef(this.mesh,n);var r=this.target,i=e._tmpMats[0],a=e._tmpMats[1],s=this.mesh,l=t.getParent(),u=e._tmpVecs[1];u.copyFrom(this.upAxis),this.upAxisSpace==o.s.BONE&&l?(this._transformYawPitch&&o.x.TransformCoordinatesToRef(u,this._transformYawPitchInv,u),l.getDirectionToRef(u,this.mesh,u)):this.upAxisSpace==o.s.LOCAL&&(s.getDirectionToRef(u,u),1==s.scaling.x&&1==s.scaling.y&&1==s.scaling.z||u.normalize());var c=!1,h=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(c=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(h=!0),c||h){var d=e._tmpMats[2],f=e._tmpMats[3];if(this.upAxisSpace==o.s.BONE&&1==u.y&&l)l.getRotationMatrixToRef(o.s.WORLD,this.mesh,d);else if(this.upAxisSpace!=o.s.LOCAL||1!=u.y||l){(m=e._tmpVecs[2]).copyFrom(this._fowardAxis),this._transformYawPitch&&o.x.TransformCoordinatesToRef(m,this._transformYawPitchInv,m),l?l.getDirectionToRef(m,this.mesh,m):s.getDirectionToRef(m,m);var p=o.x.Cross(u,m);p.normalize();var m=o.x.Cross(p,u);o.j.FromXYZAxesToRef(p,u,m,d)}else d.copyFrom(s.getWorldMatrix());d.invertToRef(f);var g=null;if(h){var _=e._tmpVecs[3];r.subtractToRef(n,_),o.x.TransformCoordinatesToRef(_,f,_),g=Math.sqrt(_.x*_.x+_.z*_.z);var v=Math.atan2(_.y,g),y=v;v>this._maxPitch?(_.y=this._maxPitchTan*g,y=this._maxPitch):v<this._minPitch&&(_.y=this._minPitchTan*g,y=this._minPitch),v!=y&&(o.x.TransformCoordinatesToRef(_,d,_),_.addInPlace(n),r=_)}if(c){_=e._tmpVecs[4],r.subtractToRef(n,_),o.x.TransformCoordinatesToRef(_,f,_);var b=Math.atan2(_.x,_.z),E=b;if((b>this._maxYaw||b<this._minYaw)&&(null==g&&(g=Math.sqrt(_.x*_.x+_.z*_.z)),this._yawRange>Math.PI?this._isAngleBetween(b,this._maxYaw,this._midYawConstraint)?(_.z=this._maxYawCos*g,_.x=this._maxYawSin*g,E=this._maxYaw):this._isAngleBetween(b,this._midYawConstraint,this._minYaw)&&(_.z=this._minYawCos*g,_.x=this._minYawSin*g,E=this._minYaw):b>this._maxYaw?(_.z=this._maxYawCos*g,_.x=this._maxYawSin*g,E=this._maxYaw):b<this._minYaw&&(_.z=this._minYawCos*g,_.x=this._minYawSin*g,E=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var x=e._tmpVecs[8];x.copyFrom(o.c.Z),this._transformYawPitch&&o.x.TransformCoordinatesToRef(x,this._transformYawPitchInv,x);var T=e._tmpMats[4];this._boneQuat.toRotationMatrix(T),this.mesh.getWorldMatrix().multiplyToRef(T,T),o.x.TransformCoordinatesToRef(x,T,x),o.x.TransformCoordinatesToRef(x,f,x);var S=Math.atan2(x.x,x.z);if(this._getAngleBetween(S,b)>this._getAngleBetween(S,this._midYawConstraint)){null==g&&(g=Math.sqrt(_.x*_.x+_.z*_.z));var A=this._getAngleBetween(S,this._maxYaw);this._getAngleBetween(S,this._minYaw)<A?(E=S+.75*Math.PI,_.z=Math.cos(E)*g,_.x=Math.sin(E)*g):(E=S-.75*Math.PI,_.z=Math.cos(E)*g,_.x=Math.sin(E)*g)}}b!=E&&(o.x.TransformCoordinatesToRef(_,d,_),_.addInPlace(n),r=_)}}var P=e._tmpVecs[5],M=e._tmpVecs[6],R=e._tmpVecs[7],C=e._tmpQuat;r.subtractToRef(n,P),P.normalize(),o.x.CrossToRef(u,P,M),M.normalize(),o.x.CrossToRef(P,M,R),R.normalize(),o.j.FromXYZAxesToRef(M,R,P,i),0===M.x&&0===M.y&&0===M.z||0===R.x&&0===R.y&&0===R.z||0===P.x&&0===P.y&&0===P.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(o.j.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,a),a.multiplyToRef(i,i)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(o.s.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(i,i),o.q.FromRotationMatrixToRef(i,C),o.q.SlerpToRef(this._boneQuat,C,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,o.s.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(i,i),this.bone.setRotationMatrix(i,o.s.WORLD,this.mesh),this._slerping=!1))}},e.prototype._getAngleDiff=function(e,t){var n=t-e;return(n%=2*Math.PI)>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),n},e.prototype._getAngleBetween=function(e,t){var n=0;return(n=(e=(e%=2*Math.PI)<0?e+2*Math.PI:e)<(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)?t-e:e-t)>Math.PI&&(n=2*Math.PI-n),n},e.prototype._isAngleBetween=function(e,t,n){if(e=(e%=2*Math.PI)<0?e+2*Math.PI:e,(t=(t%=2*Math.PI)<0?t+2*Math.PI:t)<(n=(n%=2*Math.PI)<0?n+2*Math.PI:n)){if(e>t&&e<n)return!0}else if(e>n&&e<t)return!0;return!1},e._tmpVecs=Y.a.BuildArray(10,o.x.Zero),e._tmpQuat=o.q.Identity(),e._tmpMats=Y.a.BuildArray(5,o.j.Identity),e}(),Ge=n(7),ze=n(26);ge.b.prototype.updateRawTexture=function(e,t,n,r,i,o){if(void 0===i&&(i=null),void 0===o&&(o=ge.b.TEXTURETYPE_UNSIGNED_INT),e){var a=this._getRGBABufferInternalSizedFormat(o,n),s=this._getInternalFormat(n),l=this._getWebGLTextureType(o);this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(e._bufferView=t,e.format=n,e.type=o,e.invertY=r,e._compression=i),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),i&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[i],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,a,e.width,e.height,0,s,l,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),e.isReady=!0}},ge.b.prototype.createRawTexture=function(e,t,n,r,i,o,a,s,l){void 0===s&&(s=null),void 0===l&&(l=ge.b.TEXTURETYPE_UNSIGNED_INT);var u=new ze.a(this,ze.a.DATASOURCE_RAW);u.baseWidth=t,u.baseHeight=n,u.width=t,u.height=n,u.format=r,u.generateMipMaps=i,u.samplingMode=a,u.invertY=o,u._compression=s,u.type=l,this._doNotHandleContextLost||(u._bufferView=e),this.updateRawTexture(u,e,r,o,s,l),this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0);var c=this._getSamplingParameters(a,i);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,c.min),i&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(u),u},ge.b.prototype.createRawCubeTexture=function(e,t,n,r,i,o,a,s){void 0===s&&(s=null);var l=this._gl,u=new ze.a(this,ze.a.DATASOURCE_CUBERAW);u.isCube=!0,u.format=n,u.type=r,this._doNotHandleContextLost||(u._bufferViewArray=e);var c=this._getWebGLTextureType(r),h=this._getInternalFormat(n);h===l.RGB&&(h=l.RGBA),c!==l.FLOAT||this._caps.textureFloatLinearFiltering?c!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?c!==l.FLOAT||this._caps.textureFloatRender?c!==l.HALF_FLOAT||this._caps.colorBufferFloat||(i=!1,p.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(i=!1,p.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(i=!1,a=ge.b.TEXTURE_NEAREST_SAMPLINGMODE,p.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(i=!1,a=ge.b.TEXTURE_NEAREST_SAMPLINGMODE,p.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));var d=t,f=d;u.width=d,u.height=f,!this.needPOTTextures||ye.h.IsExponentOfTwo(u.width)&&ye.h.IsExponentOfTwo(u.height)||(i=!1),e&&this.updateRawCubeTexture(u,e,n,r,o,s),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),e&&i&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var m=this._getSamplingParameters(a,i);return l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,m.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,m.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),u.generateMipMaps=i,u},ge.b.prototype.updateRawCubeTexture=function(e,t,n,r,i,o,a){void 0===o&&(o=null),void 0===a&&(a=0),e._bufferViewArray=t,e.format=n,e.type=r,e.invertY=i,e._compression=o;var s=this._gl,l=this._getWebGLTextureType(r),u=this._getInternalFormat(n),c=this._getRGBABufferInternalSizedFormat(r),h=!1;u===s.RGB&&(u=s.RGBA,h=!0),this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(void 0===i||!!i),e.width%4!=0&&s.pixelStorei(s.UNPACK_ALIGNMENT,1);for(var d=0;d<6;d++){var f=t[d];o?s.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,this.getCaps().s3tc[o],e.width,e.height,0,f):(h&&(f=this._convertRGBtoRGBATextureData(f,e.width,e.height,r)),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,c,e.width,e.height,0,u,l,f))}(!this.needPOTTextures||ye.h.IsExponentOfTwo(e.width)&&ye.h.IsExponentOfTwo(e.height))&&e.generateMipMaps&&0===a&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),e.isReady=!0},ge.b.prototype.createRawCubeTextureFromUrl=function(e,t,n,r,i,o,a,s,l,u,c,h){var d=this;void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=ge.b.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===h&&(h=!1);var f=this._gl,p=this.createRawCubeTexture(null,n,r,i,!o,h,c);return t._addPendingData(p),p.url=e,this._internalTexturesCache.push(p),this._loadFile(e,function(e){!function(e){var n=p.width,o=a(e);if(o){if(s){var u=d._getWebGLTextureType(i),c=d._getInternalFormat(r),m=d._getRGBABufferInternalSizedFormat(i),g=!1;c===f.RGB&&(c=f.RGBA,g=!0),d._bindTextureDirectly(f.TEXTURE_CUBE_MAP,p,!0),d._unpackFlipY(!1);for(var _=s(o),v=0;v<_.length;v++)for(var y=n>>v,b=0;b<6;b++){var E=_[v][b];g&&(E=d._convertRGBtoRGBATextureData(E,y,y,i)),f.texImage2D(b,v,m,y,y,0,c,u,E)}d._bindTextureDirectly(f.TEXTURE_CUBE_MAP,null)}else d.updateRawCubeTexture(p,o,r,i,h);p.isReady=!0,t._removePendingData(p),l&&l()}}(e)},void 0,t.offlineProvider,!0,function(e,n){t._removePendingData(p),u&&e&&u(e.status+" "+e.statusText,n)}),p},ge.b.prototype.createRawTexture3D=function(e,t,n,r,i,o,a,s,l,u){void 0===l&&(l=null),void 0===u&&(u=ge.b.TEXTURETYPE_UNSIGNED_INT);var c=new ze.a(this,ze.a.DATASOURCE_RAW3D);c.baseWidth=t,c.baseHeight=n,c.baseDepth=r,c.width=t,c.height=n,c.depth=r,c.format=i,c.type=u,c.generateMipMaps=o,c.samplingMode=s,c.is3D=!0,this._doNotHandleContextLost||(c._bufferView=e),this.updateRawTexture3D(c,e,i,a,l,u),this._bindTextureDirectly(this._gl.TEXTURE_3D,c,!0);var h=this._getSamplingParameters(s,o);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,h.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,h.min),o&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(c),c},ge.b.prototype.updateRawTexture3D=function(e,t,n,r,i,o){void 0===i&&(i=null),void 0===o&&(o=ge.b.TEXTURETYPE_UNSIGNED_INT);var a=this._getWebGLTextureType(o),s=this._getInternalFormat(n),l=this._getRGBABufferInternalSizedFormat(o,n);this._bindTextureDirectly(this._gl.TEXTURE_3D,e,!0),this._unpackFlipY(void 0===r||!!r),this._doNotHandleContextLost||(e._bufferView=t,e.format=n,e.invertY=r,e._compression=i),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),i&&t?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[i],e.width,e.height,e.depth,0,t):this._gl.texImage3D(this._gl.TEXTURE_3D,0,l,e.width,e.height,e.depth,0,s,a,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),e.isReady=!0};var je=function(e){function t(t,n,r,i,o,a,s,l,u){void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===l&&(l=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===u&&(u=m.a.TEXTURETYPE_UNSIGNED_INT);var c=e.call(this,null,o,!a,s)||this;return c.format=i,c._engine=o.getEngine(),c._texture=o.getEngine().createRawTexture(t,n,r,i,a,s,l,null,u),c.wrapU=Ge.a.CLAMP_ADDRESSMODE,c.wrapV=Ge.a.CLAMP_ADDRESSMODE,c}return u.d(t,e),t.prototype.update=function(e){this._engine.updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t.CreateLuminanceTexture=function(e,n,r,i,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,m.a.TEXTUREFORMAT_LUMINANCE,i,o,a,s)},t.CreateLuminanceAlphaTexture=function(e,n,r,i,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,m.a.TEXTUREFORMAT_LUMINANCE_ALPHA,i,o,a,s)},t.CreateAlphaTexture=function(e,n,r,i,o,a,s){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),new t(e,n,r,m.a.TEXTUREFORMAT_ALPHA,i,o,a,s)},t.CreateRGBTexture=function(e,n,r,i,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===l&&(l=m.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,m.a.TEXTUREFORMAT_RGB,i,o,a,s,l)},t.CreateRGBATexture=function(e,n,r,i,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===l&&(l=m.a.TEXTURETYPE_UNSIGNED_INT),new t(e,n,r,m.a.TEXTUREFORMAT_RGBA,i,o,a,s,l)},t.CreateRTexture=function(e,n,r,i,o,a,s,l){return void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=m.a.TEXTURETYPE_FLOAT),new t(e,n,r,m.a.TEXTUREFORMAT_R,i,o,a,s,l)},t}(Ge.a),He=function(){function e(e,t,n){this.name=e,this.id=t,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=o.j.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new i.c,this.bones=[],this._scene=n||P.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var r=this._scene.getEngine().getCaps();this._canUseTextureForBones=r.textureFloat&&r.maxVertexTextureImageUnits>0}return Object.defineProperty(e.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(e){this._useTextureToStoreBoneMatrices=e,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones&&!this.needInitialSkinMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Skeleton"},e.prototype.getChildren=function(){return this.bones.filter(function(e){return!e.getParent()})},e.prototype.getTransformMatrices=function(e){return this.needInitialSkinMatrix&&e._bonesTransformMatrices?e._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},e.prototype.getTransformMatrixTexture=function(){return this._transformMatrixTexture},e.prototype.getScene=function(){return this._scene},e.prototype.toString=function(e){var t="Name: "+this.name+", nBones: "+this.bones.length;if(t+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var n=!0;for(var r in this._ranges)n&&(t+=", ",n=!1),t+=r;t+="}"}return t},e.prototype.getBoneIndexByName=function(e){for(var t=0,n=this.bones.length;t<n;t++)if(this.bones[t].name===e)return t;return-1},e.prototype.createAnimationRange=function(e,t,n){if(!this._ranges[e]){this._ranges[e]=new L(e,t,n);for(var r=0,i=this.bones.length;r<i;r++)this.bones[r].animations[0]&&this.bones[r].animations[0].createRange(e,t,n)}},e.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var n=0,r=this.bones.length;n<r;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(e,t);this._ranges[e]=null},e.prototype.getAnimationRange=function(e){return this._ranges[e]},e.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},e.prototype.copyAnimationRange=function(e,t,n){if(void 0===n&&(n=!1),this._ranges[t]||!e.getAnimationRange(t))return!1;var r,i,o=!0,a=this._getHighestAnimationFrame()+1,s={},l=e.bones;for(i=0,r=l.length;i<r;i++)s[l[i].name]=l[i];this.bones.length!==l.length&&(p.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+l.length),o=!1);var u=n&&this.dimensionsAtRest&&e.dimensionsAtRest?this.dimensionsAtRest.divide(e.dimensionsAtRest):null;for(i=0,r=this.bones.length;i<r;i++){var c=this.bones[i].name,h=s[c];h?o=o&&this.bones[i].copyAnimationRange(h,t,a,n,u):(p.a.Warn("copyAnimationRange: not same rig, missing source bone "+c),o=!1)}var d=e.getAnimationRange(t);return d&&(this._ranges[t]=new L(t,d.from+a,d.to+a)),o},e.prototype.returnToRest=function(){for(var e=0;e<this.bones.length;e++)this.bones[e].returnToRest()},e.prototype._getHighestAnimationFrame=function(){for(var e=0,t=0,n=this.bones.length;t<n;t++)if(this.bones[t].animations[0]){var r=this.bones[t].animations[0].getHighestFrame();e<r&&(e=r)}return e},e.prototype.beginAnimation=function(e,t,n,r){var i=this.getAnimationRange(e);return i?this._scene.beginAnimation(this,i.from,i.to,t,n,r):null},e.prototype._markAsDirty=function(){this._isDirty=!0},e.prototype._registerMeshWithPoseMatrix=function(e){this._meshesWithPoseMatrix.push(e)},e.prototype._unregisterMeshWithPoseMatrix=function(e){var t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)},e.prototype._computeTransformMatrices=function(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(var n=0;n<this.bones.length;n++){var r=this.bones[n];r._childUpdateId++;var i=r.getParent();if(i?r.getLocalMatrix().multiplyToRef(i.getWorldMatrix(),r.getWorldMatrix()):t?r.getLocalMatrix().multiplyToRef(t,r.getWorldMatrix()):r.getWorldMatrix().copyFrom(r.getLocalMatrix()),-1!==r._index){var o=null===r._index?n:r._index;r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(),e,16*o)}}this._identity.copyToArray(e,16*this.bones.length)},e.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var e=0,t=this.bones;e<t.length;e++){var n=t[e];n._linkedTransformNode&&(n._linkedTransformNode.computeWorldMatrix(),n._matrix=n._linkedTransformNode._localMatrix,n.markAsDirty())}if(this._isDirty){if(this.needInitialSkinMatrix)for(var r=0;r<this._meshesWithPoseMatrix.length;r++){var i=this._meshesWithPoseMatrix[r],a=i.getPoseMatrix();if(i._bonesTransformMatrices&&i._bonesTransformMatrices.length===16*(this.bones.length+1)||(i._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==i){this._synchronizedWithMesh=i;for(var s=0;s<this.bones.length;s++){var l=this.bones[s];l.getParent()||(l.getBaseMatrix().multiplyToRef(a,o.t.Matrix[1]),l._updateDifferenceMatrix(o.t.Matrix[1]))}}this._computeTransformMatrices(i._bonesTransformMatrices,a)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=je.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,m.a.TEXTURE_NEAREST_SAMPLINGMODE,m.a.TEXTURETYPE_FLOAT))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},e.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},e.prototype.clone=function(t,n){var r=new e(t,n||t,this._scene);r.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var i=0;i<this.bones.length;i++){var o=this.bones[i],a=null,s=o.getParent();if(s){var l=this.bones.indexOf(s);a=r.bones[l]}var u=new K(o.name,r,a,o.getBaseMatrix().clone(),o.getRestPose().clone());M.a.DeepCopy(o.animations,u.animations)}if(this._ranges)for(var c in r._ranges={},this._ranges){var h=this._ranges[c];h&&(r._ranges[c]=h.clone())}return this._isDirty=!0,r},e.prototype.enableBlending=function(e){void 0===e&&(e=.01),this.bones.forEach(function(t){t.animations.forEach(function(t){t.enableBlending=!0,t.blendingSpeed=e})})},e.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},e.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,this.dimensionsAtRest&&(e.dimensionsAtRest=this.dimensionsAtRest.asArray()),e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var t=0;t<this.bones.length;t++){var n=this.bones[t],r=n.getParent(),i={parentBoneIndex:r?this.bones.indexOf(r):-1,name:n.name,matrix:n.getBaseMatrix().toArray(),rest:n.getRestPose().toArray()};for(var o in e.bones.push(i),n.length&&(i.length=n.length),n.metadata&&(i.metadata=n.metadata),n.animations&&n.animations.length>0&&(i.animation=n.animations[0].serialize()),e.ranges=[],this._ranges){var a=this._ranges[o];if(a){var s={};s.name=o,s.from=a.from,s.to=a.to,e.ranges.push(s)}}}return e},e.Parse=function(t,n){var r,i=new e(t.name,t.id,n);for(t.dimensionsAtRest&&(i.dimensionsAtRest=o.x.FromArray(t.dimensionsAtRest)),i.needInitialSkinMatrix=t.needInitialSkinMatrix,r=0;r<t.bones.length;r++){var a=t.bones[r],s=null;a.parentBoneIndex>-1&&(s=i.bones[a.parentBoneIndex]);var l=a.rest?o.j.FromArray(a.rest):null,u=new K(a.name,i,s,o.j.FromArray(a.matrix),l);void 0!==a.id&&null!==a.id&&(u.id=a.id),a.length&&(u.length=a.length),a.metadata&&(u.metadata=a.metadata),a.animation&&u.animations.push(B.Parse(a.animation)),void 0!==a.linkedTransformNodeId&&null!==a.linkedTransformNodeId&&(i._hasWaitingData=!0,u._waitingTransformNodeId=a.linkedTransformNodeId)}if(t.ranges)for(r=0;r<t.ranges.length;r++){var c=t.ranges[r];i.createAnimationRange(c.name,c.from,c.to)}return i},e.prototype.computeAbsoluteTransforms=function(e){void 0===e&&(e=!1);var t=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=t||e)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=t)},e.prototype.getPoseMatrix=function(){var e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e},e.prototype.sortBones=function(){for(var e=new Array,t=new Array(this.bones.length),n=0;n<this.bones.length;n++)this._sortBones(n,e,t);this.bones=e},e.prototype._sortBones=function(e,t,n){if(!n[e]){n[e]=!0;var r=this.bones[e];void 0===r._index&&(r._index=e);var i=r.getParent();i&&this._sortBones(this.bones.indexOf(i),t,n),t.push(r)}},e}(),We={},Xe=function(){function e(e){this.attached={},this.camera=e,this.checkInputs=function(){}}return e.prototype.add=function(e){var t=e.getSimpleName();this.attached[t]?p.a.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedElement&&e.attachControl(this.attachedElement))},e.prototype.remove=function(e){for(var t in this.attached){var n=this.attached[t];n===e&&(n.detachControl(this.attachedElement),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}},e.prototype.removeByType=function(e){for(var t in this.attached){var n=this.attached[t];n.getClassName()===e&&(n.detachControl(this.attachedElement),n.camera=null,delete this.attached[t],this.rebuildInputCheck())}},e.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},e.prototype.attachInput=function(e){this.attachedElement&&e.attachControl(this.attachedElement,this.noPreventDefault)},e.prototype.attachElement=function(e,t){if(void 0===t&&(t=!1),!this.attachedElement)for(var n in t=!Ne.a.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedElement=e,this.noPreventDefault=t,this.attached)this.attached[n].attachControl(e,t)},e.prototype.detachElement=function(e,t){if(void 0===t&&(t=!1),this.attachedElement===e){for(var n in this.attached)this.attached[n].detachControl(e),t&&(this.attached[n].camera=null);this.attachedElement=null}},e.prototype.rebuildInputCheck=function(){for(var e in this.checkInputs=function(){},this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},e.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},e.prototype.serialize=function(e){var t={};for(var n in this.attached){var r=this.attached[n],i=D.a.Serialize(r);t[r.getClassName()]=i}e.inputsmgr=t},e.prototype.parse=function(e){var t=e.inputsmgr;if(t){for(var n in this.clear(),t)if(o=We[n]){var r=t[n],i=D.a.Parse(function(){return new o},r,null);this.add(i)}}else for(var n in this.attached){var o;(o=We[this.attached[n].getClassName()])&&(i=D.a.Parse(function(){return new o},e,null),this.remove(this.attached[n]),this.add(i))}},e}(),Ye=function(e,t){this.x=e,this.y=t},Ke=function(){function e(t,n,r,i,o,a,s){void 0===i&&(i=0),void 0===o&&(o=1),void 0===a&&(a=2),void 0===s&&(s=3),this.id=t,this.index=n,this.browserGamepad=r,this._leftStick={x:0,y:0},this._rightStick={x:0,y:0},this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=i,this._leftStickAxisY=o,this._rightStickAxisX=a,this._rightStickAxisY=s,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e.GAMEPAD=0,e.GENERIC=1,e.XBOX=2,e.POSE_ENABLED=3,e}(),qe=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.onButtonDownObservable=new i.c,o.onButtonUpObservable=new i.c,o.type=Ke.GENERIC,o._buttons=new Array(r.buttons.length),o}return u.d(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,n){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(n),this.onButtonDownObservable.notifyObservers(n)),0===e&&(this._onbuttonup&&this._onbuttonup(n),this.onButtonUpObservable.notifyObservers(n))),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.browserGamepad.buttons[t].value,this._buttons[t],t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},t}(Ke),Qe=function(){function e(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return e.prototype.attachControl=function(e,t){var n=this,r=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=r.onGamepadConnectedObservable.add(function(e){e.type!==Ke.POSE_ENABLED&&(n.gamepad&&e.type!==Ke.XBOX||(n.gamepad=e))}),this._onGamepadDisconnectedObserver=r.onGamepadDisconnectedObservable.add(function(e){n.gamepad===e&&(n.gamepad=null)}),this.gamepad=r.getGamepadByType(Ke.XBOX)},e.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad){var e=this.camera,t=this.gamepad.rightStick;if(t){if(0!=t.x){var n=t.x/this.gamepadRotationSensibility;0!=n&&Math.abs(n)>.005&&(e.inertialAlphaOffset+=n)}if(0!=t.y){var r=t.y/this.gamepadRotationSensibility;0!=r&&Math.abs(r)>.005&&(e.inertialBetaOffset+=r)}}var i=this.gamepad.leftStick;if(i&&0!=i.y){var o=i.y/this.gamepadMoveSensibility;0!=o&&Math.abs(o)>.005&&(this.camera.inertialRadiusOffset-=o)}}},e.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},u.c([Object(D.c)()],e.prototype,"gamepadRotationSensibility",void 0),u.c([Object(D.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();We.ArcRotateCameraGamepadInput=Qe;var Ze=n(51),Je=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var r,i=e.event;i.metaKey||(e.type===Ze.a.KEYDOWN?(n._ctrlPressed=i.ctrlKey,n._altPressed=i.altKey,(-1!==n.keysUp.indexOf(i.keyCode)||-1!==n.keysDown.indexOf(i.keyCode)||-1!==n.keysLeft.indexOf(i.keyCode)||-1!==n.keysRight.indexOf(i.keyCode)||-1!==n.keysReset.indexOf(i.keyCode))&&(-1===(r=n._keys.indexOf(i.keyCode))&&n._keys.push(i.keyCode),i.preventDefault&&(t||i.preventDefault()))):-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)&&-1===n.keysReset.indexOf(i.keyCode)||((r=n._keys.indexOf(i.keyCode))>=0&&n._keys.splice(r,1),i.preventDefault&&(t||i.preventDefault())))}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t];-1!==this.keysLeft.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(n)&&e.useInputToRestoreState&&e.restoreState()}},e.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},u.c([Object(D.c)()],e.prototype,"keysUp",void 0),u.c([Object(D.c)()],e.prototype,"keysDown",void 0),u.c([Object(D.c)()],e.prototype,"keysLeft",void 0),u.c([Object(D.c)()],e.prototype,"keysRight",void 0),u.c([Object(D.c)()],e.prototype,"keysReset",void 0),u.c([Object(D.c)()],e.prototype,"panningSensibility",void 0),u.c([Object(D.c)()],e.prototype,"zoomingSensibility",void 0),u.c([Object(D.c)()],e.prototype,"useAltToZoom",void 0),u.c([Object(D.c)()],e.prototype,"angularSpeed",void 0),e}();We.ArcRotateCameraKeyboardMoveInput=Je;var $e=function(){function e(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.computeDeltaFromMouseWheelLegacyEvent=function(e,t){var n=.01*e.wheelDelta*this.wheelDeltaPercentage*t;return e.wheelDelta>0?n/(1+this.wheelDeltaPercentage):n*(1+this.wheelDeltaPercentage)},e.prototype.attachControl=function(e,t){var n=this;this._wheel=function(e,r){if(e.type===Pe.a.POINTERWHEEL){var i=e.event,o=0,a=i;if(a.wheelDelta)if(n.wheelDeltaPercentage){if((o=n.computeDeltaFromMouseWheelLegacyEvent(a,n.camera.radius))>0){for(var s=n.camera.radius,l=n.camera.inertialRadiusOffset+o,u=0;u<20&&Math.abs(l)>.001;u++)s-=l,l*=n.camera.inertia;s=I.a.Clamp(s,0,Number.MAX_VALUE),o=n.computeDeltaFromMouseWheelLegacyEvent(a,s)}}else o=a.wheelDelta/(40*n.wheelPrecision);else o=-(i.deltaY||i.detail)/n.wheelPrecision;o&&(n.camera.inertialRadiusOffset+=o),i.preventDefault&&(t||i.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Pe.a.POINTERWHEEL)},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},u.c([Object(D.c)()],e.prototype,"wheelPrecision",void 0),u.c([Object(D.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();We.ArcRotateCameraMouseWheelInput=$e;var et=function(){function e(){this.buttons=[0,1,2]}return e.prototype.attachControl=function(e,t){var n=this,r=this.camera.getEngine(),i=0,o=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(a,s){var l=a.event,u="touch"===l.pointerType;if(!r.isInVRExclusivePointerMode&&(a.type===Pe.a.POINTERMOVE||-1!==n.buttons.indexOf(l.button))){var c=l.srcElement||l.target;if(n._altKey=l.altKey,n._ctrlKey=l.ctrlKey,n._metaKey=l.metaKey,n._shiftKey=l.shiftKey,n._buttonsPressed=l.buttons,r.isPointerLock){var h=l.movementX||l.mozMovementX||l.webkitMovementX||l.msMovementX||0,d=l.movementY||l.mozMovementY||l.webkitMovementY||l.msMovementY||0;n.onTouch(null,h,d),n.pointA=null,n.pointB=null}else if(a.type===Pe.a.POINTERDOWN&&c){try{c.setPointerCapture(l.pointerId)}catch(e){}null===n.pointA?n.pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}:null===n.pointB&&(n.pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}),n.onButtonDown(l),t||(l.preventDefault(),e.focus())}else if(a.type===Pe.a.POINTERDOUBLETAP)n.onDoubleTap(l.pointerType);else if(a.type===Pe.a.POINTERUP&&c){try{c.releasePointerCapture(l.pointerId)}catch(e){}u||(n.pointB=null),r._badOS?n.pointA=n.pointB=null:n.pointB&&n.pointA&&n.pointA.pointerId==l.pointerId?(n.pointA=n.pointB,n.pointB=null):n.pointA&&n.pointB&&n.pointB.pointerId==l.pointerId?n.pointB=null:n.pointA=n.pointB=null,(0!==i||o)&&(n.onMultiTouch(n.pointA,n.pointB,i,0,o,null),i=0,o=null),n.onButtonUp(l),t||l.preventDefault()}else if(a.type===Pe.a.POINTERMOVE)if(t||l.preventDefault(),n.pointA&&null===n.pointB)h=l.clientX-n.pointA.x,d=l.clientY-n.pointA.y,n.onTouch(n.pointA,h,d),n.pointA.x=l.clientX,n.pointA.y=l.clientY;else if(n.pointA&&n.pointB){var f=n.pointA.pointerId===l.pointerId?n.pointA:n.pointB;f.x=l.clientX,f.y=l.clientY;var p=n.pointA.x-n.pointB.x,m=n.pointA.y-n.pointB.y,g=p*p+m*m,_={x:(n.pointA.x+n.pointB.x)/2,y:(n.pointA.y+n.pointB.y)/2,pointerId:l.pointerId,type:a.type};n.onMultiTouch(n.pointA,n.pointB,i,g,o,_),o=_,i=g}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Pe.a.POINTERDOWN|Pe.a.POINTERUP|Pe.a.POINTERMOVE),this._onLostFocus=function(){n.pointA=n.pointB=null,i=0,o=null,n.onLostFocus()},e.addEventListener("contextmenu",this.onContextMenu.bind(this),!1),ye.h.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},e.prototype.detachControl=function(e){this._onLostFocus&&ye.h.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),e&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu&&e.removeEventListener("contextmenu",this.onContextMenu),this._onLostFocus=null),this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},e.prototype.getClassName=function(){return"BaseCameraPointersInput"},e.prototype.getSimpleName=function(){return"pointers"},e.prototype.onDoubleTap=function(e){},e.prototype.onTouch=function(e,t,n){},e.prototype.onMultiTouch=function(e,t,n,r,i,o){},e.prototype.onContextMenu=function(e){e.preventDefault()},e.prototype.onButtonDown=function(e){},e.prototype.onButtonUp=function(e){},e.prototype.onLostFocus=function(){},u.c([Object(D.c)()],e.prototype,"buttons",void 0),e}(),tt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttons=[0,1,2],t.angularSensibilityX=1e3,t.angularSensibilityY=1e3,t.pinchPrecision=12,t.pinchDeltaPercentage=0,t.panningSensibility=1e3,t.multiTouchPanning=!0,t.multiTouchPanAndZoom=!0,t.pinchInwards=!0,t._isPanClick=!1,t._twoFingerActivityCount=0,t._isPinching=!1,t}return u.d(t,e),t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.onTouch=function(e,t,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)},t.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(e,t,n,r,i,o){if(!(0===n&&null===i||0===r&&null===o)){var a=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-n)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-n)/(this.pinchPrecision*a*(this.angularSensibilityX+this.angularSensibilityY)/2),0!==this.panningSensibility&&i&&o){var s=o.x-i.x,l=o.y-i.y;this.camera.inertialPanningX+=-s/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility}}else{this._twoFingerActivityCount++;var u=Math.sqrt(n),c=Math.sqrt(r);this._isPinching||this._twoFingerActivityCount<20&&Math.abs(c-u)>this.camera.pinchToPanMaxDistance?(this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(r-n)*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(r-n)/(this.pinchPrecision*a*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0):0!==this.panningSensibility&&this.multiTouchPanning&&o&&i&&(s=o.x-i.x,l=o.y-i.y,this.camera.inertialPanningX+=-s/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility)}}},t.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},u.c([Object(D.c)()],t.prototype,"buttons",void 0),u.c([Object(D.c)()],t.prototype,"angularSensibilityX",void 0),u.c([Object(D.c)()],t.prototype,"angularSensibilityY",void 0),u.c([Object(D.c)()],t.prototype,"pinchPrecision",void 0),u.c([Object(D.c)()],t.prototype,"pinchDeltaPercentage",void 0),u.c([Object(D.c)()],t.prototype,"panningSensibility",void 0),u.c([Object(D.c)()],t.prototype,"multiTouchPanning",void 0),u.c([Object(D.c)()],t.prototype,"multiTouchPanAndZoom",void 0),t}(et);We.ArcRotateCameraPointersInput=tt;var nt=function(e){function t(t){return e.call(this,t)||this}return u.d(t,e),t.prototype.addMouseWheel=function(){return this.add(new $e),this},t.prototype.addPointers=function(){return this.add(new tt),this},t.prototype.addKeyboard=function(){return this.add(new Je),this},t}(Xe);nt.prototype.addVRDeviceOrientation=function(){return this.add(new rt),this};var rt=function(){function e(){this.alphaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(e,t){this.camera.attachControl(e,t),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype._onOrientationEvent=function(e){null!==e.alpha&&(this._alpha=(0|+e.alpha)*this.alphaCorrection),null!==e.gamma&&(this._gamma=(0|+e.gamma)*this.gammaCorrection),this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(e){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();We.ArcRotateCameraVRDeviceOrientationInput=rt;var it=function(){function e(){this.keysForward=[87],this.keysBackward=[83],this.keysUp=[69],this.keysDown=[81],this.keysRight=[68],this.keysLeft=[65],this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var r,i=e.event;e.type===Ze.a.KEYDOWN?-1===n.keysForward.indexOf(i.keyCode)&&-1===n.keysBackward.indexOf(i.keyCode)&&-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)||(-1===(r=n._keys.indexOf(i.keyCode))&&n._keys.push(i.keyCode),t||i.preventDefault()):-1===n.keysForward.indexOf(i.keyCode)&&-1===n.keysBackward.indexOf(i.keyCode)&&-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)||((r=n._keys.indexOf(i.keyCode))>=0&&n._keys.splice(r,1),t||i.preventDefault())}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.getClassName=function(){return"FlyCameraKeyboardInput"},e.prototype._onLostFocus=function(e){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t],r=e._computeLocalCameraSpeed();-1!==this.keysForward.indexOf(n)?e._localDirection.copyFromFloats(0,0,r):-1!==this.keysBackward.indexOf(n)?e._localDirection.copyFromFloats(0,0,-r):-1!==this.keysUp.indexOf(n)?e._localDirection.copyFromFloats(0,r,0):-1!==this.keysDown.indexOf(n)?e._localDirection.copyFromFloats(0,-r,0):-1!==this.keysRight.indexOf(n)?e._localDirection.copyFromFloats(r,0,0):-1!==this.keysLeft.indexOf(n)&&e._localDirection.copyFromFloats(-r,0,0),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),o.x.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}},u.c([Object(D.c)()],e.prototype,"keysForward",void 0),u.c([Object(D.c)()],e.prototype,"keysBackward",void 0),u.c([Object(D.c)()],e.prototype,"keysUp",void 0),u.c([Object(D.c)()],e.prototype,"keysDown",void 0),u.c([Object(D.c)()],e.prototype,"keysRight",void 0),u.c([Object(D.c)()],e.prototype,"keysLeft",void 0),e}();We.FlyCameraKeyboardInput=it;var ot=function(){function e(e){void 0===e&&(e=!0),this.buttons=[0,1,2],this.buttonsYaw=[-1,0,1],this.buttonsPitch=[-1,0,1],this.buttonsRoll=[2],this.activeButton=-1,this.angularSensibility=1e3,this.previousPosition=null}return e.prototype.attachControl=function(e,t){var n=this;this.element=e,this.noPreventDefault=t,this._observer=this.camera.getScene().onPointerObservable.add(function(e,t){n._pointerInput(e,t)},Pe.a.POINTERDOWN|Pe.a.POINTERUP|Pe.a.POINTERMOVE),this._rollObserver=this.camera.getScene().onBeforeRenderObservable.add(function(){n.camera.rollCorrect&&n.camera.restoreRoll(n.camera.rollCorrect)}),this._mousemoveCallback=function(e){n._onMouseMove(e)},e.addEventListener("mousemove",this._mousemoveCallback,!1)},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this.camera.getScene().onBeforeRenderObservable.remove(this._rollObserver),this._mousemoveCallback&&e.removeEventListener("mousemove",this._mousemoveCallback),this._observer=null,this._rollObserver=null,this.previousPosition=null,this.noPreventDefault=void 0)},e.prototype.getClassName=function(){return"FlyCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},e.prototype._pointerInput=function(e,t){var n=e.event,r=this.camera.getEngine();if(!r.isInVRExclusivePointerMode&&(this.touchEnabled||"touch"!==n.pointerType)&&(e.type===Pe.a.POINTERMOVE||-1!==this.buttons.indexOf(n.button))){var i=n.srcElement||n.target;if(e.type===Pe.a.POINTERDOWN&&i){try{i.setPointerCapture(n.pointerId)}catch(n){}this.previousPosition={x:n.clientX,y:n.clientY},this.activeButton=n.button,this.noPreventDefault||(n.preventDefault(),this.element.focus())}else if(e.type===Pe.a.POINTERUP&&i){try{i.releasePointerCapture(n.pointerId)}catch(n){}this.activeButton=-1,this.previousPosition=null,this.noPreventDefault||n.preventDefault()}else if(e.type===Pe.a.POINTERMOVE){if(!this.previousPosition||r.isPointerLock)return;var o=n.clientX-this.previousPosition.x,a=n.clientY-this.previousPosition.y;this.rotateCamera(o,a),this.previousPosition={x:n.clientX,y:n.clientY},this.noPreventDefault||n.preventDefault()}}},e.prototype._onMouseMove=function(e){var t=this.camera.getEngine();if(t.isPointerLock&&!t.isInVRExclusivePointerMode){var n=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;this.rotateCamera(n,r),this.previousPosition=null,this.noPreventDefault||e.preventDefault()}},e.prototype.rotateCamera=function(e,t){var n=this,r=this.camera;this.camera.getScene().useRightHandedSystem&&(e*=-1),r.parent&&r.parent._getWorldMatrixDeterminant()<0&&(e*=-1);var i,a=e/this.angularSensibility,s=t/this.angularSensibility,l=o.q.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z);if(this.buttonsPitch.some(function(e){return e===n.activeButton})&&(i=o.q.RotationAxis(o.c.X,s),l.multiplyInPlace(i)),this.buttonsYaw.some(function(e){return e===n.activeButton})){i=o.q.RotationAxis(o.c.Y,a),l.multiplyInPlace(i);var u=r.bankedTurnLimit+r._trackRoll;if(r.bankedTurn&&-u<r.rotation.z&&r.rotation.z<u){var c=r.bankedTurnMultiplier*-a;i=o.q.RotationAxis(o.c.Z,c),l.multiplyInPlace(i)}}this.buttonsRoll.some(function(e){return e===n.activeButton})&&(i=o.q.RotationAxis(o.c.Z,-a),r._trackRoll-=a,l.multiplyInPlace(i)),l.toEulerAnglesToRef(r.rotation)},u.c([Object(D.c)()],e.prototype,"buttons",void 0),u.c([Object(D.c)()],e.prototype,"angularSensibility",void 0),e}();We.FlyCameraMouseInput=ot;var at=function(){function e(){this.keysHeightOffsetIncr=[38],this.keysHeightOffsetDecr=[40],this.keysHeightOffsetModifierAlt=!1,this.keysHeightOffsetModifierCtrl=!1,this.keysHeightOffsetModifierShift=!1,this.keysRotationOffsetIncr=[37],this.keysRotationOffsetDecr=[39],this.keysRotationOffsetModifierAlt=!1,this.keysRotationOffsetModifierCtrl=!1,this.keysRotationOffsetModifierShift=!1,this.keysRadiusIncr=[40],this.keysRadiusDecr=[38],this.keysRadiusModifierAlt=!0,this.keysRadiusModifierCtrl=!1,this.keysRadiusModifierShift=!1,this.heightSensibility=1,this.rotationSensibility=1,this.radiusSensibility=1,this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var r,i=e.event;i.metaKey||(e.type===Ze.a.KEYDOWN?(n._ctrlPressed=i.ctrlKey,n._altPressed=i.altKey,n._shiftPressed=i.shiftKey,(-1!==n.keysHeightOffsetIncr.indexOf(i.keyCode)||-1!==n.keysHeightOffsetDecr.indexOf(i.keyCode)||-1!==n.keysRotationOffsetIncr.indexOf(i.keyCode)||-1!==n.keysRotationOffsetDecr.indexOf(i.keyCode)||-1!==n.keysRadiusIncr.indexOf(i.keyCode)||-1!==n.keysRadiusDecr.indexOf(i.keyCode))&&(-1===(r=n._keys.indexOf(i.keyCode))&&n._keys.push(i.keyCode),i.preventDefault&&(t||i.preventDefault()))):-1===n.keysHeightOffsetIncr.indexOf(i.keyCode)&&-1===n.keysHeightOffsetDecr.indexOf(i.keyCode)&&-1===n.keysRotationOffsetIncr.indexOf(i.keyCode)&&-1===n.keysRotationOffsetDecr.indexOf(i.keyCode)&&-1===n.keysRadiusIncr.indexOf(i.keyCode)&&-1===n.keysRadiusDecr.indexOf(i.keyCode)||((r=n._keys.indexOf(i.keyCode))>=0&&n._keys.splice(r,1),i.preventDefault&&(t||i.preventDefault())))}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){var e=this;this._onKeyboardObserver&&this._keys.forEach(function(t){-1!==e.keysHeightOffsetIncr.indexOf(t)&&e._modifierHeightOffset()?e.camera.heightOffset+=e.heightSensibility:-1!==e.keysHeightOffsetDecr.indexOf(t)&&e._modifierHeightOffset()?e.camera.heightOffset-=e.heightSensibility:-1!==e.keysRotationOffsetIncr.indexOf(t)&&e._modifierRotationOffset()?(e.camera.rotationOffset+=e.rotationSensibility,e.camera.rotationOffset%=360):-1!==e.keysRotationOffsetDecr.indexOf(t)&&e._modifierRotationOffset()?(e.camera.rotationOffset-=e.rotationSensibility,e.camera.rotationOffset%=360):-1!==e.keysRadiusIncr.indexOf(t)&&e._modifierRadius()?e.camera.radius+=e.radiusSensibility:-1!==e.keysRadiusDecr.indexOf(t)&&e._modifierRadius()&&(e.camera.radius-=e.radiusSensibility)})},e.prototype.getClassName=function(){return"FollowCameraKeyboardMoveInput"},e.prototype.getSimpleName=function(){return"keyboard"},e.prototype._modifierHeightOffset=function(){return this.keysHeightOffsetModifierAlt===this._altPressed&&this.keysHeightOffsetModifierCtrl===this._ctrlPressed&&this.keysHeightOffsetModifierShift===this._shiftPressed},e.prototype._modifierRotationOffset=function(){return this.keysRotationOffsetModifierAlt===this._altPressed&&this.keysRotationOffsetModifierCtrl===this._ctrlPressed&&this.keysRotationOffsetModifierShift===this._shiftPressed},e.prototype._modifierRadius=function(){return this.keysRadiusModifierAlt===this._altPressed&&this.keysRadiusModifierCtrl===this._ctrlPressed&&this.keysRadiusModifierShift===this._shiftPressed},u.c([Object(D.c)()],e.prototype,"keysHeightOffsetIncr",void 0),u.c([Object(D.c)()],e.prototype,"keysHeightOffsetDecr",void 0),u.c([Object(D.c)()],e.prototype,"keysHeightOffsetModifierAlt",void 0),u.c([Object(D.c)()],e.prototype,"keysHeightOffsetModifierCtrl",void 0),u.c([Object(D.c)()],e.prototype,"keysHeightOffsetModifierShift",void 0),u.c([Object(D.c)()],e.prototype,"keysRotationOffsetIncr",void 0),u.c([Object(D.c)()],e.prototype,"keysRotationOffsetDecr",void 0),u.c([Object(D.c)()],e.prototype,"keysRotationOffsetModifierAlt",void 0),u.c([Object(D.c)()],e.prototype,"keysRotationOffsetModifierCtrl",void 0),u.c([Object(D.c)()],e.prototype,"keysRotationOffsetModifierShift",void 0),u.c([Object(D.c)()],e.prototype,"keysRadiusIncr",void 0),u.c([Object(D.c)()],e.prototype,"keysRadiusDecr",void 0),u.c([Object(D.c)()],e.prototype,"keysRadiusModifierAlt",void 0),u.c([Object(D.c)()],e.prototype,"keysRadiusModifierCtrl",void 0),u.c([Object(D.c)()],e.prototype,"keysRadiusModifierShift",void 0),u.c([Object(D.c)()],e.prototype,"heightSensibility",void 0),u.c([Object(D.c)()],e.prototype,"rotationSensibility",void 0),u.c([Object(D.c)()],e.prototype,"radiusSensibility",void 0),e}();We.FollowCameraKeyboardMoveInput=at;var st=function(){function e(){this.axisControlRadius=!0,this.axisControlHeight=!1,this.axisControlRotation=!1,this.wheelPrecision=3,this.wheelDeltaPercentage=0}return e.prototype.attachControl=function(e,t){var n=this;this._wheel=function(e,r){if(e.type===Pe.a.POINTERWHEEL){var i=e.event,o=0,a=Math.max(-1,Math.min(1,i.deltaY||i.wheelDelta||-i.detail));n.wheelDeltaPercentage?(console.assert(n.axisControlRadius+n.axisControlHeight+n.axisControlRotation<=1,"wheelDeltaPercentage only usable when mouse wheel controlls ONE axis. Currently enabled: axisControlRadius: "+n.axisControlRadius+", axisControlHeightOffset: "+n.axisControlHeight+", axisControlRotationOffset: "+n.axisControlRotation),n.axisControlRadius?o=.01*a*n.wheelDeltaPercentage*n.camera.radius:n.axisControlHeight?o=.01*a*n.wheelDeltaPercentage*n.camera.heightOffset:n.axisControlRotation&&(o=.01*a*n.wheelDeltaPercentage*n.camera.rotationOffset)):o=a*n.wheelPrecision,o&&(n.axisControlRadius?n.camera.radius+=o:n.axisControlHeight?n.camera.heightOffset-=o:n.axisControlRotation&&(n.camera.rotationOffset-=o)),i.preventDefault&&(t||i.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,Pe.a.POINTERWHEEL)},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},e.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},e.prototype.getSimpleName=function(){return"mousewheel"},u.c([Object(D.c)()],e.prototype,"axisControlRadius",void 0),u.c([Object(D.c)()],e.prototype,"axisControlHeight",void 0),u.c([Object(D.c)()],e.prototype,"axisControlRotation",void 0),u.c([Object(D.c)()],e.prototype,"wheelPrecision",void 0),u.c([Object(D.c)()],e.prototype,"wheelDeltaPercentage",void 0),e}();We.FollowCameraMouseWheelInput=st;var lt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.angularSensibilityX=1,t.angularSensibilityY=1,t.pinchPrecision=1e4,t.pinchDeltaPercentage=0,t.axisXControlRadius=!1,t.axisXControlHeight=!1,t.axisXControlRotation=!0,t.axisYControlRadius=!1,t.axisYControlHeight=!0,t.axisYControlRotation=!1,t.axisPinchControlRadius=!0,t.axisPinchControlHeight=!1,t.axisPinchControlRotation=!1,t.warningEnable=!0,t._warningCounter=0,t}return u.d(t,e),t.prototype.getClassName=function(){return"FollowCameraPointersInput"},t.prototype.onTouch=function(e,t,n){this._warning(),this.axisXControlRotation?this.camera.rotationOffset+=t/this.angularSensibilityX:this.axisYControlRotation&&(this.camera.rotationOffset+=n/this.angularSensibilityX),this.axisXControlHeight?this.camera.heightOffset+=t/this.angularSensibilityY:this.axisYControlHeight&&(this.camera.heightOffset+=n/this.angularSensibilityY),this.axisXControlRadius?this.camera.radius-=t/this.angularSensibilityY:this.axisYControlRadius&&(this.camera.radius-=n/this.angularSensibilityY)},t.prototype.onMultiTouch=function(e,t,n,r,i,o){if(!(0===n&&null===i||0===r&&null===o)){var a=(r-n)/(this.pinchPrecision*(this.angularSensibilityX+this.angularSensibilityY)/2);this.pinchDeltaPercentage?(a*=.01*this.pinchDeltaPercentage,this.axisPinchControlRotation&&(this.camera.rotationOffset+=a*this.camera.rotationOffset),this.axisPinchControlHeight&&(this.camera.heightOffset+=a*this.camera.heightOffset),this.axisPinchControlRadius&&(this.camera.radius-=a*this.camera.radius)):(this.axisPinchControlRotation&&(this.camera.rotationOffset+=a),this.axisPinchControlHeight&&(this.camera.heightOffset+=a),this.axisPinchControlRadius&&(this.camera.radius-=a))}},t.prototype._warning=function(){if(this.warningEnable&&this._warningCounter++%100==0){var e="It probably only makes sense to control ONE camera property with each pointer axis. Set 'warningEnable = false' if you are sure. Currently enabled: ";console.assert(this.axisXControlRotation+this.axisXControlHeight+this.axisXControlRadius<=1,e+"axisXControlRotation: "+this.axisXControlRotation+", axisXControlHeight: "+this.axisXControlHeight+", axisXControlRadius: "+this.axisXControlRadius),console.assert(this.axisYControlRotation+this.axisYControlHeight+this.axisYControlRadius<=1,e+"axisYControlRotation: "+this.axisYControlRotation+", axisYControlHeight: "+this.axisYControlHeight+", axisYControlRadius: "+this.axisYControlRadius),console.assert(this.axisPinchControlRotation+this.axisPinchControlHeight+this.axisPinchControlRadius<=1,e+"axisPinchControlRotation: "+this.axisPinchControlRotation+", axisPinchControlHeight: "+this.axisPinchControlHeight+", axisPinchControlRadius: "+this.axisPinchControlRadius)}},u.c([Object(D.c)()],t.prototype,"angularSensibilityX",void 0),u.c([Object(D.c)()],t.prototype,"angularSensibilityY",void 0),u.c([Object(D.c)()],t.prototype,"pinchPrecision",void 0),u.c([Object(D.c)()],t.prototype,"pinchDeltaPercentage",void 0),u.c([Object(D.c)()],t.prototype,"axisXControlRadius",void 0),u.c([Object(D.c)()],t.prototype,"axisXControlHeight",void 0),u.c([Object(D.c)()],t.prototype,"axisXControlRotation",void 0),u.c([Object(D.c)()],t.prototype,"axisYControlRadius",void 0),u.c([Object(D.c)()],t.prototype,"axisYControlHeight",void 0),u.c([Object(D.c)()],t.prototype,"axisYControlRotation",void 0),u.c([Object(D.c)()],t.prototype,"axisPinchControlRadius",void 0),u.c([Object(D.c)()],t.prototype,"axisPinchControlHeight",void 0),u.c([Object(D.c)()],t.prototype,"axisPinchControlRotation",void 0),t}(et);We.FollowCameraPointersInput=lt;var ut=function(){function e(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this._keys=new Array}return e.prototype.attachControl=function(e,t){var n=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){n._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(e){var r,i=e.event;i.metaKey||(e.type===Ze.a.KEYDOWN?-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)||(-1===(r=n._keys.indexOf(i.keyCode))&&n._keys.push(i.keyCode),t||i.preventDefault()):-1===n.keysUp.indexOf(i.keyCode)&&-1===n.keysDown.indexOf(i.keyCode)&&-1===n.keysLeft.indexOf(i.keyCode)&&-1===n.keysRight.indexOf(i.keyCode)||((r=n._keys.indexOf(i.keyCode))>=0&&n._keys.splice(r,1),t||i.preventDefault()))}))},e.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},e.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var n=this._keys[t],r=e._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(n)?e._localDirection.copyFromFloats(-r,0,0):-1!==this.keysUp.indexOf(n)?e._localDirection.copyFromFloats(0,0,r):-1!==this.keysRight.indexOf(n)?e._localDirection.copyFromFloats(r,0,0):-1!==this.keysDown.indexOf(n)&&e._localDirection.copyFromFloats(0,0,-r),e.getScene().useRightHandedSystem&&(e._localDirection.z*=-1),e.getViewMatrix().invertToRef(e._cameraTransformMatrix),o.x.TransformNormalToRef(e._localDirection,e._cameraTransformMatrix,e._transformedDirection),e.cameraDirection.addInPlace(e._transformedDirection)}},e.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},e.prototype._onLostFocus=function(){this._keys=[]},e.prototype.getSimpleName=function(){return"keyboard"},u.c([Object(D.c)()],e.prototype,"keysUp",void 0),u.c([Object(D.c)()],e.prototype,"keysDown",void 0),u.c([Object(D.c)()],e.prototype,"keysLeft",void 0),u.c([Object(D.c)()],e.prototype,"keysRight",void 0),e}();We.FreeCameraKeyboardMoveInput=ut;var ct=function(){function e(e){void 0===e&&(e=!0),this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null,this.onPointerMovedObservable=new i.c,this._allowCameraRotation=!0}return e.prototype.attachControl=function(e,t){var n=this,r=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(i){var o=i.event;if(!r.isInVRExclusivePointerMode&&(n.touchEnabled||"touch"!==o.pointerType)&&(i.type===Pe.a.POINTERMOVE||-1!==n.buttons.indexOf(o.button))){var a=o.srcElement||o.target;if(i.type===Pe.a.POINTERDOWN&&a){try{a.setPointerCapture(o.pointerId)}catch(e){}n.previousPosition={x:o.clientX,y:o.clientY},t||(o.preventDefault(),e.focus())}else if(i.type===Pe.a.POINTERUP&&a){try{a.releasePointerCapture(o.pointerId)}catch(e){}n.previousPosition=null,t||o.preventDefault()}else if(i.type===Pe.a.POINTERMOVE){if(!n.previousPosition||r.isPointerLock)return;var s=o.clientX-n.previousPosition.x,l=o.clientY-n.previousPosition.y;n.camera.getScene().useRightHandedSystem&&(s*=-1),n.camera.parent&&n.camera.parent._getWorldMatrixDeterminant()<0&&(s*=-1),n._allowCameraRotation&&(n.camera.cameraRotation.y+=s/n.angularSensibility,n.camera.cameraRotation.x+=l/n.angularSensibility),n.onPointerMovedObservable.notifyObservers({offsetX:s,offsetY:l}),n.previousPosition={x:o.clientX,y:o.clientY},t||o.preventDefault()}}}),this._onMouseMove=function(e){if(r.isPointerLock&&!r.isInVRExclusivePointerMode){var i=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0;n.camera.getScene().useRightHandedSystem&&(i*=-1),n.camera.parent&&n.camera.parent._getWorldMatrixDeterminant()<0&&(i*=-1),n.camera.cameraRotation.y+=i/n.angularSensibility;var o=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;n.camera.cameraRotation.x+=o/n.angularSensibility,n.previousPosition=null,t||e.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Pe.a.POINTERDOWN|Pe.a.POINTERUP|Pe.a.POINTERMOVE),e.addEventListener("mousemove",this._onMouseMove,!1),e.addEventListener("contextmenu",this.onContextMenu.bind(this),!1)},e.prototype.onContextMenu=function(e){e.preventDefault()},e.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&e.removeEventListener("mousemove",this._onMouseMove),this.onContextMenu&&e.removeEventListener("contextmenu",this.onContextMenu),this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},e.prototype.getClassName=function(){return"FreeCameraMouseInput"},e.prototype.getSimpleName=function(){return"mouse"},u.c([Object(D.c)()],e.prototype,"buttons",void 0),u.c([Object(D.c)()],e.prototype,"angularSensibility",void 0),e}();We.FreeCameraMouseInput=ct;var ht=function(){function e(){this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array}return e.prototype.attachControl=function(e,t){var n=this,r=null;void 0===this._pointerInput&&(this._onLostFocus=function(){n._offsetX=null,n._offsetY=null},this._pointerInput=function(e){var i=e.event;if("mouse"!==i.pointerType)if(e.type===Pe.a.POINTERDOWN){if(t||i.preventDefault(),n._pointerPressed.push(i.pointerId),1!==n._pointerPressed.length)return;r={x:i.clientX,y:i.clientY}}else if(e.type===Pe.a.POINTERUP){if(t||i.preventDefault(),-1===(o=n._pointerPressed.indexOf(i.pointerId)))return;if(n._pointerPressed.splice(o,1),0!=o)return;r=null,n._offsetX=null,n._offsetY=null}else if(e.type===Pe.a.POINTERMOVE){if(t||i.preventDefault(),!r)return;var o;if(0!=(o=n._pointerPressed.indexOf(i.pointerId)))return;n._offsetX=i.clientX-r.x,n._offsetY=-(i.clientY-r.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,Pe.a.POINTERDOWN|Pe.a.POINTERUP|Pe.a.POINTERMOVE),this._onLostFocus&&e.addEventListener("blur",this._onLostFocus)},e.prototype.detachControl=function(e){this._pointerInput&&e&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},e.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var e=this.camera;if(e.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)e.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var t=e._computeLocalCameraSpeed(),n=new o.x(0,0,t*this._offsetY/this.touchMoveSensibility);o.j.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,e._cameraRotationMatrix),e.cameraDirection.addInPlace(o.x.TransformCoordinates(n,e._cameraRotationMatrix))}}},e.prototype.getClassName=function(){return"FreeCameraTouchInput"},e.prototype.getSimpleName=function(){return"touch"},u.c([Object(D.c)()],e.prototype,"touchAngularSensibility",void 0),u.c([Object(D.c)()],e.prototype,"touchMoveSensibility",void 0),e}();We.FreeCameraTouchInput=ht;var dt=function(e){function t(t){var n=e.call(this,t)||this;return n._mouseInput=null,n}return u.d(t,e),t.prototype.addKeyboard=function(){return this.add(new ut),this},t.prototype.addMouse=function(e){return void 0===e&&(e=!0),this._mouseInput||(this._mouseInput=new ct(e),this.add(this._mouseInput)),this},t.prototype.removeMouse=function(){return this._mouseInput&&this.remove(this._mouseInput),this},t.prototype.addTouch=function(){return this.add(new ht),this},t.prototype.clear=function(){e.prototype.clear.call(this),this._mouseInput=null},t}(Xe);dt.prototype.addDeviceOrientation=function(){return this._deviceOrientationInput||(this._deviceOrientationInput=new ft,this.add(this._deviceOrientationInput)),this};var ft=function(){function e(){var e=this;this._screenOrientationAngle=0,this._screenQuaternion=new o.q,this._alpha=0,this._beta=0,this._gamma=0,this._onDeviceOrientationChangedObservable=new i.c,this._orientationChanged=function(){e._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,e._screenOrientationAngle=-ye.h.ToRadians(e._screenOrientationAngle/2),e._screenQuaternion.copyFromFloats(0,Math.sin(e._screenOrientationAngle),0,Math.cos(e._screenOrientationAngle))},this._deviceOrientation=function(t){e._alpha=null!==t.alpha?t.alpha:0,e._beta=null!==t.beta?t.beta:0,e._gamma=null!==t.gamma?t.gamma:0,null!==t.alpha&&e._onDeviceOrientationChangedObservable.notifyObservers()},this._constantTranform=new o.q(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},set:function(e){var t=this;this._camera=e,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new o.q),this._camera&&this._camera.onDisposeObservable.add(function(){t._onDeviceOrientationChangedObservable.clear()})},enumerable:!0,configurable:!0}),e.prototype.attachControl=function(e,t){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},e.prototype.detachControl=function(e){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation),this._alpha=0},e.prototype.checkInputs=function(){this._alpha&&(o.q.RotationYawPitchRollToRef(ye.h.ToRadians(this._alpha),ye.h.ToRadians(this._beta),-ye.h.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},e.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"deviceOrientation"},e}();We.FreeCameraDeviceOrientationInput=ft;var pt=function(){function e(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=o.j.Identity(),this._deltaTransform=o.x.Zero(),this._vector3=o.x.Zero(),this._vector2=o.w.Zero()}return e.prototype.attachControl=function(e,t){var n=this,r=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=r.onGamepadConnectedObservable.add(function(e){e.type!==Ke.POSE_ENABLED&&(n.gamepad&&e.type!==Ke.XBOX||(n.gamepad=e))}),this._onGamepadDisconnectedObserver=r.onGamepadDisconnectedObservable.add(function(e){n.gamepad===e&&(n.gamepad=null)}),this.gamepad=r.getGamepadByType(Ke.XBOX)},e.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},e.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var e=this.camera,t=this.gamepad.leftStick,n=t.x/this.gamepadMoveSensibility,r=t.y/this.gamepadMoveSensibility;t.x=Math.abs(n)>.005?0+n:0,t.y=Math.abs(r)>.005?0+r:0;var i=this.gamepad.rightStick;if(i){var a=i.x/this.gamepadAngularSensibility,s=i.y/this.gamepadAngularSensibility;i.x=Math.abs(a)>.001?0+a:0,i.y=Math.abs(s)>.001?0+s:0}else i={x:0,y:0};e.rotationQuaternion?e.rotationQuaternion.toRotationMatrix(this._cameraTransform):o.j.RotationYawPitchRollToRef(e.rotation.y,e.rotation.x,0,this._cameraTransform);var l=50*e._computeLocalCameraSpeed();this._vector3.copyFromFloats(t.x*l,0,-t.y*l),o.x.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),e.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(i.y,i.x),e.cameraRotation.addInPlace(this._vector2)}},e.prototype.getClassName=function(){return"FreeCameraGamepadInput"},e.prototype.getSimpleName=function(){return"gamepad"},u.c([Object(D.c)()],e.prototype,"gamepadAngularSensibility",void 0),u.c([Object(D.c)()],e.prototype,"gamepadMoveSensibility",void 0),e}();We.FreeCameraGamepadInput=pt;var mt,gt=n(61);!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(mt||(mt={}));var _t=function(){function e(t){var n=this;if(this._leftJoystick=!!t,e._globalJoystickIndex++,this._axisTargetedByLeftAndRight=mt.X,this._axisTargetedByUpAndDown=mt.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new gt.a,this.deltaPosition=o.x.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(t){e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas&&(e.Canvas.width=e.vjCanvasWidth,e.Canvas.height=e.vjCanvasHeight),e.halfWidth=e.vjCanvasWidth/2},!e.Canvas){window.addEventListener("resize",this._onResize,!1),e.Canvas=document.createElement("canvas"),e.vjCanvasWidth=window.innerWidth,e.vjCanvasHeight=window.innerHeight,e.Canvas.width=window.innerWidth,e.Canvas.height=window.innerHeight,e.Canvas.style.width="100%",e.Canvas.style.height="100%",e.Canvas.style.position="absolute",e.Canvas.style.backgroundColor="transparent",e.Canvas.style.top="0px",e.Canvas.style.left="0px",e.Canvas.style.zIndex="5",e.Canvas.style.msTouchAction="none",e.Canvas.setAttribute("touch-action","none");var r=e.Canvas.getContext("2d");if(!r)throw new Error("Unable to create canvas for virtual joystick");e.vjCanvasContext=r,e.vjCanvasContext.strokeStyle="#ffffff",e.vjCanvasContext.lineWidth=2,document.body.appendChild(e.Canvas)}e.halfWidth=e.Canvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new o.w(0,0),this._joystickPreviousPointerPos=new o.w(0,0),this._joystickPointerStartPos=new o.w(0,0),this._deltaJoystickVector=new o.w(0,0),this._onPointerDownHandlerRef=function(e){n._onPointerDown(e)},this._onPointerMoveHandlerRef=function(e){n._onPointerMove(e)},this._onPointerUpHandlerRef=function(e){n._onPointerUp(e)},e.Canvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),e.Canvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),e.Canvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),e.Canvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),requestAnimationFrame(function(){n._drawVirtualJoystick()})}return e.prototype.setJoystickSensibility=function(e){this._joystickSensibility=e,this._inversedSensibility=1/(this._joystickSensibility/1e3)},e.prototype._onPointerDown=function(t){t.preventDefault(),(!0===this._leftJoystick?t.clientX<e.halfWidth:t.clientX>e.halfWidth)&&this._joystickPointerID<0?(this._joystickPointerID=t.pointerId,this._joystickPointerStartPos.x=t.clientX,this._joystickPointerStartPos.y=t.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(t.pointerId.toString(),t)):e._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(t.pointerId.toString(),{x:t.clientX,y:t.clientY,prevX:t.clientX,prevY:t.clientY}))},e.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var t=(this.reverseLeftRight?-1:1)*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case mt.X:this.deltaPosition.x=Math.min(1,Math.max(-1,t));break;case mt.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,t));break;case mt.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,t))}var n=(this.reverseUpDown?1:-1)*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case mt.X:this.deltaPosition.x=Math.min(1,Math.max(-1,n));break;case mt.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,n));break;case mt.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,n))}}else{var r=this._touches.get(e.pointerId.toString());r&&(r.x=e.clientX,r.y=e.clientY)}},e.prototype._onPointerUp=function(t){if(this._joystickPointerID==t.pointerId)e.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var n=this._touches.get(t.pointerId.toString());n&&e.vjCanvasContext.clearRect(n.prevX-44,n.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(t.pointerId.toString())},e.prototype.setJoystickColor=function(e){this._joystickColor=e},e.prototype.setActionOnTouch=function(e){this._action=e},e.prototype.setAxisForLeftRight=function(e){switch(e){case mt.X:case mt.Y:case mt.Z:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=mt.X}},e.prototype.setAxisForUpDown=function(e){switch(e){case mt.X:case mt.Y:case mt.Z:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=mt.Y}},e.prototype._drawVirtualJoystick=function(){var t=this;this.pressed&&this._touches.forEach(function(n,r){r.pointerId===t._joystickPointerID?(e.vjCanvasContext.clearRect(t._joystickPointerStartPos.x-64,t._joystickPointerStartPos.y-64,128,128),e.vjCanvasContext.clearRect(t._joystickPreviousPointerPos.x-42,t._joystickPreviousPointerPos.y-42,84,84),e.vjCanvasContext.beginPath(),e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.strokeStyle=t._joystickColor,e.vjCanvasContext.arc(t._joystickPointerStartPos.x,t._joystickPointerStartPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=t._joystickColor,e.vjCanvasContext.lineWidth=2,e.vjCanvasContext.arc(t._joystickPointerStartPos.x,t._joystickPointerStartPos.y,60,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle=t._joystickColor,e.vjCanvasContext.arc(t._joystickPointerPos.x,t._joystickPointerPos.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),t._joystickPreviousPointerPos=t._joystickPointerPos.clone()):(e.vjCanvasContext.clearRect(r.prevX-44,r.prevY-44,88,88),e.vjCanvasContext.beginPath(),e.vjCanvasContext.fillStyle="white",e.vjCanvasContext.beginPath(),e.vjCanvasContext.strokeStyle="red",e.vjCanvasContext.lineWidth=6,e.vjCanvasContext.arc(r.x,r.y,40,0,2*Math.PI,!0),e.vjCanvasContext.stroke(),e.vjCanvasContext.closePath(),r.prevX=r.x,r.prevY=r.y)}),requestAnimationFrame(function(){t._drawVirtualJoystick()})},e.prototype.releaseCanvas=function(){e.Canvas&&(e.Canvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),e.Canvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),e.Canvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),e.Canvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(e.Canvas),e.Canvas=null)},e._globalJoystickIndex=0,e}();dt.prototype.addVirtualJoystick=function(){return this.add(new vt),this};var vt=function(){function e(){}return e.prototype.getLeftJoystick=function(){return this._leftjoystick},e.prototype.getRightJoystick=function(){return this._rightjoystick},e.prototype.checkInputs=function(){if(this._leftjoystick){var e=this.camera,t=50*e._computeLocalCameraSpeed(),n=o.j.RotationYawPitchRoll(e.rotation.y,e.rotation.x,0),r=o.x.TransformCoordinates(new o.x(this._leftjoystick.deltaPosition.x*t,this._leftjoystick.deltaPosition.y*t,this._leftjoystick.deltaPosition.z*t),n);e.cameraDirection=e.cameraDirection.add(r),e.cameraRotation=e.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},e.prototype.attachControl=function(e,t){this._leftjoystick=new _t(!0),this._leftjoystick.setAxisForUpDown(mt.Z),this._leftjoystick.setAxisForLeftRight(mt.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new _t(!1),this._rightjoystick.setAxisForUpDown(mt.X),this._rightjoystick.setAxisForLeftRight(mt.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},e.prototype.detachControl=function(e){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},e.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},e.prototype.getSimpleName=function(){return"virtualJoystick"},e}();We.FreeCameraVirtualJoystickInput=vt;var yt=function(e){function t(t,n,r,i){void 0===i&&(i=!0);var a=e.call(this,t,n,r,i)||this;return a.cameraDirection=new o.x(0,0,0),a.cameraRotation=new o.w(0,0),a.updateUpVectorFromRotation=!1,a._tmpQuaternion=new o.q,a.rotation=new o.x(0,0,0),a.speed=2,a.noRotationConstraint=!1,a.lockedTarget=null,a._currentTarget=o.x.Zero(),a._initialFocalDistance=1,a._viewMatrix=o.j.Zero(),a._camMatrix=o.j.Zero(),a._cameraTransformMatrix=o.j.Zero(),a._cameraRotationMatrix=o.j.Zero(),a._referencePoint=new o.x(0,0,1),a._transformedReferencePoint=o.x.Zero(),a._globalCurrentTarget=o.x.Zero(),a._globalCurrentUpVector=o.x.Zero(),a._defaultUp=o.x.Up(),a._cachedRotationZ=0,a._cachedQuaternionRotationZ=0,a}return u.d(t,e),t.prototype.getFrontPosition=function(e){this.getWorldMatrix();var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),e.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.lockedTarget=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new o.q(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this);var n=this._getLockedTargetPosition();n?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(n):this._cache.lockedTarget=n.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!e.prototype._isSynchronizedViewMatrix.call(this))return!1;var t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},t.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=o.h),o.j.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var t=e.subtract(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&o.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(o.t.Matrix[0]),o.x.TransformNormalToRef(this.cameraDirection,o.t.Matrix[0],o.t.Vector3[0]),void this.position.addInPlace(o.t.Vector3[0]);this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var t=this._decideIfNeedsToMove(),n=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(t&&this._updatePosition(),n&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion&&this.rotation.lengthSquared()&&o.q.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion),!this.noRotationConstraint)){var r=Math.PI/2*.95;this.rotation.x>r&&(this.rotation.x=r),this.rotation.x<-r&&(this.rotation.x=-r)}t&&(Math.abs(this.cameraDirection.x)<this.speed*o.h&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*o.h&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*o.h&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<this.speed*o.h&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*o.h&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),e.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):o.j.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return o.x.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),o.x.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?o.c.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(o.q.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),o.c.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(e,t,n){if(this.parent){var r=this.parent.getWorldMatrix();o.x.TransformCoordinatesToRef(e,r,this._globalPosition),o.x.TransformCoordinatesToRef(t,r,this._globalCurrentTarget),o.x.TransformNormalToRef(n,r,this._globalCurrentUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._globalCurrentTarget.copyFrom(t),this._globalCurrentUpVector.copyFrom(n);this.getScene().useRightHandedSystem?o.j.LookAtRHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix):o.j.LookAtLHToRef(this._globalPosition,this._globalCurrentTarget,this._globalCurrentUpVector,this._viewMatrix)},t.prototype.createRigCamera=function(e,n){if(this.cameraRigMode!==Ne.a.RIG_MODE_NONE){var r=new t(e,this.position.clone(),this.getScene());return this.cameraRigMode!==Ne.a.RIG_MODE_VR&&this.cameraRigMode!==Ne.a.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new o.q),r._cameraRigParams={},r.rotationQuaternion=new o.q),r}return null},t.prototype._updateRigCameras=function(){var t=this._rigCameras[0],n=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:var r=this.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,i=this.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*r,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,n);break;case Ne.a.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),n.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),n.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),n.position.copyFrom(this.position)}e.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(e,n){this.getTarget().subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var r=t._TargetFocalPoint.addInPlace(this.position);o.j.TranslationToRef(-r.x,-r.y,-r.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(o.j.RotationY(e),t._RigCamTransformMatrix),o.j.TranslationToRef(r.x,r.y,r.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),o.x.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,n.position),n.setTarget(r)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new o.j,t._TargetTransformMatrix=new o.j,t._TargetFocalPoint=new o.x,u.c([Object(D.o)()],t.prototype,"rotation",void 0),u.c([Object(D.c)()],t.prototype,"speed",void 0),u.c([Object(D.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(Ne.a),bt=function(e){function t(t,n,r,i){void 0===i&&(i=!0);var a=e.call(this,t,n,r,i)||this;return a.ellipsoid=new o.x(.5,1,.5),a.ellipsoidOffset=new o.x(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a._needMoveForGravity=!1,a._oldPosition=o.x.Zero(),a._diffPosition=o.x.Zero(),a._newPosition=o.x.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(e,t,n){var r;void 0===n&&(n=null),r=t,a._newPosition.copyFrom(r),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>ge.b.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&n&&a.onCollide(n))},a.inputs=new dt(a),a.inputs.addKeyboard().addMouse(),a}return u.d(t,e),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this.cameraDirection=new o.x(0,0,0),this.cameraRotation=new o.w(0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?o.x.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var n=e;this.applyGravity&&(n=e.add(this.getScene().gravity)),t.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=o.x.Zero(),this._transformedDirection=o.x.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},t.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FreeCamera"},u.c([Object(D.o)()],t.prototype,"ellipsoid",void 0),u.c([Object(D.o)()],t.prototype,"ellipsoidOffset",void 0),u.c([Object(D.c)()],t.prototype,"checkCollisions",void 0),u.c([Object(D.c)()],t.prototype,"applyGravity",void 0),t}(yt);F.a.AddNodeConstructor("TouchCamera",function(e,t){return function(){return new Et(e,o.x.Zero(),t)}});var Et=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.inputs.addTouch(),i._setupInputs(),i}return u.d(t,e),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.mouse;e&&(e.touchEnabled=!1)},t}(bt);F.a.AddNodeConstructor("ArcRotateCamera",function(e,t){return function(){return new xt(e,0,0,1,o.x.Zero(),t)}});var xt=function(e){function t(t,n,r,a,s,l,u){void 0===u&&(u=!0);var c=e.call(this,t,o.x.Zero(),l,u)||this;return c._upVector=o.x.Up(),c.inertialAlphaOffset=0,c.inertialBetaOffset=0,c.inertialRadiusOffset=0,c.lowerAlphaLimit=null,c.upperAlphaLimit=null,c.lowerBetaLimit=.01,c.upperBetaLimit=Math.PI-.01,c.lowerRadiusLimit=null,c.upperRadiusLimit=null,c.inertialPanningX=0,c.inertialPanningY=0,c.pinchToPanMaxDistance=20,c.panningDistanceLimit=null,c.panningOriginTarget=o.x.Zero(),c.panningInertia=.9,c.zoomOnFactor=1,c.targetScreenOffset=o.w.Zero(),c.allowUpsideDown=!0,c.useInputToRestoreState=!0,c._viewMatrix=new o.j,c.panningAxis=new o.x(1,1,0),c.onMeshTargetChangedObservable=new i.c,c.checkCollisions=!1,c.collisionRadius=new o.x(.5,.5,.5),c._previousPosition=o.x.Zero(),c._collisionVelocity=o.x.Zero(),c._newPosition=o.x.Zero(),c._computationVector=o.x.Zero(),c._onCollisionPositionChange=function(e,t,n){void 0===n&&(n=null),n?(c.setPosition(t),c.onCollide&&c.onCollide(n)):c._previousPosition.copyFrom(c._position);var r=Math.cos(c.alpha),i=Math.sin(c.alpha),o=Math.cos(c.beta),a=Math.sin(c.beta);0===a&&(a=1e-4);var s=c._getTargetPosition();c._computationVector.copyFromFloats(c.radius*r*a,c.radius*o,c.radius*i*a),s.addToRef(c._computationVector,c._newPosition),c._position.copyFrom(c._newPosition);var l=c.upVector;c.allowUpsideDown&&c.beta<0&&(l=(l=l.clone()).negate()),c._computeViewMatrix(c._position,s,l),c._viewMatrix.addAtIndex(12,c.targetScreenOffset.x),c._viewMatrix.addAtIndex(13,c.targetScreenOffset.y),c._collisionTriggered=!1},c._target=o.x.Zero(),s&&c.setTarget(s),c.alpha=n,c.beta=r,c.radius=a,c.getViewMatrix(),c.inputs=new nt(c),c.inputs.addKeyboard().addMouseWheel().addPointers(),c}return u.d(t,e),Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new o.j,this._upToYMatrix=new o.j,this._upVector=o.x.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!0,configurable:!0}),t.prototype.setMatUp=function(){o.j.RotationAlignToRef(o.x.UpReadOnly,this._upVector,this._YToUpMatrix),o.j.RotationAlignToRef(this._upVector,o.x.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Re,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new Ce,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Me,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache._target=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=o.w.Zero()},t.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.absolutePosition;this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var t=this._getLockedTargetPosition();return t||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),e.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return!!e.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},t.prototype._isSynchronizedViewMatrix=function(){return!!e.prototype._isSynchronizedViewMatrix.call(this)&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)},t.prototype.attachControl=function(e,t,n,r){var i=this;void 0===n&&(n=!0),void 0===r&&(r=2),this._useCtrlForPanning=n,this._panningMouseButton=r,this.inputs.attachElement(e,t),this._reset=function(){i.inertialAlphaOffset=0,i.inertialBetaOffset=0,i.inertialRadiusOffset=0,i.inertialPanningX=0,i.inertialPanningY=0}},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){var t=this.inertialAlphaOffset;this.beta<=0&&(t*=-1),this.getScene().useRightHandedSystem&&(t*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.alpha+=t,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<o.h&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<o.h&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*o.h&&(this.inertialRadiusOffset=0)}0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=o.x.Zero(),this._transformedDirection=o.x.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),o.x.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),o.x.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*o.h&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*o.h&&(this.inertialPanningY=0)),this._checkLimits(),e.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.x.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4),0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),e.getBoundingInfo)this._targetBoundingCenter=t?e.getBoundingInfo().boundingBox.centerWorld.clone():null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var r=e,i=this._getTargetPosition();if(i&&!n&&i.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),t=Math.sin(this.alpha),n=Math.cos(this.beta),r=Math.sin(this.beta);0===r&&(r=1e-4);var i=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*r,this.radius*n,this.radius*t*r),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.x.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),i.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var a=this.getScene().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var s=this.upVector;this.allowUpsideDown&&r<0&&(s=(s=s.clone()).negate()),this._computeViewMatrix(this._position,i,s),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=i,this._viewMatrix},t.prototype.zoomOn=function(e,t){void 0===t&&(t=!1),e=e||this.getScene().meshes;var n=fe.a.MinMax(e),r=o.x.Distance(n.min,n.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:r},t)},t.prototype.focusOn=function(e,t){var n,r;if(void 0===t&&(t=!1),void 0===e.min){var i=e||this.getScene().meshes;n=fe.a.MinMax(i),r=o.x.Distance(n.min,n.max)}else n=e,r=e.distance;this._target=fe.a.Center(n),t||(this.maxZ=2*r)},t.prototype.createRigCamera=function(e,n){var r=0;switch(this.cameraRigMode){case Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ne.a.RIG_MODE_VR:r=this._cameraRigParams.stereoHalfAngle*(0===n?1:-1);break;case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:r=this._cameraRigParams.stereoHalfAngle*(0===n?-1:1)}var i=new t(e,this.alpha+r,this.beta,this.radius,this._target,this.getScene());return i._cameraRigParams={},i},t.prototype._updateRigCameras=function(){var t=this._rigCameras[0],n=this._rigCameras[1];switch(t.beta=n.beta=this.beta,this.cameraRigMode){case Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Ne.a.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}e.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},u.c([Object(D.c)()],t.prototype,"alpha",void 0),u.c([Object(D.c)()],t.prototype,"beta",void 0),u.c([Object(D.c)()],t.prototype,"radius",void 0),u.c([Object(D.o)("target")],t.prototype,"_target",void 0),u.c([Object(D.o)("upVector")],t.prototype,"_upVector",void 0),u.c([Object(D.c)()],t.prototype,"inertialAlphaOffset",void 0),u.c([Object(D.c)()],t.prototype,"inertialBetaOffset",void 0),u.c([Object(D.c)()],t.prototype,"inertialRadiusOffset",void 0),u.c([Object(D.c)()],t.prototype,"lowerAlphaLimit",void 0),u.c([Object(D.c)()],t.prototype,"upperAlphaLimit",void 0),u.c([Object(D.c)()],t.prototype,"lowerBetaLimit",void 0),u.c([Object(D.c)()],t.prototype,"upperBetaLimit",void 0),u.c([Object(D.c)()],t.prototype,"lowerRadiusLimit",void 0),u.c([Object(D.c)()],t.prototype,"upperRadiusLimit",void 0),u.c([Object(D.c)()],t.prototype,"inertialPanningX",void 0),u.c([Object(D.c)()],t.prototype,"inertialPanningY",void 0),u.c([Object(D.c)()],t.prototype,"pinchToPanMaxDistance",void 0),u.c([Object(D.c)()],t.prototype,"panningDistanceLimit",void 0),u.c([Object(D.o)()],t.prototype,"panningOriginTarget",void 0),u.c([Object(D.c)()],t.prototype,"panningInertia",void 0),u.c([Object(D.c)()],t.prototype,"zoomOnFactor",void 0),u.c([Object(D.c)()],t.prototype,"targetScreenOffset",void 0),u.c([Object(D.c)()],t.prototype,"allowUpsideDown",void 0),u.c([Object(D.c)()],t.prototype,"useInputToRestoreState",void 0),t}(yt);F.a.AddNodeConstructor("DeviceOrientationCamera",function(e,t){return function(){return new Tt(e,o.x.Zero(),t)}});var Tt=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i._tmpDragQuaternion=new o.q,i._disablePointerInputWhenUsingDeviceOrientation=!0,i._dragFactor=0,i._quaternionCache=new o.q,i.inputs.addDeviceOrientation(),i.inputs._deviceOrientationInput&&i.inputs._deviceOrientationInput._onDeviceOrientationChangedObservable.addOnce(function(){i._disablePointerInputWhenUsingDeviceOrientation&&i.inputs._mouseInput&&(i.inputs._mouseInput._allowCameraRotation=!1,i.inputs._mouseInput.onPointerMovedObservable.add(function(e){0!=i._dragFactor&&(i._initialQuaternion||(i._initialQuaternion=new o.q),o.q.FromEulerAnglesToRef(0,e.offsetX*i._dragFactor,0,i._tmpDragQuaternion),i._initialQuaternion.multiplyToRef(i._tmpDragQuaternion,i._initialQuaternion))}))}),i}return u.d(t,e),t.prototype.enableHorizontalDragging=function(e){void 0===e&&(e=1/300),this._dragFactor=e},t.prototype.getClassName=function(){return"DeviceOrientationCamera"},t.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},t.prototype.resetToCurrentRotation=function(e){var t=this;void 0===e&&(e=o.c.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new o.q),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(n){e[n]?t._initialQuaternion[n]*=-1:t._initialQuaternion[n]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},t}(bt),St=function(e){function t(t){return e.call(this,t)||this}return u.d(t,e),t.prototype.addKeyboard=function(){return this.add(new it),this},t.prototype.addMouse=function(e){return void 0===e&&(e=!0),this.add(new ot(e)),this},t}(Xe),At=function(e){function t(t,n,r,i){void 0===i&&(i=!0);var a=e.call(this,t,n,r,i)||this;return a.ellipsoid=new o.x(1,1,1),a.ellipsoidOffset=new o.x(0,0,0),a.checkCollisions=!1,a.applyGravity=!1,a.cameraDirection=o.x.Zero(),a._trackRoll=0,a.rollCorrect=100,a.bankedTurn=!1,a.bankedTurnLimit=Math.PI/2,a.bankedTurnMultiplier=1,a._needMoveForGravity=!1,a._oldPosition=o.x.Zero(),a._diffPosition=o.x.Zero(),a._newPosition=o.x.Zero(),a._collisionMask=-1,a._onCollisionPositionChange=function(e,t,n){var r;void 0===n&&(n=null),r=t,a._newPosition.copyFrom(r),a._newPosition.subtractToRef(a._oldPosition,a._diffPosition),a._diffPosition.length()>ge.b.CollisionsEpsilon&&(a.position.addInPlace(a._diffPosition),a.onCollide&&n&&a.onCollide(n))},a.inputs=new St(a),a.inputs.addKeyboard().addMouse(),a}return u.d(t,e),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysForward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysForward:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysForward=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysBackward",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysBackward:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysBackward=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this.cameraDirection=new o.x(0,0,0)},Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),t.prototype._collideWithWorld=function(e){(this.parent?o.x.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position).subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);var t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var n=e;this.applyGravity&&(n=e.add(this.getScene().gravity)),t.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},t.prototype._checkInputs=function(){this._localDirection||(this._localDirection=o.x.Zero(),this._transformedDirection=o.x.Zero()),this.inputs.checkInputs(),e.prototype._checkInputs.call(this)},t.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):e.prototype._updatePosition.call(this)},t.prototype.restoreRoll=function(e){var t=this._trackRoll,n=t-this.rotation.z;Math.abs(n)>=.001&&(this.rotation.z+=n/e,Math.abs(t-this.rotation.z)<=.001&&(this.rotation.z=t))},t.prototype.dispose=function(){this.inputs.clear(),e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"FlyCamera"},u.c([Object(D.o)()],t.prototype,"ellipsoid",void 0),u.c([Object(D.o)()],t.prototype,"ellipsoidOffset",void 0),u.c([Object(D.c)()],t.prototype,"checkCollisions",void 0),u.c([Object(D.c)()],t.prototype,"applyGravity",void 0),t}(yt),Pt=function(e){function t(t){return e.call(this,t)||this}return u.d(t,e),t.prototype.addKeyboard=function(){return this.add(new at),this},t.prototype.addMouseWheel=function(){return this.add(new st),this},t.prototype.addPointers=function(){return this.add(new lt),this},t.prototype.addVRDeviceOrientation=function(){return console.warn("DeviceOrientation support not yet implemented for FollowCamera."),this},t}(Xe);F.a.AddNodeConstructor("FollowCamera",function(e,t){return function(){return new Rt(e,o.x.Zero(),t)}}),F.a.AddNodeConstructor("ArcFollowCamera",function(e,t){return function(){return new Ct(e,0,0,1,null,t)}});var Mt,Rt=function(e){function t(t,n,r,i){void 0===i&&(i=null);var o=e.call(this,t,n,r)||this;return o.radius=12,o.lowerRadiusLimit=null,o.upperRadiusLimit=null,o.rotationOffset=0,o.lowerRotationOffsetLimit=null,o.upperRotationOffsetLimit=null,o.heightOffset=4,o.lowerHeightOffsetLimit=null,o.upperHeightOffsetLimit=null,o.cameraAcceleration=.05,o.maxCameraSpeed=20,o.lockedTarget=i,o.inputs=new Pt(o),o.inputs.addKeyboard().addMouseWheel().addPointers(),o}return u.d(t,e),t.prototype._follow=function(e){if(e){var t;if(e.rotationQuaternion){var n=new o.j;e.rotationQuaternion.toRotationMatrix(n),t=Math.atan2(n.m[8],n.m[10])}else t=e.rotation.y;var r=ye.h.ToRadians(this.rotationOffset)+t,i=e.getAbsolutePosition(),a=i.x+Math.sin(r)*this.radius,s=i.z+Math.cos(r)*this.radius,l=a-this.position.x,u=i.y+this.heightOffset-this.position.y,c=s-this.position.z,h=l*this.cameraAcceleration*2,d=u*this.cameraAcceleration,f=c*this.cameraAcceleration*2;(h>this.maxCameraSpeed||h<-this.maxCameraSpeed)&&(h=h<1?-this.maxCameraSpeed:this.maxCameraSpeed),(d>this.maxCameraSpeed||d<-this.maxCameraSpeed)&&(d=d<1?-this.maxCameraSpeed:this.maxCameraSpeed),(f>this.maxCameraSpeed||f<-this.maxCameraSpeed)&&(f=f<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new o.x(this.position.x+h,this.position.y+d,this.position.z+f),this.setTarget(i)}},t.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t),this._reset=function(){}},t.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},t.prototype._checkInputs=function(){this.inputs.checkInputs(),this._checkLimits(),e.prototype._checkInputs.call(this),this.lockedTarget&&this._follow(this.lockedTarget)},t.prototype._checkLimits=function(){null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit),null!==this.lowerHeightOffsetLimit&&this.heightOffset<this.lowerHeightOffsetLimit&&(this.heightOffset=this.lowerHeightOffsetLimit),null!==this.upperHeightOffsetLimit&&this.heightOffset>this.upperHeightOffsetLimit&&(this.heightOffset=this.upperHeightOffsetLimit),null!==this.lowerRotationOffsetLimit&&this.rotationOffset<this.lowerRotationOffsetLimit&&(this.rotationOffset=this.lowerRotationOffsetLimit),null!==this.upperRotationOffsetLimit&&this.rotationOffset>this.upperRotationOffsetLimit&&(this.rotationOffset=this.upperRotationOffsetLimit)},t.prototype.getClassName=function(){return"FollowCamera"},u.c([Object(D.c)()],t.prototype,"radius",void 0),u.c([Object(D.c)()],t.prototype,"lowerRadiusLimit",void 0),u.c([Object(D.c)()],t.prototype,"upperRadiusLimit",void 0),u.c([Object(D.c)()],t.prototype,"rotationOffset",void 0),u.c([Object(D.c)()],t.prototype,"lowerRotationOffsetLimit",void 0),u.c([Object(D.c)()],t.prototype,"upperRotationOffsetLimit",void 0),u.c([Object(D.c)()],t.prototype,"heightOffset",void 0),u.c([Object(D.c)()],t.prototype,"lowerHeightOffsetLimit",void 0),u.c([Object(D.c)()],t.prototype,"upperHeightOffsetLimit",void 0),u.c([Object(D.c)()],t.prototype,"cameraAcceleration",void 0),u.c([Object(D.c)()],t.prototype,"maxCameraSpeed",void 0),u.c([Object(D.k)("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(yt),Ct=function(e){function t(t,n,r,i,a,s){var l=e.call(this,t,o.x.Zero(),s)||this;return l.alpha=n,l.beta=r,l.radius=i,l.target=a,l._cartesianCoordinates=o.x.Zero(),l._follow(),l}return u.d(t,e),t.prototype._follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this.target.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},t.prototype._checkInputs=function(){e.prototype._checkInputs.call(this),this._follow()},t.prototype.getClassName=function(){return"ArcFollowCamera"},t}(yt),wt=n(35),Ot=n(39);!function(e){e[e.VIVE=0]="VIVE",e[e.OCULUS=1]="OCULUS",e[e.WINDOWS=2]="WINDOWS",e[e.GEAR_VR=3]="GEAR_VR",e[e.DAYDREAM=4]="DAYDREAM",e[e.GENERIC=5]="GENERIC"}(Mt||(Mt={}));var It,Dt,Lt=function(){function e(){}return e.InitiateController=function(e){for(var t=0,n=this._ControllerFactories;t<n.length;t++){var r=n[t];if(r.canCreate(e))return r.create(e)}if(this._DefaultControllerFactory)return this._DefaultControllerFactory(e);throw"The type of gamepad you are trying to load needs to be imported first or is not supported."},e._ControllerFactories=[],e._DefaultControllerFactory=null,e}(),Ft=function(e){function t(t){var n=e.call(this,t.id,t.index,t)||this;return n._deviceRoomPosition=o.x.Zero(),n._deviceRoomRotationQuaternion=new o.q,n.devicePosition=o.x.Zero(),n.deviceRotationQuaternion=new o.q,n.deviceScaleFactor=1,n._trackPosition=!0,n._maxRotationDistFromHeadset=Math.PI/5,n._draggedRoomRotation=0,n._leftHandSystemQuaternion=new o.q,n._deviceToWorld=o.j.Identity(),n._pointingPoseNode=null,n._workingMatrix=o.j.Identity(),n._meshAttachedObservable=new i.c,n.type=Ke.POSE_ENABLED,n.controllerType=Mt.GENERIC,n.position=o.x.Zero(),n.rotationQuaternion=new o.q,n._calculatedPosition=o.x.Zero(),n._calculatedRotation=new o.q,o.q.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return u.d(t,e),t.prototype._disableTrackPosition=function(e){this._trackPosition&&(this._calculatedPosition.copyFrom(e),this._trackPosition=!1)},t.prototype.update=function(){e.prototype.update.call(this),this._updatePoseAndMesh()},t.prototype._updatePoseAndMesh=function(){var e=this.browserGamepad.pose;if(this.updateFromDevice(e),!this._trackPosition&&P.a.LastCreatedScene&&P.a.LastCreatedScene.activeCamera&&P.a.LastCreatedScene.activeCamera.devicePosition&&((t=P.a.LastCreatedScene.activeCamera)._computeDevicePosition(),this._deviceToWorld.setTranslation(t.devicePosition),t.deviceRotationQuaternion)){var t;(t=t)._deviceRoomRotationQuaternion.toEulerAnglesToRef(o.t.Vector3[0]);var n=Math.atan2(Math.sin(o.t.Vector3[0].y-this._draggedRoomRotation),Math.cos(o.t.Vector3[0].y-this._draggedRoomRotation));if(Math.abs(n)>this._maxRotationDistFromHeadset){var r=n-(n<0?-this._maxRotationDistFromHeadset:this._maxRotationDistFromHeadset);this._draggedRoomRotation+=r;var i=Math.sin(-r),a=Math.cos(-r);this._calculatedPosition.x=this._calculatedPosition.x*a-this._calculatedPosition.z*i,this._calculatedPosition.z=this._calculatedPosition.x*i+this._calculatedPosition.z*a}}o.x.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),o.q.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},t.prototype.updateFromDevice=function(e){if(e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._trackPosition&&this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var t=this.rawPose;e.orientation&&t.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},t.prototype.attachToMesh=function(e){if(this._mesh&&(this._mesh.parent=null),this._mesh=e,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new o.q),this._updatePoseAndMesh(),this._pointingPoseNode){for(var t=[],n=this._pointingPoseNode;n.parent;)t.push(n.parent),n=n.parent;t.reverse().forEach(function(e){e.computeWorldMatrix(!0)})}this._meshAttachedObservable.notifyObservers(e)},t.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},t.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),t.prototype.getForwardRay=function(e){if(void 0===e&&(e=100),!this.mesh)return new Ot.a(o.x.Zero(),new o.x(0,0,1),e);var t=this._pointingPoseNode?this._pointingPoseNode.getWorldMatrix():this.mesh.getWorldMatrix(),n=t.getTranslation(),r=new o.x(0,0,-1),i=o.x.TransformNormal(r,t),a=o.x.Normalize(i);return new Ot.a(n,a,e)},t.POINTING_POSE="POINTING_POSE",t}(Ke);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(It||(It={})),function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(Dt||(Dt={}));var Nt=function(e){function t(t,n,r,o){void 0===o&&(o=!1);var a=e.call(this,t,n,r,0,1,2,3)||this;return a._leftTrigger=0,a._rightTrigger=0,a.onButtonDownObservable=new i.c,a.onButtonUpObservable=new i.c,a.onPadDownObservable=new i.c,a.onPadUpObservable=new i.c,a._buttonA=0,a._buttonB=0,a._buttonX=0,a._buttonY=0,a._buttonBack=0,a._buttonStart=0,a._buttonLB=0,a._buttonRB=0,a._buttonLeftStick=0,a._buttonRightStick=0,a._dPadUp=0,a._dPadDown=0,a._dPadLeft=0,a._dPadRight=0,a._isXboxOnePad=!1,a.type=Ke.XBOX,a._isXboxOnePad=o,a}return u.d(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,n){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(n),this.onButtonDownObservable.notifyObservers(n)),0===e&&(this._onbuttonup&&this._onbuttonup(n),this.onButtonUpObservable.notifyObservers(n))),e},t.prototype._setDPadValue=function(e,t,n){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(n),this.onPadDownObservable.notifyObservers(n)),0===e&&(this._ondpadup&&this._ondpadup(n),this.onPadUpObservable.notifyObservers(n))),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,It.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,It.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,It.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,It.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,It.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,It.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,It.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,It.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,It.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,It.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,Dt.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,Dt.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,Dt.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,Dt.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},t}(Ke),Bt=function(){function e(e){var t=this;this._scene=e,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new i.c,wt.a.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new i.c(function(e){for(var n in t._babylonGamepads){var r=t._babylonGamepads[n];r&&r._isConnected&&t.onGamepadConnectedObservable.notifyObserver(e,r)}}),this._onGamepadConnectedEvent=function(e){var n,r=e.gamepad;r.index in t._babylonGamepads&&t._babylonGamepads[r.index].isConnected||(t._babylonGamepads[r.index]?((n=t._babylonGamepads[r.index]).browserGamepad=r,n._isConnected=!0):n=t._addNewGamepad(r),t.onGamepadConnectedObservable.notifyObservers(n),t._startMonitoringGamepads())},this._onGamepadDisconnectedEvent=function(e){var n=e.gamepad;for(var r in t._babylonGamepads)if(t._babylonGamepads[r].index===n.index){var i=t._babylonGamepads[r];i._isConnected=!1,t.onGamepadDisconnectedObservable.notifyObservers(i);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(e.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),e.prototype.getGamepadByType=function(e){void 0===e&&(e=Ke.XBOX);for(var t=0,n=this._babylonGamepads;t<n.length;t++){var r=n[t];if(r&&r.type===e)return r}return null},e.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(e){e.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},e.prototype._addNewGamepad=function(e){var t;this._oneGamepadConnected||(this._oneGamepadConnected=!0);var n=-1!==e.id.search("Xbox One");return t=n||-1!==e.id.search("Xbox 360")||-1!==e.id.search("xinput")?new Nt(e.id,e.index,e,n):e.pose?Lt.InitiateController(e):new qe(e.id,e.index,e),this._babylonGamepads[t.index]=t,t},e.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;for(var t in this._updateGamepadObjects(),this._babylonGamepads){var n=this._babylonGamepads[t];n&&n.isConnected&&n.update()}this._isMonitoring&&!this._scene&&ye.h.QueueNewFrame(function(){e._checkGamepadsStatus()})},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++){var n=e[t];if(n)if(this._babylonGamepads[n.index])this._babylonGamepads[t].browserGamepad=n,this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{var r=this._addNewGamepad(n);this.onGamepadConnectedObservable.notifyObservers(r)}}},e}();Object.defineProperty(W.a.prototype,"gamepadManager",{get:function(){if(!this._gamepadManager){this._gamepadManager=new Bt(this);var e=this._getComponent(Te.a.NAME_GAMEPAD);e||(e=new Ut(this),this._addComponent(e))}return this._gamepadManager},enumerable:!0,configurable:!0}),dt.prototype.addGamepad=function(){return this.add(new pt),this},nt.prototype.addGamepad=function(){return this.add(new Qe),this};var Ut=function(){function e(e){this.name=Te.a.NAME_GAMEPAD,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(Te.a.STEP_BEFORECAMERAUPDATE_GAMEPAD,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){var e=this.scene._gamepadManager;e&&(e.dispose(),this.scene._gamepadManager=null)},e.prototype._beforeCameraUpdate=function(){var e=this.scene._gamepadManager;e&&e._isMonitoring&&e._checkGamepadsStatus()},e}();F.a.AddNodeConstructor("FreeCamera",function(e,t){return function(){return new kt(e,o.x.Zero(),t)}});var kt=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.inputs.addGamepad(),i}return u.d(t,e),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(Et);Ne.a._createDefaultParsedCamera=function(e,t){return new kt(e,o.x.Zero(),t)},F.a.AddNodeConstructor("GamepadCamera",function(e,t){return function(){return new Vt(e,o.x.Zero(),t)}});var Vt=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return u.d(t,e),t.prototype.getClassName=function(){return"GamepadCamera"},t}(kt),Gt=n(28),zt=n(5);zt.a.ShadersStore.postprocessVertexShader="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}";var jt=function(){function e(e,t,n,r,a,s,l,u,c,h,d,f,p,g){void 0===l&&(l=m.a.TEXTURE_NEAREST_SAMPLINGMODE),void 0===h&&(h=null),void 0===d&&(d=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===f&&(f="postprocess"),void 0===g&&(g=!1),this.name=e,this.width=-1,this.height=-1,this._outputTexture=null,this.autoClear=!0,this.alphaMode=m.a.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=m.a.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new Gt.a(2),this._currentRenderTextureInd=0,this._scaleRatio=new o.w(1,1),this._texelSize=o.w.Zero(),this.onActivateObservable=new i.c,this.onSizeChangedObservable=new i.c,this.onApplyObservable=new i.c,this.onBeforeRenderObservable=new i.c,this.onAfterRenderObservable=new i.c,null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):u&&(this._engine=u,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=l||m.a.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=c||!1,this._textureType=d,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=f,this._parameters=n||[],this._parameters.push("scale"),this._indexParameters=p,g||this.updateEffect(h)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=e,this._textures.forEach(function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)})},enumerable:!0,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!0,configurable:!0}),e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._effect},e.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new Gt.a(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(e,t,n,r,i,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],t||this._parameters,n||this._samplers,null!==e?e:"",void 0,i,o,r||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype.activate=function(e,t,n){var r=this;void 0===t&&(t=null);var i=(e=e||this._camera).getScene(),o=i.getEngine(),a=o.getCaps().maxTextureSize,s=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,l=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0,u=e.parent;!u||u.leftCamera!=e&&u.rightCamera!=e||(s/=2);var c,h=this._options.width||s,d=this._options.height||l;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var f=o.currentViewport;f&&(h*=f.width,d*=f.height)}if((this.renderTargetSamplingMode===m.a.TEXTURE_TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(h=o.needPOTTextures?ye.h.GetExponentOfTwo(h,a,this.scaleMode):h),this._options.height||(d=o.needPOTTextures?ye.h.GetExponentOfTwo(d,a,this.scaleMode):d)),this.width!==h||this.height!==d){if(this._textures.length>0){for(var p=0;p<this._textures.length;p++)this._engine._releaseTexture(this._textures.data[p]);this._textures.reset()}this.width=h,this.height=d;var g={width:this.width,height:this.height},_={generateMipMaps:!1,generateDepthBuffer:n||0===e._postProcesses.indexOf(this),generateStencilBuffer:(n||0===e._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(g,_)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(g,_)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(e){e.samples!==r.samples&&r._engine.updateRenderTargetTextureSampleCount(e,r.samples)})}return this._shareOutputWithPostProcess?c=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?(c=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):c=this.inputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(s/h,l/d),this._engine.bindFramebuffer(c,0,s,l,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(c,0,void 0,void 0,this.forceFullscreenViewport)),this.onActivateObservable.notifyObservers(e),this.autoClear&&this.alphaMode===m.a.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:i.clearColor,i._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),c},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){return this._effect&&this._effect.isReady()},e.prototype.apply=function(){return this._effect&&this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._effect._bindTexture("textureSampler",e),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null;var e},e.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var e=0;e<this._textures.length;e++)this._engine._releaseTexture(this._textures.data[e]);this._textures.dispose()}},e.prototype.dispose=function(e){if(e=e||this._camera,this._disposeTextures(),this._scene){var t=this._scene.postProcesses.indexOf(this);-1!==t&&this._scene.postProcesses.splice(t,1)}else{var n=this._engine.postProcesses.indexOf(this);-1!==n&&this._engine.postProcesses.splice(n,1)}if(e){if(e.detachPostProcess(this),0===e._postProcesses.indexOf(this)&&e._postProcesses.length>0){var r=this._camera._getFirstPostProcess();r&&r.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e}();zt.a.ShadersStore.passPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",zt.a.ShadersStore.passCubePixelShader="\nvarying vec2 vUV;\nuniform samplerCube textureSampler;\nvoid main(void)\n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";var Ht=function(e){function t(t,n,r,i,o,a,s,l){return void 0===r&&(r=null),void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1),e.call(this,t,"pass",null,null,n,r,i,o,a,void 0,s,void 0,null,l)||this}return u.d(t,e),t}(jt),Wt=function(e){function t(t,n,r,i,o,a,s,l){void 0===r&&(r=null),void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1);var u=e.call(this,t,"passCube",null,null,n,r,i,o,a,"#define POSITIVEX",s,void 0,null,l)||this;return u._face=0,u}return u.d(t,e),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!0,configurable:!0}),t}(jt);ge.b._RescalePostProcessFactory=function(e){return new Ht("rescale",1,null,ge.b.TEXTURE_BILINEAR_SAMPLINGMODE,e,!1,ge.b.TEXTURETYPE_UNSIGNED_INT)},zt.a.ShadersStore.anaglyphPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}";var Xt=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,"anaglyph",null,["leftSampler"],n,r[1],i,o,a)||this;return s._passedProcess=r[0]._rigPostProcess,s.onApplyObservable.add(function(e){e.setTextureFromPostProcess("leftSampler",s._passedProcess)}),s}return u.d(t,e),t}(jt);Ne.a._setStereoscopicAnaglyphRigMode=function(e){e._rigCameras[0]._rigPostProcess=new Ht(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new Xt(e.name+"_anaglyph",1,e._rigCameras)},F.a.AddNodeConstructor("AnaglyphArcRotateCamera",function(e,t,n){return function(){return new Yt(e,0,0,1,o.x.Zero(),n.interaxial_distance,t)}});var Yt=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,t,n,r,i,o,s)||this;return l.interaxialDistance=a,l.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a}),l}return u.d(t,e),t.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},t}(xt);F.a.AddNodeConstructor("AnaglyphFreeCamera",function(e,t,n){return function(){return new Kt(e,o.x.Zero(),n.interaxial_distance,t)}});var Kt=function(e){function t(t,n,r,i){var o=e.call(this,t,n,i)||this;return o.interaxialDistance=r,o.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),o}return u.d(t,e),t.prototype.getClassName=function(){return"AnaglyphFreeCamera"},t}(bt);F.a.AddNodeConstructor("AnaglyphGamepadCamera",function(e,t,n){return function(){return new qt(e,o.x.Zero(),n.interaxial_distance,t)}});var qt=function(e){function t(t,n,r,i){var o=e.call(this,t,n,i)||this;return o.interaxialDistance=r,o.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),o}return u.d(t,e),t.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},t}(Vt);F.a.AddNodeConstructor("AnaglyphUniversalCamera",function(e,t,n){return function(){return new Qt(e,o.x.Zero(),n.interaxial_distance,t)}});var Qt=function(e){function t(t,n,r,i){var o=e.call(this,t,n,i)||this;return o.interaxialDistance=r,o.setCameraRigMode(Ne.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r}),o}return u.d(t,e),t.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},t}(kt);zt.a.ShadersStore.stereoscopicInterlacePixelShader="const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}";var Zt=function(e){function t(t,n,r,i,a,s){var l=e.call(this,t,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],i,a,s,r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return l._passedProcess=n[0]._rigPostProcess,l._stepSize=new o.w(1/l.width,1/l.height),l.onSizeChangedObservable.add(function(){l._stepSize=new o.w(1/l.width,1/l.height)}),l.onApplyObservable.add(function(e){e.setTextureFromPostProcess("camASampler",l._passedProcess),e.setFloat2("stepSize",l._stepSize.x,l._stepSize.y)}),l}return u.d(t,e),t}(jt);Ne.a._setStereoscopicRigMode=function(e){var t=e.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||e.cameraRigMode===Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;e._rigCameras[0]._rigPostProcess=new Ht(e.name+"_passthru",1,e._rigCameras[0]),e._rigCameras[1]._rigPostProcess=new Zt(e.name+"_stereoInterlace",e._rigCameras,t)},F.a.AddNodeConstructor("StereoscopicArcRotateCamera",function(e,t,n){return function(){return new Jt(e,0,0,1,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var Jt=function(e){function t(t,n,r,i,o,a,s,l){var u=e.call(this,t,n,r,i,o,l)||this;return u.interaxialDistance=a,u.isStereoscopicSideBySide=s,u.setCameraRigMode(s?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a}),u}return u.d(t,e),t.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},t}(xt);F.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,t,n){return function(){return new $t(e,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var $t=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,o)||this;return a.interaxialDistance=r,a.isStereoscopicSideBySide=i,a.setCameraRigMode(i?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),a}return u.d(t,e),t.prototype.getClassName=function(){return"StereoscopicFreeCamera"},t}(bt);F.a.AddNodeConstructor("StereoscopicGamepadCamera",function(e,t,n){return function(){return new en(e,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var en=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,o)||this;return a.interaxialDistance=r,a.isStereoscopicSideBySide=i,a.setCameraRigMode(i?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),a}return u.d(t,e),t.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},t}(Vt);F.a.AddNodeConstructor("StereoscopicFreeCamera",function(e,t,n){return function(){return new tn(e,o.x.Zero(),n.interaxial_distance,n.isStereoscopicSideBySide,t)}});var tn=function(e){function t(t,n,r,i,o){var a=e.call(this,t,n,o)||this;return a.interaxialDistance=r,a.isStereoscopicSideBySide=i,a.setCameraRigMode(i?Ne.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:Ne.a.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r}),a}return u.d(t,e),t.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},t}(kt);F.a.AddNodeConstructor("VirtualJoysticksCamera",function(e,t){return function(){return new nn(e,o.x.Zero(),t)}});var nn=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.inputs.addVirtualJoystick(),i}return u.d(t,e),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(bt),rn=function(){function e(){this.compensateDistortion=!0,this.multiviewEnabled=!1}return Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftHMatrix",{get:function(){var e=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.j.Translation(e,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightHMatrix",{get:function(){var e=4*(this.hScreenSize/4-this.lensSeparationDistance/2)/this.hScreenSize;return o.j.Translation(-e,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPreViewMatrix",{get:function(){return o.j.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPreViewMatrix",{get:function(){return o.j.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),e.GetDefault=function(){var t=new e;return t.hResolution=1280,t.vResolution=800,t.hScreenSize=.149759993,t.vScreenSize=.0935999975,t.vScreenCenter=.0467999987,t.eyeToScreenDistance=.0410000011,t.lensSeparationDistance=.063500002,t.interpupillaryDistance=.064000003,t.distortionK=[1,.219999999,.239999995,0],t.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],t.postProcessScaleFactor=1.714605507808412,t.lensCenterOffset=.151976421,t},e}();zt.a.ShadersStore.vrDistortionCorrectionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn;\nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}";var on=function(e){function t(t,n,r,i){var a=e.call(this,t,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,i.postProcessScaleFactor,n,Ge.a.BILINEAR_SAMPLINGMODE)||this;return a._isRightEye=r,a._distortionFactors=i.distortionK,a._postProcessScaleFactor=i.postProcessScaleFactor,a._lensCenterOffset=i.lensCenterOffset,a.adaptScaleToCurrentViewport=!0,a.onSizeChangedObservable.add(function(){a._scaleIn=new o.w(2,2/a.aspectRatio),a._scaleFactor=new o.w(1/a._postProcessScaleFactor*.5,1/a._postProcessScaleFactor*.5*a.aspectRatio),a._lensCenter=new o.w(a._isRightEye?.5-.5*a._lensCenterOffset:.5+.5*a._lensCenterOffset,.5)}),a.onApplyObservable.add(function(e){e.setFloat2("LensCenter",a._lensCenter.x,a._lensCenter.y),e.setFloat2("Scale",a._scaleFactor.x,a._scaleFactor.y),e.setFloat2("ScaleIn",a._scaleIn.x,a._scaleIn.y),e.setFloat4("HmdWarpParam",a._distortionFactors[0],a._distortionFactors[1],a._distortionFactors[2],a._distortionFactors[3])}),a}return u.d(t,e),t}(jt);zt.a.ShadersStore.vrMultiviewToSingleviewPixelShader="#ifdef GL_ES\nprecision mediump sampler2DArray;\n#endif\nvarying vec2 vUV;\nuniform sampler2DArray multiviewSampler;\nuniform int imageIndex;\nvoid main(void)\n{\ngl_FragColor=texture(multiviewSampler,vec3(vUV,imageIndex));\n}";var an=n(63),sn=n(83),ln=n(91);ge.b.prototype.createRenderTargetCubeTexture=function(e,t){var n=u.a({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:ge.b.TEXTURETYPE_UNSIGNED_INT,samplingMode:ge.b.TEXTURE_TRILINEAR_SAMPLINGMODE,format:ge.b.TEXTUREFORMAT_RGBA},t);n.generateStencilBuffer=n.generateDepthBuffer&&n.generateStencilBuffer,(n.type!==ge.b.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(n.type!==ge.b.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=ge.b.TEXTURE_NEAREST_SAMPLINGMODE);var r=this._gl,i=new ze.a(this,ze.a.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,i,!0);var o=this._getSamplingParameters(n.samplingMode,n.generateMipMaps);n.type!==ge.b.TEXTURETYPE_FLOAT||this._caps.textureFloat||(n.type=ge.b.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,o.mag),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,o.min),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(var a=0;a<6;a++)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,this._getRGBABufferInternalSizedFormat(n.type,n.format),e,e,0,this._getInternalFormat(n.format),this._getWebGLTextureType(n.type),null);var s=r.createFramebuffer();return this._bindUnboundFramebuffer(s),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(n.generateStencilBuffer,n.generateDepthBuffer,e,e),n.generateMipMaps&&r.generateMipmap(r.TEXTURE_CUBE_MAP),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null),r.bindRenderbuffer(r.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),i._framebuffer=s,i.width=e,i.height=e,i.isReady=!0,i.isCube=!0,i.samples=1,i.generateMipMaps=n.generateMipMaps,i.samplingMode=n.samplingMode,i.type=n.type,i.format=n.format,i._generateDepthBuffer=n.generateDepthBuffer,i._generateStencilBuffer=n.generateStencilBuffer,this._internalTexturesCache.push(i),i};var un=function(e){function t(t,n,r,a,s,l,u,c,h,d,f,p,g){void 0===s&&(s=!0),void 0===l&&(l=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=!1),void 0===c&&(c=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=!0),void 0===d&&(d=!1),void 0===f&&(f=!1),void 0===p&&(p=m.a.TEXTUREFORMAT_RGBA),void 0===g&&(g=!1);var _=e.call(this,null,r,!a)||this;return _.isCube=u,_.renderParticles=!0,_.renderSprites=!1,_.coordinatesMode=Ge.a.PROJECTION_MODE,_.ignoreCameraViewport=!1,_.onBeforeBindObservable=new i.c,_.onAfterUnbindObservable=new i.c,_.onBeforeRenderObservable=new i.c,_.onAfterRenderObservable=new i.c,_.onClearObservable=new i.c,_._currentRefreshId=-1,_._refreshRate=1,_._samples=1,_.boundingBoxPosition=o.x.Zero(),(r=_.getScene())?(_.renderList=new Array,_._engine=r.getEngine(),_.name=t,_.isRenderTarget=!0,_._initialSizeParameter=n,_._processSizeParameter(n),_._resizeObserver=_.getScene().getEngine().onResizeObservable.add(function(){}),_._generateMipMaps=!!a,_._doNotChangeAspectRatio=s,_._renderingManager=new ln.b(r),_._renderingManager._useSceneAutoClearSetup=!0,f?_:(_._renderTargetOptions={generateMipMaps:a,type:l,format:p,samplingMode:c,generateDepthBuffer:h,generateStencilBuffer:d},c===Ge.a.NEAREST_SAMPLINGMODE&&(_.wrapU=Ge.a.CLAMP_ADDRESSMODE,_.wrapV=Ge.a.CLAMP_ADDRESSMODE),g||(u?(_._texture=r.getEngine().createRenderTargetCubeTexture(_.getRenderSize(),_._renderTargetOptions),_.coordinatesMode=Ge.a.INVCUBIC_MODE,_._textureMatrix=o.j.Identity()):_._texture=r.getEngine().createRenderTargetTexture(_._size,_._renderTargetOptions)),_)):_}return u.d(t,e),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!0,configurable:!0}),t.prototype._hookArray=function(e){var t=this,n=e.push;e.push=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var o=0===e.length,a=n.apply(e,r);return o&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),a};var r=e.splice;e.splice=function(n,i){var o=r.apply(e,[n,i]);return 0===e.length&&t.getScene().meshes.forEach(function(e){e._markSubMeshesAsLightDirty()}),o}},Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),t.prototype.createDepthStencilTexture=function(e,t,n){if(void 0===e&&(e=0),void 0===t&&(t=!0),void 0===n&&(n=!1),this.getScene()){var r=this.getScene().getEngine();this.depthStencilTexture=r.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:n,isCube:this.isCube}),r.setFrameBufferDepthStencilTexture(this)}},t.prototype._processSizeParameter=function(e){e.ratio?(this._sizeRatio=e.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=e},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!0,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),t.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new sn.a(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,n=this._postProcesses;t<n.length;t++)n[t].dispose();this._postProcesses=[]}},t.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.scale=function(e){var t=this.getRenderSize()*e;this.resize(t)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(e){var t=this.isCube;this.releaseInternalTexture();var n=this.getScene();n&&(this._processSizeParameter(e),this._texture=t?n.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):n.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},t.prototype.render=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),s=this.getScene()){var n,r=s.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var i=0;i<this._waitingRenderList.length;i++){var o=this._waitingRenderList[i],a=s.getMeshByID(o);a&&this.renderList.push(a)}delete this._waitingRenderList}if(this.renderListPredicate){var s;if(this.renderList?this.renderList.length=0:this.renderList=[],!(s=this.getScene()))return;var l=s.meshes;for(i=0;i<l.length;i++){var u=l[i];this.renderListPredicate(u)&&this.renderList.push(u)}}this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(n=this.activeCamera,r.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==s.activeCamera&&s.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(n=s.activeCamera)&&r.setViewport(n.viewport,this.getRenderWidth(),this.getRenderHeight()),this._renderingManager.reset();for(var c=this.renderList?this.renderList:s.getActiveMeshes().data,h=this.renderList?this.renderList.length:s.getActiveMeshes().length,d=s.getRenderId(),f=0;f<h;f++)if(u=c[f]){if(!u.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}u._preActivateForIntermediateRendering(d);var p=void 0;if(p=!(this.renderList||!n)&&0==(u.layerMask&n.layerMask),u.isEnabled()&&u.isVisible&&u.subMeshes&&!p&&u._activate(d,!0)){u.isAnInstance?u=u.sourceMesh:u._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,u._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var m=0;m<u.subMeshes.length;m++){var g=u.subMeshes[m];s._activeIndices.addCount(g.indexCount,!1),this._renderingManager.dispatch(g,u)}}}for(var _=0;_<s.particleSystems.length;_++){var v=s.particleSystems[_],y=v.emitter;v.isStarted()&&y&&y.position&&y.isEnabled()&&c.indexOf(y)>=0&&this._renderingManager.dispatchParticles(v)}if(this.isCube)for(var b=0;b<6;b++)this.renderToTarget(b,c,e,t),s.incrementRenderId(),s.resetCachedMaterial();else this.renderToTarget(0,c,e,t);this.onAfterUnbindObservable.notifyObservers(this),s.activeCamera&&(this.activeCamera&&this.activeCamera!==s.activeCamera&&s.setTransformMatrix(s.activeCamera.getViewMatrix(),s.activeCamera.getProjectionMatrix(!0)),r.setViewport(s.activeCamera.viewport)),s.resetCachedMaterial()}},t.prototype._bestReflectionRenderTargetDimension=function(e,t){var n=e*t,r=ye.h.NearestPOT(n+16384/(128+n));return Math.min(ye.h.FloorPOT(e),r)},t.prototype._bindFrameBuffer=function(e){void 0===e&&(e=0);var t=this.getScene();if(t){var n=t.getEngine();this._texture&&n.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,this.depthStencilTexture?this.depthStencilTexture:void 0)}},t.prototype.unbindFrameBuffer=function(e,t){var n=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,function(){n.onAfterRenderObservable.notifyObservers(t)})},t.prototype.renderToTarget=function(e,t,n,r){var i=this.getScene();if(i){var o=i.getEngine();if(this._texture){this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&i.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(e),this.onBeforeRenderObservable.notifyObservers(e),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(o):o.clear(this.clearColor||i.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||i.updateTransformMatrix(!0);for(var a=0,s=i._beforeRenderTargetDrawStage;a<s.length;a++)s[a].action(this);this._renderingManager.render(this.customRenderFunction,t,this.renderParticles,this.renderSprites);for(var l=0,u=i._afterRenderTargetDrawStage;l<u.length;l++)u[l].action(this);this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):n&&i.postProcessManager._finalizeFrame(!1,this._texture,e),this._doNotChangeAspectRatio||i.updateTransformMatrix(!0),r&&ye.h.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),o),this.isCube&&5!==e?this.onAfterRenderObservable.notifyObservers(e):(this.isCube&&5===e&&o.generateMipMapsForCubemap(this._texture),this.unbindFrameBuffer(o,e))}}},t.prototype.setRenderingOrder=function(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,n,r)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,this.renderList&&(n.renderList=this.renderList.slice(0)),n},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);if(t.renderTargetSize=this.getRenderSize(),t.renderList=[],this.renderList)for(var n=0;n<this.renderList.length;n++)t.renderList.push(this.renderList[n].id);return t},t.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},t.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var t=this.getScene();if(t){var n=t.customRenderTargets.indexOf(this);n>=0&&t.customRenderTargets.splice(n,1);for(var r=0,i=t.cameras;r<i.length;r++){var o=i[r];(n=o.customRenderTargets.indexOf(this))>=0&&o.customRenderTargets.splice(n,1)}e.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(Ge.a);Ge.a._CreateRenderTargetTexture=function(e,t,n,r){return new un(e,t,n,r)};var cn=function(e){function t(t,n){void 0===n&&(n=512);var r=e.call(this,"multiview rtt",n,t,!1,!0,ze.a.DATASOURCE_UNKNOWN,!1,void 0,!1,!1,!0,void 0,!0)||this,i=t.getEngine().createMultiviewRenderTargetTexture(r.getRenderWidth(),r.getRenderHeight());return i.isMultiview=!0,r._texture=i,r}return u.d(t,e),t.prototype._bindFrameBuffer=function(e){void 0===e&&(e=0),this._texture&&this.getScene().getEngine().bindMultiviewFramebuffer(this._texture)},t.prototype.getViewCount=function(){return 2},t}(un);ge.b.prototype.createMultiviewRenderTargetTexture=function(e,t){var n=this._gl;if(!this.getCaps().multiview)throw"Multiview is not supported";var r=new ze.a(this,ze.a.DATASOURCE_UNKNOWN,!0);return r.width=e,r.height=t,r._framebuffer=n.createFramebuffer(),r._colorTextureArray=n.createTexture(),n.bindTexture(n.TEXTURE_2D_ARRAY,r._colorTextureArray),n.texStorage3D(n.TEXTURE_2D_ARRAY,1,n.RGBA8,e,t,2),r._depthStencilTextureArray=n.createTexture(),n.bindTexture(n.TEXTURE_2D_ARRAY,r._depthStencilTextureArray),n.texStorage3D(n.TEXTURE_2D_ARRAY,1,n.DEPTH32F_STENCIL8,e,t,2),r.isReady=!0,r},ge.b.prototype.bindMultiviewFramebuffer=function(e){var t=this._gl,n=this.getCaps().multiview;if(this.bindFramebuffer(e,void 0,void 0,void 0,!0),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e._framebuffer),!e._colorTextureArray||!e._depthStencilTextureArray)throw"Invalid multiview frame buffer";n.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,e._colorTextureArray,0,0,2),n.framebufferTextureMultiviewOVR(t.DRAW_FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,e._depthStencilTextureArray,0,0,2)},Ne.a.prototype._useMultiviewToSingleView=!1,Ne.a.prototype._multiviewTexture=null,Ne.a.prototype._resizeOrCreateMultiviewTexture=function(e,t){this._multiviewTexture?this._multiviewTexture.getRenderWidth()==e&&this._multiviewTexture.getRenderHeight()==t||(this._multiviewTexture.dispose(),this._multiviewTexture=new cn(this.getScene(),{width:e,height:t})):this._multiviewTexture=new cn(this.getScene(),{width:e,height:t})},W.a.prototype._transformMatrixR=o.j.Zero(),W.a.prototype._multiviewSceneUbo=null,W.a.prototype._createMultiviewUbo=function(){this._multiviewSceneUbo=new an.a(this.getEngine(),void 0,!0),this._multiviewSceneUbo.addUniform("viewProjection",16),this._multiviewSceneUbo.addUniform("viewProjectionR",16),this._multiviewSceneUbo.addUniform("view",16)},W.a.prototype._updateMultiviewUbo=function(e,t){e&&t&&e.multiplyToRef(t,this._transformMatrixR),e&&t&&(e.multiplyToRef(t,o.t.Matrix[0]),o.i.GetRightPlaneToRef(o.t.Matrix[0],this._frustumPlanes[3])),this._multiviewSceneUbo&&(this._multiviewSceneUbo.updateMatrix("viewProjection",this.getTransformMatrix()),this._multiviewSceneUbo.updateMatrix("viewProjectionR",this._transformMatrixR),this._multiviewSceneUbo.updateMatrix("view",this._viewMatrix),this._multiviewSceneUbo.update())},W.a.prototype._renderMultiviewToSingleView=function(e){e._resizeOrCreateMultiviewTexture(e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.width>0?e._rigPostProcess.width/2:this.getEngine().getRenderWidth(!0)/2,e._rigPostProcess&&e._rigPostProcess&&e._rigPostProcess.height>0?e._rigPostProcess.height:this.getEngine().getRenderHeight(!0)),this._multiviewSceneUbo||this._createMultiviewUbo(),e.outputRenderTarget=e._multiviewTexture,this._renderForCamera(e),e.outputRenderTarget=null;for(var t=0;t<e._rigCameras.length;t++){var n=this.getEngine();this._activeCamera=e._rigCameras[t],n.setViewport(this._activeCamera.viewport),this.postProcessManager&&(this.postProcessManager._prepareFrame(),this.postProcessManager._finalizeFrame(this._activeCamera.isIntermediate))}};var hn=function(e){function t(t,n,r){var i=e.call(this,t,"vrMultiviewToSingleview",["imageIndex"],["multiviewSampler"],r,n,Ge.a.BILINEAR_SAMPLINGMODE)||this;return i.onSizeChangedObservable.add(function(){}),i.onApplyObservable.add(function(e){n._scene.activeCamera&&n._scene.activeCamera.isLeftCamera?e.setInt("imageIndex",0):e.setInt("imageIndex",1),e.setTexture("multiviewSampler",n._multiviewTexture)}),i}return u.d(t,e),t}(jt);Ne.a._setVRRigMode=function(e,t){var n=t.vrCameraMetrics||rn.GetDefault();e._rigCameras[0]._cameraRigParams.vrMetrics=n,e._rigCameras[0].viewport=new o.z(0,0,.5,1),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[0]._cameraRigParams.vrHMatrix=n.leftHMatrix,e._rigCameras[0]._cameraRigParams.vrPreViewMatrix=n.leftPreViewMatrix,e._rigCameras[0].getProjectionMatrix=e._rigCameras[0]._getVRProjectionMatrix,e._rigCameras[1]._cameraRigParams.vrMetrics=n,e._rigCameras[1].viewport=new o.z(.5,0,.5,1),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[1]._cameraRigParams.vrHMatrix=n.rightHMatrix,e._rigCameras[1]._cameraRigParams.vrPreViewMatrix=n.rightPreViewMatrix,e._rigCameras[1].getProjectionMatrix=e._rigCameras[1]._getVRProjectionMatrix,n.multiviewEnabled&&(e.getScene().getEngine().getCaps().multiview?(e._useMultiviewToSingleView=!0,e._rigPostProcess=new hn("VRMultiviewToSingleview",e,n.postProcessScaleFactor)):(p.a.Warn("Multiview is not supported, falling back to standard rendering"),n.multiviewEnabled=!1)),n.compensateDistortion&&(e._rigCameras[0]._rigPostProcess=new on("VR_Distort_Compensation_Left",e._rigCameras[0],!1,n),e._rigCameras[1]._rigPostProcess=new on("VR_Distort_Compensation_Right",e._rigCameras[1],!0,n))},F.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,t){return function(){return new dn(e,0,0,1,o.x.Zero(),t)}});var dn=function(e){function t(t,n,r,i,o,a,s,l){void 0===s&&(s=!0),void 0===l&&(l=rn.GetDefault());var u=e.call(this,t,n,r,i,o,a)||this;return l.compensateDistortion=s,u.setCameraRigMode(Ne.a.RIG_MODE_VR,{vrCameraMetrics:l}),u.inputs.addVRDeviceOrientation(),u}return u.d(t,e),t.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},t}(xt);F.a.AddNodeConstructor("VRDeviceOrientationFreeCamera",function(e,t){return function(){return new fn(e,o.x.Zero(),t)}});var fn=function(e){function t(t,n,r,i,o){void 0===i&&(i=!0),void 0===o&&(o=rn.GetDefault());var a=e.call(this,t,n,r)||this;return o.compensateDistortion=i,a.setCameraRigMode(Ne.a.RIG_MODE_VR,{vrCameraMetrics:o}),a}return u.d(t,e),t.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},t}(Tt);F.a.AddNodeConstructor("VRDeviceOrientationGamepadCamera",function(e,t){return function(){return new pn(e,o.x.Zero(),t)}});var pn=function(e){function t(t,n,r,i,o){void 0===i&&(i=!0),void 0===o&&(o=rn.GetDefault());var a=e.call(this,t,n,r,i,o)||this;return a.inputs.addGamepad(),a}return u.d(t,e),t.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},t}(fn),mn=n(65);Ne.a._setWebVRRigMode=function(e,t){if(t.vrDisplay){var n=t.vrDisplay.getEyeParameters("left"),r=t.vrDisplay.getEyeParameters("right");e._rigCameras[0].viewport=new o.z(0,0,.5,1),e._rigCameras[0].setCameraRigParameter("left",!0),e._rigCameras[0].setCameraRigParameter("specs",t.specs),e._rigCameras[0].setCameraRigParameter("eyeParameters",n),e._rigCameras[0].setCameraRigParameter("frameData",t.frameData),e._rigCameras[0].setCameraRigParameter("parentCamera",t.parentCamera),e._rigCameras[0]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[0].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[0].parent=e,e._rigCameras[0]._getViewMatrix=e._getWebVRViewMatrix,e._rigCameras[1].viewport=new o.z(.5,0,.5,1),e._rigCameras[1].setCameraRigParameter("eyeParameters",r),e._rigCameras[1].setCameraRigParameter("specs",t.specs),e._rigCameras[1].setCameraRigParameter("frameData",t.frameData),e._rigCameras[1].setCameraRigParameter("parentCamera",t.parentCamera),e._rigCameras[1]._cameraRigParams.vrWorkMatrix=new o.j,e._rigCameras[1].getProjectionMatrix=e._getWebVRProjectionMatrix,e._rigCameras[1].parent=e,e._rigCameras[1]._getViewMatrix=e._getWebVRViewMatrix}},Object.defineProperty(ge.b.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),ge.b.prototype._prepareVRComponent=function(){this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.onVRDisplayChangedObservable=new i.c,this.onVRRequestPresentComplete=new i.c,this.onVRRequestPresentStart=new i.c},ge.b.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},ge.b.prototype.getVRDevice=function(){return this._vrDisplay},ge.b.prototype.initWebVR=function(){return this.initWebVRAsync(),this.onVRDisplayChangedObservable},ge.b.prototype.initWebVRAsync=function(){var e=this,t=function(){var t={vrDisplay:e._vrDisplay,vrSupported:e._vrSupported};e.onVRDisplayChangedObservable.notifyObservers(t),e._webVRInitPromise=new Promise(function(e){e(t)})};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(n){e._vrDisplay=n.display,t()},this._onVrDisplayDisconnect=function(){e._vrDisplay.cancelAnimationFrame(e._frameHandler),e._vrDisplay=void 0,e._frameHandler=ye.h.QueueNewFrame(e._bindedRenderFunction),t()},this._onVrDisplayPresentChange=function(){e._vrExclusivePointerMode=e._vrDisplay&&e._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._webVRInitPromise=this._webVRInitPromise||this._getVRDisplaysAsync(),this._webVRInitPromise.then(t),this._webVRInitPromise},ge.b.prototype._getVRDisplaysAsync=function(){var e=this;return new Promise(function(t){navigator.getVRDisplays?navigator.getVRDisplays().then(function(n){e._vrSupported=!0,e._vrDisplay=n[0],t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported})}):(e._vrDisplay=void 0,e._vrSupported=!1,t({vrDisplay:e._vrDisplay,vrSupported:e._vrSupported}))})},ge.b.prototype.enableVR=function(){var e=this;this._vrDisplay&&!this._vrDisplay.isPresenting&&(this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(function(){e.onVRRequestPresentComplete.notifyObservers(!0),e._onVRFullScreenTriggered()}).catch(function(){e.onVRRequestPresentComplete.notifyObservers(!1)}))},ge.b.prototype._onVRFullScreenTriggered=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting){this._oldSize=new o.r(this.getRenderWidth(),this.getRenderHeight()),this._oldHardwareScaleFactor=this.getHardwareScalingLevel();var e=this._vrDisplay.getEyeParameters("left");this.setHardwareScalingLevel(1),this.setSize(2*e.renderWidth,e.renderHeight)}else this.setHardwareScalingLevel(this._oldHardwareScaleFactor),this.setSize(this._oldSize.width,this._oldSize.height)},ge.b.prototype.disableVR=function(){var e=this;this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(function(){return e._onVRFullScreenTriggered()}).catch(function(){return e._onVRFullScreenTriggered()}),wt.a.IsWindowObjectExist()&&(window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null))},ge.b.prototype._connectVREvents=function(e,t){this._onVRDisplayPointerRestricted=function(){e&&e.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){t.exitPointerLock&&t.exitPointerLock()},wt.a.IsWindowObjectExist()&&(window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1))},ge.b.prototype._submitVRFrame=function(){if(this._vrDisplay&&this._vrDisplay.isPresenting)try{this._vrDisplay.submitFrame()}catch(e){ye.h.Warn("webVR submitFrame has had an unexpected failure: "+e)}},ge.b.prototype.isVRPresenting=function(){return this._vrDisplay&&this._vrDisplay.isPresenting},ge.b.prototype._requestVRFrame=function(){this._frameHandler=ye.h.QueueNewFrame(this._bindedRenderFunction,this._vrDisplay)},F.a.AddNodeConstructor("WebVRFreeCamera",function(e,t){return function(){return new gn(e,o.x.Zero(),t)}}),F.a.AddNodeConstructor("WebVRGamepadCamera",function(e,t){return function(){return new gn(e,o.x.Zero(),t)}});var gn=function(e){function t(t,n,r,a){void 0===a&&(a={});var s=e.call(this,t,n,r)||this;s.webVROptions=a,s._vrDevice=null,s.rawPose=null,s._specsVersion="1.1",s._attached=!1,s._descendants=[],s._deviceRoomPosition=o.x.Zero(),s._deviceRoomRotationQuaternion=o.q.Identity(),s._standingMatrix=null,s.devicePosition=o.x.Zero(),s.deviceRotationQuaternion=o.q.Identity(),s.deviceScaleFactor=1,s._deviceToWorld=o.j.Identity(),s._worldToDevice=o.j.Identity(),s.controllers=[],s.onControllersAttachedObservable=new i.c,s.onControllerMeshLoadedObservable=new i.c,s.onPoseUpdatedFromDeviceObservable=new i.c,s._poseSet=!1,s.rigParenting=!0,s._defaultHeight=void 0,s._htmlElementAttached=null,s._detachIfAttached=function(){var e=s.getEngine().getVRDevice();e&&!e.isPresenting&&s._htmlElementAttached&&s.detachControl(s._htmlElementAttached)},s._workingVector=o.x.Zero(),s._oneVector=o.x.One(),s._workingMatrix=o.j.Identity(),s._tmpMatrix=new o.j,s._cache.position=o.x.Zero(),a.defaultHeight&&(s._defaultHeight=a.defaultHeight,s.position.y=s._defaultHeight),s.minZ=.1,5===arguments.length&&(s.webVROptions=arguments[4]),null==s.webVROptions.trackPosition&&(s.webVROptions.trackPosition=!0),null==s.webVROptions.controllerMeshes&&(s.webVROptions.controllerMeshes=!0),null==s.webVROptions.defaultLightingOnControllers&&(s.webVROptions.defaultLightingOnControllers=!0),s.rotationQuaternion=new o.q,s.webVROptions&&s.webVROptions.positionScale&&(s.deviceScaleFactor=s.webVROptions.positionScale);var l=s.getEngine();return s._onVREnabled=function(e){e&&s.initControllers()},l.onVRRequestPresentComplete.add(s._onVREnabled),l.initWebVR().add(function(e){e.vrDisplay&&s._vrDevice!==e.vrDisplay&&(s._vrDevice=e.vrDisplay,s.setCameraRigMode(Ne.a.RIG_MODE_WEBVR,{parentCamera:s,vrDisplay:s._vrDevice,frameData:s._frameData,specs:s._specsVersion}),s._attached&&s.getEngine().enableVR())}),"undefined"!=typeof VRFrameData&&(s._frameData=new VRFrameData),a.useMultiview&&(s.getScene().getEngine().getCaps().multiview?(s._useMultiviewToSingleView=!0,s._rigPostProcess=new hn("VRMultiviewToSingleview",s,1)):(p.a.Warn("Multiview is not supported, falling back to standard rendering"),s._useMultiviewToSingleView=!1)),r.onBeforeCameraRenderObservable.add(function(e){e.parent===s&&s.rigParenting&&(s._descendants=s.getDescendants(!0,function(e){var t=s.controllers.some(function(t){return t._mesh===e}),n=-1!==s._rigCameras.indexOf(e);return!t&&!n}),s._descendants.forEach(function(t){t.parent=e}))}),r.onAfterCameraRenderObservable.add(function(e){e.parent===s&&s.rigParenting&&s._descendants.forEach(function(e){e.parent=s})}),s}return u.d(t,e),t.prototype.deviceDistanceToRoomGround=function(){return this._standingMatrix?(this._standingMatrix.getTranslationToRef(this._workingVector),this._deviceRoomPosition.y+this._workingVector.y):this._defaultHeight||0},t.prototype.useStandingMatrix=function(e){var t=this;void 0===e&&(e=function(e){}),this.getEngine().initWebVRAsync().then(function(n){n.vrDisplay&&n.vrDisplay.stageParameters&&n.vrDisplay.stageParameters.sittingToStandingTransform&&t.webVROptions.trackPosition?(t._standingMatrix=new o.j,o.j.FromFloat32ArrayToRefScaled(n.vrDisplay.stageParameters.sittingToStandingTransform,0,1,t._standingMatrix),t.getScene().useRightHandedSystem||t._standingMatrix&&t._standingMatrix.toggleModelMatrixHandInPlace(),e(!0)):e(!1)})},t.prototype.useStandingMatrixAsync=function(){var e=this;return new Promise(function(t){e.useStandingMatrix(function(e){t(e)})})},t.prototype.dispose=function(){this._detachIfAttached(),this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),this._updateCacheWhenTrackingDisabledObserver&&this._scene.onBeforeRenderObservable.remove(this._updateCacheWhenTrackingDisabledObserver),e.prototype.dispose.call(this)},t.prototype.getControllerByName=function(e){for(var t=0,n=this.controllers;t<n.length;t++){var r=n[t];if(r.hand===e)return r}return null},Object.defineProperty(t.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),t.prototype.getForwardRay=function(t){return void 0===t&&(t=100),this.leftCamera?e.prototype.getForwardRay.call(this,t,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):e.prototype.getForwardRay.call(this,t)},t.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),e.prototype._checkInputs.call(this)},t.prototype.updateFromDevice=function(e){e&&e.orientation&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)),this._poseSet=!0)},t.prototype.attachControl=function(t,n){e.prototype.attachControl.call(this,t,n),this._attached=!0,this._htmlElementAttached=t,n=!Ne.a.ForceAttachControlToAlwaysPreventDefault&&n,this._vrDevice&&this.getEngine().enableVR(),window.addEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.detachControl=function(t){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),e.prototype.detachControl.call(this,t),this._attached=!1,this.getEngine().disableVR(),window.removeEventListener("vrdisplaypresentchange",this._detachIfAttached)},t.prototype.getClassName=function(){return"WebVRFreeCamera"},t.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],t=this._rigCameras[1];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),t.position.copyFrom(this._deviceRoomPosition)},t.prototype._correctPositionIfNotTrackPosition=function(e,t){void 0===t&&(t=!1),this.rawPose&&this.rawPose.position&&!this.webVROptions.trackPosition&&(o.j.TranslationToRef(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2],this._tmpMatrix),t||this._tmpMatrix.invert(),this._tmpMatrix.multiplyToRef(e,e))},t.prototype._updateCache=function(t){var n=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.updateCacheCalled||(this.updateCacheCalled=!0,this.update()),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),o.x.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),o.j.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(e){e._deviceToWorld.copyFrom(n._deviceToWorld),n._correctPositionIfNotTrackPosition(e._deviceToWorld),e.update()})),t||e.prototype._updateCache.call(this),this.updateCacheCalled=!1},t.prototype._computeDevicePosition=function(){o.x.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition)},t.prototype.update=function(){this._computeDevicePosition(),o.j.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),o.q.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this._poseSet&&this.onPoseUpdatedFromDeviceObservable.notifyObservers(null),e.prototype.update.call(this)},t.prototype._getViewMatrix=function(){return o.j.Identity()},t.prototype._getWebVRViewMatrix=function(){var e=this._cameraRigParams.parentCamera;e._updateCache();var t=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;return o.j.FromArrayToRef(t,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||this._webvrViewMatrix.toggleModelMatrixHandInPlace(),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),o.x.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),1!==e.deviceScaleFactor&&(this._webvrViewMatrix.invert(),e.deviceScaleFactor&&(this._webvrViewMatrix.multiplyAtIndex(12,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(13,e.deviceScaleFactor),this._webvrViewMatrix.multiplyAtIndex(14,e.deviceScaleFactor)),this._webvrViewMatrix.invert()),e._correctPositionIfNotTrackPosition(this._webvrViewMatrix,!0),e._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._workingMatrix=this._workingMatrix||o.j.Identity(),this._webvrViewMatrix.invertToRef(this._workingMatrix),this._workingMatrix.multiplyToRef(e.getWorldMatrix(),this._workingMatrix),this._workingMatrix.getTranslationToRef(this._globalPosition),this._markSyncedWithParent(),this._webvrViewMatrix},t.prototype._getWebVRProjectionMatrix=function(){var e=this.parent;e._vrDevice.depthNear=e.minZ,e._vrDevice.depthFar=e.maxZ;var t=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return o.j.FromArrayToRef(t,0,this._projectionMatrix),this.getScene().useRightHandedSystem||this._projectionMatrix.toggleProjectionMatrixHandInPlace(),this._projectionMatrix},t.prototype.initControllers=function(){var e=this;this.controllers=[];var t=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=t.onGamepadDisconnectedObservable.add(function(t){if(t.type===Ke.POSE_ENABLED){var n=t;n.defaultModel&&n.defaultModel.setEnabled(!1),"right"===n.hand&&(e._rightController=null),"left"===n.hand&&(e._leftController=null);var r=e.controllers.indexOf(n);-1!==r&&e.controllers.splice(r,1)}}),this._onGamepadConnectedObserver=t.onGamepadConnectedObservable.add(function(t){if(t.type===Ke.POSE_ENABLED){var n=t;if(e.webVROptions.trackPosition||(n._disableTrackPosition(new o.x("left"==n.hand?-.15:.15,-.5,.25)),e._updateCacheWhenTrackingDisabledObserver||(e._updateCacheWhenTrackingDisabledObserver=e._scene.onBeforeRenderObservable.add(function(){e._updateCache()}))),n.deviceScaleFactor=e.deviceScaleFactor,n._deviceToWorld.copyFrom(e._deviceToWorld),e._correctPositionIfNotTrackPosition(n._deviceToWorld),e.webVROptions.controllerMeshes&&(n.defaultModel?n.defaultModel.setEnabled(!0):n.initControllerMesh(e.getScene(),function(t){t.scaling.scaleInPlace(e.deviceScaleFactor),e.onControllerMeshLoadedObservable.notifyObservers(n),e.webVROptions.defaultLightingOnControllers&&(e._lightOnControllers||(e._lightOnControllers=new mn.a("vrControllersLight",new o.x(0,1,0),e.getScene())),e._lightOnControllers.includedOnlyMeshes.push(t),function e(t,n){var r=t.getChildren();r&&0!==r.length&&r.forEach(function(t){n.includedOnlyMeshes.push(t),e(t,n)})}(t,e._lightOnControllers))})),n.attachToPoseControlledCamera(e),-1===e.controllers.indexOf(n)){e.controllers.push(n);for(var r=!1,i=0;i<e.controllers.length;i++)e.controllers[i].controllerType===Mt.VIVE&&(r?e.controllers[i].hand="right":(r=!0,e.controllers[i].hand="left"));e.controllers.length>=2&&e.onControllersAttachedObservable.notifyObservers(e.controllers)}}})},t}(bt),_n=function(e){function t(t){var n=e.call(this,t)||this;return n.onTriggerStateChangedObservable=new i.c,n.onMainButtonStateChangedObservable=new i.c,n.onSecondaryButtonStateChangedObservable=new i.c,n.onPadStateChangedObservable=new i.c,n.onPadValuesChangedObservable=new i.c,n.pad={x:0,y:0},n._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},n._buttons=new Array(t.buttons.length),n.hand=t.hand,n}return u.d(t,e),t.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(t.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._setButtonValue(this.browserGamepad.buttons[t],this._buttons[t],t);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},t.prototype._setButtonValue=function(e,t,n){e||(e={pressed:!1,touched:!1,value:0}),t?(this._checkChanges(e,t),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,n,e),this._handleButtonChange(n,e,this._changes)),this._buttons[n].pressed=e.pressed,this._buttons[n].touched=e.touched,this._buttons[n].value=e.value<1e-8?0:e.value):this._buttons[n]={pressed:e.pressed,touched:e.touched,value:e.value}},t.prototype._checkChanges=function(e,t){return this._changes.pressChanged=e.pressed!==t.pressed,this._changes.touchChanged=e.touched!==t.touched,this._changes.valueChanged=e.value!==t.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},t}(Ft),vn=n(31),yn=n(33),bn=function(e){function t(t,n,r,i,o,a){void 0===r&&(r=null),void 0===o&&(o=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===a&&(a=m.a.TEXTUREFORMAT_RGBA);var s=e.call(this,null,r,!i,void 0,o,void 0,void 0,void 0,void 0,a)||this;s.name=t,s._engine=s.getScene().getEngine(),s.wrapU=Ge.a.CLAMP_ADDRESSMODE,s.wrapV=Ge.a.CLAMP_ADDRESSMODE,s._generateMipMaps=i,n.getContext?(s._canvas=n,s._texture=s._engine.createDynamicTexture(n.width,n.height,i,o)):(s._canvas=document.createElement("canvas"),n.width||0===n.width?s._texture=s._engine.createDynamicTexture(n.width,n.height,i,o):s._texture=s._engine.createDynamicTexture(n,n,i,o));var l=s.getSize();return s._canvas.width=l.width,s._canvas.height=l.height,s._context=s._canvas.getContext("2d"),s}return u.d(t,e),t.prototype.getClassName=function(){return"DynamicTexture"},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(e.width,e.height,this._generateMipMaps,this.samplingMode)},t.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},t.prototype.scaleTo=function(e,t){var n=this.getSize();n.width=e,n.height=t,this._recreate(n)},t.prototype.getContext=function(){return this._context},t.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},t.prototype.update=function(e,t){void 0===t&&(t=!1),this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===e||e,t,this._format||void 0)},t.prototype.drawText=function(e,t,n,r,i,o,a,s){void 0===s&&(s=!0);var l=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,l.width,l.height)),this._context.font=r,null==t){var u=this._context.measureText(e);t=(l.width-u.width)/2}if(null==n){var c=parseInt(r.replace(/\D/g,""));n=l.height/2+c/3.65}this._context.fillStyle=i,this._context.fillText(e,t,n),s&&this.update(a)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.wrapU=this.wrapU,r.wrapV=this.wrapV,r},t.prototype.serialize=function(){var t=this.getScene();t&&!t.isReady()&&p.a.Warn("The scene must be ready before serializing the dynamic texture");var n=e.prototype.serialize.call(this);return n.base64String=this._canvas.toDataURL(),n.invertY=this._invertY,n.samplingMode=this.samplingMode,n},t.prototype._rebuild=function(){this.update()},t}(Ge.a),En=(n(86),n(56),n(87),"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main(void)\n{\nvec4 result=texture2D(textureSampler,vUV);\n#ifdef IMAGEPROCESSING\n#ifndef FROMLINEARSPACE\n\nresult.rgb=toLinearSpace(result.rgb);\n#endif\nresult=applyImageProcessing(result);\n#else\n\n#ifdef FROMLINEARSPACE\nresult=applyImageProcessing(result);\n#endif\n#endif\ngl_FragColor=result;\n}");zt.a.ShadersStore.imageProcessingPixelShader=En;var xn=function(e){function t(t,n,r,i,o,a,s,l){void 0===r&&(r=null),void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT);var u=e.call(this,t,"imageProcessing",[],[],n,r,i,o,a,null,s,"postprocess",null,!0)||this;return u._fromLinearSpace=!0,u._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,TONEMAPPING_ACES:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},l?(l.applyByPostProcess=!0,u._attachImageProcessingConfiguration(l,!0),u.fromLinearSpace=!1):(u._attachImageProcessingConfiguration(null,!0),u.imageProcessingConfiguration.applyByPostProcess=!0),u.onApply=function(e){u.imageProcessingConfiguration.bind(e,u.aspectRatio)},u}return u.d(t,e),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e)},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e,t){var n=this;if(void 0===t&&(t=!1),e!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e)this._imageProcessingConfiguration=e;else{var r=null,i=this.getEngine(),o=this.getCamera();if(o)r=o.getScene();else if(i&&i.scenes){var a=i.scenes;r=a[a.length-1]}else r=P.a.LastCreatedScene;this._imageProcessingConfiguration=r.imageProcessingConfiguration}this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){n._updateParameters()})),t||this._updateParameters()}},Object.defineProperty(t.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingType",{get:function(){return this._imageProcessingConfiguration.toneMappingType},set:function(e){this._imageProcessingConfiguration.toneMappingType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ImageProcessingPostProcess"},t.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var e="";for(var t in this._defines)this._defines[t]&&(e+="#define "+t+";\r\n");var n=["textureSampler"],r=["scale"];vn.a&&(vn.a.PrepareSamplers(n,this._defines),vn.a.PrepareUniforms(r,this._defines)),this.updateEffect(e,r,n)},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration&&(this.imageProcessingConfiguration.applyByPostProcess=!1)},u.c([Object(D.c)()],t.prototype,"_fromLinearSpace",void 0),t}(jt),Tn=n(13),Sn=n(4);fe.a._GroundMeshParser=function(e,t){return An.Parse(e,t)};var An=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.generateOctree=!1,r}return u.d(t,e),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),t.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},t.prototype.getHeightAtCoordinates=function(e,t){var n=this.getWorldMatrix(),r=o.t.Matrix[5];n.invertToRef(r);var i=o.t.Vector3[8];if(o.x.TransformCoordinatesFromFloatsToRef(e,0,t,r,i),e=i.x,t=i.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(e,t),s=-(a.x*e+a.z*t+a.w)/a.y;return o.x.TransformCoordinatesFromFloatsToRef(0,s,0,n,i),i.y},t.prototype.getNormalAtCoordinates=function(e,t){var n=new o.x(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,n),n},t.prototype.getNormalAtCoordinatesToRef=function(e,t,n){var r=this.getWorldMatrix(),i=o.t.Matrix[5];r.invertToRef(i);var a=o.t.Vector3[8];if(o.x.TransformCoordinatesFromFloatsToRef(e,0,t,i,a),e=a.x,t=a.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var s=this._getFacetAt(e,t);return o.x.TransformNormalFromFloatsToRef(s.x,s.y,s.z,r,n),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,t){var n=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),i=this._heightQuads[r*this._subdivisionsX+n];return t<i.slope.x*e+i.slope.y?i.facet1:i.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var n=0;n<t;n++)for(var r=0;r<e;r++){var i={slope:o.w.Zero(),facet1:new o.y(0,0,0,0),facet2:new o.y(0,0,0,0)};this._heightQuads[n*e+r]=i}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(Sn.b.PositionKind);if(!e)return this;for(var t=o.t.Vector3[3],n=o.t.Vector3[2],r=o.t.Vector3[1],i=o.t.Vector3[0],a=o.t.Vector3[4],s=o.t.Vector3[5],l=o.t.Vector3[6],u=o.t.Vector3[7],c=o.t.Vector3[8],h=0,d=0,f=0,p=0,m=0,g=0,_=0,v=this._subdivisionsX,y=this._subdivisionsY,b=0;b<y;b++)for(var E=0;E<v;E++){h=3*E,d=b*(v+1)*3,f=(b+1)*(v+1)*3,t.x=e[d+h],t.y=e[d+h+1],t.z=e[d+h+2],n.x=e[d+h+3],n.y=e[d+h+4],n.z=e[d+h+5],r.x=e[f+h],r.y=e[f+h+1],r.z=e[f+h+2],i.x=e[f+h+3],i.y=e[f+h+4],i.z=e[f+h+5],p=(i.z-t.z)/(i.x-t.x),m=t.z-p*t.x,n.subtractToRef(t,a),r.subtractToRef(t,s),i.subtractToRef(t,l),o.x.CrossToRef(l,s,u),o.x.CrossToRef(a,l,c),u.normalize(),c.normalize(),g=-(u.x*t.x+u.y*t.y+u.z*t.z),_=-(c.x*n.x+c.y*n.y+c.z*n.z);var x=this._heightQuads[b*v+E];x.slope.copyFromFloats(p,m),x.facet1.copyFromFloats(u.x,u.y,u.z,g),x.facet2.copyFromFloats(c.x,c.y,c.z,_)}return this},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},t.Parse=function(e,n){var r=new t(e.name,n);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},t}(fe.a);Tn.a.CreateGround=function(e){var t,n,r=[],i=[],a=[],s=[],l=e.width||1,u=e.height||1,c=e.subdivisionsX||e.subdivisions||1,h=e.subdivisionsY||e.subdivisions||1;for(t=0;t<=h;t++)for(n=0;n<=c;n++){var d=new o.x(n*l/c-l/2,0,(h-t)*u/h-u/2),f=new o.x(0,1,0);i.push(d.x,d.y,d.z),a.push(f.x,f.y,f.z),s.push(n/c,1-t/h)}for(t=0;t<h;t++)for(n=0;n<c;n++)r.push(n+1+(t+1)*(c+1)),r.push(n+1+t*(c+1)),r.push(n+t*(c+1)),r.push(n+(t+1)*(c+1)),r.push(n+1+(t+1)*(c+1)),r.push(n+t*(c+1));var p=new Tn.a;return p.indices=r,p.positions=i,p.normals=a,p.uvs=s,p},Tn.a.CreateTiledGround=function(e){var t,n,r,i,a=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,s=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,l=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,u=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,c=e.subdivisions||{w:1,h:1},h=e.precision||{w:1,h:1},d=new Array,f=new Array,p=new Array,m=new Array;c.h=c.h<1?1:c.h,c.w=c.w<1?1:c.w,h.w=h.w<1?1:h.w,h.h=h.h<1?1:h.h;var g=(l-a)/c.w,_=(u-s)/c.h;function v(e,r,i,a){var s=f.length/3,l=h.w+1;for(t=0;t<h.h;t++)for(n=0;n<h.w;n++){var u=[s+n+t*l,s+(n+1)+t*l,s+(n+1)+(t+1)*l,s+n+(t+1)*l];d.push(u[1]),d.push(u[2]),d.push(u[3]),d.push(u[0]),d.push(u[1]),d.push(u[3])}var c=o.x.Zero(),g=new o.x(0,1,0);for(t=0;t<=h.h;t++)for(c.z=t*(a-r)/h.h+r,n=0;n<=h.w;n++)c.x=n*(i-e)/h.w+e,c.y=0,f.push(c.x,c.y,c.z),p.push(g.x,g.y,g.z),m.push(n/h.w,t/h.h)}for(r=0;r<c.h;r++)for(i=0;i<c.w;i++)v(a+i*g,s+r*_,a+(i+1)*g,s+(r+1)*_);var y=new Tn.a;return y.indices=d,y.positions=f,y.normals=p,y.uvs=m,y},Tn.a.CreateGroundFromHeightMap=function(e){var t,n,r=[],i=[],a=[],s=[],l=e.colorFilter||new o.e(.3,.59,.11),u=e.alphaFilter||0,c=!1;if(e.minHeight>e.maxHeight){c=!0;var h=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=h}for(t=0;t<=e.subdivisions;t++)for(n=0;n<=e.subdivisions;n++){var d=new o.x(n*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),f=4*(((d.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(d.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),p=e.buffer[f]/255,m=e.buffer[f+1]/255,g=e.buffer[f+2]/255,_=e.buffer[f+3]/255;c&&(p=1-p,m=1-m,g=1-g);var v=p*l.r+m*l.g+g*l.b;d.y=_>=u?e.minHeight+(e.maxHeight-e.minHeight)*v:e.minHeight-o.h,i.push(d.x,d.y,d.z),a.push(0,0,0),s.push(n/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(n=0;n<e.subdivisions;n++){var y=n+1+(t+1)*(e.subdivisions+1),b=n+1+t*(e.subdivisions+1),E=n+t*(e.subdivisions+1),x=n+(t+1)*(e.subdivisions+1),T=i[3*y+1]>=e.minHeight,S=i[3*b+1]>=e.minHeight,A=i[3*E+1]>=e.minHeight;T&&S&&A&&(r.push(y),r.push(b),r.push(E)),i[3*x+1]>=e.minHeight&&T&&A&&(r.push(x),r.push(y),r.push(E))}Tn.a.ComputeNormals(i,r,a);var P=new Tn.a;return P.indices=r,P.positions=i,P.normals=a,P.uvs=s,P},fe.a.CreateGround=function(e,t,n,r,i,o){var a={width:t,height:n,subdivisions:r,updatable:o};return Pn.CreateGround(e,a,i)},fe.a.CreateTiledGround=function(e,t,n,r,i,o,a,s,l){var u={xmin:t,zmin:n,xmax:r,zmax:i,subdivisions:o,precision:a,updatable:l};return Pn.CreateTiledGround(e,u,s)},fe.a.CreateGroundFromHeightMap=function(e,t,n,r,i,o,a,s,l,u,c){var h={width:n,height:r,subdivisions:i,minHeight:o,maxHeight:a,updatable:l,onReady:u,alphaFilter:c};return Pn.CreateGroundFromHeightMap(e,t,h,s)};var Pn=function(){function e(){}return e.CreateGround=function(e,t,n){var r=new An(e,n);return r._setReady(!1),r._subdivisionsX=t.subdivisionsX||t.subdivisions||1,r._subdivisionsY=t.subdivisionsY||t.subdivisions||1,r._width=t.width||1,r._height=t.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,Tn.a.CreateGround(t).applyToMesh(r,t.updatable),r._setReady(!0),r},e.CreateTiledGround=function(e,t,n){void 0===n&&(n=null);var r=new fe.a(e,n);return Tn.a.CreateTiledGround(t).applyToMesh(r,t.updatable),r},e.CreateGroundFromHeightMap=function(e,t,n,r){void 0===r&&(r=null);var i=n.width||10,a=n.height||10,s=n.subdivisions||1,l=n.minHeight||0,u=n.maxHeight||1,c=n.colorFilter||new o.e(.3,.59,.11),h=n.alphaFilter||0,d=n.updatable,f=n.onReady;r=r||P.a.LastCreatedScene;var p=new An(e,r);return p._subdivisionsX=s,p._subdivisionsY=s,p._width=i,p._height=a,p._maxX=p._width/2,p._maxZ=p._height/2,p._minX=-p._maxX,p._minZ=-p._maxZ,p._setReady(!1),ye.h.LoadImage(t,function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!r.isDisposed){var o=e.width,m=e.height;t.width=o,t.height=m,n.drawImage(e,0,0);var g=n.getImageData(0,0,o,m).data;Tn.a.CreateGroundFromHeightMap({width:i,height:a,subdivisions:s,minHeight:l,maxHeight:u,colorFilter:c,buffer:g,bufferWidth:o,bufferHeight:m,alphaFilter:h}).applyToMesh(p,d),f&&f(p),p._setReady(!0)}},function(){},r.offlineProvider),p},e}();Tn.a.CreateTorus=function(e){for(var t=[],n=[],r=[],i=[],a=e.diameter||1,s=e.thickness||.5,l=e.tessellation||16,u=0===e.sideOrientation?0:e.sideOrientation||Tn.a.DEFAULTSIDE,c=l+1,h=0;h<=l;h++)for(var d=h/l,f=h*Math.PI*2/l-Math.PI/2,p=o.j.Translation(a/2,0,0).multiply(o.j.RotationY(f)),m=0;m<=l;m++){var g=1-m/l,_=m*Math.PI*2/l+Math.PI,v=Math.cos(_),y=Math.sin(_),b=new o.x(v,y,0),E=b.scale(s/2),x=new o.w(d,g);E=o.x.TransformCoordinates(E,p),b=o.x.TransformNormal(b,p),n.push(E.x,E.y,E.z),r.push(b.x,b.y,b.z),i.push(x.x,x.y);var T=(h+1)%c,S=(m+1)%c;t.push(h*c+m),t.push(h*c+S),t.push(T*c+m),t.push(h*c+S),t.push(T*c+S),t.push(T*c+m)}Tn.a._ComputeSides(u,n,t,r,i,e.frontUVs,e.backUVs);var A=new Tn.a;return A.indices=t,A.positions=n,A.normals=r,A.uvs=i,A},fe.a.CreateTorus=function(e,t,n,r,i,o,a){var s={diameter:t,thickness:n,tessellation:r,sideOrientation:a,updatable:o};return Rn.CreateTorus(e,s,i)};var Mn,Rn=function(){function e(){}return e.CreateTorus=function(e,t,n){var r=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Tn.a.CreateTorus(t).applyToMesh(r,t.updatable),r},e}(),Cn=n(53),wn=function(){function e(t,n){if(void 0===n&&(n=null),this.scene=t,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._dpadPressed=!0,this._activePointer=!1,this._id=e._idCounter++,n)this._gazeTracker=n.clone("gazeTracker");else{this._gazeTracker=fe.a.CreateTorus("gazeTracker",.0035,.0025,20,t,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var r=new yn.a("targetMat",t);r.specularColor=o.e.Black(),r.emissiveColor=new o.e(.7,.7,.7),r.backFaceCulling=!1,this._gazeTracker.material=r}}return e.prototype._getForwardRay=function(e){return new Ot.a(o.x.Zero(),new o.x(0,0,e))},e.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentHit&&this.scene.simulatePointerDown(this._currentHit,{pointerId:this._id})},e.prototype._selectionPointerUp=function(){this._currentHit&&this.scene.simulatePointerUp(this._currentHit,{pointerId:this._id}),this._pointerDownOnMeshAsked=!1},e.prototype._activatePointer=function(){this._activePointer=!0},e.prototype._deactivatePointer=function(){this._activePointer=!1},e.prototype._updatePointerDistance=function(e){void 0===e&&(e=100)},e.prototype.dispose=function(){this._interactionsEnabled=!1,this._teleportationEnabled=!1,this._gazeTracker&&this._gazeTracker.dispose()},e._idCounter=0,e}(),On=function(e){function t(t,n,r){var i=e.call(this,n,r)||this;i.webVRController=t,i._laserPointer=fe.a.CreateCylinder("laserPointer",1,.004,2e-4,20,1,n,!1);var a=new yn.a("laserPointerMat",n);if(a.emissiveColor=new o.e(.7,.7,.7),a.alpha=.6,i._laserPointer.material=a,i._laserPointer.rotation.x=Math.PI/2,i._laserPointer.position.z=-.5,i._laserPointer.isVisible=!1,i._laserPointer.isPickable=!1,!t.mesh){var s=new fe.a("preloadControllerMesh",n),l=new fe.a(Ft.POINTING_POSE,n);l.rotation.x=-.7,s.addChild(l),t.attachToMesh(s)}return i._setLaserPointerParent(t.mesh),i._meshAttachedObserver=t._meshAttachedObservable.add(function(e){i._setLaserPointerParent(e)}),i}return u.d(t,e),t.prototype._getForwardRay=function(e){return this.webVRController.getForwardRay(e)},t.prototype._activatePointer=function(){e.prototype._activatePointer.call(this),this._laserPointer.isVisible=!0},t.prototype._deactivatePointer=function(){e.prototype._deactivatePointer.call(this),this._laserPointer.isVisible=!1},t.prototype._setLaserPointerColor=function(e){this._laserPointer.material.emissiveColor=e},t.prototype._setLaserPointerParent=function(e){!function e(t){t.isPickable=!1,t.getChildMeshes().forEach(function(t){e(t)})}(e);var t=e.getChildren(void 0,!1),n=e;this.webVRController._pointingPoseNode=null;for(var r=0;r<t.length;r++)if(t[r].name&&t[r].name.indexOf(Ft.POINTING_POSE)>=0){n=t[r],this.webVRController._pointingPoseNode=n;break}this._laserPointer.parent=n},t.prototype._updatePointerDistance=function(e){void 0===e&&(e=100),this._laserPointer.scaling.y=e,this._laserPointer.position.z=-e/2},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._laserPointer.dispose(),this._meshAttachedObserver&&this.webVRController._meshAttachedObservable.remove(this._meshAttachedObserver)},t}(wn),In=function(e){function t(t,n){var r=e.call(this,n)||this;return r.getCamera=t,r}return u.d(t,e),t.prototype._getForwardRay=function(e){var t=this.getCamera();return t?t.getForwardRay(e):new Ot.a(o.x.Zero(),o.x.Forward())},t}(wn),Dn=function(){},Ln=function(){function e(e,t){var n=this;if(void 0===t&&(t={}),this.webVROptions=t,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVRObservable=new i.c,this.onAfterEnteringVRObservable=new i.c,this.onExitingVRObservable=new i.c,this.onControllerMeshLoadedObservable=new i.c,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportActive=!1,this._floorMeshesCollection=[],this._rotationAllowed=!0,this._teleportBackwardsVector=new o.x(0,-1,-1),this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new o.x(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this._leftController=null,this._rightController=null,this.onNewMeshSelected=new i.c,this.onNewMeshPicked=new i.c,this.onBeforeCameraTeleport=new i.c,this.onAfterCameraTeleport=new i.c,this.onSelectedMeshUnselected=new i.c,this.teleportationEnabled=!0,this._teleportationInitialized=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this.updateGazeTrackerScale=!0,this.updateGazeTrackerColor=!0,this.requestPointerLockOnFullScreen=!0,this._onResize=function(){n.moveButtonToBottomRight(),n._fullscreenVRpresenting&&n._webVRready&&n.exitVR()},this._onFullscreenChange=function(){var e=document;void 0!==e.fullscreen?n._fullscreenVRpresenting=document.fullscreen:void 0!==e.mozFullScreen?n._fullscreenVRpresenting=e.mozFullScreen:void 0!==e.webkitIsFullScreen?n._fullscreenVRpresenting=e.webkitIsFullScreen:void 0!==e.msIsFullScreen?n._fullscreenVRpresenting=e.msIsFullScreen:void 0!==document.msFullscreenElement&&(n._fullscreenVRpresenting=document.msFullscreenElement),!n._fullscreenVRpresenting&&n._canvas&&(n.exitVR(),n._useCustomVRButton||(n._btnVR.style.top=n._canvas.offsetTop+n._canvas.offsetHeight-70+"px",n._btnVR.style.left=n._canvas.offsetLeft+n._canvas.offsetWidth-100+"px"))},this._cachedAngularSensibility={angularSensibilityX:null,angularSensibilityY:null,angularSensibility:null},this.beforeRender=function(){n._leftController&&n._leftController._activePointer&&n._castRayAndSelectObject(n._leftController),n._rightController&&n._rightController._activePointer&&n._castRayAndSelectObject(n._rightController),n._noControllerIsActive?n._castRayAndSelectObject(n._cameraGazer):n._cameraGazer._gazeTracker.isVisible=!1},this._onNewGamepadConnected=function(e){if(e.type!==Ke.POSE_ENABLED)e.leftStick&&e.onleftstickchanged(function(e){n._teleportationInitialized&&n.teleportationEnabled&&(!n._leftController&&!n._rightController||n._leftController&&!n._leftController._activePointer&&n._rightController&&!n._rightController._activePointer)&&(n._checkTeleportWithRay(e,n._cameraGazer),n._checkTeleportBackwards(e,n._cameraGazer))}),e.rightStick&&e.onrightstickchanged(function(e){n._teleportationInitialized&&n._checkRotate(e,n._cameraGazer)}),e.type===Ke.XBOX&&(e.onbuttondown(function(e){n._interactionsEnabled&&e===It.A&&n._cameraGazer._selectionPointerDown()}),e.onbuttonup(function(e){n._interactionsEnabled&&e===It.A&&n._cameraGazer._selectionPointerUp()}));else{var t=e,r=new On(t,n._scene,n._cameraGazer._gazeTracker);"right"===t.hand||n._leftController&&n._leftController.webVRController!=t?n._rightController=r:n._leftController=r,n._tryEnableInteractionOnController(r)}},this._tryEnableInteractionOnController=function(e){n._interactionsRequested&&!e._interactionsEnabled&&n._enableInteractionOnController(e),n._teleportationRequested&&!e._teleportationEnabled&&n._enableTeleportationOnController(e)},this._onNewGamepadDisconnected=function(e){e instanceof _n&&("left"===e.hand&&null!=n._leftController&&(n._leftController.dispose(),n._leftController=null),"right"===e.hand&&null!=n._rightController&&(n._rightController.dispose(),n._rightController=null))},this._workingVector=o.x.Zero(),this._workingQuaternion=o.q.Identity(),this._workingMatrix=o.j.Identity(),this._scene=e,this._canvas=e.getEngine().getRenderingCanvas(),void 0===t.createFallbackVRDeviceOrientationFreeCamera&&(t.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===t.createDeviceOrientationCamera&&(t.createDeviceOrientationCamera=!0),void 0===t.laserToggle&&(t.laserToggle=!0),void 0===t.defaultHeight&&(t.defaultHeight=1.7),t.useCustomVRButton&&(this._useCustomVRButton=!0,t.customVRButton&&(this._btnVR=t.customVRButton)),t.rayLength&&(this._rayLength=t.rayLength),this._defaultHeight=t.defaultHeight,t.positionScale&&(this._rayLength*=t.positionScale,this._defaultHeight*=t.positionScale),this._hasEnteredVR=!1,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new o.x(0,this._defaultHeight,0),t.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new Tt("deviceOrientationVRHelper",this._position.clone(),e),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof yt&&this._scene.activeCamera.rotation)){var r=this._scene.activeCamera;r.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(r.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(o.q.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z)),this._deviceOrientationCamera.rotation=r.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(t.createFallbackVRDeviceOrientationFreeCamera&&(t.useMultiview&&(t.vrDeviceOrientationCameraMetrics||(t.vrDeviceOrientationCameraMetrics=rn.GetDefault()),t.vrDeviceOrientationCameraMetrics.multiviewEnabled=!0),this._vrDeviceOrientationCamera=new fn("VRDeviceOrientationVRHelper",this._position,this._scene,!0,t.vrDeviceOrientationCameraMetrics),this._vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._webVRCamera=new gn("WebVRHelper",this._position,this._scene,t),this._webVRCamera.useStandingMatrix(),this._cameraGazer=new In(function(){return n.currentVRCamera},e),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var a=document.createElement("style");a.appendChild(document.createTextNode(".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }.babylonVRicon.vrdisplaypresenting { display: none; }")),document.getElementsByTagName("head")[0].appendChild(a),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){n.isInVRMode?n.exitVR():n.enterVR()}),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),document.onmsfullscreenchange=this._onFullscreenChange,t.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(e){e.vrDisplay&&n.displayVRButton()}),this._onKeyDown=function(e){27===e.keyCode&&n.isInVRMode&&n.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(){n.isInVRMode&&(n.exitVR(),n._fullscreenVRpresenting&&n._scene.getEngine().exitFullscreen())},Pe.a.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(e){return n.onVRDisplayChanged(e)},this._onVrDisplayPresentChange=function(){return n.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){n._webVRrequesting=!0,n.updateButtonVisibility()},this._onVRRequestPresentComplete=function(){n._webVRrequesting=!1,n.updateButtonVisibility()},e.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),e.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),e.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),e.onDisposeObservable.add(function(){n.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(e){return n._onDefaultMeshLoaded(e)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new ee,this._circleEase.setEasingMode($.EASINGMODE_EASEINOUT),this.webVROptions.floorMeshes&&this.enableTeleportation({floorMeshes:this.webVROptions.floorMeshes})}return Object.defineProperty(e.prototype,"onEnteringVR",{get:function(){return this.onEnteringVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onExitingVR",{get:function(){return this.onExitingVRObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onControllerMeshLoaded",{get:function(){return this.onControllerMeshLoadedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(e){e&&(e.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gazeTrackerMesh",{get:function(){return this._cameraGazer._gazeTracker},set:function(e){e&&(this._cameraGazer._gazeTracker&&this._cameraGazer._gazeTracker.dispose(),this._leftController&&this._leftController._gazeTracker&&this._leftController._gazeTracker.dispose(),this._rightController&&this._rightController._gazeTracker&&this._rightController._gazeTracker.dispose(),this._cameraGazer._gazeTracker=e,this._cameraGazer._gazeTracker.bakeCurrentTransformIntoVertices(),this._cameraGazer._gazeTracker.isPickable=!1,this._cameraGazer._gazeTracker.isVisible=!1,this._cameraGazer._gazeTracker.name="gazeTracker",this._leftController&&(this._leftController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")),this._rightController&&(this._rightController._gazeTracker=this._cameraGazer._gazeTracker.clone("gazeTracker")))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftControllerGazeTrackerMesh",{get:function(){return this._leftController?this._leftController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightControllerGazeTrackerMesh",{get:function(){return this._rightController?this._rightController._gazeTracker:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(e){this._displayGaze=e,e||(this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(e){this._displayLaserPointer=e,e?(this._rightController&&this._rightController._activatePointer(),this._leftController&&this._leftController._activatePointer()):(this._rightController&&(this._rightController._deactivatePointer(),this._rightController._gazeTracker.isVisible=!1),this._leftController&&(this._leftController._deactivatePointer(),this._leftController._gazeTracker.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_teleportationRequestInitiated",{get:function(){return this._cameraGazer._teleportationRequestInitiated||null!==this._leftController&&this._leftController._teleportationRequestInitiated||null!==this._rightController&&this._rightController._teleportationRequestInitiated},enumerable:!0,configurable:!0}),e.prototype._onDefaultMeshLoaded=function(e){this._leftController&&this._leftController.webVRController==e&&e.mesh&&this._leftController._setLaserPointerParent(e.mesh),this._rightController&&this._rightController.webVRController==e&&e.mesh&&this._rightController._setLaserPointerParent(e.mesh);try{this.onControllerMeshLoadedObservable.notifyObservers(e)}catch(e){p.a.Warn("Error in your custom logic onControllerMeshLoaded: "+e)}},Object.defineProperty(e.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),e.prototype.onVrDisplayPresentChange=function(){var e=this._scene.getEngine().getVRDevice();if(e){var t=this._webVRpresenting;this._webVRpresenting=e.isPresenting,t&&!this._webVRpresenting&&this.exitVR()}else p.a.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},e.prototype.onVRDisplayChanged=function(e){this._webVRsupported=e.vrSupported,this._webVRready=!!e.vrDisplay,this._webVRpresenting=e.vrDisplay&&e.vrDisplay.isPresenting,this.updateButtonVisibility()},e.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},e.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},e.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},e.prototype.enterVR=function(){var e=this;if(this.onEnteringVRObservable)try{this.onEnteringVRObservable.notifyObservers(this)}catch(e){p.a.Warn("Error in your custom logic onEnteringVR: "+e)}if(this._scene.activeCamera){if(this._position=this._scene.activeCamera.position.clone(),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.rotation=o.q.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles(),this.vrDeviceOrientationCamera.angularSensibility=2e3),this.webVRCamera){var t=this.webVRCamera.deviceRotationQuaternion.toEulerAngles().y,n=o.q.FromRotationMatrix(this._scene.activeCamera.getWorldMatrix().getRotationMatrix()).toEulerAngles().y-t,r=this.webVRCamera.rotationQuaternion.toEulerAngles().y;this.webVRCamera.rotationQuaternion=o.q.FromEulerAngles(0,r+n,0)}this._existingCamera=this._scene.activeCamera,this._existingCamera.angularSensibilityX&&(this._cachedAngularSensibility.angularSensibilityX=this._existingCamera.angularSensibilityX,this._existingCamera.angularSensibilityX=Number.MAX_VALUE),this._existingCamera.angularSensibilityY&&(this._cachedAngularSensibility.angularSensibilityY=this._existingCamera.angularSensibilityY,this._existingCamera.angularSensibilityY=Number.MAX_VALUE),this._existingCamera.angularSensibility&&(this._cachedAngularSensibility.angularSensibility=this._existingCamera.angularSensibility,this._existingCamera.angularSensibility=Number.MAX_VALUE)}this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._scene.getEngine().onVRRequestPresentComplete.addOnce(function(t){e.onAfterEnteringVRObservable.notifyObservers({success:t})}),this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera&&(this._vrDeviceOrientationCamera.minZ=this._scene.activeCamera.minZ),this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().enterFullscreen(this.requestPointerLockOnFullScreen),this.updateButtonVisibility(),this._vrDeviceOrientationCamera.onViewMatrixChangedObservable.addOnce(function(){e.onAfterEnteringVRObservable.notifyObservers({success:!0})})),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._interactionsEnabled&&this._scene.registerBeforeRender(this.beforeRender),this._displayLaserPointer&&[this._leftController,this._rightController].forEach(function(e){e&&e._activatePointer()}),this._hasEnteredVR=!0)},e.prototype.exitVR=function(){if(this._hasEnteredVR){if(this.onExitingVRObservable)try{this.onExitingVRObservable.notifyObservers(this)}catch(e){p.a.Warn("Error in your custom logic onExitingVR: "+e)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this.vrDeviceOrientationCamera&&(this.vrDeviceOrientationCamera.angularSensibility=Number.MAX_VALUE),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas),this._cachedAngularSensibility.angularSensibilityX&&(this._deviceOrientationCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._deviceOrientationCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._deviceOrientationCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera,this._cachedAngularSensibility.angularSensibilityX&&(this._existingCamera.angularSensibilityX=this._cachedAngularSensibility.angularSensibilityX,this._cachedAngularSensibility.angularSensibilityX=null),this._cachedAngularSensibility.angularSensibilityY&&(this._existingCamera.angularSensibilityY=this._cachedAngularSensibility.angularSensibilityY,this._cachedAngularSensibility.angularSensibilityY=null),this._cachedAngularSensibility.angularSensibility&&(this._existingCamera.angularSensibility=this._cachedAngularSensibility.angularSensibility,this._cachedAngularSensibility.angularSensibility=null)),this.updateButtonVisibility(),this._interactionsEnabled&&(this._scene.unregisterBeforeRender(this.beforeRender),this._cameraGazer._gazeTracker.isVisible=!1,this._leftController&&(this._leftController._gazeTracker.isVisible=!1),this._rightController&&(this._rightController._gazeTracker.isVisible=!1)),this._scene.getEngine().resize(),[this._leftController,this._rightController].forEach(function(e){e&&e._deactivatePointer()}),this._hasEnteredVR=!1;var e=this._scene.getEngine();e._onVrDisplayPresentChange&&e._onVrDisplayPresentChange()}},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._scene.activeCamera&&(this._scene.activeCamera.position=e)},enumerable:!0,configurable:!0}),e.prototype.enableInteractions=function(){var e=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftController&&this._enableInteractionOnController(this._leftController),this._rightController&&this._enableInteractionOnController(this._rightController),this.raySelectionPredicate=function(t){return t.isVisible&&(t.isPickable||t.name===e._floorMeshName)},this.meshSelectionPredicate=function(){return!0},this._raySelectionPredicate=function(t){return!!(e._isTeleportationFloor(t)||-1===t.name.indexOf("gazeTracker")&&-1===t.name.indexOf("teleportationTarget")&&-1===t.name.indexOf("torusTeleportation"))&&e.raySelectionPredicate(t)},this._interactionsEnabled=!0)},Object.defineProperty(e.prototype,"_noControllerIsActive",{get:function(){return!(this._leftController&&this._leftController._activePointer||this._rightController&&this._rightController._activePointer)},enumerable:!0,configurable:!0}),e.prototype._isTeleportationFloor=function(e){for(var t=0;t<this._floorMeshesCollection.length;t++)if(this._floorMeshesCollection[t].id===e.id)return!0;return!(!this._floorMeshName||e.name!==this._floorMeshName)},e.prototype.addFloorMesh=function(e){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(e)>-1||this._floorMeshesCollection.push(e))},e.prototype.removeFloorMesh=function(e){if(this._floorMeshesCollection){var t=this._floorMeshesCollection.indexOf(e);-1!==t&&this._floorMeshesCollection.splice(t,1)}},e.prototype.enableTeleportation=function(e){if(void 0===e&&(e={}),!this._teleportationInitialized){this._teleportationRequested=!0,this.enableInteractions(),e.floorMeshName&&(this._floorMeshName=e.floorMeshName),e.floorMeshes&&(this._floorMeshesCollection=e.floorMeshes),null!=this._leftController&&this._enableTeleportationOnController(this._leftController),null!=this._rightController&&this._enableTeleportationOnController(this._rightController);var t=new vn.a;t.vignetteColor=new o.f(0,0,0,0),t.vignetteEnabled=!0,this._postProcessMove=new xn("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,t),this._webVRCamera.detachPostProcess(this._postProcessMove),this._teleportationInitialized=!0,this._isDefaultTeleportationTarget&&(this._createTeleportationCircles(),this._teleportationTarget.scaling.scaleInPlace(this._webVRCamera.deviceScaleFactor))}},e.prototype._enableInteractionOnController=function(e){var t=this;e.webVRController.mesh&&(e._interactionsEnabled=!0,this.isInVRMode&&this._displayLaserPointer&&e._activatePointer(),this.webVROptions.laserToggle&&e.webVRController.onMainButtonStateChangedObservable.add(function(n){t._displayLaserPointer&&1===n.value&&(e._activePointer?e._deactivatePointer():e._activatePointer(),t.displayGaze&&(e._gazeTracker.isVisible=e._activePointer))}),e.webVRController.onTriggerStateChangedObservable.add(function(n){var r=e;t._noControllerIsActive&&(r=t._cameraGazer),r._pointerDownOnMeshAsked?n.value<t._padSensibilityDown&&r._selectionPointerUp():n.value>t._padSensibilityUp&&r._selectionPointerDown()}))},e.prototype._checkTeleportWithRay=function(e,t){this._teleportationRequestInitiated&&!t._teleportationRequestInitiated||(t._teleportationRequestInitiated?Math.sqrt(e.y*e.y+e.x*e.x)<this._padSensibilityDown&&(this._teleportActive&&this.teleportCamera(this._haloCenter),t._teleportationRequestInitiated=!1):e.y<-this._padSensibilityUp&&t._dpadPressed&&(t._activatePointer(),t._teleportationRequestInitiated=!0))},e.prototype._checkRotate=function(e,t){t._teleportationRequestInitiated||(t._rotationLeftAsked?e.x>-this._padSensibilityDown&&(t._rotationLeftAsked=!1):e.x<-this._padSensibilityUp&&t._dpadPressed&&(t._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),t._rotationRightAsked?e.x<this._padSensibilityDown&&(t._rotationRightAsked=!1):e.x>this._padSensibilityUp&&t._dpadPressed&&(t._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},e.prototype._checkTeleportBackwards=function(e,t){if(!t._teleportationRequestInitiated)if(e.y>this._padSensibilityUp&&t._dpadPressed){if(!t._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var n=o.q.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),r=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(n=this.currentVRCamera.deviceRotationQuaternion,r=this.currentVRCamera.devicePosition),n.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,o.q.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),o.x.TransformCoordinatesToRef(this._teleportBackwardsVector,this._workingMatrix,this._workingVector);var i=new Ot.a(r,this._workingVector),a=this._scene.pickWithRay(i,this._raySelectionPredicate);a&&a.pickedPoint&&a.pickedMesh&&this._isTeleportationFloor(a.pickedMesh)&&a.distance<5&&this.teleportCamera(a.pickedPoint),t._teleportationBackRequestInitiated=!0}}else t._teleportationBackRequestInitiated=!1},e.prototype._enableTeleportationOnController=function(e){var t=this;e.webVRController.mesh&&(e._interactionsEnabled||this._enableInteractionOnController(e),e._interactionsEnabled=!0,e._teleportationEnabled=!0,e.webVRController.controllerType===Mt.VIVE&&(e._dpadPressed=!1,e.webVRController.onPadStateChangedObservable.add(function(t){e._dpadPressed=t.pressed,e._dpadPressed||(e._rotationLeftAsked=!1,e._rotationRightAsked=!1,e._teleportationBackRequestInitiated=!1)})),e.webVRController.onPadValuesChangedObservable.add(function(n){t.teleportationEnabled&&(t._checkTeleportBackwards(n,e),t._checkTeleportWithRay(n,e)),t._checkRotate(n,e)}))},e.prototype._createTeleportationCircles=function(){this._teleportationTarget=fe.a.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var e=new bn("DynamicTexture",512,this._scene,!0);e.hasAlpha=!0;var t=e.getContext();t.beginPath(),t.arc(256,256,200,0,2*Math.PI,!1),t.fillStyle=this._teleportationFillColor,t.fill(),t.lineWidth=10,t.strokeStyle=this._teleportationBorderColor,t.stroke(),t.closePath(),e.update();var n=new yn.a("TextPlaneMaterial",this._scene);n.diffuseTexture=e,this._teleportationTarget.material=n;var r=fe.a.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);r.isPickable=!1,r.parent=this._teleportationTarget;var i=new B("animationInnerCircle","position.y",30,B.ANIMATIONTYPE_FLOAT,B.ANIMATIONLOOPMODE_CYCLE),o=[];o.push({frame:0,value:0}),o.push({frame:30,value:.4}),o.push({frame:60,value:0}),i.setKeys(o);var a=new ce;a.setEasingMode($.EASINGMODE_EASEINOUT),i.setEasingFunction(a),r.animations=[],r.animations.push(i),this._scene.beginAnimation(r,0,60,!0),this._hideTeleportationTarget()},e.prototype._displayTeleportationTarget=function(){this._teleportActive=!0,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},e.prototype._hideTeleportationTarget=function(){this._teleportActive=!1,this._teleportationInitialized&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},e.prototype._rotateCamera=function(e){var t=this;if(this.currentVRCamera instanceof bt){e?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var n=o.q.FromRotationMatrix(o.j.RotationY(Math.PI/4*this._rotationAngle)),r=new B("animationRotation","rotationQuaternion",90,B.ANIMATIONTYPE_QUATERNION,B.ANIMATIONLOOPMODE_CONSTANT),i=[];i.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),i.push({frame:6,value:n}),r.setKeys(i),r.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(r),this._postProcessMove.animations=[];var a=new B("animationPP","vignetteWeight",90,B.ANIMATIONTYPE_FLOAT,B.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:0}),s.push({frame:3,value:4}),s.push({frame:6,value:0}),a.setKeys(s),a.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(a);var l=new B("animationPP2","vignetteStretch",90,B.ANIMATIONTYPE_FLOAT,B.ANIMATIONLOOPMODE_CONSTANT),u=[];u.push({frame:0,value:0}),u.push({frame:3,value:10}),u.push({frame:6,value:0}),l.setKeys(u),l.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(l),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._postProcessMove.samples=4,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){t._webVRCamera.detachPostProcess(t._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},e.prototype._moveTeleportationSelectorTo=function(e,t,n){if(e.pickedPoint){t._teleportationRequestInitiated&&(this._displayTeleportationTarget(),this._haloCenter.copyFrom(e.pickedPoint),this._teleportationTarget.position.copyFrom(e.pickedPoint));var r=this._convertNormalToDirectionOfRay(e.getNormal(!0,!1),n);if(r){var i=o.x.Cross(o.c.Y,r),a=o.x.Cross(r,i);o.x.RotationFromAxisToRef(a,r,i,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},e.prototype.teleportCamera=function(e){var t=this;if(this.currentVRCamera instanceof bt){this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),e.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(e),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround()*this._webVRCamera.deviceScaleFactor:this._workingVector.y+=this._defaultHeight,this.onBeforeCameraTeleport.notifyObservers(this._workingVector),this.currentVRCamera.animations=[];var n=new B("animationCameraTeleportation","position",90,B.ANIMATIONTYPE_VECTOR3,B.ANIMATIONLOOPMODE_CONSTANT),r=[{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}];n.setKeys(r),n.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(n),this._postProcessMove.animations=[];var i=new B("animationPP","vignetteWeight",90,B.ANIMATIONTYPE_FLOAT,B.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:0}),o.push({frame:5,value:8}),o.push({frame:11,value:0}),i.setKeys(o),this._postProcessMove.animations.push(i);var a=new B("animationPP2","vignetteStretch",90,B.ANIMATIONTYPE_FLOAT,B.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:0}),s.push({frame:5,value:10}),s.push({frame:11,value:0}),a.setKeys(s),this._postProcessMove.animations.push(a),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,function(){t._webVRCamera.detachPostProcess(t._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1,function(){t.onAfterCameraTeleport.notifyObservers(t._workingVector)}),this._hideTeleportationTarget()}},e.prototype._convertNormalToDirectionOfRay=function(e,t){return e&&Math.acos(o.x.Dot(e,t.direction))<Math.PI/2&&e.scaleInPlace(-1),e},e.prototype._castRayAndSelectObject=function(e){if(this.currentVRCamera instanceof bt){var t=e._getForwardRay(this._rayLength),n=this._scene.pickWithRay(t,this._raySelectionPredicate);if(n&&(e._laserPointer&&(n.originMesh=e._laserPointer.parent),this._scene.simulatePointerMove(n,{pointerId:e._id})),e._currentHit=n,n&&n.pickedPoint){if(this._displayGaze){var r=1;e._gazeTracker.isVisible=!0,e._isActionableMesh&&(r=3),this.updateGazeTrackerScale&&(e._gazeTracker.scaling.x=n.distance*r,e._gazeTracker.scaling.y=n.distance*r,e._gazeTracker.scaling.z=n.distance*r);var i=this._convertNormalToDirectionOfRay(n.getNormal(),t);if(i){var a=o.x.Cross(o.c.Y,i),s=o.x.Cross(i,a);o.x.RotationFromAxisToRef(s,i,a,e._gazeTracker.rotation)}e._gazeTracker.position.copyFrom(n.pickedPoint),e._gazeTracker.position.x<0?e._gazeTracker.position.x+=.002:e._gazeTracker.position.x-=.002,e._gazeTracker.position.y<0?e._gazeTracker.position.y+=.002:e._gazeTracker.position.y-=.002,e._gazeTracker.position.z<0?e._gazeTracker.position.z+=.002:e._gazeTracker.position.z-=.002}e._updatePointerDistance(n.distance)}else e._updatePointerDistance(),e._gazeTracker.isVisible=!1;if(n&&n.pickedMesh){if(this._teleportationInitialized&&this._isTeleportationFloor(n.pickedMesh)&&n.pickedPoint)return e._currentMeshSelected&&!this._isTeleportationFloor(e._currentMeshSelected)&&this._notifySelectedMeshUnselected(e._currentMeshSelected),e._currentMeshSelected=null,void(e._teleportationRequestInitiated&&this._moveTeleportationSelectorTo(n,e,t));if(n.pickedMesh!==e._currentMeshSelected)if(this.meshSelectionPredicate(n.pickedMesh)){this.onNewMeshPicked.notifyObservers(n),e._currentMeshSelected=n.pickedMesh,n.pickedMesh.isPickable&&n.pickedMesh.actionManager?(this.changeGazeColor(new o.e(0,0,1)),this.changeLaserColor(new o.e(.2,.2,1)),e._isActionableMesh=!0):(this.changeGazeColor(new o.e(.7,.7,.7)),this.changeLaserColor(new o.e(.7,.7,.7)),e._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(n.pickedMesh)}catch(e){p.a.Warn("Error in your custom logic onNewMeshSelected: "+e)}}else this._notifySelectedMeshUnselected(e._currentMeshSelected),e._currentMeshSelected=null,this.changeGazeColor(new o.e(.7,.7,.7)),this.changeLaserColor(new o.e(.7,.7,.7))}else this._notifySelectedMeshUnselected(e._currentMeshSelected),e._currentMeshSelected=null,this.changeGazeColor(new o.e(.7,.7,.7)),this.changeLaserColor(new o.e(.7,.7,.7))}},e.prototype._notifySelectedMeshUnselected=function(e){e&&this.onSelectedMeshUnselected.notifyObservers(e)},e.prototype.changeLaserColor=function(e){this._leftController&&this._leftController._setLaserPointerColor(e),this._rightController&&this._rightController._setLaserPointerColor(e)},e.prototype.changeGazeColor=function(e){this.updateGazeTrackerColor&&this._cameraGazer._gazeTracker.material&&(this._cameraGazer._gazeTracker.material.emissiveColor=e,this._leftController&&(this._leftController._gazeTracker.material.emissiveColor=e),this._rightController&&(this._rightController._gazeTracker.material.emissiveColor=e))},e.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._cameraGazer&&this._cameraGazer.dispose(),this._leftController&&this._leftController.dispose(),this._rightController&&this._rightController.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.onmsfullscreenchange=null,this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},e.prototype.getClassName=function(){return"VRExperienceHelper"},e}(),Fn=function(e){function t(t,n){var r=e.call(this,t,o.x.Zero(),n)||this;return r.minZ=0,r.rotationQuaternion=new o.q,r.cameraRigMode=Ne.a.RIG_MODE_CUSTOM,r.updateUpVectorFromRotation=!0,r._updateNumberOfRigCameras(1),r}return u.d(t,e),t.prototype._updateNumberOfRigCameras=function(e){for(void 0===e&&(e=1);this.rigCameras.length<e;){var t=new yt("view: "+this.rigCameras.length,o.x.Zero(),this.getScene());t.minZ=0,t.parent=this,t.rotationQuaternion=new o.q,t.updateUpVectorFromRotation=!0,this.rigCameras.push(t)}for(;this.rigCameras.length>e;){var n=this.rigCameras.pop();n&&n.dispose()}},t.prototype._updateForDualEyeDebugging=function(e){void 0===e&&(e=.01),this._updateNumberOfRigCameras(2),this.rigCameras[0].viewport=new o.z(0,0,.5,1),this.rigCameras[0].position.x=-e/2,this.rigCameras[0].outputRenderTarget=null,this.rigCameras[1].viewport=new o.z(.5,0,.5,1),this.rigCameras[1].position.x=e/2,this.rigCameras[1].outputRenderTarget=null},t.prototype.updateFromXRSessionManager=function(e){var n=this;if(!e._currentXRFrame||!e._currentXRFrame.getDevicePose)return!1;var r=e._currentXRFrame.getDevicePose(e._frameOfReference);return!(!r||!r.poseModelMatrix)&&(o.j.FromFloat32ArrayToRefScaled(r.poseModelMatrix,0,1,t._TmpMatrix),this._scene.useRightHandedSystem||t._TmpMatrix.toggleModelMatrixHandInPlace(),t._TmpMatrix.getTranslationToRef(this.position),t._TmpMatrix.getRotationMatrixToRef(t._TmpMatrix),o.q.FromRotationMatrixToRef(t._TmpMatrix,this.rotationQuaternion),this.computeWorldMatrix(),this._updateNumberOfRigCameras(e._currentXRFrame.views.length),e._currentXRFrame.views.forEach(function(t,i){o.j.FromFloat32ArrayToRefScaled(r.getViewMatrix(t),0,1,n.rigCameras[i]._computedViewMatrix),o.j.FromFloat32ArrayToRefScaled(t.projectionMatrix,0,1,n.rigCameras[i]._projectionMatrix),n._scene.useRightHandedSystem||(n.rigCameras[i]._computedViewMatrix.toggleModelMatrixHandInPlace(),n.rigCameras[i]._projectionMatrix.toggleProjectionMatrixHandInPlace());var a=e._xrSession.baseLayer.getViewport(t),s=e._xrSession.baseLayer.framebufferWidth,l=e._xrSession.baseLayer.framebufferHeight;n.rigCameras[i].viewport.width=a.width/s,n.rigCameras[i].viewport.height=a.height/l,n.rigCameras[i].viewport.x=a.x/s,n.rigCameras[i].viewport.y=a.y/l,n.rigCameras[i].outputRenderTarget=e._sessionRenderTargetTexture}),!0)},t._TmpMatrix=new o.j,t}(bt),Nn=function(){function e(e){this.scene=e,this.onXRFrameObservable=new i.c,this.onXRSessionEnded=new i.c,this._sessionRenderTargetTexture=null,this._tmpMatrix=new o.j}return e.prototype.initializeAsync=function(){var e=this;return p.a.Warn("The WebXR APIs are still under development and are subject to change in the future."),this._xrNavigator=navigator,this._xrNavigator.xr?this._xrNavigator.xr.requestDevice().then(function(t){return e._xrDevice=t,e.scene.getEngine()._gl.setCompatibleXRDevice(e._xrDevice)}):Promise.reject("webXR not supported by this browser")},e.prototype.enterXRAsync=function(t,n){var r=this;return this._xrDevice.requestSession(t).then(function(e){return r._xrSession=e,r._xrSession.addEventListener("end",function(){r._sessionRenderTargetTexture=null,r.scene.getEngine().restoreDefaultFramebuffer(),r.scene.getEngine().customAnimationFrameRequester=null,r.onXRSessionEnded.notifyObservers(null),r.scene.getEngine()._renderLoop()},{once:!0}),r._xrSession.baseLayer=new XRWebGLLayer(r._xrSession,r.scene.getEngine()._gl),r._xrSession.requestFrameOfReference(n)}).then(function(t){r._frameOfReference=t,r.scene.getEngine().customAnimationFrameRequester={requestAnimationFrame:r._xrSession.requestAnimationFrame.bind(r._xrSession),renderFunction:function(e,t){r._currentXRFrame=t,r.onXRFrameObservable.notifyObservers(null),r.scene.getEngine()._renderLoop()}},r._sessionRenderTargetTexture=e._CreateRenderTargetTextureFromSession(r._xrSession,r.scene),window.cancelAnimationFrame(r.scene.getEngine()._frameHandler),r.scene.getEngine()._renderLoop()})},e.prototype.exitXRAsync=function(){return this._xrSession.end()},e.prototype.environmentPointHitTestAsync=function(e){var t=this;return new Promise(function(n){var r=new Float32Array([e.origin.x,e.origin.y,e.origin.z]),i=new Float32Array([e.direction.x,e.direction.y,e.direction.z]);t.scene.useRightHandedSystem||(r[2]*=-1,i[2]*=-1),t._xrSession.requestHitTest(r,i,t._frameOfReference).then(function(e){if(e.length>0){o.j.FromFloat32ArrayToRefScaled(e[0].hitMatrix,0,1,t._tmpMatrix);var r=t._tmpMatrix.getTranslation();t.scene.useRightHandedSystem||(r.z*=-1),n(r)}else n(null)}).catch(function(){n(null)})})},e.prototype.supportsSessionAsync=function(e){return this._xrDevice.supportsSession(e).then(function(){return!0}).catch(function(){return!1})},e._CreateRenderTargetTextureFromSession=function(e,t){var n=new ze.a(t.getEngine(),ze.a.DATASOURCE_UNKNOWN,!0);n.width=e.baseLayer.framebufferWidth,n.height=e.baseLayer.framebufferHeight,n._framebuffer=e.baseLayer.framebuffer;var r=new un("XR renderTargetTexture",{width:n.width,height:n.height},t,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,!0);return r._texture=n,r},e.prototype.dispose=function(){this.onXRFrameObservable.clear(),this.onXRSessionEnded.clear()},e}();!function(e){e[e.ENTERING_XR=0]="ENTERING_XR",e[e.EXITING_XR=1]="EXITING_XR",e[e.IN_XR=2]="IN_XR",e[e.NOT_IN_XR=3]="NOT_IN_XR"}(Mn||(Mn={}));var Bn,Un=function(){function e(e){this.scene=e,this.state=Mn.NOT_IN_XR,this.onStateChangedObservable=new i.c,this._nonVRCamera=null,this._originalSceneAutoClear=!0,this._supported=!1,this.camera=new Fn("",e),this._sessionManager=new Nn(e),this.container=new Fe.a("",e),this.camera.parent=this.container}return e.prototype._setState=function(e){this.state=e,this.onStateChangedObservable.notifyObservers(this.state)},e.CreateAsync=function(t){var n=new e(t);return n._sessionManager.initializeAsync().then(function(){return n._supported=!0,n}).catch(function(){return n})},e.prototype.exitXRAsync=function(){return this._setState(Mn.EXITING_XR),this._sessionManager.exitXRAsync()},e.prototype.enterXRAsync=function(e,t){var n=this;if(!this._supported)throw"XR session not supported by this browser";return this._setState(Mn.ENTERING_XR),this._sessionManager.enterXRAsync(e,t).then(function(){n._originalSceneAutoClear=n.scene.autoClear,n._nonVRCamera=n.scene.activeCamera,n.scene.autoClear=!1,n.scene.activeCamera=n.camera,n._sessionManager.onXRFrameObservable.add(function(){n.camera.updateFromXRSessionManager(n._sessionManager)}),n._sessionManager.onXRSessionEnded.addOnce(function(){n.camera.rigCameras.forEach(function(e){e.outputRenderTarget=null}),n.scene.autoClear=n._originalSceneAutoClear,n.scene.activeCamera=n._nonVRCamera,n._sessionManager.onXRFrameObservable.clear(),n._setState(Mn.NOT_IN_XR)}),n._setState(Mn.IN_XR)})},e.prototype.environmentPointHitTestAsync=function(e){return this._sessionManager.environmentPointHitTestAsync(e)},e.prototype.setPositionOfCameraUsingContainer=function(t){this.camera.globalPosition.subtractToRef(t,e._TmpVector),this.container.position.subtractInPlace(e._TmpVector)},e.prototype.rotateCameraByQuaternionUsingContainer=function(e){this.container.rotationQuaternion||(this.container.rotationQuaternion=o.q.FromEulerVector(this.container.rotation)),this.container.rotationQuaternion.multiplyInPlace(e),this.container.position.rotateByQuaternionAroundPointToRef(e,this.camera.globalPosition,this.container.position)},e.prototype.supportsSessionAsync=function(e){return this._supported?this._sessionManager.supportsSessionAsync(e):Promise.resolve(!1)},e.prototype.dispose=function(){this.camera.dispose(),this.container.dispose(),this.onStateChangedObservable.clear(),this._sessionManager.dispose()},e._TmpVector=new o.x,e}(),kn=function(){function e(e,t){this.element=e,this.initializationOptions=t}return e.prototype.update=function(e){},e}(),Vn=function(){},Gn=function(){function e(e,t){var n=this;if(this.scene=e,this._buttons=[],this._activeButton=null,this.activeButtonChangedObservable=new i.c,this._overlay=document.createElement("div"),this._overlay.style.cssText="z-index:11;position: absolute; right: 20px;bottom: 50px;",t.customButtons)this._buttons=t.customButtons;else{var r=document.createElement("button");r.style.cssText="color: #868686; border-color: #868686; border-style: solid; margin-left: 10px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-repeat:no-repeat; background-position: center; outline: none;",r.innerText="HMD",this._buttons.push(new kn(r,{immersive:!0,outputContext:t.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",this.element.innerText=e===this?"EXIT":"HMD"};var o=document.createElement("button");o.style.cssText=r.style.cssText,o.innerText="Window",this._buttons.push(new kn(o,{immersive:!1,environmentIntegration:!0,outputContext:t.outputCanvasContext})),this._buttons[this._buttons.length-1].update=function(e){this.element.style.display=null===e||e===this?"":"none",this.element.innerText=e===this?"EXIT":"Window"},this._updateButtons(null)}var a=e.getEngine().getRenderingCanvas();a&&a.parentNode&&(a.parentNode.appendChild(this._overlay),e.onDisposeObservable.addOnce(function(){n.dispose()}))}return e.CreateAsync=function(t,n,r){var i=this,o=new e(t,r),a=o._buttons.map(function(e){return n.supportsSessionAsync(e.initializationOptions)});return n.onStateChangedObservable.add(function(e){e==Mn.NOT_IN_XR&&o._updateButtons(null)}),Promise.all(a).then(function(e){return e.forEach(function(e,t){e&&(o._overlay.appendChild(o._buttons[t].element),o._buttons[t].element.onclick=function(){return u.b(i,void 0,void 0,function(){return u.e(this,function(e){switch(e.label){case 0:return n.state!=Mn.IN_XR?[3,2]:(o._updateButtons(null),[4,n.exitXRAsync()]);case 1:return e.sent(),[2];case 2:return n.state!=Mn.NOT_IN_XR?[3,4]:(o._updateButtons(o._buttons[t]),[4,n.enterXRAsync(o._buttons[t].initializationOptions,"eye-level")]);case 3:e.sent(),e.label=4;case 4:return[2]}})})})}),o})},e.prototype._updateButtons=function(e){var t=this;this._activeButton=e,this._buttons.forEach(function(e){e.update(t._activeButton)}),this.activeButtonChangedObservable.notifyObservers(this._activeButton)},e.prototype.dispose=function(){var e=this.scene.getEngine().getRenderingCanvas();e&&e.parentNode&&e.parentNode.contains(this._overlay)&&e.parentNode.removeChild(this._overlay),this.activeButtonChangedObservable.clear()},e}(),zn=function(){function e(e){this.pointer=new Fe.a("controllerPointer",e)}return e.prototype.dispose=function(){this.grip&&this.grip.dispose(),this.pointer.dispose()},e}(),jn=function(){function e(e){var t=this;this.helper=e,this.controllers=[],this._tmpMatrix=new o.j,this._frameObserver=e._sessionManager.onXRFrameObservable.add(function(){if(e._sessionManager._currentXRFrame&&e._sessionManager._currentXRFrame.getDevicePose){var n=e._sessionManager._currentXRFrame;e._sessionManager._xrSession.getInputSources().forEach(function(r,i){var a=n.getInputPose(r,e._sessionManager._frameOfReference);if(a){t.controllers.length<=i&&t.controllers.push(new zn(e.container.getScene()));var s=t.controllers[i];a.gripMatrix&&(s.grip||(s.grip=new Fe.a("controllerGrip",e.container.getScene())),o.j.FromFloat32ArrayToRefScaled(a.gripMatrix,0,1,t._tmpMatrix),s.grip.getScene().useRightHandedSystem||t._tmpMatrix.toggleModelMatrixHandInPlace(),s.grip.rotationQuaternion||(s.grip.rotationQuaternion=new o.q),t._tmpMatrix.decompose(s.grip.scaling,s.grip.rotationQuaternion,s.grip.position)),o.j.FromFloat32ArrayToRefScaled(a.targetRay.transformMatrix,0,1,t._tmpMatrix),s.pointer.getScene().useRightHandedSystem||t._tmpMatrix.toggleModelMatrixHandInPlace(),s.pointer.rotationQuaternion||(s.pointer.rotationQuaternion=new o.q),t._tmpMatrix.decompose(s.pointer.scaling,s.pointer.rotationQuaternion,s.pointer.position)}})}})}return e.prototype.dispose=function(){this.controllers.forEach(function(e){e.dispose()}),this.helper._sessionManager.onXRFrameObservable.remove(this._frameObserver)},e}(),Hn=function(){function e(e,t){var n=this;this._canvas=null,this.canvasContext=null,t||((t=document.createElement("canvas")).style.cssText="position:absolute; bottom:0px;right:0px;z-index:10;width:100%;height:100%;background-color: #000000;"),this._setManagedOutputCanvas(t),e.onStateChangedObservable.add(function(t){t==Mn.ENTERING_XR?n._addCanvas():e.state==Mn.NOT_IN_XR&&n._removeCanvas()})}return e.prototype.dispose=function(){this._removeCanvas(),this._setManagedOutputCanvas(null)},e.prototype._setManagedOutputCanvas=function(e){this._removeCanvas(),e?(this._canvas=e,this.canvasContext=this._canvas.getContext("xrpresent")):(this._canvas=null,this.canvasContext=null)},e.prototype._addCanvas=function(){this._canvas&&document.body.appendChild(this._canvas)},e.prototype._removeCanvas=function(){this._canvas&&document.body.contains(this._canvas)&&document.body.removeChild(this._canvas)},e}(),Wn=(Bn={root:0,found:!1},function(e,t,n,r){Bn.root=0,Bn.found=!1;var i=t*t-4*e*n;if(i<0)return Bn;var o=Math.sqrt(i),a=(-t-o)/(2*e),s=(-t+o)/(2*e);if(a>s){var l=s;s=a,a=l}return a>0&&a<r?(Bn.root=a,Bn.found=!0,Bn):s>0&&s<r?(Bn.root=s,Bn.found=!0,Bn):Bn}),Xn=function(){function e(){this._collisionPoint=o.x.Zero(),this._planeIntersectionPoint=o.x.Zero(),this._tempVector=o.x.Zero(),this._tempVector2=o.x.Zero(),this._tempVector3=o.x.Zero(),this._tempVector4=o.x.Zero(),this._edge=o.x.Zero(),this._baseToVertex=o.x.Zero(),this._destinationPoint=o.x.Zero(),this._slidePlaneNormal=o.x.Zero(),this._displacementVector=o.x.Zero(),this._radius=o.x.One(),this._retry=0,this._basePointWorld=o.x.Zero(),this._velocityWorld=o.x.Zero(),this._normalizedVelocity=o.x.Zero(),this._collisionMask=-1}return Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e,t,n){this._velocity=t,o.x.NormalizeToRef(t,this._normalizedVelocity),this._basePoint=e,e.multiplyToRef(this._radius,this._basePointWorld),t.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=n,this.collisionFound=!1},e.prototype._checkPointInTriangle=function(e,t,n,r,i){t.subtractToRef(e,this._tempVector),n.subtractToRef(e,this._tempVector2),o.x.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var a=o.x.Dot(this._tempVector4,i);return!(a<0)&&(r.subtractToRef(e,this._tempVector3),o.x.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((a=o.x.Dot(this._tempVector4,i))<0)&&(o.x.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(a=o.x.Dot(this._tempVector4,i))>=0))},e.prototype._canDoCollision=function(e,t,n,r){var i=o.x.Distance(this._basePointWorld,e),a=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(i>this._velocityWorldLength+a+t)&&!!function(e,t,n,r){return!(e.x>n.x+r||n.x-r>t.x||e.y>n.y+r||n.y-r>t.y||e.z>n.z+r||n.z-r>t.z)}(n,r,this._basePointWorld,this._velocityWorldLength+a)},e.prototype._testTriangle=function(e,t,n,r,i,a){var s,l=!1;t||(t=[]),t[e]||(t[e]=new o.n(0,0,0,0),t[e].copyFromPoints(n,r,i));var u=t[e];if(a||u.isFrontFacingTo(this._normalizedVelocity,0)){var c=u.signedDistanceTo(this._basePoint),h=o.x.Dot(u.normal,this._velocity);if(0==h){if(Math.abs(c)>=1)return;l=!0,s=0}else{var d=(1-c)/h;if((s=(-1-c)/h)>d){var f=d;d=s,s=f}if(s>1||d<0)return;s<0&&(s=0),s>1&&(s=1)}this._collisionPoint.copyFromFloats(0,0,0);var p=!1,m=1;if(l||(this._basePoint.subtractToRef(u.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(s,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,r,i,u.normal)&&(p=!0,m=s,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!p){var g=this._velocity.lengthSquared(),_=g;this._basePoint.subtractToRef(n,this._tempVector);var v=2*o.x.Dot(this._velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,b=Wn(_,v,y,m);b.found&&(m=b.root,p=!0,this._collisionPoint.copyFrom(n)),this._basePoint.subtractToRef(r,this._tempVector),v=2*o.x.Dot(this._velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,(b=Wn(_,v,y,m)).found&&(m=b.root,p=!0,this._collisionPoint.copyFrom(r)),this._basePoint.subtractToRef(i,this._tempVector),v=2*o.x.Dot(this._velocity,this._tempVector),y=this._tempVector.lengthSquared()-1,(b=Wn(_,v,y,m)).found&&(m=b.root,p=!0,this._collisionPoint.copyFrom(i)),r.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex);var E=this._edge.lengthSquared(),x=o.x.Dot(this._edge,this._velocity),T=o.x.Dot(this._edge,this._baseToVertex);if(_=E*-g+x*x,v=E*(2*o.x.Dot(this._velocity,this._baseToVertex))-2*x*T,y=E*(1-this._baseToVertex.lengthSquared())+T*T,(b=Wn(_,v,y,m)).found){var S=(x*b.root-T)/E;S>=0&&S<=1&&(m=b.root,p=!0,this._edge.scaleInPlace(S),n.addToRef(this._edge,this._collisionPoint))}i.subtractToRef(r,this._edge),r.subtractToRef(this._basePoint,this._baseToVertex),E=this._edge.lengthSquared(),x=o.x.Dot(this._edge,this._velocity),T=o.x.Dot(this._edge,this._baseToVertex),_=E*-g+x*x,v=E*(2*o.x.Dot(this._velocity,this._baseToVertex))-2*x*T,y=E*(1-this._baseToVertex.lengthSquared())+T*T,(b=Wn(_,v,y,m)).found&&(S=(x*b.root-T)/E)>=0&&S<=1&&(m=b.root,p=!0,this._edge.scaleInPlace(S),r.addToRef(this._edge,this._collisionPoint)),n.subtractToRef(i,this._edge),i.subtractToRef(this._basePoint,this._baseToVertex),E=this._edge.lengthSquared(),x=o.x.Dot(this._edge,this._velocity),T=o.x.Dot(this._edge,this._baseToVertex),_=E*-g+x*x,v=E*(2*o.x.Dot(this._velocity,this._baseToVertex))-2*x*T,y=E*(1-this._baseToVertex.lengthSquared())+T*T,(b=Wn(_,v,y,m)).found&&(S=(x*b.root-T)/E)>=0&&S<=1&&(m=b.root,p=!0,this._edge.scaleInPlace(S),i.addToRef(this._edge,this._collisionPoint))}if(p){var A=m*this._velocity.length();(!this.collisionFound||A<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=A,this.collisionFound=!0)}}},e.prototype._collide=function(e,t,n,r,i,o,a){for(var s=r;s<i;s+=3){var l=t[n[s]-o],u=t[n[s+1]-o],c=t[n[s+2]-o];this._testTriangle(s,e,c,u,l,a)}},e.prototype._getResponse=function(e,t){e.addToRef(t,this._destinationPoint),t.scaleInPlace(this._nearestDistance/t.length()),this._basePoint.addToRef(t,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(o.n.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,t)},e}(),Yn=function(){function e(){this._scaledPosition=o.x.Zero(),this._scaledVelocity=o.x.Zero(),this._finalPosition=o.x.Zero()}return e.prototype.getNewPosition=function(e,t,n,r,i,o,a){e.divideToRef(n._radius,this._scaledPosition),t.divideToRef(n._radius,this._scaledVelocity),n.collidedMesh=null,n._retry=0,n._initialVelocity=this._scaledVelocity,n._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,n,r,this._finalPosition,i),this._finalPosition.multiplyInPlace(n._radius),o(a,this._finalPosition,n.collidedMesh)},e.prototype.createCollider=function(){return new Xn},e.prototype.init=function(e){this._scene=e},e.prototype._collideWithWorld=function(e,t,n,r,i,o){void 0===o&&(o=null);var a=10*ge.b.CollisionsEpsilon;if(n._retry>=r)i.copyFrom(e);else{var s=o?o.collisionMask:n.collisionMask;n._initialize(e,t,a);for(var l=0;l<this._scene.meshes.length;l++){var u=this._scene.meshes[l];u.isEnabled()&&u.checkCollisions&&u.subMeshes&&u!==o&&0!=(s&u.collisionGroup)&&u._checkCollision(n)}n.collisionFound?(0===t.x&&0===t.y&&0===t.z||n._getResponse(e,t),t.length()<=a?i.copyFrom(e):(n._retry++,this._collideWithWorld(e,t,n,r,i,o))):e.addToRef(t,i)}},e}();W.a.CollisionCoordinatorFactory=function(){return new Yn};var Kn=n(50),qn=n(81),Qn=n(108),Zn=n(77),Jn=n(43),$n=n(82),er=function(){function e(e,t,n,r,i,o){this.entries=new Array,this._boundingVectors=new Array,this._capacity=n,this._depth=r,this._maxDepth=i,this._creationFunc=o,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors[2].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[3].y=t.y,this._boundingVectors.push(e.clone()),this._boundingVectors[4].z=t.z,this._boundingVectors.push(t.clone()),this._boundingVectors[5].z=e.z,this._boundingVectors.push(t.clone()),this._boundingVectors[6].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[7].y=e.y}return Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),e.prototype.addEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++)this.blocks[t].addEntry(e);else this._creationFunc(e,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},e.prototype.removeEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++)this.blocks[t].removeEntry(e);else{var n=this.entries.indexOf(e);n>-1&&this.entries.splice(n,1)}},e.prototype.addEntries=function(e){for(var t=0;t<e.length;t++){var n=e[t];this.addEntry(n)}},e.prototype.select=function(e,t,n){if(Zn.a.IsInFrustum(this._boundingVectors,e)){if(this.blocks){for(var r=0;r<this.blocks.length;r++)this.blocks[r].select(e,t,n);return}n?t.concat(this.entries):t.concatWithNoDuplicate(this.entries)}},e.prototype.intersects=function(e,t,n,r){if(Zn.a.IntersectsSphere(this._minPoint,this._maxPoint,e,t)){if(this.blocks){for(var i=0;i<this.blocks.length;i++)this.blocks[i].intersects(e,t,n,r);return}r?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},e.prototype.intersectsRay=function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var n=0;n<this.blocks.length;n++)this.blocks[n].intersectsRay(e,t);return}t.concatWithNoDuplicate(this.entries)}},e.prototype.createInnerBlocks=function(){e._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},e._CreateBlocks=function(t,n,r,i,a,s,l,u){l.blocks=new Array;for(var c=new o.x((n.x-t.x)/2,(n.y-t.y)/2,(n.z-t.z)/2),h=0;h<2;h++)for(var d=0;d<2;d++)for(var f=0;f<2;f++){var p=new e(t.add(c.multiplyByFloats(h,d,f)),t.add(c.multiplyByFloats(h+1,d+1,f+1)),i,a+1,s,u);p.addEntries(r),l.blocks.push(p)}},e}(),tr=function(){function e(e,t,n){void 0===n&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=t||64,this._selectionContent=new Gt.b(1024),this._creationFunc=e}return e.prototype.update=function(e,t,n){er._CreateBlocks(e,t,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},e.prototype.addMesh=function(e){for(var t=0;t<this.blocks.length;t++)this.blocks[t].addEntry(e)},e.prototype.removeMesh=function(e){for(var t=0;t<this.blocks.length;t++)this.blocks[t].removeEntry(e)},e.prototype.select=function(e,t){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++)this.blocks[n].select(e,this._selectionContent,t);return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersects=function(e,t,n){this._selectionContent.reset();for(var r=0;r<this.blocks.length;r++)this.blocks[r].intersects(e,t,this._selectionContent,n);return n?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.prototype.intersectsRay=function(e){this._selectionContent.reset();for(var t=0;t<this.blocks.length;t++)this.blocks[t].intersectsRay(e,this._selectionContent);return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},e.CreationFuncForMeshes=function(e,t){var n=e.getBoundingInfo();!e.isBlocked&&n.boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},e.CreationFuncForSubMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},e}();W.a.prototype.createOrUpdateSelectionOctree=function(e,t){void 0===e&&(e=64),void 0===t&&(t=2);var n=this._getComponent(Te.a.NAME_OCTREE);n||(n=new nr(this),this._addComponent(n)),this._selectionOctree||(this._selectionOctree=new tr(tr.CreationFuncForMeshes,e,t));var r=this.getWorldExtends();return this._selectionOctree.update(r.min,r.max,this.meshes),this._selectionOctree},Object.defineProperty(W.a.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Fe.a.prototype.createOrUpdateSubmeshesOctree=function(e,t){void 0===e&&(e=64),void 0===t&&(t=2);var n=this.getScene(),r=n._getComponent(Te.a.NAME_OCTREE);r||(r=new nr(n),n._addComponent(r)),this._submeshesOctree||(this._submeshesOctree=new tr(tr.CreationFuncForSubMeshes,e,t)),this.computeWorldMatrix(!0);var i=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(i.minimumWorld,i.maximumWorld,this.subMeshes),this._submeshesOctree};var nr=function(){function e(e){this.name=Te.a.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Ot.a(o.x.Zero(),new o.x(1,1,1)),this.scene=e,this.scene.getActiveMeshCandidates=this.getActiveMeshCandidates.bind(this),this.scene.getActiveSubMeshCandidates=this.getActiveSubMeshCandidates.bind(this),this.scene.getCollidingSubMeshCandidates=this.getCollidingSubMeshCandidates.bind(this),this.scene.getIntersectingSubMeshCandidates=this.getIntersectingSubMeshCandidates.bind(this)}return e.prototype.register=function(){var e=this;this.scene.onMeshRemovedObservable.add(function(t){var n=e.scene.selectionOctree;if(null!=n){var r=n.dynamicContent.indexOf(t);-1!==r&&n.dynamicContent.splice(r,1)}}),this.scene.onMeshImportedObservable.add(function(t){var n=e.scene.selectionOctree;null!=n&&n.addMesh(t)})},e.prototype.getActiveMeshCandidates=function(){return this.scene._selectionOctree?this.scene._selectionOctree.select(this.scene.frustumPlanes):this.scene._getDefaultMeshCandidates()},e.prototype.getActiveSubMeshCandidates=function(e){return e._submeshesOctree&&e.useOctreeForRenderingSelection?e._submeshesOctree.select(this.scene.frustumPlanes):this.scene._getDefaultSubMeshCandidates(e)},e.prototype.getIntersectingSubMeshCandidates=function(e,t){return e._submeshesOctree&&e.useOctreeForPicking?(Ot.a.TransformToRef(t,e.getWorldMatrix(),this._tempRay),e._submeshesOctree.intersectsRay(this._tempRay)):this.scene._getDefaultSubMeshCandidates(e)},e.prototype.getCollidingSubMeshCandidates=function(e,t){if(e._submeshesOctree&&e.useOctreeForCollisions){var n=t._velocityWorldLength+Math.max(t._radius.x,t._radius.y,t._radius.z);return e._submeshesOctree.intersects(t._basePointWorld,n)}return this.scene._getDefaultSubMeshCandidates(e)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e}(),rr=n(74),ir=n(128),or=function(){this._timeElapsedQueryEnded=!1},ar=function(){this.occlusionInternalRetryCounter=0,this.isOcclusionQueryInProgress=!1,this.isOccluded=!1,this.occlusionRetryCount=-1,this.occlusionType=Fe.a.OCCLUSION_TYPE_NONE,this.occlusionQueryAlgorithmType=Fe.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE};ge.b.prototype.createQuery=function(){return this._gl.createQuery()},ge.b.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},ge.b.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},ge.b.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},ge.b.prototype.beginOcclusionQuery=function(e,t){var n=this._getGlAlgorithmType(e);return this._gl.beginQuery(n,t),this},ge.b.prototype.endOcclusionQuery=function(e){var t=this._getGlAlgorithmType(e);return this._gl.endQuery(t),this},ge.b.prototype._createTimeQuery=function(){var e=this.getCaps().timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},ge.b.prototype._deleteTimeQuery=function(e){var t=this.getCaps().timerQuery;t.deleteQueryEXT?t.deleteQueryEXT(e):this.deleteQuery(e)},ge.b.prototype._getTimeQueryResult=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},ge.b.prototype._getTimeQueryAvailability=function(e){var t=this.getCaps().timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},ge.b.prototype.startTimeQuery=function(){var e=this.getCaps(),t=e.timerQuery;if(!t)return null;var n=new or;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),e.canUseTimestampForTimerQuery)n._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(n._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;n._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,n._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,n._timeElapsedQuery),this._currentNonTimestampToken=n}return n},ge.b.prototype.endTimeQuery=function(e){var t=this.getCaps(),n=t.timerQuery;if(!n||!e)return-1;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),n.queryCounterEXT(e._endTimeQuery,n.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;n.endQueryEXT?n.endQueryEXT(n.TIME_ELAPSED_EXT):this._gl.endQuery(n.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var r=this._gl.getParameter(n.GPU_DISJOINT_EXT),i=!1;if(e._endTimeQuery?i=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(i=this._getTimeQueryAvailability(e._timeElapsedQuery)),i&&!r){var o=0;if(t.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var a=this._getTimeQueryResult(e._startTimeQuery);o=this._getTimeQueryResult(e._endTimeQuery)-a,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;o=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return o}return-1},ge.b.prototype._getGlAlgorithmType=function(e){return e===Fe.a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},Object.defineProperty(Fe.a.prototype,"isOcclusionQueryInProgress",{get:function(){return this._occlusionDataStorage.isOcclusionQueryInProgress},enumerable:!1,configurable:!0}),Object.defineProperty(Fe.a.prototype,"_occlusionDataStorage",{get:function(){return this.__occlusionDataStorage||(this.__occlusionDataStorage=new ar),this.__occlusionDataStorage},enumerable:!1,configurable:!0}),Object.defineProperty(Fe.a.prototype,"isOccluded",{get:function(){return this._occlusionDataStorage.isOccluded},set:function(e){this._occlusionDataStorage.isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fe.a.prototype,"occlusionQueryAlgorithmType",{get:function(){return this._occlusionDataStorage.occlusionQueryAlgorithmType},set:function(e){this._occlusionDataStorage.occlusionQueryAlgorithmType=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fe.a.prototype,"occlusionType",{get:function(){return this._occlusionDataStorage.occlusionType},set:function(e){this._occlusionDataStorage.occlusionType=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fe.a.prototype,"occlusionRetryCount",{get:function(){return this._occlusionDataStorage.occlusionRetryCount},set:function(e){this._occlusionDataStorage.occlusionRetryCount=e},enumerable:!0,configurable:!0}),Fe.a.prototype._checkOcclusionQuery=function(){var e=this._occlusionDataStorage;if(e.occlusionType===Fe.a.OCCLUSION_TYPE_NONE)return e.isOccluded=!1,!1;var t=this.getEngine();if(t.webGLVersion<2)return e.isOccluded=!1,!1;if(!t.isQueryResultAvailable)return e.isOccluded=!1,!1;if(this.isOcclusionQueryInProgress&&this._occlusionQuery)if(t.isQueryResultAvailable(this._occlusionQuery)){var n=t.getQueryResult(this._occlusionQuery);e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=1!==n}else{if(e.occlusionInternalRetryCounter++,!(-1!==e.occlusionRetryCount&&e.occlusionInternalRetryCounter>e.occlusionRetryCount))return!1;e.isOcclusionQueryInProgress=!1,e.occlusionInternalRetryCounter=0,e.isOccluded=e.occlusionType!==Fe.a.OCCLUSION_TYPE_OPTIMISTIC&&e.isOccluded}var r=this.getScene();if(r.getBoundingBoxRenderer){var i=r.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=t.createQuery()),t.beginOcclusionQuery(e.occlusionQueryAlgorithmType,this._occlusionQuery),i.renderOcclusionBoundingBox(this),t.endOcclusionQuery(e.occlusionQueryAlgorithmType),this._occlusionDataStorage.isOcclusionQueryInProgress=!0}return e.isOccluded},ge.b.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},ge.b.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},ge.b.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},ge.b.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},ge.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},ge.b.prototype.setTranformFeedbackVaryings=function(e,t){this._gl.transformFeedbackVaryings(e,t,this._gl.INTERLEAVED_ATTRIBS)},ge.b.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e?e.underlyingResource:null)};var sr=n(107),lr=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),ur=function(){function e(e,t){this.type=e,this.event=t}return e.GetTypeFromCharacter=function(e){switch(e){case 67:return lr.COPY;case 86:return lr.PASTE;case 88:return lr.CUT;default:return-1}},e}(),cr=n(59),hr=n(55),dr=function(){function e(e,t,n){this.lengthComputable=e,this.loaded=t,this.total=n}return e.FromProgressEvent=function(t){return new e(t.lengthComputable,t.loaded,t.total)},e}(),fr=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return hr.a.ForceFullSceneLoadingForIncremental},set:function(e){hr.a.ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return hr.a.ShowLoadingScreen},set:function(e){hr.a.ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return hr.a.loggingLevel},set:function(e){hr.a.loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return hr.a.CleanBoneMatrixWeights},set:function(e){hr.a.CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),e._getDefaultPlugin=function(){return e._registeredPlugins[".babylon"]},e._getPluginForExtension=function(t){var n=e._registeredPlugins[t];return n||(p.a.Warn("Unable to find a plugin to load "+t+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: http://doc.babylonjs.com/how_to/load_from_any_file_type"),e._getDefaultPlugin())},e._getPluginForDirectLoad=function(t){for(var n in e._registeredPlugins){var r=e._registeredPlugins[n].plugin;if(r.canDirectLoad&&r.canDirectLoad(t))return e._registeredPlugins[n]}return e._getDefaultPlugin()},e._getPluginForFilename=function(t){var n=t.indexOf("?");-1!==n&&(t=t.substring(0,n));var r=t.lastIndexOf("."),i=t.substring(r,t.length).toLowerCase();return e._getPluginForExtension(i)},e._getDirectLoad=function(e){return"data:"===e.substr(0,5)?e.substr(5):null},e._loadData=function(t,n,r,i,o,a,s){var l,u=e._getDirectLoad(t.name),c=s?e._getPluginForExtension(s):u?e._getPluginForDirectLoad(t.name):e._getPluginForFilename(t.name);if(!(l=c.plugin.createPlugin?c.plugin.createPlugin():c.plugin))throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";var h,d=c.isBinary;e.OnPluginActivatedObservable.notifyObservers(l);var f=function(e,t){n.isDisposed?o("Scene has been disposed"):(n.offlineProvider=h,r(l,e,t))},p=null,m=!1,g=l.onDisposeObservable;g&&g.add(function(){m=!0,p&&(p.abort(),p=null),a()});var _=function(){m||(p=ye.h.LoadFile(t.url,f,i?function(e){i(dr.FromProgressEvent(e))}:void 0,h,d,function(e,t){o("Failed to load scene."+(t?" "+t.message:""),t)}))};if(u)return f(u),l;var v=t.file||cr.a.FilesToLoad[t.name.toLowerCase()];if(-1===t.rootUrl.indexOf("file:")||-1!==t.rootUrl.indexOf("file:")&&!v){var y=n.getEngine(),b=y.enableOfflineSupport;if(b){for(var E=!1,x=0,T=n.disableOfflineSupportExceptionRules;x<T.length;x++)if(T[x].test(t.url)){E=!0;break}b=!E}b&&ge.b.OfflineProviderFactory?h=ge.b.OfflineProviderFactory(t.url,_,y.disableManifestCheck):_()}else v?p=ye.h.ReadFile(v,f,i,d):o("Unable to find file named "+t.name);return l},e._getFileInfo=function(e,t){var n,r,i=null;if(t)if(t.name){var o=t;n=e+o.name,r=o.name,i=o}else{var a=t;if("/"===a.substr(0,1))return ye.h.Error("Wrong sceneFilename parameter"),null;n=e+a,r=a}else n=e,r=ye.h.GetFilename(e),e=ye.h.GetFolderPath(e);return{url:n,rootUrl:e,name:r,file:i}},e.GetPluginForExtension=function(t){return e._getPluginForExtension(t).plugin},e.IsPluginForExtensionAvailable=function(t){return!!e._registeredPlugins[t]},e.RegisterPlugin=function(t){if("string"==typeof t.extensions){var n=t.extensions;e._registeredPlugins[n.toLowerCase()]={plugin:t,isBinary:!1}}else{var r=t.extensions;Object.keys(r).forEach(function(n){e._registeredPlugins[n.toLowerCase()]={plugin:t,isBinary:r[n].isBinary}})}},e.ImportMesh=function(t,n,r,i,o,a,s,l){if(void 0===r&&(r=""),void 0===i&&(i=P.a.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),!i)return p.a.Error("No scene available to import mesh to"),null;var u=e._getFileInfo(n,r);if(!u)return null;var c={};i._addPendingData(c);var h=function(){i._removePendingData(c)},d=function(e,t){var n="Unable to import meshes from "+u.url+": "+e;s?s(i,n,t):p.a.Error(n),h()},f=a?function(e){try{a(e)}catch(e){d("Error in onProgress callback",e)}}:void 0,m=function(e,t,n,r){if(i.importedMeshesFiles.push(u.url),o)try{o(e,t,n,r)}catch(e){d("Error in onSuccess callback",e)}i._removePendingData(c)};return e._loadData(u,i,function(e,n,r){if(e.rewriteRootURL&&(u.rootUrl=e.rewriteRootURL(u.rootUrl,r)),e.importMesh){var o=e,a=new Array,s=new Array,l=new Array;if(!o.importMesh(t,i,n,u.rootUrl,a,s,l,d))return;i.loadingPluginName=e.name,m(a,s,l,[])}else e.importMeshAsync(t,i,n,u.rootUrl,f,u.name).then(function(t){i.loadingPluginName=e.name,m(t.meshes,t.particleSystems,t.skeletons,t.animationGroups)}).catch(function(e){d(e.message,e)})},f,d,h,l)},e.ImportMeshAsync=function(t,n,r,i,o,a){return void 0===r&&(r=""),void 0===i&&(i=P.a.LastCreatedScene),void 0===o&&(o=null),void 0===a&&(a=null),new Promise(function(s,l){e.ImportMesh(t,n,r,i,function(e,t,n,r){s({meshes:e,particleSystems:t,skeletons:n,animationGroups:r})},o,function(e,t,n){l(n||new Error(t))},a)})},e.Load=function(t,n,r,i,o,a,s){return void 0===n&&(n=""),void 0===r&&(r=P.a.LastCreatedEngine),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),r?e.Append(t,n,new W.a(r),i,o,a,s):(ye.h.Error("No engine available"),null)},e.LoadAsync=function(t,n,r,i,o){return void 0===n&&(n=""),void 0===r&&(r=P.a.LastCreatedEngine),void 0===i&&(i=null),void 0===o&&(o=null),new Promise(function(a,s){e.Load(t,n,r,function(e){a(e)},i,function(e,t,n){s(n||new Error(t))},o)})},e.Append=function(t,n,r,i,o,a,s){if(void 0===n&&(n=""),void 0===r&&(r=P.a.LastCreatedScene),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!r)return p.a.Error("No scene available to append to"),null;var l=e._getFileInfo(t,n);if(!l)return null;e.ShowLoadingScreen&&r.getEngine().displayLoadingUI();var u={};r._addPendingData(u);var c=function(){r._removePendingData(u),r.getEngine().hideLoadingUI()},h=function(e,t){var n="Unable to load from "+l.url+(e?": "+e:"");a?a(r,n,t):p.a.Error(n),c()},d=o?function(e){try{o(e)}catch(e){h("Error in onProgress callback",e)}}:void 0,f=function(){if(i)try{i(r)}catch(e){h("Error in onSuccess callback",e)}r._removePendingData(u)};return e._loadData(l,r,function(t,n){if(t.load){if(!t.load(r,n,l.rootUrl,h))return;r.loadingPluginName=t.name,f()}else t.loadAsync(r,n,l.rootUrl,d,l.name).then(function(){r.loadingPluginName=t.name,f()}).catch(function(e){h(e.message,e)});e.ShowLoadingScreen&&r.executeWhenReady(function(){r.getEngine().hideLoadingUI()})},d,h,c,s)},e.AppendAsync=function(t,n,r,i,o){return void 0===n&&(n=""),void 0===r&&(r=P.a.LastCreatedScene),void 0===i&&(i=null),void 0===o&&(o=null),new Promise(function(a,s){e.Append(t,n,r,function(e){a(e)},i,function(e,t,n){s(n||new Error(t))},o)})},e.LoadAssetContainer=function(t,n,r,i,o,a,s){if(void 0===n&&(n=""),void 0===r&&(r=P.a.LastCreatedScene),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),!r)return p.a.Error("No scene available to load asset container to"),null;var l=e._getFileInfo(t,n);if(!l)return null;var u={};r._addPendingData(u);var c=function(){r._removePendingData(u)},h=function(e,t){var n="Unable to load assets from "+l.url+(e?": "+e:"");a?a(r,n,t):p.a.Error(n),c()},d=o?function(e){try{o(e)}catch(e){h("Error in onProgress callback",e)}}:void 0,f=function(e){if(i)try{i(e)}catch(e){h("Error in onSuccess callback",e)}r._removePendingData(u)};return e._loadData(l,r,function(t,n){if(t.loadAssetContainer){var i=t.loadAssetContainer(r,n,l.rootUrl,h);if(!i)return;r.loadingPluginName=t.name,f(i)}else t.loadAssetContainerAsync?t.loadAssetContainerAsync(r,n,l.rootUrl,d,l.name).then(function(e){r.loadingPluginName=t.name,f(e)}).catch(function(e){h(e.message,e)}):h("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");e.ShowLoadingScreen&&r.executeWhenReady(function(){r.getEngine().hideLoadingUI()})},d,h,c,s)},e.LoadAssetContainerAsync=function(t,n,r,i,o){return void 0===n&&(n=""),void 0===r&&(r=P.a.LastCreatedScene),void 0===i&&(i=null),void 0===o&&(o=null),new Promise(function(a,s){e.LoadAssetContainer(t,n,r,function(e){a(e)},i,function(e,t,n){s(n||new Error(t))},o)})},e.NO_LOGGING=m.a.SCENELOADER_NO_LOGGING,e.MINIMAL_LOGGING=m.a.SCENELOADER_MINIMAL_LOGGING,e.SUMMARY_LOGGING=m.a.SCENELOADER_SUMMARY_LOGGING,e.DETAILED_LOGGING=m.a.SCENELOADER_DETAILED_LOGGING,e.OnPluginActivatedObservable=new i.c,e._registeredPlugins={},e}(),pr=function(e){function t(t){var n=e.call(this,t)||this;return n.controllerType=Mt.DAYDREAM,n}return u.d(t,e),t.prototype.initControllerMesh=function(e,n){var r=this;fr.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){r._defaultModel=e[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,t,n){if(0===e){var r=this.onTriggerStateChangedObservable;r&&r.notifyObservers(t)}else p.a.Warn("Unrecognized Daydream button index: "+e)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Daydream",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(pr.GAMEPAD_ID_PREFIX)},create:function(e){return new pr(e)}});var mr=function(e){function t(t){var n=e.call(this,t)||this;return n._buttonIndexToObservableNameMap=["onPadStateChangedObservable","onTriggerStateChangedObservable"],n.controllerType=Mt.GEAR_VR,n._calculatedPosition=new o.x("left"==n.hand?-.15:.15,-.5,.25),n._disableTrackPosition(n._calculatedPosition),n}return u.d(t,e),t.prototype.initControllerMesh=function(e,n){var r=this;fr.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(t){var i=new fe.a("",e);t[1].parent=i,t[1].position.z=-.15,r._defaultModel=i,r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,t,n){if(e<this._buttonIndexToObservableNameMap.length){var r=this[this._buttonIndexToObservableNameMap[e]];r&&r.notifyObservers(t)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t.GAMEPAD_ID_PREFIX="Gear VR",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(mr.GAMEPAD_ID_PREFIX)||-1!==e.id.indexOf("Oculus Go")},create:function(e){return new mr(e)}});var gr=function(e){function t(t){return e.call(this,t)||this}return u.d(t,e),t.prototype.initControllerMesh=function(e,n){var r=this;fr.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){r._defaultModel=e[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},t.prototype._handleButtonChange=function(e,t,n){console.log("Button id: "+e+"state: "),console.dir(t)},t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",t}(_n);Lt._DefaultControllerFactory=function(e){return new gr(e)};var _r=function(e){function t(t){var n=e.call(this,t)||this;return n.onSecondaryTriggerStateChangedObservable=new i.c,n.onThumbRestChangedObservable=new i.c,n.controllerType=Mt.OCULUS,n}return u.d(t,e),t.prototype.initControllerMesh=function(e,n){var r,i=this;r="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,fr.ImportMesh("",t.MODEL_BASE_URL,r,e,function(e){i._defaultModel=e[1],i.attachToMesh(i._defaultModel),n&&n(i._defaultModel)})},Object.defineProperty(t.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(e,t,n){var r=t,i="right"===this.hand?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(r);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-r.value,this._defaultModel.getChildren()[3].position.y=.005*-r.value,this._defaultModel.getChildren()[3].position.z=.005*-r.value),void this.onTriggerStateChangedObservable.notifyObservers(r);case 2:return this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=i*r.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(r);case 3:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(r);case 4:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(r);case 5:return void this.onThumbRestChangedObservable.notifyObservers(r)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return-1!==e.id.indexOf("Oculus Touch")},create:function(e){return new _r(e)}});var vr=function(e){function t(t){var n=e.call(this,t)||this;return n.controllerType=Mt.VIVE,n._invertLeftStickY=!0,n}return u.d(t,e),t.prototype.initControllerMesh=function(e,n){var r=this;fr.ImportMesh("",t.MODEL_BASE_URL,t.MODEL_FILENAME,e,function(e){r._defaultModel=e[1],r.attachToMesh(r._defaultModel),n&&n(r._defaultModel)})},Object.defineProperty(t.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),t.prototype._handleButtonChange=function(e,t,n){var r=t;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(r);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-r.value),void this.onTriggerStateChangedObservable.notifyObservers(r);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(r);case 3:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(r)}},t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return-1!==e.id.toLowerCase().indexOf("openvr")},create:function(e){return new vr(e)}});var yr=function(){this.buttonMeshes={},this.axisMeshes={}},br=function(e){function t(t){var n=e.call(this,t)||this;return n._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:Ft.POINTING_POSE},n.onTrackpadChangedObservable=new i.c,n.onTrackpadValuesChangedObservable=new i.c,n.trackpad={x:0,y:0},n.controllerType=Mt.WINDOWS,n._loadedMeshInfo=null,n}return u.d(t,e),Object.defineProperty(t.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),t.prototype._updateTrackpad=function(){!this.browserGamepad.axes||this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad))},t.prototype.update=function(){if(e.prototype.update.call(this),this.browserGamepad.axes&&(this._updateTrackpad(),this._loadedMeshInfo))for(var t=0;t<this._mapping.axisMeshNames.length;t++)this._lerpAxisTransform(t,this.browserGamepad.axes[t])},t.prototype._handleButtonChange=function(e,t,n){var r=this._mapping.buttons[e];if(r){this._updateTrackpad();var i=this[this._mapping.buttonObservableNames[r]];i&&i.notifyObservers(t),this._lerpButtonTransform(r,t.value)}},t.prototype._lerpButtonTransform=function(e,t){if(this._loadedMeshInfo){var n=this._loadedMeshInfo.buttonMeshes[e];n.unpressed.rotationQuaternion&&n.pressed.rotationQuaternion&&n.value.rotationQuaternion&&(o.q.SlerpToRef(n.unpressed.rotationQuaternion,n.pressed.rotationQuaternion,t,n.value.rotationQuaternion),o.x.LerpToRef(n.unpressed.position,n.pressed.position,t,n.value.position))}},t.prototype._lerpAxisTransform=function(e,t){if(this._loadedMeshInfo){var n=this._loadedMeshInfo.axisMeshes[e];if(n&&n.min.rotationQuaternion&&n.max.rotationQuaternion&&n.value.rotationQuaternion){var r=.5*t+.5;o.q.SlerpToRef(n.min.rotationQuaternion,n.max.rotationQuaternion,r,n.value.rotationQuaternion),o.x.LerpToRef(n.min.position,n.max.position,r,n.value.position)}}},t.prototype.initControllerMesh=function(e,n,r){var i,o,a=this;if(void 0===r&&(r=!1),fr.IsPluginForExtensionAvailable(".glb")){var s="default";if(this.id&&!r){var l=this.id.match(t.GAMEPAD_ID_PATTERN);s=l&&l[0]||s}o="left"===this.hand?t.MODEL_LEFT_FILENAME:t.MODEL_RIGHT_FILENAME,i=t.MODEL_BASE_URL+s+"/"}else p.a.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),i=gr.MODEL_BASE_URL,o=gr.MODEL_FILENAME;fr.ImportMesh("",i,o,e,function(t){a._loadedMeshInfo=a.processModel(e,t),a._loadedMeshInfo&&(a._defaultModel=a._loadedMeshInfo.rootNode,a.attachToMesh(a._defaultModel),n&&n(a._defaultModel))},null,function(e,t){p.a.Log(t),p.a.Warn("Failed to retrieve controller model from the remote server: "+i+o),r||a.initControllerMesh(e,n,!0)})},t.prototype.processModel=function(e,t){for(var n=null,r=new fe.a(this.id+" "+this.hand,e),i=null,o=0;o<t.length;o++){var a=t[o];if(!a.parent){a.isPickable=!1,i=a;break}}return i?(i.setParent(r),n=this.createMeshInfo(r)):p.a.Warn("Could not find root node in model file."),n},t.prototype.createMeshInfo=function(e){var t,n=new yr;for(n.rootNode=e,n.buttonMeshes={},n.axisMeshes={},t=0;t<this._mapping.buttons.length;t++){var r=this._mapping.buttonMeshNames[this._mapping.buttons[t]];if(r){var i=u(e,r);if(i){var o={index:t,value:c(i,"VALUE"),pressed:c(i,"PRESSED"),unpressed:c(i,"UNPRESSED")};o.value&&o.pressed&&o.unpressed?n.buttonMeshes[this._mapping.buttons[t]]=o:p.a.Warn("Missing button submesh under mesh with name: "+r+"(VALUE: "+!!o.value+", PRESSED: "+!!o.pressed+", UNPRESSED:"+!!o.unpressed+")")}else p.a.Warn("Missing button mesh with name: "+r)}else p.a.Log("Skipping unknown button at index: "+t+" with mapped name: "+this._mapping.buttons[t])}for(t=0;t<this._mapping.axisMeshNames.length;t++){var a=this._mapping.axisMeshNames[t];if(a){var s=u(e,a);if(s){var l={index:t,value:c(s,"VALUE"),min:c(s,"MIN"),max:c(s,"MAX")};l.value&&l.min&&l.max?n.axisMeshes[t]=l:p.a.Warn("Missing axis submesh under mesh with name: "+a+"(VALUE: "+!!l.value+", MIN: "+!!l.min+", MAX:"+!!l.max+")")}else p.a.Warn("Missing axis mesh with name: "+a)}else p.a.Log("Skipping unknown axis at index: "+t)}return n.pointingPoseNode=u(e,this._mapping.pointingPoseMeshName),n.pointingPoseNode?this._pointingPoseNode=n.pointingPoseNode:p.a.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),n;function u(e,t){return e.getChildren(function(e){return e.name===t},!1)[0]}function c(e,t){return e.getChildren(function(e){return e.name==t},!0)[0]}},t.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return e.prototype.getForwardRay.call(this,t);var n=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),r=n.getTranslation(),i=new o.x(0,0,-1),a=o.x.TransformNormal(i,n),s=o.x.Normalize(a);return new Ot.a(r,s,t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},t.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",t.MODEL_LEFT_FILENAME="left.glb",t.MODEL_RIGHT_FILENAME="right.glb",t.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",t.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,t}(_n);Lt._ControllerFactories.push({canCreate:function(e){return 0===e.id.indexOf(br.GAMEPAD_ID_PREFIX)},create:function(e){return new br(e)}});var Er=n(58),xr=n(52),Tr=n(48),Sr=n(41),Ar=function(e){function t(t,n,r){void 0===n&&(n=o.e.Gray()),void 0===r&&(r=Sr.a.DefaultUtilityLayer);var a=e.call(this,r)||this;a._pointerObserver=null,a.snapDistance=0,a.onSnapObservable=new i.c,a.uniformScaling=!1,a._coloredMaterial=new yn.a("",r.utilityLayerScene),a._coloredMaterial.diffuseColor=n,a._coloredMaterial.specularColor=n.subtract(new o.e(.1,.1,.1));var s=new yn.a("",r.utilityLayerScene);s.diffuseColor=n.add(new o.e(.3,.3,.3));var l=new Fe.a("",r.utilityLayerScene),u=xr.a.CreateBox("yPosMesh",{size:.4},r.utilityLayerScene),c=Cn.a.CreateCylinder("cylinder",{diameterTop:.005,height:.275,diameterBottom:.005,tessellation:96},r.utilityLayerScene);c.material=a._coloredMaterial,l.addChild(u),l.addChild(c),u.scaling.scaleInPlace(.1),u.material=a._coloredMaterial,u.rotation.x=Math.PI/2,u.position.z+=.3,c.position.z+=.1375,c.rotation.x=Math.PI/2,l.lookAt(a._rootMesh.position.add(t)),a._rootMesh.addChild(l),l.scaling.scaleInPlace(1/3),a.dragBehavior=new De.a({dragAxis:t}),a.dragBehavior.moveAttached=!1,a._rootMesh.addBehavior(a.dragBehavior);var h=0,d=new o.x,f={snapDistance:0};a.dragBehavior.onDragObservable.add(function(e){if(a.attachedMesh){var n=e.dragDistance*(3*a.scaleRatio/a._rootMesh.scaling.length()),r=!1,i=0;a.uniformScaling?(a.attachedMesh.scaling.normalizeToRef(d),d.y<0&&d.scaleInPlace(-1)):d.copyFrom(t),0==a.snapDistance?d.scaleToRef(n,d):(h+=n,Math.abs(h)>a.snapDistance?(i=Math.floor(Math.abs(h)/a.snapDistance),h<0&&(i*=-1),h%=a.snapDistance,d.scaleToRef(a.snapDistance*i,d),r=!0):d.scaleInPlace(0)),a.attachedMesh.scaling.addInPlace(d),r&&(f.snapDistance=a.snapDistance*i,a.onSnapObservable.notifyObservers(f))}}),a._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(e){if(!a._customMeshSet){var t=e.pickInfo&&-1!=a._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?s:a._coloredMaterial;a._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)})}});var p=r._getSharedGizmoLight();return p.includedOnlyMeshes=p.includedOnlyMeshes.concat(a._rootMesh.getChildMeshes()),a}return u.d(t,e),t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t.prototype.setCustomMesh=function(t,n){var r=this;void 0===n&&(n=!1),e.prototype.setCustomMesh.call(this,t),n&&(this._rootMesh.getChildMeshes().forEach(function(e){e.material=r._coloredMaterial,e.color&&(e.color=r._coloredMaterial.diffuseColor)}),this._customMeshSet=!1)},t}(Tr.a),Pr=n(46),Mr=n(40),Rr=function(e){function t(t,n){void 0===t&&(t=o.e.Gray()),void 0===n&&(n=Sr.a.DefaultKeepDepthUtilityLayer);var r=e.call(this,n)||this;r._boundingDimensions=new o.x(1,1,1),r._renderObserver=null,r._pointerObserver=null,r._scaleDragSpeed=.2,r._tmpQuaternion=new o.q,r._tmpVector=new o.x(0,0,0),r._tmpRotationMatrix=new o.j,r.ignoreChildren=!1,r.includeChildPredicate=null,r.rotationSphereSize=.1,r.scaleBoxSize=.1,r.fixedDragMeshScreenSize=!1,r.fixedDragMeshScreenSizeDistanceFactor=10,r.onDragStartObservable=new i.c,r.onScaleBoxDragObservable=new i.c,r.onScaleBoxDragEndObservable=new i.c,r.onRotationSphereDragObservable=new i.c,r.onRotationSphereDragEndObservable=new i.c,r.scalePivot=null,r._existingMeshScale=new o.x,r._dragMesh=null,r.pointerDragBehavior=new De.a,r._updateScale=!1,r._anchorMesh=new Fe.a("anchor",n.utilityLayerScene),r.coloredMaterial=new yn.a("",n.utilityLayerScene),r.coloredMaterial.disableLighting=!0,r.hoverColoredMaterial=new yn.a("",n.utilityLayerScene),r.hoverColoredMaterial.disableLighting=!0,r._lineBoundingBox=new Fe.a("",n.utilityLayerScene),r._lineBoundingBox.rotationQuaternion=new o.q;var a=[];a.push(Mr.a.CreateLines("lines",{points:[new o.x(0,0,0),new o.x(r._boundingDimensions.x,0,0)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(0,0,0),new o.x(0,r._boundingDimensions.y,0)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(0,0,0),new o.x(0,0,r._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(r._boundingDimensions.x,0,0),new o.x(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(r._boundingDimensions.x,0,0),new o.x(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(0,r._boundingDimensions.y,0),new o.x(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(0,r._boundingDimensions.y,0),new o.x(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(0,0,r._boundingDimensions.z),new o.x(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(0,0,r._boundingDimensions.z),new o.x(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new o.x(0,r._boundingDimensions.y,r._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new o.x(r._boundingDimensions.x,0,r._boundingDimensions.z)]},n.utilityLayerScene)),a.push(Mr.a.CreateLines("lines",{points:[new o.x(r._boundingDimensions.x,r._boundingDimensions.y,r._boundingDimensions.z),new o.x(r._boundingDimensions.x,r._boundingDimensions.y,0)]},n.utilityLayerScene)),a.forEach(function(e){e.color=t,e.position.addInPlace(new o.x(-r._boundingDimensions.x/2,-r._boundingDimensions.y/2,-r._boundingDimensions.z/2)),e.isPickable=!1,r._lineBoundingBox.addChild(e)}),r._rootMesh.addChild(r._lineBoundingBox),r.setColor(t),r._rotateSpheresParent=new Fe.a("",n.utilityLayerScene),r._rotateSpheresParent.rotationQuaternion=new o.q;for(var s=function(e){var t=Pr.a.CreateSphere("",{diameter:1},n.utilityLayerScene);t.rotationQuaternion=new o.q,t.material=l.coloredMaterial,(d=new De.a({})).moveAttached=!1,d.updateDragPlane=!1,t.addBehavior(d);var i=new o.x(1,0,0),a=0;d.onDragStartObservable.add(function(){i.copyFrom(t.forward),a=0}),d.onDragObservable.add(function(t){if(r.onRotationSphereDragObservable.notifyObservers({}),r.attachedMesh){var n=r.attachedMesh.parent;if(n&&n.scaling&&n.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Be.a._RemoveAndStorePivotPoint(r.attachedMesh);var s=i,l=t.dragPlaneNormal.scale(o.x.Dot(t.dragPlaneNormal,s)),u=s.subtract(l).normalizeToNew(),c=o.x.Dot(u,t.delta)<0?Math.abs(t.delta.length()):-Math.abs(t.delta.length());c=c/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),r.attachedMesh.rotationQuaternion||(r.attachedMesh.rotationQuaternion=o.q.RotationYawPitchRoll(r.attachedMesh.rotation.y,r.attachedMesh.rotation.x,r.attachedMesh.rotation.z)),r._anchorMesh.rotationQuaternion||(r._anchorMesh.rotationQuaternion=o.q.RotationYawPitchRoll(r._anchorMesh.rotation.y,r._anchorMesh.rotation.x,r._anchorMesh.rotation.z)),a+=c,Math.abs(a)<=2*Math.PI&&(e>=8?o.q.RotationYawPitchRollToRef(0,0,c,r._tmpQuaternion):e>=4?o.q.RotationYawPitchRollToRef(c,0,0,r._tmpQuaternion):o.q.RotationYawPitchRollToRef(0,c,0,r._tmpQuaternion),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.rotationQuaternion.multiplyToRef(r._tmpQuaternion,r._anchorMesh.rotationQuaternion),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(n)),r.updateBoundingBox(),Be.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),d.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(t)}),d.onDragEndObservable.add(function(){r.onRotationSphereDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),l._rotateSpheresParent.addChild(t)},l=this,u=0;u<12;u++)s(u);r._rootMesh.addChild(r._rotateSpheresParent),r._scaleBoxesParent=new Fe.a("",n.utilityLayerScene),r._scaleBoxesParent.rotationQuaternion=new o.q;for(var c=0;c<2;c++)for(var h=0;h<2;h++)for(var d,f=function(){var e=xr.a.CreateBox("",{size:1},n.utilityLayerScene);e.material=m.coloredMaterial;var t=new o.x(0==c?-1:1,0==h?-1:1,0==g?-1:1);(d=new De.a({dragAxis:t})).moveAttached=!1,e.addBehavior(d),d.onDragObservable.add(function(t){if(r.onScaleBoxDragObservable.notifyObservers({}),r.attachedMesh){var n=r.attachedMesh.parent;if(n&&n.scaling&&n.scaling.isNonUniformWithinEpsilon(.001))return void p.a.Warn("BoundingBoxGizmo controls are not supported on child meshes with non-uniform parent scaling");Be.a._RemoveAndStorePivotPoint(r.attachedMesh);var i=t.dragDistance/r._boundingDimensions.length()*r._anchorMesh.scaling.length(),a=new o.x(i,i,i);a.scaleInPlace(r._scaleDragSpeed),r.updateBoundingBox(),r.scalePivot?(r.attachedMesh.getWorldMatrix().getRotationMatrixToRef(r._tmpRotationMatrix),r._boundingDimensions.scaleToRef(.5,r._tmpVector),o.x.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector),r._boundingDimensions.multiplyToRef(r.scalePivot,r._tmpVector),o.x.TransformCoordinatesToRef(r._tmpVector,r._tmpRotationMatrix,r._tmpVector),r._anchorMesh.position.addInPlace(r._tmpVector)):(e.absolutePosition.subtractToRef(r._anchorMesh.position,r._tmpVector),r._anchorMesh.position.subtractInPlace(r._tmpVector)),r._anchorMesh.addChild(r.attachedMesh),r._anchorMesh.scaling.addInPlace(a),(r._anchorMesh.scaling.x<0||r._anchorMesh.scaling.y<0||r._anchorMesh.scaling.z<0)&&r._anchorMesh.scaling.subtractInPlace(a),r._anchorMesh.removeChild(r.attachedMesh),r.attachedMesh.setParent(n),Be.a._RestorePivotPoint(r.attachedMesh)}r._updateDummy()}),d.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({}),r._selectNode(e)}),d.onDragEndObservable.add(function(){r.onScaleBoxDragEndObservable.notifyObservers({}),r._selectNode(null),r._updateDummy()}),m._scaleBoxesParent.addChild(e)},m=this,g=0;g<2;g++)f();r._rootMesh.addChild(r._scaleBoxesParent);var _=new Array;return r._pointerObserver=n.utilityLayerScene.onPointerObservable.add(function(e){_[e.event.pointerId]?e.pickInfo&&e.pickInfo.pickedMesh!=_[e.event.pointerId]&&(_[e.event.pointerId].material=r.coloredMaterial,delete _[e.event.pointerId]):r._rotateSpheresParent.getChildMeshes().concat(r._scaleBoxesParent.getChildMeshes()).forEach(function(t){e.pickInfo&&e.pickInfo.pickedMesh==t&&(_[e.event.pointerId]=t,t.material=r.hoverColoredMaterial)})}),r._renderObserver=r.gizmoLayer.originalScene.onBeforeRenderObservable.add(function(){r.attachedMesh&&!r._existingMeshScale.equals(r.attachedMesh.scaling)?r.updateBoundingBox():r.fixedDragMeshScreenSize&&(r._updateRotationSpheres(),r._updateScaleBoxes()),r._dragMesh&&r.attachedMesh&&r.pointerDragBehavior.dragging&&(r._lineBoundingBox.position.rotateByQuaternionToRef(r._rootMesh.rotationQuaternion,r._tmpVector),r.attachedMesh.setAbsolutePosition(r._dragMesh.position.add(r._tmpVector.scale(-1))))}),r.updateBoundingBox(),r}return u.d(t,e),t.prototype.setColor=function(e){this.coloredMaterial.emissiveColor=e,this.hoverColoredMaterial.emissiveColor=e.clone().add(new o.e(.3,.3,.3)),this._lineBoundingBox.getChildren().forEach(function(t){t.color&&(t.color=e)})},t.prototype._attachedMeshChanged=function(e){var t=this;if(e){Be.a._RemoveAndStorePivotPoint(e);var n=e.parent;this._anchorMesh.addChild(e),this._anchorMesh.removeChild(e),e.setParent(n),Be.a._RestorePivotPoint(e),this.updateBoundingBox(),e.getChildMeshes(!1).forEach(function(e){e.markAsDirty("scaling")}),this.gizmoLayer.utilityLayerScene.onAfterRenderObservable.addOnce(function(){t._updateDummy()})}},t.prototype._selectNode=function(e){this._rotateSpheresParent.getChildMeshes().concat(this._scaleBoxesParent.getChildMeshes()).forEach(function(t){t.isVisible=!e||t==e})},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){Be.a._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null);var t=null;this.attachedMesh.skeleton&&(t=this.attachedMesh.skeleton.overrideMesh,this.attachedMesh.skeleton.overrideMesh=null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=o.q.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._anchorMesh.rotationQuaternion||(this._anchorMesh.rotationQuaternion=o.q.RotationYawPitchRoll(this._anchorMesh.rotation.y,this._anchorMesh.rotation.x,this._anchorMesh.rotation.z)),this._anchorMesh.rotationQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var n=this.attachedMesh.getHierarchyBoundingVectors(!this.ignoreChildren,this.includeChildPredicate);n.max.subtractToRef(n.min,this._boundingDimensions),this._lineBoundingBox.scaling.copyFrom(this._boundingDimensions),this._lineBoundingBox.position.set((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2,(n.max.z+n.min.z)/2),this._rotateSpheresParent.position.copyFrom(this._lineBoundingBox.position),this._scaleBoxesParent.position.copyFrom(this._lineBoundingBox.position),this._lineBoundingBox.computeWorldMatrix(),this._anchorMesh.position.copyFrom(this._lineBoundingBox.absolutePosition),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),this.attachedMesh.setParent(e),this.attachedMesh.skeleton&&(this.attachedMesh.skeleton.overrideMesh=t)}this._updateRotationSpheres(),this._updateScaleBoxes(),this.attachedMesh&&(this._existingMeshScale.copyFrom(this.attachedMesh.scaling),Be.a._RestorePivotPoint(this.attachedMesh))},t.prototype._updateRotationSpheres=function(){for(var e=this._rotateSpheresParent.getChildMeshes(),t=0;t<3;t++)for(var n=0;n<2;n++)for(var r=0;r<2;r++){var i=4*t+2*n+r;if(0==t&&(e[i].position.set(this._boundingDimensions.x/2,this._boundingDimensions.y*n,this._boundingDimensions.z*r),e[i].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[i].lookAt(o.x.Cross(e[i].position.normalizeToNew(),o.x.Right()).normalizeToNew().add(e[i].position))),1==t&&(e[i].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y/2,this._boundingDimensions.z*r),e[i].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[i].lookAt(o.x.Cross(e[i].position.normalizeToNew(),o.x.Up()).normalizeToNew().add(e[i].position))),2==t&&(e[i].position.set(this._boundingDimensions.x*n,this._boundingDimensions.y*r,this._boundingDimensions.z/2),e[i].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),e[i].lookAt(o.x.Cross(e[i].position.normalizeToNew(),o.x.Forward()).normalizeToNew().add(e[i].position))),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[i].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var a=this.rotationSphereSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[i].scaling.set(a,a,a)}else e[i].scaling.set(this.rotationSphereSize,this.rotationSphereSize,this.rotationSphereSize)}},t.prototype._updateScaleBoxes=function(){for(var e=this._scaleBoxesParent.getChildMeshes(),t=0;t<2;t++)for(var n=0;n<2;n++)for(var r=0;r<2;r++){var i=4*t+2*n+r;if(e[i])if(e[i].position.set(this._boundingDimensions.x*t,this._boundingDimensions.y*n,this._boundingDimensions.z*r),e[i].position.addInPlace(new o.x(-this._boundingDimensions.x/2,-this._boundingDimensions.y/2,-this._boundingDimensions.z/2)),this.fixedDragMeshScreenSize&&this.gizmoLayer.utilityLayerScene.activeCamera){e[i].absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);var a=this.scaleBoxSize*this._tmpVector.length()/this.fixedDragMeshScreenSizeDistanceFactor;e[i].scaling.set(a,a,a)}else e[i].scaling.set(this.scaleBoxSize,this.scaleBoxSize,this.scaleBoxSize)}},t.prototype.setEnabledRotationAxis=function(e){this._rotateSpheresParent.getChildMeshes().forEach(function(t,n){n<4?t.setEnabled(-1!=e.indexOf("x")):n<8?t.setEnabled(-1!=e.indexOf("y")):t.setEnabled(-1!=e.indexOf("z"))})},t.prototype.setEnabledScaling=function(e){this._scaleBoxesParent.getChildMeshes().forEach(function(t,n){t.setEnabled(e)})},t.prototype._updateDummy=function(){this._dragMesh&&(this._dragMesh.position.copyFrom(this._lineBoundingBox.getAbsolutePosition()),this._dragMesh.scaling.copyFrom(this._lineBoundingBox.scaling),this._dragMesh.rotationQuaternion.copyFrom(this._rootMesh.rotationQuaternion))},t.prototype.enableDragBehavior=function(){this._dragMesh=fe.a.CreateBox("dummy",1,this.gizmoLayer.utilityLayerScene),this._dragMesh.visibility=0,this._dragMesh.rotationQuaternion=new o.q,this.pointerDragBehavior.useObjectOrienationForDragging=!1,this._dragMesh.addBehavior(this.pointerDragBehavior)},t.prototype.dispose=function(){this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.gizmoLayer.originalScene.onBeforeRenderObservable.remove(this._renderObserver),this._lineBoundingBox.dispose(),this._rotateSpheresParent.dispose(),this._scaleBoxesParent.dispose(),this._dragMesh&&this._dragMesh.dispose(),e.prototype.dispose.call(this)},t.MakeNotPickableAndWrapInBoundingBox=function(e){(function e(t){t.isPickable=!1,t.getChildMeshes().forEach(function(t){e(t)})})(e),e.rotationQuaternion||(e.rotationQuaternion=o.q.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z));var t=e.position.clone(),n=e.rotationQuaternion.clone();e.rotationQuaternion.set(0,0,0,1),e.position.set(0,0,0);var r=xr.a.CreateBox("box",{size:1},e.getScene()),i=e.getHierarchyBoundingVectors();return i.max.subtractToRef(i.min,r.scaling),0===r.scaling.y&&(r.scaling.y=o.h),0===r.scaling.x&&(r.scaling.x=o.h),0===r.scaling.z&&(r.scaling.z=o.h),r.position.set((i.max.x+i.min.x)/2,(i.max.y+i.min.y)/2,(i.max.z+i.min.z)/2),e.addChild(r),e.rotationQuaternion.copyFrom(n),e.position.copyFrom(t),e.removeChild(r),r.addChild(e),r.visibility=0,r},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo")},t}(Tr.a),Cr=function(e){function t(t,n,r,a){void 0===n&&(n=o.e.Gray()),void 0===r&&(r=Sr.a.DefaultUtilityLayer),void 0===a&&(a=32);var s=e.call(this,r)||this;s._pointerObserver=null,s.snapDistance=0,s.onSnapObservable=new i.c;var l=new yn.a("",r.utilityLayerScene);l.diffuseColor=n,l.specularColor=n.subtract(new o.e(.1,.1,.1));var u=new yn.a("",r.utilityLayerScene);u.diffuseColor=n.add(new o.e(.3,.3,.3));var c=new Fe.a("",r.utilityLayerScene),h=fe.a.CreateTorus("",.6,.03,a,r.utilityLayerScene);h.visibility=0;var d=fe.a.CreateTorus("",.6,.005,a,r.utilityLayerScene);d.material=l,d.rotation.x=Math.PI/2,h.rotation.x=Math.PI/2,c.addChild(d),c.addChild(h),c.lookAt(s._rootMesh.position.add(t)),s._rootMesh.addChild(c),c.scaling.scaleInPlace(1/3),s.dragBehavior=new De.a({dragPlaneNormal:t}),s.dragBehavior.moveAttached=!1,s.dragBehavior.maxDragAngle=9*Math.PI/20,s.dragBehavior._useAlternatePickedPointAboveMaxDragAngle=!0,s._rootMesh.addBehavior(s.dragBehavior);var f=new o.x;s.dragBehavior.onDragStartObservable.add(function(e){s.attachedMesh&&f.copyFrom(e.dragPlanePoint)});var p=new o.j,m=new o.x,g=new o.x,_={snapDistance:0},v=0,y=new o.j,b=new o.x,E=new o.q;s.dragBehavior.onDragObservable.add(function(e){if(s.attachedMesh){s.attachedMesh.rotationQuaternion||(s.attachedMesh.rotationQuaternion=o.q.RotationYawPitchRoll(s.attachedMesh.rotation.y,s.attachedMesh.rotation.x,s.attachedMesh.rotation.z));var n=s.attachedMesh.parent;n&&s.attachedMesh.setParent(null);var i=e.dragPlanePoint.subtract(s.attachedMesh.absolutePosition).normalize(),a=f.subtract(s.attachedMesh.absolutePosition).normalize(),l=o.x.Cross(i,a),u=o.x.Dot(i,a),c=Math.atan2(l.length(),u);if(m.copyFrom(t),g.copyFrom(t),s.updateGizmoRotationToMatchAttachedMesh&&(s.attachedMesh.rotationQuaternion.toRotationMatrix(p),g=o.x.TransformCoordinates(m,p)),r.utilityLayerScene.activeCamera){var h=r.utilityLayerScene.activeCamera.position.subtract(s.attachedMesh.position);o.x.Dot(h,g)>0&&(m.scaleInPlace(-1),g.scaleInPlace(-1))}o.x.Dot(g,l)>0&&(c=-c);var d=!1;if(0!=s.snapDistance)if(v+=c,Math.abs(v)>s.snapDistance){var x=Math.floor(Math.abs(v)/s.snapDistance);v<0&&(x*=-1),v%=s.snapDistance,c=s.snapDistance*x,d=!0}else c=0;y.reset(),s.attachedMesh.parent&&(s.attachedMesh.parent.computeWorldMatrix().invertToRef(y),y.getRotationMatrixToRef(y),o.x.TransformCoordinatesToRef(m,y,m));var T=Math.sin(c/2);E.set(m.x*T,m.y*T,m.z*T,Math.cos(c/2)),y.determinant()>0&&(E.toEulerAnglesToRef(b),o.q.RotationYawPitchRollToRef(b.y,-b.x,-b.z,E)),s.updateGizmoRotationToMatchAttachedMesh?s.attachedMesh.rotationQuaternion.multiplyToRef(E,s.attachedMesh.rotationQuaternion):E.multiplyToRef(s.attachedMesh.rotationQuaternion,s.attachedMesh.rotationQuaternion),f.copyFrom(e.dragPlanePoint),d&&(_.snapDistance=c,s.onSnapObservable.notifyObservers(_)),n&&s.attachedMesh.setParent(n)}}),s._pointerObserver=r.utilityLayerScene.onPointerObservable.add(function(e){if(!s._customMeshSet){var t=e.pickInfo&&-1!=s._rootMesh.getChildMeshes().indexOf(e.pickInfo.pickedMesh)?u:l;s._rootMesh.getChildMeshes().forEach(function(e){e.material=t,e.color&&(e.color=t.diffuseColor)})}});var x=r._getSharedGizmoLight();return x.includedOnlyMeshes=x.includedOnlyMeshes.concat(s._rootMesh.getChildMeshes(!1)),s}return u.d(t,e),t.prototype._attachedMeshChanged=function(e){this.dragBehavior&&(this.dragBehavior.enabled=!!e)},t.prototype.dispose=function(){this.onSnapObservable.clear(),this.gizmoLayer.utilityLayerScene.onPointerObservable.remove(this._pointerObserver),this.dragBehavior.detach(),e.prototype.dispose.call(this)},t}(Tr.a),wr=function(e){function t(t,n){void 0===t&&(t=Sr.a.DefaultUtilityLayer),void 0===n&&(n=32);var r=e.call(this,t)||this;return r.onDragStartObservable=new i.c,r.onDragEndObservable=new i.c,r.xGizmo=new Cr(new o.x(1,0,0),o.e.Red().scale(.5),t,n),r.yGizmo=new Cr(new o.x(0,1,0),o.e.Green().scale(.5),t,n),r.zGizmo=new Cr(new o.x(0,0,1),o.e.Blue().scale(.5),t,n),[r.xGizmo,r.yGizmo,r.zGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){r.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){r.onDragEndObservable.notifyObservers({})})}),r.attachedMesh=null,r}return u.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(Tr.a),Or=function(e){function t(t){void 0===t&&(t=Sr.a.DefaultUtilityLayer);var n=e.call(this,t)||this;return n.onDragStartObservable=new i.c,n.onDragEndObservable=new i.c,n.xGizmo=new Er.a(new o.x(1,0,0),o.e.Red().scale(.5),t),n.yGizmo=new Er.a(new o.x(0,1,0),o.e.Green().scale(.5),t),n.zGizmo=new Er.a(new o.x(0,0,1),o.e.Blue().scale(.5),t),[n.xGizmo,n.yGizmo,n.zGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){n.onDragEndObservable.notifyObservers({})})}),n.attachedMesh=null,n}return u.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t.prototype.setCustomMesh=function(e){p.a.Error("Custom meshes are not supported on this gizmo, please set the custom meshes on the gizmos contained within this one (gizmo.xGizmo, gizmo.yGizmo, gizmo.zGizmo)")},t}(Tr.a);Tn.a.CreatePolyhedron=function(e){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var n,r,i,a,s,l,u=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,c=e.size,h=e.sizeX||c||1,d=e.sizeY||c||1,f=e.sizeZ||c||1,p=e.custom||t[u],m=p.face.length,g=e.faceUV||new Array(m),_=e.faceColors,v=void 0===e.flat||e.flat,y=0===e.sideOrientation?0:e.sideOrientation||Tn.a.DEFAULTSIDE,b=new Array,E=new Array,x=new Array,T=new Array,S=new Array,A=0,P=0,M=new Array,R=0,C=0;if(v)for(C=0;C<m;C++)_&&void 0===_[C]&&(_[C]=new o.f(1,1,1,1)),g&&void 0===g[C]&&(g[C]=new o.y(0,0,1,1));if(v)for(C=0;C<m;C++){var w=p.face[C].length;for(i=2*Math.PI/w,a=.5*Math.tan(i/2),s=.5,R=0;R<w;R++)b.push(p.vertex[p.face[C][R]][0]*h,p.vertex[p.face[C][R]][1]*d,p.vertex[p.face[C][R]][2]*f),M.push(A),A++,n=g[C].x+(g[C].z-g[C].x)*(.5+a),r=g[C].y+(g[C].w-g[C].y)*(s-.5),T.push(n,r),l=a*Math.cos(i)-s*Math.sin(i),s=a*Math.sin(i)+s*Math.cos(i),a=l,_&&S.push(_[C].r,_[C].g,_[C].b,_[C].a);for(R=0;R<w-2;R++)E.push(M[0+P],M[R+2+P],M[R+1+P]);P+=w}else{for(R=0;R<p.vertex.length;R++)b.push(p.vertex[R][0]*h,p.vertex[R][1]*d,p.vertex[R][2]*f),T.push(0,0);for(C=0;C<m;C++)for(R=0;R<p.face[C].length-2;R++)E.push(p.face[C][0],p.face[C][R+2],p.face[C][R+1])}Tn.a.ComputeNormals(b,E,x),Tn.a._ComputeSides(y,b,E,x,T,e.frontUVs,e.backUVs);var O=new Tn.a;return O.positions=b,O.indices=E,O.normals=x,O.uvs=T,_&&v&&(O.colors=S),O},fe.a.CreatePolyhedron=function(e,t,n){return Ir.CreatePolyhedron(e,t,n)};var Ir=function(){function e(){}return e.CreatePolyhedron=function(e,t,n){void 0===n&&(n=null);var r=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Tn.a.CreatePolyhedron(t).applyToMesh(r,t.updatable),r},e}(),Dr=function(e){function t(t){void 0===t&&(t=Sr.a.DefaultUtilityLayer);var n=e.call(this,t)||this;n.onDragStartObservable=new i.c,n.onDragEndObservable=new i.c,n.xGizmo=new Ar(new o.x(1,0,0),o.e.Red().scale(.5),t),n.yGizmo=new Ar(new o.x(0,1,0),o.e.Green().scale(.5),t),n.zGizmo=new Ar(new o.x(0,0,1),o.e.Blue().scale(.5),t),n.uniformScaleGizmo=new Ar(new o.x(0,1,0),o.e.Yellow().scale(.5),t),n.uniformScaleGizmo.updateGizmoRotationToMatchAttachedMesh=!1,n.uniformScaleGizmo.uniformScaling=!0;var r=Ir.CreatePolyhedron("",{type:1},n.uniformScaleGizmo.gizmoLayer.utilityLayerScene);r.scaling.scaleInPlace(.02),r.visibility=0;var a=Ir.CreatePolyhedron("",{type:1},n.uniformScaleGizmo.gizmoLayer.utilityLayerScene);a.scaling.scaleInPlace(.007),r.addChild(a),n.uniformScaleGizmo.setCustomMesh(r,!0);var s=t._getSharedGizmoLight();return s.includedOnlyMeshes=s.includedOnlyMeshes.concat(a),[n.xGizmo,n.yGizmo,n.zGizmo,n.uniformScaleGizmo].forEach(function(e){e.dragBehavior.onDragStartObservable.add(function(){n.onDragStartObservable.notifyObservers({})}),e.dragBehavior.onDragEndObservable.add(function(){n.onDragEndObservable.notifyObservers({})})}),n.attachedMesh=null,n}return u.d(t,e),Object.defineProperty(t.prototype,"attachedMesh",{get:function(){return this.xGizmo.attachedMesh},set:function(e){this.xGizmo&&(this.xGizmo.attachedMesh=e,this.yGizmo.attachedMesh=e,this.zGizmo.attachedMesh=e,this.uniformScaleGizmo.attachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updateGizmoRotationToMatchAttachedMesh",{get:function(){return this.xGizmo.updateGizmoRotationToMatchAttachedMesh},set:function(e){e||p.a.Warn("Setting updateGizmoRotationToMatchAttachedMesh = false on scaling gizmo is not supported."),this.xGizmo&&(this.xGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.yGizmo.updateGizmoRotationToMatchAttachedMesh=e,this.zGizmo.updateGizmoRotationToMatchAttachedMesh=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"snapDistance",{get:function(){return this.xGizmo.snapDistance},set:function(e){this.xGizmo&&(this.xGizmo.snapDistance=e,this.yGizmo.snapDistance=e,this.zGizmo.snapDistance=e,this.uniformScaleGizmo.snapDistance=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleRatio",{get:function(){return this.xGizmo.scaleRatio},set:function(e){this.xGizmo&&(this.xGizmo.scaleRatio=e,this.yGizmo.scaleRatio=e,this.zGizmo.scaleRatio=e,this.uniformScaleGizmo.scaleRatio=e)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.xGizmo.dispose(),this.yGizmo.dispose(),this.zGizmo.dispose(),this.uniformScaleGizmo.dispose(),this.onDragStartObservable.clear(),this.onDragEndObservable.clear()},t}(Tr.a),Lr=function(){function e(e){var t=this;this.scene=e,this.clearGizmoOnEmptyPointerEvent=!1,this.onAttachedToMeshObservable=new i.c,this._gizmosEnabled={positionGizmo:!1,rotationGizmo:!1,scaleGizmo:!1,boundingBoxGizmo:!1},this._pointerObserver=null,this._attachedMesh=null,this._boundingBoxColor=o.e.FromHexString("#0984e3"),this.boundingBoxDragBehavior=new Ue,this.attachableMeshes=null,this.usePointerToAttachGizmos=!0,this._defaultKeepDepthUtilityLayer=new Sr.a(e),this._defaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,this._defaultUtilityLayer=Sr.a.DefaultUtilityLayer,this.gizmos={positionGizmo:null,rotationGizmo:null,scaleGizmo:null,boundingBoxGizmo:null},this._pointerObserver=e.onPointerObservable.add(function(e){if(t.usePointerToAttachGizmos&&e.type==Pe.a.POINTERDOWN)if(e.pickInfo&&e.pickInfo.pickedMesh){var n=e.pickInfo.pickedMesh;if(null==t.attachableMeshes)for(;n&&null!=n.parent;)n=n.parent;else{var r=!1;t.attachableMeshes.forEach(function(e){n&&(n==e||n.isDescendantOf(e))&&(n=e,r=!0)}),r||(n=null)}n instanceof Fe.a?t._attachedMesh!=n&&t.attachToMesh(n):t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)}else t.clearGizmoOnEmptyPointerEvent&&t.attachToMesh(null)})}return e.prototype.attachToMesh=function(e){for(var t in this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh=e,this.gizmos){var n=this.gizmos[t];n&&this._gizmosEnabled[t]&&(n.attachedMesh=e)}this.boundingBoxGizmoEnabled&&this._attachedMesh&&this._attachedMesh.addBehavior(this.boundingBoxDragBehavior),this.onAttachedToMeshObservable.notifyObservers(e)},Object.defineProperty(e.prototype,"positionGizmoEnabled",{get:function(){return this._gizmosEnabled.positionGizmo},set:function(e){e?(this.gizmos.positionGizmo||(this.gizmos.positionGizmo=new Or(this._defaultUtilityLayer)),this.gizmos.positionGizmo.attachedMesh=this._attachedMesh):this.gizmos.positionGizmo&&(this.gizmos.positionGizmo.attachedMesh=null),this._gizmosEnabled.positionGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationGizmoEnabled",{get:function(){return this._gizmosEnabled.rotationGizmo},set:function(e){e?(this.gizmos.rotationGizmo||(this.gizmos.rotationGizmo=new wr(this._defaultUtilityLayer)),this.gizmos.rotationGizmo.attachedMesh=this._attachedMesh):this.gizmos.rotationGizmo&&(this.gizmos.rotationGizmo.attachedMesh=null),this._gizmosEnabled.rotationGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleGizmoEnabled",{get:function(){return this._gizmosEnabled.scaleGizmo},set:function(e){e?(this.gizmos.scaleGizmo=this.gizmos.scaleGizmo||new Dr(this._defaultUtilityLayer),this.gizmos.scaleGizmo.attachedMesh=this._attachedMesh):this.gizmos.scaleGizmo&&(this.gizmos.scaleGizmo.attachedMesh=null),this._gizmosEnabled.scaleGizmo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingBoxGizmoEnabled",{get:function(){return this._gizmosEnabled.boundingBoxGizmo},set:function(e){e?(this.gizmos.boundingBoxGizmo=this.gizmos.boundingBoxGizmo||new Rr(this._boundingBoxColor,this._defaultKeepDepthUtilityLayer),this.gizmos.boundingBoxGizmo.attachedMesh=this._attachedMesh,this._attachedMesh&&(this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this._attachedMesh.addBehavior(this.boundingBoxDragBehavior))):this.gizmos.boundingBoxGizmo&&(this._attachedMesh&&this._attachedMesh.removeBehavior(this.boundingBoxDragBehavior),this.gizmos.boundingBoxGizmo.attachedMesh=null),this._gizmosEnabled.boundingBoxGizmo=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var e in this.scene.onPointerObservable.remove(this._pointerObserver),this.gizmos){var t=this.gizmos[e];t&&t.dispose()}this._defaultKeepDepthUtilityLayer.dispose(),this.boundingBoxDragBehavior.detach(),this.onAttachedToMeshObservable.clear()},e}(),Fr=n(38),Nr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._needProjectionMatrixCompute=!0,t}return u.d(t,e),t.prototype._setPosition=function(e){this._position=e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._setPosition(e)},enumerable:!0,configurable:!0}),t.prototype._setDirection=function(e){this._direction=e},Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){this._setDirection(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=o.x.Zero()),o.x.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=o.x.Zero()),o.x.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},t.prototype.getDepthScale=function(){return 50},t.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},t.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},t.prototype.setDirectionToTarget=function(e){return this.direction=o.x.Normalize(e.subtract(this.position)),this.direction},t.prototype.getRotation=function(){this.direction.normalize();var e=o.x.Cross(this.direction,o.c.Y),t=o.x.Cross(e,this.direction);return o.x.RotationFromAxis(e,t,this.direction)},t.prototype.needCube=function(){return!1},t.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},t.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=o.x.Zero()},t.prototype._isSynchronized=function(){return!!this._cache.position.equals(this.position)},t.prototype.computeWorldMatrix=function(e){return!e&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=o.j.Identity()),o.j.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)},t.prototype.getDepthMinZ=function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ},t.prototype.getDepthMaxZ=function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ},t.prototype.setShadowProjectionMatrix=function(e,t,n){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,n,e):this._setDefaultShadowProjectionMatrix(e,t,n),this},u.c([Object(D.o)()],t.prototype,"position",null),u.c([Object(D.o)()],t.prototype,"direction",null),u.c([Object(D.c)()],t.prototype,"shadowMinZ",null),u.c([Object(D.c)()],t.prototype,"shadowMaxZ",null),t}(Fr.a);F.a.AddNodeConstructor("Light_Type_1",function(e,t){return function(){return new Br(e,o.x.Zero(),t)}});var Br=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i._shadowFrustumSize=0,i._shadowOrthoScale=.1,i.autoUpdateExtends=!0,i._orthoLeft=Number.MAX_VALUE,i._orthoRight=Number.MIN_VALUE,i._orthoTop=Number.MIN_VALUE,i._orthoBottom=Number.MAX_VALUE,i.position=n.scale(-1),i.direction=n,i}return u.d(t,e),Object.defineProperty(t.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DirectionalLight"},t.prototype.getTypeID=function(){return Fr.a.LIGHTTYPEID_DIRECTIONALLIGHT},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,n){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,n)},t.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(e){var t=this.getScene().activeCamera;t&&o.j.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,e)},t.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(e,t,n){var r=this.getScene().activeCamera;if(r){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var i=o.x.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var a=0;a<n.length;a++){var s=n[a];if(s)for(var l=s.getBoundingInfo().boundingBox,u=0;u<l.vectorsWorld.length;u++)o.x.TransformCoordinatesToRef(l.vectorsWorld[u],t,i),i.x<this._orthoLeft&&(this._orthoLeft=i.x),i.y<this._orthoBottom&&(this._orthoBottom=i.y),i.x>this._orthoRight&&(this._orthoRight=i.x),i.y>this._orthoTop&&(this._orthoTop=i.y)}}var c=this._orthoRight-this._orthoLeft,h=this._orthoTop-this._orthoBottom;o.j.OrthoOffCenterLHToRef(this._orthoLeft-c*this.shadowOrthoScale,this._orthoRight+c*this.shadowOrthoScale,this._orthoBottom-h*this.shadowOrthoScale,this._orthoTop+h*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,e)}},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)},t.prototype.getDepthMinZ=function(e){return 1},t.prototype.getDepthMaxZ=function(e){return 1},t.prototype.prepareLightSpecificDefines=function(e,t){e["DIRLIGHT"+t]=!0},u.c([Object(D.c)()],t.prototype,"shadowFrustumSize",null),u.c([Object(D.c)()],t.prototype,"shadowOrthoScale",null),u.c([Object(D.c)()],t.prototype,"autoUpdateExtends",void 0),t}(Nr);fe.a.CreateHemisphere=function(e,t,n,r){var i={segments:t,diameter:n};return Ur.CreateHemisphere(e,i,r)};var Ur=function(){function e(){}return e.CreateHemisphere=function(e,t,n){t.diameter||(t.diameter=1),t.segments||(t.segments=16);var r=Pr.a.CreateSphere("",{slice:.5,diameter:t.diameter,segments:t.segments},n),i=fe.a.CreateDisc("",t.diameter/2,3*t.segments+(4-t.segments),n);i.rotation.x=-Math.PI/2,i.parent=r;var o=fe.a.MergeMeshes([i,r],!0);return o.name=e,o},e}();F.a.AddNodeConstructor("Light_Type_2",function(e,t){return function(){return new kr(e,o.x.Zero(),o.x.Zero(),0,0,t)}});var kr=function(e){function t(t,n,r,i,a,s){var l=e.call(this,t,s)||this;return l._innerAngle=0,l._projectionTextureMatrix=o.j.Zero(),l._projectionTextureLightNear=1e-6,l._projectionTextureLightFar=1e3,l._projectionTextureUpDirection=o.x.Up(),l._projectionTextureViewLightDirty=!0,l._projectionTextureProjectionLightDirty=!0,l._projectionTextureDirty=!0,l._projectionTextureViewTargetVector=o.x.Zero(),l._projectionTextureViewLightMatrix=o.j.Zero(),l._projectionTextureProjectionLightMatrix=o.j.Zero(),l._projectionTextureScalingMatrix=o.j.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),l.position=n,l.direction=r,l.angle=i,l.exponent=a,l}return u.d(t,e),Object.defineProperty(t.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._cosHalfAngle=Math.cos(.5*e),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerAngle",{get:function(){return this._innerAngle},set:function(e){this._innerAngle=e,this._computeAngleValues()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureMatrix",{get:function(){return this._projectionTextureMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightNear",{get:function(){return this._projectionTextureLightNear},set:function(e){this._projectionTextureLightNear=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureLightFar",{get:function(){return this._projectionTextureLightFar},set:function(e){this._projectionTextureLightFar=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTextureUpDirection",{get:function(){return this._projectionTextureUpDirection},set:function(e){this._projectionTextureUpDirection=e,this._projectionTextureProjectionLightDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"projectionTexture",{get:function(){return this._projectionTexture},set:function(e){var t=this;if(this._projectionTexture!==e&&(this._projectionTexture=e,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady())){var n=this._projectionTexture;n.onLoadObservable&&n.onLoadObservable.addOnce(function(){t._markMeshesAsLightDirty()})}},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SpotLight"},t.prototype.getTypeID=function(){return Fr.a.LIGHTTYPEID_SPOTLIGHT},t.prototype._setDirection=function(t){e.prototype._setDirection.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setPosition=function(t){e.prototype._setPosition.call(this,t),this._projectionTextureViewLightDirty=!0},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,n){var r=this.getScene().activeCamera;if(r){this._shadowAngleScale=this._shadowAngleScale||1;var i=this._shadowAngleScale*this._angle;o.j.PerspectiveFovLHToRef(i,1,this.getDepthMinZ(r),this.getDepthMaxZ(r),e)}},t.prototype._computeProjectionTextureViewLightMatrix=function(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.position.addToRef(this.direction,this._projectionTextureViewTargetVector),o.j.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)},t.prototype._computeProjectionTextureProjectionLightMatrix=function(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;var e=this.projectionTextureLightFar,t=this.projectionTextureLightNear,n=e/(e-t),r=-n*t,i=1/Math.tan(this._angle/2);o.j.FromValuesToRef(i/1,0,0,0,0,i,0,0,0,0,n,1,0,0,r,0,this._projectionTextureProjectionLightMatrix)},t.prototype._computeProjectionTextureMatrix=function(){this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype._computeAngleValues=function(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale},t.prototype.transferToEffect=function(e,t){var n;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),n=o.x.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),n=o.x.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",n.x,n.y,n.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),e.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),e.setTexture("projectionLightSampler"+t,this.projectionTexture)),this},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._projectionTexture&&this._projectionTexture.dispose()},t.prototype.prepareLightSpecificDefines=function(e,t){e["SPOTLIGHT"+t]=!0,e["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady())},u.c([Object(D.c)()],t.prototype,"angle",null),u.c([Object(D.c)()],t.prototype,"innerAngle",null),u.c([Object(D.c)()],t.prototype,"shadowAngleScale",null),u.c([Object(D.c)()],t.prototype,"exponent",void 0),u.c([Object(D.c)()],t.prototype,"projectionTextureLightNear",null),u.c([Object(D.c)()],t.prototype,"projectionTextureLightFar",null),u.c([Object(D.c)()],t.prototype,"projectionTextureUpDirection",null),u.c([Object(D.m)("projectedLightTexture")],t.prototype,"_projectionTexture",void 0),t}(Nr),Vr=function(e){function t(t){var n=e.call(this,t)||this;return n.cachedPosition=new o.x,n.cachedForward=new o.x(0,0,1),n._light=null,n.attachedMesh=new Fe.a("",n.gizmoLayer.utilityLayerScene),n._material=new yn.a("light",n.gizmoLayer.originalScene),n._material.diffuseColor=new o.e(.5,.5,.5),n._material.specularColor=new o.e(.1,.1,.1),n}return u.d(t,e),Object.defineProperty(t.prototype,"light",{get:function(){return this._light},set:function(e){var n=this;if(this._light=e,e){this._lightMesh&&this._lightMesh.dispose(),e instanceof mn.a?this._lightMesh=t._CreateHemisphericLightMesh(this.gizmoLayer.utilityLayerScene):this._lightMesh=e instanceof Br?t._CreateDirectionalLightMesh(this.gizmoLayer.utilityLayerScene):e instanceof kr?t._CreateSpotLightMesh(this.gizmoLayer.utilityLayerScene):t._CreatePointLightMesh(this.gizmoLayer.utilityLayerScene),this._lightMesh.getChildMeshes(!1).forEach(function(e){e.material=n._material}),this._lightMesh.parent=this._rootMesh;var r=this.gizmoLayer._getSharedGizmoLight();r.includedOnlyMeshes=r.includedOnlyMeshes.concat(this._lightMesh.getChildMeshes(!1)),this._lightMesh.rotationQuaternion=new o.q,e.position&&this.attachedMesh.position.copyFrom(e.position),e.direction&&this.attachedMesh.setDirection(e.direction),this._update()}},enumerable:!0,configurable:!0}),t.prototype._update=function(){e.prototype._update.call(this),this._light&&(this._light.position&&(this.attachedMesh.position.equals(this.cachedPosition)?this.attachedMesh.position.copyFrom(this._light.position):(this._light.position.copyFrom(this.attachedMesh.position),this.cachedPosition.copyFrom(this.attachedMesh.position))),this._light.direction&&(o.x.DistanceSquared(this.attachedMesh.forward,this.cachedForward)>1e-4?(this._light.direction.copyFrom(this.attachedMesh.forward),this.cachedForward.copyFrom(this.attachedMesh.forward)):o.x.DistanceSquared(this.attachedMesh.forward,this._light.direction)>1e-4&&(this.attachedMesh.setDirection(this._light.direction),this.cachedForward.copyFrom(this._lightMesh.forward))),this._light.isEnabled()?this._material.diffuseColor.set(this._light.diffuse.r/3,this._light.diffuse.g/3,this._light.diffuse.b/3):this._material.diffuseColor.set(0,0,0))},t.prototype.dispose=function(){this._material.dispose(),e.prototype.dispose.call(this)},t._CreateHemisphericLightMesh=function(e){var n=new fe.a("hemisphereLight",e),r=Ur.CreateHemisphere(n.name,{segments:10,diameter:1},e);r.position.z=-.15,r.rotation.x=Math.PI/2,r.parent=n;var i=this._createLightLines(3,e);return i.parent=n,i.position.z,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreatePointLightMesh=function(e){var n=new fe.a("pointLight",e),r=Pr.a.CreateSphere(n.name,{segments:10,diameter:1},e);return r.rotation.x=Math.PI/2,r.parent=n,this._createLightLines(5,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateSpotLightMesh=function(e){var n=new fe.a("spotLight",e);Pr.a.CreateSphere(n.name,{segments:10,diameter:1},e).parent=n;var r=Ur.CreateHemisphere(n.name,{segments:10,diameter:2},e);return r.parent=n,r.rotation.x=-Math.PI/2,this._createLightLines(2,e).parent=n,n.scaling.scaleInPlace(t._Scale),n.rotation.x=Math.PI/2,n},t._CreateDirectionalLightMesh=function(e){var n=new fe.a("directionalLight",e),r=new fe.a(n.name,e);r.parent=n,Pr.a.CreateSphere(n.name,{diameter:1.2,segments:10},e).parent=r;var i=fe.a.CreateCylinder(n.name,6,.3,.3,6,1,e);i.parent=r,(o=i.clone(n.name)).scaling.y=.5,o.position.x+=1.25,(a=i.clone(n.name)).scaling.y=.5,a.position.x+=-1.25;var o,a,s=fe.a.CreateCylinder(n.name,1,0,.6,6,1,e);return s.position.y+=3,s.parent=r,(o=s.clone(n.name)).position.y=1.5,o.position.x+=1.25,(a=s.clone(n.name)).position.y=1.5,a.position.x+=-1.25,r.scaling.scaleInPlace(t._Scale),r.rotation.z=Math.PI/2,r.rotation.y=Math.PI/2,n},t._Scale=.007,t._createLightLines=function(e,t){var n=new fe.a("root",t);n.rotation.x=Math.PI/2;var r=new fe.a("linePivot",t);r.parent=n;var i=fe.a.CreateCylinder("line",2,.2,.3,6,1,t);if(i.position.y=i.scaling.y/2+1.2,i.parent=r,e<2)return r;for(var o=0;o<4;o++)(a=r.clone("lineParentClone")).rotation.z=Math.PI/4,a.rotation.y=Math.PI/2+Math.PI/2*o,a.getChildMeshes()[0].scaling.y=.5,a.getChildMeshes()[0].scaling.x=a.getChildMeshes()[0].scaling.z=.8,a.getChildMeshes()[0].position.y=a.getChildMeshes()[0].scaling.y/2+1.2;if(e<3)return n;for(o=0;o<4;o++)(a=r.clone("linePivotClone")).rotation.z=Math.PI/2,a.rotation.y=Math.PI/2*o;if(e<4)return n;for(o=0;o<4;o++){var a;(a=r.clone("linePivotClone")).rotation.z=Math.PI+Math.PI/4,a.rotation.y=Math.PI/2+Math.PI/2*o,a.getChildMeshes()[0].scaling.y=.5,a.getChildMeshes()[0].scaling.x=a.getChildMeshes()[0].scaling.z=.8,a.getChildMeshes()[0].position.y=a.getChildMeshes()[0].scaling.y/2+1.2}return e<5?n:((a=r.clone("linePivotClone")).rotation.z=Math.PI,n)},t}(Tr.a),Gr=n(44);zt.a.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};",zt.a.IncludesShadersStore.kernelBlurFragment="#ifdef DOF\nfactor=sampleCoC(sampleCoord{X});\ncomputedWeight=KERNEL_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif",zt.a.IncludesShadersStore.kernelBlurFragment2="#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});\ncomputedWeight=KERNEL_DEP_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif",zt.a.ShadersStore.kernelBlurPixelShader="\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;\nuniform vec2 cameraMinMaxZ;\nfloat sampleDistance(const in vec2 offset) {\nfloat depth=texture2D(circleOfConfusionSampler,offset).g;\nreturn cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth;\n}\nfloat sampleCoC(const in vec2 offset) {\nfloat coc=texture2D(circleOfConfusionSampler,offset).r;\nreturn coc;\n}\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nvoid main(void)\n{\nfloat computedWeight=0.0;\n#ifdef PACKEDFLOAT\nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT;\nfloat factor=0.0;\n\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}",zt.a.IncludesShadersStore.kernelBlurVertex="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",zt.a.ShadersStore.kernelBlurVertexShader="\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}";var zr=function(e){function t(t,n,r,i,o,a,s,l,u,c,h){void 0===a&&(a=Ge.a.BILINEAR_SAMPLINGMODE),void 0===u&&(u=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=""),void 0===h&&(h=!1);var d=e.call(this,t,"kernelBlur",["delta","direction","cameraMinMaxZ"],["circleOfConfusionSampler"],i,o,a,s,l,null,u,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return d.direction=n,d.blockCompilation=h,d._packedFloat=!1,d._staticDefines="",d._staticDefines=c,d.onApplyObservable.add(function(e){d._outputTexture?e.setFloat2("delta",1/d._outputTexture.width*d.direction.x,1/d._outputTexture.height*d.direction.y):e.setFloat2("delta",1/d.width*d.direction.x,1/d.height*d.direction.y)}),d.kernel=r,d}return u.d(t,e),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this.blockCompilation||this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype.updateEffect=function(e,t,n,r,i,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),this._updateParameters(i,o)},t.prototype._updateParameters=function(t,n){for(var r=this._kernel,i=(r-1)/2,o=[],a=[],s=0,l=0;l<r;l++){var u=l/(r-1),c=this._gaussianWeight(2*u-1);o[l]=l-i,a[l]=c,s+=c}for(l=0;l<a.length;l++)a[l]/=s;var h=[],d=[],f=[];for(l=0;l<=i;l+=2){var p=Math.min(l+1,Math.floor(i));if(l===p)f.push({o:o[l],w:a[l]});else{var m=p===i,g=a[l]+a[p]*(m?.5:1),_=o[l]+1/(1+a[l]/a[p]);0===_?(f.push({o:o[l],w:a[l]}),f.push({o:o[l+1],w:a[l+1]})):(f.push({o:_,w:g}),f.push({o:-_,w:g}))}}for(l=0;l<f.length;l++)d[l]=f[l].o,h[l]=f[l].w;o=d,a=h;var v=this.getEngine().getCaps().maxVaryingVectors,y=Math.max(v,0)-1,b=Math.min(o.length,y),E="";for(E+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(E+="#define CENTER_WEIGHT "+this._glslFloat(a[b-1])+"\r\n",b--),l=0;l<b;l++)E+="#define KERNEL_OFFSET"+l+" "+this._glslFloat(o[l])+"\r\n",E+="#define KERNEL_WEIGHT"+l+" "+this._glslFloat(a[l])+"\r\n";var x=0;for(l=y;l<o.length;l++)E+="#define KERNEL_DEP_OFFSET"+x+" "+this._glslFloat(o[l])+"\r\n",E+="#define KERNEL_DEP_WEIGHT"+x+" "+this._glslFloat(a[l])+"\r\n",x++;this.packedFloat&&(E+="#define PACKEDFLOAT 1"),this.blockCompilation=!1,e.prototype.updateEffect.call(this,E,null,null,{varyingCount:b,depCount:x},t,n)},t.prototype._nearestBestKernel=function(e){for(var t=Math.round(e),n=0,r=[t,t-1,t+1,t-2,t+2];n<r.length;n++){var i=r[n];if(i%2!=0&&Math.floor(i/2)%2==0&&i>0)return Math.max(i,3)}return Math.max(t,3)},t.prototype._gaussianWeight=function(e){var t=-e*e/(1/3*2*(1/3));return 1/(Math.sqrt(2*Math.PI)*(1/3))*Math.exp(t)},t.prototype._glslFloat=function(e,t){return void 0===t&&(t=8),e.toFixed(t).replace(/0+$/,"")},t}(jt),jr=function(e){function t(t,n,r,i,a,s,l){void 0===a&&(a=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===s&&(s=Ge.a.BILINEAR_SAMPLINGMODE),void 0===l&&(l=!0);var u=e.call(this,t,n,r,i,!0,a,!1,s,l)||this;return u.scene=r,u.mirrorPlane=new o.n(0,1,0,1),u._transformMatrix=o.j.Zero(),u._mirrorMatrix=o.j.Zero(),u._adaptiveBlurKernel=0,u._blurKernelX=0,u._blurKernelY=0,u._blurRatio=1,u.ignoreCameraViewport=!0,u._updateGammaSpace(),u._imageProcessingConfigChangeObserver=r.imageProcessingConfiguration.onUpdateParameters.add(function(){u._updateGammaSpace}),u.onBeforeRenderObservable.add(function(){o.j.ReflectionToRef(u.mirrorPlane,u._mirrorMatrix),u._savedViewMatrix=r.getViewMatrix(),u._mirrorMatrix.multiplyToRef(u._savedViewMatrix,u._transformMatrix),r.setTransformMatrix(u._transformMatrix,r.getProjectionMatrix()),r.clipPlane=u.mirrorPlane,r.getEngine().cullBackFaces=!1,r._mirroredCameraPosition=o.x.TransformCoordinates(r.activeCamera.globalPosition,u._mirrorMatrix)}),u.onAfterRenderObservable.add(function(){r.setTransformMatrix(u._savedViewMatrix,r.getProjectionMatrix()),r.getEngine().cullBackFaces=!0,r._mirroredCameraPosition=null,r.clipPlane=null}),u}return u.d(t,e),Object.defineProperty(t.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),t.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),t=this.getRenderWidth()/e.getRenderWidth(),n=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*t,this.blurKernelY=this._adaptiveBlurKernel*n},t.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},t.prototype._updateGammaSpace=function(){this.gammaSpace=!this.scene.imageProcessingConfiguration.isEnabled||!this.scene.imageProcessingConfiguration.applyByPostProcess},t.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var e=this.getScene().getEngine(),t=e.getCaps().textureFloatRender?m.a.TEXTURETYPE_FLOAT:m.a.TEXTURETYPE_HALF_FLOAT;this._blurX=new zr("horizontal blur",new o.w(1,0),this._blurKernelX,this._blurRatio,null,Ge.a.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.inputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new zr("vertical blur",new o.w(0,1),this._blurKernelY,this._blurRatio,null,Ge.a.BILINEAR_SAMPLINGMODE,e,!1,t),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);return t.mirrorPlane=this.mirrorPlane.asArray(),t},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigChangeObserver)},t}(un);Ge.a._CreateMirror=function(e,t,n,r){return new jr(e,t,n,r)},ge.b.prototype._createDepthStencilCubeTexture=function(e,t){var n=new ze.a(this,ze.a.DATASOURCE_UNKNOWN);if(n.isCube=!0,1===this.webGLVersion)return p.a.Error("Depth cube texture is not supported by WebGL 1."),n;var r=u.a({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t),i=this._gl;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,n,!0),this._setupDepthStencilTexture(n,e,r.generateStencil,r.bilinearFiltering,r.comparisonFunction);for(var o=0;o<6;o++)r.generateStencil?i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i.DEPTH24_STENCIL8,e,e,0,i.DEPTH_STENCIL,i.UNSIGNED_INT_24_8,null):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i.DEPTH_COMPONENT24,e,e,0,i.DEPTH_COMPONENT,i.UNSIGNED_INT,null);return this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null),n},ge.b.prototype._partialLoadFile=function(e,t,n,r,i){void 0===i&&(i=null),this._loadFile(e,function(e){n[t]=e,n._internalCount++,6===n._internalCount&&r(n)},void 0,void 0,!0,function(e,t){i&&e&&i(e.status+" "+e.statusText,t)})},ge.b.prototype._cascadeLoadFiles=function(e,t,n,r){void 0===r&&(r=null);var i=[];i._internalCount=0;for(var o=0;o<6;o++)this._partialLoadFile(n[o],o,i,t,r)},ge.b.prototype._cascadeLoadImgs=function(e,t,n,r){void 0===r&&(r=null);var i=[];i._internalCount=0;for(var o=0;o<6;o++)this._partialLoadImg(n[o],o,i,e,t,r)},ge.b.prototype._partialLoadImg=function(e,t,n,r,i,o){var a;void 0===o&&(o=null),a=ye.h.LoadImage(e,function(){n[t]=a,n._internalCount++,r&&r._removePendingData(a),6===n._internalCount&&i(n)},function(e,t){r&&r._removePendingData(a),o&&o(e,t)},r?r.offlineProvider:null),r&&r._addPendingData(a)},ge.b.prototype.createCubeTexture=function(e,t,n,r,i,o,a,s,l,u,c,h,d){var f=this;void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=!1),void 0===u&&(u=0),void 0===c&&(c=0),void 0===h&&(h=null),void 0===d&&(d=[]);var m=this._gl,g=h||new ze.a(this,ze.a.DATASOURCE_CUBE);g.isCube=!0,g.url=e,g.generateMipMaps=!r,g._lodGenerationScale=u,g._lodGenerationOffset=c,this._doNotHandleContextLost||(g._extension=s,g._files=n);for(var _=e.lastIndexOf("."),v=s||(_>-1?e.substring(_).toLowerCase():""),y=null,b=0,E=ge.b._TextureLoaders;b<E.length;b++){var x=E[b];if(-1===d.indexOf(x)&&x.canLoad(v,this._textureFormatInUse,h,!1,!1)){y=x;break}}if(y){e=y.transformUrl(e,this._textureFormatInUse);var T=function(e){f._bindTextureDirectly(m.TEXTURE_CUBE_MAP,g,!0),y.loadCubeData(e,g,l,i,o)};n&&6===n.length?y.supportCascades?this._cascadeLoadFiles(t,T,n,o):o?o("Textures type does not support cascades."):p.a.Warn("Texture loader does not support cascades."):this._loadFile(e,T,void 0,void 0,!0,function(e,s){if(y){var h=y.getFallbackTextureUrl(g.url,f._textureFormatInUse);if(p.a.Warn(y.constructor.name+" failed when trying to load "+g.url+", falling back to the next supported loader"),h)return d.push(y),void f.createCubeTexture(h,t,n,r,i,o,a,v,l,u,c,g,d)}o&&e&&o(e.status+" "+e.statusText,s)})}else{if(!n)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(t,function(e){var t=f.needPOTTextures?ye.h.GetExponentOfTwo(e[0].width,f._caps.maxCubemapTextureSize):e[0].width,n=t;if(f._prepareWorkingCanvas(),f._workingCanvas&&f._workingContext){f._workingCanvas.width=t,f._workingCanvas.height=n;var o=[m.TEXTURE_CUBE_MAP_POSITIVE_X,m.TEXTURE_CUBE_MAP_POSITIVE_Y,m.TEXTURE_CUBE_MAP_POSITIVE_Z,m.TEXTURE_CUBE_MAP_NEGATIVE_X,m.TEXTURE_CUBE_MAP_NEGATIVE_Y,m.TEXTURE_CUBE_MAP_NEGATIVE_Z];f._bindTextureDirectly(m.TEXTURE_CUBE_MAP,g,!0),f._unpackFlipY(!1);for(var s=a?f._getInternalFormat(a):f._gl.RGBA,l=0;l<o.length;l++)e[l].width!==t||e[l].height!==n?(f._workingContext.drawImage(e[l],0,0,e[l].width,e[l].height,0,0,t,n),m.texImage2D(o[l],0,s,s,m.UNSIGNED_BYTE,f._workingCanvas)):m.texImage2D(o[l],0,s,s,m.UNSIGNED_BYTE,e[l]);r||m.generateMipmap(m.TEXTURE_CUBE_MAP),f._setCubeMapTextureParams(!r),g.width=t,g.height=n,g.isReady=!0,a&&(g.format=a),g.onLoadedObservable.notifyObservers(g),g.onLoadedObservable.clear(),i&&i()}},n,o)}return this._internalTexturesCache.push(g),g};var Hr=function(e){function t(t,n,r,i,a,s,l,u,c,h,d,f,p){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=m.a.TEXTUREFORMAT_RGBA),void 0===c&&(c=!1),void 0===h&&(h=null),void 0===d&&(d=!1),void 0===f&&(f=.8),void 0===p&&(p=0);var g=e.call(this,n)||this;if(g.boundingBoxPosition=o.x.Zero(),g._rotationY=0,g._prefiltered=!1,g.name=t,g.url=t,g._noMipmap=i,g.hasAlpha=!1,g._format=u,g.isCube=!0,g._textureMatrix=o.j.Identity(),g._createPolynomials=d,g.coordinatesMode=Ge.a.CUBIC_MODE,!t&&!a)return g;var _=t.lastIndexOf("."),v=h||(_>-1?t.substring(_).toLowerCase():""),y=".dds"===v,b=".env"===v;if(b?(g.gammaSpace=!1,g._prefiltered=!1):(g._prefiltered=c,c&&(g.gammaSpace=!1)),g._texture=g._getFromCache(t,i),!a&&(b||y||r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),a=[],r))for(var E=0;E<r.length;E++)a.push(t+r[E]);return g._files=a,g._texture?s&&(g._texture.isReady?ye.h.SetImmediate(function(){return s()}):g._texture.onLoadedObservable.add(s)):n.useDelayedTextureLoading?g.delayLoadState=m.a.DELAYLOADSTATE_NOTLOADED:g._texture=c?n.getEngine().createPrefilteredCubeTexture(t,n,f,p,s,l,u,h,g._createPolynomials):n.getEngine().createCubeTexture(t,n,a,i,s,l,g._format,h,!1,f,p),g}return u.d(t,e),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(o.j.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),t.CreateFromImages=function(e,n,r){var i="";return e.forEach(function(e){return i+=e}),new t(i,n,null,r,e)},t.CreateFromPrefilteredData=function(e,n,r,i){return void 0===r&&(r=null),void 0===i&&(i=!0),new t(e,n,null,!1,null,null,null,void 0,!0,r,i)},Object.defineProperty(t.prototype,"isPrefiltered",{get:function(){return this._prefiltered},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"CubeTexture"},t.prototype.updateURL=function(e,t,n){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag)),this.url=e,this.delayLoadState=m.a.DELAYLOADSTATE_NOTLOADED,this._prefiltered=!1,n&&(this._delayedOnLoad=n),this.delayLoad(t)},t.prototype.delayLoad=function(e){if(this.delayLoadState===m.a.DELAYLOADSTATE_NOTLOADED){var t=this.getScene();t&&(this.delayLoadState=m.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=t.getEngine().createPrefilteredCubeTexture(this.url,t,this.lodGenerationScale,this.lodGenerationOffset,this._delayedOnLoad,void 0,this._format,void 0,this._createPolynomials):this._texture=t.getEngine().createCubeTexture(this.url,t,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,e)))}},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var t=this;e.updateFlag!==this._textureMatrix.updateFlag&&(e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag,function(e){return-1!==e.getActiveTextures().indexOf(t)}),this._textureMatrix=e)},t.Parse=function(e,n,r){var i=D.a.Parse(function(){var i=!1;return e.prefiltered&&(i=e.prefiltered),new t(r+e.name,n,e.extensions,!1,null,null,null,void 0,i)},e,n);if(e.boundingBoxPosition&&(i.boundingBoxPosition=o.x.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(i.boundingBoxSize=o.x.FromArray(e.boundingBoxSize)),e.animations)for(var s=0;s<e.animations.length;s++){var l=e.animations[s],u=a.a.GetClass("BABYLON.Animation");u&&i.animations.push(u.Parse(l))}return i},t.prototype.clone=function(){var e=this,n=this.getScene(),r=0,i=D.a.Clone(function(){if(!n)return e;var i=new t(e.url,n,e._extensions,e._noMipmap,e._files);return r=i.uniqueId,i},this);return i.uniqueId=r,i},u.c([Object(D.c)("rotationY")],t.prototype,"rotationY",null),u.c([Object(D.j)("textureMatrix")],t.prototype,"_textureMatrix",void 0),t}(Gr.a);Ge.a._CubeTextureParser=Hr.Parse,a.a.RegisteredTypes["BABYLON.CubeTexture"]=Hr;var Wr=n(15),Xr=n(64),Yr=n(75),Kr=n(18);zt.a.IncludesShadersStore.backgroundFragmentDeclaration=" uniform vec4 vPrimaryColor;\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nuniform vec4 vPrimaryColorShadow;\n#endif\nuniform float shadowLevel;\nuniform float alpha;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif",zt.a.IncludesShadersStore.backgroundUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec4 vPrimaryColor;\nuniform vec4 vPrimaryColorShadow;\nuniform vec2 vDiffuseInfos;\nuniform vec2 vReflectionInfos;\nuniform mat4 diffuseMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\nuniform float pointSize;\nuniform float shadowLevel;\nuniform float alpha;\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};",n(113),n(84),n(85),n(120),n(112),n(95),n(98),n(89),n(114),n(99),zt.a.ShadersStore.backgroundPixelShader="#ifdef TEXTURELODSUPPORT\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__backgroundFragment>\n#define RECIPROCAL_PI2 0.15915494\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#ifndef SHADOWONLY\n#define SHADOWONLY;\n#endif\n#include<imageProcessingDeclaration>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<helperFunctions>\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<imageProcessingFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n#ifdef REFLECTIONFRESNEL\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(0.0,1.0,0.0);\n#endif\n\nfloat shadow=1.;\nfloat globalShadow=0.;\nfloat shadowLightCount=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef SHADOWINUSE\nglobalShadow/=shadowLightCount;\n#else\nglobalShadow=1.0;\n#endif\n\nvec4 reflectionColor=vec4(1.,1.,1.,1.);\n#ifdef REFLECTION\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#ifdef REFLECTIONBLUR\nfloat reflectionLOD=vReflectionInfos.y;\n#ifdef TEXTURELODSUPPORT\n\nreflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nreflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nreflectionColor=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nreflectionSpecularMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nreflectionColor=mix(\nreflectionSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#else\nvec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);\nreflectionColor=reflectionSample;\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef GAMMAREFLECTION\nreflectionColor.rgb=toLinearSpace(reflectionColor.rgb);\n#endif\n#ifdef REFLECTIONBGR\nreflectionColor.rgb=reflectionColor.bgr;\n#endif\n\nreflectionColor.rgb*=vReflectionInfos.x;\n#endif\n\nvec3 diffuseColor=vec3(1.,1.,1.);\nfloat finalAlpha=alpha;\n#ifdef DIFFUSE\nvec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef GAMMADIFFUSE\ndiffuseMap.rgb=toLinearSpace(diffuseMap.rgb);\n#endif\n\ndiffuseMap.rgb*=vDiffuseInfos.y;\n#ifdef DIFFUSEHASALPHA\nfinalAlpha*=diffuseMap.a;\n#endif\ndiffuseColor=diffuseMap.rgb;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 colorBase=diffuseColor;\n#else\nvec3 colorBase=reflectionColor.rgb*diffuseColor;\n#endif\ncolorBase=max(colorBase,0.0);\n\n#ifdef USERGBCOLOR\nvec3 finalColor=colorBase;\n#else\n#ifdef USEHIGHLIGHTANDSHADOWCOLORS\nvec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);\n#else\nvec3 mainColor=vPrimaryColor.rgb;\n#endif\nvec3 finalColor=colorBase*mainColor;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 reflectionAmount=vReflectionControl.xxx;\nvec3 reflectionReflectance0=vReflectionControl.yyy;\nvec3 reflectionReflectance90=vReflectionControl.zzz;\nfloat VdotN=dot(normalize(vEyePosition),normalW);\nvec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);\nreflectionAmount*=planarReflectionFresnel;\n#ifdef REFLECTIONFALLOFF\nfloat reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);\nreflectionDistanceFalloff*=reflectionDistanceFalloff;\nreflectionAmount*=reflectionDistanceFalloff;\n#endif\nfinalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));\n#endif\n#ifdef OPACITYFRESNEL\nfloat viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));\n\nconst float startAngle=0.1;\nfloat fadeFactor=saturate(viewAngleToFloor/startAngle);\nfinalAlpha*=fadeFactor*fadeFactor;\n#endif\n\n#ifdef SHADOWINUSE\nfinalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);\n#endif\n\nvec4 color=vec4(finalColor,finalAlpha);\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\ncolor.rgb=clamp(color.rgb,0.,30.0);\n#else\n\ncolor=applyImageProcessing(color);\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#ifdef NOISE\ncolor.rgb+=dither(vPositionW.xy,0.5);\ncolor=max(color,0.0);\n#endif\ngl_FragColor=color;\n}\n",zt.a.IncludesShadersStore.backgroundVertexDeclaration="uniform mat4 view;\nuniform mat4 viewProjection;\nuniform float shadowLevel;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float fFovMultiplier;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif",n(67),n(68),n(96),n(100),n(69),n(70),n(90),n(116),n(117),zt.a.ShadersStore.backgroundVertexShader="precision highp float;\n#include<__decl__backgroundVertex>\n#include<helperFunctions>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(position,1.0)).xyz;\n#else\nvPositionUVW=position;\n#endif\n#endif\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(position,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#endif\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normal);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#ifdef EQUIRECTANGULAR_RELFECTION_FOV\nmat3 screenToWorld=inverseMat3(mat3(finalWorld*viewProjection));\nvec3 segment=mix(vDirectionW,screenToWorld*vec3(0.0,0.0,1.0),abs(fFovMultiplier-1.0));\nif (fFovMultiplier<=1.0) {\nvDirectionW=normalize(segment);\n} else {\nvDirectionW=normalize(vDirectionW+(vDirectionW-segment));\n}\n#endif\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var qr=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.GAMMADIFFUSE=!1,t.DIFFUSEHASALPHA=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONBLUR=!1,t.REFLECTIONFRESNEL=!1,t.REFLECTIONFALLOFF=!1,t.TEXTURELODSUPPORT=!1,t.PREMULTIPLYALPHA=!1,t.USERGBCOLOR=!1,t.USEHIGHLIGHTANDSHADOWCOLORS=!1,t.NOISE=!1,t.REFLECTIONBGR=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.MULTIVIEW=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.EQUIRECTANGULAR_RELFECTION_FOV=!1,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SHADOWFLOAT=!1,t.rebuild(),t}return u.d(t,e),t}(Xr.a),Qr=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.primaryColor=o.e.White(),r._primaryColorShadowLevel=0,r._primaryColorHighlightLevel=0,r.reflectionTexture=null,r.reflectionBlur=0,r.diffuseTexture=null,r._shadowLights=null,r.shadowLights=null,r.shadowLevel=0,r.sceneCenter=o.x.Zero(),r.opacityFresnel=!0,r.reflectionFresnel=!1,r.reflectionFalloffDistance=0,r.reflectionAmount=1,r.reflectionReflectance0=.05,r.reflectionReflectance90=.5,r.useRGBColor=!0,r.enableNoise=!1,r._fovMultiplier=1,r.useEquirectangularFOV=!1,r._maxSimultaneousLights=4,r.maxSimultaneousLights=4,r._imageProcessingObserver=null,r.switchToBGR=!1,r._renderTargets=new Gt.a(16),r._reflectionControls=o.y.Zero(),r._white=o.e.White(),r._primaryShadowColor=o.e.Black(),r._primaryHighlightColor=o.e.Black(),r._attachImageProcessingConfiguration(null),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._diffuseTexture&&r._diffuseTexture.isRenderTarget&&r._renderTargets.push(r._diffuseTexture),r._reflectionTexture&&r._reflectionTexture.isRenderTarget&&r._renderTargets.push(r._reflectionTexture),r._renderTargets},r}return u.d(t,e),Object.defineProperty(t.prototype,"_perceptualColor",{get:function(){return this.__perceptualColor},set:function(e){this.__perceptualColor=e,this._computePrimaryColorFromPerceptualColor(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorShadowLevel",{get:function(){return this._primaryColorShadowLevel},set:function(e){this._primaryColorShadowLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryColorHighlightLevel",{get:function(){return this._primaryColorHighlightLevel},set:function(e){this._primaryColorHighlightLevel=e,this._computePrimaryColors(),this._markAllSubMeshesAsLightsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reflectionStandardFresnelWeight",{set:function(e){var n=e;n<.5?(n*=2,this.reflectionReflectance0=t.StandardReflectance0*n,this.reflectionReflectance90=t.StandardReflectance90*n):(n=2*n-1,this.reflectionReflectance0=t.StandardReflectance0+(1-t.StandardReflectance0)*n,this.reflectionReflectance90=t.StandardReflectance90+(1-t.StandardReflectance90)*n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._fovMultiplier},set:function(e){isNaN(e)&&(e=1),this._fovMultiplier=Math.max(0,Math.min(2,e))},enumerable:!0,configurable:!0}),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._computePrimaryColorFromPerceptualColor(),t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!(!this._diffuseTexture||!this._diffuseTexture.isRenderTarget)||!(!this._reflectionTexture||!this._reflectionTexture.isRenderTarget)},enumerable:!0,configurable:!0}),t.prototype.needAlphaTesting=function(){return!0},t.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},t.prototype.isReadyForSubMesh=function(e,t,n){var r=this;if(void 0===n&&(n=!1),t.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new qr);var i=this.getScene(),o=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&o._renderId===i.getRenderId())return!0;var a=i.getEngine();if(Wr.a.PrepareDefinesForLights(i,e,o,!1,this._maxSimultaneousLights),o._needNormals=!0,Wr.a.PrepareDefinesForMultiview(i,o),o._areTexturesDirty){if(o._needUVs=!1,i.texturesEnabled){if(i.getEngine().getCaps().textureLOD&&(o.TEXTURELODSUPPORT=!0),this._diffuseTexture&&Kr.a.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;Wr.a.PrepareDefinesForMergedUV(this._diffuseTexture,o,"DIFFUSE"),o.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,o.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,o.OPACITYFRESNEL=this._opacityFresnel}else o.DIFFUSE=!1,o.DIFFUSEHASALPHA=!1,o.GAMMADIFFUSE=!1,o.OPACITYFRESNEL=!1;var s=this._reflectionTexture;if(s&&Kr.a.ReflectionTextureEnabled){if(!s.isReadyOrNotBlocking())return!1;switch(o.REFLECTION=!0,o.GAMMAREFLECTION=s.gammaSpace,o.RGBDREFLECTION=s.isRGBD,o.REFLECTIONBLUR=this._reflectionBlur>0,o.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!s.invertZ:s.invertZ,o.LODINREFLECTIONALPHA=s.lodLevelInAlpha,o.EQUIRECTANGULAR_RELFECTION_FOV=this.useEquirectangularFOV,o.REFLECTIONBGR=this.switchToBGR,s.coordinatesMode===Ge.a.INVCUBIC_MODE&&(o.INVERTCUBICMAP=!0),o.REFLECTIONMAP_3D=s.isCube,s.coordinatesMode){case Ge.a.EXPLICIT_MODE:o.REFLECTIONMAP_EXPLICIT=!0;break;case Ge.a.PLANAR_MODE:o.REFLECTIONMAP_PLANAR=!0;break;case Ge.a.PROJECTION_MODE:o.REFLECTIONMAP_PROJECTION=!0;break;case Ge.a.SKYBOX_MODE:o.REFLECTIONMAP_SKYBOX=!0,o.REFLECTIONMAP_SKYBOX_TRANSFORMED=!s.getReflectionTextureMatrix().isIdentity();break;case Ge.a.SPHERICAL_MODE:o.REFLECTIONMAP_SPHERICAL=!0;break;case Ge.a.EQUIRECTANGULAR_MODE:o.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MODE:o.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Ge.a.CUBIC_MODE:case Ge.a.INVCUBIC_MODE:default:o.REFLECTIONMAP_CUBIC=!0}this.reflectionFresnel?(o.REFLECTIONFRESNEL=!0,o.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(o.REFLECTIONFRESNEL=!1,o.REFLECTIONFALLOFF=!1)}else o.REFLECTION=!1,o.REFLECTIONFRESNEL=!1,o.REFLECTIONFALLOFF=!1,o.REFLECTIONBLUR=!1,o.REFLECTIONMAP_3D=!1,o.REFLECTIONMAP_SPHERICAL=!1,o.REFLECTIONMAP_PLANAR=!1,o.REFLECTIONMAP_CUBIC=!1,o.REFLECTIONMAP_PROJECTION=!1,o.REFLECTIONMAP_SKYBOX=!1,o.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,o.REFLECTIONMAP_EXPLICIT=!1,o.REFLECTIONMAP_EQUIRECTANGULAR=!1,o.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,o.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,o.INVERTCUBICMAP=!1,o.REFLECTIONMAP_OPPOSITEZ=!1,o.LODINREFLECTIONALPHA=!1,o.GAMMAREFLECTION=!1,o.RGBDREFLECTION=!1}o.PREMULTIPLYALPHA=this.alphaMode===m.a.ALPHA_PREMULTIPLIED||this.alphaMode===m.a.ALPHA_PREMULTIPLIED_PORTERDUFF,o.USERGBCOLOR=this._useRGBColor,o.NOISE=this._enableNoise}if(o._areLightsDirty&&(o.USEHIGHLIGHTANDSHADOWCOLORS=!this._useRGBColor&&(0!==this._primaryColorShadowLevel||0!==this._primaryColorHighlightLevel)),o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o)}if(Wr.a.PrepareDefinesForMisc(e,i,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),o),Wr.a.PrepareDefinesForFrameBoundValues(i,a,o,n),Wr.a.PrepareDefinesForAttributes(e,o,!1,!0,!1)&&e&&(i.getEngine().getCaps().standardDerivatives||e.isVerticesDataPresent(Sn.b.NormalKind)||(e.createNormals(!0),p.a.Warn("BackgroundMaterial: Normals have been created for the mesh: "+e.name))),o.isDirty){o.markAsProcessed(),i.resetCachedMaterial();var l=new zt.c;o.FOG&&l.addFallback(0,"FOG"),o.POINTSIZE&&l.addFallback(1,"POINTSIZE"),o.MULTIVIEW&&l.addFallback(0,"MULTIVIEW"),Wr.a.HandleFallbacksForShadows(o,l,this._maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,e);var u=[Sn.b.PositionKind];o.NORMAL&&u.push(Sn.b.NormalKind),o.UV1&&u.push(Sn.b.UVKind),o.UV2&&u.push(Sn.b.UV2Kind),Wr.a.PrepareAttributesForBones(u,e,o,l),Wr.a.PrepareAttributesForInstances(u,o);var c=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","mBones","vPrimaryColor","vPrimaryColorShadow","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","fFovMultiplier","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],h=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],d=["Material","Scene"];vn.a&&(vn.a.PrepareUniforms(c,o),vn.a.PrepareSamplers(h,o)),Wr.a.PrepareUniformsAndSamplersList({uniformsNames:c,uniformBuffersNames:d,samplers:h,defines:o,maxSimultaneousLights:this._maxSimultaneousLights});var f=o.toString();t.setEffect(i.getEngine().createEffect("background",{attributes:u,uniformsNames:c,uniformBuffersNames:d,samplers:h,defines:f,fallbacks:l,onCompiled:function(e){r.onCompiled&&r.onCompiled(e),r.bindSceneUniformBuffer(e,i.getSceneUniformBuffer())},onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},a),o),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(o._renderId=i.getRenderId(),this._wasPreviouslyReady=!0,!0)},t.prototype._computePrimaryColorFromPerceptualColor=function(){this.__perceptualColor&&(this._primaryColor.copyFrom(this.__perceptualColor),this._primaryColor.toLinearSpaceToRef(this._primaryColor),this._imageProcessingConfiguration&&this._primaryColor.scaleToRef(1/this._imageProcessingConfiguration.exposure,this._primaryColor),this._computePrimaryColors())},t.prototype._computePrimaryColors=function(){0===this._primaryColorShadowLevel&&0===this._primaryColorHighlightLevel||(this._primaryColor.scaleToRef(this._primaryColorShadowLevel,this._primaryShadowColor),this._primaryColor.subtractToRef(this._primaryShadowColor,this._primaryShadowColor),this._white.subtractToRef(this._primaryColor,this._primaryHighlightColor),this._primaryHighlightColor.scaleToRef(this._primaryColorHighlightLevel,this._primaryHighlightColor),this._primaryColor.addToRef(this._primaryHighlightColor,this._primaryHighlightColor))},t.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vPrimaryColorShadow",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("fFovMultiplier",1),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},t.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),e.prototype.unbind.call(this)},t.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},t.prototype.bindForSubMesh=function(e,t,n){var r=this.getScene(),i=n._materialDefines;if(i){var o=n.effect;if(o){this._activeEffect=o,this.bindOnlyWorldMatrix(e),Wr.a.BindBonesParameters(t,this._activeEffect);var a=this._mustRebind(r,o,t.visibility);if(a){this._uniformBuffer.bindToEffect(o,"Material"),this.bindViewProjection(o);var s=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(r.texturesEnabled&&(this._diffuseTexture&&Kr.a.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),Wr.a.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),s&&Kr.a.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",s.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",s.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",s.getSize().width,s.lodGenerationScale,s.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),i.USEHIGHLIGHTANDSHADOWCOLORS?(this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryHighlightColor,1),this._uniformBuffer.updateColor4("vPrimaryColorShadow",this._primaryShadowColor,1)):this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,1)),this._uniformBuffer.updateFloat("fFovMultiplier",this._fovMultiplier),r.texturesEnabled&&(this._diffuseTexture&&Kr.a.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),s&&Kr.a.ReflectionTextureEnabled&&(i.REFLECTIONBLUR&&i.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",s):i.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",s._lodTextureMid||s),this._uniformBuffer.setTexture("reflectionSamplerLow",s._lodTextureLow||s),this._uniformBuffer.setTexture("reflectionSamplerHigh",s._lodTextureHigh||s)):this._uniformBuffer.setTexture("reflectionSampler",s),i.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),Wr.a.BindClipPlane(this._activeEffect,r),Wr.a.BindEyePosition(o,r)}!a&&this.isFrozen||(r.lightsEnabled&&Wr.a.BindLights(r,t,this._activeEffect,i,this._maxSimultaneousLights,!1),this.bindView(o),Wr.a.BindFogParameters(r,t,this._activeEffect,!0),this._imageProcessingConfiguration&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(t,this._activeEffect)}}},t.prototype.dispose=function(t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),n&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var n=this;return D.a.Clone(function(){return new t(e,n.getScene())},this)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.BackgroundMaterial",e},t.prototype.getClassName=function(){return"BackgroundMaterial"},t.Parse=function(e,n,r){return D.a.Parse(function(){return new t(e.name,n)},e,n,r)},t.StandardReflectance0=.05,t.StandardReflectance90=.5,u.c([Object(D.e)()],t.prototype,"_primaryColor",void 0),u.c([Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColor",void 0),u.c([Object(D.e)()],t.prototype,"__perceptualColor",void 0),u.c([Object(D.c)()],t.prototype,"_primaryColorShadowLevel",void 0),u.c([Object(D.c)()],t.prototype,"_primaryColorHighlightLevel",void 0),u.c([Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"primaryColorHighlightLevel",null),u.c([Object(D.m)()],t.prototype,"_reflectionTexture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),u.c([Object(D.c)()],t.prototype,"_reflectionBlur",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionBlur",void 0),u.c([Object(D.m)()],t.prototype,"_diffuseTexture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLights",void 0),u.c([Object(D.c)()],t.prototype,"_shadowLevel",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"shadowLevel",void 0),u.c([Object(D.o)()],t.prototype,"_sceneCenter",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"sceneCenter",void 0),u.c([Object(D.c)()],t.prototype,"_opacityFresnel",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityFresnel",void 0),u.c([Object(D.c)()],t.prototype,"_reflectionFresnel",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFresnel",void 0),u.c([Object(D.c)()],t.prototype,"_reflectionFalloffDistance",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionFalloffDistance",void 0),u.c([Object(D.c)()],t.prototype,"_reflectionAmount",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionAmount",void 0),u.c([Object(D.c)()],t.prototype,"_reflectionReflectance0",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance0",void 0),u.c([Object(D.c)()],t.prototype,"_reflectionReflectance90",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionReflectance90",void 0),u.c([Object(D.c)()],t.prototype,"_useRGBColor",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRGBColor",void 0),u.c([Object(D.c)()],t.prototype,"_enableNoise",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableNoise",void 0),u.c([Object(D.c)()],t.prototype,"_maxSimultaneousLights",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"maxSimultaneousLights",void 0),u.c([Object(D.i)()],t.prototype,"_imageProcessingConfiguration",void 0),t}(Yr.a);a.a.RegisteredTypes["BABYLON.BackgroundMaterial"]=Qr;var Zr=n(80),Jr=function(){function e(t,n){var r=this;this._errorHandler=function(e,t){r.onErrorObservable.notifyObservers({message:e,exception:t})},this._options=u.a({},e._getDefaultOptions(),t),this._scene=n,this.onErrorObservable=new i.c,this._setupBackground(),this._setupImageProcessing()}return e._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new o.e(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:m.a.TEXTURETYPE_UNSIGNED_INT,groundYBias:1e-5,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new o.e(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:o.x.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(e.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),e.prototype.updateOptions=function(e){var t=u.a({},this._options,e);this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._groundTexture&&this._options.groundTexture!=t.groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._skyboxTexture&&this._options.skyboxTexture!=t.skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._scene.environmentTexture&&this._options.environmentTexture!=t.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()},e.prototype.setMainColor=function(e){this.groundMaterial&&(this.groundMaterial.primaryColor=e),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=e),this.groundMirror&&(this.groundMirror.clearColor=new o.f(e.r,e.g,e.b,1))},e.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},e.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture)if(this._options.environmentTexture instanceof Gr.a)this._scene.environmentTexture=this._options.environmentTexture;else{var e=Hr.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=e}},e.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new fe.a("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var e=this._getSceneSize();this._options.createGround&&(this._setupGround(e),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(e),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(e),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=e.rootPosition.x,this._rootMesh.position.z=e.rootPosition.z,this._rootMesh.position.y=e.rootPosition.y},e.prototype._getSceneSize=function(){var e=this,t=this._options.groundSize,n=this._options.skyboxSize,r=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:t,skyboxSize:n,rootPosition:r};var i=this._scene.getWorldExtends(function(t){return t!==e._ground&&t!==e._rootMesh&&t!==e._skybox}),o=i.max.subtract(i.min);if(this._options.sizeAuto){this._scene.activeCamera instanceof xt&&this._scene.activeCamera.upperRadiusLimit&&(n=t=2*this._scene.activeCamera.upperRadiusLimit);var a=o.length();a>t&&(n=t=2*a),t*=1.1,n*=1.5,(r=i.min.add(o.scale(.5))).y=i.min.y-this._options.groundYBias}return{groundSize:t,skyboxSize:n,rootPosition:r}},e.prototype._setupGround=function(e){var t=this;this._ground&&!this._ground.isDisposed()||(this._ground=fe.a.CreatePlane("BackgroundPlane",e.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){t._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},e.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new Qr("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=m.a.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},e.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture)if(this._options.groundTexture instanceof Gr.a)this._groundMaterial.diffuseTexture=this._options.groundTexture;else{var e=new Ge.a(this._options.groundTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler);e.gammaSpace=!1,e.hasAlpha=!0,this._groundMaterial.diffuseTexture=e}},e.prototype._setupGroundMirrorTexture=function(e){var t=Ge.a.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new jr("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,Ge.a.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new o.n(0,-1,0,e.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=t,this._groundMirror.wrapV=t,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var n=0;n<this._scene.meshes.length;n++){var r=this._scene.meshes[n];r!==this._ground&&r!==this._skybox&&r!==this._rootMesh&&this._groundMirror.renderList.push(r)}this._groundMirror.clearColor=new o.f(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},e.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},e.prototype._setupSkybox=function(e){var t=this;this._skybox&&!this._skybox.isDisposed()||(this._skybox=fe.a.CreateBox("BackgroundSkybox",e.skyboxSize,this._scene,void 0,fe.a.BACKSIDE),this._skybox.onDisposeObservable.add(function(){t._skybox=null})),this._skybox.parent=this._rootMesh},e.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new Qr("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},e.prototype._setupSkyboxReflectionTexture=function(){this._skyboxMaterial&&(this._skyboxTexture||(this._options.skyboxTexture instanceof Gr.a?this._skyboxMaterial.reflectionTexture=this._options.skyboxTexture:(this._skyboxTexture=new Hr(this._options.skyboxTexture,this._scene,void 0,void 0,void 0,void 0,this._errorHandler),this._skyboxTexture.coordinatesMode=Ge.a.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture)))},e.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},e._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",e._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",e._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.env",e}(),$r=n(42),ei=function(e){function t(t,n,r,a,s){void 0===s&&(s=null);var l=e.call(this,t,a)||this;l._useDirectMapping=!1,l.onLoadErrorObservable=new i.c,t=t||"photoDome",r.resolution=0|Math.abs(r.resolution)||32,r.size=Math.abs(r.size)||(a.activeCamera?.48*a.activeCamera.maxZ:1e3),void 0===r.useDirectMapping?l._useDirectMapping=!0:l._useDirectMapping=r.useDirectMapping,void 0===r.faceForward&&(r.faceForward=!0),l._setReady(!1);var u=l._material=new Qr(t+"_material",a);if(l._mesh=fe.a.CreateSphere(t+"_mesh",r.resolution,r.size,a,!1,fe.a.BACKSIDE),u.opacityFresnel=!1,u.useEquirectangularFOV=!0,u.fovMultiplier=1,l.photoTexture=new Ge.a(n,a,!0,!l._useDirectMapping,void 0,void 0,function(e,t){l.onLoadErrorObservable.notifyObservers(e||"Unknown error occured"),s&&s(e,t)}),l.photoTexture.onLoadObservable.addOnce(function(){l._setReady(!0)}),l._mesh.material=u,l._mesh.parent=l,r.faceForward&&a.activeCamera){var c=a.activeCamera,h=o.x.Forward(),d=o.x.TransformNormal(h,c.getViewMatrix());d.normalize(),l.rotation.y=Math.acos(o.x.Dot(h,d))}return l}return u.d(t,e),Object.defineProperty(t.prototype,"photoTexture",{get:function(){return this._photoTexture},set:function(e){this._photoTexture!==e&&(this._photoTexture=e,this._useDirectMapping?(this._photoTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._photoTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._material.diffuseTexture=this._photoTexture):(this._photoTexture.coordinatesMode=Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,this._photoTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._material.reflectionTexture=this._photoTexture))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._photoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this.onLoadErrorObservable.clear(),e.prototype.dispose.call(this,t,n)},t}($r.a);zt.a.ShadersStore.rgbdDecodePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";var ti=function(){function e(){}return e._ExpandDefaultBRDFTexture=function(e){var t=e.getEngine(),n=t.getCaps(),r=!1;if(n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(r=!0,e.type=m.a.TEXTURETYPE_HALF_FLOAT):n.textureFloatRender&&n.textureFloatLinearFiltering&&(r=!0,e.type=m.a.TEXTURETYPE_FLOAT),r){e.isReady=!1;var i=new jt("rgbdDecode","rgbdDecode",null,null,1,null,m.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t,!1,void 0,e.type,void 0,null,!1);e._isRGBD=!1,e.invertY=!1;var o=t.createRenderTargetTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:m.a.TEXTURE_BILINEAR_SAMPLINGMODE,type:e.type,format:m.a.TEXTUREFORMAT_RGBA});i.getEffect().executeWhenCompiled(function(){i.onApply=function(t){t._bindTexture("textureSampler",e),t.setFloat2("scale",1,1)},t.scenes[0].postProcessManager.directRender([i],o,!0),t.restoreDefaultFramebuffer(),t._releaseTexture(e),t._releaseFramebufferObjects(o),i&&i.dispose(),o._swapAndDie(e),e.isReady=!0})}},e.GetEnvironmentBRDFTexture=function(e){var t=this;if(!e.environmentBRDFTexture){var n=e.useDelayedTextureLoading;e.useDelayedTextureLoading=!1;var r=Ge.a.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",e,!0,!0,Ge.a.BILINEAR_SAMPLINGMODE);r._texture._isRGBD=!0,r.wrapU=Ge.a.CLAMP_ADDRESSMODE,r.wrapV=Ge.a.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=r,e.useDelayedTextureLoading=n,r.onLoadObservable.addOnce(function(){t._ExpandDefaultBRDFTexture(r._texture)})}return e.environmentBRDFTexture},e._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xuy9Ccx261oW9q5v/r7/33ufgalSbWtiTJsmTZOmSdOkpVKsWhxAxIJFQaCKUkpFiiBFKjKPh3PO7hjb2LmNnYxtjbGtbY21rQGkgCgiIKPMM5x99ruatZ7puq/7up/nWd/3bzzABjb/9675Xeu5hnt41rv8s+evW9fz+ZT+W9N/63o6re3v+nlfvq2CbdZT2hbW7dukDbf/a/9uS3G7E69Ln9PifK50sHSMvD2ur3+XY/E2++dyPelDPoU7Jm9XTm2uab86vJ56gvSd80dzXflA+Zul74PHwGuGv/MXLv+kL4Lfp56r3DM8ef6utE10Xnu97fra7uWi2/etZ8BV/F3F+fdni/8Dn9O4KSvt/cxPMa+HY5Qx024OHF3cM7zHdcsy3uAeuu3wPve3S2OVthHH09v5e9BuCT0HHgPlHsjz+3uxNALYAJ9JgAigALyBmQGPQEcAxwRQgVhIogwcIoAG2HYsM1gR3IokEDD5biMBhMeSoLXkweCoAxsGcDoX3Xi3nkCFACnfiQaPARECgPaVAMZjEuAsNttAjIBZSY8HXHkuFctt4Npj2e8+B/ImFOnwEcg9SPEqcNdyDBSZemwipBkwmvMwocG9Gm6nCDUisHpb+iSRTp+2kQTQAJ9cACt8cwRN/Ss5IJBJ7a2qC0AHYK4gUkpuQE2uoTiJfMPw4epjeqdRXYE5Rhu0me7aGCwIKtfFD0sAmklCgWBmG3utbfCrfdtlBUpK6qUIpwCkkUYDIg4yp4QhAeW9GDBwLR6glgysC8PvZq6o2MJMT3jdhtKqI0WiMfeTCMhs54BqzwNPyLueclxzS/3+XQI0jtSSQrmly4ecv249Z+U/gQOoNj+HBKj+yhGEtn9/2C10qLaWLH5Tz6KykeI3FTb7wM0uRJMWlZtmQwgXFgAr23VwDGRjADoPOgMIQ1pigNdnCrbviaqvFMopuDpvHjB8/RXoeI8ydGp4RAM2x13NzQtr74BkQoFZlceBDQTugIlaixa7kbn5nl3wNgVNpxGKi2OvQxJmjOJ24riNB/sKX0VJPS/zjNfTTgAp9s95AIj9K9DPqPQc22+nS6C0eYAGZJMLyF+sPPwGVggXypcH8HggA5gwbCjHhy9v1Z7yDIY4Gie3nIMGrQHUUNVBVeq14rnyOeiBvWjVl8QgQoZ6NajErESk0n0wx4CLFLuXJ5gOE4J8gtV4cW2RlYbvrO5lVWMk10KU6lpwrHbBr8cHn8+EMdH5YPl2H4gANhCmPEABLTsBp/5k+Y1TwGReWlGTgqiy6WFrxXcEQQTilLw8mUP5AIh1pbJnTgUrOiYIVBZKMAXqW7GISigAyjbYgkWfyyqyTTI5ZckLokEehQNxAs8TYMHF8X3w+3kSrcc1qozPAsAUqbfLX8B5AKgyFGBidOcIiB8JAMdZWV4fGak/nU+Sd0BC266CANbTqdp+zPZHmX9Uf1Txju1HxS6DbeeAZtOtavtKAILAhw9B1aCNjhyJELDZrldlFwRB1YT2nJtUNnVTBPJ41Y+dAQwOE2eD6+EBWZ4FDDRUFmUn7ZiLzjkgGbgOTTTintG1y2QiuKh2ZSKrLoDDVt4RI90jc28CMunnC/AK27iBhEB+FHgme78rtk2w5b+vcguSAKLyH5YCfT6ghAgFeAh+H9PXBxcBPiKICjo4fnEE+ODLk1NJQ7M9PACXK2iqgTa1DTpPHo59FYGgNZuM9T1AoBphFMIPIhXPMzG1Q/jBVYceAobVqCElHYo+uzwBPKvGyXBuY1O9YjZBQzOP312TK4PAVjDw/Hn/p5CEJKI2puq15C/jXFz7kiZB2CPLckzzzIPjlMtbPuT89WtK/rUSoOkFMDV/KvflEp6pCnCtH614yRPU0AAScxjvlwGABFFGlgQ12MJD+QCt7HX88bEE2aRFFnhGOdBO5hWsLDOx/mzZT6meSgAa9cLrYnA6O0yqxSDpbG/uFRAXwDWPYUsG1s2Le91Yp8CJsK5VM6wYUJyMGLLqjESsCcykC80XsddknltlRSC/fL+GBFAdXXw97fDrafnnzl+fG4FyIrAAPggD9nsTNQIhsLfziwqAVX+r5IcqAQKMxZlYUBaSQVUog4jWgXJhCGKah1QlQIUDZlDSQCm804n1+6rfQOAqEALA0SCMcwdeqZyqONKIQBsAVoBWKlcvRKnq6YHSKmAa/LJKUZFBJMf3tEdeJvmGY05cIx1XkXIlH8re8/J0SeK6I3LMvQCSAHQYULL8OhfApT6X2BN2v4YSRxW/Hivf4ALcScuPAx9JxxIHwKY6AXiIfC5+mHBNj63rW2cAwyMiDiQnygJ3AQzEZ+6BG+iCGBQ4BqD1cTHlKFTJUA3kyi0RyHF8EAAVWOg+vBCSqLeMFFnct64jOXAcW6SM8wHbLcgEUNT/3BKA2BJsWnoFAahKgGv79V2Bs5WAWkbkHAAMirgnoA1ajN8REKHay/IesCzkDdrzfMR6/B5moHuLORMu1PtKipbG9wGldsSgQVSpqdkWECRtRcPyn1DQGTVvl+rPh7pYOA2tvKxE8DOBJJuq+4/i7rj0SKpN9zA9QpFQbV9EtBxbZ1uPUcYDuAlDAEn5z83i7yRgld91AXZiftMXkG9oAartCqQKQOgIhOKHMX8elsbWF8mgdRSnm0QfJry4SoCEhAwND9EMjFE+wCXXJlS/o7ZK9RXwDhNDl0jsgJ2r81cpz8a0MpfrkJNA53sQqWsHXI8mCXZdCDImRAHmuvljjiO+Z+0FUG5GCMLy6/YcAAB/B30igdOZ4/2dDRJBIKCNQyggxfheNfn4kh8qsSGKei6v5l7VDyQEcSBzWIEKgDeTtkubWQvKg5StfBsXI4DDd2ky2EBirkt3pw3BXbFnQdjGVqSoj9weBi3fB1QqHyaIe0FEZMmmnigfNqoYwDOge4zg1AovQhcCmflOgjgbX4jrCLavWzpCa8/EOQ5xXds2y687f0ObDchdgC4M2E4wqAQYYsiDcrcRDSjVRRiQlQds/5WzAE3mHSoJlJGfIoeW8jezBDON+R7/URIQE4IyJvcJQT5XSzqCLhHJtOFN9pBVh0iil5U+5BhUnM6qw3G2UOCo4w/hkNUGtDWIa3mOgVC8CsjhtVhSN/c7ALl0J0Aqs6BkUkASUWMFiapFKoLwRCgBBJCUf9wE1MCswoEKdOcSChlQf76y8PlOGkeAeYZCMkwg+SlJ4PfIQal9uQZULKW4sAxVi2N1rr2zMusyXx/cKtZXqtrtFJxQ5C4xKBWeARc7D6F2GlAQLu4j3zoRoEwXPqRTkKMBMJt9pWLWAZbX2mON8gDTyTl4Jgbc7lrFd8HxiPdH3N9tkSGAU24DtmU+7gYsTT8lHGjlPhPz13gZFV01BWUbpWr+tazYyMOoI8TkCKg4ISgUtRIQcDwk9xhQ0u4jIQHL6m0bqDn5xANopvZ/vMZfvpGoYbscRNWbLEITA55VGMhAkZMrsfYAqQa3JBsgBiKJUTKuOg9x3PBa8ZljsjCqZojlqPIy/CFCMg6pfEe6ZvNdA+JbPrSGAG0egO36C8p+KTtYe/ttGZBzBKz+uv5fzotMPQLz/r3YRbhqAYDOgdvnDDzJIPNb4BxK8kX5AnQghqk74cJAubXqB7aWBodSMnU8Qw8MdHPMdv/cwOUEnhvEvnLRxnusgD0n0AM5CgmCMp1T2epj9ffu8XuJQFLwEZH5Z9OIH11FJoACfnohSNDwo63/DBnkyyo5gTDbv329AtpokhAOKtq23shiD21ZxIUW9VBwHACYsdomk5+HEiiTGSQ4uCsggqYg/L547mJyMZ5mNqdKRc0Eq0HDAMNrZyJS5SfaXlpqvEfRwOXjRKrIcxoitWUSI8WcUth8TYY81LPoJQs75+2SSM9F0DUYcHfcRLvFgijzdyAC2DL/rQyIQEdXYGYE1jKgz/Tbkh/Z/5QsqH3jBpQqL4AM3Fmv3QOFEDgoe9l/tZ1RAuEsROLPKo6v0VpVoGx34bBDYBxUD14EMQwciGp+CgGggMeOgq45Lnd13MZR8gjAFfYNDBUcoYturN7MmtMwTolJOoN35Ca6oUS+1uVDz38tVQFKAhBagBvQC1gpHJDgB3vPiUAX00MG38TzXtGl1e/lDdJoM5l9vGH4EF03IA+UMkBRPY0TgAcrcgpISra7TOUDhKswpBN1zen9npIAVANdDjrOHQycROMOr0xy0KrjT4C5FwO3R6nU8RHJwgN5AKPgh8EN/iRKaIJDafeAvmf+uBNAUn07GagP/jLYIkIoNzB2BVb9i8x5R+DsugFj277adAYrzcjzFQIkCkhYssIpYKtOQUkedI4qUlXeoQFmPkloQhPhPIrtVVZQgpsHY5DQi4A1TRiVw/ygNMqnnErPDgsw9TLz7lwHbPhIofsE411geVYtgtDEhFUPXVZUY8o7jMQR62n556sDaM1AUSlw2ASkbH3JI1T1hwRhecBQMTAqraw+EYCNz2dife4baDfHJRyNks3affEAYGCyIk8lEVlRZdKunVcBVA1YNUiniIE7INmhUIwMmmVKcxFIFGGNMvDTYMZcSrnO7BbbRzxae+6ufViQUZR/wX2738WFVoIICgYKW8jvQd8Bt4Xx6Aggeh9AHPejamN23ycF7Qs/mouoFrmC264z+yEYOKPP5ABZ9y64VYJOOYfIFaBSSVeAmWKRA0DlEqpbH2XFePkjHqj9TH65v6gMKfw0lpHPpxS5objAaP5FmjOhQ5PEdnyRhFMEV3cdJe3w/uNZguVpk6AiIPMABGJ1X0ffyZDUCNwgavB9SviJbiMTQGkCyglA1QFI8bypBHAuAOcHRK6g2K1uHK8tvrTx0/kAn2TD47Ux7sOB+shrdn8yhqfKASufBbi2h2FPQX7WXdUPiCPt6hUujXs7aB9VGmTnMhrkADgmPaO+Qez72CafOfdQb6JO1Kl7xgpNhDIq5Y3W1+cXOJiZ9cuH7SEA9gCUeQC5538v2aVLUZWApt4JrOkhROqPDoG2LczZrQBwchCYeBjrk+pB0rFlrGEosLswrD/OFdT7AgqGg5oVy5NLRXZ+vAKoA5C6hBreI3YzNIja9Qg1AdVvY7oRRpQl1wAVDUk9hVXKq4gDvh9/g6LgziGMQExuxwBMuIUeifVast11dZJ9LCYu1IDxh8pf/l4+7PyNtQpgfxUoE0EH/GWAaTdQ1EWECFV1RO8ArwubeoISotjfgFGp8UDRe3G6BK4KKYq5xhgUH6wAJ6s6D6gQpBznsvLwgAqsOEK68YO3s5bMhD09AlACWQQi5VIM0COwiuWjmDx0FjzvgxW/13pcSnnm2dC9jZKl5WGIHhFNACqPkc7lCGCU/TcuwLmCMeiNQzDg7gPa234RHqBysJPAhxG6hbhfwKgpxfkxMAHCgmTUwJtOEiqVrC61/EFg7Ci3AppXF9Atdh+kuFUdFaCFojm3IgECEBeK60kKAHUoZhfuS4B7lAcwKh8kHHUmH0u9nhSqkjviFgRiXI1fXwmA3wWgG39aP0BR1aPqnwY9WGhX/89DsRsKiPZfyAHg4EOlaOAC8jDEAKZOuQJUdraYUtl9vkFZP6tmgyShUB0GD37PSLldTG8SgA0AQ3VXRAT3xrgIJiiy3CoB6UDEJNa+YIYoJeciRxERlrPMMCaCZKLKvxSQmu/vzhkkEtnBgeIj+PHK6nLcNpOkeYZ0rOXX1xCAXgZi2oCx3s+WPq8zbiBfmgE6lP/KhWGcXZfBvji4iBAkmA2ZEIvS8QuBpfthldqqIZUWYdA64OLgRIUS2fUjrgEJLSozuUQmgUu6jXAbqxSOLAJra++HJ1McpC9K8Q8fRyQ9DVgDZ6G+W+WKSgxarVWoJglCnHtEIJVTpkuB9hozAeQkYGc6sCkD7oABN5AHeHUDBVTlC5mWX6X+jRwQmCVcqOUpTtzV4zfrjsAyYQMCV8XonbLfbPa/PT/rYurDDkkBO8/INeQnzOpolZlUipXWKEE9IDQf2az/oQSgIRGtvt0KRUURfiMYpNWJtaGO5SyrblSVKcfu9SWMzl9DEQ3uci09lY2Sn4ZAQDzqZZdzd8qY+OQrwdKxdJiR7tXy68//X2sF3kCArwTLLiCe/PMY9S+jEx2BBYyr2e+DQOQITJ2/Dex54Jfz0r4DV8AAQXWwyq7sPHK6Tc6MrHy8Pg8DVhAR9w5bgyN1V+oULkOw4rXZ5bpa4O/ZSKGZeJ26qnzFvlGrKjk1N+sZZoqgAoLo5R4UuTNpmVKtPgcLVCWC/B2ciwDS3gmgtgLvBJB7Ajrgt/kBTPwBkKlvIJ0zWF8v6A1KBIaVgTYgfaNQ0C8gyMEMD6oy1DME+QPnGsiiIrnU8wDDj9aPzh+pUDsFERYMHv7eJjwZqa5UdgzbiEQiIA2TewFoRCIyJhrhToj8nMqO1rcHA+a9XKslGA9g+508AYr1GCLAd1/+BXAAGwjw58AR6M3ed6x/vhKb5KOcQQXQRE9A7ari+j8QyUR2P3QEMJhVlaGJQL6hLkywKoKgsU7AZs8ZXHbboHKgBgwmKqMBxZliBbyZBKDscAs64jjnkVlGWWG+T45EgOwiwmF9xiYmDUzqeETVVSVRhKgkDiCIgFh0olCQaxl0ZmwSGdbrKTgYrBfHLGQHBFC6AakBCJOBEPcnV065AEwEFqA/QvVVCIBKZ5xE/nLVHnNVARUbB7/L8nMeQrgDAQKfjGykYHQDHEAT+UIsvgUX93XlJgFqoxKiPDSTyFMJNbmfcikiuabAzddpwTtSvn4LrrpWbvIqAx+eLiwSSt9UwOZMRNLNPDNa71UaQatzJ6b7kUBfL1qRNwIer9q4knS1mQC2o9gZgbIfQCT+ynYtUUd5AdMViKQRdAIa1dfJQZkPeArw4cZgXBqWDYGd8VraYhjmLuGo1mUYmAdkE4M8gJAQq2ry/hTj2n3QlSAcGilFaqxUVS/zyuSB0FfPIYmMlLKj6JbwgHxgRgS3RHviCPaTBGG3rcajNolZUnDrAxvfnqQ6vsqptO2W33D+pjVNBW4EMAX+mpgTicCB+isAO1U3vf0+BHCKT0qPA8e4B8wH4OCJYvSIHBhcYP10M0+5IpX4U27DNiXVLfA8Nc4m5arPt8AyyI5z9yHeQ1CR2BmIwa9IyBCmrezX17mRarXsugaNTiBqUnMuw90fIiqZVwDiFm6nKLJ1AUF1xXzXvAfdt6b+9GzpXsq8C7uPzrGJAHJ8nysBhgjodeCqDFjdgAoFirJHGf2q4FAdEACtpcEg9m84toM/zgMwucBwCcOE3ja4DocenKehOQ8FAdD80FgBR+VAsz5oJXXVBGnpo9IgAaHIlEzqiZJm+cYAQgsee96oEUiXtqicWiV0UFkogIzICwEb5DdGuQv3Pei+heszmKOKST2MChGUWBA5VAIwrwI7l5Bgu6HnWoKzbcDQHASKb+P3fqJPdwQWRmTF7FQIuurPwLPHxRIK21NPGn3gcznGOQ8kNBp0DQ8+HuQEEqtMz3HUKzZOJjOQUsIjQBYOQg1Uc71MbF0CadfplLXadOuompaDc+BkKbkNXaf3eZlCVPIc7CzpHI0g8nUJVVbfsQ2T8n2UI6IxI1xCdOzlN9YQoDQDbe8FhERgbt1V4J9OBAbqb/IGBGIdJsCtL+xmQgUcMAeB784/ytzT8XF/UFRHMNW22wHGCSwNavH9m4fQvw6rADeZ9T+UAKyXpgajzrp3yWKkxhVHHhBIvDqRZgmQXZMBemCfdVYfBIJzAJnoXJs2EIUF6YjY7Pdmp9gNIeDaMgHAj4PWXoDtkEFFQM73L3YvhxGh5QeFB9uf8EPqn8MFta5lxicnBWFyUYAVb6AELSaTEECsmAQu88B761JbCoDY21a53rgKqy5tiMCzKYqr5hQAOcnYUtnfIAutEmxqkJprNM+lkV0BZEhITSYLzGCIE1BCQNP5Bq6Bk7+Pdwd4B5Q7EOsFuTwqRNheCZYcQHkbcHshSCnxuV4A/jFQfBlIeYBmYk405dfH+sZyF+UqD2yg9N7Kl+FGg79Ty4+B3x7MlKJTEonBgAPZgjpI/HUdxcgV4MAOSKVnXwXo+ZpN/MrJVACnsqHqWPCNAFeQ0wESa7dGOQEPKHUNVbfrIQJ1LeeVYZK4z4bQ8Vv5a023KfiO+R46sgzcZL09kBeI9l1+4/mbN/mHFuD9F0HbLwTz36jsuQ/AN/6gkkfvA9BqX8Dis/xC6UmJnYpPrEfTZh6A3Nc/JLTqbO8Q+EhubVwASdXxYZOX5vqGMwEVwPuuQCWfZJKQBvMoL1GPaxQX9pIJqpjMKvakSxGACpxJlFTUSTigC7heF88XkgOCiIiGn2fbFfco32eOiKYqAeIat0XLbzp/M5QBs33fQR8QAai8aQTC5aYKgKFBUThUf87Ccx8BgM6oNzkItPjFPTCrKhuP24ZhAgGfVLGr6KyIImRQg9JE0nCMxhNtkDThEoNoYj5AwyjqBAxCvG+gvjFRdNQuOpZQS6da/KzwWkid00ehqJ0SnwPtTBhQgEXuISYARYLBfYfvh3c0x4p57ey+QCYwnoAASuafp/4CKewAwex/+Zxv9nZgUb8vpbum7pFDyF8TcgNVI8sorevK47UEg8ozCgvatqzEVoWdsyiDC9RNq71NJFq34bPMdtAUxwN7KdVUdlTZ9oESm3MH/fXOxaCq9MDZBUd5fm2IF/AmTrAqaIBAoDeupJbP2pgyxz2YpHNkVMVCX3ev7DdFDkFZ77H78rMrrmEngPYyEHgNGAK9/G1e/rkdEsGnGoJoPbkESRZGhZV7sIBI4w4AjAPRxfvgNsR+mA02gEbwUJwW2XxUZSQQHhhORTtq37Xdw1jdKw8PJhfCCHWzRDGX3VfgmU3oKVDX6hESEDXq7gPckJIFKj7rxgXGdxmFtc8Qj6X2IfdBBBiSQyUtrdae/Cw5soBUA6Fe457PtfyL529JIUDOA4zj/5wfcFl+Uv8Cyv1fPyGIXUF9qJzsK/sX8kDgvmjg98Dds/ITNp8HHD4sV/Iz5ASDbdrOm6Nn4dMDdQR6c91RYxERhVbi6v1LvcNodK8jEMm0qLgnlQw643SM56rnLeQQqam7/nwyvhfhtcgkYQ+s+Iw1qfq8g3JGR4ljPVUCaD8NHrgAUv9qz8yEoPIQAPR1fRz/s5NA6yfXdeL9+sghVJBWf+QUCv8juGFwNUs1b/OtW4hLfiOVta7BJv6G+wK5WHgoK56PRqDqkZkFhQU9g3Zs7wfhwahsicXAA0k8b5c7RIJ0NqX0mpyNWpOzKeDvJSoRM7h9OW5EXjsB+IlA7QdCqyPA+B+TfEgARaWd+peBVKgUwoVyXKfwvvMvjUNyFEYto3xAuek+BEBr13IGloVtOFCecgA8zj47V4EwaPfD2Ds+hrBwOEhZyXqOYgz6QtRsOK26uHNWMIrvlwd0e35+WNZB28s/IDDEPZKKPKveKvSiONw5BnZ+AriRy9AvFBXkQLmK8TV4Z9AjjuXDawiQmoF8CHDOoZRN/tX+gEoMj1P/FB5YgnDhgWgSUvuZUEMQAzqBpwMfHoXLFtsEHrNzE1TKUsvqAgEK1NgMF1I4BttItbsJPpOMixVMkgJcL+totbXDRF/sBBQg8I4VUmA6a+cG+w0AlrkHcR+c46lSHt+n0T49wKLzZKW398ITgXcB62n58PNf33MAthcAMv9VcYNqAMf3rgowjv+bwgrVL4MDlLRsL/cbAL8OQgSb+duCMp4S3Oxtcw68Lw675j56au9jcmWjtV1HYnFgm+jbj52EGsyjBKBSsyISFnSPyhlIex+7D3zuSArOEWUAPzpJSC6l3aUeIPF+BC6g7k6iYVzH8XXLb84E0H4dWLgAsP9NnSnpp0KEieRf2P4ryn3KiiuAovo5q6wqA5k0pCsg++1i/4w6va+107gNDzzMitvtKHlH1rer3NyRWAZLHkyjBJ9TjKjSMJNxD5yLUUPlYtQAN66C7g8DePaYBrgBCB05WOAyAbfEnQd4RDwtQekJwycCJ4jDuBrafnspKBIA/zYAv/EnBH+YB4jVv5f1d4pq1L+M3sZ2lRhggCrga/UH1uxYcEM09T6O9oXH7MIEP3XVkQsA1g7J2BU4YglBP1JjbbuVMjoiyYRqwG2A7PMMChBMmH01zQ8lJJrYkdiyYgOJDgM8Idvv+QSlB7JSdj3zD7yuZMbmw/ehPMd2PysBpNh/awkusX6uBvCEIIj504AtMTyDfWYOACblbAKvHtuAAFwHVQKUDe8n7wLwhkk7aEWmiTvTIYBxGp4cTOynLLtLOlUpd4PCVhzsQEG3YYGn+9Hx+yE8HMA7A5hdzWOPo67XLVP19OmQge4VEddjkncezNS7wudQHYyQkORQbVglMC7VuoDlt+whQJkKfLZTgWuv/xYW4Cu8EPTb0Rns21dGQOdbMFEStIm8OKtvjm+ARUAVZTwXItD+VhGA2CoF21jLuwOKRTlMoHp6D2BmrgFl2lmhXJkRtscrMoAR12bXazvMdtcOSriyTqZ8hhQcUYgwpKfATHZRgo3vT7PiFjBehe36CJz6nQMqfKGxY8ihF5rkdRQelXujCHdbtvyW87fWRqBUDoQ3A7vaP0wSUrMAwzxAuTj8t5MczIBM/2SCQZCinQ5i+sO5ASQsJhS8HnYk+bNT3CrO5YECmeVR5MKUolz0EC1h0YCr46UMjo4rgO+hgBCGIK7WPUsKSk1F/wMMcme7a7QD95FaiUys3S3nIQzstT0pDDDXb7+fJwx1T+haypgSzkCRswW5vU/9dWsigNoHkJ1AfSFIN/lX7H++pAN5gJpbQIAXJar/ti/Ssv4wyFG5wFnIUh+WETlhxbF5RCiGBArIyAmoZBiHFHUbfJR9cjAPvVeSU/0DHdAjafE58D5GgxiJqausQGgqrjbLZB+AVso5dRfVisBFSKse2DVzzl4AACAASURBVHG+d6MEnXQYBuiW2I1iK0Ew5ABYKQ+Lehii/MnyW8EBtLn/KRdQau2+5l/WlWQOhwQ2XDBKzgB3YUG5VF8StOEBxFHkCOpgDpJ6VlExD5Fvu0wmwkDq5QmUWyDQtudJqk3TfavOItnhoAnsdQxs0Z+AjSZRqRAVbjAY0UVEg85+L0sdEZAs2RB5wqBHb5IuOyCPACh2//yJvvNjVT0kGHN85VK8Q5gjq57bSOsyAWwjPs8HKEm9Eg5so8kk+loizlcFOO4/lgdw6l3IAQEkljkrLVW8PMzYRbC9MrxqQMiKzQnC4hCs+sgYPSqtuapByaPoARIm9vi62T4LgLSchAKaB5QlHLG+5iLmgcv9ENahoJ62p1R4augyOknCI7F6pOrq/E28OkpPqv441+DJwpNqu2fLbzv/jTYZKHoHwP6EN4IojCqmBHPSrwzgEsO7z+WR6ux/U3FMILJCU4LOOAGt2D5WR863wI6Se2HWP6iHz+QHQhC5EKLdA1ZY7Rj89xvF/3PHVUQEy6AioJyAUbDJON8AonIsEYCZFdghiumuPrp/oduAc1EeIu1iw8WyLCI2v/1YzfWxjIzBhKi0tSGAWgoE1Vf2Pylu3/bXLH0lgDI4JjoDEUhVwRQ4SdXREncU+wiw02EC11CTdnST6/YKEDZDbodXGdWBiprvBI8bwMbWUFYReslGHqwB0PouwcfdTE5IHxYgvKaFaGqf4bJ8z4bbgfriMzEJRoyrxbOIvscbkx8YKD187/A7bCHA5gCO2H9j++nloHZdnAdwTUC9+QAVgOQEjM1v7GrUtpPg06oMLC3zAHo95ibMQOMchCGTHjkUYmvbGEUgxeyp6UhpjUaaQROAOMg7WPUZ9BNUC26/X8uPsmqp+yAciAG7B4iKm8NldC+G+QxwBvOqLr4D5mTYNXTufQG5cnfdEOAj9hAg9QHUMmD9bFXeuYFi+00F4EAeAKoAM6RQkpL1BiPAVL4AW5FZyWViDpR+Yj2/xBETYDiwHNnk5262EdeH3zO00ex08kB0eRFshJnpDyhOgJQECcMM9N51sLrOkoiK1UWi8gg4jboLp9ZTyylnYBwUEVxQTj0GWrzrjSgr/7hQIwoB0vLlI85/s00Gyom/NiMwzwswNf9W/quhANf/XYiQL9pYaVR0tPciJyCBPJcbSLiKLfzICYzW4/HNgxxVCgTAYtLQbsG4jV55sESgFb02HmV7bgc6JTLrSS1ZpgHIce6g6jAJ8BnlDsFJ8fiTEoSkzvI7B0QYq3AP0D4UHIUT2n3g3bGksRMAhgDoAvS7AEQzkLPwg/ZgtX1WwHT/tv9PBIFAzuvH4A6AT6HBKCfg1nPTkJswVAgPIZpvfJR1FwMndBRFUUXyDMHMoIjtfpBzEE7FDjD41MtDRLa23BKqWc8obTsdK5xV3dCxKEcULQuIs+cWIiDy9TyOGHx45kOAdqZuCPCR2QHYtwDTjEByAHPlP1b4WPGLylqlbtvXmwmq2pTZVwIsCJAELCF0bToBshET3PygycfyregzMGpNCpvPa9WlQyiVKAXZwAwBk8jMfvFQwrCQDhJ1B0QGxL1SY+Qc8jWq645UkJ1LlEnnigs7qX4Y0AOWIh+7vSK3uRDAHvuo0kf3YvnI87eBA8DXgQEJgKV3th/yAC1Gty/5aPsE6l5jefE+AFNa65TpyOa3LDUkCKW7gMfvYlNR31dKzfup5J9yDfXUbMkHbkGA0JCOs73aiaiBb1xCvV+s+0CkSCZAXmy1GZyj5GR8be4KTWkLcx+VQ5zDmAPxTOhhibq5EXP9ktRniGFG6Y8Qg72+7ejLbz9/m58LUMuA29uAfMlPZvupFdgTReshwISfU3eXzFOTe1T874EunYABq2jogUFfj+gAzgBosW7XVRS1M0DpE1C6nHiwzIQJrDASjILYlMpE5xsCNmp4AnAitJlyMCQsoBsRmAYnHnkMQnYysVvokcr4PHMu4MhxPNj5/hoCaLG/sv+cDMyXS9n/Rgz5JpdYvgwu+bkdS5MBHkttC+Ymyg2QYvrEnlBgAoTO5ItkWtj7H51DJdkEwVQ5E4m2TCyNu/z+zWx01nFSTrmdXpmKWpm9b2CFFAO6Q3YKJP2kHsIXzh02Hr1IZzCTwDsC6Mcovd3HEn/6tHwUOIBU5qMXgir7X4G8HSQnBct2FWylZbjTDgxlQB3Ti31Nwo2n6qJb8Ouq8whKfO0GCYeh9qm23qvKVOKwALdT17fEg/qjcwus2tH+JibsJRO5dZgSnu58QEbSQYD78XGpt7w8aNm9pPGHA13bZqV+0gkNrj9SanVd6vu/cUpPY8N8D036uwP4qPPfCsqA4oUgNXtvW4Fr8k4QQ+KDTBQYBxelFJbf7IMq1N22uANOqtGXl4lEdhHl0c2FCO1644TeODRo18/AwLgWB7LVNyYEPSA4e26uq7iMKF+BTiOy7k+y+qTYxoHEA1wp2ygHESYIu8DxRL8nDPND8TkD7QLU9U4Rw3LEMVi3FX3fnQBaGZDtP/1GQFX5pu7JNeiQwAI5f20OA5RzYLU1CT6I9SvzdyoBhoCorTdQ9XGIQMnMPGjS5YzDiTqMxACvgyNKJPYqCAjQUd4gg50n3dghawdRS6wqpY4HpwQjXB8Dpw/eHqg6KiiJyV6zVuzHO4oIdMr5jLdFlxMreuQ6zPJKJOtp+R3GAaSOQN//r5KBAejrHAFeT5+F/S9K1xKI+UsL1TbbFgBGlQDTSOStcwGu4feZikAH8F5ZAzdR4u4AEOraWC1kfgJLgNBTkXCvYN7Abs85r7zRfi/C6jfy4cGvVXnG8s9c1xGw9p3IWL29gwgch3mGkdLPEcbyO87fLhyABbyu+2+XyxOCbPkvxWfZ/le16+UEUMlVyY9cBAMQiUKBs4YiwgmYcmO+8dVhRCFCISgcJgAksX+6JxpUbTG4HLbdxjXgMB+dN1DtvJskrIgsHDnOgdCdI7gPeHcUYc0q9VyCsOcCYgDOHLvEBnPEgFsFzmuinDl2EvbYy0efv92XAXcwxMnAAuym1CUkwFJfIgi0xLpKgM6gAC8CehmtCBBSVswTqFhWEREO9GELbz43uo3qQPyA8fE7KRiTVs3Ee5JyuYEpG23bce0w44HmCW2kknZwl2epCO5Y2KBiYh8qtOsdXedTiOTFuwAdxmhio22X2JE1wvGuIDr2TgCuFbh2/gEJkNrLWYHG1mflr0osSAKteRjnA2CgYahl9J9QCSCCqjdJxd8E+C6wjzQCkT2PYvC+zS+E2bPr5BaEk+jF3gZ8naoFq3cIWraxg0qEGsCjXIHdp6fm1i4zqUWqOusCZo93hGimlR7ifeVElt95/tvZAbye1Vr9OCiEBJAI7CYATdyeyQAAzJWDxBOKNMpXpfCALD5P+EkPB50EaIpRXbtN3WoimVdvaAD4ELTC+hp7bNYLUKtrG9h1b/GDMCQ4t3MfnX6AFq8HjijJsZ48BOseA3qkOa16PSdCJJmvcfY4RwDs4/04BBgT0NGQoW2/E4CpAuyqHGT/tynDGaje/mPdv9lkkyfougEIHyIywAlBmYjaw+lVAgY9AZksfPbfDpbqRQSAo9h+FALIfgFM01EfvbTwISHo68d+CAXEkCx6lQkAyxGyGFn9XtmS3UYMlL7CKzDOqLZSVL1MWPLFZggeY9+Z7I4dI+29/EvVAWzgxrhf2P8cX2v7rxOAwzyAidPbMfybg0WugBN3w/gfwgl2EC4bD3kGpdiiStBczAzwMI8xEe/n62U1miOEQO2NwrVr6AHYW/o2uM2A7JBF7zv0VV+rJIO1d42KNOw5tTOZdQFHlH1MPLEjOS1t/BQSj1xVb/lOANUBqOTf5gagGzAp3a7rOWTAfxGkUAFQyj+qEDhiKI+gUx3gpCOBHFVa2fcSNijrrpQ68QKRipnGHAAvE4oE76hKcCRJCDZ96DQOlQbnrHLPjo+sepQLMUCs9/7pCu/A6ADmQ4exNdfPvwdI5SDG5xEhACQLe85g+Zjzd7QqQHUAnYYgWfrLj0V0AjbbvP0FLkFWCHzXYPry+SiDRKGN3wGYrEYMWpGJnwX8Uy3+FDCVA0Fwl7+HuYFAQaOQJo3UTqzuj+fUd7ZSAefqu4Dx9TzdRcw4DSb+Adi7gOzvq92HF57DDmA5nXYCaA4AgS+mA1eHYJXe/IhojadtHkD/GAiCFC23XV5vgEss+gSh3HbGCXB+IcjOK8ArN4Gs/dT1ZshHoUcGKg+WrkuZArdudWWlUlSggRgPdm/dZ7Z9MYQwQxqjfMVRZZ8KATJxvDBnAONk+z7LxxoHwAlAOx/A2X9WfBMWZO2umX3RMhx2A3oyqE4A1FxWDcqgrjb7gBMwHYNlSASdg9RjYBJnXcXWjUAu8abKjgKwsQPR4DFA7XUf1lCD7eX4uAYoHVeCR5oBYJ90WlChLLPdd4Y0bBCy33oRdytg6mX2Pka2fjaRWckmdBZz51s+9vyd5AC4AUi0BocdgPhCD8oTjHoEhpl/DAPIXRSTKpt4fDKvPSBRHTjiBMhZWBXsEAea6lDR2wMsOQl3/IgQzHX5we7IxoEdIPxIAGuw9q+FCSFORs5ZdAb905KDkeX2uQFzno6CI8WUOP1R8T6puiOg3AugHMfyu87f2c0BVNXfS4DzCcBi+f1rvrbLs0RhbXsf6N08Qh34Cjx4XPvQzDU6BwFOoAf4KBk4kdSbDhEq0R0H9egcfQWm+wUDzpNJxyG4ezRDCLGyx4Cm40oQziX1RiQyC1gFdgXI014enFPv2XPbJKA99k4AugrQeSNw+ZWgrhPIQDfKfqAbsJMwNO3FBPpWnYCBaAaeUn3RTVgGOTYvuWUCGIFi1oc6Wt/LPUwpfnM8DOoGpcE2gsx6dr3vTMYhA4PjxVl9/p7tWiwo1DXqMKEuHbTk4r2udp2UWpHuNKg7qq5CEH3c9bT8y+fvSg7gVH4XAC1/8HLQrhPI1p8sf3oUrPzCyqucgVHR3j75lu53oF2HOW/UHciE45pxvAXsWfOwioB2m65TWfM6kCYy/BKIw/2OuwlvzS2wuoSQv7MmJ22z6/GEkvcShzO5gHFYMFLjScU+oOwvxAHMlgE3AtgdwK7qBfD8MpBm/znj75qCMDnGrwwzai0ah0I1t2FBHTzRNGHOJ0jQvwAnAJY8Bi/1LYC9g+xEFiStzDJmh975vgIL4lIW3hHFEeWOlbYHMHvdcyRiieNpIURIENA/z85nTCqaxKaTe9NEcew88vxbGfDjzn9nXdfXoQsQSAAagJK17lQFVJJPqLl8O5DJvqsZhPnyzSD1cwNMVYCPWewzq65JwsFNxWoDgvZgrG9BHoPRgEEkBkcg1/uPY3dJLuh+ZhqERMUgAvc8ITQTPU4GWpWeCyHaPnb7QVKP7k2196S4fMxpa9+6XtKhg2rMvrySBX9/71qicGMnAOsAsAXYVgBUC3CLuVVnIAx/IAP3CrFu1x9CCDPr1hUkXEP4YVTfAs8RRd633SQMM1hl/Dq7BU1PxkYmQyT+4YYuokc6wSBRhFGXdXv6NTDGRBGTTQzgx+zDJHocsGsXrNbNzCt+7GAkiKeqAxFJ9Zbn6ycXExHQ8rt3B1DmARTAp/ZffEloiqMzwNjaiw7AekLeJytzywmg6or8QRAW2ONDzC+Sdq21FwnJ5gkSkellRsUphu9Zf3negf3WwA1A2SEGR0rFAUnCKHdT6fYkIYTXQgQqLG5MLo8JCxjAjyAIysKzo1CZ+lEu4VEO4JFz/1UOwTmAfOzl95y/ew8BUhIQGoHMxKDtkFQVoAqAcQIq2VcdACp1IZV8ea7VV6g8txCze5CEwQNcH7e4CHxYlZ6IHMw2eZ0CXSG6dJmsXrwEr0sfbRrYT1D5GUCOHUH8XTmujo41tv6xRXaADOfFjwlixgU4ktiGucsleGsu95stAwYTguqYA7IPHUAiAHQADejmrUDGAaj3A3AfP7kFGeejXe6QAWTo0xeh/Qag5/DAgpfCg8gJiAYhCUY1r8Ak/goBHggBqOtQEdQ0MZATcI6jEp0Gl3IoCKEeaKN99zM5gHLo5T/3VLdALYqhR4q9r+8o8Gh/vidOgctzmOzkm1J1fLaGfDwZ75turcAfnwmglQGTC6iWv1QGqvLie/62A9vP1tqryT+4T75NGLsPyoBVM9FRuBKeSBASaZjhxMcqzCnBbHMN0i1kQmrnsLbUOYHwtWBKRWlZ2FdQANyGzog4HgPePiHw9Vu1ndl3fE0BUb3QOH/gEiYz949S+x3IHNbosEyTXWfbrQrw8efvyUnA103M30ICSwiVGIAQWvJN5AlkC7BX/gqWiAxEac928E1UBSowvfXmbsCedW8kF6u4sbUHk3i2h2AybBhm4uPwgtWJPZFdfxzEw3DBNbXMnSO67qJuXcfB9viJhKEU3qh2kPQ7Tgo2jGCnosmi4wA+4fw9YQhQ+wJqQnCQCzCkUMy6qA5E3YFSyeHijVJSuZCy/nWvamnxOOVx4Y1R3YDAnmSNDYW4dWxXYeu8bWzZGX75GgYuYaTuQxC6DEVMPD3gKb8xVvH5c3VBX2Pip4UPXTAf6MCbAbez9t24vrk6RXJRuLNNYgpzAJ9w/t71lJOADfA0LbjE/y7bn3MBocqneF3P2ustB4CarP5M7I/QRNUj1Q9sf+gEoklCZM9kiZHUWZPH05W+VR20gipFPEIMx5yCDnscGUwm554aLjhQD6oRI3fRV/y8dqIUN0MS5p5VpxKruj9mxwH83vP3ZgeQQoAW/4uWYOMEMqtEbwdyuYF8U0yMj8oILFXDgLy+FxbMVAWiNl855RbPaZ1CfRCq34A7/Caz/u1h+fPGLsErXA1LkjSYVmh3joCQIqU+ThI+NHrDXAApJitqPwwQdhpCA7bw/tgH9q/PBFR8MnegyCapPeUGOu4kCg2WT8wEYJKAriRY1Do3Can4P4PCdvpZAO+fENxoz3v2fpjwIyu/37HkPurNU/0BJuPPoBFuwwCnM4GI7XTXvmulVKDzcw/I1bxgYB8H/ryVr8AkEPQBOyaWHtHUsTAZj7OSDj8P8gixawiIZPBK7xJkF8KPwwJ4LnSNyyeev0+GAKkJKMX87e8GYKwU+EpApPYtbq+KNZP1f0zsP1MqrByqwV5vm0ziKXIpw88CwcE0aj+WLbhIEMcBnzhWX8+U4otS2GOJ4UW6gIhARtb9kCMY1PGPOoK5F4qQqovkLgI+lU97TqStU6HB8knn7/NJwN0yY9//4M1ATtmz+hq1Dyz+TAmwC2YRJhR7hA6jTtxRIIqO0QBdgOQHEB0Pvo9KzDUo0oN5gkuQbkFYWQ3c46TSAxkfbRr0gdpFZOOPq92BudbBG30soD0QnQM4WDmIHUC79kQSFtBzZcAA6EAQ/P22sy6fdP7+9XTa4n+YDYghQAF3dgNzswHTl4gn/hQyUBN/qjewNh6dggTzZFVAhQczoQJGXEMFR0LxAxO+oZvsYQHUcxk4nOxgnTn+U6sGDpgi/ozU9oUtDxp1elZ9qNod2z0MASrpEhgPHLM91Y6quxBm7AAUqWxjYPnk8/evKf73SUAVAiRQ92YFauD73EAmAaPSqnEIVNhYWdq28KZL0EVNQX1rHVUDjJmOKglRLN5JHlpAWcvecxL9dX7t44DfdwlToUSQXIus/FNIYr7SMKHyT0gKqhg9VHdJEj37bis9NQwwLqdv/3cH8K+cf2BdswOwbwYSFYGw/790DuaLktYf8wc4wDtOga0/5wK4n0A1C0X9AWa5SACa1mW1HuJ9l/H3gGkDWoUM9vhzoD5u3Xvhi/ITI7II1x+w848G+uDlINFxu0nCAxOVlC1nh+AnDXnCGYcFOO0XQgVTATjoAOD57ASQFD2FAV718fXgOE9A2fx4WUsUZl505cB8+9jqT3xm2+w6BDOLy3f/qfxCmW9QQw3KBZgsv4rlrYK76wvj8w6ooYqhzb9ne76KEaD3sxOwFJBKiPFCcwFvVAhx4LjKfjvbf2B+gCYJAOuwGnHAAUw7CEsWy+/bHQC8DkyWAHkmIIQA5Aoa0OfzAL6lF4ZuryegJvvIUQRx/h50ZELBh52ikJZ84Ri6Hr3XN0CM3PbpuYf+ul5Y4GLwHikNuvz0sWJCiYDvyKKj0uqcDMDuNgccQFf1C8kPwehdmlTvQ5UDH+q5Y051HioHIJZRE9GeA/j9579rQ4BcAeg7Aazni94AbLwZhAP14ZQ+AtnYg8ookn0qNFDHiZKHUA7kWrtU7+h8WFY0bRo79bTMQGIcyBT01NsPEu8vZtSf9b/nUoTH6ChpA761uOxnekCsVzOR2IuIwR4frqXTazBFDsWxhSFCrNTOQeyBdxoPikCUa9DLIAQNqxHqusgBbATQQoBtZaoGtLf/2L/r6757zUCiLFicQVVXmdArrgHZlpN44rNRcCYLZd+jun9+KHxt9VEJ0AzJoJ8/iGCoHUqLAUOXguGFAe08OJ2Sc7uzGLz8PZxLCBU7JrhhiHHABWjSyOfuqLYEMJTp3PqDDoD3r9/5UMvvGOiqX2B3AJ9y/sHdAfifB8MfBcXpwZkkAOTqxaBx1r89cL2NTSTWrcNcAADMgTGoAIQVAyKLmbDgsd2BnGcQjiGO9ftgZtcynzOInYQ6Bja2PNUFOIBKx6GV9miooFV/cOzAiuO5p3II1QHokOKwA5CEY1U+Z912aSjOI/27npY/sBNASgKmdwPm7L/rAlRvBAp+LIR6AHqTgcaOIN8o19orYvZIuXuKHrUIy7BA6bW38i5s2HdToGWTzN+p7YUPUe1VHm60zoIkUF0oIb0hLiAP/n78r+lKuoEDJNENPzoW+pADECU4TRAFiHZMmLBgygEooLdjV8DLGYZp3+UPnH/INgLhLwQbMpidD7CRCCbV4B0BrjnIDng5j6Ao5UDd661UDUOmpIeDH+AyY/tFt54Dew0X5qx/ulXBNdVjxTbZAV5kg8FzmatTVQEFTk8GTEz5u3bOHdl5RTT7toNS4gyJtOPMhxn+OjPIDjmAGOD+haQ9EA+IImwDHjmAdj+WP3j+IWgEKra/JPbaewJNDJ+dgv35rwzmcFJQshz1xaIOlLYfwJEIk4or33FogXY+r3ONOwS8qtQRIGH50Dmo3EOfFLT25fsWEIsGsT3PU7fB109PkwHYTc5XcH2cfVUIQpVkPZwHiN1Pc1EFeOzcvGIbhyBbjS0YRyFDPeOjHYAHv52D0NZvfy2fev5hqgLYNwPX9wLugIO3BRd34EDdgF5sa6jspsSHlQXOAzCAEYg6FLCq9xSln1TnQ12BY+s/tvz+GG249gIBGADDmn/vHJ3wZHhcva+06cPZghPqPkhA9sIDQ0YvwOK/OAewnvhYUf4Ax0UNCzKZ7gRgGoGq7Uewi98KQOBXIENJ0PQHgBoai06qbxSYXhiSQwH3wg2p6jb558hgVum7jiGoLqjynzzfUYfQcw/FMj+OFHrE4VxJMP9ehw5WbRzQuk06KmeiQw/vKPx5oxCkqv5kv75VcOEIXD6h5wAemwPwpGfyB9V9ebLHJOB29uVfPf+IqQLYMiDW+LneL5KCWBmISoFH8gBBmNAHNKs9gsL+naKIYrE7tl/afQXIkbKP1h8lBTbP6vMBUiCFi47uQxW95f5tOuo7G07wL+DwN+om+ErJbmomoAIWkM6LcADbzTNk4y17uy+KyGgZ5QFm9y3favm0nQDKZCDMAcDfBbQy9uewAADlmntUeIBAGuUBuH5f8g4dIHeSe0mYRQjBpb0af+P5Rw5gBPbR+qNkwLAkUOaBwlBVYI63EWQCFt2u7ZAC5wcOuAq2s1WRBxUMFd8710L3aLSPstwjiz9yEOb7Bd2Jj7H6qPyFgHYH8K+df1TkAGhOAP5ISDf2D0IA5wx0SLDfnKDcZwYXtwebPEQv+RerfOsALAR2QOEflRCcU2sdzcPSOkh6bqC/rgv4YTw/mSeAee46XCiJt471f2ozEc21Vw7Egss7gmMAb2PRkQk9N2vN273g0GVs9ZWjwGXoIDIB2BxAifdLjd9WBvavxO8GkPmAuPwXNgkpyy9aev2LN9FZlPQZAdk5AU8GjYDIlaADwP6AunxEFu1c6i8cdHq9dwNHEn6szGbgB92CR1xAPR78WKUClwW+AFe2x37fY26iF++XkC/cRsy1j4iC3YghjwDghxwAjS8bOliSsMRgAd+u35LDVmpdPv38Y6IT0DcEpZ8N2y5fTAxSXYGz+YCw979Yc9X6q94F4MODBstCEPPADknmEWQQAXAW7EMXwAMF5xlMOoRpwB/OEwhFd2FDQAZB8xQm/ZSb6OcEWi/+GNiW2F8EwBmMGMIoQnn0snC+ATmAf30nAOwE5CnBQAZF6eGXg6re8otCgmSftfn562OugPfLjTKFueu/+/dIJNHWUQOSAWveKqoaCGDXoRs1F02Qgbm2eq2s+QhxpXad9UMF18dDBXQEFdp+TUXlORibK2PymXAhX+9khSAC8aiRSF4z9vhDHX5MFAiqosxEHvScXEhAY4mz9WX7/d/wtWFW+f05vDNY/tD5x3UOIMf6+AYg/LWgFAqU3wUAu29m/+WuwB4ZOMBj6BDlCvLNFcCMbTzo7UQ4gIFEGyyWsLQNVyDx4QYOQOkQRMzsyUSFHpPJQ2HXvQsYAD6o0fNeKsTZlw2nCw+s/zCxGTuL/c51ZuVZZ3EU4M2eI3mM8gt4TxrgrYNKxDBa5q0+EgqGCzsByBxAfUfAdjJ6EYgDvnhRiCgDGhWnacJ2HcfxPjlonQQO+uwIuiW+/FgmKwDWfSiAeYDPgfWY8ns4DNyCULH5sAM8wjCB1wFqdxrxhPXvZvdji74fWWT1LbDngNqO1aAXxdxo8SX4B2U7vD57Dhvz1+0ciVnws9Ph614+4/wTYQ7AvSLMvAtQ/UKwfVGInDrsGnrgVWFovdC3NQAAIABJREFUg6hL0PfLZyZUcwT2e1WCA8uYypLPVAD6Vt4CWYNsDuyHiaMb44/cCJCZs/1e9brkMcg1xI7HWloFUAUqY8uFks8ouNsmfBfBhAMopeNOjb88W7TzDHj8rvx2JhsWWELwQFfkBt8jX+fyh3cCiHIAXA4E218Ayu3BJiGYKwkl9pUvB6GfFVcEUSyPA3XQF2Be/MHA058r8Lp9AzNWHiEcgV4vlwAzCjhQfJmTIMfy1OMNEniWcqxVLZbbgJfeLYAgMccKCIZtdXzsvKY7yUgBXX2HA85BvjvAX8tY7fW1yVBB5i/QGbTvtHzm+SeDHIAvB6a4f9tZTw22IKIyYK8qwOsoL1CHPcT8ZnBQX0CDoH97kB+gDGrYQuQKZtR9ZptqsDMg+w5Dx/Xdfbox/gSRBDVz5SlcjD9dKfBHm5t41Ak5trF0sPvQqafLbcw5AKPeNKMR80W95Jw7Ro75K9DhuSL4IWDLc/7tuNbbrqflM88/lacD55eClqYfyAGU14DLEmB1AtvD3E4avCLsQCJwP46c/lvOYRU03B6z7oY8MHYcOAKjqvPq3gf0/HHYOjtyCRJhkRLr/ScThzzPYTLTzzC3CUALZksmcRjSTyKqY9Iy2X044QBA0fmXftC9qERduQ9R/oATk5Gtt8fx39WGCqD8IjxZ/o1KAPmHQcorwdyPg/jJQdIRmORf3BlomoGqsyBg8mzB3ChkFN6EFzYZaId1MLlIALylIL07aFfYW9cjGExwjhKKsK1U9FjJPQHpWFtup8qVYUJNeQK4rkBNmaBQwcw6SiLi4Ld/BwlBUX6ThITABqLjkptWaH9upcj7vodyBO1KpdUPypajbZGcls86/3ROAuZfB6r23v5SkP9BEJsErL8VOGgAqgMumApswM2JQEjuWZDmG6VyBKZzz27nCMLNAdDuwEN4e7TsSuygUI5AhgqPCAnmwD4Aarn+x+YIDs0JsAN7/9TtIhTb47sBDjQWuXCFzq3seQN9GzF+u7xO5hi0SuNxvdpbEk2qHtl6f13xtvYYyx/ZCcAmAfEnws1rwrD2X1/80V4Lli4jeGX4IAfgHIFqCFI9AwQ8m/2fcQR2GwtKtupe9RWIY/ud17iy2hPIQyokE1dAT1Phg3Apg8qDV3MinzC/EKh4cSQHKhVswRPJKMfUU+8gPAn6B0YWP3QPzl3pUKSRDth6SvwiUaQwCbfF4yZCWT77/DM5CUjvBDRvB6Y3BO1gFu8LKE0KNd6eJAOX9MuKCkk45Qw80LYlUeIvr4P+QYZFyTuYc3W2l0DPg1uqe6lw0ENjmnHXlRNKSsPlthMWfvpYj+w0LHaX70N0vSZJdtBNGMIJwZm2ksQgGmvapB/lPjRAu4oukneaECy4y9iQtv5Atr84gnYP0nmWzz7/rEgC4lTg9lqwBK4A+KU6UOP5BuI6wCNiMHkDNNg8PRiJQalzAnm6TlZ2pd5+mY3xWZmPOACtwkN3AKw9RQwO7L7DTp0Tj11BMdV9qFR0dE5rUc31TCYSnXUPKg1IJAhIBFJVahHuKOuMym7/bqQy8zNgY4dAyu5afi0Z9cMC3Na6ALyO5XMqAagkYPCWYJfph7IgkkSvG5BLejJ+F6XEzNYyZCCGN+8fhPjp8QrPoFYkhARm7bM6b8kke0CidjLxAE0FtrgSoZy9aH9vrn9uymUcDBsqICfKkpHzYeurANlddpAsyhN0cf6BygEnASX4yZ53HQT1Szirb5KYMF5cCGCJYfmj558TSUCcAGTfEdjyA9uBsB+gNf3YDsB8rB4ZhLE9tgDTkHY9ATzk2YE8zhFYCzsCPDsGBE9SSQW2OFygHEbef257OPfwvJ2E5aGkYL6yg2FDBZxI5ikVD5cF5zXhBWb4RagUtw9b58MkIc8RTCjy+/pj21BFhxyt38EqvM4VJDzwdS6fe/75gABK/I6/FORzAUgI6aJ7cb8nA6OKwgVYpR+FBwrkmRj2757+9hrdW0YgFDkB8x0qSMsxbVCBD79RFjuLNFEFlyovIY81BHtg4feA0PsGPoe24pFDUcSiJ+F4YvQxe70fopQ2dgV0vPDlIH2gN/LJZwzKergduwEFbusQkEhtWFDuk8wJkAuw14Ak0v5e/s1MAOmXgV8HAGNIQD8V7nIBfmbg3hDEyT2cvWfAXrZFsDRQ+r5+VnelzGUw8+C0/QAGvEafLQANcZgsOJ+bv0McBhglJ+Da6+qEFc6S41E7wBwmK01qLT3L6XkHcN7J8p4lu3zPBhWOUby/X8WwD2CsvvgWIAQgg1Y5ExdGoAp3SoazLoEVvYUG7Y7uy4KE4fJ55/dQFYCAL2cF0u8F1sQf/VIQlg1Vpr/zHgADOH6TMCq5nAw0o/QMlAjwipR6roBcSjVdcHwA7TTQcxlLw1t9FwDwNNgBho8oL9qfCnucK1AgMkQZWfhJV6DyDHWZKMfh9YS5AVVFKGosGqgUuPk8cQhgHcG+HVQ+GgG0MYpuwRLGelr+2Pm1DgFsyhxVARDsOgm4X4J7PwDYbfGKcGvRm9I3WMH+BVxhPkCoPyQK5bkUYE3YoMEWA7kX+3uQmOOYcCJyEiLEAPCqMEKGQMPQgex8x3koZWb7Hln+npXf1z3KFYAaDhwJ2/UplXe/GkzqS6Q1EwIY+y5fL6YtfSKAGPwYBu8GaSOA02nrAsS5ALYMmMKD7UthXmA7kX9V+P7Vq7IzMYAyY9mwlu7QtvO2AvjkBDxJsFLj8VmpESp4rp66otNottXuMSIMALBLYtlrUkqYQDEmB0MTQ7AL9Z7qUCQj3214UvmBfuhgyUHnF+oA707o8bZfHdsAlSoAPTfAAIxJJIOYqhQRgA0pgFCxwkfhA4N/I9Pl88/vDQhgAy+WAfnVYNgKjIk/9U4AahvmrsBKAOkNQumGlb+L0+iBOQM7mi1YuwMGJOLUvxBGENdXaz0CuSIX+2Meo1DAQKtj6ZXi8zTcQls4UIwiT4cMlniwb36k8Hy+rmsQquavNx3BWny/rLs+zBd4wrAq7hXXEYprUEIrj47BEtvI0itSSGFB++7FFShiWP6t8+umClB/GKTG/uwGUPlFGbBafpoIlPMB9SIGGX8LCN8PgOvd37IJiN2FJRSvtZG6M3zaoItBnNdU28xn64cCKvnmgQ5LgtKdIgef+e9dCwzOQV1fuRU7MIk8REnOkYhImvF3Qgtf9ne2vpMY9MqOVlsRir0nHmR9cmAiYRKT4B2QCcf56BAsYayn5Y+fz+t6em9S+1wFSMqP9f+SGMQXgkQdgfyeQHgpSK8TUCUJUbkVYbjYXABL7seKDkpvVD0CuwIwDtd8PIjduoClwV/6t9tVeXrCAKYpL1/D8fyAV+5jIYZRWFk1sN9FAXYfpJ3wQbsF4QA6hNGz8AiS9nf+ZoI8LIhRzUfOIYjXZduwdQwF1Og0PFn4fRoppnXLF+wEsM0DwNmAhQAoDDDvCtgOZasB+8FLrsDZ/M7U4GL53ew/tOyYW2jLGxCUDUcVF4ruQgPlCgSwndXMxxY9AOgKujB2MXYnrOjE4+4cE/kBp9aySuFjbkdqjwX8cD9l73W+QJGDXoZAtSodvSwUwWaBR/vn8dFAinbcEomy5Ug6PUfAxFMIAJ0PhhD1XECMy584r+f19PpiCWDrB8i1f3QD9V0BOCdgXA2oIIjmC8gkIDiJMEkYATYCfk/RRwQShAxVqSKiQK2GbUSc3XUJZOsjMkk2O6Ya4QlEA9BEGDBVafCk8fhSYb6mQSsyAkoBFsFhXx2OVn9k+2PyaCDT4YICJ8fxM9so4kiS3sY4g1/ts/yJ19fXT8v5YrP/rRFoAzV3APZyAWKSULX04tXh3B/QqQI4BZ0OBY6qP4OG3EfpAOzG8R0S6BIFhyTYCcjHZCLCh97bFvYbgBePUghFEgfUv5la9+0fWyoUPQ+spp4slUvIy4JJP9rqd5wBKPu+FZUklVprcCty0ATkVP0FzABsxLCeli987/ra6eJ8lQgArH8lgEIG21fmkIBfEhpXA8y8ARUedHIAxuYfJAAkEA+dNGw1bPLyUKnbnjYMgTMGDT9en7lXQJEROIlBqOHASvG0AzgBuZQVI5DNgj1MBO5ohqNMEoWO/W0o4B2AdzPKKhtnEHbrHXMJeL06Zrehw35doiQYqb1yCvacNgfACcDdMHzha+vPL5frjSWA11uNf/8VoOwGaguw7QfYL4SnCZMDaD39oiRYYFh+cciAUij5QRJAE+7BiiTAysvntkqtgRw5CR9CYHZfHgtn8k2GAEWZOKCx35vuyCDmd0RgkpvC5vecwcSsQEVQBkCdY5S7zKDh79CAkvc4UBnAc9i/PaDLeas7gFePK2CzYwitPhAoKroiHU94jRiWL3pt/dnl8nQXhwD4I6FRI5BtFEpfGpN+/ZJgfeBYJaAMPyp5IhxWb0EUJsmHgx72hay/BiEeNzqGWh6QhQkFPFlU4HZU296LfJ4hQcC5ujkChF/eZ6IvQIJ2IgE5VvV23RbcmnhGCT/1k2EIUvu3tuq9mD0RcGzxWbUdQWR3VAiPyUa5l0YAREC1XGhdEB57+aL3rD+zXJ5uT6fzhc4BQDtwdgL7acqvA2GzEMf26heEqtqXGDvIERgXIBKCQYnQEQUafFHi4+2tcto8gIGryQXwXmW/pi5IV96F8HbsFo7kCDyN7UcLymoRmcQxvz2+2W744lJBLtOhAA5ivD+WCKpiypZfJBN/jFllTyDXoLKAtoBk8HtwewehtsHviODXboHDFhsWLF/88+tP7QSwbHkATP6h9S+xP1t/3SKcvmjPAdCUYdoeByWCpS0fEAKAXhOCdwt+aCJkG4A81AnshZjIVkugCWDyddTPZkCX60fnQS7Eba8gnY9zcCZiUTml+jbufzpZRKDEI3PcHOUetDuIQeqBHpBNVW0kGPs3hhwFtF27P905yHG+/WxzD7xuPS1f/HPrT1xcnu5OF+t1IoDcD2BifwQ6hgSqHEgtwjXDD+8CiKoAveWDvMBxoEckAEBy4UEhBVboTAIuOeeBWgaVpY12XOMO4HgxQWEIwJG/3kt1/yngmr3B8cTuQJOMeuOvpYZ2N6zNJ5WddBgMMFRlQxwZuHPlQFTS46GBU+fJZh/lGiJX0F/uwb8nAb/kZ9cf23IAmwvoE4B/S1DL7HtnoJN+yu4zMRTQ0HITz5M6C3LoEcJwXQBkVvEGZrweUuLqCFROQOj9QOnrAB6UFflaG+iZJIJwYxgyRGD3pIODX7kGSShh6c6SwiG1f3Q5MFb2puLevvMbeXu5A23f50MCD352Bo20EkGmzxsB/OjFxel2J4AtD+DKfyUHoNqDtxsTOYIcBuwAoFmBJjwo4ImqA327PwRzQBxuP6P2EVjztXbtPWiMSPjxeROJ2EDHAqK5g1ZXLyTJZMPuJQC3y9Lba2AV5rDHWOlQlSeJ4EBFoecODBEEnYU6BEBw4/2aVPmOVUfAd+0+dZYiQNG9lOXaFSBZ2EQkfm889k4AX/oz6w8vmQBOy3rVCKCUAqEBKOoK7LUI5zcDmRZhsPoWEEwUTVkr0TwhFHDgo0SeU00gDwaf0O5UtAv6Bpx7cOdWpNPKkh5OjRjseZ8SBoz31ZOHYrC70GLY9gsEOjULUDuCbihB8+XZlVg1Va8wo9CkhBKgrAxcrf6oysJBwPFKWFPBDO28fWLga7XOYPnSn15/cFP/zQWcLk43iQD43QA5CVjfCcDNQUnl9y/NVYEM9qZNrPTqF4S1/U/H8I7giAuIgdzIxuhqlySyEstYnQBqEn6ODmzBslOaNPCgrsQ+gVmC8S4jDgX62+rjJlLyispgw+9jtyYioJh55jgFNBwmoN2uahoc36qnBWkP5Eftvtn+ES8Aad+JY31yBpCw3B3Al/3U+gN7DuDidLP9l9qCg1eEj+YFmJ8Vy+BAd1CHuQgJXFlvZP0tcXRJYAbEodozMDKwpxS87wgYzKGrCEuZjarkvmKCUWTn6/7d6oFXW3NekSj0oB7E8J1ZgAg4RRwS2CbcKe8I9C4D933q30wafLxCjk7VSfFnwoa++jdyZutfPi9f9pPr919cphzAaTldLxfrXg7slQTxp8NMIpAcQB0ctR8AlB1mDbZBpPIAbR8P8njdvm2YxS/k1FRfba90mo/J17Q/tEH1oIGtnZ8DAEM7gwlHFVKmz8H4GNNWZUAZtjrr/cu+KqnYA7sHbL5q0QYcJfZiJfeA9jP67BU0d9AUM4rZjy7HqscMGaht6n12Mwu9wiuCQcCzU0HiWb78J9fvLTmAZSOAy9NNIgDIAVA7cCOH7dBifgCrPr/+y7T8stJbd5AufqYikI/zQkEPRAFq6kGftwMw9bdhcBUiAAgFYHZK3w0DWO91so+JDn1FJaZwXgOqjCcNXMLvLVCKvV0xfke9DbgIasiJyGOcAHyEK4C23nLNM4AfhQcR+PvLNTGE5JCvffnyn1i/u1QBdgdwuecB9jAgqgi0Xwr2MwRdVYAbgvacQCYODAnQgqOTMNoVxP8VLOP8gFJfBdZk08gh1GuEYU3bKEcwk0C0DiQmCL6urnMwLshvKYFe7nenXdhCpUG2B3YNan+kLuCDSUMRkfDgZxcSxfdG8YO23h6IkQwUAI8RAFYjJtSfkoNa/dsxl6/48fW7qgNIeYDrrRqQXgQqZge6dmDbJFQV2839L+CkDsGa1Rd2viQUiQQ8CBCoPjdgQOlKc2jD899By7DR6Qm1t8BHZYPrFSVFVuR964HSGyhRHC38Bfy8Sd5zInwwAK/PLS8NHIJNINp7wKpsSILCnmMgt1Bnu+/UGsiOVXZs/9t32vNrcF/aeY9m+/0x05i3x9HHtyRhyYYJZD0tX/Fj63dsnYA1CXhxut5CgfV0XhoBbOFA6f/nBKHN/PccgF+XnIAdoD4k8KraTwByydADSIDeZekD9Q/JgYHQcQ9dEgJdFrG/vVcAmWEfA+q9CgVYjW34gNDVnYR6e00a9lx2+jGtOxASDElioj9gnPW3ScyR5WcF7ib2yOEUQomIZLScySxtjySyEcCPrt+OBJAcwO4CLuPJQQX0pUkoA7mqPvyEmKv50zpZ2hN5AQoRFMjtEM8kMcgJ7A9I2HjlGjwRAZEQAB1QJXEQKKmPIDofxuXKLfBRrWPiUEABl8gA4mxUaT43A1Bu24nZrW73iMCC0MT9gz4DBAWC07kCqB5YIHmV98dB2w6Ae0L7ryKOEcBH6r+tX77yR9ZvUw7gtBFB/akwGw7YFuCcKwCHYJt+GuDrgBBVAQ9oVnml+p0qwKLzARGwJdg6Sj1PHKiB1hXUc1KC0V9LftQy3yBIJHh7kTqu3TsPmW7VwRKItfgxcWgngL7iEYDvJgA7JCGsOpPPY5xAIVpU2VG8zw5BOQoP9IBgSN0j0ihOYDv38lU/vP7NrQRYQoDiAPaegNN5SS/+VAQArcG7jQdlr7G7bRNuIUB2DC7Dz4Duf5YuwIAkIIEXAmxQf3Yn3RxCDGZWzP0M7lpjQtmHhXM8HYIIE36iemBy883f1KM7MDKgvR9ojsF/c84P6LcEz4Mcz6Cs8zQBdBqGGKgj8CtgoxMp1xmRgl3uE4T6WG27RAA/tH7r3glY+wC2XoDTzZYH2MKARgDtRaGt9MevC6eqgJnm65OADcAIVJ0TaEMuIAUJOjrWKGO/r49Ljggu1i6/zqu9qga0HDps3ykBWhXXbzCSx4S2WksqilBilW+uxd4B5QTwWu36jvJT9cESQR/w6nyodhFAUYWTs5u3+W5fUOERATxV/XvEgOTKcX/5nAjgB9dvKY1Aex9AqQSUZOCu5vZ9gb72314ZZhuDIgeAICt/RySgbD4s25XHbtMGQl4+yOonYPpjaAUmYIsuQ+MNOuuNNlMYwNbcaG6Y14jcgW9OYo33kIQzdisEVun5E8fcRmnhO7cBq4mFj+M/434xgBuBWSVEUPDfqKSsqk8jAEzI+Wtm8mIgxxa/3QuzjygRLl/9d9dvIgewlwJrMnDrCajNPr5F2PYE0OvDTD2fHYACPMb5A1fgQC1IgBS9Den8Vz2GIJkDiUHW+hILCg9gGlPZrlt1h6vtkoinivr4O4lH3otTgz4zr4DerhipB49djytr+Lw/gsCebx7wvJ+ezIPgsX+jy5hxAkgkcWzOxPFC7b8oD6rz2dxEuu7lq39g/caeA7AzBEvWv8T8+bPp/MOkH/QI5Gx/+uJcCVCOIG3XBlNT83oMnD+ACm4GvlB2E1fT+l7VYBRCiOahmHSMT/BvQAxdS6TyrU4sCQnupAV/HoqdsMNqq/EiVMLlY+lQgtUeaSByAibTb0qDGYD1mUZOQIcPiljwGmb/ZkC/MPs/VfufcRI2R1Cub/ma71+/YZsMdLF1AEIIAMnA6z0ZmOcHsBtIIBVvDS6Ah4RgetAZcK4SoBW/kgCouSKAemwHUjhusG7fN1D8fbhLwtiuwocYVsUBao8gD2uGmTDaD4A4kjHEGDgE+dITdUYGMak2Ac9ruicMBh1q9pAcnpD5b6roXcIs0Mueve1n1D2NuQLco/a/PScbFlgHpdZte+L1LV/zfevX7WXAy5T44xzATgSnkgzcEoHcIQgNQjgvIFcGsCRokn6mHbjlAbziCxdQv4TNBcgGoO06egnCHjCDEKJCsRv/91qJUaPVnH/WcAA/5Qo0+AWQBVDtvspZcGDwxAai2iXHNCHUWTgSr9YM5PZZKTvaYiTqNyT+ly3Ex0KEXpIPv0sBtfoeaR06BHuvl6/53vWvKgJAB5A6A/07Asx8AaP4AGjpAJoLYMBXh5Dr+MY1uKYhC275rgA4ToORbhJCYGM1wKh6zykU5R0RA4UKXqM9QfS2kU5BTFe27iSdw0Pc1hCsMxq4AXFEa8j9Of1PhU2QAxFJFDYwIPDIrIT9UMCCZr8L+f72yKOAj8GKLiLaRrkIdc0N3EguviSIJIFOaHnH96z/TyOA9Xq5WNJ8gFwFyAnBm6012AJeJATxfQDmBSGo8JT1VwRByTmboYd8gVTofq5gH4JEChVcPcUfWXhJNKTkzol0YG3CDuUICPYyd2GPrz7xFfjXk0U+wZIH+gc8JlIGg50BydAfK769B6iYNmfwhPgfMucI3OhvBdzHEUD7bmzlX5T670nAd3z3+leGDmB/Uch6KRuCavyPCcLtEoPPoOLcB+A/l+NQmS50Bx7cJiyIAC6qAZYUCgjihKKCaB3QM65hMBeh6LKBozyu0vSivN4D9BTeazFexYQbCFqIFUEoAvkFIYAXUPNnRY8qDJFFb9vbZF4E9McTgM81LO/4O+tf3gjgYgP5xem6/Lsrf8oJ7HMDttxAi//FT4nnVuCk1qU6gPmBAmKO98v2ZZBah9BsPdp9BCLkCCJHEGX9DYB61YBRJUHAP0w4kuYOld67CO8bED6aioptxbVqL+cIZPXABx1zZUN/RqvaBUqWsHoWHyktdAA5b8IWeqToCLTob7w2/nvGDURxflTjj8iiHx5wBaB9Xr72u9a/BHMBahKQcwDpdWHr/ivCtTtwSv079r+ShVJ6ArkDNxCFiXftfrbWzknDomh+eRqC/RJhA5OuBoSuYNYRhDkFHTrIpeatu/aKPIytz2AvYeBLOQZj9aE4GIYDlC/QDkBbfHQmFXTTLwZhkrGqOAP6WTKICSBOBvaBHIcFinw4dFDbLF/7nev/ERFAcQAJ/LsL2H9FuE8ATdHrdOL6Ik9Ue5hEVIFW1JxcgJnYw+ssUFsSUQCYKgIG5NNuwB+3W0IEEFv4CVcB/fZ+DkBEJ6iW9h2EZQ9FDHHyr+3FYRAThgItghPV2cLOlqL4jKz4BvDGMSF454CtVP8poMd9+27A229FEB6ko7BgTCaVCMgJbedavvY71r9YQoCS8MNOwLpsOV3ltwa3ZCA6gPIGIQwBTIKPAa/ATstMYq2/rsJDkkUBBoOOqwgE7h4pyKaf4zkCA+uZ6gFPPKo9DAdcgcz9Z1BCmbEXDlhwT+QDqOKAgz8kAPEz6A0gDHhPAArYjyGAXlPPvBvQ6q2s/iH7P3iDcHIUMUks7/zb6/8qHUCO/wsBZAeQJgjV14VlN4C9AbXjrzQHgSMAckg3DtU8/b0vM3Zf5AyicEAtFwm+qvwZcNsZ0uOxVj4tP/tZAuEx81AOLX4jCFbXvr7TWvHrQWp/TwnGxCcq6VQm5ghABRK6QuDDBFgyOZvwRRHASPWjRF4vwddzAyrWRzJCoOo3/4zsv3UKJZTogX93AO/89vUvcBLQxP9pXsDWJHS1hwIXJ/sbgibbjwlAagl28T4qegGeDgssYCnGd2U9jOfFtqIMiMdvQIri/8i6Ry5DQPNoDuBQ30A6nwUvfDowr4CP4Qmhnam3LVIEvxgUr9UnBHX5Ds8aE4IlJs7Aa3eglXKGDBjgngwAoFK1VYgwsvfz66Nk4/LOv7X++cv2SrCWBPQOYCOAXA1YL+qPiJpWYCYA/FwUNi1riouKH+QAyBUY5zCt+lEVQZcOK2xB7SX0Z+r/IekMdN+p87xPaA6j5wPweD4rcIQAmHRGVQFDCrWxxzsUJgX7uZ8DiMhFHQNDkkYqHpRdMoDmoC4BQAjWFHqWALzSWycROwHlOJZ3fdv65zAEqGVAJID29+4AlvzSUFvrL2Cn9wcWglD2v4JHhQmZMIJwwE7hRetOScKOQ9hed+Iy/a6/P1D8EPht+/2vrtprl+EhOw/8/SHTLxVZmOtgQZ2T4Rg6AFHK9Ha/DD90KKzS3lFEBKBdANpkPp+10EwOCHrlDup1POItwUwuWo2Vxe+TQnM1CvRzRLG862+s/9PFVeoDSLX/9Xq5XMq8gNIDsPcD1HkC28tCytuC9vi/5QLs5KCi9hTrLz4hmIYFLBfk0GJ0BrlS97hvoIGylxT0wN+zARLQUbigCEYAMDzmNig6IUcx+wecQuQHpglgMmesYnE4AAAgAElEQVQwRwAWpPiJATln+z3oFbBRCc3flIfo2XpW03FuwAKSHUI7lwJuDPCx+isSgT6Ad33r+mcvLtfbi8tley1YIoDcDmyagbBJCN4WJMHP/QGo/jv4CzCa8pvmoR38CuQR8CfzAlRVaFBMwCbthnx7v1rQlH4EViCEx+QBwpIiqmrfLRwigHqNVqnLGXgpHntEAArQPZCzYs8RgnAE1a1YYHRVHyoY2xE1McTxeEwWihReBAHMHmM9Le/66+uf2QlgdwBpHkBxAzQfwDiAbTvzpqDa/beBYOsU3L52Dgd25aT8gKsAJJC1TkIgCRcGFMvfs/u0jux+ze2HDUY2NxCSwyAUMJTgQD9DGBluA8KYCRv0NgBjOsdcCIBQbOSjYnzW+xmV77kCre7t7Uc+ro9A384ykx/oOYPY7iuC6C/zrmAW2GW7cQixvPtb1v9+I4AN/DUMKOEAtgOXv9u04ev6Q6JV4fPPiYEDSGW9Bn6XACz7ZiA6AqgABUB3l5VBaEnCFvM64cHmPXq5garCojyo7Lo4loa9WDrhEmaAbxWbCUWrOypu8Rc6BzAmAKXe9vg4UNvVNoBb6vAzCDmXYOkHjzMCOKp1/Hds52fUXrXz+mVj8NpzWdAXp2IJyRPI8u5vXv/b/Y1AFycggBwG2EpAmhvQXhySkoEK/MYNMPjt5/1xZ4Iw4HdhgOoPiJzAWYCYty0Oo1j/mBQqNAfE0LaLlD1W/P45WFnb59m/+t2KaNijc4228etHLkCFDHWZKZURAcg2Yq3u7CBeDAG0GFo3CcXKrkAbAbmQ5B5zmIYe9Aap5Bttw26Ft13e/U3rn94IIKt/TQRe5ETgHgbYqcHmpSEpGQjKf4gQGvh9ApDyAFL1rc1vtr6fK0hrAYwm4QiEYGJuDgIYzDZP4M5hOvjw3D0IHwgRuEMwtPP6fAreKl8QuwDb/BMpPPoF+wvD3klYsKrmInYOXjWZAJSqI9D83/ExMQRRuQGlvscJwKv2TGhQCCFyFuV6l3d/4/m/urhachVgvb7Y8gDpZ8JdMrCSAYQI6dXhSAD5rUGm7JfAjDMFfViACg3g7zqBArPYCZSuQgvIsj26AASbdQMWhna7FC6U/43MPS2H3oKxgk+SwBNyBFEQoMIL3tYTAmcOyu8aiuVZ2SKyQACV+xSRAm87H/+3bzRyB0pNLaGo0MCqtyaA4yDv2/92TruddwrLu//a+b+4vFzqK8G2dwPCJKCwMajOF9hfGVbKgBH4ySGYnEAC4YnyBPsD5+2IDLTiN/W3sbxX/BbF23Ws9WnwAYW4xB/rvQBt3sevmQF4sM1EjsCCK1J/XK6A2tbzWukIRKvyk8IBRxRzdh89Ayu0KttFYNYlPkscTDhepZsXQbseATRW7nYmbf1VeKJDiG3p8u5vWP+z1AmY1Z8SgIUQQP3NlOE0UzD/glAmgqT0ojdAJAQl+I3dz25gL9OBM6jHauCs+Yi6La2LlrvEH1KAJ450VBECZCdg6KDjEDTRKJCiYxl7Bt5CKbmGvN1zJiyI3yCk5wNwoKCIQS+z3kOpdSM7TRDxPvM2PyIDDgdmE30vngAi9dcksLz69et/kjoBKwHUMqAMBUpOoBDFnhRMYUCz+Qr8eRlXBEKVL2AvNXr7uSUfM8irwjYHgI1DKgSwjT3gHNzEINybQgCO7QHwqk6gGnv0dthFOOMSZtQ9Jo/Y7mdYiW4/BFyz6DGJNJDoPe36ppga2Lx+liDG5IDqXc7tY2qr6PF2nlxG8bklBQ/c0frR8dGBLK9+3fqnLi72RqAtAdj6AEwFgPIB0BW4v0249ARI5Qcy6ILflwtLCNDgV7Ypys7uAJenEMLsWxXaVxQcQdTGICQUkSDM3YGxmjO8IzDn7WY6DTnh1/k8Un8J3ADsFnIN6HgOdg0YMtjt/NGOKP/j1R4beR4f/7Nys+L3qwOWYhCQNpR4DPjt9/Nhgj3m8upfXf+jWgW4PN1cqARg7hDMJGHbgrfGocvTzbqcL6z157jfuoINnL2koAO/yBskgJPi5/DBx/cFYAxo+kwVAWv3AeZBV6ElkkJICSx+XQZRt1fgMeqf9pkFf5l+yv4g2t9qrT9PHO8r5ecZf33lx7VouyNC6G2DYENA279bgg5B/kYRQE/de3mBBvRRjiDRTdl+efX/Xf9kKwO2MABDgpoUzGpvXhxSl209AQjyQgCvu0agdeklBZsTqIDhBKEBOQBYKv7WE2BB3iJ4sP3UbahDBp45iOqOHoBBaz+360HIaaCH4UFUVoTlEsBB4lCDXWUBFODt3pEjeIwbUMfywO2FAx7ACuwxAeikGlp+Bu0oHPAJwrm43RJAnNhr1xNvU0hgefX/Pv/7rQzY2oA30LuKABBA7RosyzYXANWA6gYMeBMZaOXHHEGGqKsMCHKAZCAnCS3wMRzIeiwSi2zlW55AATzODRjtF1UDooTAxIeewaQbWbmN+j+xUqCgzWTB23ir75U/dgneXzQV7wGdnUSc2GO3gMlBlSj0gG3XocD8YglgjhyKrvsQokMCy+m0vPpXzv9ucQCp+SfF+xd7nO9j/50URA4gdQjmHxItRLBQebACWiQEAewJdDm+r63C6XMDuX2PgLH8wgnU/VwlwBNDcx42AMAJSirmN2ptyn7aEcR5Axs6FID3t1dv91HUoJf17b7dB5XckE2d11+2ZzDrygD6DFb3Y5b/qBMYuQMGn46v58OBPph7Ci/tP/20GB7d5hUUCaRly6v/1/pvp8lAbS4AzAnYSWBvDirZ/0wAygGcLtar2hMgwc8JQV0ZSMoN/+XPFvwFpna7ppmFMJraNwIpwLahAfcVcB6B5xM4fa7EYwHM+1njr6x/FPfTGYOE4XTsPwoXur8cxKTAtNDWe4AzUBthxJY/VngmCaXidhvrDlCxEcz9+r93GLEbsADUYG5nbvE8hx8xkAvgyx7+GLhv+3t59S+v764OAN4JUBN+OSnYEoDrdf07kcHNcpneFbAnA43659LgDmAEf/D3pu8j8LNTyFl46w4A4KY8yKSRt4O+A4799ecGcBvPxyFBrN4zVQL9HoIoQHixBBA5hjjut/DGnAFSQVluXYIKDRjQ6Dp6YG+hgz1qAUc7zljpfQIwcAPwS0KKELxFt0e2yt1b58kgdhAa/NvS5dW/tL5zJ4C9AuDtfwoF0iSgPFW4/r0t253ARgCZDPYwIKu/dAMYBiDY8z7NqlsXwGEBbseVgLatbx6KQoFY7YMQARKLHtzHk4MGzBPtxZ2aAmX/Izfhge2Jw1t4a+61ytuwQIGeKUJVArzizwLfA5v1P123Vc1GSAxS5xDAelv73/a0JNOz/kgT7ZryxZlf8sVl/m/lIGLgl+++vPp/nr/m4nKbC9A6AQvoMRSA2H8H+77NBnpIAu4/MX5RqgE504+hADoB9/cGmrmQAMnAhAW7gyjqjPkCIAKT+LPgdklEU7yzvQOeMND2H3QCtaphgwMP0RjMeMbHOAALWntmdTwLa64MzIIeodqoJUr6WRhbEjnmBBqxWfi1n+zWBNEHOFt7ZfURphFJoAtQ21uXYH1Gs/498LdAYXn1f1+/quYA9nkA2eLnRqCNGPZXhOV6P/67EwEQQCGENDloy/hDEtAAXocACdi2X4BDAvyM4Hfb1ap7dhKUGEQAa/XHDsQcKphZhFHyEMID0y6MPkH/qnEvTNBGfFbd57bTxMFQL+rJVxSBXqm9Bz7uPU4Etq17wPdOIB95J1xW3raMrXtU/x8BXhOAsu4NkBy7z9j6mW20e9hCgL+4fgX3Aeygh0qAj/8TKezgL6HB1f5Ogevl6nS7TxHegZz/k+DH/oDXIfZvLsCqO24D6l6bgXxSUIcCZd8gPDBqTIlEMwcAzxeDviozzQDU8ftkPiDs/JsDuiYTVvG2lXYA3jNwVsAm9LzCe0VXZOHjdwZ2epOUpQ0mEQ9qH8PPxPkRGaDJ96FFpNL9GP9p6s8OQH3eCOB/W78M3gewzwPY7X1xAqD8Tf2zSygOIOUA9jzCXg68OF+mGLW4gALq2BE0sCdiMOBfXjefffxfgNryBiU5Z1wCTCay7oEVHtXdA72XKDRuIoOeHQaercGMHMJEo4+aV2DBfYwQeqGDygbw9r2wQCm8pRBUdeEQzAxDezSV7POE0LH9zg+o/MAR+++3xSVo0zHUYJWeVXZLFHPALyS1vPt/OX/xNh24qT5MCqLEX4n767/FATQiSI7gct3fF2hDAAX+5gJs/A+A38mghQUq/o9CgbIcY3u/bYGjrxD4/YrSi9wBdBIyQXjAxzmC5iXsX4oongL2tK8nCG34tTtoBKCThR706axuOU0fVvD2YcEoDChA8HYfQedDAQvex9l/RQCjZRa4x9X/GPAL2Szv/gvrF17CZKCdCPYuwNwMlBN+JdY3/17lHEAmghoSXJ5ubQiA4PdEwLH/Dvha+wfwQwXBgZtcA69vVty6iwb7AgZcj9N+W+iwLx20DmuXgKCL7T6v0Uofqfsx1edwIHIBfrmmCmPY3VuJmCjsMWLgM2mosEARgl5mCWAmFLB+Ymz3lVtggPJ5ewQQ7VtgjDmE3jJPEsu7//z6Ba0PwKp/6QYsOYC9VHjZ4n8AfM0HXGy5gDo5KLmApOAF1P7vZNcT0JEMjPLzNnVbtP8cKoC6S4LAPAABHCYZVUC6RGIDNNt8b/sR1n0HoEOEo44g2p4hbz/3CQDWyhmDDOhy7Dngo6NgW2913PoIb/e96nOGAD/j/seXj8jBry/2u8HWJwF76xrEHw/86gDe9efOn3+5vRIsx/yl9FfLgpdpTgDY/jRHAGx//Xy1L98JYLk4XzUXsCkmJgWbC2jgx9i/kIFalgEP1QKv9pwLaKpucwJo/znhV8godgE8qWhEAjo0YKBiLkCBWCn8jOrPbFMsOpCC+4XeiDBmw4CYDKyu+2DBx/rKCaiEIFPEnOr3E34I0ZYz8O7A0ouO/4+ovz4DHreAu/2riCKtXd71P58/73J/KWhpBU4u4GLv7kvJvp0M9lLgen1xlbL/hgQgFNjfMLy7gJwHgERgIgGbHEygKUAvJJHj/qra1h342L4pf10nOgY1UQgSEFOKo3wAgr6XHLTvEMJwowAKAWqP5EOAx5IAgpeOUe26tvYJjt498Na9vIC1+O2IHviPt/x4VKX63i2oJRFBIPgUAWi1j+J5u1wBm4GrfEEM7j4ppLXLu/7H9XN3AoAeAGgKSuqPLiCDvZIAgj/b/0ICpgpgQoEE9Jb4KwDOy43dj8BPicE9LodtYeKQJwx0BFllIUSwoFbOoCizTQaOHIGfhmxpwQLdhwwWfk/IATzyBaIzeQCv7wz04jKU4S8kY6nCAlkpvLf8SCHHQK9AjlBt59JW3G57xBH40KCdAVXdVwdY83ukYH3B8q4/u35OygFk5S9lwKL+l+ACWP0t+Hf7X3IAez/A8voFkkBK7rVQAO1/IQN0CW1ZcgnFLVhAc3/AHAlURYeXitjwgKsCCPbob9VbYG38TG4gQYRTgQz4SQKYnA7M2j6bC7Db+TDAq35s7RVoLbTVpxj8WtubXe9XAGwiz+v9yAEw9C0oj6u/phsL/TngY8CxvPPPnD+LQ4BL6PzbYv+LDejl31zm2x3A1ZLmEOTYH/7dw4DTcr5sgH8v5AFsTqARQ7b+Bey1/s/gz58hRHCkALMJnfWn2YWzwPdhAJOEzRdYGOO2ESnY5TpsUCFDXpbbnCPwegMfL5klABsa9JN9EfRV7O+tfE/TZ+J+b8+tlvdtf0QArMYM7Nj+27i/D28mD+8H2AOMPpcjLu/8H9bPvLg43V5yCACx/5b533MBu+LveYDkGK6WDegpJ1Dsf/p3dwKnPQ/w3toQ1KoBrTKArqApfKkeKOUvio9xP6u+cAHO4rcwAGcSHksS6lAgyhcoQvBaD8oeTC8uDkHBdzv3G0sAKhBQNIAQLleqrL2lhb7510D3ZNEDu03t4ZY6VEAnEG0dq72y62P119bfUsa82isyqATwtf/d+hnJAUAIsMX8HALkEmAigaT6xQHsFYGrbP+3f1siME0PXt4LpUAsCxIRbMqf4/9CFsb2jxxBjfuBHKifQCcCmQwKLLHEGKn9yAX08wSVANyPhRxPBJY9tiFbaOSxZKD3Q3g2+uGl4zxArPk+M9CjBIasNvX9UMCnCvswR+AhlL0XiAAbxfCj2N4Tx0jn9Xr8Bss7/pvzp5cQ4HJ/H8B6vYUALfGHmX/4+2qFECD9vdn+Av6Lq9P2YyO3G/j3+H2P/fPfORfQQN5yAwh8QwI1iVjCBPVvBjK0Dtc8Qg4JIgJQLqDvBmy8H6t+QAD0UlGGu53uOxf/c9YAHcJRIogIwGp9OsOYAHRtYOQHGhBHGt9zBlbB8XoTPBqsLJx1jM+WPqIDPnaDooLxGPqWTB4HfHWM5R1/ev20y4v2PgAs+212fyeDZv139b/cY/715rKEADvwKwnc5XBgCwPu1uX1BR3AeSOBnAisAOfPuXFoW28dAeUIcq5AJwuRIFDJRckwIAd8g5DKE+j16B7y37MvHDVvOEajPyIATx8cHjQIquRhZOv1UcbVAEsJI6BHQUDbr6fhDOkZiD8e9Ec0nwMDa+x7cb2H6tMMf6EjTxzLO/7r9VMvLtb9xR4p+ZdBn2v+W24gx/07Eeyfd/ufbX+J/3MIkEOBXf2Xq9Pd6SJVAgrw939LCXBXavhcS4MW+Coc8O4A8wUJ/E3to8qAXm7dgA0HEPS4XbXy+SfNMNvf4IlAbb0AZl/q0beq3q//67pAWzrnAlitPQkcI4Aj8Lehgf7kLbungFnTr91BPwRQsJ6L9DmbgHCc8wAvTvnLkZav+S/Pn9KqACkPsCl8TvLt4C8uYF9ecwA5BChEUJJ/16e7vay4hQA7AZwvE/ghD3BKFQEJfugXSCAuPQMF4HkZTBJqYA+qBSo34FRfkYFqFS75AiCGmdeO8ctF5LsF0jEb5BD+fRdg10Ylwm2YMaDVZ47ibTBxlADQwHPIwFDVbmDGAfSIIYb0nO3XoD9a2Ovp+kjhR+tH1BDtv3z1f77+vpYETC6gZP0vU8a/qn4lgBQS7HH/5fXe9ZeTgEuy/1en7d9CAFc1D1DUvuQFQP1LjgDzAiZHsIO45BIQ6Br0NvZ/ihtoJGDCAAd6jPXt31bhdTlwPgcQ6XwM+jgc6JOBNfJlW7XUqjwDPgK9zR54kI/MfboiG20rQLfjMJBx6yhXYHW6F/Nj1kDF20xD3gFoGL9R4N/OtnzVf3r+pEQAGfw1CZjBX23/9nmL/5dN3W8urlIOoGT/M/B35c9/329/ny7Peykwlfu2f4vlb9b/XAmhdQgmABfXkPoGPDnYnEADPcwlyOofE0LJDwzCAflGIeEGahMPWvxRJSBS+p4DsG5hZP81CYz9wBwJHCEAFRJo9e4X/Y7bfF8AHIGeCcLCegR4Xh+TQl+/31gC+I/Pv/fyMjf0bBOCNsXfSGDr+tvBX4Cfkn+76m9JQEEAF9e76hcSuN+cwOYOdiDvIE8EUMGdKwPJwvtcQMsbtLZhGxY0oCP4PRH08gN2XZuR2EqDXDmwLb24XQHlUx1Ag7PP7D/dATSFHnsDHQwwLfiynrbyVtNHdl85gEjxLVlYrWUHoFRc5/yZIHpuYBzRR0DuAfyp4I9Ip+YAvvJPrR+/JQG3EuBWAUhJv9P1BvIN/JUIdvXPyn+9EcZ6c7H925J/dxdX6+3+K0OJCHYHsFyttwncRf0TGaDCa1fQHEAUFiRwJHLAvxNAo3wAVwG4q3AEfKwolL8R+E35dSIQAwLc1iq6LQPyOv95PgAoxrln/1UiEN3CDAGMlT4igHnlV87BG+1jBBCB3roB9gIMVAXcX2gCmCGP5Sv+w/PHpclAadbfRgAb6Av4S9y/EwISwN4HcLq9vC5xfwZ/jv8vrncCuC8EUElAOQF0AJAsbG6hgJxDBFxeQI/235JAI4lMHKYleFwe1B2DnCjULsDG+FFI4ElgnNzz2YMetHFdL9VX0oVRTcBSgHIADYjNcVjAItARpEr5C+AiMB8BOULZO4ftGjlXUPIMRTd7ZMDbNmdwhBTamfrhQbR2Bvx7DuDL/+T5d+0hwNLAv2f+r5abqwb668vrZP1r7H992j43B7Bl/wH8ORG4EcBdCQHQCdi/W7cguoGm/MkxDBOEUDFQpcPUkMT9AQr4Nh+gm4RY9TG5x87gMZOEElRnQgCv/rxEx/rj6j9TBNKBdQRWzeesvncA5ZjewjNQLeCRWHhfD2ZPALHVH5OBBvws2EdAHa1XBHBkn+XL/oP1Yy63PoBN+bcQIMf/l9c5BNj+zUSwkcCeF7hOwK8EUMDf/t3Vf3MBy+V6l+L/13L8j7mAMkGo5AZagjAGfysncpkwrhog6DFv0EsANmIYKX+rDkRuICKApvhRvd8TwNPtf3MBbOWbVuttojDAK7tWfQVw3DKpr1LzPgE0SPvtFAGoMAGVWqXvijOYA/yLIIAjQPYZiDnnsHzpv3f+6MuLZZ8MtIcAxf5fn26utr8LAVyXrP96k4ng9iK5gBT7b+C/Xva4v9j/i+vTQ3UAmQBqInB5rWb5k9UvxIAJwaL8UDHA0iF2DKL6Q2ehs/01b9CSf3YbjPHjsKCpc8sZ+OQgAzyO+Y8RgCWB+fg/0nxebj83mjhKAB7wiVgKiNjs4/aWCGLrrxW/ncPb9t46G9vHoB/F/KP1Mxb/MQRwdJ/lS/6d9aNKErCAf7f+1zkEqARQlD8TwfVa4/8M+rvLFPdvBPCQHcBOAOdTAftrOQFYwL65ggL45gJ8GNBCAKwWmJDAgF41D2G2nxOEHBaozyr5p2y/Ajluh8ZeZfs56u/BexT/a+tfQOj13tt6Ze0biO0RME7n+N5+5vxAi7uTA4hCALVOEQC7CAYyGnuv6J4g4m0iIP+iIYAvevf5I65yGXC3/0X5r9brqwz+q5sU/yfrvzmAlvzblf/qtIF/+3e3/fm/jQQeLjIBbCTAoUAjBgR/yf7bngEuFba+gig3gD0CbPuf0jGYiMCHBQXYZT2/G8Am/ljxkQqa/VY5AFxb8gR+WbzEqz3rPdr/eQLwYUDLIKh1s2rP2x0DPOcKUOERpBb0niBOp6U6l55LmCWEN8oB8LWNAoHli951/q0XS+rxb4m/BP6dAKoD2EgAwL+TQLL/l2j9r9f7y+vlYXcBWwhweb47Lyn+T3mAkgsoroCVH/MBLQTA3gFdHeBEoSaA8mahca8AOgZfGozmBDRN7vUCMDkUILPa6wwAg3scAign0JbZTIB3AQ3IqPhWxVm5vUvA7Xt/s/Wfs/gYViiQz4JdbZeOt/8iaP2faLsIgLM5gegcIyDPEIo6xvKFX7v+5hQCbHMA1uvN/l9t9j+DP7mAFPdf7nmA0+3lzVb6yyHA9a7+95vSZ+BvDmAH/+X16dnp6nzbgJ8IIOUBGhFwdcDmBHjeAPcQ2H4BmwhMSi+TgyIXUPoHxlODZ8KBkQOwcbzX+pG9n1H/PvBbwo2Dgaa62u57RVexPapv/DeTwQwBRKFAs/ps41vmwW8zcgW/WAjgaPy/fa/lC776/JtSG/CW9MvgL/Z/cwGb/U9uYLf/V1vdP6t/tv07AewkkP7bgP9wcXN6dnF9erZcvn6TwF7Ab11AcwboBF6rk4dUglA3EcVlQqv2SAqqOjCr/Dr5Z5t/Wj4AI38Ldjb/nAPo2/tY/b3Vt0eyII9UfkwAfJwEMEUIzWm0mNoSg1d7tuYe2O1YDcgN7iqeP7rs7wUBHAXz0e2LG1j++Feuv2F3AJdb0q9Z/+QCNsCfbi5vltuNAPbYf6v97wnATfmXDfBIAA+XN7v6P9vU//Lm9Hy9eO9VUv1GApYQwA3UUMGGBVwh0L0Ctp247wSwAuDnDbQXkPas/wwBoMpzDmDkAFDhEeYW2J4A5lS/ALQHcAtka/85qacdwMjqK7W36t4HfLkmb81HRMFWvUcK7+sE8Fjw7w7g87/s/GEbAWwlv80BXN8k+7//d7PlAHbVT+Df/0vWPxHAupf+LnPcv4F/A/6m/pkAXlqX1y4S4N9TXYAjhL37D/MEcV7gMRWC+XbhXva/vIY8mB0oJgFZE68IwJKASgRqhW8gt+t7qu9j+z7AOd73YYEigQKsFl4UR6Cs/hjsvdg+AnkvBxDnAqyT8ATRcgCjDP9svN8D7hFQH9mW8wDLH/uS84duIcBOADvw1+vrDP5EAgn81QEU9b9Z7i+v1ruLm9P91fWSlX99uLxeduXP/72UgF/An/7d3cCu9vY/mxtIpNAmENFEIpxUVLsEsVyIvz3gW4b5NeN2tmBMBOplIT4hiIafy4I2GIh0vtj1eQKYAb8CcTPhSAjNIbBKN9XluB4BaR0Bxt3Wntt9RiGAjd/fJIB2P2aThI4APvcLX/+Qq8uL2633//pmcwA5D7D/u+4EgODfcgCXN9n236TYf4v5i/pf3qzPLm+WlzYCuLhen51PP5+Bnohg3YFv3UDLDxQnwF2D+DlZfTOrsJJBATo2DuH8gWL92farvoCS6OMfIFEOwHb6aa2PC389sM8RgFJ3tuz9zz4HgGRh1RvJoSm+B7aP72fcwBzIE1mp+F8ve1zcj6HF4x1ApNBHlyuQP0X99xDgj37B+Z/ZZgJuan+9xf03hQh24G9hADiA9XYD/9Vm+wv4N9t/c3q4SjF/Uv/b00YALy2Xr9/toN8AvxQnYN2ATw5ymbCBn+cP6O7BXi4gKbt6bwB3A7b2Xp8HKOt0yQ/7ARG+jyWAfkxvXwLOCh+BfmTnrcqzSs8TQM/2Ixn0/44s/S93Angq+HcC+OzPf/2fvry8uN0SgDebA7jNZLA5gE39b5r9v0rKf3dVwb/eX93sln8jgedXxfrfnl66uj29clpeuzovmwNA8AchgUsS2vkDLUegmoZ8+3CL++EVUykAAAroSURBVDkUwLIgZ/zbJKAxAWjVj+DPZT6l7PGyWOHbPrG954SftfqYsUfgq2y+dQUjy+/t/Tzoe0m8Iwm+IyQRJQY5CXg0B3BU6WeBPbtdLzxYPuvzzv/U5gA2639zs+z/7mHAzbolBHcCKMm/jQCutth/j/vX7d+HTADPrm63uH99fnW7vHx1e9r+eyXZ//KfJ4HdGVTg49++aUj1CpQ3BtlwoCi8bwyypBCVAIvi4zyAErdj/d/W+THhZ0OAluizfqAY//ZvWm8V3y+zQI8dgFZ5TQYc51vwzzkAb917BKCAGW3PDuCXAgG8LyQAdwfwhz/n9X/y+uridkv+3dxuJHC6ubrdqwHbsj0EuLpZNtW/u7peGwHs4F835X92dbs8v9pU/2ZX/pev7k6vXFy/nuN/JADrBhIBaBJoCcG4cxAJoLx5WLYM0wtD5roA2fpz7K8IwCb4uJVHE0ADvFfz7RxK/Ru4LUGwQnMI4IFdYmmO171LaLF128cvs1UAuz5ah8vV30cJAMH1S9kBsGN5TCJw+Yw/cv4ntiagHfy3y04A1zc78HfwX+/gT7H/dVb/6xL3327gT9b/6nZ96fpueWVT/qvb01tOl++5bur/cxnojQwa+I/mBLhV2L9dKH5vQNQEZBN+HOPrz9zO44t43MiLYFXlO2XnRxY/EUSk9t6y2+x+ZPObVe+B3TuDPiG8SQAWokdDgzckCfjpn/n6P745gOub8/XtXQoBbm4365/UPxHAHvfvsf/VzXp/fbs829Q/Kf/6/Pou2f7ru9MrV3ent17drq+cTxvoy38YCvx8Sgru/xVHgJWBLWmI5cFSDrTJQPdCkVwJ4NmC/sUgUcZ/3vIfaemJQK+s/XiZBWzbPlJ2julVjK/jcgR++ZsBrAhg1va/kSHALwYH8CJCgBeSA/i0P3T+x7YGoNu7083t7XJzfbvF/nseYI//r28T+K9vlx38V7fLw/Vu+9dn13fLS9cp4ffy9d36yvX98tbru9PblqvX7hL4fzaDfPt7A74lAp8cTETguwYxIahLghgCqAQgZvltzV/N+ceY36f1UNl1lb/E9Sd6y7+N8dneKzvvFR7t/yzwtaIzyBXAjzqAxxDAiAx+KYYA7zME8Ac/7fV/9Ob24vbm9ny9EcDN3XK7hQBIAJv1v7o93V/fnh6ub9eH6xTzP7++O710fXd6+ebu9Jbr7b/709uu79e3J+AXAkguYN0/RwRAvQKibbg1BJWOQZwp2HthCJf+et1+JRTAWL7pfQ/sNr7nuD599m5AJfSsbbcqbxXcO4A5oCt1j9T8TQIoYc2L7QN4nyGAT/nU8z+yxf27A7jL1YDbXflvr2+T/b/ewL9Z/7vl2fXt6dn13en5zQ7+9eWbu2UD/ltv7k9vu3k4vd9y9Z77jQDWnQTKfxgKIBFgGJAbhUTbsJowZDsES6mPXxdWynyo8tFbfjDJx8k8m85TyTyM1ft/FzKYA3oP5M0dPA34PYv/JgH8EieAT/797/21m/Lf3adE4O3mAG53F7Db/5vbZVP+++u79eHmdrHgv1/ecvNweuvt/entG/hv7s9vP59+5tT+804guQAmgVYitKVBnEWIU4jt68PGrw23qt+SegXY0b/JynNZT8X1aOf93x70bZsE3gjoPZC/SQD9rr+ogagk0zj0+IXsA3ifcQCf+MnnX3N3d0oEcJcSgDe7+q+3O/jvNuu/3t/cnZ7d3C278t/cry/fFvA/rG+/fVje/+756YNOFz97fT79NBHARgg2HIhDgdw1OJwjYF8eqgmgB3rM67eIXgO9WHf+19p6SwocpyfrjqBn8EZgfpMAPMij0l4P0DPrflkSwO/5hPf+6vv75ADu7vdqwM3N3cXdzd2m/uvdzd3ycLOp/93p+e39ksD/sLzl9uH0trtnp7ffPjt9wN2z0wdd3b7n5fPpp06JAJgEOBTQYUBT/1IaxAlBJfmH7xDEST6+xIdKz5F8qfKrd/O0WL84gAJg/JeXqdq8An16tdSbBKB7BHp9ALPAf7MKMN8RsHzc7z7/g/cPp5v73QGsexLw9m7J4D/d394vz27u1me3D8tLt/fry3cPy1vunu3gf7+75+sH3L+0/Irbh9c/4Hz6yVMigB4JRKXBEv+rSUL0GnE38Qd7+5Xql7l6GMe3Rt+WnPMKX1Q9+jft6y08gtv//SYBqJzDTKb/KAEcJYJflg7gYz72vb/y4dmm/psLWG5v7k63t3enu9u7Dfynh9v707O7DfwPp5fvHk5vuX++vu3++fL+98/XD3x4efngh5dPv+p8+vFTIgAmAZUP4N6AKP7HdwTYdwNibb/9BFjSdGXum9pbkFulb3G4BbwHuQJ4H/SFJLZ/33cJYFQJeKP6AGbLgL8YCEDF9rPLODcx0vEX0gfw0b/z/MHPn59ubvcQYFP/9fb2frm/vV/v7+5Pz+6fLS/dPZxevn92esv9S6e3Pzw/vf/Dy6e/79nLp7//+VtO/9B68RNXiQCYBEoYsP0bhQB2fkD78RCeAdisPv/mXwx6m7zzoG5ttiU2t/82m95UHoFs/36TAHRD0Wxr8C8VBzAL9veZJOBH/vb3ftBGAPfPLm/v7k63dw+nu7v70/3tw/pw/3B6fv/s9PLDS8tbH146vf3ZS+sHPH/L8sHPX1l/1ctvW37N6fLHb86nHz2dTz8mCGALBdABYGMQTxDCl4Xa2X42wccqz026kcK3hhwEeQTs2eUYy79JAG8SQNSbP0sKf08cwG/7iPMHJAew3jw8XNzd3Z/v7p8tD/fPTs8fXjq9/Oyl5a3PXz693/NX1g986a3Lr3zlbadf/cr7nf7h08WPXJ9PP3w6n34ECOAnIAwoyUDVC8CTgLi5BxW/NOew1iewl/9KLI9Kj0BWoJ4F+psOIIH7zRDAViQUYGfB/j7jAD78w197+7Pny83Ds+X2/tly9/Cw3j97aXn+7KXl5ecvn976/JX1/V552/IrXnnb+g+89f2XX/u2D/z/2zuXnYSBMAqf0YhAW1pKuQVUVDRqCG5MUBN0oRt3bnwMX8c38EmMD+DGxBgX3qKocUc0mk5NkQk/ZWw1bozMgnBpWJ5zvv8yrbfM0QLHIzieiAH4FED7ACL9xS4APQlI7wxM7+4jOvm9pKejObng+1H9K9ErA/jeslDYOrAygH9oADs7PK3piCU1b1wzWEI3mKYZnmFazDZt5KwMypkcqtki6pbzuuTiFhz34HgIGIBIf5r8YtxHEz+I+PLmXb/YP0VOXwK/xW/0e9Rn2XUZzkcRgioBoqlA9QB69ESben+GALa231O67sV0YyRupJA00yMpy2a27aDg5FHJl7xaucKaca1V4LiEi5uuAfgEQPGf1vy0xqcNPXnCy0QcJvZgyn8n9RUBKAKQbQaGj/56kqVPBgqKVzZujBL7nzGAZrOtpczYuGmxhGUzw8myTK6IUmkSi5Uqa05Mt7c4TsFxAY4ruLjr4r8vfj/1hfBF2gu8F3W8OIwzmOJRqR5mDIoABpeJxHz9N++qBKCiHwIDaKy+JWx7LO5kPb1QhDM1g9mFGttYWfP2OY7BcQKOc3Bcd7Df7XT9/VpfHPWlgo8WeVD0UUkvS3tFAIPjyN+Inv5XGcCQGUC9/hwrlQ1tbn602FjH5u7eywHHIVwcgeOsi/v+jN9v6vn1O+AG6vEwUf/kWjDVFQGEpzwdPSoD6J9UfIX2wWWiYS8BPgCAPOYxoDrtqQAAAABJRU5ErkJggg==",e}(),ni=function(){function e(t){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indiceOfRefraction=e._DefaultIndiceOfRefraction,this.indiceOfRefraction=e._DefaultIndiceOfRefraction,this._texture=null,this.texture=null,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=o.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=t}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t,n,r){if(e._areTexturesDirty&&t.texturesEnabled){if(this._texture&&Kr.a.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(n.getCaps().standardDerivatives&&this._bumpTexture&&Kr.a.ClearCoatBumpTextureEnabled&&!r&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Kr.a.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(t,n){this._isEnabled?(t.CLEARCOAT=!0,t._areTexturesDirty&&n.texturesEnabled&&(this._texture&&Kr.a.ClearCoatTextureEnabled?Wr.a.PrepareDefinesForMergedUV(this._texture,t,"CLEARCOAT_TEXTURE"):t.CLEARCOAT_TEXTURE=!1,this._bumpTexture&&Kr.a.ClearCoatBumpTextureEnabled?Wr.a.PrepareDefinesForMergedUV(this._bumpTexture,t,"CLEARCOAT_BUMP"):t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_DEFAULTIOR=this._indiceOfRefraction===e._DefaultIndiceOfRefraction,this._isTintEnabled?(t.CLEARCOAT_TINT=!0,this._tintTexture&&Kr.a.ClearCoatTintTextureEnabled?Wr.a.PrepareDefinesForMergedUV(this._tintTexture,t,"CLEARCOAT_TINT_TEXTURE"):t.CLEARCOAT_TINT_TEXTURE=!1):(t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1))):(t.CLEARCOAT=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1)},e.prototype.bindForSubMesh=function(e,t,n,r,i,o,a){if(!e.useUbo||!i||!e.isSync){this._texture&&Kr.a.ClearCoatTextureEnabled&&(e.updateFloat2("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level),Wr.a.BindTextureMatrix(this._texture,e,"clearCoat")),this._bumpTexture&&n.getCaps().standardDerivatives&&Kr.a.ClearCoatTextureEnabled&&!r&&(e.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),Wr.a.BindTextureMatrix(this._bumpTexture,e,"clearCoatBump"),t._mirroredCameraPosition?e.updateFloat2("vClearCoatTangentSpaceParams",o?1:-1,a?1:-1):e.updateFloat2("vClearCoatTangentSpaceParams",o?-1:1,a?-1:1)),this._tintTexture&&Kr.a.ClearCoatTintTextureEnabled&&(e.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),Wr.a.BindTextureMatrix(this._tintTexture,e,"clearCoatTint")),e.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var s=1-this._indiceOfRefraction,l=1+this._indiceOfRefraction,u=Math.pow(-s/l,2),c=1/this._indiceOfRefraction;e.updateFloat4("vClearCoatRefractionParams",u,c,s,l),this._isTintEnabled&&(e.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),e.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&Kr.a.ClearCoatTextureEnabled&&e.setTexture("clearCoatSampler",this._texture),this._bumpTexture&&n.getCaps().standardDerivatives&&Kr.a.ClearCoatBumpTextureEnabled&&!r&&e.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Kr.a.ClearCoatTintTextureEnabled&&e.setTexture("clearCoatTintSampler",this._tintTexture))},e.prototype.hasTexture=function(e){return this._texture===e||this._bumpTexture===e||this._tintTexture===e},e.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture),this._bumpTexture&&e.push(this._bumpTexture),this._tintTexture&&e.push(this._tintTexture)},e.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&e.push(this._tintTexture)},e.prototype.dispose=function(e){e&&(this._texture&&this._texture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._tintTexture&&this._tintTexture.dispose())},e.prototype.getClassName=function(){return"PBRClearCoatConfiguration"},e.AddFallbacks=function(e,t,n){return e.CLEARCOAT_BUMP&&t.addFallback(n++,"CLEARCOAT_BUMP"),e.CLEARCOAT_TINT&&t.addFallback(n++,"CLEARCOAT_TINT"),e.CLEARCOAT&&t.addFallback(n++,"CLEARCOAT"),n},e.AddUniforms=function(e){e.push("vClearCoatTangentSpaceParams","vClearCoatParams","vClearCoatRefractionParams","vClearCoatTintParams","clearCoatColorAtDistance","clearCoatMatrix","clearCoatBumpMatrix","clearCoatTintMatrix","vClearCoatInfos","vClearCoatBumpInfos","vClearCoatTintInfos")},e.AddSamplers=function(e){e.push("clearCoatSampler","clearCoatBumpSampler","clearCoatTintSampler")},e.PrepareUniformBuffer=function(e){e.addUniform("vClearCoatParams",2),e.addUniform("vClearCoatRefractionParams",4),e.addUniform("vClearCoatInfos",2),e.addUniform("clearCoatMatrix",16),e.addUniform("vClearCoatBumpInfos",2),e.addUniform("vClearCoatTangentSpaceParams",2),e.addUniform("clearCoatBumpMatrix",16),e.addUniform("vClearCoatTintParams",4),e.addUniform("clearCoatColorAtDistance",1),e.addUniform("vClearCoatTintInfos",2),e.addUniform("clearCoatTintMatrix",16)},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},e._DefaultIndiceOfRefraction=1.5,u.c([Object(D.c)()],e.prototype,"_isEnabled",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),u.c([Object(D.c)()],e.prototype,"intensity",void 0),u.c([Object(D.c)()],e.prototype,"roughness",void 0),u.c([Object(D.c)()],e.prototype,"_indiceOfRefraction",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indiceOfRefraction",void 0),u.c([Object(D.m)()],e.prototype,"_texture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),u.c([Object(D.m)()],e.prototype,"_bumpTexture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"bumpTexture",void 0),u.c([Object(D.c)()],e.prototype,"_isTintEnabled",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTintEnabled",void 0),u.c([Object(D.e)()],e.prototype,"tintColor",void 0),u.c([Object(D.c)()],e.prototype,"tintColorAtDistance",void 0),u.c([Object(D.c)()],e.prototype,"tintThickness",void 0),u.c([Object(D.m)()],e.prototype,"_tintTexture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"tintTexture",void 0),e}(),ri=function(){function e(e){this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new o.w(1,0),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t){return!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&Kr.a.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(e,t,n){this._isEnabled?(e.ANISOTROPIC=this._isEnabled,this._isEnabled&&!t.isVerticesDataPresent(Sn.b.TangentKind)&&(e._needUVs=!0,e.MAINUV1=!0),e._areTexturesDirty&&n.texturesEnabled&&(this._texture&&Kr.a.AnisotropicTextureEnabled?Wr.a.PrepareDefinesForMergedUV(this._texture,e,"ANISOTROPIC_TEXTURE"):e.ANISOTROPIC_TEXTURE=!1)):(e.ANISOTROPIC=!1,e.ANISOTROPIC_TEXTURE=!1)},e.prototype.bindForSubMesh=function(e,t,n){e.useUbo&&n&&e.isSync||(this._texture&&Kr.a.AnisotropicTextureEnabled&&(e.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),Wr.a.BindTextureMatrix(this._texture,e,"anisotropy")),e.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),t.texturesEnabled&&this._texture&&Kr.a.AnisotropicTextureEnabled&&e.setTexture("anisotropySampler",this._texture)},e.prototype.hasTexture=function(e){return this._texture===e},e.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},e.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},e.prototype.dispose=function(e){e&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRAnisotropicConfiguration"},e.AddFallbacks=function(e,t,n){return e.ANISOTROPIC&&t.addFallback(n++,"ANISOTROPIC"),n},e.AddUniforms=function(e){e.push("vAnisotropy","vAnisotropyInfos","anisotropyMatrix")},e.PrepareUniformBuffer=function(e){e.addUniform("vAnisotropy",3),e.addUniform("vAnisotropyInfos",2),e.addUniform("anisotropyMatrix",16)},e.AddSamplers=function(e){e.push("anisotropySampler")},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},u.c([Object(D.c)()],e.prototype,"_isEnabled",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),u.c([Object(D.c)()],e.prototype,"intensity",void 0),u.c([Object(D.n)()],e.prototype,"direction",void 0),u.c([Object(D.m)()],e.prototype,"_texture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),ii=function(){function e(t){this._useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=e.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=e.DEFAULT_USE_SPHERICAL_HARMONICS,this._internalMarkAllSubMeshesAsMiscDirty=t}return e.prototype._markAllSubMeshesAsMiscDirty=function(){this._internalMarkAllSubMeshesAsMiscDirty()},e.prototype.prepareDefines=function(e){e.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,e.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,e.SPHERICAL_HARMONICS=this._useSphericalHarmonics},e.prototype.getClassName=function(){return"PBRBRDFConfiguration"},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},e.DEFAULT_USE_ENERGY_CONSERVATION=!0,e.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,e.DEFAULT_USE_SPHERICAL_HARMONICS=!0,u.c([Object(D.c)()],e.prototype,"_useEnergyConservation",void 0),u.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useEnergyConservation",void 0),u.c([Object(D.c)()],e.prototype,"_useSmithVisibilityHeightCorrelated",void 0),u.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSmithVisibilityHeightCorrelated",void 0),u.c([Object(D.c)()],e.prototype,"_useSphericalHarmonics",void 0),u.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],e.prototype,"useSphericalHarmonics",void 0),e}(),oi=function(){function e(e){this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=o.e.White(),this._texture=null,this.texture=null,this._internalMarkAllSubMeshesAsTexturesDirty=e}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t){return!(e._areTexturesDirty&&t.texturesEnabled&&this._texture&&Kr.a.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())},e.prototype.prepareDefines=function(e,t){this._isEnabled?(e.SHEEN=this._isEnabled,e.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,e._areTexturesDirty&&t.texturesEnabled&&(this._texture&&Kr.a.SheenTextureEnabled?Wr.a.PrepareDefinesForMergedUV(this._texture,e,"SHEEN_TEXTURE"):e.SHEEN_TEXTURE=!1)):(e.SHEEN=!1,e.SHEEN_TEXTURE=!1,e.SHEEN_LINKWITHALBEDO=!1)},e.prototype.bindForSubMesh=function(e,t,n){e.useUbo&&n&&e.isSync||(this._texture&&Kr.a.SheenTextureEnabled&&(e.updateFloat2("vSheenInfos",this._texture.coordinatesIndex,this._texture.level),Wr.a.BindTextureMatrix(this._texture,e,"sheen")),e.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity)),t.texturesEnabled&&this._texture&&Kr.a.SheenTextureEnabled&&e.setTexture("sheenSampler",this._texture)},e.prototype.hasTexture=function(e){return this._texture===e},e.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},e.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},e.prototype.dispose=function(e){e&&this._texture&&this._texture.dispose()},e.prototype.getClassName=function(){return"PBRSheenConfiguration"},e.AddFallbacks=function(e,t,n){return e.SHEEN&&t.addFallback(n++,"SHEEN"),n},e.AddUniforms=function(e){e.push("vSheenColor","vSheenInfos","sheenMatrix")},e.PrepareUniformBuffer=function(e){e.addUniform("vSheenColor",4),e.addUniform("vSheenInfos",2),e.addUniform("sheenMatrix",16)},e.AddSamplers=function(e){e.push("sheenSampler")},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},u.c([Object(D.c)()],e.prototype,"_isEnabled",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),u.c([Object(D.c)()],e.prototype,"_linkSheenWithAlbedo",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkSheenWithAlbedo",void 0),u.c([Object(D.c)()],e.prototype,"intensity",void 0),u.c([Object(D.e)()],e.prototype,"color",void 0),u.c([Object(D.m)()],e.prototype,"_texture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),e}(),ai=function(){function e(e){this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isScatteringEnabled=!1,this.refractionIntensity=1,this.translucencyIntensity=1,this.scatteringIntensity=1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1,this.indexOfRefraction=1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.tintColor=o.e.White(),this.tintColorAtDistance=1,this.diffusionDistance=o.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t){if(e._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&Kr.a.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;var n=this._getRefractionTexture(t);if(n&&Kr.a.RefractionTextureEnabled&&!n.isReadyOrNotBlocking())return!1}return!0},e.prototype.prepareDefines=function(e,t){if(e._areTexturesDirty&&(e.SUBSURFACE=!1,e.SS_TRANSLUCENCY=this._isTranslucencyEnabled,e.SS_SCATERRING=this._isScatteringEnabled,e.SS_THICKNESSANDMASK_TEXTURE=!1,e.SS_MASK_FROM_THICKNESS_TEXTURE=!1,e.SS_REFRACTION=!1,e.SS_REFRACTIONMAP_3D=!1,e.SS_GAMMAREFRACTION=!1,e.SS_RGBDREFRACTION=!1,e.SS_REFRACTIONMAP_OPPOSITEZ=!1,e.SS_LODINREFRACTIONALPHA=!1,e.SS_LINKREFRACTIONTOTRANSPARENCY=!1,(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)&&(e.SUBSURFACE=!0,e._areTexturesDirty&&t.texturesEnabled&&this._thicknessTexture&&Kr.a.ThicknessTextureEnabled&&Wr.a.PrepareDefinesForMergedUV(this._thicknessTexture,e,"SS_THICKNESSANDMASK_TEXTURE"),e.SS_MASK_FROM_THICKNESS_TEXTURE=this._useMaskFromThicknessTexture),this._isRefractionEnabled&&t.texturesEnabled)){var n=this._getRefractionTexture(t);n&&Kr.a.RefractionTextureEnabled&&(e.SS_REFRACTION=!0,e.SS_REFRACTIONMAP_3D=n.isCube,e.SS_GAMMAREFRACTION=n.gammaSpace,e.SS_RGBDREFRACTION=n.isRGBD,e.SS_REFRACTIONMAP_OPPOSITEZ=n.invertZ,e.SS_LODINREFRACTIONALPHA=n.lodLevelInAlpha,e.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency)}},e.prototype.bindForSubMesh=function(e,t,n,r,i){var o=this._getRefractionTexture(t);if(!e.useUbo||!r||!e.isSync){if(this._thicknessTexture&&Kr.a.ThicknessTextureEnabled&&(e.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),Wr.a.BindTextureMatrix(this._thicknessTexture,e,"thickness")),e.updateFloat2("vThicknessParam",this.minimumThickness,this.maximumThickness-this.minimumThickness),o&&Kr.a.RefractionTextureEnabled){e.updateMatrix("refractionMatrix",o.getReflectionTextureMatrix());var a=1;o.isCube||o.depth&&(a=o.depth),e.updateFloat4("vRefractionInfos",o.level,1/this._indexOfRefraction,a,this._invertRefractionY?-1:1),e.updateFloat3("vRefractionMicrosurfaceInfos",o.getSize().width,o.lodGenerationScale,o.lodGenerationOffset)}e.updateColor3("vDiffusionDistance",this.diffusionDistance),e.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,this.tintColorAtDistance),e.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,this.scatteringIntensity)}t.texturesEnabled&&(this._thicknessTexture&&Kr.a.ThicknessTextureEnabled&&e.setTexture("thicknessSampler",this._thicknessTexture),o&&Kr.a.RefractionTextureEnabled&&(i?e.setTexture("refractionSampler",o):(e.setTexture("refractionSampler",o._lodTextureMid||o),e.setTexture("refractionSamplerLow",o._lodTextureLow||o),e.setTexture("refractionSamplerHigh",o._lodTextureHigh||o))))},e.prototype.unbind=function(e){return!(!this._refractionTexture||!this._refractionTexture.isRenderTarget)&&(e.setTexture("refractionSampler",null),!0)},e.prototype._getRefractionTexture=function(e){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?e.environmentTexture:null},Object.defineProperty(e.prototype,"disableAlphaBlending",{get:function(){return this.isRefractionEnabled&&this._linkRefractionWithTransparency},enumerable:!0,configurable:!0}),e.prototype.fillRenderTargetTextures=function(e){Kr.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&e.push(this._refractionTexture)},e.prototype.hasTexture=function(e){return this._thicknessTexture===e||this._refractionTexture===e},e.prototype.hasRenderTargetTextures=function(){return!!(Kr.a.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},e.prototype.getActiveTextures=function(e){this._thicknessTexture&&e.push(this._thicknessTexture),this._refractionTexture&&e.push(this._refractionTexture)},e.prototype.getAnimatables=function(e){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&e.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture)},e.prototype.dispose=function(e){e&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose())},e.prototype.getClassName=function(){return"PBRSubSurfaceConfiguration"},e.AddFallbacks=function(e,t,n){return e.SS_SCATERRING&&t.addFallback(n++,"SS_SCATERRING"),e.SS_TRANSLUCENCY&&t.addFallback(n++,"SS_TRANSLUCENCY"),n},e.AddUniforms=function(e){e.push("vDiffusionDistance","vTintColor","vSubSurfaceIntensity","vRefractionMicrosurfaceInfos","vRefractionInfos","vThicknessInfos","vThicknessParam","refractionMatrix","thicknessMatrix")},e.AddSamplers=function(e){e.push("thicknessSampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh")},e.PrepareUniformBuffer=function(e){e.addUniform("vRefractionMicrosurfaceInfos",3),e.addUniform("vRefractionInfos",4),e.addUniform("refractionMatrix",16),e.addUniform("vThicknessInfos",2),e.addUniform("thicknessMatrix",16),e.addUniform("vThicknessParam",2),e.addUniform("vDiffusionDistance",3),e.addUniform("vTintColor",4),e.addUniform("vSubSurfaceIntensity",3)},e.prototype.copyTo=function(e){D.a.Clone(function(){return e},this)},e.prototype.serialize=function(){return D.a.Serialize(this)},e.prototype.parse=function(e){var t=this;D.a.Parse(function(){return t},e,null)},u.c([Object(D.c)()],e.prototype,"_isRefractionEnabled",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isRefractionEnabled",void 0),u.c([Object(D.c)()],e.prototype,"_isTranslucencyEnabled",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isTranslucencyEnabled",void 0),u.c([Object(D.c)()],e.prototype,"_isScatteringEnabled",void 0),u.c([Object(D.c)()],e.prototype,"refractionIntensity",void 0),u.c([Object(D.c)()],e.prototype,"translucencyIntensity",void 0),u.c([Object(D.c)()],e.prototype,"scatteringIntensity",void 0),u.c([Object(D.m)()],e.prototype,"_thicknessTexture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"thicknessTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"refractionTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"indexOfRefraction",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertRefractionY",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkRefractionWithTransparency",void 0),u.c([Object(D.c)()],e.prototype,"minimumThickness",void 0),u.c([Object(D.c)()],e.prototype,"maximumThickness",void 0),u.c([Object(D.e)()],e.prototype,"tintColor",void 0),u.c([Object(D.c)()],e.prototype,"tintColorAtDistance",void 0),u.c([Object(D.e)()],e.prototype,"diffusionDistance",void 0),u.c([Object(D.c)()],e.prototype,"_useMaskFromThicknessTexture",void 0),u.c([Object(D.b)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useMaskFromThicknessTexture",void 0),e}();zt.a.IncludesShadersStore.pbrFragmentDeclaration="uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\n#endif\n#endif\n\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#ifdef CLEARCOAT_TEXTURE\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_TEXTURE\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif",zt.a.IncludesShadersStore.pbrUboDeclaration="layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec4 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize;\nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float pointSize;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\nuniform vec3 vAnisotropy;\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\nuniform vec4 vSheenColor;\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n};\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif\nmat4 view;\n};",zt.a.IncludesShadersStore.pbrFragmentExtraDeclaration="uniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif",zt.a.IncludesShadersStore.pbrFragmentSamplersDeclaration="#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\n#if CLEARCOAT_TEXTUREDIRECTUV == 1\n#define vClearCoatUV vMainUV1\n#elif CLEARCOAT_TEXTUREDIRECTUV == 2\n#define vClearCoatUV vMainUV2\n#else\nvarying vec2 vClearCoatUV;\n#endif\nuniform sampler2D clearCoatSampler;\n#endif\n#ifdef CLEARCOAT_BUMP\n#if CLEARCOAT_BUMPDIRECTUV == 1\n#define vClearCoatBumpUV vMainUV1\n#elif CLEARCOAT_BUMPDIRECTUV == 2\n#define vClearCoatBumpUV vMainUV2\n#else\nvarying vec2 vClearCoatBumpUV;\n#endif\nuniform sampler2D clearCoatBumpSampler;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\n#if CLEARCOAT_TINT_TEXTUREDIRECTUV == 1\n#define vClearCoatTintUV vMainUV1\n#elif CLEARCOAT_TINT_TEXTUREDIRECTUV == 2\n#define vClearCoatTintUV vMainUV2\n#else\nvarying vec2 vClearCoatTintUV;\n#endif\nuniform sampler2D clearCoatTintSampler;\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_TEXTURE\n#if SHEEN_TEXTUREDIRECTUV == 1\n#define vSheenUV vMainUV1\n#elif SHEEN_TEXTUREDIRECTUV == 2\n#define vSheenUV vMainUV2\n#else\nvarying vec2 vSheenUV;\n#endif\nuniform sampler2D sheenSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\n#if ANISOTROPIC_TEXTUREDIRECTUV == 1\n#define vAnisotropyUV vMainUV1\n#elif ANISOTROPIC_TEXTUREDIRECTUV == 2\n#define vAnisotropyUV vMainUV2\n#else\nvarying vec2 vAnisotropyUV;\n#endif\nuniform sampler2D anisotropySampler;\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 1\n#define vThicknessUV vMainUV1\n#elif SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 2\n#define vThicknessUV vMainUV2\n#else\nvarying vec2 vThicknessUV;\n#endif\nuniform sampler2D thicknessSampler;\n#endif\n#endif",n(88),zt.a.IncludesShadersStore.pbrHelperFunctions="\n#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\n\n\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\n\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\n\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\n\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\n\n\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\n\n\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\n\n\n\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\n\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\n\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n\n\n\n\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif",zt.a.IncludesShadersStore.harmonicsFunctions="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n\n\n\n\n\n\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+vSphericalL1_1*(normal.y)\n+vSphericalL10*(normal.z)\n+vSphericalL11*(normal.x)\n+vSphericalL2_2*(normal.y*normal.x)\n+vSphericalL2_1*(normal.y*normal.z)\n+vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+vSphericalL21*(normal.z*normal.x)\n+vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n\nvec3 computeEnvironmentIrradiance(vec3 normal) {\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif\n#endif",zt.a.IncludesShadersStore.pbrDirectLightingSetupFunctions="\nstruct preLightingInfo\n{\n\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\n\nfloat attenuation;\n\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\n\nresult.lightDistance=sqrt(result.lightDistanceSquared);\n\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\nresult.lightDistance=length(-lightData.xyz);\n\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\n\n\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}",zt.a.IncludesShadersStore.pbrDirectLightingFalloffFunctions="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\n\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977;\n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\n\n\n\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\n\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}",zt.a.IncludesShadersStore.pbrBRDFFunctions="\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\n\n\n\n#ifdef MS_BRDF_ENERGY_CONSERVATION\n\n\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness,sampler2D brdfSampler) {\n\nvec2 UV=vec2(NdotV,perceptualRoughness);\n\nvec4 brdfLookup=texture2D(brdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(REFLECTION)\n\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\n\n\n\n\n\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn t*t;\n#endif\n}\n#endif\n\n\n\n\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\n\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n\n\n\n\n#ifdef BRDF_V_HEIGHT_CORRELATED\n\n\n\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\n\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\n\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\n\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\n\n\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\n\n\n\nreturn 0.25/(VdotH*VdotH);\n}\n#endif\n#ifdef SHEEN\n\n\n\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n#endif\n\n\n\n\n\n\n\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\n\n\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\n\n\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\n\n\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n",zt.a.IncludesShadersStore.pbrDirectLightingFunctions="#define CLEARCOATREFLECTANCE90 1.0\n\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\n\n\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\n\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\n\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\n\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat visibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat visibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*visibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat visibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*visibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat visibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*visibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n\n\nvec3 fresnel=reflectance0;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\nvec3 sheenTerm=fresnel*distribution*visibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n",zt.a.IncludesShadersStore.pbrIBLFunctions="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal) {\n\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,normal));\nreturn square(temp);\n}\n#endif\n\n\n\n\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif",n(121),n(122),n(123),n(115),zt.a.IncludesShadersStore.pbrDebug="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w<vDebugMode.x) {\nreturn;\n}\n\n#if DEBUGMODE == 1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 3 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))\n\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 4 && (defined(BUMP) || defined(PARALLAX) || defined(ANISOTROPIC))\n\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 5\n\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE == 7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE == 8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\n\ngl_FragColor.rgb=TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 10 && defined(CLEARCOAT)\n\ngl_FragColor.rgb=clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE == 13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n\n#elif DEBUGMODE == 20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE == 21 && defined(AMBIENT)\ngl_FragColor.rgb=ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE == 22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE == 23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE == 26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearCoatMapData.rg,0.0);\n#elif DEBUGMODE == 28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearCoatTintMapData.rgb;\n#elif DEBUGMODE == 29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenMapData.rgb;\n#elif DEBUGMODE == 30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropyMapData.rgb;\n#elif DEBUGMODE == 31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=thicknessMap.rgb;\n\n#elif DEBUGMODE == 40 && defined(SS_REFRACTION)\n\ngl_FragColor.rgb=environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 41 && defined(REFLECTION)\ngl_FragColor.rgb=environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=environmentClearCoatRadiance;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 54 && defined(REFLECTION)\ngl_FragColor.rgb=environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n\n#elif DEBUGMODE == 60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 61\ngl_FragColor.rgb=specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 62\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE == 63\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE == 64\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE == 65 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 66 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearCoatRoughness);\n#elif DEBUGMODE == 67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearCoatNdotV);\n#elif DEBUGMODE == 68 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=transmittance;\n#elif DEBUGMODE == 69 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=refractionTransmittance;\n\n#elif DEBUGMODE == 70 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE == 71 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE == 72 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE == 73 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 74 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 75 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE == 76 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE == 77\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#endif",zt.a.ShadersStore.pbrPixelShader="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n\n#include<helperFunctions>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#ifdef CLEARCOAT\n\nvec3 clearCoatNormalW=normalW;\n#endif\n#include<bumpFragment>\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n#ifdef REFLECTANCE\n\n\n\n\n\nsurfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\n\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\n\nmicroSurface=saturate(microSurface);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\n\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\n\nalphaG+=AARoughnessFactors.y;\n#endif\n#ifdef ANISOTROPIC\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\nvec3 anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n#endif\n\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef SS_REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD);\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\n#ifdef SHEEN\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset)*vSheenInfos.y;\nsheenIntensity*=sheenMapData.a;\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\n\nsurfaceAlbedo.rgb*=sheenFactor;\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#endif\nfloat sheenRoughness=roughness;\n\nsheenIntensity*=(1.-reflectance);\n\nsheenColor*=sheenIntensity;\n#endif\n\n#if defined(REFLECTION)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\n\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\n\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG,NdotVUnclamped);\n#else\nfloat sheenReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,sheenAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nsheenReflectionLOD=sheenReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nenvironmentSheenRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,sheenReflectionLOD);\n#else\nfloat lodSheenReflectionNormalized=saturate(sheenReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodSheenReflectionNormalizedDoubled=lodSheenReflectionNormalized*2.0;\nvec4 environmentSheenMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodSheenReflectionNormalizedDoubled<1.0){\nenvironmentSheenRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentSheenMid,\nlodSheenReflectionNormalizedDoubled\n);\n}else{\nenvironmentSheenRadiance=mix(\nenvironmentSheenMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodSheenReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentSheenRadiance.rgb=fromRGBD(environmentSheenRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentSheenRadiance.rgb=toLinearSpace(environmentSheenRadiance.rgb);\n#endif\n\nenvironmentSheenRadiance.rgb*=vReflectionInfos.x;\nenvironmentSheenRadiance.rgb*=vReflectionColor.rgb;\n#endif\n#endif\n\n#ifdef CLEARCOAT\n\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\nclearCoatIntensity*=clearCoatMapData.x;\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\nclearCoatThickness*=clearCoatTintMapData.a;\n#endif\nclearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\n#endif\n\n\n\n\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\nspecularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,vClearCoatBumpUV,vClearCoatTangentSpaceParams);\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset).xyz*2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBN,vClearCoatBumpUV+uvOffset,clearCoatBumpSampler,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=gl_FrontFacing ? clearCoatNormalW : -clearCoatNormalW;\n#endif\n\nvec2 clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\n\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\n\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\n\nclearCoatAlphaG+=clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG,clearCoatNdotVUnclamped);\n#else\nfloat clearCoatReflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,clearCoatAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nclearCoatReflectionLOD=clearCoatReflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nfloat requestedClearCoatReflectionLOD=clearCoatReflectionLOD;\nenvironmentClearCoatRadiance=sampleReflectionLod(reflectionSampler,clearCoatReflectionCoords,requestedClearCoatReflectionLOD);\n#else\nfloat lodClearCoatReflectionNormalized=saturate(clearCoatReflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodClearCoatReflectionNormalizedDoubled=lodClearCoatReflectionNormalized*2.0;\nvec4 environmentClearCoatMid=sampleReflection(reflectionSampler,reflectionCoords);\nif(lodClearCoatReflectionNormalizedDoubled<1.0){\nenvironmentClearCoatRadiance=mix(\nsampleReflection(reflectionSamplerHigh,clearCoatReflectionCoords),\nenvironmentClearCoatMid,\nlodClearCoatReflectionNormalizedDoubled\n);\n}else{\nenvironmentClearCoatRadiance=mix(\nenvironmentClearCoatMid,\nsampleReflection(reflectionSamplerLow,clearCoatReflectionCoords),\nlodClearCoatReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentClearCoatRadiance.rgb=fromRGBD(environmentClearCoatRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentClearCoatRadiance.rgb=toLinearSpace(environmentClearCoatRadiance.rgb);\n#endif\n#ifdef CLEARCOAT_TINT\n\nvec3 clearCoatVRefract=-refract(vPositionW,clearCoatNormalW,vClearCoatRefractionParams.y);\n\nfloat clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\nvec3 absorption=vec3(0.);\n#endif\n\nenvironmentClearCoatRadiance.rgb*=vReflectionInfos.x;\nenvironmentClearCoatRadiance.rgb*=vReflectionColor.rgb;\n#endif\n#endif\n\n#if defined(ENVIRONMENTBRDF)\n\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness,environmentBrdfSampler);\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\n\nalpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_SCATTERING\nfloat scatteringIntensity=vSubSurfaceIntensity.z;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#ifdef SS_REFRACTION\nrefractionIntensity*=thicknessMap.g;\n#endif\n#ifdef SS_TRANSLUCENCY\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#ifdef SS_SCATTERING\nscatteringIntensity*=thicknessMap.a;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\n#endif\n#endif\n\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb;\n#ifdef GAMMALIGHTMAP\nlightmapColor=toLinearSpace(lightmapColor);\n#endif\nlightmapColor*=vLightmapInfos.y;\n#endif\n\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(specularEnvironmentR0,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#if defined(SHEEN) && defined(REFLECTION)\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nsheenEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nsheenEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#endif\n\n#ifdef CLEARCOAT\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness,environmentBrdfSampler);\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef RADIANCEOCCLUSION\nfloat clearCoatSeo=environmentRadianceOcclusion(ambientMonochrome,clearCoatNdotVUnclamped);\nclearCoatEnvironmentReflectance*=clearCoatSeo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\n\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatAbsorption(clearCoatNdotVRefract,clearCoatNdotVRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#ifdef REFLECTION\nenvironmentIrradiance*=absorption;\n#endif\n#ifdef SHEEN\nsheenEnvironmentReflectance*=absorption;\n#endif\nspecularEnvironmentReflectance*=absorption;\n#endif\n\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\nfloat conservationFactor=(1.-fresnelIBLClearCoat);\n#ifdef REFLECTION\nenvironmentIrradiance*=conservationFactor;\n#endif\n#ifdef SHEEN\nsheenEnvironmentReflectance*=(conservationFactor*conservationFactor);\n#endif\nspecularEnvironmentReflectance*=(conservationFactor*conservationFactor);\n#endif\n\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\n\n\n\n\n\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\n\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\n\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\n\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n\nsurfaceAlbedo*=(1.-refractionIntensity);\n\nenvironmentIrradiance*=(1.-refractionIntensity);\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n\nrefractionTransmittance*=1.0-specularEnvironmentReflectance;\n#endif\n\n#if defined(REFLECTION) && defined(USESPHERICALFROMREFLECTIONMAP) && defined(SS_TRANSLUCENCY)\n#if defined(USESPHERICALINVERTEX)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#endif\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\nrefractionIrradiance*=transmittance;\n#endif\n\n\n\n#ifndef METALLICWORKFLOW\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(SS_TRANSLUCENCY)\nfinalIrradiance+=refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance.rgb;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#endif\n\n#ifdef SS_REFRACTION\nvec3 finalRefraction=environmentRefraction.rgb;\nfinalRefraction*=refractionTransmittance;\n#endif\n\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\n\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=energyConservationFactor;\n#endif\n\n#ifdef REFLECTION\nvec3 finalClearCoatRadiance=environmentClearCoatRadiance.rgb;\nfinalClearCoatRadiance*=clearCoatEnvironmentReflectance;\n\nvec3 finalClearCoatRadianceScaled=finalClearCoatRadiance*vLightingIntensity.z;\n#endif\n#ifdef SS_REFRACTION\nfinalRefraction*=(conservationFactor*conservationFactor);\n#ifdef CLEARCOAT_TINT\nfinalRefraction*=absorption;\n#endif\n#endif\n#endif\n\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n\n\n\n\n\n#ifdef REFLECTION\nvec3 finalSheenRadiance=environmentSheenRadiance.rgb;\nfinalSheenRadiance*=sheenEnvironmentReflectance;\n\nvec3 finalSheenRadianceScaled=finalSheenRadiance*vLightingIntensity.z;\n#endif\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n#endif\n\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=ambientOcclusionColor;\n#endif\n\n\n\nvec4 finalColor=vec4(\nfinalAmbient*ambientOcclusionColor +\nfinalDiffuse*ambientOcclusionForDirectDiffuse*vLightingIntensity.x +\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef CLEARCOAT\n\n\nfinalClearCoatScaled +\n#endif\n#ifdef SHEEN\n\n\nfinalSheenScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#ifdef CLEARCOAT\n\n\nfinalClearCoatRadianceScaled +\n#endif\n#ifdef SHEEN\n\n\nfinalSheenRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\ngl_FragColor=finalColor;\n#include<pbrDebug>\n}\n",zt.a.IncludesShadersStore.pbrVertexDeclaration="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nuniform vec2 vClearCoatInfos;\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_TEXTURE\nuniform vec2 vSheenInfos;\nuniform mat4 sheenMatrix;\n#endif\n#endif\n\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;;\n#endif\n#endif\n",n(124),n(101),n(102),n(103),n(125),n(118),zt.a.ShadersStore.pbrVertexShader="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatUV;\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nvarying vec2 vClearCoatBumpUV;\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nvarying vec2 vClearCoatTintUV;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nvarying vec2 vSheenUV;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nvarying vec2 vAnisotropyUV;\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nvarying vec2 vThicknessUV;\n#endif\n#endif\n\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\n#ifdef REFLECTIONMAP_SKYBOX_TRANSFORMED\nvPositionUVW=(reflectionMatrix*vec4(positionUpdated,1.0)).xyz;\n#else\nvPositionUVW=positionUpdated;\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n} else {\ngl_Position=viewProjectionR*finalWorld*vec4(positionUpdated,1.0);\n}\n#else\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) && CLEARCOAT_TEXTUREDIRECTUV == 0\nif (vClearCoatInfos.x == 0.)\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvClearCoatUV=vec2(clearCoatMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_BUMP) && CLEARCOAT_BUMPDIRECTUV == 0\nif (vClearCoatBumpInfos.x == 0.)\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvClearCoatBumpUV=vec2(clearCoatBumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(CLEARCOAT_TINT_TEXTURE) && CLEARCOAT_TINT_TEXTUREDIRECTUV == 0\nif (vClearCoatTintInfos.x == 0.)\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvClearCoatTintUV=vec2(clearCoatTintMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) && SHEEN_TEXTUREDIRECTUV == 0\nif (vSheenInfos.x == 0.)\n{\nvSheenUV=vec2(sheenMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSheenUV=vec2(sheenMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef ANISOTROPIC\n#if defined(ANISOTROPIC_TEXTURE) && ANISOTROPIC_TEXTUREDIRECTUV == 0\nif (vAnisotropyInfos.x == 0.)\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAnisotropyUV=vec2(anisotropyMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n#ifdef SUBSURFACE\n#if defined(SS_THICKNESSANDMASK_TEXTURE) && SS_THICKNESSANDMASK_TEXTUREDIRECTUV == 0\nif (vThicknessInfos.x == 0.)\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvThicknessUV=vec2(thicknessMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";var si=function(e){function t(){var t=e.call(this)||this;return t.PBR=!0,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.ALBEDO=!1,t.ALBEDODIRECTUV=0,t.VERTEXCOLOR=!1,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.AMBIENTINGRAYSCALE=!1,t.OPACITY=!1,t.VERTEXALPHA=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHABLEND=!1,t.ALPHAFROMALBEDO=!1,t.ALPHATESTVALUE="0.5",t.SPECULAROVERALPHA=!1,t.RADIANCEOVERALPHA=!1,t.ALPHAFRESNEL=!1,t.LINEARALPHAFRESNEL=!1,t.PREMULTIPLYALPHA=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITY=!1,t.REFLECTIVITYDIRECTUV=0,t.SPECULARTERM=!1,t.MICROSURFACEFROMREFLECTIVITYMAP=!1,t.MICROSURFACEAUTOMATIC=!1,t.LODBASEDMICROSFURACE=!1,t.MICROSURFACEMAP=!1,t.MICROSURFACEMAPDIRECTUV=0,t.METALLICWORKFLOW=!1,t.ROUGHNESSSTOREINMETALMAPALPHA=!1,t.ROUGHNESSSTOREINMETALMAPGREEN=!1,t.METALLNESSSTOREINMETALMAPBLUE=!1,t.AOSTOREINMETALMAPRED=!1,t.ENVIRONMENTBRDF=!1,t.ENVIRONMENTBRDF_RGBD=!1,t.NORMAL=!1,t.TANGENT=!1,t.BUMP=!1,t.BUMPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.NORMALXYSCALE=!0,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.USELIGHTMAPASSHADOWMAP=!1,t.GAMMALIGHTMAP=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.SPHERICAL_HARMONICS=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.RADIANCEOCCLUSION=!1,t.HORIZONOCCLUSION=!1,t.INSTANCES=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.BONETEXTURE=!1,t.NONUNIFORMSCALING=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.MULTIVIEW=!1,t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.POINTSIZE=!1,t.FOG=!1,t.LOGARITHMICDEPTH=!1,t.FORCENORMALFORWARD=!1,t.SPECULARAA=!1,t.CLEARCOAT=!1,t.CLEARCOAT_DEFAULTIOR=!1,t.CLEARCOAT_TEXTURE=!1,t.CLEARCOAT_TEXTUREDIRECTUV=0,t.CLEARCOAT_BUMP=!1,t.CLEARCOAT_BUMPDIRECTUV=0,t.CLEARCOAT_TINT=!1,t.CLEARCOAT_TINT_TEXTURE=!1,t.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,t.ANISOTROPIC=!1,t.ANISOTROPIC_TEXTURE=!1,t.ANISOTROPIC_TEXTUREDIRECTUV=0,t.BRDF_V_HEIGHT_CORRELATED=!1,t.MS_BRDF_ENERGY_CONSERVATION=!1,t.SHEEN=!1,t.SHEEN_TEXTURE=!1,t.SHEEN_TEXTUREDIRECTUV=0,t.SHEEN_LINKWITHALBEDO=!1,t.SUBSURFACE=!1,t.SS_REFRACTION=!1,t.SS_TRANSLUCENCY=!1,t.SS_SCATERRING=!1,t.SS_THICKNESSANDMASK_TEXTURE=!1,t.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,t.SS_REFRACTIONMAP_3D=!1,t.SS_REFRACTIONMAP_OPPOSITEZ=!1,t.SS_LODINREFRACTIONALPHA=!1,t.SS_GAMMAREFRACTION=!1,t.SS_RGBDREFRACTION=!1,t.SS_LINKREFRACTIONTOTRANSPARENCY=!1,t.SS_MASK_FROM_THICKNESS_TEXTURE=!1,t.UNLIT=!1,t.DEBUGMODE=0,t.rebuild(),t}return u.d(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE="0.5",this.PBR=!0},t}(Xr.a),li=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i._directIntensity=1,i._emissiveIntensity=1,i._environmentIntensity=1,i._specularIntensity=1,i._lightingInfos=new o.y(i._directIntensity,i._emissiveIntensity,i._environmentIntensity,i._specularIntensity),i._disableBumpMap=!1,i._albedoTexture=null,i._ambientTexture=null,i._ambientTextureStrength=1,i._ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,i._opacityTexture=null,i._reflectionTexture=null,i._emissiveTexture=null,i._reflectivityTexture=null,i._metallicTexture=null,i._metallic=null,i._roughness=null,i._microSurfaceTexture=null,i._bumpTexture=null,i._lightmapTexture=null,i._ambientColor=new o.e(0,0,0),i._albedoColor=new o.e(1,1,1),i._reflectivityColor=new o.e(1,1,1),i._reflectionColor=new o.e(1,1,1),i._emissiveColor=new o.e(0,0,0),i._microSurface=.9,i._useLightmapAsShadowmap=!1,i._useHorizonOcclusion=!0,i._useRadianceOcclusion=!0,i._useAlphaFromAlbedoTexture=!1,i._useSpecularOverAlpha=!0,i._useMicroSurfaceFromReflectivityMapAlpha=!1,i._useRoughnessFromMetallicTextureAlpha=!0,i._useRoughnessFromMetallicTextureGreen=!1,i._useMetallnessFromMetallicTextureBlue=!1,i._useAmbientOcclusionFromMetallicTextureRed=!1,i._useAmbientInGrayScale=!1,i._useAutoMicroSurfaceFromReflectivityMap=!1,i._lightFalloff=t.LIGHTFALLOFF_PHYSICAL,i._useRadianceOverAlpha=!0,i._useObjectSpaceNormalMap=!1,i._useParallax=!1,i._useParallaxOcclusion=!1,i._parallaxScaleBias=.05,i._disableLighting=!1,i._maxSimultaneousLights=4,i._invertNormalMapX=!1,i._invertNormalMapY=!1,i._twoSidedLighting=!1,i._alphaCutOff=.4,i._forceAlphaTest=!1,i._useAlphaFresnel=!1,i._useLinearAlphaFresnel=!1,i._transparencyMode=null,i._environmentBRDFTexture=null,i._forceIrradianceInFragment=!1,i._forceNormalForward=!1,i._enableSpecularAntiAliasing=!1,i._imageProcessingObserver=null,i._renderTargets=new Gt.a(16),i._globalAmbientColor=new o.e(0,0,0),i._useLogarithmicDepth=!1,i._unlit=!1,i._debugMode=0,i.debugMode=0,i.debugLimit=-1,i.debugFactor=1,i.clearCoat=new ni(i._markAllSubMeshesAsTexturesDirty.bind(i)),i.anisotropy=new ri(i._markAllSubMeshesAsTexturesDirty.bind(i)),i.brdf=new ii(i._markAllSubMeshesAsMiscDirty.bind(i)),i.sheen=new oi(i._markAllSubMeshesAsTexturesDirty.bind(i)),i.subSurface=new ai(i._markAllSubMeshesAsTexturesDirty.bind(i)),i._attachImageProcessingConfiguration(null),i.getRenderTargetTextures=function(){return i._renderTargets.reset(),Kr.a.ReflectionTextureEnabled&&i._reflectionTexture&&i._reflectionTexture.isRenderTarget&&i._renderTargets.push(i._reflectionTexture),i.subSurface.fillRenderTargetTextures(i._renderTargets),i._renderTargets},i._environmentBRDFTexture=ti.GetEnvironmentBRDFTexture(r),i}return u.d(t,e),t.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){t._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!!(Kr.a.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this.subSurface.hasRenderTargetTextures()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===t.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_disableAlphaBlending",{get:function(){return this.subSurface.disableAlphaBlending||this._transparencyMode===t.PBRMATERIAL_OPAQUE||this._transparencyMode===t.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),t.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},t.prototype.needAlphaBlendingForMesh=function(t){return!(this._disableAlphaBlending&&t.visibility>=1)&&e.prototype.needAlphaBlendingForMesh.call(this,t)},t.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this.subSurface.disableAlphaBlending&&null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===t.PBRMATERIAL_ALPHATEST)},t.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==t.PBRMATERIAL_OPAQUE},t.prototype.getAlphaTestTexture=function(){return this._albedoTexture},t.prototype.isReadyForSubMesh=function(e,t,n){if(t.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new si);var r=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&r._renderId===this.getScene().getRenderId())return!0;var i=this.getScene(),o=i.getEngine();if(r._areTexturesDirty&&i.texturesEnabled){if(this._albedoTexture&&Kr.a.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Kr.a.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Kr.a.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;var a=this._getReflectionTexture();if(a&&Kr.a.ReflectionTextureEnabled&&!a.isReadyOrNotBlocking())return!1;if(this._lightmapTexture&&Kr.a.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Kr.a.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Kr.a.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(o.getCaps().standardDerivatives&&this._bumpTexture&&Kr.a.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Kr.a.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(!(this.subSurface.isReadyForSubMesh(r,i)&&this.clearCoat.isReadyForSubMesh(r,i,o,this._disableBumpMap)&&this.sheen.isReadyForSubMesh(r,i)&&this.anisotropy.isReadyForSubMesh(r,i)))return!1;if(r._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;o.getCaps().standardDerivatives||e.isVerticesDataPresent(Sn.b.NormalKind)||(e.createNormals(!0),p.a.Warn("PBRMaterial: Normals have been created for the mesh: "+e.name));var s=t.effect,l=this._prepareEffect(e,r,this.onCompiled,this.onError,n);return l&&(this.allowShaderHotSwapping&&s&&!l.isReady()?(l=s,r.markAsUnprocessed()):(i.resetCachedMaterial(),t.setEffect(l,r),this.buildUniformLayout())),!(!t.effect||!t.effect.isReady())&&(r._renderId=i.getRenderId(),this._wasPreviouslyReady=!0,!0)},t.prototype.isMetallicWorkflow=function(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)},t.prototype._prepareEffect=function(e,t,n,r,i,o){if(void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),void 0===o&&(o=null),this._prepareDefines(e,t,i,o),!t.isDirty)return null;t.markAsProcessed();var a=this.getScene().getEngine(),s=new zt.c,l=0;t.USESPHERICALINVERTEX&&s.addFallback(l++,"USESPHERICALINVERTEX"),t.FOG&&s.addFallback(l,"FOG"),t.SPECULARAA&&s.addFallback(l,"SPECULARAA"),t.POINTSIZE&&s.addFallback(l,"POINTSIZE"),t.LOGARITHMICDEPTH&&s.addFallback(l,"LOGARITHMICDEPTH"),t.PARALLAX&&s.addFallback(l,"PARALLAX"),t.PARALLAXOCCLUSION&&s.addFallback(l++,"PARALLAXOCCLUSION"),l=ri.AddFallbacks(t,s,l),l=ri.AddFallbacks(t,s,l),l=ai.AddFallbacks(t,s,l),l=oi.AddFallbacks(t,s,l),t.ENVIRONMENTBRDF&&s.addFallback(l++,"ENVIRONMENTBRDF"),t.TANGENT&&s.addFallback(l++,"TANGENT"),t.BUMP&&s.addFallback(l++,"BUMP"),l=Wr.a.HandleFallbacksForShadows(t,s,this._maxSimultaneousLights,l++),t.SPECULARTERM&&s.addFallback(l++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&s.addFallback(l++,"USESPHERICALFROMREFLECTIONMAP"),t.LIGHTMAP&&s.addFallback(l++,"LIGHTMAP"),t.NORMAL&&s.addFallback(l++,"NORMAL"),t.AMBIENT&&s.addFallback(l++,"AMBIENT"),t.EMISSIVE&&s.addFallback(l++,"EMISSIVE"),t.VERTEXCOLOR&&s.addFallback(l++,"VERTEXCOLOR"),t.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(l++,e),t.MORPHTARGETS&&s.addFallback(l++,"MORPHTARGETS"),t.MULTIVIEW&&s.addFallback(0,"MULTIVIEW");var u=[Sn.b.PositionKind];t.NORMAL&&u.push(Sn.b.NormalKind),t.TANGENT&&u.push(Sn.b.TangentKind),t.UV1&&u.push(Sn.b.UVKind),t.UV2&&u.push(Sn.b.UV2Kind),t.VERTEXCOLOR&&u.push(Sn.b.ColorKind),Wr.a.PrepareAttributesForBones(u,e,t,s),Wr.a.PrepareAttributesForInstances(u,t),Wr.a.PrepareAttributesForMorphTargets(u,e,t);var c="pbr",h=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode"],d=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler","boneSampler"],f=["Material","Scene"];ai.AddUniforms(h),ai.AddSamplers(d),ni.AddUniforms(h),ni.AddSamplers(d),ri.AddUniforms(h),ri.AddSamplers(d),oi.AddUniforms(h),oi.AddSamplers(d),vn.a&&(vn.a.PrepareUniforms(h,t),vn.a.PrepareSamplers(d,t)),Wr.a.PrepareUniformsAndSamplersList({uniformsNames:h,uniformBuffersNames:f,samplers:d,defines:t,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(c=this.customShaderNameResolve(c,h,f,d,t));var p=t.toString();return a.createEffect(c,{attributes:u,uniformsNames:h,uniformBuffersNames:f,samplers:d,defines:p,fallbacks:s,onCompiled:n,onError:r,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS}},a)},t.prototype._prepareDefines=function(e,n,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var o=this.getScene(),a=o.getEngine();if(Wr.a.PrepareDefinesForLights(o,e,n,!0,this._maxSimultaneousLights,this._disableLighting),n._needNormals=!0,Wr.a.PrepareDefinesForMultiview(o,n),n.METALLICWORKFLOW=this.isMetallicWorkflow(),n._areTexturesDirty){if(n._needUVs=!1,o.texturesEnabled){o.getEngine().getCaps().textureLOD&&(n.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Kr.a.DiffuseTextureEnabled?Wr.a.PrepareDefinesForMergedUV(this._albedoTexture,n,"ALBEDO"):n.ALBEDO=!1,this._ambientTexture&&Kr.a.AmbientTextureEnabled?(Wr.a.PrepareDefinesForMergedUV(this._ambientTexture,n,"AMBIENT"),n.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):n.AMBIENT=!1,this._opacityTexture&&Kr.a.OpacityTextureEnabled?(Wr.a.PrepareDefinesForMergedUV(this._opacityTexture,n,"OPACITY"),n.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):n.OPACITY=!1;var s=this._getReflectionTexture();if(s&&Kr.a.ReflectionTextureEnabled){switch(n.REFLECTION=!0,n.GAMMAREFLECTION=s.gammaSpace,n.RGBDREFLECTION=s.isRGBD,n.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!s.invertZ:s.invertZ,n.LODINREFLECTIONALPHA=s.lodLevelInAlpha,s.coordinatesMode===Ge.a.INVCUBIC_MODE&&(n.INVERTCUBICMAP=!0),n.REFLECTIONMAP_3D=s.isCube,n.REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,s.coordinatesMode){case Ge.a.EXPLICIT_MODE:n.REFLECTIONMAP_EXPLICIT=!0;break;case Ge.a.PLANAR_MODE:n.REFLECTIONMAP_PLANAR=!0;break;case Ge.a.PROJECTION_MODE:n.REFLECTIONMAP_PROJECTION=!0;break;case Ge.a.SKYBOX_MODE:n.REFLECTIONMAP_SKYBOX=!0;break;case Ge.a.SPHERICAL_MODE:n.REFLECTIONMAP_SPHERICAL=!0;break;case Ge.a.EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MODE:n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Ge.a.CUBIC_MODE:case Ge.a.INVCUBIC_MODE:default:n.REFLECTIONMAP_CUBIC=!0,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!!s.boundingBoxSize}s.coordinatesMode!==Ge.a.SKYBOX_MODE?s.sphericalPolynomial&&(n.USESPHERICALFROMREFLECTIONMAP=!0,this._forceIrradianceInFragment||o.getEngine().getCaps().maxVaryingVectors<=8?n.USESPHERICALINVERTEX=!1:n.USESPHERICALINVERTEX=!0):n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!s.getReflectionTextureMatrix().isIdentity()}else n.REFLECTION=!1,n.REFLECTIONMAP_3D=!1,n.REFLECTIONMAP_SPHERICAL=!1,n.REFLECTIONMAP_PLANAR=!1,n.REFLECTIONMAP_CUBIC=!1,n.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,n.REFLECTIONMAP_PROJECTION=!1,n.REFLECTIONMAP_SKYBOX=!1,n.REFLECTIONMAP_SKYBOX_TRANSFORMED=!1,n.REFLECTIONMAP_EXPLICIT=!1,n.REFLECTIONMAP_EQUIRECTANGULAR=!1,n.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,n.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,n.INVERTCUBICMAP=!1,n.USESPHERICALFROMREFLECTIONMAP=!1,n.USESPHERICALINVERTEX=!1,n.REFLECTIONMAP_OPPOSITEZ=!1,n.LODINREFLECTIONALPHA=!1,n.GAMMAREFLECTION=!1,n.RGBDREFLECTION=!1;this._lightmapTexture&&Kr.a.LightmapTextureEnabled?(Wr.a.PrepareDefinesForMergedUV(this._lightmapTexture,n,"LIGHTMAP"),n.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,n.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace):n.LIGHTMAP=!1,this._emissiveTexture&&Kr.a.EmissiveTextureEnabled?Wr.a.PrepareDefinesForMergedUV(this._emissiveTexture,n,"EMISSIVE"):n.EMISSIVE=!1,Kr.a.SpecularTextureEnabled?(this._metallicTexture?(Wr.a.PrepareDefinesForMergedUV(this._metallicTexture,n,"REFLECTIVITY"),n.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,n.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,n.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,n.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed):this._reflectivityTexture?(Wr.a.PrepareDefinesForMergedUV(this._reflectivityTexture,n,"REFLECTIVITY"),n.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,n.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap):n.REFLECTIVITY=!1,this._microSurfaceTexture?Wr.a.PrepareDefinesForMergedUV(this._microSurfaceTexture,n,"MICROSURFACEMAP"):n.MICROSURFACEMAP=!1):(n.REFLECTIVITY=!1,n.MICROSURFACEMAP=!1),o.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&Kr.a.BumpTextureEnabled&&!this._disableBumpMap?(Wr.a.PrepareDefinesForMergedUV(this._bumpTexture,n,"BUMP"),this._useParallax&&this._albedoTexture&&Kr.a.DiffuseTextureEnabled?(n.PARALLAX=!0,n.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):n.PARALLAX=!1,n.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):n.BUMP=!1,this._environmentBRDFTexture&&Kr.a.ReflectionTextureEnabled?(n.ENVIRONMENTBRDF=!0,n.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(n.ENVIRONMENTBRDF=!1,n.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?n.ALPHAFROMALBEDO=!0:n.ALPHAFROMALBEDO=!1}n.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===t.LIGHTFALLOFF_STANDARD?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===t.LIGHTFALLOFF_GLTF?(n.USEPHYSICALLIGHTFALLOFF=!1,n.USEGLTFLIGHTFALLOFF=!0):(n.USEPHYSICALLIGHTFALLOFF=!0,n.USEGLTFLIGHTFALLOFF=!1),n.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?n.TWOSIDEDLIGHTING=!0:n.TWOSIDEDLIGHTING=!1,n.ALPHATESTVALUE=this._alphaCutOff+(this._alphaCutOff%1==0?".":""),n.PREMULTIPLYALPHA=this.alphaMode===m.a.ALPHA_PREMULTIPLIED||this.alphaMode===m.a.ALPHA_PREMULTIPLIED_PORTERDUFF,n.ALPHABLEND=this.needAlphaBlendingForMesh(e),n.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,n.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel,n.SPECULARAA=o.getEngine().getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}n._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(n),n.FORCENORMALFORWARD=this._forceNormalForward,n.RADIANCEOCCLUSION=this._useRadianceOcclusion,n.HORIZONOCCLUSION=this._useHorizonOcclusion,n._areMiscDirty&&(Wr.a.PrepareDefinesForMisc(e,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,n),n.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!e.isVerticesDataPresent(Sn.b.NormalKind),n.DEBUGMODE=this._debugMode),this.subSurface.prepareDefines(n,o),this.clearCoat.prepareDefines(n,o),this.anisotropy.prepareDefines(n,e,o),this.brdf.prepareDefines(n),this.sheen.prepareDefines(n,o),Wr.a.PrepareDefinesForFrameBoundValues(o,a,n,!!r,i),Wr.a.PrepareDefinesForAttributes(e,n,!0,!0,!0,this._transparencyMode!==t.PBRMATERIAL_OPAQUE)},t.prototype.forceCompilation=function(e,t,n){var r=this,i=u.a({clipPlane:!1},n),o=new si,a=this._prepareEffect(e,o,void 0,void 0,void 0,i.clipPlane);a.isReady()?t&&t(this):a.onCompileObservable.add(function(){t&&t(r)})},t.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("vAlbedoInfos",2),e.addUniform("vAmbientInfos",4),e.addUniform("vOpacityInfos",2),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vReflectivityInfos",3),e.addUniform("vMicroSurfaceSamplerInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vBumpInfos",3),e.addUniform("albedoMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("reflectivityMatrix",16),e.addUniform("microSurfaceSamplerMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("reflectionMatrix",16),e.addUniform("vReflectionColor",3),e.addUniform("vAlbedoColor",4),e.addUniform("vLightingIntensity",4),e.addUniform("vReflectionMicrosurfaceInfos",3),e.addUniform("pointSize",1),e.addUniform("vReflectivityColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),ni.PrepareUniformBuffer(e),ri.PrepareUniformBuffer(e),oi.PrepareUniformBuffer(e),ai.PrepareUniformBuffer(e),e.create()},t.prototype.unbind=function(){if(this._activeEffect){var t=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),t=!0),this.subSurface.unbind(this._activeEffect)&&(t=!0),t&&this._markAllSubMeshesAsTexturesDirty()}e.prototype.unbind.call(this)},t.prototype.bindForSubMesh=function(e,n,r){var i=this.getScene(),a=r._materialDefines;if(a){var s=r.effect;if(s){this._activeEffect=s,a.INSTANCES||this.bindOnlyWorldMatrix(e),a.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var l=this._mustRebind(i,s,n.visibility);Wr.a.BindBonesParameters(n,this._activeEffect);var u=null,c=this._uniformBuffer;if(l){var h=i.getEngine();if(c.bindToEffect(s,"Material"),this.bindViewProjection(s),u=this._getReflectionTexture(),!c.useUbo||!this.isFrozen||!c.isSync){if(i.texturesEnabled){if(this._albedoTexture&&Kr.a.DiffuseTextureEnabled&&(c.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),Wr.a.BindTextureMatrix(this._albedoTexture,c,"albedo")),this._ambientTexture&&Kr.a.AmbientTextureEnabled&&(c.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),Wr.a.BindTextureMatrix(this._ambientTexture,c,"ambient")),this._opacityTexture&&Kr.a.OpacityTextureEnabled&&(c.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),Wr.a.BindTextureMatrix(this._opacityTexture,c,"opacity")),u&&Kr.a.ReflectionTextureEnabled){if(c.updateMatrix("reflectionMatrix",u.getReflectionTextureMatrix()),c.updateFloat2("vReflectionInfos",u.level,0),u.boundingBoxSize){var d=u;c.updateVector3("vReflectionPosition",d.boundingBoxPosition),c.updateVector3("vReflectionSize",d.boundingBoxSize)}var f=u.sphericalPolynomial;if(a.USESPHERICALFROMREFLECTIONMAP&&f)if(a.SPHERICAL_HARMONICS){var p=f.preScaledHarmonics;this._activeEffect.setVector3("vSphericalL00",p.l00),this._activeEffect.setVector3("vSphericalL1_1",p.l1_1),this._activeEffect.setVector3("vSphericalL10",p.l10),this._activeEffect.setVector3("vSphericalL11",p.l11),this._activeEffect.setVector3("vSphericalL2_2",p.l2_2),this._activeEffect.setVector3("vSphericalL2_1",p.l2_1),this._activeEffect.setVector3("vSphericalL20",p.l20),this._activeEffect.setVector3("vSphericalL21",p.l21),this._activeEffect.setVector3("vSphericalL22",p.l22)}else this._activeEffect.setFloat3("vSphericalX",f.x.x,f.x.y,f.x.z),this._activeEffect.setFloat3("vSphericalY",f.y.x,f.y.y,f.y.z),this._activeEffect.setFloat3("vSphericalZ",f.z.x,f.z.y,f.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",f.xx.x-f.zz.x,f.xx.y-f.zz.y,f.xx.z-f.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",f.yy.x-f.zz.x,f.yy.y-f.zz.y,f.yy.z-f.zz.z),this._activeEffect.setFloat3("vSphericalZZ",f.zz.x,f.zz.y,f.zz.z),this._activeEffect.setFloat3("vSphericalXY",f.xy.x,f.xy.y,f.xy.z),this._activeEffect.setFloat3("vSphericalYZ",f.yz.x,f.yz.y,f.yz.z),this._activeEffect.setFloat3("vSphericalZX",f.zx.x,f.zx.y,f.zx.z);c.updateFloat3("vReflectionMicrosurfaceInfos",u.getSize().width,u.lodGenerationScale,u.lodGenerationOffset)}this._emissiveTexture&&Kr.a.EmissiveTextureEnabled&&(c.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),Wr.a.BindTextureMatrix(this._emissiveTexture,c,"emissive")),this._lightmapTexture&&Kr.a.LightmapTextureEnabled&&(c.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),Wr.a.BindTextureMatrix(this._lightmapTexture,c,"lightmap")),Kr.a.SpecularTextureEnabled&&(this._metallicTexture?(c.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),Wr.a.BindTextureMatrix(this._metallicTexture,c,"reflectivity")):this._reflectivityTexture&&(c.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),Wr.a.BindTextureMatrix(this._reflectivityTexture,c,"reflectivity")),this._microSurfaceTexture&&(c.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),Wr.a.BindTextureMatrix(this._microSurfaceTexture,c,"microSurfaceSampler"))),this._bumpTexture&&h.getCaps().standardDerivatives&&Kr.a.BumpTextureEnabled&&!this._disableBumpMap&&(c.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),Wr.a.BindTextureMatrix(this._bumpTexture,c,"bump"),i._mirroredCameraPosition?c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):c.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}this.pointsCloud&&c.updateFloat("pointSize",this.pointSize),a.METALLICWORKFLOW?(o.t.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,o.t.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,c.updateColor4("vReflectivityColor",o.t.Color3[0],0)):c.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),c.updateColor3("vEmissiveColor",Kr.a.EmissiveTextureEnabled?this._emissiveColor:o.e.BlackReadOnly),c.updateColor3("vReflectionColor",this._reflectionColor),c.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),c.updateFloat("visibility",n.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,c.updateVector4("vLightingIntensity",this._lightingInfos)}i.texturesEnabled&&(this._albedoTexture&&Kr.a.DiffuseTextureEnabled&&c.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&Kr.a.AmbientTextureEnabled&&c.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Kr.a.OpacityTextureEnabled&&c.setTexture("opacitySampler",this._opacityTexture),u&&Kr.a.ReflectionTextureEnabled&&(a.LODBASEDMICROSFURACE?c.setTexture("reflectionSampler",u):(c.setTexture("reflectionSampler",u._lodTextureMid||u),c.setTexture("reflectionSamplerLow",u._lodTextureLow||u),c.setTexture("reflectionSamplerHigh",u._lodTextureHigh||u))),a.ENVIRONMENTBRDF&&c.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Kr.a.EmissiveTextureEnabled&&c.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Kr.a.LightmapTextureEnabled&&c.setTexture("lightmapSampler",this._lightmapTexture),Kr.a.SpecularTextureEnabled&&(this._metallicTexture?c.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&c.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&c.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&h.getCaps().standardDerivatives&&Kr.a.BumpTextureEnabled&&!this._disableBumpMap&&c.setTexture("bumpSampler",this._bumpTexture)),this.subSurface.bindForSubMesh(c,i,h,this.isFrozen,a.LODBASEDMICROSFURACE),this.clearCoat.bindForSubMesh(c,i,h,this._disableBumpMap,this.isFrozen,this._invertNormalMapX,this._invertNormalMapY),this.anisotropy.bindForSubMesh(c,i,this.isFrozen),this.sheen.bindForSubMesh(c,i,this.isFrozen),Wr.a.BindClipPlane(this._activeEffect,i),i.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var m=i._forcedViewPosition?i._forcedViewPosition:i._mirroredCameraPosition?i._mirroredCameraPosition:i.activeCamera.globalPosition,g=i.useRightHandedSystem===(null!=i._mirroredCameraPosition);s.setFloat4("vEyePosition",m.x,m.y,m.z,g?-1:1),s.setColor3("vAmbientColor",this._globalAmbientColor),s.setFloat2("vDebugMode",this.debugLimit,this.debugFactor)}!l&&this.isFrozen||(i.lightsEnabled&&!this._disableLighting&&Wr.a.BindLights(i,n,this._activeEffect,a,this._maxSimultaneousLights,this._lightFalloff!==t.LIGHTFALLOFF_STANDARD),(i.fogEnabled&&n.applyFog&&i.fogMode!==W.a.FOGMODE_NONE||u)&&this.bindView(s),Wr.a.BindFogParameters(i,n,this._activeEffect,!0),a.NUM_MORPH_INFLUENCERS&&Wr.a.BindMorphTargetParameters(n,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),Wr.a.BindLogDepth(a,this._activeEffect,i)),c.update(),this._afterBind(n,this._activeEffect)}}},t.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this.subSurface.getAnimatables(e),this.clearCoat.getAnimatables(e),this.sheen.getAnimatables(e),this.anisotropy.getAnimatables(e),e},t.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._albedoTexture&&t.push(this._albedoTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._reflectivityTexture&&t.push(this._reflectivityTexture),this._metallicTexture&&t.push(this._metallicTexture),this._microSurfaceTexture&&t.push(this._microSurfaceTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this.subSurface.getActiveTextures(t),this.clearCoat.getActiveTextures(t),this.sheen.getActiveTextures(t),this.anisotropy.getActiveTextures(t),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._albedoTexture===t||this._ambientTexture===t||this._opacityTexture===t||this._reflectionTexture===t||this._reflectivityTexture===t||this._metallicTexture===t||this._microSurfaceTexture===t||this._bumpTexture===t||this._lightmapTexture===t||this.subSurface.hasTexture(t)||this.clearCoat.hasTexture(t)||this.sheen.hasTexture(t)||this.anisotropy.hasTexture(t)},t.prototype.dispose=function(t,n){n&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose()),this.subSurface.dispose(n),this.clearCoat.dispose(n),this.sheen.dispose(n),this.anisotropy.dispose(n),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t,n)},t.PBRMATERIAL_OPAQUE=0,t.PBRMATERIAL_ALPHATEST=1,t.PBRMATERIAL_ALPHABLEND=2,t.PBRMATERIAL_ALPHATESTANDBLEND=3,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,t.LIGHTFALLOFF_PHYSICAL=0,t.LIGHTFALLOFF_GLTF=1,t.LIGHTFALLOFF_STANDARD=2,u.c([Object(D.i)()],t.prototype,"_imageProcessingConfiguration",void 0),u.c([Object(D.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"debugMode",void 0),u.c([Object(D.c)()],t.prototype,"useLogarithmicDepth",null),u.c([Object(D.c)()],t.prototype,"transparencyMode",null),t}(Yr.a),ui=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.directIntensity=1,i.emissiveIntensity=1,i.environmentIntensity=1,i.specularIntensity=1,i.disableBumpMap=!1,i.ambientTextureStrength=1,i.ambientTextureImpactOnAnalyticalLights=t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,i.ambientColor=new o.e(0,0,0),i.albedoColor=new o.e(1,1,1),i.reflectivityColor=new o.e(1,1,1),i.reflectionColor=new o.e(1,1,1),i.emissiveColor=new o.e(0,0,0),i.microSurface=1,i.useLightmapAsShadowmap=!1,i.useAlphaFromAlbedoTexture=!1,i.forceAlphaTest=!1,i.alphaCutOff=.4,i.useSpecularOverAlpha=!0,i.useMicroSurfaceFromReflectivityMapAlpha=!1,i.useRoughnessFromMetallicTextureAlpha=!0,i.useRoughnessFromMetallicTextureGreen=!1,i.useMetallnessFromMetallicTextureBlue=!1,i.useAmbientOcclusionFromMetallicTextureRed=!1,i.useAmbientInGrayScale=!1,i.useAutoMicroSurfaceFromReflectivityMap=!1,i.useRadianceOverAlpha=!0,i.useObjectSpaceNormalMap=!1,i.useParallax=!1,i.useParallaxOcclusion=!1,i.parallaxScaleBias=.05,i.disableLighting=!1,i.forceIrradianceInFragment=!1,i.maxSimultaneousLights=4,i.invertNormalMapX=!1,i.invertNormalMapY=!1,i.twoSidedLighting=!1,i.useAlphaFresnel=!1,i.useLinearAlphaFresnel=!1,i.environmentBRDFTexture=null,i.forceNormalForward=!1,i.enableSpecularAntiAliasing=!1,i.useHorizonOcclusion=!0,i.useRadianceOcclusion=!0,i.unlit=!1,i._environmentBRDFTexture=ti.GetEnvironmentBRDFTexture(r),i}return u.d(t,e),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this.subSurface.refractionTexture},set:function(e){this.subSurface.refractionTexture=e,e?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexOfRefraction",{get:function(){return 1/this.subSurface.indexOfRefraction},set:function(e){this.subSurface.indexOfRefraction=1/e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invertRefractionY",{get:function(){return this.subSurface.invertRefractionY},set:function(e){this.subSurface.invertRefractionY=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkRefractionWithTransparency",{get:function(){return this.subSurface.linkRefractionWithTransparency},set:function(e){this.subSurface.linkRefractionWithTransparency=e,e&&(this.subSurface.isRefractionEnabled=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePhysicalLightFalloff",{get:function(){return this._lightFalloff===li.LIGHTFALLOFF_PHYSICAL},set:function(e){e!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?li.LIGHTFALLOFF_PHYSICAL:li.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useGLTFLightFalloff",{get:function(){return this._lightFalloff===li.LIGHTFALLOFF_GLTF},set:function(e){e!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=e?li.LIGHTFALLOFF_GLTF:li.LIGHTFALLOFF_STANDARD)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRMaterial"},t.prototype.clone=function(e){var n=this,r=D.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),r},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.PBRMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e},t.Parse=function(e,n,r){var i=D.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&i.clearCoat.parse(e.clearCoat),e.anisotropy&&i.anisotropy.parse(e.anisotropy),e.brdf&&i.brdf.parse(e.brdf),e.sheen&&i.sheen.parse(e.brdf),i},t.PBRMATERIAL_OPAQUE=li.PBRMATERIAL_OPAQUE,t.PBRMATERIAL_ALPHATEST=li.PBRMATERIAL_ALPHATEST,t.PBRMATERIAL_ALPHABLEND=li.PBRMATERIAL_ALPHABLEND,t.PBRMATERIAL_ALPHATESTANDBLEND=li.PBRMATERIAL_ALPHATESTANDBLEND,t.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=li.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"opacityTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),u.c([Object(D.e)("ambient"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),u.c([Object(D.e)("albedo"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),u.c([Object(D.e)("reflectivity"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),u.c([Object(D.e)("reflection"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),u.c([Object(D.e)("emissive"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"forceAlphaTest",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"alphaCutOff",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),u.c([Object(D.c)()],t.prototype,"usePhysicalLightFalloff",null),u.c([Object(D.c)()],t.prototype,"useGLTFLightFalloff",null),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useObjectSpaceNormalMap",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"enableSpecularAntiAliasing",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsMiscDirty")],t.prototype,"unlit",void 0),t}(li);a.a.RegisteredTypes["BABYLON.PBRMaterial"]=ui;var ci=n(62),hi=n(71);function di(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var fi=di("DXT1"),pi=di("DXT3"),mi=di("DXT5"),gi=di("DX10"),_i=function(){function e(){}return e.GetDDSInfo=function(e){var t=new Int32Array(e,0,31),n=new Int32Array(e,0,35),r=1;131072&t[2]&&(r=Math.max(1,t[7]));var i=t[21],o=i===gi?n[32]:0,a=m.a.TEXTURETYPE_UNSIGNED_INT;switch(i){case 113:a=m.a.TEXTURETYPE_HALF_FLOAT;break;case 116:a=m.a.TEXTURETYPE_FLOAT;break;case gi:if(10===o){a=m.a.TEXTURETYPE_HALF_FLOAT;break}}return{width:t[4],height:t[3],mipmapCount:r,isFourCC:4==(4&t[20]),isRGB:64==(64&t[20]),isLuminance:131072==(131072&t[20]),isCube:512==(512&t[28]),isCompressed:i===fi||i===pi||i===mi,dxgiFormat:o,textureType:a}},e._ToHalfFloat=function(t){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=t;var n=e._Int32View[0],r=n>>16&32768,i=n>>12&2047,o=n>>23&255;return o<103?r:o>142?(r|=31744,r|=(255==o?0:1)&&8388607&n):o<113?r|=((i|=2048)>>114-o)+(i>>113-o&1):(r|=o-112<<10|i>>1,r+=1&i)},e._FromHalfFloat=function(e){var t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0===n?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==n?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))},e._GetHalfFloatAsFloatRGBAArrayBuffer=function(t,n,r,i,o,a){for(var s=new Float32Array(i),l=new Uint16Array(o,r),u=0,c=0;c<n;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=e._FromHalfFloat(l[d]),s[u+1]=e._FromHalfFloat(l[d+1]),s[u+2]=e._FromHalfFloat(l[d+2]),e.StoreLODInAlphaChannel?s[u+3]=a:s[u+3]=e._FromHalfFloat(l[d+3]),u+=4}return s},e._GetHalfFloatRGBAArrayBuffer=function(t,n,r,i,o,a){if(e.StoreLODInAlphaChannel){for(var s=new Uint16Array(i),l=new Uint16Array(o,r),u=0,c=0;c<n;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=l[d],s[u+1]=l[d+1],s[u+2]=l[d+2],s[u+3]=e._ToHalfFloat(a),u+=4}return s}return new Uint16Array(o,r,i)},e._GetFloatRGBAArrayBuffer=function(t,n,r,i,o,a){if(e.StoreLODInAlphaChannel){for(var s=new Float32Array(i),l=new Float32Array(o,r),u=0,c=0;c<n;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=l[d],s[u+1]=l[d+1],s[u+2]=l[d+2],s[u+3]=a,u+=4}return s}return new Float32Array(o,r,i)},e._GetFloatAsUIntRGBAArrayBuffer=function(t,n,r,i,o,a){for(var s=new Uint8Array(i),l=new Float32Array(o,r),u=0,c=0;c<n;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=255*I.a.Clamp(l[d]),s[u+1]=255*I.a.Clamp(l[d+1]),s[u+2]=255*I.a.Clamp(l[d+2]),e.StoreLODInAlphaChannel?s[u+3]=a:s[u+3]=255*I.a.Clamp(l[d+3]),u+=4}return s},e._GetHalfFloatAsUIntRGBAArrayBuffer=function(t,n,r,i,o,a){for(var s=new Uint8Array(i),l=new Uint16Array(o,r),u=0,c=0;c<n;c++)for(var h=0;h<t;h++){var d=4*(h+c*t);s[u]=255*I.a.Clamp(e._FromHalfFloat(l[d])),s[u+1]=255*I.a.Clamp(e._FromHalfFloat(l[d+1])),s[u+2]=255*I.a.Clamp(e._FromHalfFloat(l[d+2])),e.StoreLODInAlphaChannel?s[u+3]=a:s[u+3]=255*I.a.Clamp(e._FromHalfFloat(l[d+3])),u+=4}return s},e._GetRGBAArrayBuffer=function(e,t,n,r,i,o,a,s,l){for(var u=new Uint8Array(r),c=new Uint8Array(i,n),h=0,d=0;d<t;d++)for(var f=0;f<e;f++){var p=4*(f+d*e);u[h]=c[p+o],u[h+1]=c[p+a],u[h+2]=c[p+s],u[h+3]=c[p+l],h+=4}return u},e._ExtractLongWordOrder=function(t){return 0===t||255===t||-16777216===t?0:1+e._ExtractLongWordOrder(t>>8)},e._GetRGBArrayBuffer=function(e,t,n,r,i,o,a,s){for(var l=new Uint8Array(r),u=new Uint8Array(i,n),c=0,h=0;h<t;h++)for(var d=0;d<e;d++){var f=3*(d+h*e);l[c]=u[f+o],l[c+1]=u[f+a],l[c+2]=u[f+s],c+=3}return l},e._GetLuminanceArrayBuffer=function(e,t,n,r,i){for(var o=new Uint8Array(r),a=new Uint8Array(i,n),s=0,l=0;l<t;l++)for(var u=0;u<e;u++){var c=u+l*e;o[s]=a[c],s++}return o},e.UploadDDSLevels=function(t,n,r,i,o,a,s,l){void 0===s&&(s=-1);var u=null;i.sphericalPolynomial&&(u=new Array);var c,h,d,f,g,_,v,y=t.getCaps().s3tc,b=new Int32Array(r,0,31),E=0,x=0,T=1;if(542327876===b[0])if(i.isFourCC||i.isRGB||i.isLuminance)if(!i.isCompressed||y){var S=b[22];f=b[1]+4;var A,P=!1;if(i.isFourCC)switch(c=b[21]){case fi:T=8,x=y.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case pi:T=16,x=y.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case mi:T=16,x=y.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:P=!0;break;case gi:f+=20;var M=!1;switch(i.dxgiFormat){case 10:P=!0,M=!0;break;case 88:i.isRGB=!0,i.isFourCC=!1,S=32,M=!0}if(M)break;default:return void console.error("Unsupported FourCC code:",(A=c,String.fromCharCode(255&A,A>>8&255,A>>16&255,A>>24&255)))}var R=e._ExtractLongWordOrder(b[23]),C=e._ExtractLongWordOrder(b[24]),w=e._ExtractLongWordOrder(b[25]),O=e._ExtractLongWordOrder(b[26]);P&&(x=t._getRGBABufferInternalSizedFormat(i.textureType)),_=1,131072&b[2]&&!1!==o&&(_=Math.max(1,b[7]));for(var I=l||0;I<a;I++){for(h=b[4],d=b[3],v=0;v<_;++v){if(-1===s||s===v){var D=-1===s?v:0;if(!i.isCompressed&&i.isFourCC){n.format=m.a.TEXTUREFORMAT_RGBA,E=h*d*4;var L=null;t._badOS||t._badDesktopOS||!t.getCaps().textureHalfFloat&&!t.getCaps().textureFloat?(128===S?(L=e._GetFloatAsUIntRGBAArrayBuffer(h,d,f,E,r,D),u&&0==D&&u.push(e._GetFloatRGBAArrayBuffer(h,d,f,E,r,D))):64===S&&(L=e._GetHalfFloatAsUIntRGBAArrayBuffer(h,d,f,E,r,D),u&&0==D&&u.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(h,d,f,E,r,D))),n.type=m.a.TEXTURETYPE_UNSIGNED_INT):128===S?(n.type=m.a.TEXTURETYPE_FLOAT,L=e._GetFloatRGBAArrayBuffer(h,d,f,E,r,D),u&&0==D&&u.push(L)):64!==S||t.getCaps().textureHalfFloat?(n.type=m.a.TEXTURETYPE_HALF_FLOAT,L=e._GetHalfFloatRGBAArrayBuffer(h,d,f,E,r,D),u&&0==D&&u.push(e._GetHalfFloatAsFloatRGBAArrayBuffer(h,d,f,E,r,D))):(n.type=m.a.TEXTURETYPE_FLOAT,L=e._GetHalfFloatAsFloatRGBAArrayBuffer(h,d,f,E,r,D),u&&0==D&&u.push(L)),L&&t._uploadDataToTextureDirectly(n,L,I,D)}else if(i.isRGB)n.type=m.a.TEXTURETYPE_UNSIGNED_INT,24===S?(n.format=m.a.TEXTUREFORMAT_RGB,E=h*d*3,g=e._GetRGBArrayBuffer(h,d,f,E,r,R,C,w),t._uploadDataToTextureDirectly(n,g,I,D)):(n.format=m.a.TEXTUREFORMAT_RGBA,E=h*d*4,g=e._GetRGBAArrayBuffer(h,d,f,E,r,R,C,w,O),t._uploadDataToTextureDirectly(n,g,I,D));else if(i.isLuminance){var F=t._getUnpackAlignement(),N=h;E=Math.floor((h+F-1)/F)*F*(d-1)+N,g=e._GetLuminanceArrayBuffer(h,d,f,E,r),n.format=m.a.TEXTUREFORMAT_LUMINANCE,n.type=m.a.TEXTURETYPE_UNSIGNED_INT,t._uploadDataToTextureDirectly(n,g,I,D)}else E=Math.max(4,h)/4*Math.max(4,d)/4*T,g=new Uint8Array(r,f,E),n.type=m.a.TEXTURETYPE_UNSIGNED_INT,t._uploadCompressedDataToTextureDirectly(n,x,h,d,g,I,D)}f+=S?h*d*(S/8):E,h*=.5,d*=.5,h=Math.max(1,h),d=Math.max(1,d)}if(void 0!==l)break}u&&u.length>0?i.sphericalPolynomial=hi.a.ConvertCubeMapToSphericalPolynomial({size:b[4],right:u[0],left:u[1],up:u[2],down:u[3],front:u[4],back:u[5],format:m.a.TEXTUREFORMAT_RGBA,type:m.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):i.sphericalPolynomial=void 0}else p.a.Error("Compressed textures are not supported on this platform.");else p.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else p.a.Error("Invalid magic number in DDS header")},e.StoreLODInAlphaChannel=!1,e}();ge.b.prototype.createPrefilteredCubeTexture=function(e,t,n,r,i,o,a,s,l){var u=this;return void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=!0),this.createCubeTexture(e,t,null,!1,function(e){if(e){var o=e.texture;if(l?e.info.sphericalPolynomial&&(o._sphericalPolynomial=e.info.sphericalPolynomial):o._sphericalPolynomial=new ci.b,o._dataSource=ze.a.DATASOURCE_CUBEPREFILTERED,u.getCaps().textureLOD)i&&i(o);else{var a=u._gl,s=e.width;if(s){for(var c=[],h=0;h<3;h++){var d=1-h/2,f=r,m=I.a.Log2(s)*n+r,g=f+(m-f)*d,_=Math.round(Math.min(Math.max(g,0),m)),v=new ze.a(u,ze.a.DATASOURCE_TEMP);if(v.type=o.type,v.format=o.format,v.width=Math.pow(2,Math.max(I.a.Log2(s)-_,0)),v.height=v.width,v.isCube=!0,u._bindTextureDirectly(a.TEXTURE_CUBE_MAP,v,!0),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e.isDDS){var y=e.info,b=e.data;u._unpackFlipY(y.isCompressed),_i.UploadDDSLevels(u,v,b,y,!0,6,_)}else p.a.Warn("DDS is the only prefiltered cube map supported so far.");u._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null);var E=new Gr.a(t);E.isCube=!0,E._texture=v,v.isReady=!0,c.push(E)}o._lodTextureHigh=c[2],o._lodTextureMid=c[1],o._lodTextureLow=c[0],i&&i(o)}}}else i&&i(null)},o,a,s,l,n,r)};var vi=function(){function e(){this.supportCascades=!0}return e.prototype.canLoad=function(e,t,n,r,i){return 0===e.indexOf(".dds")},e.prototype.transformUrl=function(e,t){return e},e.prototype.getFallbackTextureUrl=function(e,t){return null},e.prototype.loadCubeData=function(e,t,n,r,i){var o,a=t.getEngine(),s=!1;if(Array.isArray(e))for(var l=0;l<e.length;l++){var u=e[l];o=_i.GetDDSInfo(u),t.width=o.width,t.height=o.height,s=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&t.generateMipMaps,a._unpackFlipY(o.isCompressed),_i.UploadDDSLevels(a,t,u,o,s,6,-1,l),o.isFourCC||1!==o.mipmapCount||a.generateMipMapsForCubemap(t)}else{var c=e;o=_i.GetDDSInfo(c),t.width=o.width,t.height=o.height,n&&(o.sphericalPolynomial=new ci.b),s=(o.isRGB||o.isLuminance||o.mipmapCount>1)&&t.generateMipMaps,a._unpackFlipY(o.isCompressed),_i.UploadDDSLevels(a,t,c,o,s,6),o.isFourCC||1!==o.mipmapCount||a.generateMipMapsForCubemap(t)}a._setCubeMapTextureParams(s),t.isReady=!0,r&&r({isDDS:!0,width:t.width,info:o,data:e,texture:t})},e.prototype.loadData=function(e,t,n){var r=_i.GetDDSInfo(e),i=(r.isRGB||r.isLuminance||r.mipmapCount>1)&&t.generateMipMaps&&r.width>>r.mipmapCount-1==1;n(r.width,r.height,i,r.isFourCC,function(){_i.UploadDDSLevels(t.getEngine(),t,e,r,i,1)})},e}();ge.b._TextureLoaders.push(new vi),zt.a.ShadersStore.rgbdEncodePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\nvoid main(void)\n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}";var yi=function(){function e(){}return e.GetEnvInfo=function(t){for(var n=new DataView(t),r=0,i=0;i<e._MagicBytes.length;i++)if(n.getUint8(r++)!==e._MagicBytes[i])return p.a.Error("Not a babylon environment map"),null;for(var o="",a=0;a=n.getUint8(r++);)o+=String.fromCharCode(a);var s=JSON.parse(o);return s.specular&&(s.specular.specularDataPosition=r,s.specular.lodGenerationScale=s.specular.lodGenerationScale||.8),s},e.CreateEnvTextureAsync=function(t){var n=this,r=t.getInternalTexture();if(!r)return Promise.reject("The cube texture is invalid.");if(!t._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var i=r.getEngine();if(i&&i.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(t.textureType===m.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=i.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var a=m.a.TEXTURETYPE_FLOAT;if(!i.getCaps().textureFloatRender&&(a=m.a.TEXTURETYPE_HALF_FLOAT,!i.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var s=r.width,l=new W.a(i),u={},c=[],h=I.a.Log2(r.width);h=Math.round(h);for(var d=function(e){for(var n=Math.pow(2,h-e),r=function(r){var s=t.readPixels(r,e),h=i.createRawTexture(s,n,n,m.a.TEXTUREFORMAT_RGBA,!1,!1,m.a.TEXTURE_NEAREST_SAMPLINGMODE,null,a),d=new Promise(function(t,a){var s=new jt("rgbdEncode","rgbdEncode",null,null,1,null,m.a.TEXTURE_NEAREST_SAMPLINGMODE,i,!1,void 0,m.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);s.getEffect().executeWhenCompiled(function(){s.onApply=function(e){e._bindTexture("textureSampler",h)};var a=i.getRenderWidth(),c=i.getRenderHeight();i.setSize(n,n),l.postProcessManager.directRender([s],null),ye.h.ToBlob(o,function(n){var i=new FileReader;i.onload=function(n){var i=n.target.result;u[6*e+r]=i,t()},i.readAsArrayBuffer(n)}),i.setSize(a,c)})});c.push(d)},s=0;s<6;s++)r(s)},f=0;f<=h;f++)d(f);return Promise.all(c).then(function(){l.dispose();for(var r={version:1,width:s,irradiance:n._CreateEnvTextureIrradiance(t),specular:{mipmaps:[],lodGenerationScale:t.lodGenerationScale}},i=0,o=0;o<=h;o++)for(var a=0;a<6;a++){var c=u[6*o+a].byteLength;r.specular.mipmaps.push({length:c,position:i}),i+=c}for(var d=JSON.stringify(r),f=new ArrayBuffer(d.length+1),p=new Uint8Array(f),m=(o=0,d.length);o<m;o++)p[o]=d.charCodeAt(o);p[d.length]=0;var g=e._MagicBytes.length+i+f.byteLength,_=new ArrayBuffer(g),v=new Uint8Array(_),y=new DataView(_),b=0;for(o=0;o<e._MagicBytes.length;o++)y.setUint8(b++,e._MagicBytes[o]);for(v.set(new Uint8Array(f),b),b+=f.byteLength,o=0;o<=h;o++)for(a=0;a<6;a++){var E=u[6*o+a];v.set(new Uint8Array(E),b),b+=E.byteLength}return _})},e._CreateEnvTextureIrradiance=function(e){var t=e.sphericalPolynomial;return null==t?null:{x:[t.x.x,t.x.y,t.x.z],y:[t.y.x,t.y.y,t.y.z],z:[t.z.x,t.z.y,t.z.z],xx:[t.xx.x,t.xx.y,t.xx.z],yy:[t.yy.x,t.yy.y,t.yy.z],zz:[t.zz.x,t.zz.y,t.zz.z],yz:[t.yz.x,t.yz.y,t.yz.z],zx:[t.zx.x,t.zx.y,t.zx.z],xy:[t.xy.x,t.xy.y,t.xy.z]}},e.UploadEnvLevelsAsync=function(t,n,r){if(1!==r.version)throw new Error('Unsupported babylon environment map version "'+r.version+'"');var i=r.specular;if(!i)return Promise.resolve();var o=I.a.Log2(r.width);if(o=Math.round(o)+1,i.mipmaps.length!==6*o)throw new Error('Unsupported specular mipmaps number "'+i.mipmaps.length+'"');t._lodGenerationScale=i.lodGenerationScale;for(var a=new Array(o),s=0;s<o;s++){a[s]=new Array(6);for(var l=0;l<6;l++){var u=i.mipmaps[6*s+l];a[s][l]=new Uint8Array(n,i.specularDataPosition+u.position,u.length)}}return e.UploadLevelsAsync(t,a)},e.UploadLevelsAsync=function(e,t){if(!ye.h.IsExponentOfTwo(e.width))throw new Error("Texture size must be a power of two");var n=Math.round(I.a.Log2(e.width))+1,r=e.getEngine(),i=!1,o=!1,a=null,s=null,l=null,u=r.getCaps();if(e.format=m.a.TEXTUREFORMAT_RGBA,e.type=m.a.TEXTURETYPE_UNSIGNED_INT,e.generateMipMaps=!0,r.updateTextureSamplingMode(m.a.TEXTURE_TRILINEAR_SAMPLINGMODE,e),u.textureLOD?r.webGLVersion<2?i=!1:u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering?(i=!0,e.type=m.a.TEXTURETYPE_HALF_FLOAT):u.textureFloatRender&&u.textureFloatLinearFiltering&&(i=!0,e.type=m.a.TEXTURETYPE_FLOAT):(i=!1,o=!0,l={}),i)a=new jt("rgbdDecode","rgbdDecode",null,null,1,null,m.a.TEXTURE_TRILINEAR_SAMPLINGMODE,r,!1,void 0,e.type,void 0,null,!1),e._isRGBD=!1,e.invertY=!1,s=r.createRenderTargetCubeTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:m.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:e.type,format:m.a.TEXTUREFORMAT_RGBA});else if(e._isRGBD=!0,e.invertY=!0,o)for(var c=e._lodGenerationScale,h=e._lodGenerationOffset,d=0;d<3;d++){var f=(n-1)*c+h,p=h+(f-h)*(1-d/2),g=Math.round(Math.min(Math.max(p,0),f)),_=new ze.a(r,ze.a.DATASOURCE_TEMP);_.isCube=!0,_.invertY=!0,_.generateMipMaps=!1,r.updateTextureSamplingMode(m.a.TEXTURE_LINEAR_LINEAR,_);var v=new Gr.a(null);switch(v.isCube=!0,v._texture=_,l[g]=v,d){case 0:e._lodTextureLow=v;break;case 1:e._lodTextureMid=v;break;case 2:e._lodTextureHigh=v}}var y=[],b=function(n){for(var u=function(u){var c=t[n][u],h=new Blob([c],{type:"image/png"}),d=URL.createObjectURL(h),f=new Image;f.src=d;var p=new Promise(function(t,c){f.onload=function(){if(i){var h=r.createTexture(null,!0,!0,null,m.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(e){c(e)},f);a.getEffect().executeWhenCompiled(function(){a.onApply=function(e){e._bindTexture("textureSampler",h),e.setFloat2("scale",1,1)},r.scenes[0].postProcessManager.directRender([a],s,!0,u,n),r.restoreDefaultFramebuffer(),h.dispose(),window.URL.revokeObjectURL(d),t()})}else{if(r._uploadImageToTexture(e,f,u,n),o){var p=l[n];p&&r._uploadImageToTexture(p._texture,f,u,0)}t()}},f.onerror=function(e){c(e)}});y.push(p)},c=0;c<6;c++)u(c)};for(d=0;d<t.length;d++)b(d);if(t.length<n){var E=void 0,x=Math.pow(2,n-1-t.length),T=x*x*4;switch(e.type){case m.a.TEXTURETYPE_UNSIGNED_INT:E=new Uint8Array(T);break;case m.a.TEXTURETYPE_HALF_FLOAT:E=new Uint16Array(T);break;case m.a.TEXTURETYPE_FLOAT:E=new Float32Array(T)}for(d=t.length;d<n;d++)for(var S=0;S<6;S++)r._uploadArrayBufferViewToTexture(e,E,S,d)}return Promise.all(y).then(function(){s&&(r._releaseFramebufferObjects(s),s._swapAndDie(e)),a&&a.dispose(),o&&(e._lodTextureHigh&&e._lodTextureHigh._texture&&(e._lodTextureHigh._texture.isReady=!0),e._lodTextureMid&&e._lodTextureMid._texture&&(e._lodTextureMid._texture.isReady=!0),e._lodTextureLow&&e._lodTextureLow._texture&&(e._lodTextureLow._texture.isReady=!0))})},e.UploadEnvSpherical=function(e,t){1!==t.version&&p.a.Warn('Unsupported babylon environment map version "'+t.version+'"');var n=t.irradiance;if(n){var r=new ci.b;o.x.FromArrayToRef(n.x,0,r.x),o.x.FromArrayToRef(n.y,0,r.y),o.x.FromArrayToRef(n.z,0,r.z),o.x.FromArrayToRef(n.xx,0,r.xx),o.x.FromArrayToRef(n.yy,0,r.yy),o.x.FromArrayToRef(n.zz,0,r.zz),o.x.FromArrayToRef(n.yz,0,r.yz),o.x.FromArrayToRef(n.zx,0,r.zx),o.x.FromArrayToRef(n.xy,0,r.xy),e._sphericalPolynomial=r}},e._UpdateRGBDAsync=function(t,n,r,i,o){return t._dataSource=ze.a.DATASOURCE_CUBERAW_RGBD,t._bufferViewArrayArray=n,t._lodGenerationScale=i,t._lodGenerationOffset=o,t._sphericalPolynomial=r,e.UploadLevelsAsync(t,n).then(function(){t.isReady=!0})},e._MagicBytes=[134,22,135,150,246,214,150,54],e}();ze.a._UpdateRGBDAsync=yi._UpdateRGBDAsync;var bi=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e,t,n,r,i){return 0===e.indexOf(".env")},e.prototype.transformUrl=function(e,t){return e},e.prototype.getFallbackTextureUrl=function(e,t){return null},e.prototype.loadCubeData=function(e,t,n,r,i){if(!Array.isArray(e)){e=e;var o=yi.GetEnvInfo(e);o?(t.width=o.width,t.height=o.width,yi.UploadEnvSpherical(t,o),yi.UploadEnvLevelsAsync(t,e,o).then(function(){t.isReady=!0,r&&r()})):i&&i("Can not parse the environment file",null)}},e.prototype.loadData=function(e,t,n){throw".env not supported in 2d."},e}();ge.b._TextureLoaders.push(new bi);var Ei=function(){function e(t,n,r,i){this.arrayBuffer=t,this.isInvalid=!1;var o=new Uint8Array(this.arrayBuffer,0,12);if(171!==o[0]||75!==o[1]||84!==o[2]||88!==o[3]||32!==o[4]||49!==o[5]||49!==o[6]||187!==o[7]||13!==o[8]||10!==o[9]||26!==o[10]||10!==o[11])return this.isInvalid=!0,void p.a.Error("texture missing KTX identifier");var a=Uint32Array.BYTES_PER_ELEMENT,s=new DataView(this.arrayBuffer,12,13*a),l=67305985===s.getUint32(0,!0);this.glType=s.getUint32(1*a,l),this.glTypeSize=s.getUint32(2*a,l),this.glFormat=s.getUint32(3*a,l),this.glInternalFormat=s.getUint32(4*a,l),this.glBaseInternalFormat=s.getUint32(5*a,l),this.pixelWidth=s.getUint32(6*a,l),this.pixelHeight=s.getUint32(7*a,l),this.pixelDepth=s.getUint32(8*a,l),this.numberOfArrayElements=s.getUint32(9*a,l),this.numberOfFaces=s.getUint32(10*a,l),this.numberOfMipmapLevels=s.getUint32(11*a,l),this.bytesOfKeyValueData=s.getUint32(12*a,l),0===this.glType?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===n?this.loadType=e.COMPRESSED_2D:p.a.Error("number of faces expected"+n+", but found "+this.numberOfFaces):p.a.Error("texture arrays not currently supported"):p.a.Error("only 2D textures currently supported")):p.a.Error("only compressed formats currently supported")}return e.prototype.uploadLevels=function(t,n){switch(this.loadType){case e.COMPRESSED_2D:this._upload2DCompressedLevels(t,n);break;case e.TEX_2D:case e.COMPRESSED_3D:case e.TEX_3D:}},e.prototype._upload2DCompressedLevels=function(t,n){for(var r=e.HEADER_LEN+this.bytesOfKeyValueData,i=this.pixelWidth,o=this.pixelHeight,a=n?this.numberOfMipmapLevels:1,s=0;s<a;s++){var l=new Int32Array(this.arrayBuffer,r,1)[0];r+=4;for(var u=0;u<this.numberOfFaces;u++){var c=new Uint8Array(this.arrayBuffer,r,l);t.getEngine()._uploadCompressedDataToTextureDirectly(t,this.glInternalFormat,i,o,c,u,s),r+=l,r+=3-(l+3)%4}i=Math.max(1,.5*i),o=Math.max(1,.5*o)}},e.HEADER_LEN=64,e.COMPRESSED_2D=0,e.COMPRESSED_3D=1,e.TEX_2D=2,e.TEX_3D=3,e}(),xi=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e,t,n,r,i){return!(!t||r||n||i)},e.prototype.transformUrl=function(e,t){var n=e.lastIndexOf(".");return-1!=n&&"ktx"==e.substring(n+1)?e:(n>-1?e.substring(0,n):e)+t},e.prototype.getFallbackTextureUrl=function(e,t){var n=new RegExp(t+"$");return e.replace(n,"")},e.prototype.loadCubeData=function(e,t,n,r,i){if(!Array.isArray(e)){t._invertVScale=!t.invertY;var o=t.getEngine(),a=new Ei(e,6),s=a.numberOfMipmapLevels>1&&t.generateMipMaps;o._unpackFlipY(!0),a.uploadLevels(t,t.generateMipMaps),t.width=a.pixelWidth,t.height=a.pixelHeight,o._setCubeMapTextureParams(s),t.isReady=!0}},e.prototype.loadData=function(e,t,n){t._invertVScale=!t.invertY;var r=new Ei(e,1);n(r.pixelWidth,r.pixelHeight,!1,!0,function(){r.uploadLevels(t,t.generateMipMaps)},r.isInvalid)},e}();ge.b._TextureLoaders.unshift(new xi),W.a.prototype.createDefaultLight=function(e){if(void 0===e&&(e=!1),e&&this.lights)for(var t=0;t<this.lights.length;t++)this.lights[t].dispose();0===this.lights.length&&new mn.a("default light",o.x.Up(),this)},W.a.prototype.createDefaultCamera=function(e,t,n){if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),t&&this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),!this.activeCamera){var r,i=this.getWorldExtends(),a=i.max.subtract(i.min),s=i.min.add(a.scale(.5)),l=1.5*a.length();if(isFinite(l)||(l=1,s.copyFromFloats(0,0,0)),e){var u=new xt("default camera",-Math.PI/2,Math.PI/2,l,s,this);u.lowerRadiusLimit=.01*l,u.wheelPrecision=100/l,r=u}else{var c=new bt("default camera",new o.x(s.x,s.y,-l),this);c.setTarget(s),r=c}r.minZ=.01*l,r.maxZ=1e3*l,r.speed=.2*l,this.activeCamera=r;var h=this.getEngine().getRenderingCanvas();n&&h&&r.attachControl(h)}},W.a.prototype.createDefaultCameraOrLight=function(e,t,n){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.createDefaultLight(t),this.createDefaultCamera(e,t,n)},W.a.prototype.createDefaultSkybox=function(e,t,n,r,i){if(void 0===t&&(t=!1),void 0===n&&(n=1e3),void 0===r&&(r=0),void 0===i&&(i=!0),!e)return p.a.Warn("Can not create default skybox without environment texture."),null;i&&e&&(this.environmentTexture=e);var o=fe.a.CreateBox("hdrSkyBox",n,this);if(t){var a=new ui("skyBox",this);a.backFaceCulling=!1,a.reflectionTexture=e.clone(),a.reflectionTexture&&(a.reflectionTexture.coordinatesMode=Ge.a.SKYBOX_MODE),a.microSurface=1-r,a.disableLighting=!0,a.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=a}else{var s=new yn.a("skyBox",this);s.backFaceCulling=!1,s.reflectionTexture=e.clone(),s.reflectionTexture&&(s.reflectionTexture.coordinatesMode=Ge.a.SKYBOX_MODE),s.disableLighting=!0,o.infiniteDistance=!0,o.material=s}return o.isPickable=!1,o},W.a.prototype.createDefaultEnvironment=function(e){return Jr?new Jr(e,this):null},W.a.prototype.createDefaultVRExperience=function(e){return void 0===e&&(e={}),new Ln(this,e)},W.a.prototype.createDefaultXRExperienceAsync=function(){var e=this;return Un.CreateAsync(this).then(function(t){var n=new Hn(t);return Gn.CreateAsync(e,t,{outputCanvasContext:n.canvasContext}).then(function(e){return new jn(t),t})})};var Ti=function(e){function t(t,n,r,i,o,a,s){void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===a&&(a=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===s&&(s={autoPlay:!0,loop:!0,autoUpdateTexture:!0});var l=e.call(this,null,r,!i,o)||this;l._onUserActionRequestedObservable=null,l._stillImageCaptured=!1,l._displayingPosterTexture=!1,l._createInternalTexture=function(){if(null!=l._texture){if(!l._displayingPosterTexture)return;l._texture.dispose(),l._displayingPosterTexture=!1}if(!l._engine.needPOTTextures||ye.h.IsExponentOfTwo(l.video.videoWidth)&&ye.h.IsExponentOfTwo(l.video.videoHeight)?(l.wrapU=Ge.a.WRAP_ADDRESSMODE,l.wrapV=Ge.a.WRAP_ADDRESSMODE):(l.wrapU=Ge.a.CLAMP_ADDRESSMODE,l.wrapV=Ge.a.CLAMP_ADDRESSMODE,l._generateMipMaps=!1),l._texture=l._engine.createDynamicTexture(l.video.videoWidth,l.video.videoHeight,l._generateMipMaps,l.samplingMode),l.video.autoplay||l._settings.poster)l._texture.isReady=!0,l._updateInternalTexture(),l.onLoadObservable.hasObservers()&&l.onLoadObservable.notifyObservers(l);else{var e=l.video.onplaying,t=!1,n=l.video.muted;l.video.muted=!0,l.video.onplaying=function(){l.video.muted=n,l.video.onplaying=e,l._texture.isReady=!0,l._updateInternalTexture(),t||l.video.pause(),l.onLoadObservable.hasObservers()&&l.onLoadObservable.notifyObservers(l)};var r=l.video.play();r?r.then(function(){}).catch(function(){t=!0,l._onUserActionRequestedObservable&&l._onUserActionRequestedObservable.hasObservers()&&l._onUserActionRequestedObservable.notifyObservers(l)}):(l.video.onplaying=e,l._texture.isReady=!0,l._updateInternalTexture(),l.onLoadObservable.hasObservers()&&l.onLoadObservable.notifyObservers(l))}},l.reset=function(){null!=l._texture&&(l._displayingPosterTexture||(l._texture.dispose(),l._texture=null))},l._updateInternalTexture=function(){null!=l._texture&&l._texture.isReady&&(l.video.readyState<l.video.HAVE_CURRENT_DATA||l._displayingPosterTexture||l._engine.updateVideoTexture(l._texture,l.video,l._invertY))},l._engine=l.getScene().getEngine(),l._generateMipMaps=i,l._initialSamplingMode=a,l.autoUpdateTexture=s.autoUpdateTexture,l.name=t||l._getName(n),l.video=l._getVideo(n),l._settings=s,s.poster&&(l.video.poster=s.poster),void 0!==s.autoPlay&&(l.video.autoplay=s.autoPlay),void 0!==s.loop&&(l.video.loop=s.loop),l.video.setAttribute("playsinline",""),l.video.addEventListener("paused",l._updateInternalTexture),l.video.addEventListener("seeked",l._updateInternalTexture),l.video.addEventListener("emptied",l.reset),l._createInternalTextureOnEvent=s.poster&&!s.autoPlay?"play":"canplay",l.video.addEventListener(l._createInternalTextureOnEvent,l._createInternalTexture);var u=l.video.readyState>=l.video.HAVE_CURRENT_DATA;return!s.poster||s.autoPlay&&u?u&&l._createInternalTexture():(l._texture=l._engine.createTexture(s.poster,!1,!0,r),l._displayingPosterTexture=!0),l}return u.d(t,e),Object.defineProperty(t.prototype,"onUserActionRequestedObservable",{get:function(){return this._onUserActionRequestedObservable||(this._onUserActionRequestedObservable=new i.c),this._onUserActionRequestedObservable},enumerable:!0,configurable:!0}),t.prototype._getName=function(e){return e instanceof HTMLVideoElement?e.currentSrc:"object"==typeof e?e.toString():e},t.prototype._getVideo=function(e){if(e instanceof HTMLVideoElement)return ye.h.SetCorsBehavior(e.currentSrc,e),e;var t=document.createElement("video");return"string"==typeof e?(ye.h.SetCorsBehavior(e,t),t.src=e):(ye.h.SetCorsBehavior(e[0],t),e.forEach(function(e){var n=document.createElement("source");n.src=e,t.appendChild(n)})),t},t.prototype._rebuild=function(){this.update()},t.prototype.update=function(){this.autoUpdateTexture&&this.updateTexture(!0)},t.prototype.updateTexture=function(e){e&&(this.video.paused&&this._stillImageCaptured||(this._stillImageCaptured=!0,this._updateInternalTexture()))},t.prototype.updateURL=function(e){this.video.src=e},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._onUserActionRequestedObservable&&(this._onUserActionRequestedObservable.clear(),this._onUserActionRequestedObservable=null),this.video.removeEventListener(this._createInternalTextureOnEvent,this._createInternalTexture),this.video.removeEventListener("paused",this._updateInternalTexture),this.video.removeEventListener("seeked",this._updateInternalTexture),this.video.removeEventListener("emptied",this.reset),this.video.pause()},t.CreateFromStreamAsync=function(e,n){var r=document.createElement("video");return r.setAttribute("autoplay",""),r.setAttribute("muted","true"),r.setAttribute("playsinline",""),r.muted=!0,void 0!==r.mozSrcObject?r.mozSrcObject=n:"object"==typeof r.srcObject?r.srcObject=n:(window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.src=window.URL&&window.URL.createObjectURL(n)),new Promise(function(n){r.addEventListener("playing",function i(){n(new t("video",r,e,!0,!0)),r.removeEventListener("playing",i)}),r.play()})},t.CreateFromWebCamAsync=function(e,t,n){var r,i=this;return void 0===n&&(n=!1),t&&t.deviceId&&(r={exact:t.deviceId}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia({video:t,audio:n}).then(function(t){return i.CreateFromStreamAsync(e,t)}):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:r,width:{min:t&&t.minWidth||256,max:t&&t.maxWidth||640},height:{min:t&&t.minHeight||256,max:t&&t.maxHeight||480}},audio:n},function(t){return i.CreateFromStreamAsync(e,t)},function(e){p.a.Error(e.name)}),Promise.reject("No support for userMedia on this device"))},t.CreateFromWebCam=function(e,t,n,r){void 0===r&&(r=!1),this.CreateFromWebCamAsync(e,n,r).then(function(e){t&&t(e)}).catch(function(e){p.a.Error(e.name)})},t}(Ge.a),Si=function(e){function t(n,r,i,a){var s=e.call(this,n,a)||this;s._useDirectMapping=!1,s._videoMode=t.MODE_MONOSCOPIC,s._onBeforeCameraRenderObserver=null,a=s.getScene(),n=n||"videoDome",i.resolution=0|Math.abs(i.resolution)||32,i.clickToPlay=Boolean(i.clickToPlay),i.autoPlay=void 0===i.autoPlay||Boolean(i.autoPlay),i.loop=void 0===i.loop||Boolean(i.loop),i.size=Math.abs(i.size)||(a.activeCamera?.48*a.activeCamera.maxZ:1e3),void 0===i.useDirectMapping?s._useDirectMapping=!0:s._useDirectMapping=i.useDirectMapping,void 0===i.faceForward&&(i.faceForward=!0),s._setReady(!1);var l={loop:i.loop,autoPlay:i.autoPlay,autoUpdateTexture:!0,poster:i.poster},u=s._material=new Qr(n+"_material",a),c=s._videoTexture=new Ti(n+"_texture",r,a,!1,s._useDirectMapping,Ge.a.TRILINEAR_SAMPLINGMODE,l);if(s._mesh=fe.a.CreateSphere(n+"_mesh",i.resolution,i.size,a,!1,fe.a.BACKSIDE),c.onLoadObservable.addOnce(function(){s._setReady(!0)}),u.useEquirectangularFOV=!0,u.fovMultiplier=1,u.opacityFresnel=!1,s._useDirectMapping?(c.wrapU=Ge.a.CLAMP_ADDRESSMODE,c.wrapV=Ge.a.CLAMP_ADDRESSMODE,u.diffuseTexture=c):(c.coordinatesMode=Ge.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE,c.wrapV=Ge.a.CLAMP_ADDRESSMODE,u.reflectionTexture=c),s._mesh.material=u,s._mesh.parent=s,i.clickToPlay&&(a.onPointerUp=function(){s._videoTexture.video.play()}),i.faceForward&&a.activeCamera){var h=a.activeCamera,d=o.x.Forward(),f=o.x.TransformNormal(d,h.getViewMatrix());f.normalize(),s.rotation.y=Math.acos(o.x.Dot(d,f))}return s}return u.d(t,e),Object.defineProperty(t.prototype,"videoTexture",{get:function(){return this._videoTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fovMultiplier",{get:function(){return this._material.fovMultiplier},set:function(e){this._material.fovMultiplier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoMode",{get:function(){return this._videoMode},set:function(e){this._videoMode!==e&&this._changeVideoMode(e)},enumerable:!0,configurable:!0}),t.prototype._changeVideoMode=function(e){var n=this;switch(this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._videoMode=e,this._videoTexture.uScale=1,this._videoTexture.vScale=1,this._videoTexture.uOffset=0,this._videoTexture.vOffset=0,e){case t.MODE_SIDEBYSIDE:this._videoTexture.uScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(e){n._videoTexture.uOffset=e.isRightCamera?.5:0});break;case t.MODE_TOPBOTTOM:this._videoTexture.vScale=.5,this._onBeforeCameraRenderObserver=this._scene.onBeforeCameraRenderObservable.add(function(e){n._videoTexture.vOffset=e.isRightCamera?.5:0})}},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._videoTexture.dispose(),this._mesh.dispose(),this._material.dispose(),this._scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),e.prototype.dispose.call(this,t,n)},t.MODE_MONOSCOPIC=0,t.MODE_TOPBOTTOM=1,t.MODE_SIDEBYSIDE=2,t}($r.a),Ai=function(){function e(e){this.engine=e,this._captureGPUFrameTime=!1,this._gpuFrameTime=new ye.f,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new ye.f,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(e){var t=this;e!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=e,e?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){t._gpuFrameTimeToken||(t._gpuFrameTimeToken=t.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(t._gpuFrameTimeToken){var e=t.engine.endTimeQuery(t._gpuFrameTimeToken);e>-1&&(t._gpuFrameTimeToken=null,t._gpuFrameTime.fetchNewFrame(),t._gpuFrameTime.addCount(e,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(e){var t=this;e!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=e,e?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){t._shaderCompilationTime.fetchNewFrame(),t._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){t._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},e}(),Pi=function(){function e(e){var t=this;this.scene=e,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new ye.f,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new ye.f,this._captureFrameTime=!1,this._frameTime=new ye.f,this._captureRenderTime=!1,this._renderTime=new ye.f,this._captureInterFrameTime=!1,this._interFrameTime=new ye.f,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new ye.f,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new ye.f,this._capturePhysicsTime=!1,this._physicsTime=new ye.f,this._captureAnimationsTime=!1,this._animationsTime=new ye.f,this._captureCameraRenderTime=!1,this._cameraRenderTime=new ye.f,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=e.onBeforeAnimationsObservable.add(function(){t._captureActiveMeshesEvaluationTime&&t._activeMeshesEvaluationTime.fetchNewFrame(),t._captureRenderTargetsRenderTime&&t._renderTargetsRenderTime.fetchNewFrame(),t._captureFrameTime&&(ye.h.StartPerformanceCounter("Scene rendering"),t._frameTime.beginMonitoring()),t._captureInterFrameTime&&t._interFrameTime.endMonitoring(),t._captureParticlesRenderTime&&t._particlesRenderTime.fetchNewFrame(),t._captureSpritesRenderTime&&t._spritesRenderTime.fetchNewFrame(),t._captureAnimationsTime&&t._animationsTime.beginMonitoring(),t.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=e.onAfterRenderObservable.add(function(){t._captureFrameTime&&(ye.h.EndPerformanceCounter("Scene rendering"),t._frameTime.endMonitoring()),t._captureRenderTime&&t._renderTime.endMonitoring(!1),t._captureInterFrameTime&&t._interFrameTime.beginMonitoring()})}return Object.defineProperty(e.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(e){var t=this;e!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=e,e?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){ye.h.StartPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){ye.h.EndPerformanceCounter("Active meshes evaluation"),t._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(e){var t=this;e!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=e,e?(this._onBeforeRenderTargetsRenderObserver=this.scene.onBeforeRenderTargetsRenderObservable.add(function(){ye.h.StartPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.onAfterRenderTargetsRenderObservable.add(function(){ye.h.EndPerformanceCounter("Render targets rendering"),t._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(e){var t=this;e!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=e,e?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){ye.h.StartPerformanceCounter("Particles"),t._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){ye.h.EndPerformanceCounter("Particles"),t._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(e){var t=this;e!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=e,this.scene.spriteManagers&&(e?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){ye.h.StartPerformanceCounter("Sprites"),t._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){ye.h.EndPerformanceCounter("Sprites"),t._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(e){var t=this;e!==this._capturePhysicsTime&&this.scene.onBeforePhysicsObservable&&(this._capturePhysicsTime=e,e?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){ye.h.StartPerformanceCounter("Physics"),t._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){ye.h.EndPerformanceCounter("Physics"),t._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(e){var t=this;e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){t._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(e){this._captureFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(e){this._captureInterFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(e){var t=this;e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){t._renderTime.beginMonitoring(),ye.h.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){t._renderTime.endMonitoring(!1),ye.h.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraRenderTimeCounter",{get:function(){return this._cameraRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"captureCameraRenderTime",{get:function(){return this._captureCameraRenderTime},set:function(e){var t=this;e!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=e,e?(this._onBeforeCameraRenderObserver=this.scene.onBeforeCameraRenderObservable.add(function(e){t._cameraRenderTime.beginMonitoring(),ye.h.StartPerformanceCounter("Rendering camera "+e.name)}),this._onAfterCameraRenderObserver=this.scene.onAfterCameraRenderObservable.add(function(e){t._cameraRenderTime.endMonitoring(!1),ye.h.EndPerformanceCounter("Rendering camera "+e.name)})):(this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.scene.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.scene=null},e}(),Mi=n(20);zt.a.ShadersStore.glowMapGenerationPixelShader="#ifdef DIFFUSE\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef OPACITY\nvarying vec2 vUVOpacity;\nuniform sampler2D opacitySampler;\nuniform float opacityIntensity;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef VERTEXALPHA\nvarying vec4 vColor;\n#endif\nuniform vec4 glowColor;\nvoid main(void)\n{\nvec4 finalColor=glowColor;\n\n#ifdef DIFFUSE\nvec4 albedoTexture=texture2D(diffuseSampler,vUVDiffuse);\nfinalColor.a*=albedoTexture.a;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vUVOpacity);\n#ifdef OPACITYRGB\nfinalColor.a*=getLuminance(opacityMap.rgb);\n#else\nfinalColor.a*=opacityMap.a;\n#endif\nfinalColor.a*=opacityIntensity;\n#endif\n#ifdef VERTEXALPHA\nfinalColor.a*=vColor.a;\n#endif\n#ifdef ALPHATEST\nif (finalColor.a<ALPHATESTVALUE)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive)*finalColor;\n#else\ngl_FragColor=finalColor;\n#endif\n}",zt.a.ShadersStore.glowMapGenerationVertexShader="\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef DIFFUSE\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef OPACITY\nvarying vec2 vUVOpacity;\nuniform mat4 opacityMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef VERTEXALPHA\nattribute vec4 color;\nvarying vec4 vColor;\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(positionUpdated,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef DIFFUSE\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef OPACITY\n#ifdef OPACITYUV1\nvUVOpacity=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef OPACITYUV2\nvUVOpacity=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef VERTEXALPHA\nvColor=color;\n#endif\n}";var Ri=function(){function e(t,n){this._vertexBuffers={},this._maxSize=0,this._mainTextureDesiredSize={width:0,height:0},this._shouldRender=!0,this._postProcesses=[],this._textures=[],this._emissiveTextureAndColor={texture:null,color:new o.f},this.neutralColor=new o.f,this.isEnabled=!0,this.onDisposeObservable=new i.c,this.onBeforeRenderMainTextureObservable=new i.c,this.onBeforeComposeObservable=new i.c,this.onAfterComposeObservable=new i.c,this.onSizeChangedObservable=new i.c,this.name=t,this._scene=n||P.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._engine=this._scene.getEngine(),this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.effectLayers.push(this),this._generateIndexBuffer(),this._generateVertexBuffer()}return Object.defineProperty(e.prototype,"camera",{get:function(){return this._effectLayerOptions.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._effectLayerOptions.renderingGroupId},enumerable:!0,configurable:!0}),e.prototype._init=function(e){this._effectLayerOptions=u.a({mainTextureRatio:.5,alphaBlendingMode:m.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},e),this._setMainTextureSize(),this._createMainTexture(),this._createTextureAndPostProcesses(),this._mergeEffect=this._createMergeEffect()},e.prototype._generateIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._engine.createIndexBuffer(e)},e.prototype._generateVertexBuffer=function(){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1);var t=new Sn.b(this._engine,e,Sn.b.PositionKind,!1,!1,2);this._vertexBuffers[Sn.b.PositionKind]=t},e.prototype._setMainTextureSize=function(){this._effectLayerOptions.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._effectLayerOptions.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._effectLayerOptions.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._effectLayerOptions.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?ye.h.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?ye.h.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height),this._mainTextureDesiredSize.width=Math.floor(this._mainTextureDesiredSize.width),this._mainTextureDesiredSize.height=Math.floor(this._mainTextureDesiredSize.height)},e.prototype._createMainTexture=function(){var e=this;this._mainTexture=new un("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,m.a.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._effectLayerOptions.camera,this._mainTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._mainTexture.customRenderFunction=function(t,n,r,i){var o;e.onBeforeRenderMainTextureObservable.notifyObservers(e);var a=e._scene.getEngine();if(i.length){for(a.setColorWrite(!1),o=0;o<i.length;o++)e._renderSubMesh(i.data[o]);a.setColorWrite(!0)}for(o=0;o<t.length;o++)e._renderSubMesh(t.data[o]);for(o=0;o<n.length;o++)e._renderSubMesh(n.data[o]);var s=a.getAlphaMode();for(o=0;o<r.length;o++)e._renderSubMesh(r.data[o],!0);a.setAlphaMode(s)},this._mainTexture.onClearObservable.add(function(t){t.clear(e.neutralColor,!0,!0,!0)})},e.prototype._addCustomEffectDefines=function(e){},e.prototype._isReady=function(e,t,n){var r=e.getMaterial();if(!r)return!1;if(!r.isReadyForSubMesh(e.getMesh(),e,t))return!1;var i=[],o=[Sn.b.PositionKind],a=e.getMesh(),s=!1,l=!1;if(r){var u=r.needAlphaTesting(),c=r.getAlphaTestTexture(),h=c&&c.hasAlpha&&(r.useAlphaFromDiffuseTexture||r._useAlphaFromAlbedoTexture);c&&(u||h)&&(i.push("#define DIFFUSE"),a.isVerticesDataPresent(Sn.b.UV2Kind)&&1===c.coordinatesIndex?(i.push("#define DIFFUSEUV2"),l=!0):a.isVerticesDataPresent(Sn.b.UVKind)&&(i.push("#define DIFFUSEUV1"),s=!0),u&&(i.push("#define ALPHATEST"),i.push("#define ALPHATESTVALUE 0.4")));var d=r.opacityTexture;d&&(i.push("#define OPACITY"),a.isVerticesDataPresent(Sn.b.UV2Kind)&&1===d.coordinatesIndex?(i.push("#define OPACITYUV2"),l=!0):a.isVerticesDataPresent(Sn.b.UVKind)&&(i.push("#define OPACITYUV1"),s=!0))}n&&(i.push("#define EMISSIVE"),a.isVerticesDataPresent(Sn.b.UV2Kind)&&1===n.coordinatesIndex?(i.push("#define EMISSIVEUV2"),l=!0):a.isVerticesDataPresent(Sn.b.UVKind)&&(i.push("#define EMISSIVEUV1"),s=!0)),a.isVerticesDataPresent(Sn.b.ColorKind)&&a.hasVertexAlpha&&(o.push(Sn.b.ColorKind),i.push("#define VERTEXALPHA")),s&&(o.push(Sn.b.UVKind),i.push("#define UV1")),l&&(o.push(Sn.b.UV2Kind),i.push("#define UV2")),a.useBones&&a.computeBonesUsingShaders?(o.push(Sn.b.MatricesIndicesKind),o.push(Sn.b.MatricesWeightsKind),a.numBoneInfluencers>4&&(o.push(Sn.b.MatricesIndicesExtraKind),o.push(Sn.b.MatricesWeightsExtraKind)),i.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),i.push("#define BonesPerMesh "+(a.skeleton?a.skeleton.bones.length+1:0))):i.push("#define NUM_BONE_INFLUENCERS 0");var f=a.morphTargetManager,p=0;f&&f.numInfluencers>0&&(i.push("#define MORPHTARGETS"),p=f.numInfluencers,i.push("#define NUM_MORPH_INFLUENCERS "+p),Wr.a.PrepareAttributesForMorphTargets(o,a,{NUM_MORPH_INFLUENCERS:p})),t&&(i.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3")),this._addCustomEffectDefines(i);var m=i.join("\n");return this._cachedDefines!==m&&(this._cachedDefines=m,this._effectLayerMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",o,["world","mBones","viewProjection","glowColor","morphTargetInfluences","diffuseMatrix","emissiveMatrix","opacityMatrix","opacityIntensity"],["diffuseSampler","emissiveSampler","opacitySampler"],m,void 0,void 0,void 0,{maxSimultaneousMorphTargets:p})),this._effectLayerMapGenerationEffect.isReady()},e.prototype.render=function(){var e=this._mergeEffect;if(e.isReady()){for(var t=0;t<this._postProcesses.length;t++)if(!this._postProcesses[t].isReady())return;var n=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),n.enableEffect(e),n.setState(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,e);var r=n.getAlphaMode();n.setAlphaMode(this._effectLayerOptions.alphaBlendingMode),this._internalRender(e),n.setAlphaMode(r),this.onAfterComposeObservable.notifyObservers(this);var i=this._mainTexture.getSize();this._setMainTextureSize(),i.width===this._mainTextureDesiredSize.width&&i.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this._disposeTextureAndPostProcesses(),this._createMainTexture(),this._createTextureAndPostProcesses())}},e.prototype.hasMesh=function(e){return-1===this.renderingGroupId||e.renderingGroupId===this.renderingGroupId},e.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},e.prototype._shouldRenderMesh=function(e){return!0},e.prototype._canRenderMesh=function(e,t){return!t.needAlphaBlendingForMesh(e)},e.prototype._shouldRenderEmissiveTextureForMesh=function(){return!0},e.prototype._renderSubMesh=function(e,t){var n=this;if(void 0===t&&(t=!1),this.shouldRender()){var r=e.getMaterial(),i=e.getRenderingMesh(),o=this._scene,a=o.getEngine();if(i._internalAbstractMeshDataInfo._isActiveIntermediate=!1,r&&this._canRenderMesh(i,r)){a.setState(r.backFaceCulling);var s=i._getInstancesRenderList(e._id);if(!s.mustReturn&&this._shouldRenderMesh(i)){var l=s.hardwareInstancedRendering[e._id];if(this._setEmissiveTextureAndColor(i,e,r),this._isReady(e,l,this._emissiveTextureAndColor.texture)){a.enableEffect(this._effectLayerMapGenerationEffect),i._bind(e,this._effectLayerMapGenerationEffect,Mi.a.TriangleFillMode),this._effectLayerMapGenerationEffect.setMatrix("viewProjection",o.getTransformMatrix()),this._effectLayerMapGenerationEffect.setFloat4("glowColor",this._emissiveTextureAndColor.color.r,this._emissiveTextureAndColor.color.g,this._emissiveTextureAndColor.color.b,this._emissiveTextureAndColor.color.a);var u=r.needAlphaTesting(),c=r.getAlphaTestTexture(),h=c&&c.hasAlpha&&(r.useAlphaFromDiffuseTexture||r._useAlphaFromAlbedoTexture);c&&(u||h)&&(this._effectLayerMapGenerationEffect.setTexture("diffuseSampler",c),(d=c.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("diffuseMatrix",d));var d,f=r.opacityTexture;f&&(this._effectLayerMapGenerationEffect.setTexture("opacitySampler",f),this._effectLayerMapGenerationEffect.setFloat("opacityIntensity",f.level),(d=f.getTextureMatrix())&&this._effectLayerMapGenerationEffect.setMatrix("opacityMatrix",d)),this._emissiveTextureAndColor.texture&&(this._effectLayerMapGenerationEffect.setTexture("emissiveSampler",this._emissiveTextureAndColor.texture),this._effectLayerMapGenerationEffect.setMatrix("emissiveMatrix",this._emissiveTextureAndColor.texture.getTextureMatrix())),i.useBones&&i.computeBonesUsingShaders&&i.skeleton&&this._effectLayerMapGenerationEffect.setMatrices("mBones",i.skeleton.getTransformMatrices(i)),Wr.a.BindMorphTargetParameters(i,this._effectLayerMapGenerationEffect),t&&a.setAlphaMode(r.alphaMode),i._processRendering(e,this._effectLayerMapGenerationEffect,Mi.a.TriangleFillMode,s,l,function(e,t){return n._effectLayerMapGenerationEffect.setMatrix("world",t)})}else this._mainTexture.resetRefreshCounter()}}}},e.prototype._rebuild=function(){var e=this._vertexBuffers[Sn.b.PositionKind];e&&e._rebuild(),this._generateIndexBuffer()},e.prototype._disposeTextureAndPostProcesses=function(){this._mainTexture.dispose();for(var e=0;e<this._postProcesses.length;e++)this._postProcesses[e]&&this._postProcesses[e].dispose();for(this._postProcesses=[],e=0;e<this._textures.length;e++)this._textures[e]&&this._textures[e].dispose();this._textures=[]},e.prototype.dispose=function(){var e=this._vertexBuffers[Sn.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[Sn.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._disposeTextureAndPostProcesses();var t=this._scene.effectLayers.indexOf(this,0);t>-1&&this._scene.effectLayers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},e.prototype.getClassName=function(){return"EffectLayer"},e.Parse=function(e,t,n){return ye.h.Instantiate(e.customType).Parse(e,t,n)},e._SceneComponentInitialization=function(e){throw be.a.WarnImport("EffectLayerSceneComponent")},u.c([Object(D.c)()],e.prototype,"name",void 0),u.c([Object(D.f)()],e.prototype,"neutralColor",void 0),u.c([Object(D.c)()],e.prototype,"isEnabled",void 0),u.c([Object(D.d)()],e.prototype,"camera",null),u.c([Object(D.c)()],e.prototype,"renderingGroupId",null),e}();r.a.AddParser(Te.a.NAME_EFFECTLAYER,function(e,t,n,r){if(e.effectLayers){n.effectLayers||(n.effectLayers=new Array);for(var i=0;i<e.effectLayers.length;i++){var o=Ri.Parse(e.effectLayers[i],t,r);n.effectLayers.push(o)}}}),r.a.prototype.removeEffectLayer=function(e){var t=this.effectLayers.indexOf(e);return-1!==t&&this.effectLayers.splice(t,1),t},r.a.prototype.addEffectLayer=function(e){this.effectLayers.push(e)};var Ci=function(){function e(e){this.name=Te.a.NAME_EFFECTLAYER,this._renderEffects=!1,this._needStencil=!1,this._previousStencilState=!1,this.scene=e,this._engine=e.getEngine(),e.effectLayers=new Array}return e.prototype.register=function(){this.scene._isReadyForMeshStage.registerStep(Te.a.STEP_ISREADYFORMESH_EFFECTLAYER,this,this._isReadyForMesh),this.scene._cameraDrawRenderTargetStage.registerStep(Te.a.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER,this,this._renderMainTexture),this.scene._beforeCameraDrawStage.registerStep(Te.a.STEP_BEFORECAMERADRAW_EFFECTLAYER,this,this._setStencil),this.scene._afterRenderingGroupDrawStage.registerStep(Te.a.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW,this,this._drawRenderingGroup),this.scene._afterCameraDrawStage.registerStep(Te.a.STEP_AFTERCAMERADRAW_EFFECTLAYER,this,this._setStencilBack),this.scene._afterCameraDrawStage.registerStep(Te.a.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW,this,this._drawCamera)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.effectLayers;e<t.length;e++)t[e]._rebuild()},e.prototype.serialize=function(e){e.effectLayers=[];for(var t=0,n=this.scene.effectLayers;t<n.length;t++){var r=n[t];r.serialize&&e.effectLayers.push(r.serialize())}},e.prototype.addFromContainer=function(e){var t=this;e.effectLayers&&e.effectLayers.forEach(function(e){t.scene.addEffectLayer(e)})},e.prototype.removeFromContainer=function(e,t){var n=this;e.effectLayers&&e.effectLayers.forEach(function(e){n.scene.removeEffectLayer(e),t&&e.dispose()})},e.prototype.dispose=function(){for(var e=this.scene.effectLayers;e.length;)e[0].dispose()},e.prototype._isReadyForMesh=function(e,t){for(var n=0,r=this.scene.effectLayers;n<r.length;n++){var i=r[n];if(i.hasMesh(e))for(var o=0,a=e.subMeshes;o<a.length;o++){var s=a[o];if(!i.isReady(s,t))return!1}}return!0},e.prototype._renderMainTexture=function(e){this._renderEffects=!1,this._needStencil=!1;var t=!1,n=this.scene.effectLayers;if(n&&n.length>0){this._previousStencilState=this._engine.getStencilBuffer();for(var r=0,i=n;r<i.length;r++){var o=i[r];if(o.shouldRender()&&(!o.camera||o.camera.cameraRigMode===Ne.a.RIG_MODE_NONE&&e===o.camera||o.camera.cameraRigMode!==Ne.a.RIG_MODE_NONE&&o.camera._rigCameras.indexOf(e)>-1)){this._renderEffects=!0,this._needStencil=this._needStencil||o.needStencil();var a=o._mainTexture;a._shouldRender()&&(this.scene.incrementRenderId(),a.render(!1,!1),t=!0)}}this.scene.incrementRenderId()}return t},e.prototype._setStencil=function(){this._needStencil&&this._engine.setStencilBuffer(!0)},e.prototype._setStencilBack=function(){this._needStencil&&this._engine.setStencilBuffer(this._previousStencilState)},e.prototype._draw=function(e){if(this._renderEffects){this._engine.setDepthBuffer(!1);for(var t=this.scene.effectLayers,n=0;n<t.length;n++){var r=t[n];r.renderingGroupId===e&&r.shouldRender()&&r.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCamera=function(){this._renderEffects&&this._draw(-1)},e.prototype._drawRenderingGroup=function(e){!this.scene._isInIntermediateRendering()&&this._renderEffects&&this._draw(e)},e}();Ri._SceneComponentInitialization=function(e){var t=e._getComponent(Te.a.NAME_EFFECTLAYER);t||(t=new Ci(e),e._addComponent(t))},zt.a.ShadersStore.glowMapMergePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#ifdef EMISSIVE\nuniform sampler2D textureSampler2;\n#endif\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef EMISSIVE\nbaseColor+=texture2D(textureSampler2,vUV);\nbaseColor*=offset;\n#else\nbaseColor.a=abs(offset-baseColor.a);\n#ifdef STROKE\nfloat alpha=smoothstep(.0,.1,baseColor.a);\nbaseColor.a=alpha;\nbaseColor.rgb=baseColor.rgb*alpha;\n#endif\n#endif\ngl_FragColor=baseColor;\n}",zt.a.ShadersStore.glowMapMergeVertexShader="\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",r.a.prototype.getGlowLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===wi.EffectName)return this.effectLayers[t];return null};var wi=function(e){function t(n,r,i){var a=e.call(this,n,r)||this;return a._intensity=1,a._includedOnlyMeshes=[],a._excludedMeshes=[],a.neutralColor=new o.f(0,0,0,1),a._options=u.a({mainTextureRatio:t.DefaultTextureRatio,blurKernelSize:32,mainTextureFixedSize:void 0,camera:null,mainTextureSamples:1,renderingGroupId:-1},i),a._init({alphaBlendingMode:m.a.ALPHA_ADD,camera:a._options.camera,mainTextureFixedSize:a._options.mainTextureFixedSize,mainTextureRatio:a._options.mainTextureRatio,renderingGroupId:a._options.renderingGroupId}),a}return u.d(t,e),Object.defineProperty(t.prototype,"blurKernelSize",{get:function(){return this._horizontalBlurPostprocess1.kernel},set:function(e){this._horizontalBlurPostprocess1.kernel=e,this._verticalBlurPostprocess1.kernel=e,this._horizontalBlurPostprocess2.kernel=e,this._verticalBlurPostprocess2.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intensity",{get:function(){return this._intensity},set:function(e){this._intensity=e},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Sn.b.PositionKind],["offset"],["textureSampler","textureSampler2"],"#define EMISSIVE \n")},t.prototype._createTextureAndPostProcesses=function(){var e=this,t=this._mainTextureDesiredSize.width,n=this._mainTextureDesiredSize.height;t=this._engine.needPOTTextures?ye.h.GetExponentOfTwo(t,this._maxSize):t,n=this._engine.needPOTTextures?ye.h.GetExponentOfTwo(n,this._maxSize):n;var r=0;r=this._engine.getCaps().textureHalfFloatRender?m.a.TEXTURETYPE_HALF_FLOAT:m.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture1=new un("GlowLayerBlurRTT",{width:t,height:n},this._scene,!1,!0,r),this._blurTexture1.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture1.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture1.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._blurTexture1.renderParticles=!1,this._blurTexture1.ignoreCameraViewport=!0;var i=Math.floor(t/2),a=Math.floor(n/2);this._blurTexture2=new un("GlowLayerBlurRTT2",{width:i,height:a},this._scene,!1,!0,r),this._blurTexture2.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture2.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture2.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._blurTexture2.renderParticles=!1,this._blurTexture2.ignoreCameraViewport=!0,this._textures=[this._blurTexture1,this._blurTexture2],this._horizontalBlurPostprocess1=new zr("GlowLayerHBP1",new o.w(1,0),this._options.blurKernelSize/2,{width:t,height:n},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess1.width=t,this._horizontalBlurPostprocess1.height=n,this._horizontalBlurPostprocess1.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess1=new zr("GlowLayerVBP1",new o.w(0,1),this._options.blurKernelSize/2,{width:t,height:n},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess2=new zr("GlowLayerHBP2",new o.w(1,0),this._options.blurKernelSize/2,{width:i,height:a},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess2.width=i,this._horizontalBlurPostprocess2.height=a,this._horizontalBlurPostprocess2.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._blurTexture1)}),this._verticalBlurPostprocess2=new zr("GlowLayerVBP2",new o.w(0,1),this._options.blurKernelSize/2,{width:i,height:a},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._postProcesses=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1,this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._postProcesses1=[this._horizontalBlurPostprocess1,this._verticalBlurPostprocess1],this._postProcesses2=[this._horizontalBlurPostprocess2,this._verticalBlurPostprocess2],this._mainTexture.samples=this._options.mainTextureSamples,this._mainTexture.onAfterUnbindObservable.add(function(){var t=e._blurTexture1.getInternalTexture();t&&(e._scene.postProcessManager.directRender(e._postProcesses1,t,!0),(t=e._blurTexture2.getInternalTexture())&&e._scene.postProcessManager.directRender(e._postProcesses2,t,!0))}),this._postProcesses.map(function(e){e.autoClear=!1})},t.prototype.isReady=function(t,n){var r=t.getMaterial(),i=t.getRenderingMesh();if(!r||!i)return!1;var o=r.emissiveTexture;return e.prototype._isReady.call(this,t,n,o)},t.prototype.needStencil=function(){return!1},t.prototype._canRenderMesh=function(e,t){return!0},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture1),e.setTexture("textureSampler2",this._blurTexture2),e.setFloat("offset",this._intensity);var t=this._engine,n=t.getStencilBuffer();t.setStencilBuffer(!1),t.drawElementsType(Mi.a.TriangleFillMode,0,6),t.setStencilBuffer(n)},t.prototype._setEmissiveTextureAndColor=function(e,t,n){var r=1;this.customEmissiveTextureSelector?this._emissiveTextureAndColor.texture=this.customEmissiveTextureSelector(e,t,n):n?(this._emissiveTextureAndColor.texture=n.emissiveTexture,this._emissiveTextureAndColor.texture&&(r=this._emissiveTextureAndColor.texture.level)):this._emissiveTextureAndColor.texture=null,this.customEmissiveColorSelector?this.customEmissiveColorSelector(e,t,n,this._emissiveTextureAndColor.color):n.emissiveColor?this._emissiveTextureAndColor.color.set(n.emissiveColor.r*r,n.emissiveColor.g*r,n.emissiveColor.b*r,n.alpha):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a)},t.prototype._shouldRenderMesh=function(e){return this.hasMesh(e)},t.prototype._addCustomEffectDefines=function(e){e.push("#define GLOW")},t.prototype.addExcludedMesh=function(e){-1===this._excludedMeshes.indexOf(e.uniqueId)&&this._excludedMeshes.push(e.uniqueId)},t.prototype.removeExcludedMesh=function(e){var t=this._excludedMeshes.indexOf(e.uniqueId);-1!==t&&this._excludedMeshes.splice(t,1)},t.prototype.addIncludedOnlyMesh=function(e){-1===this._includedOnlyMeshes.indexOf(e.uniqueId)&&this._includedOnlyMeshes.push(e.uniqueId)},t.prototype.removeIncludedOnlyMesh=function(e){var t=this._includedOnlyMeshes.indexOf(e.uniqueId);-1!==t&&this._includedOnlyMeshes.splice(t,1)},t.prototype.hasMesh=function(t){return!!e.prototype.hasMesh.call(this,t)&&(this._includedOnlyMeshes.length?-1!==this._includedOnlyMeshes.indexOf(t.uniqueId):!this._excludedMeshes.length||-1===this._excludedMeshes.indexOf(t.uniqueId))},t.prototype._disposeMesh=function(e){this.removeIncludedOnlyMesh(e),this.removeExcludedMesh(e)},t.prototype.getClassName=function(){return"GlowLayer"},t.prototype.serialize=function(){var e,t=D.a.Serialize(this);if(t.customType="BABYLON.GlowLayer",t.includedMeshes=[],this._includedOnlyMeshes.length)for(e=0;e<this._includedOnlyMeshes.length;e++)(n=this._scene.getMeshByUniqueID(this._includedOnlyMeshes[e]))&&t.includedMeshes.push(n.id);if(t.excludedMeshes=[],this._excludedMeshes.length)for(e=0;e<this._excludedMeshes.length;e++){var n;(n=this._scene.getMeshByUniqueID(this._excludedMeshes[e]))&&t.excludedMeshes.push(n.id)}return t},t.Parse=function(e,n,r){var i,o=D.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(i=0;i<e.excludedMeshes.length;i++)(a=n.getMeshByID(e.excludedMeshes[i]))&&o.addExcludedMesh(a);for(i=0;i<e.includedMeshes.length;i++){var a;(a=n.getMeshByID(e.includedMeshes[i]))&&o.addIncludedOnlyMesh(a)}return o},t.EffectName="GlowLayer",t.DefaultBlurKernelSize=32,t.DefaultTextureRatio=.5,u.c([Object(D.c)()],t.prototype,"blurKernelSize",null),u.c([Object(D.c)()],t.prototype,"intensity",null),u.c([Object(D.c)("options")],t.prototype,"_options",void 0),t}(Ri);a.a.RegisteredTypes["BABYLON.GlowLayer"]=wi,zt.a.ShadersStore.glowBlurPostProcessPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",r.a.prototype.getHighlightLayerByName=function(e){for(var t=0;t<this.effectLayers.length;t++)if(this.effectLayers[t].name===e&&this.effectLayers[t].getEffectName()===Ii.EffectName)return this.effectLayers[t];return null};var Oi=function(e){function t(t,n,r,i,o,a,s,l){void 0===a&&(a=Ge.a.BILINEAR_SAMPLINGMODE);var u=e.call(this,t,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,i,o,a,s,l)||this;return u.direction=n,u.kernel=r,u.onApplyObservable.add(function(e){e.setFloat2("screenSize",u.width,u.height),e.setVector2("direction",u.direction),e.setFloat("blurWidth",u.kernel)}),u}return u.d(t,e),t}(jt),Ii=function(e){function t(n,r,o){var a=e.call(this,n,r)||this;return a.name=n,a.innerGlow=!0,a.outerGlow=!0,a.onBeforeBlurObservable=new i.c,a.onAfterBlurObservable=new i.c,a._instanceGlowingMeshStencilReference=t.GlowingMeshStencilReference++,a._meshes={},a._excludedMeshes={},a.neutralColor=t.NeutralColor,a._engine.isStencilEnable||p.a.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new Engine(canvas, antialias, { stencil: true }"),a._options=u.a({mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:m.a.ALPHA_COMBINE,camera:null,renderingGroupId:-1},o),a._init({alphaBlendingMode:a._options.alphaBlendingMode,camera:a._options.camera,mainTextureFixedSize:a._options.mainTextureFixedSize,mainTextureRatio:a._options.mainTextureRatio,renderingGroupId:a._options.renderingGroupId}),a._shouldRender=!1,a}return u.d(t,e),Object.defineProperty(t.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),t.prototype.getEffectName=function(){return t.EffectName},t.prototype._createMergeEffect=function(){return this._engine.createEffect("glowMapMerge",[Sn.b.PositionKind],["offset"],["textureSampler"],this._options.isStroke?"#define STROKE \n":void 0)},t.prototype._createTextureAndPostProcesses=function(){var e=this,t=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,n=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;t=this._engine.needPOTTextures?ye.h.GetExponentOfTwo(t,this._maxSize):t,n=this._engine.needPOTTextures?ye.h.GetExponentOfTwo(n,this._maxSize):n;var r=0;r=this._engine.getCaps().textureHalfFloatRender?m.a.TEXTURETYPE_HALF_FLOAT:m.a.TEXTURETYPE_UNSIGNED_INT,this._blurTexture=new un("HighlightLayerBlurRTT",{width:t,height:n},this._scene,!1,!0,r),this._blurTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(Ge.a.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._textures=[this._blurTexture],this._options.alphaBlendingMode===m.a.ALPHA_COMBINE?(this._downSamplePostprocess=new Ht("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._mainTexture)}),this._horizontalBlurPostprocess=new Oi("HighlightLayerHBP",new o.w(1,0),this._options.blurHorizontalSize,1,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",t,n)}),this._verticalBlurPostprocess=new Oi("HighlightLayerVBP",new o.w(0,1),this._options.blurVerticalSize,1,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",t,n)}),this._postProcesses=[this._downSamplePostprocess,this._horizontalBlurPostprocess,this._verticalBlurPostprocess]):(this._horizontalBlurPostprocess=new zr("HighlightLayerHBP",new o.w(1,0),this._options.blurHorizontalSize/2,{width:t,height:n},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._horizontalBlurPostprocess.width=t,this._horizontalBlurPostprocess.height=n,this._horizontalBlurPostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._mainTexture)}),this._verticalBlurPostprocess=new zr("HighlightLayerVBP",new o.w(0,1),this._options.blurVerticalSize/2,{width:t,height:n},null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,r),this._postProcesses=[this._horizontalBlurPostprocess,this._verticalBlurPostprocess]),this._mainTexture.onAfterUnbindObservable.add(function(){e.onBeforeBlurObservable.notifyObservers(e);var t=e._blurTexture.getInternalTexture();t&&e._scene.postProcessManager.directRender(e._postProcesses,t,!0),e.onAfterBlurObservable.notifyObservers(e)}),this._postProcesses.map(function(e){e.autoClear=!1})},t.prototype.needStencil=function(){return!0},t.prototype.isReady=function(t,n){var r=t.getMaterial(),i=t.getRenderingMesh();if(!r||!i||!this._meshes)return!1;var o=null,a=this._meshes[i.uniqueId];return a&&a.glowEmissiveOnly&&r&&(o=r.emissiveTexture),e.prototype._isReady.call(this,t,n,o)},t.prototype._internalRender=function(e){e.setTexture("textureSampler",this._blurTexture);var t=this._engine;t.cacheStencilState(),t.setStencilOperationPass(m.a.REPLACE),t.setStencilOperationFail(m.a.KEEP),t.setStencilOperationDepthFail(m.a.KEEP),t.setStencilMask(0),t.setStencilBuffer(!0),t.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(e.setFloat("offset",0),t.setStencilFunction(m.a.NOTEQUAL),t.drawElementsType(Mi.a.TriangleFillMode,0,6)),this.innerGlow&&(e.setFloat("offset",1),t.setStencilFunction(m.a.EQUAL),t.drawElementsType(Mi.a.TriangleFillMode,0,6)),t.restoreStencilState()},t.prototype.shouldRender=function(){return!!e.prototype.shouldRender.call(this)&&!!this._meshes},t.prototype._shouldRenderMesh=function(t){return(!this._excludedMeshes||!this._excludedMeshes[t.uniqueId])&&!!e.prototype.hasMesh.call(this,t)},t.prototype._setEmissiveTextureAndColor=function(e,t,n){var r=this._meshes[e.uniqueId];r?this._emissiveTextureAndColor.color.set(r.color.r,r.color.g,r.color.b,1):this._emissiveTextureAndColor.color.set(this.neutralColor.r,this.neutralColor.g,this.neutralColor.b,this.neutralColor.a),r&&r.glowEmissiveOnly&&n?(this._emissiveTextureAndColor.texture=n.emissiveTexture,this._emissiveTextureAndColor.color.set(1,1,1,1)):this._emissiveTextureAndColor.texture=null},t.prototype.addExcludedMesh=function(e){this._excludedMeshes&&(this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeBind:e.onBeforeBindObservable.add(function(e){e.getEngine().setStencilBuffer(!1)}),afterRender:e.onAfterRenderObservable.add(function(e){e.getEngine().setStencilBuffer(!0)})}))},t.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var t=this._excludedMeshes[e.uniqueId];t&&(t.beforeBind&&e.onBeforeBindObservable.remove(t.beforeBind),t.afterRender&&e.onAfterRenderObservable.remove(t.afterRender)),this._excludedMeshes[e.uniqueId]=null}},t.prototype.hasMesh=function(t){return!!this._meshes&&!!e.prototype.hasMesh.call(this,t)&&void 0!==this._meshes[t.uniqueId]&&null!==this._meshes[t.uniqueId]},t.prototype.addMesh=function(e,t,n){var r=this;if(void 0===n&&(n=!1),this._meshes){var i=this._meshes[e.uniqueId];i?i.color=t:(this._meshes[e.uniqueId]={mesh:e,color:t,observerHighlight:e.onBeforeBindObservable.add(function(e){r._excludedMeshes&&r._excludedMeshes[e.uniqueId]?r._defaultStencilReference(e):e.getScene().getEngine().setStencilFunctionReference(r._instanceGlowingMeshStencilReference)}),observerDefault:e.onAfterRenderObservable.add(this._defaultStencilReference),glowEmissiveOnly:n},e.onDisposeObservable.add(function(){r._disposeMesh(e)})),this._shouldRender=!0}},t.prototype.removeMesh=function(e){if(this._meshes){var t=this._meshes[e.uniqueId];for(var n in t&&(t.observerHighlight&&e.onBeforeBindObservable.remove(t.observerHighlight),t.observerDefault&&e.onAfterRenderObservable.remove(t.observerDefault),delete this._meshes[e.uniqueId]),this._shouldRender=!1,this._meshes)if(this._meshes[n]){this._shouldRender=!0;break}}},t.prototype._defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(t.NormalMeshStencilReference)},t.prototype._disposeMesh=function(e){this.removeMesh(e),this.removeExcludedMesh(e)},t.prototype.dispose=function(){if(this._meshes){for(var t in this._meshes)(n=this._meshes[t])&&n.mesh&&(n.observerHighlight&&n.mesh.onBeforeBindObservable.remove(n.observerHighlight),n.observerDefault&&n.mesh.onAfterRenderObservable.remove(n.observerDefault));this._meshes=null}if(this._excludedMeshes){for(var t in this._excludedMeshes){var n;(n=this._excludedMeshes[t])&&(n.beforeBind&&n.mesh.onBeforeBindObservable.remove(n.beforeBind),n.afterRender&&n.mesh.onAfterRenderObservable.remove(n.afterRender))}this._excludedMeshes=null}e.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"HighlightLayer"},t.prototype.serialize=function(){var e=D.a.Serialize(this);if(e.customType="BABYLON.HighlightLayer",e.meshes=[],this._meshes)for(var t in this._meshes){var n=this._meshes[t];n&&e.meshes.push({glowEmissiveOnly:n.glowEmissiveOnly,color:n.color.asArray(),meshId:n.mesh.id})}if(e.excludedMeshes=[],this._excludedMeshes)for(var r in this._excludedMeshes){var i=this._excludedMeshes[r];i&&e.excludedMeshes.push(i.mesh.id)}return e},t.Parse=function(e,n,r){var i,a=D.a.Parse(function(){return new t(e.name,n,e.options)},e,n,r);for(i=0;i<e.excludedMeshes.length;i++)(s=n.getMeshByID(e.excludedMeshes[i]))&&a.addExcludedMesh(s);for(i=0;i<e.meshes.length;i++){var s,l=e.meshes[i];(s=n.getMeshByID(l.meshId))&&a.addMesh(s,o.e.FromArray(l.color),l.glowEmissiveOnly)}return a},t.EffectName="HighlightLayer",t.NeutralColor=new o.f(0,0,0,0),t.GlowingMeshStencilReference=2,t.NormalMeshStencilReference=1,u.c([Object(D.c)()],t.prototype,"innerGlow",void 0),u.c([Object(D.c)()],t.prototype,"outerGlow",void 0),u.c([Object(D.c)()],t.prototype,"blurHorizontalSize",null),u.c([Object(D.c)()],t.prototype,"blurVerticalSize",null),u.c([Object(D.c)("options")],t.prototype,"_options",void 0),t}(Ri);a.a.RegisteredTypes["BABYLON.HighlightLayer"]=Ii;var Di=function(){function e(e){this.name=Te.a.NAME_LAYER,this.scene=e,this._engine=e.getEngine(),e.layers=new Array}return e.prototype.register=function(){this.scene._beforeCameraDrawStage.registerStep(Te.a.STEP_BEFORECAMERADRAW_LAYER,this,this._drawCameraBackground),this.scene._afterCameraDrawStage.registerStep(Te.a.STEP_AFTERCAMERADRAW_LAYER,this,this._drawCameraForeground),this.scene._beforeRenderTargetDrawStage.registerStep(Te.a.STEP_BEFORERENDERTARGETDRAW_LAYER,this,this._drawRenderTargetBackground),this.scene._afterRenderTargetDrawStage.registerStep(Te.a.STEP_AFTERRENDERTARGETDRAW_LAYER,this,this._drawRenderTargetForeground)},e.prototype.rebuild=function(){for(var e=0,t=this.scene.layers;e<t.length;e++)t[e]._rebuild()},e.prototype.dispose=function(){for(var e=this.scene.layers;e.length;)e[0].dispose()},e.prototype._draw=function(e){var t=this.scene.layers;if(t.length){this._engine.setDepthBuffer(!1);for(var n=0,r=t;n<r.length;n++){var i=r[n];e(i)&&i.render()}this._engine.setDepthBuffer(!0)}},e.prototype._drawCameraPredicate=function(e,t,n){return!e.renderOnlyInRenderTargetTextures&&e.isBackground===t&&0!=(e.layerMask&n)},e.prototype._drawCameraBackground=function(e){var t=this;this._draw(function(n){return t._drawCameraPredicate(n,!0,e.layerMask)})},e.prototype._drawCameraForeground=function(e){var t=this;this._draw(function(n){return t._drawCameraPredicate(n,!1,e.layerMask)})},e.prototype._drawRenderTargetPredicate=function(e,t,n,r){return e.renderTargetTextures.length>0&&e.isBackground===t&&e.renderTargetTextures.indexOf(r)>-1&&0!=(e.layerMask&n)},e.prototype._drawRenderTargetBackground=function(e){var t=this;this._draw(function(n){return t._drawRenderTargetPredicate(n,!0,t.scene.activeCamera.layerMask,e)})},e.prototype._drawRenderTargetForeground=function(e){var t=this;this._draw(function(n){return t._drawRenderTargetPredicate(n,!1,t.scene.activeCamera.layerMask,e)})},e}();zt.a.ShadersStore.layerPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",zt.a.ShadersStore.layerVertexShader="\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}";var Li=function(){function e(e,t,n,r,a){this.name=e,this.scale=new o.w(1,1),this.offset=new o.w(0,0),this.alphaBlendingMode=m.a.ALPHA_COMBINE,this.layerMask=268435455,this.renderTargetTextures=[],this.renderOnlyInRenderTargetTextures=!1,this._vertexBuffers={},this.onDisposeObservable=new i.c,this.onBeforeRenderObservable=new i.c,this.onAfterRenderObservable=new i.c,this.texture=t?new Ge.a(t,n,!0):null,this.isBackground=void 0===r||r,this.color=void 0===a?new o.f(1,1,1,1):a,this._scene=n||P.a.LastCreatedScene;var s=this._scene._getComponent(Te.a.NAME_LAYER);s||(s=new Di(this._scene),this._scene._addComponent(s)),this._scene.layers.push(this);var l=this._scene.getEngine(),u=[];u.push(1,1),u.push(-1,1),u.push(-1,-1),u.push(1,-1);var c=new Sn.b(l,u,Sn.b.PositionKind,!1,!1,2);this._vertexBuffers[Sn.b.PositionKind]=c,this._createIndexBuffer(),this._effect=l.createEffect("layer",[Sn.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=l.createEffect("layer",[Sn.b.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),e.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},e.prototype._rebuild=function(){var e=this._vertexBuffers[Sn.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},e.prototype.render=function(){var e=this.alphaTest?this._alphaTestEffect:this._effect;if(e.isReady()&&this.texture&&this.texture.isReady()){var t=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),t.enableEffect(e),t.setState(!1),e.setTexture("textureSampler",this.texture),e.setMatrix("textureMatrix",this.texture.getTextureMatrix()),e.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),e.setVector2("offset",this.offset),e.setVector2("scale",this.scale),t.bindBuffers(this._vertexBuffers,this._indexBuffer,e),this.alphaTest?t.drawElementsType(Mi.a.TriangleFillMode,0,6):(t.setAlphaMode(this.alphaBlendingMode),t.drawElementsType(Mi.a.TriangleFillMode,0,6),t.setAlphaMode(m.a.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},e.prototype.dispose=function(){var e=this._vertexBuffers[Sn.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[Sn.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null),this.renderTargetTextures=[];var t=this._scene.layers.indexOf(this);this._scene.layers.splice(t,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},e}(),Fi=function(){function e(e,t,n,r,i){this.size=e,this.position=t,this.alphaMode=m.a.ALPHA_ONEONE,this.color=n||new o.e(1,1,1),this.texture=r?new Ge.a(r,i.getScene(),!0):null,this._system=i,i.lensFlares.push(this)}return e.AddFlare=function(t,n,r,i,o){return new e(t,n,r,i,o)},e.prototype.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},e}();zt.a.ShadersStore.lensFlarePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",zt.a.ShadersStore.lensFlareVertexShader="\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}";var Ni=function(){function e(t,n,r){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=r||P.a.LastCreatedScene,e._SceneComponentInitialization(this._scene),this._emitter=n,this.id=t,r.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return r.activeCamera&&e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&r.activeCamera.layerMask)};var i=r.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[Sn.b.PositionKind]=new Sn.b(i,o,Sn.b.PositionKind,!1,!1,2);var a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=i.createIndexBuffer(a),this._effect=i.createEffect("lensFlare",[Sn.b.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEmitter=function(){return this._emitter},e.prototype.setEmitter=function(e){this._emitter=e},e.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},e.prototype.computeEffectivePosition=function(e){var t=this.getEmitterPosition();return t=o.x.Project(t,o.j.Identity(),this._scene.getTransformMatrix(),e),this._positionX=t.x,this._positionY=t.y,t=o.x.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(e.x-=this.viewportBorder,e.y-=this.viewportBorder,e.width+=2*this.viewportBorder,e.height+=2*this.viewportBorder,t.x+=this.viewportBorder,t.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),t.z>0&&(this._positionX>e.x&&this._positionX<e.x+e.width&&this._positionY>e.y&&(this._positionY,e.y,e.height),!0)},e.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var e=this.getEmitterPosition().subtract(this._scene.activeCamera.globalPosition),t=e.length();e.normalize();var n=new Ot.a(this._scene.activeCamera.globalPosition,e),r=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0);return!r||!r.hit||r.distance>t},e.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var e,t,n=this._scene.getEngine(),r=this._scene.activeCamera.viewport.toGlobal(n.getRenderWidth(!0),n.getRenderHeight(!0));if(!this.computeEffectivePosition(r))return!1;if(!this._isVisible())return!1;var i=(e=this._positionX<this.borderLimit+r.x?this.borderLimit+r.x-this._positionX:this._positionX>r.x+r.width-this.borderLimit?this._positionX-r.x-r.width+this.borderLimit:0)>(t=this._positionY<this.borderLimit+r.y?this.borderLimit+r.y-this._positionY:this._positionY>r.y+r.height-this.borderLimit?this._positionY-r.y-r.height+this.borderLimit:0)?e:t;(i-=this.viewportBorder)>this.borderLimit&&(i=this.borderLimit);var a=1-I.a.Clamp(i/this.borderLimit,0,1);if(a<0)return!1;a>1&&(a=1),this.viewportBorder>0&&(r.x+=this.viewportBorder,r.y+=this.viewportBorder,r.width-=2*this.viewportBorder,r.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var s=r.x+r.width/2,l=r.y+r.height/2,u=s-this._positionX,c=l-this._positionY;n.enableEffect(this._effect),n.setState(!1),n.setDepthBuffer(!1),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var h=0;h<this.lensFlares.length;h++){var d=this.lensFlares[h];n.setAlphaMode(d.alphaMode);var f=s-u*d.position,p=l-c*d.position,g=d.size,_=d.size*n.getAspectRatio(this._scene.activeCamera,!0),v=f/(r.width+2*r.x)*2-1,y=1-p/(r.height+2*r.y)*2,b=o.j.FromValues(g/2,0,0,0,0,_/2,0,0,0,0,1,0,v,y,0,1);this._effect.setMatrix("viewportMatrix",b),this._effect.setTexture("textureSampler",d.texture),this._effect.setFloat4("color",d.color.r*a,d.color.g*a,d.color.b*a,1),n.drawElementsType(Mi.a.TriangleFillMode,0,6)}return n.setDepthBuffer(!0),n.setAlphaMode(m.a.ALPHA_DISABLE),!0},e.prototype.dispose=function(){var e=this._vertexBuffers[Sn.b.PositionKind];for(e&&(e.dispose(),this._vertexBuffers[Sn.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var t=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(t,1)},e.Parse=function(t,n,r){var i=n.getLastEntryByID(t.emitterId),a=t.name||"lensFlareSystem#"+t.emitterId,s=new e(a,i,n);s.id=t.id||a,s.borderLimit=t.borderLimit;for(var l=0;l<t.flares.length;l++){var u=t.flares[l];Fi.AddFlare(u.size,u.position,o.e.FromArray(u.color),u.textureName?r+u.textureName:"",s)}return s},e.prototype.serialize=function(){var e={};e.id=this.id,e.name=this.name,e.emitterId=this.getEmitter().id,e.borderLimit=this.borderLimit,e.flares=[];for(var t=0;t<this.lensFlares.length;t++){var n=this.lensFlares[t];e.flares.push({size:n.size,position:n.position,color:n.color.asArray(),textureName:ye.h.GetFilename(n.texture?n.texture.name:"")})}return e},e._SceneComponentInitialization=function(e){throw be.a.WarnImport("LensFlareSystemSceneComponent")},e}();r.a.AddParser(Te.a.NAME_LENSFLARESYSTEM,function(e,t,n,r){if(void 0!==e.lensFlareSystems&&null!==e.lensFlareSystems){n.lensFlareSystems||(n.lensFlareSystems=new Array);for(var i=0,o=e.lensFlareSystems.length;i<o;i++){var a=e.lensFlareSystems[i],s=Ni.Parse(a,t,r);n.lensFlareSystems.push(s)}}}),r.a.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},r.a.prototype.getLensFlareSystemByID=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===e)return this.lensFlareSystems[t];return null},r.a.prototype.removeLensFlareSystem=function(e){var t=this.lensFlareSystems.indexOf(e);return-1!==t&&this.lensFlareSystems.splice(t,1),t},r.a.prototype.addLensFlareSystem=function(e){this.lensFlareSystems.push(e)};var Bi=function(){function e(e){this.name=Te.a.NAME_LENSFLARESYSTEM,this.scene=e,e.lensFlareSystems=new Array}return e.prototype.register=function(){this.scene._afterCameraDrawStage.registerStep(Te.a.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,this,this._draw)},e.prototype.rebuild=function(){},e.prototype.addFromContainer=function(e){var t=this;e.lensFlareSystems&&e.lensFlareSystems.forEach(function(e){t.scene.addLensFlareSystem(e)})},e.prototype.removeFromContainer=function(e,t){var n=this;e.lensFlareSystems&&e.lensFlareSystems.forEach(function(e){n.scene.removeLensFlareSystem(e),t&&e.dispose()})},e.prototype.serialize=function(e){e.lensFlareSystems=[];for(var t=0,n=this.scene.lensFlareSystems;t<n.length;t++){var r=n[t];e.lensFlareSystems.push(r.serialize())}},e.prototype.dispose=function(){for(var e=this.scene.lensFlareSystems;e.length;)e[0].dispose()},e.prototype._draw=function(e){if(this.scene.lensFlaresEnabled){var t=this.scene.lensFlareSystems;ye.h.StartPerformanceCounter("Lens flares",t.length>0);for(var n=0,r=t;n<r.length;n++){var i=r[n];0!=(e.layerMask&i.layerMask)&&i.render()}ye.h.EndPerformanceCounter("Lens flares",t.length>0)}},e}();Ni._SceneComponentInitialization=function(e){var t=e._getComponent(Te.a.NAME_LENSFLARESYSTEM);t||(t=new Bi(e),e._addComponent(t))},zt.a.ShadersStore.shadowMapPixelShader="#ifndef FLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.z*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}",zt.a.ShadersStore.shadowMapVertexShader="\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\nuniform vec3 lightData;\n#endif\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\n#include<helperFunctions>\nuniform mat4 viewProjection;\nuniform vec3 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvec3 worldNor=normalize(normalWorld*normal);\n#ifdef DIRECTIONINLIGHTDATA\nvec3 worldLightDir=normalize(-lightData.xyz);\n#else\nvec3 directionToLight=lightData.xyz-worldPos.xyz;\nvec3 worldLightDir=normalize(directionToLight);\n#endif\nfloat ndl=dot(worldNor,worldLightDir);\nfloat sinNL=sqrt(1.0-ndl*ndl);\nfloat normalBias=biasAndScale.y*sinNL;\nworldPos.xyz-=worldNor*normalBias;\n#endif\n\ngl_Position=viewProjection*worldPos;\n#ifdef DEPTHTEXTURE\n\ngl_Position.z+=biasAndScale.x*gl_Position.w;\n#endif\n\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",zt.a.ShadersStore.depthBoxBlurPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}";var Ui=function(){function e(t,n,r){this.onBeforeShadowMapRenderObservable=new i.c,this.onBeforeShadowMapRenderMeshObservable=new i.c,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=e.FILTER_NONE,this._filteringQuality=e.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=o.x.Zero(),this._viewMatrix=o.j.Zero(),this._projectionMatrix=o.j.Zero(),this._transformMatrix=o.j.Zero(),this._cachedPosition=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new o.x(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=o.j.Identity(),this._mapSize=t,this._light=n,this._scene=n.getScene(),n._shadowGenerator=this,e._SceneComponentInitialization(this._scene);var a=this._scene.getEngine().getCaps();r?a.textureFloatRender&&a.textureFloatLinearFiltering?this._textureType=m.a.TEXTURETYPE_FLOAT:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?this._textureType=m.a.TEXTURETYPE_HALF_FLOAT:this._textureType=m.a.TEXTURETYPE_UNSIGNED_INT:a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?this._textureType=m.a.TEXTURETYPE_HALF_FLOAT:a.textureFloatRender&&a.textureFloatLinearFiltering?this._textureType=m.a.TEXTURETYPE_FLOAT:this._textureType=m.a.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator(),this._applyFilterValues()}return Object.defineProperty(e.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalBias",{get:function(){return this._normalBias},set:function(e){this._normalBias=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filter",{get:function(){return this._filter},set:function(t){if(this._light.needCube()){if(t===e.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(t===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(t===e.FILTER_PCF||t===e.FILTER_PCSS)return void(this.usePoissonSampling=!0)}t!==e.FILTER_PCF&&t!==e.FILTER_PCSS||1!==this._scene.getEngine().webGLVersion?this._filter!==t&&(this._filter=t,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePoissonSampling",{get:function(){return this.filter===e.FILTER_POISSONSAMPLING},set:function(t){(t||this.filter===e.FILTER_POISSONSAMPLING)&&(this.filter=t?e.FILTER_POISSONSAMPLING:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useExponentialShadowMap",{get:function(){return this.filter===e.FILTER_EXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_EXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_BLUREXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_CLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(t){(t||this.filter===e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=t?e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usePercentageCloserFiltering",{get:function(){return this.filter===e.FILTER_PCF},set:function(t){(t||this.filter===e.FILTER_PCF)&&(this.filter=t?e.FILTER_PCF:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filteringQuality",{get:function(){return this._filteringQuality},set:function(e){this._filteringQuality=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useContactHardeningShadow",{get:function(){return this.filter===e.FILTER_PCSS},set:function(t){(t||this.filter===e.FILTER_PCSS)&&(this.filter=t?e.FILTER_PCSS:e.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contactHardeningLightSizeUVRatio",{get:function(){return this._contactHardeningLightSizeUVRatio},set:function(e){this._contactHardeningLightSizeUVRatio=e},enumerable:!0,configurable:!0}),e.prototype.getDarkness=function(){return this._darkness},e.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},e.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},e.prototype.getShadowMap=function(){return this._shadowMap},e.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},e.prototype.addShadowCaster=function(e,t){var n;return void 0===t&&(t=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(e),t&&(n=this._shadowMap.renderList).push.apply(n,e.getChildMeshes()),this):this},e.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var n=this._shadowMap.renderList.indexOf(e);if(-1!==n&&this._shadowMap.renderList.splice(n,1),t)for(var r=0,i=e.getChildren();r<i.length;r++){var o=i[r];this.removeShadowCaster(o)}return this},e.prototype.getLight=function(){return this._light},e.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},e.prototype._initializeShadowMap=function(){var t=this,n=this._scene.getEngine();n.webGLVersion>1?(this._shadowMap=new un(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1),this._shadowMap.createDepthStencilTexture(m.a.LESS,!0)):this._shadowMap=new un(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(r){t._currentFaceIndex=r,t._filter===e.FILTER_PCF&&n.setColorWrite(!1)}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(t._filter===e.FILTER_PCF&&n.setColorWrite(!0),t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){var r=t.getShadowMapForRendering();r&&t._scene.postProcessManager.directRender(t._blurPostProcesses,r.getInternalTexture(),!0)}});var r=new o.f(0,0,0,0),i=new o.f(1,1,1,1);this._shadowMap.onClearObservable.add(function(n){t._filter===e.FILTER_PCF?n.clear(i,!1,!0,!1):t.useExponentialShadowMap||t.useBlurExponentialShadowMap?n.clear(r,!0,!0,!1):n.clear(i,!0,!0,!1)})},e.prototype._initializeBlurRTTAndPostProcesses=function(){var e=this,t=this._scene.getEngine(),n=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new un(this._light.name+"_shadowMap2",n,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new zr(this._light.name+"KernelBlurX",new o.w(1,0),this.blurKernel,1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.width=n,this._kernelBlurXPostprocess.height=n,this._kernelBlurXPostprocess.onApplyObservable.add(function(t){t.setTexture("textureSampler",e._shadowMap)}),this._kernelBlurYPostprocess=new zr(this._light.name+"KernelBlurY",new o.w(0,1),this.blurKernel,1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===m.a.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new jt(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(t){t.setFloat2("screenSize",n,n),t.setTexture("textureSampler",e._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},e.prototype._renderForShadowMap=function(e,t,n,r){var i,o=this._scene.getEngine();if(r.length){for(o.setColorWrite(!1),i=0;i<r.length;i++)this._renderSubMeshForShadowMap(r.data[i]);o.setColorWrite(!0)}for(i=0;i<e.length;i++)this._renderSubMeshForShadowMap(e.data[i]);for(i=0;i<t.length;i++)this._renderSubMeshForShadowMap(t.data[i]);if(this._transparencyShadow)for(i=0;i<n.length;i++)this._renderSubMeshForShadowMap(n.data[i])},e.prototype._renderSubMeshForShadowMap=function(e){var t=this,n=e.getRenderingMesh(),r=this._scene,i=r.getEngine(),o=e.getMaterial();if(n._internalAbstractMeshDataInfo._isActiveIntermediate=!1,o&&0!==e.verticesCount){i.setState(o.backFaceCulling);var a=n._getInstancesRenderList(e._id);if(!a.mustReturn){var s=i.getCaps().instancedArrays&&null!==a.visibleInstances[e._id]&&void 0!==a.visibleInstances[e._id];if(this.isReady(e,s)){if(i.enableEffect(this._effect),n._bind(e,this._effect,Mi.a.TriangleFillMode),this._effect.setFloat3("biasAndScale",this.bias,this.normalBias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this.getLight().getTypeID()===Fr.a.LIGHTTYPEID_DIRECTIONALLIGHT?this._effect.setVector3("lightData",this._cachedDirection):this._effect.setVector3("lightData",this._cachedPosition),r.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(r.activeCamera),this.getLight().getDepthMinZ(r.activeCamera)+this.getLight().getDepthMaxZ(r.activeCamera)),o&&o.needAlphaTesting()){var l=o.getAlphaTestTexture();l&&(this._effect.setTexture("diffuseSampler",l),this._effect.setMatrix("diffuseMatrix",l.getTextureMatrix()||this._defaultTextureMatrix))}if(n.useBones&&n.computeBonesUsingShaders&&n.skeleton){var u=n.skeleton;if(u.isUsingTextureForMatrices){var c=u.getTransformMatrixTexture();if(!c)return;this._effect.setTexture("boneSampler",c),this._effect.setFloat("boneTextureWidth",4*(u.bones.length+1))}else this._effect.setMatrices("mBones",u.getTransformMatrices(n))}Wr.a.BindMorphTargetParameters(n,this._effect),this.forceBackFacesOnly&&i.setState(!0,0,!1,!0),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(n),this.onBeforeShadowMapRenderObservable.notifyObservers(this._effect),n._processRendering(e,this._effect,Mi.a.TriangleFillMode,a,s,function(e,n){return t._effect.setMatrix("world",n)}),this.forceBackFacesOnly&&i.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},e.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===e.FILTER_NONE||this.filter===e.FILTER_PCSS?this._shadowMap.updateSamplingMode(Ge.a.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(Ge.a.BILINEAR_SAMPLINGMODE))},e.prototype.forceCompilation=function(e,t){var n=this,r=u.a({useInstances:!1},t),i=this.getShadowMap();if(i){var o=i.renderList;if(o){for(var a=new Array,s=0,l=o;s<l.length;s++){var c=l[s];a.push.apply(a,c.subMeshes)}if(0!==a.length){var h=0;!function t(){if(n._scene&&n._scene.getEngine()){for(;n.isReady(a[h],r.useInstances);)if(++h>=a.length)return void(e&&e(n));setTimeout(t,16)}}()}else e&&e(this)}else e&&e(this)}else e&&e(this)},e.prototype.forceCompilationAsync=function(e){var t=this;return new Promise(function(n){t.forceCompilation(function(){n()},e)})},e.prototype.isReady=function(e,t){var n=[];this._textureType!==m.a.TEXTURETYPE_UNSIGNED_INT&&n.push("#define FLOAT"),this.useExponentialShadowMap||this.useBlurExponentialShadowMap?n.push("#define ESM"):(this.usePercentageCloserFiltering||this.useContactHardeningShadow)&&n.push("#define DEPTHTEXTURE");var r=[Sn.b.PositionKind],i=e.getMesh(),o=e.getMaterial();if(this.normalBias&&i.isVerticesDataPresent(Sn.b.NormalKind)&&(r.push(Sn.b.NormalKind),n.push("#define NORMAL"),i.nonUniformScaling&&n.push("#define NONUNIFORMSCALING"),this.getLight().getTypeID()===Fr.a.LIGHTTYPEID_DIRECTIONALLIGHT&&n.push("#define DIRECTIONINLIGHTDATA")),o&&o.needAlphaTesting()){var a=o.getAlphaTestTexture();a&&(n.push("#define ALPHATEST"),i.isVerticesDataPresent(Sn.b.UVKind)&&(r.push(Sn.b.UVKind),n.push("#define UV1")),i.isVerticesDataPresent(Sn.b.UV2Kind)&&1===a.coordinatesIndex&&(r.push(Sn.b.UV2Kind),n.push("#define UV2")))}if(i.useBones&&i.computeBonesUsingShaders&&i.skeleton){r.push(Sn.b.MatricesIndicesKind),r.push(Sn.b.MatricesWeightsKind),i.numBoneInfluencers>4&&(r.push(Sn.b.MatricesIndicesExtraKind),r.push(Sn.b.MatricesWeightsExtraKind));var s=i.skeleton;n.push("#define NUM_BONE_INFLUENCERS "+i.numBoneInfluencers),s.isUsingTextureForMatrices?n.push("#define BONETEXTURE"):n.push("#define BonesPerMesh "+(s.bones.length+1))}else n.push("#define NUM_BONE_INFLUENCERS 0");var l=i.morphTargetManager,u=0;if(l&&l.numInfluencers>0&&(n.push("#define MORPHTARGETS"),u=l.numInfluencers,n.push("#define NUM_MORPH_INFLUENCERS "+u),Wr.a.PrepareAttributesForMorphTargets(r,i,{NUM_MORPH_INFLUENCERS:u})),t&&(n.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3")),this.customShaderOptions&&this.customShaderOptions.defines)for(var c=0,h=this.customShaderOptions.defines;c<h.length;c++){var d=h[c];-1===n.indexOf(d)&&n.push(d)}var f=n.join("\n");if(this._cachedDefines!==f){this._cachedDefines=f;var p="shadowMap",g=["world","mBones","viewProjection","diffuseMatrix","lightData","depthValues","biasAndScale","morphTargetInfluences","boneTextureWidth"],_=["diffuseSampler","boneSampler"];if(this.customShaderOptions){if(p=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(var v=0,y=this.customShaderOptions.attributes;v<y.length;v++){var b=y[v];-1===r.indexOf(b)&&r.push(b)}if(this.customShaderOptions.uniforms)for(var E=0,x=this.customShaderOptions.uniforms;E<x.length;E++){var T=x[E];-1===g.indexOf(T)&&g.push(T)}if(this.customShaderOptions.samplers)for(var S=0,A=this.customShaderOptions.samplers;S<A.length;S++){var P=A[S];-1===_.indexOf(P)&&_.push(P)}}this._effect=this._scene.getEngine().createEffect(p,r,g,_,f,void 0,void 0,void 0,{maxSimultaneousMorphTargets:u})}return!!this._effect.isReady()&&((this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady())&&!(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady())&&!(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()))},e.prototype.prepareDefines=function(t,n){var r=this._scene,i=this._light;r.shadowsEnabled&&i.shadowEnabled&&(t["SHADOW"+n]=!0,this.useContactHardeningShadow&&(t["SHADOWPCSS"+n]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+n]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+n]=!0)),this.usePercentageCloserFiltering?(t["SHADOWPCF"+n]=!0,this._filteringQuality===e.QUALITY_LOW?t["SHADOWLOWQUALITY"+n]=!0:this._filteringQuality===e.QUALITY_MEDIUM&&(t["SHADOWMEDIUMQUALITY"+n]=!0)):this.usePoissonSampling?t["SHADOWPOISSON"+n]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?t["SHADOWESM"+n]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(t["SHADOWCLOSEESM"+n]=!0),i.needCube()&&(t["SHADOWCUBE"+n]=!0))},e.prototype.bindShadowLight=function(t,n){var r=this._light,i=this._scene;if(i.shadowsEnabled&&r.shadowEnabled){var o=i.activeCamera;if(o){var a=this.getShadowMap();a&&(r.needCube()||n.setMatrix("lightMatrix"+t,this.getTransformMatrix()),this._filter===e.FILTER_PCF?(n.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),a.getSize().width,1/a.getSize().width,this.frustumEdgeFalloff,t)):this._filter===e.FILTER_PCSS?(n.setDepthStencilTexture("shadowSampler"+t,this.getShadowMapForRendering()),n.setTexture("depthSampler"+t,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/a.getSize().width,this._contactHardeningLightSizeUVRatio*a.getSize().width,this.frustumEdgeFalloff,t)):(n.setTexture("shadowSampler"+t,this.getShadowMapForRendering()),r._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/a.getSize().width,this.depthScale,this.frustumEdgeFalloff,t)),r._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(o),this.getLight().getDepthMinZ(o)+this.getLight().getDepthMaxZ(o),t))}}},e.prototype.getTransformMatrix=function(){var e=this._scene;if(this._currentRenderID===e.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=e.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var t=this._light.position;if(this._light.computeTransformedInformation()&&(t=this._light.transformedPosition),o.x.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(o.x.Dot(this._lightDirection,o.x.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!t.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(t),this._cachedDirection.copyFrom(this._lightDirection),o.j.LookAtLHToRef(t,t.add(this._lightDirection),o.x.Up(),this._viewMatrix);var n=this.getShadowMap();if(n){var r=n.renderList;r&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,r)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},e.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=t}},e.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},e.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},e.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},e.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.lightId=this._light.id,e.mapSize=t.getRenderSize(),e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.forceBackFacesOnly=this.forceBackFacesOnly,e.depthScale=this.depthScale,e.darkness=this.getDarkness(),e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.transparencyShadow=this._transparencyShadow,e.frustumEdgeFalloff=this.frustumEdgeFalloff,e.bias=this.bias,e.normalBias=this.normalBias,e.usePercentageCloserFiltering=this.usePercentageCloserFiltering,e.useContactHardeningShadow=this.useContactHardeningShadow,e.filteringQuality=this.filteringQuality,e.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,e.renderList=[],t.renderList)for(var n=0;n<t.renderList.length;n++){var r=t.renderList[n];e.renderList.push(r.id)}return e},e.Parse=function(t,n){for(var r=n.getLightByID(t.lightId),i=new e(t.mapSize,r),o=i.getShadowMap(),a=0;a<t.renderList.length;a++)n.getMeshesByID(t.renderList[a]).forEach(function(e){o&&(o.renderList||(o.renderList=[]),o.renderList.push(e))});return t.usePoissonSampling?i.usePoissonSampling=!0:t.useExponentialShadowMap?i.useExponentialShadowMap=!0:t.useBlurExponentialShadowMap?i.useBlurExponentialShadowMap=!0:t.useCloseExponentialShadowMap?i.useCloseExponentialShadowMap=!0:t.useBlurCloseExponentialShadowMap?i.useBlurCloseExponentialShadowMap=!0:t.usePercentageCloserFiltering?i.usePercentageCloserFiltering=!0:t.useContactHardeningShadow&&(i.useContactHardeningShadow=!0),t.filteringQuality&&(i.filteringQuality=t.filteringQuality),t.contactHardeningLightSizeUVRatio?i.contactHardeningLightSizeUVRatio=t.contactHardeningLightSizeUVRatio:t.useVarianceShadowMap?i.useExponentialShadowMap=!0:t.useBlurVarianceShadowMap&&(i.useBlurExponentialShadowMap=!0),t.depthScale&&(i.depthScale=t.depthScale),t.blurScale&&(i.blurScale=t.blurScale),t.blurBoxOffset&&(i.blurBoxOffset=t.blurBoxOffset),t.useKernelBlur&&(i.useKernelBlur=t.useKernelBlur),t.blurKernel&&(i.blurKernel=t.blurKernel),void 0!==t.bias&&(i.bias=t.bias),void 0!==t.normalBias&&(i.normalBias=t.normalBias),void 0!==t.frustumEdgeFalloff&&(i.frustumEdgeFalloff=t.frustumEdgeFalloff),t.darkness&&i.setDarkness(t.darkness),t.transparencyShadow&&i.setTransparencyShadow(!0),i.forceBackFacesOnly=t.forceBackFacesOnly,i},e.FILTER_NONE=0,e.FILTER_EXPONENTIALSHADOWMAP=1,e.FILTER_POISSONSAMPLING=2,e.FILTER_BLUREXPONENTIALSHADOWMAP=3,e.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.FILTER_PCF=6,e.FILTER_PCSS=7,e.QUALITY_HIGH=0,e.QUALITY_MEDIUM=1,e.QUALITY_LOW=2,e._SceneComponentInitialization=function(e){throw be.a.WarnImport("ShadowGeneratorSceneComponent")},e}();r.a.AddParser(Te.a.NAME_SHADOWGENERATOR,function(e,t){if(void 0!==e.shadowGenerators&&null!==e.shadowGenerators)for(var n=0,r=e.shadowGenerators.length;n<r;n++){var i=e.shadowGenerators[n];Ui.Parse(i,t)}});var ki=function(){function e(e){this.name=Te.a.NAME_SHADOWGENERATOR,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Te.a.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.serialize=function(e){e.shadowGenerators=[];for(var t=0,n=this.scene.lights;t<n.length;t++){var r=n[t].getShadowGenerator();r&&e.shadowGenerators.push(r.serialize())}},e.prototype.addFromContainer=function(e){},e.prototype.removeFromContainer=function(e,t){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){var t=this.scene;if(this.scene.shadowsEnabled)for(var n=0;n<t.lights.length;n++){var r=t.lights[n],i=r.getShadowGenerator();if(r.isEnabled()&&r.shadowEnabled&&i){var o=i.getShadowMap();-1!==t.textures.indexOf(o)&&e.push(o)}}},e}();Ui._SceneComponentInitialization=function(e){var t=e._getComponent(Te.a.NAME_SHADOWGENERATOR);t||(t=new ki(e),e._addComponent(t))},F.a.AddNodeConstructor("Light_Type_0",function(e,t){return function(){return new Vi(e,o.x.Zero(),t)}});var Vi=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i._shadowAngle=Math.PI/2,i.position=n,i}return u.d(t,e),Object.defineProperty(t.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PointLight"},t.prototype.getTypeID=function(){return Fr.a.LIGHTTYPEID_POINTLIGHT},t.prototype.needCube=function(){return!this.direction},t.prototype.getShadowDirection=function(t){if(this.direction)return e.prototype.getShadowDirection.call(this,t);switch(t){case 0:return new o.x(1,0,0);case 1:return new o.x(-1,0,0);case 2:return new o.x(0,-1,0);case 3:return new o.x(0,1,0);case 4:return new o.x(0,0,1);case 5:return new o.x(0,0,-1)}return o.x.Zero()},t.prototype._setDefaultShadowProjectionMatrix=function(e,t,n){var r=this.getScene().activeCamera;r&&o.j.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(r),this.getDepthMaxZ(r),e)},t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this},t.prototype.prepareLightSpecificDefines=function(e,t){e["POINTLIGHT"+t]=!0},u.c([Object(D.c)()],t.prototype,"shadowAngle",null),t}(Nr),Gi=function(){function e(e,t,n){var r=this;void 0===t&&(t=""),void 0===n&&(n="black"),this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=n,this._resizeLoadingUI=function(){var e=r._renderingCanvas.getBoundingClientRect(),t=window.getComputedStyle(r._renderingCanvas).position;r._loadingDiv&&(r._loadingDiv.style.position="fixed"===t?"fixed":"absolute",r._loadingDiv.style.left=e.left+"px",r._loadingDiv.style.top=e.top+"px",r._loadingDiv.style.width=e.width+"px",r._loadingDiv.style.height=e.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var t=document.createElement("style");t.type="text/css",t.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(t);var n=new Image;e.DefaultLogoUrl?n.src=e.DefaultLogoUrl:n.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.width="10vw",n.style.height="10vw",n.style.marginLeft="-5vw",n.style.marginTop="-5vw";var r=new Image;e.DefaultSpinnerUrl?r.src=e.DefaultSpinnerUrl:r.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==",r.style.position="absolute",r.style.left="50%",r.style.top="50%",r.style.width="18vw",r.style.height="18vw",r.style.marginLeft="-9vw",r.style.marginTop="-9vw",r.style.animation="spin1 0.75s infinite linear",r.style.webkitAnimation="spin1 0.75s infinite linear",r.style.transformOrigin="50% 50%",r.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(n),this._loadingDiv.appendChild(r),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var e=this;this._loadingDiv&&(this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",function(){e._loadingDiv&&(e._loadingDiv.parentElement&&e._loadingDiv.parentElement.removeChild(e._loadingDiv),window.removeEventListener("resize",e._resizeLoadingUI),e._loadingDiv=null)}))},Object.defineProperty(e.prototype,"loadingUIText",{get:function(){return this._loadingText},set:function(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),e.DefaultLogoUrl="",e.DefaultSpinnerUrl="",e}();ge.b.DefaultLoadingScreenFactory=function(e){return new Gi(e)};var zi=n(57),ji=n(66),Hi=function(){function e(){}return e.ConvertPanoramaToCubemap=function(e,t,n,r){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=t*n*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(r,this.FACE_FRONT,e,t,n),back:this.CreateCubemapTexture(r,this.FACE_BACK,e,t,n),left:this.CreateCubemapTexture(r,this.FACE_LEFT,e,t,n),right:this.CreateCubemapTexture(r,this.FACE_RIGHT,e,t,n),up:this.CreateCubemapTexture(r,this.FACE_UP,e,t,n),down:this.CreateCubemapTexture(r,this.FACE_DOWN,e,t,n),size:r,type:m.a.TEXTURETYPE_FLOAT,format:m.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},e.CreateCubemapTexture=function(e,t,n,r,i){for(var o=new ArrayBuffer(e*e*4*3),a=new Float32Array(o),s=t[1].subtract(t[0]).scale(1/e),l=t[3].subtract(t[2]).scale(1/e),u=1/e,c=0,h=0;h<e;h++){for(var d=t[0],f=t[2],p=0;p<e;p++){var m=f.subtract(d).scale(c).add(d);m.normalize();var g=this.CalcProjectionSpherical(m,n,r,i);a[h*e*3+3*p+0]=g.r,a[h*e*3+3*p+1]=g.g,a[h*e*3+3*p+2]=g.b,d=d.add(s),f=f.add(l)}c+=u}return a},e.CalcProjectionSpherical=function(e,t,n,r){for(var i=Math.atan2(e.z,e.x),o=Math.acos(e.y);i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;var a=i/Math.PI,s=o/Math.PI;a=.5*a+.5;var l=Math.round(a*n);l<0?l=0:l>=n&&(l=n-1);var u=Math.round(s*r);u<0?u=0:u>=r&&(u=r-1);var c=r-u-1;return{r:t[c*n*3+3*l+0],g:t[c*n*3+3*l+1],b:t[c*n*3+3*l+2]}},e.FACE_FRONT=[new o.x(-1,-1,-1),new o.x(1,-1,-1),new o.x(-1,1,-1),new o.x(1,1,-1)],e.FACE_BACK=[new o.x(1,-1,1),new o.x(-1,-1,1),new o.x(1,1,1),new o.x(-1,1,1)],e.FACE_RIGHT=[new o.x(1,-1,-1),new o.x(1,-1,1),new o.x(1,1,-1),new o.x(1,1,1)],e.FACE_LEFT=[new o.x(-1,-1,1),new o.x(-1,-1,-1),new o.x(-1,1,1),new o.x(-1,1,-1)],e.FACE_DOWN=[new o.x(-1,1,-1),new o.x(1,1,-1),new o.x(-1,1,1),new o.x(1,1,1)],e.FACE_UP=[new o.x(-1,-1,1),new o.x(1,-1,1),new o.x(-1,-1,-1),new o.x(1,-1,-1)],e}(),Wi=function(){function e(){}return e.Ldexp=function(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)},e.Rgbe2float=function(e,t,n,r,i,o){i>0?(i=this.Ldexp(1,i-136),e[o+0]=t*i,e[o+1]=n*i,e[o+2]=r*i):(e[o+0]=0,e[o+1]=0,e[o+2]=0)},e.readStringLine=function(e,t){for(var n="",r="",i=t;i<e.length-t&&"\n"!=(r=String.fromCharCode(e[i]));i++)n+=r;return n},e.RGBE_ReadHeader=function(e){var t,n,r=this.readStringLine(e,0);if("#"!=r[0]||"?"!=r[1])throw"Bad HDR Format.";var i=!1,o=!1,a=0;do{a+=r.length+1,"FORMAT=32-bit_rle_rgbe"==(r=this.readStringLine(e,a))?o=!0:0==r.length&&(i=!0)}while(!i);if(!o)throw"HDR Bad header format, unsupported FORMAT";a+=r.length+1,r=this.readStringLine(e,a);var s=/^\-Y (.*) \+X (.*)$/g.exec(r);if(!s||s.length<3)throw"HDR Bad header format, no size";if(n=parseInt(s[2]),t=parseInt(s[1]),n<8||n>32767)throw"HDR Bad header format, unsupported size";return{height:t,width:n,dataPosition:a+=r.length+1}},e.GetCubeMapTextureData=function(e,t){var n=new Uint8Array(e),r=this.RGBE_ReadHeader(n),i=this.RGBE_ReadPixels_RLE(n,r);return Hi.ConvertPanoramaToCubemap(i,r.width,r.height,t)},e.RGBE_ReadPixels=function(e,t){return this.RGBE_ReadPixels_RLE(e,t)},e.RGBE_ReadPixels_RLE=function(e,t){for(var n,r,i,o,a,s=t.height,l=t.width,u=t.dataPosition,c=0,h=0,d=0,f=new ArrayBuffer(4*l),p=new Uint8Array(f),m=new ArrayBuffer(t.width*t.height*4*3),g=new Float32Array(m);s>0;){if(n=e[u++],r=e[u++],i=e[u++],o=e[u++],2!=n||2!=r||128&i)throw"HDR Bad header format, not RLE";if((i<<8|o)!=l)throw"HDR Bad header format, wrong scan line width";for(c=0,d=0;d<4;d++)for(h=(d+1)*l;c<h;)if(n=e[u++],r=e[u++],n>128){if(0==(a=n-128)||a>h-c)throw"HDR Bad Format, bad scanline data (run)";for(;a-- >0;)p[c++]=r}else{if(0==(a=n)||a>h-c)throw"HDR Bad Format, bad scanline data (non-run)";if(p[c++]=r,--a>0)for(var _=0;_<a;_++)p[c++]=e[u++]}for(d=0;d<l;d++)n=p[d],r=p[d+l],i=p[d+2*l],o=p[d+3*l],this.Rgbe2float(g,n,r,i,o,(t.height-s)*l*3+3*d);s--}return g},e}(),Xi=function(e){function t(t,n,r,i,a,s,l,u,c){void 0===i&&(i=!1),void 0===a&&(a=!0),void 0===s&&(s=!1),void 0===l&&(l=!1),void 0===u&&(u=null),void 0===c&&(c=null);var h=e.call(this,n)||this;return h._generateHarmonics=!0,h._onLoad=null,h._onError=null,h.coordinatesMode=Ge.a.CUBIC_MODE,h._isBlocking=!0,h._rotationY=0,h.boundingBoxPosition=o.x.Zero(),t?(h.name=t,h.url=t,h.hasAlpha=!1,h.isCube=!0,h._textureMatrix=o.j.Identity(),h._onLoad=u,h._onError=c,h.gammaSpace=s,h._noMipmap=i,h._size=r,h._texture=h._getFromCache(t,h._noMipmap),h._texture?u&&(h._texture.isReady?ye.h.SetImmediate(function(){return u()}):h._texture.onLoadedObservable.add(u)):n.useDelayedTextureLoading?h.delayLoadState=ge.b.DELAYLOADSTATE_NOTLOADED:h.loadTexture(),h):h}return u.d(t,e),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e,this.setReflectionTextureMatrix(o.j.RotationY(this._rotationY))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag)}},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"HDRCubeTexture"},t.prototype.loadTexture=function(){var e=this,n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,ge.b.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?ge.b.TEXTURETYPE_FLOAT:ge.b.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,function(n){e.lodGenerationOffset=0,e.lodGenerationScale=.8;var r=e.getScene();if(!r)return null;var i=Wi.GetCubeMapTextureData(n,e._size);if(e._generateHarmonics){var a=hi.a.ConvertCubeMapToSphericalPolynomial(i);e.sphericalPolynomial=a}for(var s=[],l=null,u=0;u<6;u++){if(!r.getEngine().getCaps().textureFloat){var c=new ArrayBuffer(e._size*e._size*3);l=new Uint8Array(c)}var h=i[t._facesMapping[u]];if(e.gammaSpace||l)for(var d=0;d<e._size*e._size;d++)if(e.gammaSpace&&(h[3*d+0]=Math.pow(h[3*d+0],o.u),h[3*d+1]=Math.pow(h[3*d+1],o.u),h[3*d+2]=Math.pow(h[3*d+2],o.u)),l){var f=Math.max(255*h[3*d+0],0),p=Math.max(255*h[3*d+1],0),m=Math.max(255*h[3*d+2],0),g=Math.max(Math.max(f,p),m);if(g>255){var _=255/g;f*=_,p*=_,m*=_}l[3*d+0]=f,l[3*d+1]=p,l[3*d+2]=m}l?s.push(l):s.push(h)}return s},null,this._onLoad,this._onError))},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=new t(this.url,e,this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n.coordinatesIndex=this.coordinatesIndex,n.coordinatesMode=this.coordinatesMode,n},t.prototype.delayLoad=function(){this.delayLoadState===ge.b.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=ge.b.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},t.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},t.prototype.setReflectionTextureMatrix=function(e){var t=this;this._textureMatrix=e,e.updateFlag!==this._textureMatrix.updateFlag&&e.isIdentity()!==this._textureMatrix.isIdentity()&&this.getScene().markAllMaterialsAsDirty(m.a.MATERIAL_TextureDirtyFlag,function(e){return-1!==e.getActiveTextures().indexOf(t)})},t.Parse=function(e,n,r){var i=null;return e.name&&!e.isRenderTarget&&((i=new t(r+e.name,n,e.size,e.noMipmap,e.generateHarmonics,e.useInGammaSpace)).name=e.name,i.hasAlpha=e.hasAlpha,i.level=e.level,i.coordinatesMode=e.coordinatesMode,i.isBlocking=e.isBlocking),i&&(e.boundingBoxPosition&&(i.boundingBoxPosition=o.x.FromArray(e.boundingBoxPosition)),e.boundingBoxSize&&(i.boundingBoxSize=o.x.FromArray(e.boundingBoxSize)),e.rotationY&&(i.rotationY=e.rotationY)),i},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this.gammaSpace,e.generateHarmonics=this._generateHarmonics,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e.rotationY=this._rotationY,e},t._facesMapping=["right","left","up","down","front","back"],t}(Gr.a);a.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=Xi;var Yi=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=null),this.name=e,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new i.c,this._onDataLayoutChanged=new i.c,this._animationPropertiesOverride=null,this._scene=n||P.a.LastCreatedScene,this.influence=t}return Object.defineProperty(e.prototype,"influence",{get:function(){return this._influence},set:function(e){if(this._influence!==e){var t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),e.prototype.setPositions=function(e){var t=this.hasPositions;this._positions=e,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getPositions=function(){return this._positions},e.prototype.setNormals=function(e){var t=this.hasNormals;this._normals=e,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getNormals=function(){return this._normals},e.prototype.setTangents=function(e){var t=this.hasTangents;this._tangents=e,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},e.prototype.getTangents=function(){return this._tangents},e.prototype.serialize=function(){var e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),D.a.AppendSerializedAnimations(this,e),e},e.prototype.getClassName=function(){return"MorphTarget"},e.Parse=function(t){var n=new e(t.name,t.influence);if(n.setPositions(t.positions),null!=t.id&&(n.id=t.id),t.normals&&n.setNormals(t.normals),t.tangents&&n.setTangents(t.tangents),t.animations)for(var r=0;r<t.animations.length;r++){var i=t.animations[r],o=a.a.GetClass("BABYLON.Animation");o&&n.animations.push(o.Parse(i))}return n},e.FromMesh=function(t,n,r){n||(n=t.name);var i=new e(n,r,t.getScene());return i.setPositions(t.getVerticesData(Sn.b.PositionKind)),t.isVerticesDataPresent(Sn.b.NormalKind)&&i.setNormals(t.getVerticesData(Sn.b.NormalKind)),t.isVerticesDataPresent(Sn.b.TangentKind)&&i.setTangents(t.getVerticesData(Sn.b.TangentKind)),i},u.c([Object(D.c)()],e.prototype,"id",void 0),e}(),Ki=function(){function e(e){void 0===e&&(e=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Gt.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,e||(e=P.a.LastCreatedScene),this._scene=e,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),e.prototype.getActiveTarget=function(e){return this._activeTargets.data[e]},e.prototype.getTarget=function(e){return this._targets[e]},e.prototype.addTarget=function(e){var t=this;this._targets.push(e),this._targetInfluenceChangedObservers.push(e.onInfluenceChanged.add(function(e){t._syncActiveTargets(e)})),this._targetDataLayoutChangedObservers.push(e._onDataLayoutChanged.add(function(){t._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},e.prototype.removeTarget=function(e){var t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),e._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._syncActiveTargets(!0))},e.prototype.serialize=function(){var e={};e.id=this.uniqueId,e.targets=[];for(var t=0,n=this._targets;t<n.length;t++){var r=n[t];e.targets.push(r.serialize())}return e},e.prototype._syncActiveTargets=function(e){var t=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var n=0,r=this._targets;n<r.length;n++){var i=r[n];if(0!==i.influence){this._activeTargets.push(i),this._tempInfluences[t++]=i.influence,this._supportsNormals=this._supportsNormals&&i.hasNormals,this._supportsTangents=this._supportsTangents&&i.hasTangents;var o=i.getPositions();if(o){var a=o.length/3;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return void p.a.Error("Incompatible target. Targets must all have the same vertices count.")}}}this._influences&&this._influences.length===t||(this._influences=new Float32Array(t));for(var s=0;s<t;s++)this._influences[s]=this._tempInfluences[s];e&&this.synchronize()},e.prototype.synchronize=function(){if(this._scene)for(var e=0,t=this._scene.meshes;e<t.length;e++){var n=t[e];n.morphTargetManager===this&&n._syncGeometryWithMorphTargetManager()}},e.Parse=function(t,n){var r=new e(n);r._uniqueId=t.id;for(var i=0,o=t.targets;i<o.length;i++){var a=o[i];r.addTarget(Yi.Parse(a))}return r},e}(),qi=n(27),Qi=n(37),Zi=function(){function e(t,n){if(void 0===n&&(n=e.DefaultPluginFactory()),this._physicsPlugin=n,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new o.x(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return e.DefaultPluginFactory=function(){throw be.a.WarnImport("CannonJSPlugin")},e.prototype.setGravity=function(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)},e.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._physicsPlugin.setTimeStep(e)},e.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},e.prototype.dispose=function(){this._impostors.forEach(function(e){e.dispose()}),this._physicsPlugin.dispose()},e.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},e.prototype.addImpostor=function(e){e.uniqueId=this._impostors.push(e),e.parent||this._physicsPlugin.generatePhysicsBody(e)},e.prototype.removeImpostor=function(e){var t=this._impostors.indexOf(e);t>-1&&this._impostors.splice(t,1).length&&this.getPhysicsPlugin().removePhysicsBody(e)},e.prototype.addJoint=function(e,t,n){var r={mainImpostor:e,connectedImpostor:t,joint:n};n.physicsPlugin=this._physicsPlugin,this._joints.push(r),this._physicsPlugin.generateJoint(r)},e.prototype.removeJoint=function(e,t,n){var r=this._joints.filter(function(r){return r.connectedImpostor===t&&r.joint===n&&r.mainImpostor===e});r.length&&this._physicsPlugin.removeJoint(r[0])},e.prototype._step=function(e){var t=this;this._impostors.forEach(function(e){e.isBodyInitRequired()&&t._physicsPlugin.generatePhysicsBody(e)}),e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._impostors)},e.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},e.prototype.getImpostors=function(){return this._impostors},e.prototype.getImpostorForPhysicsObject=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].object===e)return this._impostors[t];return null},e.prototype.getImpostorWithPhysicsBody=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].physicsBody===e)return this._impostors[t];return null},e.prototype.raycast=function(e,t){return this._physicsPlugin.raycast(e,t)},e.Epsilon=.001,e}(),Ji=function(){function e(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.x.Zero(),this._hitPointWorld=o.x.Zero(),this._rayFromWorld=o.x.Zero(),this._rayToWorld=o.x.Zero()}return Object.defineProperty(e.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!0,configurable:!0}),e.prototype.setHitData=function(e,t){this._hasHit=!0,this._hitNormalWorld=new o.x(e.x,e.y,e.z),this._hitPointWorld=new o.x(t.x,t.y,t.z)},e.prototype.setHitDistance=function(e){this._hitDistance=e},e.prototype.calculateHitDistance=function(){this._hitDistance=o.x.Distance(this._rayFromWorld,this._hitPointWorld)},e.prototype.reset=function(e,t){void 0===e&&(e=o.x.Zero()),void 0===t&&(t=o.x.Zero()),this._rayFromWorld=e,this._rayToWorld=t,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.x.Zero(),this._hitPointWorld=o.x.Zero()},e}(),$i=function(){function e(e,t,n){void 0===e&&(e=!0),void 0===t&&(t=10),void 0===n&&(n=CANNON),this._useDeltaForWorldStep=e,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._removeAfterStep=new Array,this._minus90X=new o.q(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new o.q(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=o.x.Zero(),this._tmpDeltaPosition=o.x.Zero(),this._tmpUnityRotation=new o.q,this.BJSCANNON=n,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=t,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new Ji):p.a.Error("CannonJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(e){this.world.gravity.copy(e)},e.prototype.setTimeStep=function(e){this._fixedTimeStep=e},e.prototype.getTimeStep=function(){return this._fixedTimeStep},e.prototype.executeStep=function(e){var t=this;this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?e:0,3),this._removeAfterStep.length>0&&(this._removeAfterStep.forEach(function(e){t.world.remove(e.physicsBody)}),this._removeAfterStep=[])},e.prototype.applyImpulse=function(e,t,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),i=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyImpulse(i,r)},e.prototype.applyForce=function(e,t,n){var r=new this.BJSCANNON.Vec3(n.x,n.y,n.z),i=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyForce(i,r)},e.prototype.generatePhysicsBody=function(e){if(e.parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else{if(e.isBodyInitRequired()){var t=this._createShape(e),n=e.physicsBody;n&&this.removePhysicsBody(e);var r=this._addMaterial("mat-"+e.uniqueId,e.getParam("friction"),e.getParam("restitution")),i={mass:e.getParam("mass"),material:r},o=e.getParam("nativeOptions");for(var a in o)o.hasOwnProperty(a)&&(i[a]=o[a]);e.physicsBody=new this.BJSCANNON.Body(i),e.physicsBody.addEventListener("collide",e.onCollide),this.world.addEventListener("preStep",e.beforeStep),this.world.addEventListener("postStep",e.afterStep),e.physicsBody.addShape(t),this.world.add(e.physicsBody),n&&["force","torque","velocity","angularVelocity"].forEach(function(t){e.physicsBody[t].copy(n[t])}),this._processChildMeshes(e)}this._updatePhysicsBodyTransformation(e)}},e.prototype._processChildMeshes=function(e){var t=this,n=e.object.getChildMeshes?e.object.getChildMeshes(!0):[],r=e.object.rotationQuaternion;n.length&&n.filter(function(e){return!!e.physicsImpostor}).forEach(function n(i,a){if(r&&a.rotationQuaternion){var s=a.getPhysicsImpostor();if(s&&s.parent!==e){var l=a.getAbsolutePosition().subtract(e.object.getAbsolutePosition()),u=a.rotationQuaternion.multiply(o.q.Inverse(r));s.physicsBody&&(t.removePhysicsBody(s),s.physicsBody=null),s.parent=e,s.resetUpdateFlags(),e.physicsBody.addShape(t._createShape(s),new t.BJSCANNON.Vec3(l.x,l.y,l.z),new t.BJSCANNON.Quaternion(u.x,u.y,u.z,u.w)),e.physicsBody.mass+=s.getParam("mass")}r.multiplyInPlace(a.rotationQuaternion),a.getChildMeshes(!0).filter(function(e){return!!e.physicsImpostor}).forEach(n.bind(t,a.getAbsolutePosition()))}}.bind(this,e.object.getAbsolutePosition()))},e.prototype.removePhysicsBody=function(e){e.physicsBody.removeEventListener("collide",e.onCollide),this.world.removeEventListener("preStep",e.beforeStep),this.world.removeEventListener("postStep",e.afterStep),this._removeAfterStep.push(e)},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,n=e.connectedImpostor.physicsBody;if(t&&n){var r,i=e.joint.jointData,o={pivotA:i.mainPivot?(new this.BJSCANNON.Vec3).copy(i.mainPivot):null,pivotB:i.connectedPivot?(new this.BJSCANNON.Vec3).copy(i.connectedPivot):null,axisA:i.mainAxis?(new this.BJSCANNON.Vec3).copy(i.mainAxis):null,axisB:i.connectedAxis?(new this.BJSCANNON.Vec3).copy(i.connectedAxis):null,maxForce:i.nativeParams.maxForce,collideConnected:!!i.collision};switch(e.joint.type){case Qi.e.HingeJoint:case Qi.e.Hinge2Joint:r=new this.BJSCANNON.HingeConstraint(t,n,o);break;case Qi.e.DistanceJoint:r=new this.BJSCANNON.DistanceConstraint(t,n,i.maxDistance||2);break;case Qi.e.SpringJoint:var a=i;r=new this.BJSCANNON.Spring(t,n,{restLength:a.length,stiffness:a.stiffness,damping:a.damping,localAnchorA:o.pivotA,localAnchorB:o.pivotB});break;case Qi.e.LockJoint:r=new this.BJSCANNON.LockConstraint(t,n,o);break;case Qi.e.PointToPointJoint:case Qi.e.BallAndSocketJoint:default:r=new this.BJSCANNON.PointToPointConstraint(t,o.pivotA,n,o.pivotB,o.maxForce)}r.collideConnected=!!i.collision,e.joint.physicsJoint=r,e.joint.type!==Qi.e.SpringJoint?this.world.addConstraint(r):(e.joint.jointData.forceApplicationCallback=e.joint.jointData.forceApplicationCallback||function(){r.applyForce()},e.mainImpostor.registerAfterPhysicsStep(e.joint.jointData.forceApplicationCallback))}},e.prototype.removeJoint=function(e){e.joint.type!==Qi.e.SpringJoint?this.world.removeConstraint(e.joint.physicsJoint):e.mainImpostor.unregisterAfterPhysicsStep(e.joint.jointData.forceApplicationCallback)},e.prototype._addMaterial=function(e,t,n){var r,i;for(r=0;r<this._physicsMaterials.length;r++)if((i=this._physicsMaterials[r]).friction===t&&i.restitution===n)return i;var o=new this.BJSCANNON.Material(e);return o.friction=t,o.restitution=n,this._physicsMaterials.push(o),o},e.prototype._checkWithEpsilon=function(e){return e<Zi.Epsilon?Zi.Epsilon:e},e.prototype._createShape=function(e){var t,n=e.object,r=e.getObjectExtendSize();switch(e.type){case qi.a.SphereImpostor:var i=r.x,a=r.y,s=r.z;t=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(i),this._checkWithEpsilon(a),this._checkWithEpsilon(s))/2);break;case qi.a.CylinderImpostor:var l=e.getParam("nativeOptions");l||(l={});var u=void 0!==l.radiusTop?l.radiusTop:this._checkWithEpsilon(r.x)/2,c=void 0!==l.radiusBottom?l.radiusBottom:this._checkWithEpsilon(r.x)/2,h=void 0!==l.height?l.height:this._checkWithEpsilon(r.y),d=void 0!==l.numSegments?l.numSegments:16;t=new this.BJSCANNON.Cylinder(u,c,h,d);var f=new this.BJSCANNON.Quaternion;f.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var m=new this.BJSCANNON.Vec3(0,0,0);t.transformAllPoints(m,f);break;case qi.a.BoxImpostor:var g=r.scale(.5);t=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(g.x),this._checkWithEpsilon(g.y),this._checkWithEpsilon(g.z)));break;case qi.a.PlaneImpostor:p.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),t=new this.BJSCANNON.Plane;break;case qi.a.MeshImpostor:var _=n.getVerticesData?n.getVerticesData(Sn.b.PositionKind):[],v=n.getIndices?n.getIndices():[];if(!_)return;var y=n.position.clone(),b=n.rotation&&n.rotation.clone(),E=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(e.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace();var x,T=n.computeWorldMatrix(!0),S=new Array;for(x=0;x<_.length;x+=3)o.x.TransformCoordinates(o.x.FromArray(_,x),T).toArray(S,x);p.a.Warn("MeshImpostor only collides against spheres."),t=new this.BJSCANNON.Trimesh(S,v),n.position.copyFrom(y),b&&n.rotation&&n.rotation.copyFrom(b),E&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(E);break;case qi.a.HeightmapImpostor:var A=n.position.clone(),P=n.rotation&&n.rotation.clone(),M=n.rotationQuaternion&&n.rotationQuaternion.clone();n.position.copyFromFloats(0,0,0),n.rotation&&n.rotation.copyFromFloats(0,0,0),n.rotationQuaternion&&n.rotationQuaternion.copyFrom(e.getParentsRotation()),n.rotationQuaternion&&n.parent&&n.rotationQuaternion.conjugateInPlace(),n.rotationQuaternion&&n.rotationQuaternion.multiplyInPlace(this._minus90X),t=this._createHeightmap(n),n.position.copyFrom(A),P&&n.rotation&&n.rotation.copyFrom(P),M&&n.rotationQuaternion&&n.rotationQuaternion.copyFrom(M),n.computeWorldMatrix(!0);break;case qi.a.ParticleImpostor:t=new this.BJSCANNON.Particle;break;case qi.a.NoImpostor:t=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return t},e.prototype._createHeightmap=function(e,t){var n,r=e.getVerticesData(Sn.b.PositionKind),i=e.computeWorldMatrix(!0),a=new Array;for(n=0;n<r.length;n+=3)o.x.TransformCoordinates(o.x.FromArray(r,n),i).toArray(a,n);r=a;for(var s=new Array,l=t||~~(Math.sqrt(r.length/3)-1),u=e.getBoundingInfo(),c=Math.min(u.boundingBox.extendSizeWorld.x,u.boundingBox.extendSizeWorld.y),h=u.boundingBox.extendSizeWorld.z,d=2*c/l,f=0;f<r.length;f+=3){var p=Math.round(r[f+0]/d+l/2),m=Math.round(-1*(r[f+1]/d-l/2)),g=-r[f+2]+h;s[p]||(s[p]=[]),s[p][m]||(s[p][m]=g),s[p][m]=Math.max(g,s[p][m])}for(p=0;p<=l;++p){if(!s[p]){for(var _=1;!s[(p+_)%l];)_++;s[p]=s[(p+_)%l].slice()}for(m=0;m<=l;++m)if(!s[p][m]){var v;for(_=1;void 0===v;)v=s[p][(m+_++)%l];s[p][m]=v}}var y=new this.BJSCANNON.Heightfield(s,{elementSize:d});return y.minY=h,y},e.prototype._updatePhysicsBodyTransformation=function(e){var t=e.object;if(t.computeWorldMatrix&&t.computeWorldMatrix(!0),t.getBoundingInfo()){var n=e.getObjectCenter();this._tmpDeltaPosition.copyFrom(t.getAbsolutePivotPoint().subtract(n)),this._tmpDeltaPosition.divideInPlace(e.object.scaling),this._tmpPosition.copyFrom(n);var r=t.rotationQuaternion;if(r){if(e.type!==qi.a.PlaneImpostor&&e.type!==qi.a.HeightmapImpostor||(r=r.multiply(this._minus90X),e.setDeltaRotation(this._plus90X)),e.type===qi.a.HeightmapImpostor){var i=t,a=i.getBoundingInfo(),s=i.rotationQuaternion;i.rotationQuaternion=this._tmpUnityRotation,i.computeWorldMatrix(!0);var l=n.clone(),u=i.getPivotMatrix();u=u?u.clone():o.j.Identity();var c=o.j.Translation(a.boundingBox.extendSizeWorld.x,0,-a.boundingBox.extendSizeWorld.z);i.setPreTransformMatrix(c),i.computeWorldMatrix(!0);var h=a.boundingBox.centerWorld.subtract(n).subtract(i.position).negate();this._tmpPosition.copyFromFloats(h.x,h.y-a.boundingBox.extendSizeWorld.y,h.z),this._tmpDeltaPosition.copyFrom(a.boundingBox.centerWorld.subtract(l)),this._tmpDeltaPosition.y+=a.boundingBox.extendSizeWorld.y,i.rotationQuaternion=s,i.setPreTransformMatrix(u),i.computeWorldMatrix(!0)}else e.type===qi.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpDeltaPosition),e.physicsBody.position.copy(this._tmpPosition),e.physicsBody.quaternion.copy(r)}}},e.prototype.setTransformationFromPhysicsBody=function(e){e.object.position.copyFrom(e.physicsBody.position),e.object.rotationQuaternion&&e.object.rotationQuaternion.copyFrom(e.physicsBody.quaternion)},e.prototype.setPhysicsBodyTransformation=function(e,t,n){e.physicsBody.position.copy(t),e.physicsBody.quaternion.copy(n)},e.prototype.isSupported=function(){return void 0!==this.BJSCANNON},e.prototype.setLinearVelocity=function(e,t){e.physicsBody.velocity.copy(t)},e.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},e.prototype.getLinearVelocity=function(e){var t=e.physicsBody.velocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.getAngularVelocity=function(e){var t=e.physicsBody.angularVelocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.setBodyMass=function(e,t){e.physicsBody.mass=t,e.physicsBody.updateMassProperties()},e.prototype.getBodyMass=function(e){return e.physicsBody.mass},e.prototype.getBodyFriction=function(e){return e.physicsBody.material.friction},e.prototype.setBodyFriction=function(e,t){e.physicsBody.material.friction=t},e.prototype.getBodyRestitution=function(e){return e.physicsBody.material.restitution},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.material.restitution=t},e.prototype.sleepBody=function(e){e.physicsBody.sleep()},e.prototype.wakeUpBody=function(e){e.physicsBody.wakeUp()},e.prototype.updateDistanceJoint=function(e,t){e.physicsJoint.distance=t},e.prototype.setMotor=function(e,t,n,r){r||(e.physicsJoint.enableMotor(),e.physicsJoint.setMotorSpeed(t),n&&this.setLimit(e,n))},e.prototype.setLimit=function(e,t,n){e.physicsJoint.motorEquation.maxForce=t,e.physicsJoint.motorEquation.minForce=void 0===n?-t:n},e.prototype.syncMeshWithImpostor=function(e,t){var n=t.physicsBody;e.position.x=n.position.x,e.position.y=n.position.y,e.position.z=n.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=n.quaternion.x,e.rotationQuaternion.y=n.quaternion.y,e.rotationQuaternion.z=n.quaternion.z,e.rotationQuaternion.w=n.quaternion.w)},e.prototype.getRadius=function(e){return e.physicsBody.shapes[0].boundingSphereRadius},e.prototype.getBoxSizeToRef=function(e,t){var n=e.physicsBody.shapes[0];t.x=2*n.halfExtents.x,t.y=2*n.halfExtents.y,t.z=2*n.halfExtents.z},e.prototype.dispose=function(){},e.prototype._extendNamespace=function(){var e=new this.BJSCANNON.Vec3,t=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(n,r,i){if(i=i||10,0===(r=r||0))this.internalStep(n),this.time+=n;else{var o=Math.floor((this.time+r)/n)-Math.floor(this.time/n);o=Math.min(o,i)||1;for(var a=performance.now(),s=0;s!==o&&(this.internalStep(n),!(performance.now()-a>1e3*n));s++);this.time+=r;for(var l=this.time%n/n,u=e,c=this.bodies,h=0;h!==c.length;h++){var d=c[h];d.type!==t.Body.STATIC&&d.sleepState!==t.Body.SLEEPING?(d.position.vsub(d.previousPosition,u),u.scale(l,u),d.position.vadd(u,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}}}},e.prototype.raycast=function(e,t){return this._cannonRaycastResult.reset(),this.world.raycastClosest(e,t,{},this._cannonRaycastResult),this._raycastResult.reset(e,t),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},e}();Zi.DefaultPluginFactory=function(){return new $i};var eo=function(){function e(e,t){void 0===t&&(t=OIMO),this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=o.x.Zero(),this.BJSOIMO=t,this.world=new this.BJSOIMO.World({iterations:e}),this.world.clear(),this._raycastResult=new Ji}return e.prototype.setGravity=function(e){this.world.gravity.copy(e)},e.prototype.setTimeStep=function(e){this.world.timeStep=e},e.prototype.getTimeStep=function(){return this.world.timeStep},e.prototype.executeStep=function(e,t){var n=this;t.forEach(function(e){e.beforeStep()}),this.world.step(),t.forEach(function(e){e.afterStep(),n._tmpImpostorsArray[e.uniqueId]=e});for(var r=this.world.contacts;null!==r;)if(!r.touching||r.body1.sleeping||r.body2.sleeping){var i=this._tmpImpostorsArray[+r.body1.name],o=this._tmpImpostorsArray[+r.body2.name];i&&o?(i.onCollide({body:o.physicsBody}),o.onCollide({body:i.physicsBody}),r=r.next):r=r.next}else r=r.next},e.prototype.applyImpulse=function(e,t,n){var r=e.physicsBody.mass;e.physicsBody.applyImpulse(n.scale(this.world.invScale),t.scale(this.world.invScale*r))},e.prototype.applyForce=function(e,t,n){p.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(e,t,n)},e.prototype.generatePhysicsBody=function(e){var t=this;if(e.parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else{if(e.isBodyInitRequired()){var n={name:e.uniqueId,config:[e.getParam("mass")||1,e.getParam("friction"),e.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==e.getParam("mass"),density:e.getParam("mass"),friction:e.getParam("friction"),restitution:e.getParam("restitution"),world:this.world},r=[e];(s=e.object).getChildMeshes&&s.getChildMeshes().forEach(function(e){e.physicsImpostor&&r.push(e.physicsImpostor)});var i=function(e){return Math.max(e,Zi.Epsilon)},a=new o.q;r.forEach(function(r){if(r.object.rotationQuaternion){var o=r.object.rotationQuaternion;a=o.clone();var s=o.toEulerAngles(),l=r.getObjectExtendSize();if(r===e){var u=e.getObjectCenter();e.object.getAbsolutePivotPoint().subtractToRef(u,t._tmpPositionVector),t._tmpPositionVector.divideInPlace(e.object.scaling),n.pos.push(u.x),n.pos.push(u.y),n.pos.push(u.z),n.posShape.push(0,0,0),n.rotShape.push(0,0,0)}else{var c=r.object.getAbsolutePosition().subtract(e.object.getAbsolutePosition());n.posShape.push(c.x),n.posShape.push(c.y),n.posShape.push(c.z),n.pos.push(0,0,0),n.rotShape.push(57.29577951308232*s.x),n.rotShape.push(57.29577951308232*s.y),n.rotShape.push(57.29577951308232*s.z)}switch(r.type){case qi.a.ParticleImpostor:p.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case qi.a.SphereImpostor:var h=l.x,d=l.y,f=l.z,m=Math.max(i(h),i(d),i(f))/2;n.type.push("sphere"),n.size.push(m),n.size.push(m),n.size.push(m);break;case qi.a.CylinderImpostor:var g=i(l.x)/2,_=i(l.y);n.type.push("cylinder"),n.size.push(g),n.size.push(_),n.size.push(_);break;case qi.a.PlaneImpostor:case qi.a.BoxImpostor:default:g=i(l.x),_=i(l.y);var v=i(l.z);n.type.push("box"),n.size.push(g),n.size.push(_),n.size.push(v)}r.object.rotationQuaternion=o}}),e.physicsBody=this.world.add(n),e.physicsBody.resetQuaternion(a),e.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);var s;e.setDeltaPosition(this._tmpPositionVector)}},e.prototype.removePhysicsBody=function(e){this.world.removeRigidBody(e.physicsBody)},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,n=e.connectedImpostor.physicsBody;if(t&&n){var r,i=e.joint.jointData,o=i.nativeParams||{},a={body1:t,body2:n,axe1:o.axe1||(i.mainAxis?i.mainAxis.asArray():null),axe2:o.axe2||(i.connectedAxis?i.connectedAxis.asArray():null),pos1:o.pos1||(i.mainPivot?i.mainPivot.asArray():null),pos2:o.pos2||(i.connectedPivot?i.connectedPivot.asArray():null),min:o.min,max:o.max,collision:o.collision||i.collision,spring:o.spring,world:this.world};switch(e.joint.type){case Qi.e.BallAndSocketJoint:r="jointBall";break;case Qi.e.SpringJoint:p.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var s=i;a.min=s.length||a.min,a.max=Math.max(a.min,a.max);case Qi.e.DistanceJoint:r="jointDistance",a.max=i.maxDistance;break;case Qi.e.PrismaticJoint:r="jointPrisme";break;case Qi.e.SliderJoint:r="jointSlide";break;case Qi.e.WheelJoint:r="jointWheel";break;case Qi.e.HingeJoint:default:r="jointHinge"}a.type=r,e.joint.physicsJoint=this.world.add(a)}},e.prototype.removeJoint=function(e){try{this.world.removeJoint(e.joint.physicsJoint)}catch(e){p.a.Warn(e)}},e.prototype.isSupported=function(){return void 0!==this.BJSOIMO},e.prototype.setTransformationFromPhysicsBody=function(e){e.physicsBody.sleeping||(e.object.position.copyFrom(e.physicsBody.getPosition()),e.object.rotationQuaternion&&e.object.rotationQuaternion.copyFrom(e.physicsBody.getQuaternion()))},e.prototype.setPhysicsBodyTransformation=function(e,t,n){var r=e.physicsBody;r.position.copy(t),r.orientation.copy(n),r.syncShapes(),r.awake()},e.prototype.setLinearVelocity=function(e,t){e.physicsBody.linearVelocity.copy(t)},e.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},e.prototype.getLinearVelocity=function(e){var t=e.physicsBody.linearVelocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.getAngularVelocity=function(e){var t=e.physicsBody.angularVelocity;return t?new o.x(t.x,t.y,t.z):null},e.prototype.setBodyMass=function(e,t){var n=0===t;e.physicsBody.shapes.density=n?1:t,e.physicsBody.setupMass(n?2:1)},e.prototype.getBodyMass=function(e){return e.physicsBody.shapes.density},e.prototype.getBodyFriction=function(e){return e.physicsBody.shapes.friction},e.prototype.setBodyFriction=function(e,t){e.physicsBody.shapes.friction=t},e.prototype.getBodyRestitution=function(e){return e.physicsBody.shapes.restitution},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.shapes.restitution=t},e.prototype.sleepBody=function(e){e.physicsBody.sleep()},e.prototype.wakeUpBody=function(e){e.physicsBody.awake()},e.prototype.updateDistanceJoint=function(e,t,n){e.physicsJoint.limitMotor.upperLimit=t,void 0!==n&&(e.physicsJoint.limitMotor.lowerLimit=n)},e.prototype.setMotor=function(e,t,n,r){void 0!==n?p.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):n=1e6,t*=-1;var i=r?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;i&&i.setMotor(t,n)},e.prototype.setLimit=function(e,t,n,r){var i=r?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;i&&i.setLimit(t,void 0===n?-t:n)},e.prototype.syncMeshWithImpostor=function(e,t){var n=t.physicsBody;e.position.x=n.position.x,e.position.y=n.position.y,e.position.z=n.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=n.orientation.x,e.rotationQuaternion.y=n.orientation.y,e.rotationQuaternion.z=n.orientation.z,e.rotationQuaternion.w=n.orientation.s)},e.prototype.getRadius=function(e){return e.physicsBody.shapes.radius},e.prototype.getBoxSizeToRef=function(e,t){var n=e.physicsBody.shapes;t.x=2*n.halfWidth,t.y=2*n.halfHeight,t.z=2*n.halfDepth},e.prototype.dispose=function(){this.world.clear()},e.prototype.raycast=function(e,t){return p.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(e,t),this._raycastResult},e}();Tn.a.CreateRibbon=function(e){var t=e.pathArray,n=e.closeArray||!1,r=e.closePath||!1,i=e.invertUV||!1,o=Math.floor(t[0].length/2),a=e.offset||o;a=a>o?o:Math.floor(a);var s,l,u,c,h=0===e.sideOrientation?0:e.sideOrientation||Tn.a.DEFAULTSIDE,d=e.uvs,f=e.colors,p=[],m=[],g=[],_=[],v=[],y=[],b=[],E=[],x=[],T=[];if(t.length<2){var S=[],A=[];for(u=0;u<t[0].length-a;u++)S.push(t[0][u]),A.push(t[0][u+a]);t=[S,A]}var P,M,R,C,w,O=0,I=r?1:0;for(s=t[0].length,l=0;l<t.length;l++){for(b[l]=0,v[l]=[0],s=s<(M=(P=t[l]).length)?s:M,c=0;c<M;)p.push(P[c].x,P[c].y,P[c].z),c>0&&(R=P[c].subtract(P[c-1]).length()+b[l],v[l].push(R),b[l]=R),c++;r&&(c--,p.push(P[0].x,P[0].y,P[0].z),R=P[c].subtract(P[0]).length()+b[l],v[l].push(R),b[l]=R),x[l]=M+I,T[l]=O,O+=M+I}var D,L,F=null,N=null;for(u=0;u<s+I;u++){for(E[u]=0,y[u]=[0],l=0;l<t.length-1;l++)C=t[l],w=t[l+1],u===s?(F=C[0],N=w[0]):(F=C[u],N=w[u]),R=N.subtract(F).length()+E[u],y[u].push(R),E[u]=R;n&&N&&F&&(C=t[l],w=t[0],u===s&&(N=w[0]),R=N.subtract(F).length()+E[u],E[u]=R)}if(d)for(l=0;l<d.length;l++)_.push(d[l].x,d[l].y);else for(l=0;l<t.length;l++)for(u=0;u<s+I;u++)D=0!=b[l]?v[l][u]/b[l]:0,L=0!=E[u]?y[u][l]/E[u]:0,i?_.push(L,D):_.push(D,L);for(var B=0,U=x[l=0]-1,k=x[l+1]-1,V=U<k?U:k,G=T[1]-T[0],z=n?x.length:x.length-1;B<=V&&l<z;)m.push(B,B+G,B+1),m.push(B+G+1,B+1,B+G),(B+=1)===V&&(++l===x.length-1?(G=T[0]-T[l],U=x[l]-1,k=x[0]-1):(G=T[l+1]-T[l],U=x[l]-1,k=x[l+1]-1),B=T[l],V=U<k?U+B:k+B);if(Tn.a.ComputeNormals(p,m,g),r){var j=0,H=0;for(l=0;l<t.length;l++)j=3*T[l],H=l+1<t.length?3*(T[l+1]-1):g.length-3,g[j]=.5*(g[j]+g[H]),g[j+1]=.5*(g[j+1]+g[H+1]),g[j+2]=.5*(g[j+2]+g[H+2]),g[H]=g[j],g[H+1]=g[j+1],g[H+2]=g[j+2]}Tn.a._ComputeSides(h,p,m,g,_,e.frontUVs,e.backUVs);var W=null;if(f){W=new Float32Array(4*f.length);for(var X=0;X<f.length;X++)W[4*X]=f[X].r,W[4*X+1]=f[X].g,W[4*X+2]=f[X].b,W[4*X+3]=f[X].a}var Y=new Tn.a,K=new Float32Array(p),q=new Float32Array(g),Q=new Float32Array(_);return Y.indices=m,Y.positions=K,Y.normals=q,Y.uvs=Q,W&&Y.set(W,Sn.b.ColorKind),r&&(Y._idx=T),Y},fe.a.CreateRibbon=function(e,t,n,r,i,o,a,s,l){return void 0===n&&(n=!1),void 0===a&&(a=!1),to.CreateRibbon(e,{pathArray:t,closeArray:n,closePath:r,offset:i,updatable:a,sideOrientation:s,instance:l},o)};var to=function(){function e(){}return e.CreateRibbon=function(e,t,n){void 0===n&&(n=null);var r=t.pathArray,i=t.closeArray,a=t.closePath,s=fe.a._GetDefaultSideOrientation(t.sideOrientation),l=t.instance,u=t.updatable;if(l){var c=o.t.Vector3[0].setAll(Number.MAX_VALUE),h=o.t.Vector3[1].setAll(-Number.MAX_VALUE),d=l.getVerticesData(Sn.b.PositionKind);if(function(e){for(var t=r[0].length,n=l,i=0,o=n._originalBuilderSideOrientation===fe.a.DOUBLESIDE?2:1,a=1;a<=o;++a)for(var s=0;s<r.length;++s){var u=r[s],d=u.length;t=t<d?t:d;for(var f=0;f<t;++f){var p=u[f];e[i]=p.x,e[i+1]=p.y,e[i+2]=p.z,c.minimizeInPlaceFromFloats(p.x,p.y,p.z),h.maximizeInPlaceFromFloats(p.x,p.y,p.z),i+=3}n._creationDataStorage&&n._creationDataStorage.closePath&&(p=u[0],e[i]=p.x,e[i+1]=p.y,e[i+2]=p.z,i+=3)}}(d),l._boundingInfo?l._boundingInfo.reConstruct(c,h,l._worldMatrix):l._boundingInfo=new Jn.a(c,h,l._worldMatrix),l.updateVerticesData(Sn.b.PositionKind,d,!1,!1),t.colors){for(var f=l.getVerticesData(Sn.b.ColorKind),p=0,m=0;p<t.colors.length;p++,m+=4){var g=t.colors[p];f[m]=g.r,f[m+1]=g.g,f[m+2]=g.b,f[m+3]=g.a}l.updateVerticesData(Sn.b.ColorKind,f,!1,!1)}if(t.uvs){for(var _=l.getVerticesData(Sn.b.UVKind),v=0;v<t.uvs.length;v++)_[2*v]=t.uvs[v].x,_[2*v+1]=t.uvs[v].y;l.updateVerticesData(Sn.b.UVKind,_,!1,!1)}if(!l.areNormalsFrozen||l.isFacetDataEnabled){var y=l.getIndices(),b=l.getVerticesData(Sn.b.NormalKind),E=l.isFacetDataEnabled?l.getFacetDataParameters():null;if(Tn.a.ComputeNormals(d,y,b,E),l._creationDataStorage&&l._creationDataStorage.closePath)for(var x=0,T=0,S=0;S<r.length;S++)x=3*l._creationDataStorage.idx[S],T=S+1<r.length?3*(l._creationDataStorage.idx[S+1]-1):b.length-3,b[x]=.5*(b[x]+b[T]),b[x+1]=.5*(b[x+1]+b[T+1]),b[x+2]=.5*(b[x+2]+b[T+2]),b[T]=b[x],b[T+1]=b[x+1],b[T+2]=b[x+2];l.areNormalsFrozen||l.updateVerticesData(Sn.b.NormalKind,b,!1,!1)}return l}var A=new fe.a(e,n);A._originalBuilderSideOrientation=s,A._creationDataStorage=new fe.b;var P=Tn.a.CreateRibbon(t);return a&&(A._creationDataStorage.idx=P._idx),A._creationDataStorage.closePath=a,A._creationDataStorage.closeArray=i,P.applyToMesh(A,u),A},e}();fe.a.ExtrudeShape=function(e,t,n,r,i,o,a,s,l,u){void 0===a&&(a=null);var c={shape:t,path:n,scale:r,rotation:i,cap:0===o?0:o||fe.a.NO_CAP,sideOrientation:l,instance:u,updatable:s};return no.ExtrudeShape(e,c,a)},fe.a.ExtrudeShapeCustom=function(e,t,n,r,i,o,a,s,l,u,c,h){var d={shape:t,path:n,scaleFunction:r,rotationFunction:i,ribbonCloseArray:o,ribbonClosePath:a,cap:0===s?0:s||fe.a.NO_CAP,sideOrientation:c,instance:h,updatable:u};return no.ExtrudeShapeCustom(e,d,l)};var no=function(){function e(){}return e.ExtrudeShape=function(t,n,r){void 0===r&&(r=null);var i=n.path,o=n.shape,a=n.scale||1,s=n.rotation||0,l=0===n.cap?0:n.cap||fe.a.NO_CAP,u=n.updatable,c=fe.a._GetDefaultSideOrientation(n.sideOrientation),h=n.instance||null,d=n.invertUV||!1;return e._ExtrudeShapeGeneric(t,o,i,a,s,null,null,!1,!1,l,!1,r,!!u,c,h,d,n.frontUVs||null,n.backUVs||null)},e.ExtrudeShapeCustom=function(t,n,r){void 0===r&&(r=null);var i=n.path,o=n.shape,a=n.scaleFunction||function(){return 1},s=n.rotationFunction||function(){return 0},l=n.ribbonCloseArray||!1,u=n.ribbonClosePath||!1,c=0===n.cap?0:n.cap||fe.a.NO_CAP,h=n.updatable,d=fe.a._GetDefaultSideOrientation(n.sideOrientation),f=n.instance,p=n.invertUV||!1;return e._ExtrudeShapeGeneric(t,o,i,null,null,a,s,l,u,c,!0,r,!!h,d,f||null,p,n.frontUVs||null,n.backUVs||null)},e._ExtrudeShapeGeneric=function(e,t,n,r,i,a,s,l,u,c,h,d,f,p,m,g,_,v){var y,b,E=function(e,t,n,r,i,a,s,l,u,c){for(var h=n.getTangents(),d=n.getNormals(),f=n.getBinormals(),p=n.getDistances(),m=0,g=c&&l?l:function(){return null!==a?a:0},_=c&&s?s:function(){return null!==i?i:1},v=u===fe.a.NO_CAP||u===fe.a.CAP_END?0:2,y=o.t.Matrix[0],b=0;b<t.length;b++){for(var E=new Array,x=g(b,p[b]),T=_(b,p[b]),S=0;S<e.length;S++){o.j.RotationAxisToRef(h[b],m,y);var A=h[b].scale(e[S].z).add(d[b].scale(e[S].x)).add(f[b].scale(e[S].y)),P=E[S]?E[S]:o.x.Zero();o.x.TransformCoordinatesToRef(A,y,P),P.scaleInPlace(T).addInPlace(t[b]),E[S]=P}r[v]=E,m+=x,v++}var M=function(e){var t,n=Array(),r=o.x.Zero();for(t=0;t<e.length;t++)r.addInPlace(e[t]);for(r.scaleInPlace(1/e.length),t=0;t<e.length;t++)n.push(r);return n};switch(u){case fe.a.NO_CAP:break;case fe.a.CAP_START:r[0]=M(r[2]),r[1]=r[2];break;case fe.a.CAP_END:r[v]=r[v-1],r[v+1]=M(r[v-1]);break;case fe.a.CAP_ALL:r[0]=M(r[2]),r[1]=r[2],r[v]=r[v-1],r[v+1]=M(r[v-1])}return r};if(m){var x=m._creationDataStorage;return y=x.path3D.update(n),b=E(t,n,x.path3D,x.pathArray,r,i,a,s,x.cap,h),m=fe.a.CreateRibbon("",b,!1,!1,0,d||void 0,!1,0,m)}b=E(t,n,y=new o.m(n),new Array,r,i,a,s,c=c<0||c>3?0:c,h);var T=to.CreateRibbon(e,{pathArray:b,closeArray:l,closePath:u,updatable:f,sideOrientation:p,invertUV:g,frontUVs:_||void 0,backUVs:v||void 0},d);return T._creationDataStorage.pathArray=b,T._creationDataStorage.path3D=y,T._creationDataStorage.cap=c,T},e}(),ro=function(){function e(e,t){var n=this;void 0===e&&(e=!0),void 0===t&&(t=Ammo),this._useDeltaForWorldStep=e,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new o.q,this._tmpContactCallbackResult=!1,this._tmpVector=new o.x,this._tmpMatrix=new o.j,"function"==typeof t?t(this.bjsAMMO):this.bjsAMMO=t,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(){n._tmpContactCallbackResult=!0},this._raycastResult=new Ji,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):p.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return e.prototype.setGravity=function(e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},e.prototype.setTimeStep=function(e){this._timeStep=e},e.prototype.setFixedTimeStep=function(e){this._fixedTimeStep=e},e.prototype.setMaxSteps=function(e){this._maxSteps=e},e.prototype.getTimeStep=function(){return this._timeStep},e.prototype._isImpostorInContact=function(e){return this._tmpContactCallbackResult=!1,this.world.contactTest(e.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._isImpostorPairInContact=function(e,t){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(e.physicsBody,t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},e.prototype._stepSimulation=function(e,t,n){if(void 0===e&&(e=1/60),void 0===t&&(t=10),void 0===n&&(n=1/60),0==t)this.world.stepSimulation(e,0);else for(;t>0&&e>0;)e-n<n?(this.world.stepSimulation(e,0),e=0):(e-=n,this.world.stepSimulation(n,0)),t--},e.prototype.executeStep=function(e,t){for(var n=0,r=t;n<r.length;n++){var i=r[n];i.soft||i.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?e:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var o=0,a=t;o<a.length;o++){var s=a[o];if(s.soft?this._afterSoftStep(s):s.afterStep(),s._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(s))for(var l=0,u=s._onPhysicsCollideCallbacks;l<u.length;l++)for(var c=0,h=u[l].otherImpostors;c<h.length;c++){var d=h[c];(s.physicsBody.isActive()||d.physicsBody.isActive())&&this._isImpostorPairInContact(s,d)&&(s.onCollide({body:d.physicsBody}),d.onCollide({body:s.physicsBody}))}}},e.prototype._afterSoftStep=function(e){e.type===qi.a.RopeImpostor?this._ropeStep(e):this._softbodyOrClothStep(e)},e.prototype._ropeStep=function(e){for(var t,n,r,i,a=e.physicsBody.get_m_nodes(),s=a.size(),l=new Array,u=0;u<s;u++)n=(t=a.at(u).get_m_x()).x(),r=t.y(),i=t.z(),l.push(new o.x(n,r,i));var c=e.object,h=e.getParam("shape");e._isFromLine?e.object=Mr.a.CreateLines("lines",{points:l,instance:c}):e.object=no.ExtrudeShape("ext",{shape:h,path:l,instance:c})},e.prototype._softbodyOrClothStep=function(e){var t=e.type===qi.a.ClothImpostor?1:-1,n=e.object,r=n.getVerticesData(Sn.b.PositionKind);r||(r=[]);var i=n.getVerticesData(Sn.b.NormalKind);i||(i=[]);for(var o,a,s,l,u,c,h,d,f=r.length/3,p=e.physicsBody.get_m_nodes(),m=0;m<f;m++){var g;s=(a=(o=p.at(m)).get_m_x()).x(),l=a.y(),u=a.z()*t,c=(g=o.get_m_n()).x(),h=g.y(),d=g.z()*t,r[3*m]=s,r[3*m+1]=l,r[3*m+2]=u,i[3*m]=c,i[3*m+1]=h,i[3*m+2]=d}var _=new Tn.a;_.positions=r,_.normals=i,_.uvs=n.getVerticesData(Sn.b.UVKind),_.colors=n.getVerticesData(Sn.b.ColorKind),n&&n.getIndices&&(_.indices=n.getIndices()),_.applyToMesh(n)},e.prototype.applyImpulse=function(e,t,n){if(e.soft)p.a.Warn("Cannot be applied to a soft body");else{e.physicsBody.activate();var r=this._tmpAmmoVectorA,i=this._tmpAmmoVectorB;e.object&&e.object.getWorldMatrix&&(e.object.getWorldMatrix().invertToRef(this._tmpMatrix),o.x.TransformCoordinatesToRef(n,this._tmpMatrix,this._tmpVector),n=this._tmpVector),r.setValue(n.x,n.y,n.z),i.setValue(t.x,t.y,t.z),e.physicsBody.applyImpulse(i,r)}},e.prototype.applyForce=function(e,t,n){if(e.soft)p.a.Warn("Cannot be applied to a soft body");else{e.physicsBody.activate();var r=this._tmpAmmoVectorA,i=this._tmpAmmoVectorB;e.object&&e.object.getWorldMatrix&&(e.object.getWorldMatrix().invertToRef(this._tmpMatrix),o.x.TransformCoordinatesToRef(n,this._tmpMatrix,this._tmpVector),n=this._tmpVector),r.setValue(n.x,n.y,n.z),i.setValue(t.x,t.y,t.z),e.physicsBody.applyForce(i,r)}},e.prototype.generatePhysicsBody=function(t){if(t._pluginData.toDispose=[],t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else if(t.isBodyInitRequired()){var n=this._createShape(t),r=t.getParam("mass");if(t._pluginData.mass=r,t.soft)n.get_m_cfg().set_collisions(17),n.get_m_cfg().set_kDP(t.getParam("damping")),Ammo.castObject(n,Ammo.btCollisionObject).getCollisionShape().setMargin(t.getParam("margin")),n.setActivationState(e.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(n,1,-1),t.physicsBody=n,t._pluginData.toDispose.push(n),this.setBodyPressure(t,0),t.type===qi.a.SoftbodyImpostor&&this.setBodyPressure(t,t.getParam("pressure")),this.setBodyStiffness(t,t.getParam("stiffness")),this.setBodyVelocityIterations(t,t.getParam("velocityIterations")),this.setBodyPositionIterations(t,t.getParam("positionIterations"));else{var i=new Ammo.btVector3(0,0,0),o=new Ammo.btTransform;o.setIdentity(),0!==r&&n.calculateLocalInertia(r,i),this._tmpAmmoVectorA.setValue(t.object.position.x,t.object.position.y,t.object.position.z),this._tmpAmmoQuaternion.setValue(t.object.rotationQuaternion.x,t.object.rotationQuaternion.y,t.object.rotationQuaternion.z,t.object.rotationQuaternion.w),o.setOrigin(this._tmpAmmoVectorA),o.setRotation(this._tmpAmmoQuaternion);var a=new Ammo.btDefaultMotionState(o),s=new Ammo.btRigidBodyConstructionInfo(r,a,n,i),l=new Ammo.btRigidBody(s);0===r&&(l.setCollisionFlags(l.getCollisionFlags()|e.KINEMATIC_FLAG),l.setActivationState(e.DISABLE_DEACTIVATION_FLAG)),t.type!=qi.a.NoImpostor||n.getChildShape||l.setCollisionFlags(l.getCollisionFlags()|e.DISABLE_COLLISION_FLAG),this.world.addRigidBody(l),t.physicsBody=l,t._pluginData.toDispose=t._pluginData.toDispose.concat([l,s,a,o,i,n])}this.setBodyRestitution(t,t.getParam("restitution")),this.setBodyFriction(t,t.getParam("friction"))}},e.prototype.removePhysicsBody=function(e){var t=this;this.world&&(this.world.removeRigidBody(e.physicsBody),e._pluginData&&e._pluginData.toDispose.forEach(function(e){t.bjsAMMO.destroy(e)}))},e.prototype.generateJoint=function(e){var t=e.mainImpostor.physicsBody,n=e.connectedImpostor.physicsBody;if(t&&n){var r,i=e.joint.jointData;switch(i.mainPivot||(i.mainPivot=new o.x(0,0,0)),i.connectedPivot||(i.connectedPivot=new o.x(0,0,0)),e.joint.type){case Qi.e.DistanceJoint:var a=i.maxDistance;a&&(i.mainPivot=new o.x(0,-a/2,0),i.connectedPivot=new o.x(0,a/2,0)),r=new Ammo.btPoint2PointConstraint(t,n,new Ammo.btVector3(i.mainPivot.x,i.mainPivot.y,i.mainPivot.z),new Ammo.btVector3(i.connectedPivot.x,i.connectedPivot.y,i.connectedPivot.z));break;case Qi.e.HingeJoint:i.mainAxis||(i.mainAxis=new o.x(0,0,0)),i.connectedAxis||(i.connectedAxis=new o.x(0,0,0));var s=new Ammo.btVector3(i.mainAxis.x,i.mainAxis.y,i.mainAxis.z),l=new Ammo.btVector3(i.connectedAxis.x,i.connectedAxis.y,i.connectedAxis.z);r=new Ammo.btHingeConstraint(t,n,new Ammo.btVector3(i.mainPivot.x,i.mainPivot.y,i.mainPivot.z),new Ammo.btVector3(i.connectedPivot.x,i.connectedPivot.y,i.connectedPivot.z),s,l);break;case Qi.e.BallAndSocketJoint:r=new Ammo.btPoint2PointConstraint(t,n,new Ammo.btVector3(i.mainPivot.x,i.mainPivot.y,i.mainPivot.z),new Ammo.btVector3(i.connectedPivot.x,i.connectedPivot.y,i.connectedPivot.z));break;default:p.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),r=new Ammo.btPoint2PointConstraint(t,n,new Ammo.btVector3(i.mainPivot.x,i.mainPivot.y,i.mainPivot.z),new Ammo.btVector3(i.connectedPivot.x,i.connectedPivot.y,i.connectedPivot.z))}this.world.addConstraint(r,!e.joint.jointData.collision),e.joint.physicsJoint=r}},e.prototype.removeJoint=function(e){this.world&&this.world.removeConstraint(e.joint.physicsJoint)},e.prototype._addMeshVerts=function(e,t,n){var r=this,i=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var a=n.getIndices();a||(a=[]);var s=n.getVerticesData(Sn.b.PositionKind);s||(s=[]),n.computeWorldMatrix(!1);for(var l=a.length/3,u=0;u<l;u++){for(var c=[],h=0;h<3;h++){var d,f=new o.x(s[3*a[3*u+h]+0],s[3*a[3*u+h]+1],s[3*a[3*u+h]+2]);o.j.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),f=o.x.TransformCoordinates(f,this._tmpMatrix),(d=0==h?this._tmpAmmoVectorA:1==h?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(f.x,f.y,f.z),c.push(d)}e.addTriangle(c[0],c[1],c[2]),i++}n.getChildMeshes().forEach(function(n){i+=r._addMeshVerts(e,t,n)})}return i},e.prototype._softVertexData=function(e){var t=e.object;if(t&&t.getIndices&&t.getWorldMatrix&&t.getChildMeshes){var n=t.getIndices();n||(n=[]);var r=t.getVerticesData(Sn.b.PositionKind);r||(r=[]);var i=t.getVerticesData(Sn.b.NormalKind);i||(i=[]),t.computeWorldMatrix(!1);for(var a=[],s=[],l=0;l<r.length;l+=3){var u=new o.x(r[l],r[l+1],r[l+2]),c=new o.x(i[l],i[l+1],i[l+2]);u=o.x.TransformCoordinates(u,t.getWorldMatrix()),c=o.x.TransformNormal(c,t.getWorldMatrix()),a.push(u.x,u.y,u.z),s.push(c.x,c.y,c.z)}var h=new Tn.a;return h.positions=a,h.normals=s,h.uvs=t.getVerticesData(Sn.b.UVKind),h.colors=t.getVerticesData(Sn.b.ColorKind),t&&t.getIndices&&(h.indices=t.getIndices()),h.applyToMesh(t),t.position=o.x.Zero(),t.rotationQuaternion=null,t.rotation=o.x.Zero(),t.computeWorldMatrix(!0),h}return Tn.a.ExtractFromMesh(t)},e.prototype._createSoftbody=function(e){var t=e.object;if(t&&t.getIndices){var n=t.getIndices();n||(n=[]);var r=this._softVertexData(e),i=r.positions,a=r.normals;if(null===i||null===a)return new Ammo.btCompoundShape;for(var s=[],l=[],u=0;u<i.length;u+=3){var c=new o.x(i[u],i[u+1],i[u+2]),h=new o.x(a[u],a[u+1],a[u+2]);s.push(c.x,c.y,-c.z),l.push(h.x,h.y,-h.z)}var d=(new Ammo.btSoftBodyHelpers).CreateFromTriMesh(this.world.getWorldInfo(),s,t.getIndices(),n.length/3,!0),f=i.length/3,p=d.get_m_nodes();for(u=0;u<f;u++){var m;(m=p.at(u).get_m_n()).setX(l[3*u]),m.setY(l[3*u+1]),m.setZ(l[3*u+2])}return d}},e.prototype._createCloth=function(e){var t=e.object;if(t&&t.getIndices){var n=t.getIndices();n||(n=[]);var r=this._softVertexData(e),i=r.positions,o=r.normals;if(null===i||null===o)return new Ammo.btCompoundShape;var a=i.length,s=Math.sqrt(a/3);e.segments=s;var l=s-1;return this._tmpAmmoVectorA.setValue(i[0],i[1],i[2]),this._tmpAmmoVectorB.setValue(i[3*l],i[3*l+1],i[3*l+2]),this._tmpAmmoVectorD.setValue(i[a-3],i[a-2],i[a-1]),this._tmpAmmoVectorC.setValue(i[a-3-3*l],i[a-2-3*l],i[a-1-3*l]),(new Ammo.btSoftBodyHelpers).CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,s,s,e.getParam("fixedPoints"),!0)}},e.prototype._createRope=function(e){var t,n,r=this._softVertexData(e),i=r.positions,o=r.normals;if(null===i||null===o)return new Ammo.btCompoundShape;if(r.applyToMesh(e.object,!0),e._isFromLine=!0,0===o.map(function(e){return e*e}).reduce(function(e,t){return e+t}))n=(t=i.length)/3-1,this._tmpAmmoVectorA.setValue(i[0],i[1],i[2]),this._tmpAmmoVectorB.setValue(i[t-3],i[t-2],i[t-1]);else{e._isFromLine=!1;var a=e.getParam("path");if(null===e.getParam("shape"))return p.a.Warn("No shape available for extruded mesh"),new Ammo.btCompoundShape;if(i.length%(3*a.length)!=0)return p.a.Warn("Path does not match extrusion"),new Ammo.btCompoundShape;n=(t=a.length)-1,this._tmpAmmoVectorA.setValue(a[0].x,a[0].y,a[0].z),this._tmpAmmoVectorB.setValue(a[t-1].x,a[t-1].y,a[t-1].z)}e.segments=n;var s=e.getParam("fixedPoints");s=s>3?3:s;var l=(new Ammo.btSoftBodyHelpers).CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,n-1,s);return l.get_m_cfg().set_collisions(17),l},e.prototype._addHullVerts=function(e,t,n){var r=this,i=0;if(n&&n.getIndices&&n.getWorldMatrix&&n.getChildMeshes){var a=n.getIndices();a||(a=[]);var s=n.getVerticesData(Sn.b.PositionKind);s||(s=[]),n.computeWorldMatrix(!1);for(var l=a.length/3,u=0;u<l;u++){for(var c=[],h=0;h<3;h++){var d,f=new o.x(s[3*a[3*u+h]+0],s[3*a[3*u+h]+1],s[3*a[3*u+h]+2]);o.j.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,this._tmpMatrix),f=o.x.TransformCoordinates(f,this._tmpMatrix),(d=0==h?this._tmpAmmoVectorA:1==h?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(f.x,f.y,f.z),c.push(d)}e.addPoint(c[0],!0),e.addPoint(c[1],!0),e.addPoint(c[2],!0),i++}n.getChildMeshes().forEach(function(n){i+=r._addHullVerts(e,t,n)})}return i},e.prototype._createShape=function(e,t){var n=this;void 0===t&&(t=!1);var r,i=e.object,a=e.getObjectExtendSize();if(!t){var s=e.object.getChildMeshes?e.object.getChildMeshes(!0):[];r=new Ammo.btCompoundShape;var l=0;if(s.forEach(function(e){var t=e.getPhysicsImpostor();if(t){if(t.type==qi.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var i=n._createShape(t),a=e.parent.getWorldMatrix().clone(),s=new o.x;a.decompose(s),n._tmpAmmoTransform.getOrigin().setValue(e.position.x*s.x,e.position.y*s.y,e.position.z*s.z),n._tmpAmmoQuaternion.setValue(e.rotationQuaternion.x,e.rotationQuaternion.y,e.rotationQuaternion.z,e.rotationQuaternion.w),n._tmpAmmoTransform.setRotation(n._tmpAmmoQuaternion),r.addChildShape(n._tmpAmmoTransform,i),t.dispose(),l++}}),l>0){if(e.type!=qi.a.NoImpostor){var u=this._createShape(e,!0);u&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),r.addChildShape(this._tmpAmmoTransform,u))}return r}Ammo.destroy(r),r=null}switch(e.type){case qi.a.SphereImpostor:r=new Ammo.btSphereShape(a.x/2);break;case qi.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(a.x/2,a.y/2,a.z/2),r=new Ammo.btCylinderShape(this._tmpAmmoVectorA);break;case qi.a.PlaneImpostor:case qi.a.BoxImpostor:this._tmpAmmoVectorA.setValue(a.x/2,a.y/2,a.z/2),r=new Ammo.btBoxShape(this._tmpAmmoVectorA);break;case qi.a.MeshImpostor:if(0==e.getParam("mass")){var c=new Ammo.btTriangleMesh;e._pluginData.toDispose.push(c);var h=this._addMeshVerts(c,i,i);r=0==h?new Ammo.btCompoundShape:new Ammo.btBvhTriangleMeshShape(c);break}case qi.a.ConvexHullImpostor:var d=new Ammo.btConvexHullShape;0==(h=this._addHullVerts(d,i,i))?(e._pluginData.toDispose.push(d),r=new Ammo.btCompoundShape):r=d;break;case qi.a.NoImpostor:r=new Ammo.btSphereShape(a.x/2);break;case qi.a.SoftbodyImpostor:r=this._createSoftbody(e);break;case qi.a.ClothImpostor:r=this._createCloth(e);break;case qi.a.RopeImpostor:r=this._createRope(e);break;default:p.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return r},e.prototype.setTransformationFromPhysicsBody=function(e){e.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),e.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),e.object.rotationQuaternion?e.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):e.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(e.object.rotation))},e.prototype.setPhysicsBodyTransformation=function(e,t,n){var r=e.physicsBody.getWorldTransform();if(r.getOrigin().x()!=t.x||r.getOrigin().y()!=t.y||r.getOrigin().z()!=t.z||r.getRotation().x()!=n.x||r.getRotation().y()!=n.y||r.getRotation().z()!=n.z||r.getRotation().w()!=n.w)if(this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),r.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(n.x,n.y,n.z,n.w),r.setRotation(this._tmpAmmoQuaternion),e.physicsBody.setWorldTransform(r),0==e.mass){var i=e.physicsBody.getMotionState();i&&i.setWorldTransform(r)}else e.physicsBody.activate()},e.prototype.isSupported=function(){return void 0!==this.bjsAMMO},e.prototype.setLinearVelocity=function(e,t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),e.soft?e.physicsBody.linearVelocity(this._tmpAmmoVectorA):e.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},e.prototype.setAngularVelocity=function(e,t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),e.soft?e.physicsBody.angularVelocity(this._tmpAmmoVectorA):e.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},e.prototype.getLinearVelocity=function(e){if(e.soft)var t=e.physicsBody.linearVelocity();else t=e.physicsBody.getLinearVelocity();if(!t)return null;var n=new o.x(t.x(),t.y(),t.z());return Ammo.destroy(t),n},e.prototype.getAngularVelocity=function(e){if(e.soft)var t=e.physicsBody.angularVelocity();else t=e.physicsBody.getAngularVelocity();if(!t)return null;var n=new o.x(t.x(),t.y(),t.z());return Ammo.destroy(t),n},e.prototype.setBodyMass=function(e,t){e.soft?e.physicsBody.setTotalMass(t,!1):e.physicsBody.setMassProps(t),e._pluginData.mass=t},e.prototype.getBodyMass=function(e){return e._pluginData.mass||0},e.prototype.getBodyFriction=function(e){return e._pluginData.friction||0},e.prototype.setBodyFriction=function(e,t){e.soft?e.physicsBody.get_m_cfg().set_kDF(t):e.physicsBody.setFriction(t),e._pluginData.friction=t},e.prototype.getBodyRestitution=function(e){return e._pluginData.restitution||0},e.prototype.setBodyRestitution=function(e,t){e.physicsBody.setRestitution(t),e._pluginData.restitution=t},e.prototype.getBodyPressure=function(e){return e.soft?e._pluginData.pressure||0:(p.a.Warn("Pressure is not a property of a rigid body"),0)},e.prototype.setBodyPressure=function(e,t){e.soft?e.type===qi.a.SoftbodyImpostor?(e.physicsBody.get_m_cfg().set_kPR(t),e._pluginData.pressure=t):(e.physicsBody.get_m_cfg().set_kPR(0),e._pluginData.pressure=0):p.a.Warn("Pressure can only be applied to a softbody")},e.prototype.getBodyStiffness=function(e){return e.soft?e._pluginData.stiffness||0:(p.a.Warn("Stiffness is not a property of a rigid body"),0)},e.prototype.setBodyStiffness=function(e,t){e.soft?(t=(t=t<0?0:t)>1?1:t,e.physicsBody.get_m_materials().at(0).set_m_kLST(t),e._pluginData.stiffness=t):p.a.Warn("Stiffness cannot be applied to a rigid body")},e.prototype.getBodyVelocityIterations=function(e){return e.soft?e._pluginData.velocityIterations||0:(p.a.Warn("Velocity iterations is not a property of a rigid body"),0)},e.prototype.setBodyVelocityIterations=function(e,t){e.soft?(t=t<0?0:t,e.physicsBody.get_m_cfg().set_viterations(t),e._pluginData.velocityIterations=t):p.a.Warn("Velocity iterations cannot be applied to a rigid body")},e.prototype.getBodyPositionIterations=function(e){return e.soft?e._pluginData.positionIterations||0:(p.a.Warn("Position iterations is not a property of a rigid body"),0)},e.prototype.setBodyPositionIterations=function(e,t){e.soft?(t=t<0?0:t,e.physicsBody.get_m_cfg().set_piterations(t),e._pluginData.positionIterations=t):p.a.Warn("Position iterations cannot be applied to a rigid body")},e.prototype.appendAnchor=function(e,t,n,r,i,o){void 0===i&&(i=1),void 0===o&&(o=!1);var a=e.segments,s=Math.round((a-1)*n)+a*(a-1-Math.round((a-1)*r));e.physicsBody.appendAnchor(s,t.physicsBody,o,i)},e.prototype.appendHook=function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var o=Math.round(e.segments*n);e.physicsBody.appendAnchor(o,t.physicsBody,i,r)},e.prototype.sleepBody=function(e){p.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},e.prototype.wakeUpBody=function(e){e.physicsBody.activate()},e.prototype.updateDistanceJoint=function(e,t,n){p.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},e.prototype.setMotor=function(e,t,n,r){e.physicsJoint.enableAngularMotor(!0,t,n)},e.prototype.setLimit=function(e,t,n){p.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},e.prototype.syncMeshWithImpostor=function(e,t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),e.position.x=this._tmpAmmoTransform.getOrigin().x(),e.position.y=this._tmpAmmoTransform.getOrigin().y(),e.position.z=this._tmpAmmoTransform.getOrigin().z(),e.rotationQuaternion&&(e.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),e.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),e.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),e.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},e.prototype.getRadius=function(e){return e.getObjectExtendSize().x/2},e.prototype.getBoxSizeToRef=function(e,t){var n=e.getObjectExtendSize();t.x=n.x,t.y=n.y,t.z=n.z},e.prototype.dispose=function(){Ammo.destroy(this.world),Ammo.destroy(this._solver),Ammo.destroy(this._overlappingPairCache),Ammo.destroy(this._dispatcher),Ammo.destroy(this._collisionConfiguration),Ammo.destroy(this._tmpAmmoVectorA),Ammo.destroy(this._tmpAmmoVectorB),Ammo.destroy(this._tmpAmmoVectorC),Ammo.destroy(this._tmpAmmoTransform),Ammo.destroy(this._tmpAmmoQuaternion),Ammo.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},e.prototype.raycast=function(e,t){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(e.x,e.y,e.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(t.x,t.y,t.z);var n=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,n),this._raycastResult.reset(e,t),n.hasHit()&&(this._raycastResult.setHitData({x:n.get_m_hitNormalWorld().x(),y:n.get_m_hitNormalWorld().y(),z:n.get_m_hitNormalWorld().z()},{x:n.get_m_hitPointWorld().x(),y:n.get_m_hitPointWorld().y(),z:n.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),Ammo.destroy(n),Ammo.destroy(this._tmpAmmoVectorRCA),Ammo.destroy(this._tmpAmmoVectorRCB),this._raycastResult},e.DISABLE_COLLISION_FLAG=4,e.KINEMATIC_FLAG=2,e.DISABLE_DEACTIVATION_FLAG=4,e}();r.a.prototype.removeReflectionProbe=function(e){if(!this.reflectionProbes)return-1;var t=this.reflectionProbes.indexOf(e);return-1!==t&&this.reflectionProbes.splice(t,1),t},r.a.prototype.addReflectionProbe=function(e){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(e)};var io=function(){function e(e,t,n,r,i){var a=this;void 0===r&&(r=!0),void 0===i&&(i=!1),this.name=e,this._viewMatrix=o.j.Identity(),this._target=o.x.Zero(),this._add=o.x.Zero(),this._invertYAxis=!1,this.position=o.x.Zero(),this._scene=n,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this),this._renderTargetTexture=new un(e,t,n,r,!0,i?m.a.TEXTURETYPE_FLOAT:m.a.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(e){switch(e){case 0:a._add.copyFromFloats(1,0,0);break;case 1:a._add.copyFromFloats(-1,0,0);break;case 2:a._add.copyFromFloats(0,a._invertYAxis?1:-1,0);break;case 3:a._add.copyFromFloats(0,a._invertYAxis?-1:1,0);break;case 4:a._add.copyFromFloats(0,0,1);break;case 5:a._add.copyFromFloats(0,0,-1)}a._attachedMesh&&a.position.copyFrom(a._attachedMesh.getAbsolutePosition()),a.position.addToRef(a._add,a._target),o.j.LookAtLHToRef(a.position,a._target,o.x.Up(),a._viewMatrix),n.activeCamera&&(a._projectionMatrix=o.j.PerspectiveFovLH(Math.PI/2,1,n.activeCamera.minZ,n.activeCamera.maxZ),n.setTransformMatrix(a._viewMatrix,a._projectionMatrix)),n._forcedViewPosition=a.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){n._forcedViewPosition=null,n.updateTransformMatrix(!0)})}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(e){this._renderTargetTexture.samples=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(e){this._renderTargetTexture.refreshRate=e},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),e.prototype.attachToMesh=function(e){this._attachedMesh=e},e.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderTargetTexture.setRenderingAutoClearDepthStencil(e,t)},e.prototype.dispose=function(){var e=this._scene.reflectionProbes.indexOf(this);-1!==e&&this._scene.reflectionProbes.splice(e,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},e.prototype.toString=function(e){var t="Name: "+this.name;return e&&(t+=", position: "+this.position.toString(),this._attachedMesh&&(t+=", attached mesh: "+this._attachedMesh.name)),t},e.prototype.getClassName=function(){return"ReflectionProbe"},e.prototype.serialize=function(){var e=D.a.Serialize(this,this._renderTargetTexture.serialize());return e.isReflectionProbe=!0,e},e.Parse=function(t,n,r){var i=null;if(n.reflectionProbes)for(var o=0;o<n.reflectionProbes.length;o++){var a=n.reflectionProbes[o];if(a.name===t.name){i=a;break}}return(i=D.a.Parse(function(){return i||new e(t.name,t.renderTargetSize,n,t._generateMipMaps)},t,n,r)).cubeTexture._waitingRenderList=t.renderList,t._attachedMesh&&i.attachToMesh(n.getMeshByID(t._attachedMesh)),i},u.c([Object(D.k)()],e.prototype,"_attachedMesh",void 0),u.c([Object(D.o)()],e.prototype,"position",void 0),e}(),oo=function(e,t,n,r){for(var i=0,o=t.materials.length;i<o;i++){var a=t.materials[i];if(a.id===e)return Mi.a.Parse(a,n,r)}return null},ao=function(e,t,n){for(var r in t)if(e.name===t[r])return n.push(e.id),!0;return!(!e.parentId||-1===n.indexOf(e.parentId))&&(n.push(e.id),!0)},so=function(e,t){return e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")},lo=function(e,t){var n=t;if(t._waitingData.lods){if(t._waitingData.lods.ids&&t._waitingData.lods.ids.length>0){var r=t._waitingData.lods.ids,i=n.isEnabled(!1);if(t._waitingData.lods.distances){var o=t._waitingData.lods.distances;if(o.length>=r.length){var a=o.length>r.length?o[o.length-1]:0;n.setEnabled(!1);for(var s=0;s<r.length;s++){var l=r[s],u=e.getMeshByID(l);null!=u&&n.addLODLevel(o[s],u)}a>0&&n.addLODLevel(a,null),!0===i&&n.setEnabled(!0)}else ye.h.Warn("Invalid level of detail distances for "+t.name)}}t._waitingData.lods=null}},uo=function(e,t,n,i,o){void 0===o&&(o=!1);var s=new me(e),l="importScene has failed JSON parse";try{var u=JSON.parse(t);l="";var c,h,d=fr.loggingLevel===fr.DETAILED_LOGGING;if(void 0!==u.environmentTexture&&null!==u.environmentTexture){var f=void 0===u.isPBR||u.isPBR;if(u.environmentTextureType&&"BABYLON.HDRCubeTexture"===u.environmentTextureType){var m=u.environmentTextureSize?u.environmentTextureSize:128,g=new Xi((u.environmentTexture.match(/https?:\/\//g)?"":n)+u.environmentTexture,e,m,!0,!f);u.environmentTextureRotationY&&(g.rotationY=u.environmentTextureRotationY),e.environmentTexture=g}else if(ye.h.EndsWith(u.environmentTexture,".env")){var _=new Hr((u.environmentTexture.match(/https?:\/\//g)?"":n)+u.environmentTexture,e);u.environmentTextureRotationY&&(_.rotationY=u.environmentTextureRotationY),e.environmentTexture=_}else{var v=Hr.CreateFromPrefilteredData((u.environmentTexture.match(/https?:\/\//g)?"":n)+u.environmentTexture,e);u.environmentTextureRotationY&&(v.rotationY=u.environmentTextureRotationY),e.environmentTexture=v}if(!0===u.createDefaultSkybox){var y=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,b=u.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,f,y,b)}s.environmentTexture=e.environmentTexture}if(void 0!==u.lights&&null!==u.lights)for(c=0,h=u.lights.length;c<h;c++){var E=u.lights[c],x=Fr.a.Parse(E,e);x&&(s.lights.push(x),l+=0===c?"\n\tLights:":"",l+="\n\t\t"+x.toString(d))}if(void 0!==u.reflectionProbes&&null!==u.reflectionProbes)for(c=0,h=u.reflectionProbes.length;c<h;c++){var T=u.reflectionProbes[c],S=io.Parse(T,e,n);S&&(s.reflectionProbes.push(S),l+=0===c?"\n\tReflection Probes:":"",l+="\n\t\t"+S.toString(d))}if(void 0!==u.animations&&null!==u.animations)for(c=0,h=u.animations.length;c<h;c++){var A=u.animations[c],P=a.a.GetClass("BABYLON.Animation");if(P){var M=P.Parse(A);e.animations.push(M),s.animations.push(M),l+=0===c?"\n\tAnimations:":"",l+="\n\t\t"+M.toString(d)}}if(void 0!==u.materials&&null!==u.materials)for(c=0,h=u.materials.length;c<h;c++){var C=u.materials[c],w=Mi.a.Parse(C,e,n);w&&(s.materials.push(w),l+=0===c?"\n\tMaterials:":"",l+="\n\t\t"+w.toString(d),w.getActiveTextures().forEach(function(e){-1==s.textures.indexOf(e)&&s.textures.push(e)}))}if(void 0!==u.multiMaterials&&null!==u.multiMaterials)for(c=0,h=u.multiMaterials.length;c<h;c++){var O=u.multiMaterials[c],I=ji.a.ParseMultiMaterial(O,e);s.multiMaterials.push(I),l+=0===c?"\n\tMultiMaterials:":"",l+="\n\t\t"+I.toString(d),I.getActiveTextures().forEach(function(e){-1==s.textures.indexOf(e)&&s.textures.push(e)})}if(void 0!==u.morphTargetManagers&&null!==u.morphTargetManagers)for(var D=0,L=u.morphTargetManagers;D<L.length;D++){var F=L[D];s.morphTargetManagers.push(Ki.Parse(F,e))}if(void 0!==u.skeletons&&null!==u.skeletons)for(c=0,h=u.skeletons.length;c<h;c++){var N=u.skeletons[c],B=He.Parse(N,e);s.skeletons.push(B),l+=0===c?"\n\tSkeletons:":"",l+="\n\t\t"+B.toString(d)}var U=u.geometries;if(null!=U){var k=new Array,V=U.vertexData;if(null!=V)for(c=0,h=V.length;c<h;c++){var G=V[c];k.push(zi.a.Parse(G,e,n))}k.forEach(function(e){e&&s.geometries.push(e)})}if(void 0!==u.transformNodes&&null!==u.transformNodes)for(c=0,h=u.transformNodes.length;c<h;c++){var z=u.transformNodes[c],j=$r.a.Parse(z,e,n);s.transformNodes.push(j)}if(void 0!==u.meshes&&null!==u.meshes)for(c=0,h=u.meshes.length;c<h;c++){var H=u.meshes[c],W=fe.a.Parse(H,e,n);s.meshes.push(W),l+=0===c?"\n\tMeshes:":"",l+="\n\t\t"+W.toString(d)}if(void 0!==u.cameras&&null!==u.cameras)for(c=0,h=u.cameras.length;c<h;c++){var X=u.cameras[c],Y=Ne.a.Parse(X,e);s.cameras.push(Y),l+=0===c?"\n\tCameras:":"",l+="\n\t\t"+Y.toString(d)}if(void 0!==u.animationGroups&&null!==u.animationGroups)for(c=0,h=u.animationGroups.length;c<h;c++){var K=u.animationGroups[c],q=Z.Parse(K,e);s.animationGroups.push(q),l+=0===c?"\n\tAnimationGroups:":"",l+="\n\t\t"+q.toString(d)}for(c=0,h=e.cameras.length;c<h;c++)(Y=e.cameras[c])._waitingParentId&&(Y.parent=e.getLastEntryByID(Y._waitingParentId),Y._waitingParentId=null);for(c=0,h=e.lights.length;c<h;c++){var Q=e.lights[c];Q&&Q._waitingParentId&&(Q.parent=e.getLastEntryByID(Q._waitingParentId),Q._waitingParentId=null)}for(c=0,h=e.transformNodes.length;c<h;c++){var J=e.transformNodes[c];J._waitingParentId&&(J.parent=e.getLastEntryByID(J._waitingParentId),J._waitingParentId=null)}for(c=0,h=e.meshes.length;c<h;c++)(W=e.meshes[c])._waitingParentId&&(W.parent=e.getLastEntryByID(W._waitingParentId),W._waitingParentId=null),W._waitingData.lods&&lo(e,W);for(c=0,h=e.skeletons.length;c<h;c++)(B=e.skeletons[c])._hasWaitingData&&(null!=B.bones&&B.bones.forEach(function(t){if(t._waitingTransformNodeId){var n=e.getLastEntryByID(t._waitingTransformNodeId);n&&t.linkTransformNode(n),t._waitingTransformNodeId=null}}),B._hasWaitingData=null);for(c=0,h=e.meshes.length;c<h;c++){var $=e.meshes[c];$._waitingData.freezeWorldMatrix?($.freezeWorldMatrix(),$._waitingData.freezeWorldMatrix=null):$.computeWorldMatrix(!0)}for(c=0,h=e.lights.length;c<h;c++){var ee=e.lights[c];if(ee._excludedMeshesIds.length>0){for(var te=0;te<ee._excludedMeshesIds.length;te++){var ne=e.getMeshByID(ee._excludedMeshesIds[te]);ne&&ee.excludedMeshes.push(ne)}ee._excludedMeshesIds=[]}if(ee._includedOnlyMeshesIds.length>0){for(var re=0;re<ee._includedOnlyMeshesIds.length;re++){var ie=e.getMeshByID(ee._includedOnlyMeshesIds[re]);ie&&ee.includedOnlyMeshes.push(ie)}ee._includedOnlyMeshesIds=[]}}for(r.a.Parse(u,e,s,n),c=0,h=e.meshes.length;c<h;c++)(W=e.meshes[c])._waitingData.actions&&(R.Parse(W._waitingData.actions,W,e),W._waitingData.actions=null);void 0!==u.actions&&null!==u.actions&&R.Parse(u.actions,null,e),o||s.removeAllFromScene()}catch(e){var oe=so("loadAssets",u?u.producer:"Unknown")+l;if(!i)throw p.a.Log(oe),e;i(oe,e)}finally{null!==l&&fr.loggingLevel!==fr.NO_LOGGING&&p.a.Log(so("loadAssets",u?u.producer:"Unknown")+(fr.loggingLevel!==fr.MINIMAL_LOGGING?l:""))}return s};fr.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(e){return-1!==e.indexOf("babylon")},importMesh:function(e,t,n,i,o,a,s,l){var u="importMesh has failed JSON parse";try{var c=JSON.parse(n);u="";var h=fr.loggingLevel===fr.DETAILED_LOGGING;e?Array.isArray(e)||(e=[e]):e=null;var d=new Array;if(void 0!==c.meshes&&null!==c.meshes){var f,m,g,_=[],v=[];for(f=0,m=c.meshes.length;f<m;f++){var y=c.meshes[f];if(null===e||ao(y,e,d)){if(null!==e&&delete e[e.indexOf(y.name)],void 0!==y.geometryId&&null!==y.geometryId&&void 0!==c.geometries&&null!==c.geometries){var b=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(e){!0!==b&&c.geometries[e]&&Array.isArray(c.geometries[e])&&c.geometries[e].forEach(function(n){if(n.id===y.geometryId){switch(e){case"vertexData":zi.a.Parse(n,t,i)}b=!0}})}),!1===b&&p.a.Warn("Geometry not found for mesh "+y.id)}if(y.materialId){var E=-1!==v.indexOf(y.materialId);if(!1===E&&void 0!==c.multiMaterials&&null!==c.multiMaterials)for(var x=0,T=c.multiMaterials.length;x<T;x++){var S=c.multiMaterials[x];if(S.id===y.materialId){for(var A=0,P=S.materials.length;A<P;A++){var M,R=S.materials[A];v.push(R),(M=oo(R,c,t,i))&&(u+="\n\tMaterial "+M.toString(h))}v.push(S.id);var C=ji.a.ParseMultiMaterial(S,t);C&&(E=!0,u+="\n\tMulti-Material "+C.toString(h));break}}!1===E&&(v.push(y.materialId),(M=oo(y.materialId,c,t,i))?u+="\n\tMaterial "+M.toString(h):p.a.Warn("Material not found for mesh "+y.id))}if(y.skeletonId>-1&&void 0!==c.skeletons&&null!==c.skeletons&&!1===_.indexOf(y.skeletonId)>-1)for(var w=0,O=c.skeletons.length;w<O;w++){var I=c.skeletons[w];if(I.id===y.skeletonId){var D=He.Parse(I,t);s.push(D),_.push(I.id),u+="\n\tSkeleton "+D.toString(h)}}if(void 0!==c.morphTargetManagers&&null!==c.morphTargetManagers)for(var L=0,F=c.morphTargetManagers;L<F.length;L++){var N=F[L];Ki.Parse(N,t)}var B=fe.a.Parse(y,t,i);o.push(B),u+="\n\tMesh "+B.toString(h)}}for(f=0,m=t.meshes.length;f<m;f++)(g=t.meshes[f])._waitingParentId&&(g.parent=t.getLastEntryByID(g._waitingParentId),g._waitingParentId=null),g._waitingData.lods&&lo(t,g);for(f=0,m=t.skeletons.length;f<m;f++)(D=t.skeletons[f])._hasWaitingData&&(null!=D.bones&&D.bones.forEach(function(e){if(e._waitingTransformNodeId){var n=t.getLastEntryByID(e._waitingTransformNodeId);n&&e.linkTransformNode(n),e._waitingTransformNodeId=null}}),D._hasWaitingData=null);for(f=0,m=t.meshes.length;f<m;f++)(g=t.meshes[f])._waitingData.freezeWorldMatrix?(g.freezeWorldMatrix(),g._waitingData.freezeWorldMatrix=null):g.computeWorldMatrix(!0)}if(void 0!==c.particleSystems&&null!==c.particleSystems){var U=r.a.GetIndividualParser(Te.a.NAME_PARTICLESYSTEM);if(U)for(f=0,m=c.particleSystems.length;f<m;f++){var k=c.particleSystems[f];-1!==d.indexOf(k.emitterId)&&a.push(U(k,t,i))}}return!0}catch(e){var V=so("importMesh",c?c.producer:"Unknown")+u;if(!l)throw p.a.Log(V),e;l(V,e)}finally{null!==u&&fr.loggingLevel!==fr.NO_LOGGING&&p.a.Log(so("importMesh",c?c.producer:"Unknown")+(fr.loggingLevel!==fr.MINIMAL_LOGGING?u:""))}return!1},load:function(e,t,n,r){var i="importScene has failed JSON parse";try{var a=JSON.parse(t);if(i="",void 0!==a.useDelayedTextureLoading&&null!==a.useDelayedTextureLoading&&(e.useDelayedTextureLoading=a.useDelayedTextureLoading&&!fr.ForceFullSceneLoadingForIncremental),void 0!==a.autoClear&&null!==a.autoClear&&(e.autoClear=a.autoClear),void 0!==a.clearColor&&null!==a.clearColor&&(e.clearColor=o.f.FromArray(a.clearColor)),void 0!==a.ambientColor&&null!==a.ambientColor&&(e.ambientColor=o.e.FromArray(a.ambientColor)),void 0!==a.gravity&&null!==a.gravity&&(e.gravity=o.x.FromArray(a.gravity)),a.fogMode&&0!==a.fogMode)switch(e.fogMode=a.fogMode,e.fogColor=o.e.FromArray(a.fogColor),e.fogStart=a.fogStart,e.fogEnd=a.fogEnd,e.fogDensity=a.fogDensity,i+="\tFog mode for scene:  ",e.fogMode){case 1:i+="exp\n";break;case 2:i+="exp2\n";break;case 3:i+="linear\n"}if(a.physicsEnabled){var s;"cannon"===a.physicsEngine?s=new $i:"oimo"===a.physicsEngine?s=new eo:"ammo"===a.physicsEngine&&(s=new ro),i="\tPhysics engine "+(a.physicsEngine?a.physicsEngine:"oimo")+" enabled\n";var l=a.physicsGravity?o.x.FromArray(a.physicsGravity):null;e.enablePhysics(l,s)}if(void 0!==a.metadata&&null!==a.metadata&&(e.metadata=a.metadata),void 0!==a.collisionsEnabled&&null!==a.collisionsEnabled&&(e.collisionsEnabled=a.collisionsEnabled),!uo(e,t,n,r,!0))return!1;if(a.autoAnimate&&e.beginAnimation(e,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),void 0!==a.activeCameraID&&null!==a.activeCameraID&&e.setActiveCameraByID(a.activeCameraID),void 0!==a.environmentTexture&&null!==a.environmentTexture){var u=void 0===a.isPBR||a.isPBR;if(a.environmentTextureType&&"BABYLON.HDRCubeTexture"===a.environmentTextureType){var c=a.environmentTextureSize?a.environmentTextureSize:128,h=new Xi(n+a.environmentTexture,e,c,!0,!u);a.environmentTextureRotationY&&(h.rotationY=a.environmentTextureRotationY),e.environmentTexture=h}else if(ye.h.EndsWith(a.environmentTexture,".env")){var d=new Hr(n+a.environmentTexture,e);a.environmentTextureRotationY&&(d.rotationY=a.environmentTextureRotationY),e.environmentTexture=d}else{var f=Hr.CreateFromPrefilteredData(n+a.environmentTexture,e);a.environmentTextureRotationY&&(f.rotationY=a.environmentTextureRotationY),e.environmentTexture=f}if(!0===a.createDefaultSkybox){var m=void 0!==e.activeCamera&&null!==e.activeCamera?(e.activeCamera.maxZ-e.activeCamera.minZ)/2:1e3,g=a.skyboxBlurLevel||0;e.createDefaultSkybox(e.environmentTexture,u,m,g)}}return!0}catch(e){var _=so("importScene",a?a.producer:"Unknown")+i;if(!r)throw p.a.Log(_),e;r(_,e)}finally{null!==i&&fr.loggingLevel!==fr.NO_LOGGING&&p.a.Log(so("importScene",a?a.producer:"Unknown")+(fr.loggingLevel!==fr.MINIMAL_LOGGING?i:""))}return!1},loadAssetContainer:function(e,t,n,r){return uo(e,t,n,r)}});var co=n(93),ho=function(){function e(){this._isEnabled=!0,this.leftColor=o.e.White(),this.rightColor=o.e.Black(),this.bias=0,this.power=1}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,ge.b.MarkAllMaterialsAsDirty(m.a.MATERIAL_FresnelDirtyFlag|m.a.MATERIAL_MiscDirtyFlag))},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e;return M.a.DeepCopy(this,t),t},e.prototype.serialize=function(){var e={};return e.isEnabled=this.isEnabled,e.leftColor=this.leftColor.asArray(),e.rightColor=this.rightColor.asArray(),e.bias=this.bias,e.power=this.power,e},e.Parse=function(t){var n=new e;return n.isEnabled=t.isEnabled,n.leftColor=o.e.FromArray(t.leftColor),n.rightColor=o.e.FromArray(t.rightColor),n.bias=t.bias,n.power=t.power||1,n},e}();D.a._FresnelParametersParser=ho.Parse;var fo=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.maxSimultaneousLights=4,r.disableLighting=!1,r.invertNormalMapX=!1,r.invertNormalMapY=!1,r.emissiveColor=new o.e(0,0,0),r.occlusionStrength=1,r.useLightmapAsShadowmap=!1,r._useAlphaFromAlbedoTexture=!0,r._useAmbientInGrayScale=!0,r}return u.d(t,e),Object.defineProperty(t.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],t.prototype,"environmentTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],t.prototype,"normalTexture",void 0),u.c([Object(D.e)("emissive"),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],t.prototype,"occlusionStrength",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],t.prototype,"occlusionTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],t.prototype,"alphaCutOff",void 0),u.c([Object(D.c)()],t.prototype,"doubleSided",null),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),t}(li),po=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._useRoughnessFromMetallicTextureAlpha=!1,r._useRoughnessFromMetallicTextureGreen=!0,r._useMetallnessFromMetallicTextureBlue=!0,r.metallic=1,r.roughness=1,r}return u.d(t,e),t.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},t.prototype.clone=function(e){var n=this,r=D.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),r},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.PBRMetallicRoughnessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e},t.Parse=function(e,n,r){var i=D.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&i.clearCoat.parse(e.clearCoat),e.anisotropy&&i.anisotropy.parse(e.anisotropy),e.brdf&&i.brdf.parse(e.brdf),e.sheen&&i.sheen.parse(e.brdf),i},u.c([Object(D.e)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),t}(fo);a.a.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"]=po;var mo=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._useMicroSurfaceFromReflectivityMapAlpha=!0,r}return u.d(t,e),t.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},t.prototype.clone=function(e){var n=this,r=D.a.Clone(function(){return new t(e,n.getScene())},this);return r.id=e,r.name=e,this.clearCoat.copyTo(r.clearCoat),this.anisotropy.copyTo(r.anisotropy),this.brdf.copyTo(r.brdf),this.sheen.copyTo(r.sheen),r},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="BABYLON.PBRSpecularGlossinessMaterial",e.clearCoat=this.clearCoat.serialize(),e.anisotropy=this.anisotropy.serialize(),e.brdf=this.brdf.serialize(),e.sheen=this.sheen.serialize(),e},t.Parse=function(e,n,r){var i=D.a.Parse(function(){return new t(e.name,n)},e,n,r);return e.clearCoat&&i.clearCoat.parse(e.clearCoat),e.anisotropy&&i.anisotropy.parse(e.anisotropy),e.brdf&&i.brdf.parse(e.brdf),e.sheen&&i.sheen.parse(e.brdf),i},u.c([Object(D.e)("diffuse"),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),u.c([Object(D.e)("specular"),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),u.c([Object(D.c)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),u.c([Object(D.m)(),Object(D.b)("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),t}(fo);a.a.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"]=mo;var go=n(76),_o=function(e){function t(t,n){var r=e.call(this,n)||this;return t?(r._engine=n.getEngine(),r._textureMatrix=o.j.Identity(),r.name=t,r.url=t,r.hasAlpha=!1,r.isCube=!1,r.is3D=r._engine.webGLVersion>1,r.wrapU=m.a.TEXTURE_CLAMP_ADDRESSMODE,r.wrapV=m.a.TEXTURE_CLAMP_ADDRESSMODE,r.wrapR=m.a.TEXTURE_CLAMP_ADDRESSMODE,r.anisotropicFilteringLevel=1,r._texture=r._getFromCache(t,!0),r._texture||(n.useDelayedTextureLoading?r.delayLoadState=m.a.DELAYLOADSTATE_NOTLOADED:r.loadTexture()),r):r}return u.d(t,e),t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.load3dlTexture=function(){var e,n=this._engine;e=1===n.webGLVersion?n.createRawTexture(null,1,1,m.a.TEXTUREFORMAT_RGBA,!1,!1,m.a.TEXTURE_BILINEAR_SAMPLINGMODE):n.createRawTexture3D(null,1,1,1,m.a.TEXTUREFORMAT_RGBA,!1,!1,m.a.TEXTURE_BILINEAR_SAMPLINGMODE),this._texture=e;var r=function(r){if("string"==typeof r){for(var i,o=null,a=null,s=r.split("\n"),l=0,u=0,c=0,h=0,d=0,f=0;f<s.length;f++)if(i=s[f],t._noneEmptyLineRegex.test(i)&&0!==i.indexOf("#")){var p=i.split(" ");if(0!==l){if(0!=l){var g=Math.max(parseInt(p[0]),0),_=Math.max(parseInt(p[1]),0),v=Math.max(parseInt(p[2]),0);d=Math.max(g,d),d=Math.max(_,d),d=Math.max(v,d);var y=4*(u+h*l+c*l*l);a&&(a[y+0]=g,a[y+1]=_,a[y+2]=v),++c%l==0&&(c=0,++h%l==0&&(u++,h=0))}}else l=p.length,o=new Uint8Array(l*l*l*4),a=new Float32Array(l*l*l*4)}if(a&&o)for(f=0;f<a.length;f++)if(f>0&&(f+1)%4==0)o[f]=255;else{var b=a[f];o[f]=b/d*255}e.is3D?(e.updateSize(l,l,l),n.updateRawTexture3D(e,o,m.a.TEXTUREFORMAT_RGBA,!1)):(e.updateSize(l*l,l),n.updateRawTexture(e,o,m.a.TEXTUREFORMAT_RGBA,!1))}},i=this.getScene();return i?i._loadFile(this.url,r):this._engine._loadFile(this.url,r),this._texture},t.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},t.prototype.clone=function(){var e=new t(this.url,this.getScene());return e.level=this.level,e},t.prototype.delayLoad=function(){this.delayLoadState===m.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=m.a.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},t.Parse=function(e,n){var r=null;return e.name&&!e.isRenderTarget&&((r=new t(e.name,n)).name=e.name,r.level=e.level),r},t.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},t._noneEmptyLineRegex=/\S+/,t}(Gr.a);a.a.RegisteredTypes["BABYLON.ColorGradingTexture"]=_o;var vo=function(e){function t(t,n,r,i,o,a,s){void 0===i&&(i=!1),void 0===o&&(o=!0),void 0===a&&(a=null),void 0===s&&(s=null);var l=e.call(this,n)||this;if(l._onLoad=null,l._onError=null,l.coordinatesMode=Ge.a.CUBIC_MODE,!t)throw new Error("Image url is not set");return l.name=t,l.url=t,l._size=r,l._noMipmap=i,l.gammaSpace=o,l._onLoad=a,l._onError=s,l.hasAlpha=!1,l.isCube=!0,l._texture=l._getFromCache(t,l._noMipmap),l._texture?a&&(l._texture.isReady?ye.h.SetImmediate(function(){return a()}):l._texture.onLoadedObservable.add(a)):n.useDelayedTextureLoading?l.delayLoadState=ge.b.DELAYLOADSTATE_NOTLOADED:l.loadImage(l.loadTexture.bind(l),l._onError),l}return u.d(t,e),t.prototype.loadImage=function(e,t){var n=this,r=document.createElement("canvas"),i=new Image;i.addEventListener("load",function(){n._width=i.width,n._height=i.height,r.width=n._width,r.height=n._height;var t=r.getContext("2d");t.drawImage(i,0,0);var o=t.getImageData(0,0,i.width,i.height);n._buffer=o.data.buffer,r.remove(),e()}),i.addEventListener("error",function(e){t&&t(n.getClassName()+" could not be loaded",e)}),i.src=this.url},t.prototype.loadTexture=function(){var e=this,n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,ge.b.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?ge.b.TEXTURETYPE_FLOAT:ge.b.TEXTURETYPE_UNSIGNED_INTEGER,this._noMipmap,function(){for(var n=e.getFloat32ArrayFromArrayBuffer(e._buffer),r=Hi.ConvertPanoramaToCubemap(n,e._width,e._height,e._size),i=[],o=0;o<6;o++){var a=r[t._FacesMapping[o]];i.push(a)}return i},null,this._onLoad,this._onError))},t.prototype.getFloat32ArrayFromArrayBuffer=function(e){for(var t=new DataView(e),n=new Float32Array(3*e.byteLength/4),r=0,i=0;i<e.byteLength;i++)(i+1)%4!=0&&(n[r++]=t.getUint8(i)/255);return n},t.prototype.getClassName=function(){return"EquiRectangularCubeTexture"},t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=new t(this.url,e,this._size,this._noMipmap,this.gammaSpace);return n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n.coordinatesIndex=this.coordinatesIndex,n.coordinatesMode=this.coordinatesMode,n},t._FacesMapping=["right","left","up","down","front","back"],t}(Gr.a),yo=function(){function e(){}return e.GetTGAHeader=function(e){var t=0;return{id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]}},e.UploadContent=function(t,n){if(n.length<19)p.a.Error("Unable to load TGA file - Not enough data to contain header");else{var r=18,i=e.GetTGAHeader(n);if(i.id_length+r>n.length)p.a.Error("Unable to load TGA file - Not enough data");else{r+=i.id_length;var o,a=!1,s=!1,l=!1;switch(i.image_type){case e._TYPE_RLE_INDEXED:a=!0;case e._TYPE_INDEXED:s=!0;break;case e._TYPE_RLE_RGB:a=!0;case e._TYPE_RGB:break;case e._TYPE_RLE_GREY:a=!0;case e._TYPE_GREY:l=!0}var u,c,h,d,f,m,g,_=i.pixel_size>>3,v=i.width*i.height*_;if(s&&(u=n.subarray(r,r+=i.colormap_length*(i.colormap_size>>3))),a){var y,b,E;o=new Uint8Array(v);for(var x=0,T=new Uint8Array(_);r<v&&x<v;)if(b=1+(127&(y=n[r++])),128&y){for(E=0;E<_;++E)T[E]=n[r++];for(E=0;E<b;++E)o.set(T,x+E*_);x+=_*b}else{for(b*=_,E=0;E<b;++E)o[x+E]=n[r++];x+=b}}else o=n.subarray(r,r+=s?i.width*i.height:v);switch((i.flags&e._ORIGIN_MASK)>>e._ORIGIN_SHIFT){default:case e._ORIGIN_UL:c=0,d=1,g=i.width,h=0,f=1,m=i.height;break;case e._ORIGIN_BL:c=0,d=1,g=i.width,h=i.height-1,f=-1,m=-1;break;case e._ORIGIN_UR:c=i.width-1,d=-1,g=-1,h=0,f=1,m=i.height;break;case e._ORIGIN_BR:c=i.width-1,d=-1,g=-1,h=i.height-1,f=-1,m=-1}var S=e["_getImageData"+(l?"Grey":"")+i.pixel_size+"bits"](i,u,o,h,f,m,c,d,g);t.getEngine()._uploadDataToTextureDirectly(t,S)}}},e._getImageData8bits=function(e,t,n,r,i,o,a,s,l){var u,c,h,d=n,f=t,p=e.width,m=e.height,g=0,_=new Uint8Array(p*m*4);for(h=r;h!==o;h+=i)for(c=a;c!==l;c+=s,g++)u=d[g],_[4*(c+p*h)+3]=255,_[4*(c+p*h)+2]=f[3*u+0],_[4*(c+p*h)+1]=f[3*u+1],_[4*(c+p*h)+0]=f[3*u+2];return _},e._getImageData16bits=function(e,t,n,r,i,o,a,s,l){var u,c,h,d=n,f=e.width,p=e.height,m=0,g=new Uint8Array(f*p*4);for(h=r;h!==o;h+=i)for(c=a;c!==l;c+=s,m+=2){var _=255*((31744&(u=d[m+0]+(d[m+1]<<8)))>>10)/31|0,v=255*((992&u)>>5)/31|0,y=255*(31&u)/31|0;g[4*(c+f*h)+0]=_,g[4*(c+f*h)+1]=v,g[4*(c+f*h)+2]=y,g[4*(c+f*h)+3]=32768&u?0:255}return g},e._getImageData24bits=function(e,t,n,r,i,o,a,s,l){var u,c,h=n,d=e.width,f=e.height,p=0,m=new Uint8Array(d*f*4);for(c=r;c!==o;c+=i)for(u=a;u!==l;u+=s,p+=3)m[4*(u+d*c)+3]=255,m[4*(u+d*c)+2]=h[p+0],m[4*(u+d*c)+1]=h[p+1],m[4*(u+d*c)+0]=h[p+2];return m},e._getImageData32bits=function(e,t,n,r,i,o,a,s,l){var u,c,h=n,d=e.width,f=e.height,p=0,m=new Uint8Array(d*f*4);for(c=r;c!==o;c+=i)for(u=a;u!==l;u+=s,p+=4)m[4*(u+d*c)+2]=h[p+0],m[4*(u+d*c)+1]=h[p+1],m[4*(u+d*c)+0]=h[p+2],m[4*(u+d*c)+3]=h[p+3];return m},e._getImageDataGrey8bits=function(e,t,n,r,i,o,a,s,l){var u,c,h,d=n,f=e.width,p=e.height,m=0,g=new Uint8Array(f*p*4);for(h=r;h!==o;h+=i)for(c=a;c!==l;c+=s,m++)u=d[m],g[4*(c+f*h)+0]=u,g[4*(c+f*h)+1]=u,g[4*(c+f*h)+2]=u,g[4*(c+f*h)+3]=255;return g},e._getImageDataGrey16bits=function(e,t,n,r,i,o,a,s,l){var u,c,h=n,d=e.width,f=e.height,p=0,m=new Uint8Array(d*f*4);for(c=r;c!==o;c+=i)for(u=a;u!==l;u+=s,p+=2)m[4*(u+d*c)+0]=h[p+0],m[4*(u+d*c)+1]=h[p+0],m[4*(u+d*c)+2]=h[p+0],m[4*(u+d*c)+3]=h[p+1];return m},e._TYPE_INDEXED=1,e._TYPE_RGB=2,e._TYPE_GREY=3,e._TYPE_RLE_INDEXED=9,e._TYPE_RLE_RGB=10,e._TYPE_RLE_GREY=11,e._ORIGIN_MASK=48,e._ORIGIN_SHIFT=4,e._ORIGIN_BL=0,e._ORIGIN_BR=1,e._ORIGIN_UL=2,e._ORIGIN_UR=3,e}(),bo=function(){function e(){this.supportCascades=!1}return e.prototype.canLoad=function(e,t,n,r,i){return 0===e.indexOf(".tga")},e.prototype.transformUrl=function(e,t){return e},e.prototype.getFallbackTextureUrl=function(e,t){return null},e.prototype.loadCubeData=function(e,t,n,r,i){throw".env not supported in Cube."},e.prototype.loadData=function(e,t,n){var r=new Uint8Array(e),i=yo.GetTGAHeader(r);n(i.width,i.height,t.generateMipMaps,!1,function(){yo.UploadContent(t,r)})},e}();ge.b._TextureLoaders.push(new bo),ge.b.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t,n){void 0===t&&(t=!1),this._currentRenderTarget=null;var r=this._gl;if(e[0]._MSAAFramebuffer){r.bindFramebuffer(r.READ_FRAMEBUFFER,e[0]._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e[0]._framebuffer);var i=e[0]._attachments;i||(i=new Array(e.length),e[0]._attachments=i);for(var o=0;o<e.length;o++){for(var a=e[o],s=0;s<i.length;s++)i[s]=r.NONE;i[o]=r[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"],r.readBuffer(i[o]),r.drawBuffers(i),r.blitFramebuffer(0,0,a.width,a.height,0,0,a.width,a.height,r.COLOR_BUFFER_BIT,r.NEAREST)}for(o=0;o<i.length;o++)i[o]=r[this.webGLVersion>1?"COLOR_ATTACHMENT"+o:"COLOR_ATTACHMENT"+o+"_WEBGL"];r.drawBuffers(i)}for(o=0;o<e.length;o++)!(a=e[o]).generateMipMaps||t||a.isCube||(this._bindTextureDirectly(r.TEXTURE_2D,a),r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null));n&&(e[0]._MSAAFramebuffer&&this._bindUnboundFramebuffer(e[0]._framebuffer),n()),this._bindUnboundFramebuffer(null)},ge.b.prototype.createMultipleRenderTarget=function(e,t){var n=!1,r=!0,i=!1,o=!1,a=1,s=ge.b.TEXTURETYPE_UNSIGNED_INT,l=ge.b.TEXTURE_TRILINEAR_SAMPLINGMODE,u=new Array,c=new Array;void 0!==t&&(n=void 0!==t.generateMipMaps&&t.generateMipMaps,r=void 0===t.generateDepthBuffer||t.generateDepthBuffer,i=void 0!==t.generateStencilBuffer&&t.generateStencilBuffer,o=void 0!==t.generateDepthTexture&&t.generateDepthTexture,a=t.textureCount||1,t.types&&(u=t.types),t.samplingModes&&(c=t.samplingModes));var h=this._gl,d=h.createFramebuffer();this._bindUnboundFramebuffer(d);for(var f=e.width||e,m=e.height||e,g=[],_=[],v=this._setupFramebufferDepthAttachments(i,r,f,m),y=0;y<a;y++){var b=c[y]||l,E=u[y]||s;(E!==ge.b.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(E!==ge.b.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(b=ge.b.TEXTURE_NEAREST_SAMPLINGMODE);var x=this._getSamplingParameters(b,n);E!==ge.b.TEXTURETYPE_FLOAT||this._caps.textureFloat||(E=ge.b.TEXTURETYPE_UNSIGNED_INT,p.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var T=new ze.a(this,ze.a.DATASOURCE_MULTIRENDERTARGET),S=h[this.webGLVersion>1?"COLOR_ATTACHMENT"+y:"COLOR_ATTACHMENT"+y+"_WEBGL"];g.push(T),_.push(S),h.activeTexture(h["TEXTURE"+y]),h.bindTexture(h.TEXTURE_2D,T._webGLTexture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,x.mag),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,x.min),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(E),f,m,0,h.RGBA,this._getWebGLTextureType(E),null),h.framebufferTexture2D(h.DRAW_FRAMEBUFFER,S,h.TEXTURE_2D,T._webGLTexture,0),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(h.TEXTURE_2D,null),T._framebuffer=d,T._depthStencilBuffer=v,T.baseWidth=f,T.baseHeight=m,T.width=f,T.height=m,T.isReady=!0,T.samples=1,T.generateMipMaps=n,T.samplingMode=b,T.type=E,T._generateDepthBuffer=r,T._generateStencilBuffer=i,T._attachments=_,this._internalTexturesCache.push(T)}if(o&&this._caps.depthTextureExtension){var A=new ze.a(this,ze.a.DATASOURCE_MULTIRENDERTARGET);h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,A._webGLTexture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(h.TEXTURE_2D,0,this.webGLVersion<2?h.DEPTH_COMPONENT:h.DEPTH_COMPONENT16,f,m,0,h.DEPTH_COMPONENT,h.UNSIGNED_SHORT,null),h.framebufferTexture2D(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.TEXTURE_2D,A._webGLTexture,0),A._framebuffer=d,A.baseWidth=f,A.baseHeight=m,A.width=f,A.height=m,A.isReady=!0,A.samples=1,A.generateMipMaps=n,A.samplingMode=h.NEAREST,A._generateDepthBuffer=r,A._generateStencilBuffer=i,g.push(A),this._internalTexturesCache.push(A)}return h.drawBuffers(_),h.bindRenderbuffer(h.RENDERBUFFER,null),this._bindUnboundFramebuffer(null),this.resetTextureCache(),g},ge.b.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e||0==e.length)return 1;if(e[0].samples===t)return t;var n=this._gl;t=Math.min(t,n.getParameter(n.MAX_SAMPLES)),e[0]._depthStencilBuffer&&(n.deleteRenderbuffer(e[0]._depthStencilBuffer),e[0]._depthStencilBuffer=null),e[0]._MSAAFramebuffer&&(n.deleteFramebuffer(e[0]._MSAAFramebuffer),e[0]._MSAAFramebuffer=null);for(var r=0;r<e.length;r++)e[r]._MSAARenderBuffer&&(n.deleteRenderbuffer(e[r]._MSAARenderBuffer),e[r]._MSAARenderBuffer=null);if(t>1){var i=n.createFramebuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");this._bindUnboundFramebuffer(i);var o=this._setupFramebufferDepthAttachments(e[0]._generateStencilBuffer,e[0]._generateDepthBuffer,e[0].width,e[0].height,t),a=[];for(r=0;r<e.length;r++){var s=e[r],l=n[this.webGLVersion>1?"COLOR_ATTACHMENT"+r:"COLOR_ATTACHMENT"+r+"_WEBGL"],u=n.createRenderbuffer();if(!u)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,u),n.renderbufferStorageMultisample(n.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(s.type),s.width,s.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,l,n.RENDERBUFFER,u),s._MSAAFramebuffer=i,s._MSAARenderBuffer=u,s.samples=t,s._depthStencilBuffer=o,n.bindRenderbuffer(n.RENDERBUFFER,null),a.push(l)}n.drawBuffers(a)}else this._bindUnboundFramebuffer(e[0]._framebuffer);return this._bindUnboundFramebuffer(null),t};var Eo=function(e){function t(t,n,r,i,o){var a=this,s=!(!o||!o.generateMipMaps)&&o.generateMipMaps,l=!(!o||!o.generateDepthTexture)&&o.generateDepthTexture,u=!o||void 0===o.doNotChangeAspectRatio||o.doNotChangeAspectRatio;if((a=e.call(this,t,n,i,s,u)||this)._engine=i.getEngine(),a.isSupported){for(var c=[],h=[],d=0;d<r;d++)o&&o.types&&void 0!==o.types[d]?c.push(o.types[d]):c.push(o&&o.defaultType?o.defaultType:m.a.TEXTURETYPE_UNSIGNED_INT),o&&o.samplingModes&&void 0!==o.samplingModes[d]?h.push(o.samplingModes[d]):h.push(Ge.a.BILINEAR_SAMPLINGMODE);var f=!o||void 0===o.generateDepthBuffer||o.generateDepthBuffer,p=!(!o||void 0===o.generateStencilBuffer)&&o.generateStencilBuffer;return a._size=n,a._multiRenderTargetOptions={samplingModes:h,generateMipMaps:s,generateDepthBuffer:f,generateStencilBuffer:p,generateDepthTexture:l,types:c,textureCount:r},a._createInternalTextures(),a._createTextures(),a}a.dispose()}return u.d(t,e),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapU=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapV=e},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var e=0;e<this._internalTextures.length;e++)this._textures[e]._texture=this._internalTextures[e];this._texture=this._internalTextures[0]},t.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},t.prototype._createTextures=function(){this._textures=[];for(var e=0;e<this._internalTextures.length;e++){var t=new Ge.a(null,this.getScene());t._texture=this._internalTextures[e],this._textures.push(t)}this._texture=this._internalTextures[0]},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=this._engine.updateMultipleRenderTargetTextureSampleCount(this._internalTextures,e))},enumerable:!0,configurable:!0}),t.prototype.resize=function(e){this.releaseInternalTextures(),this._internalTextures=this._engine.createMultipleRenderTarget(e,this._multiRenderTargetOptions),this._createInternalTextures()},t.prototype.unbindFrameBuffer=function(e,t){var n=this;e.unBindMultiColorAttachmentFramebuffer(this._internalTextures,this.isCube,function(){n.onAfterRenderObservable.notifyObservers(t)})},t.prototype.dispose=function(){this.releaseInternalTextures(),e.prototype.dispose.call(this)},t.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var e=this._internalTextures.length-1;e>=0;e--)void 0!==this._internalTextures[e]&&(this._internalTextures[e].dispose(),this._internalTextures.splice(e,1))},t}(un),xo=function(){function e(e){this.name=Te.a.NAME_PROCEDURALTEXTURE,this.scene=e,this.scene.proceduralTextures=new Array,e.layers=new Array}return e.prototype.register=function(){this.scene._beforeClearStage.registerStep(Te.a.STEP_BEFORECLEAR_PROCEDURALTEXTURE,this,this._beforeClear)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeClear=function(){if(this.scene.proceduralTexturesEnabled){ye.h.StartPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0);for(var e=0;e<this.scene.proceduralTextures.length;e++){var t=this.scene.proceduralTextures[e];t._shouldRender()&&t.render()}ye.h.EndPerformanceCounter("Procedural textures",this.scene.proceduralTextures.length>0)}},e}();zt.a.ShadersStore.proceduralVertexShader="\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}";var To=function(e){function t(t,n,r,o,a,s,l){void 0===a&&(a=null),void 0===s&&(s=!0),void 0===l&&(l=!1);var u=e.call(this,null,o,!s)||this;u.isCube=l,u.isEnabled=!0,u.autoClear=!0,u.onGeneratedObservable=new i.c,u._textures={},u._currentRefreshId=-1,u._refreshRate=1,u._vertexBuffers={},u._uniforms=new Array,u._samplers=new Array,u._floats={},u._ints={},u._floatsArrays={},u._colors3={},u._colors4={},u._vectors2={},u._vectors3={},u._matrices={},u._fallbackTextureUsed=!1,u._cachedDefines="",u._contentUpdateId=-1;var c=(o=u.getScene())._getComponent(Te.a.NAME_PROCEDURALTEXTURE);c||(c=new xo(o),o._addComponent(c)),o.proceduralTextures.push(u),u._engine=o.getEngine(),u.name=t,u.isRenderTarget=!0,u._size=n,u._generateMipMaps=s,u.setFragment(r),u._fallbackTexture=a,l?(u._texture=u._engine.createRenderTargetCubeTexture(n,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1}),u.setFloat("face",0)):u._texture=u._engine.createRenderTargetTexture(n,{generateMipMaps:s,generateDepthBuffer:!1,generateStencilBuffer:!1});var h=[];return h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),u._vertexBuffers[Sn.b.PositionKind]=new Sn.b(u._engine,h,Sn.b.PositionKind,!1,!1,2),u._createIndexBuffer(),u}return u.d(t,e),t.prototype.getEffect=function(){return this._effect},t.prototype.getContent=function(){return this._contentData&&this._currentRefreshId==this._contentUpdateId?this._contentData:(this._contentData=this.readPixels(0,0,this._contentData),this._contentUpdateId=this._currentRefreshId,this._contentData)},t.prototype._createIndexBuffer=function(){var e=this._engine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},t.prototype._rebuild=function(){var e=this._vertexBuffers[Sn.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer(),this.refreshRate===un.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=un.REFRESHRATE_RENDER_ONCE)},t.prototype.reset=function(){void 0!==this._effect&&this._effect.dispose()},t.prototype._getDefines=function(){return""},t.prototype.isReady=function(){var e,t=this,n=this._engine;if(!this._fragment)return!1;if(this._fallbackTextureUsed)return!0;var r=this._getDefines();return!(!this._effect||r!==this._cachedDefines||!this._effect.isReady())||(e=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._cachedDefines=r,this._effect=n.createEffect(e,[Sn.b.PositionKind],this._uniforms,this._samplers,r,void 0,void 0,function(){t.releaseInternalTexture(),t._fallbackTexture&&(t._texture=t._fallbackTexture._texture,t._texture&&t._texture.incrementReferences()),t._fallbackTextureUsed=!0}),this._effect.isReady())},t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},t.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),t.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?!this._fallbackTextureUsed&&(-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)):(this._texture&&(this._texture.isReady=!1),!1)},t.prototype.getRenderSize=function(){return this._size},t.prototype.resize=function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(e,t),this._size=e,this._generateMipMaps=t)},t.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.render=function(e){var t=this.getScene();if(t){var n=this._engine;for(var r in n.enableEffect(this._effect),n.setState(!1),this._textures)this._effect.setTexture(r,this._textures[r]);for(r in this._ints)this._effect.setInt(r,this._ints[r]);for(r in this._floats)this._effect.setFloat(r,this._floats[r]);for(r in this._floatsArrays)this._effect.setArray(r,this._floatsArrays[r]);for(r in this._colors3)this._effect.setColor3(r,this._colors3[r]);for(r in this._colors4){var i=this._colors4[r];this._effect.setFloat4(r,i.r,i.g,i.b,i.a)}for(r in this._vectors2)this._effect.setVector2(r,this._vectors2[r]);for(r in this._vectors3)this._effect.setVector3(r,this._vectors3[r]);for(r in this._matrices)this._effect.setMatrix(r,this._matrices[r]);if(this._texture){if(this.isCube)for(var o=0;o<6;o++)n.bindFramebuffer(this._texture,o,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",o),this.autoClear&&n.clear(t.clearColor,!0,!1,!1),n.drawElementsType(Mi.a.TriangleFillMode,0,6),5===o&&n.generateMipMapsForCubemap(this._texture);else n.bindFramebuffer(this._texture,0,void 0,void 0,!0),n.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.autoClear&&n.clear(t.clearColor,!0,!1,!1),n.drawElementsType(Mi.a.TriangleFillMode,0,6);n.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated(),this.onGeneratedObservable.notifyObservers(this)}}},t.prototype.clone=function(){var e=this.getSize(),n=new t(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return n.hasAlpha=this.hasAlpha,n.level=this.level,n.coordinatesMode=this.coordinatesMode,n},t.prototype.dispose=function(){var t=this.getScene();if(t){var n=t.proceduralTextures.indexOf(this);n>=0&&t.proceduralTextures.splice(n,1);var r=this._vertexBuffers[Sn.b.PositionKind];r&&(r.dispose(),this._vertexBuffers[Sn.b.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),e.prototype.dispose.call(this)}},u.c([Object(D.c)()],t.prototype,"isEnabled",void 0),u.c([Object(D.c)()],t.prototype,"autoClear",void 0),u.c([Object(D.c)()],t.prototype,"_generateMipMaps",void 0),u.c([Object(D.c)()],t.prototype,"_size",void 0),u.c([Object(D.c)()],t.prototype,"refreshRate",null),t}(Ge.a),So=n(60),Ao=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,r,null,i,o,a)||this;return s._animate=!0,s._time=0,s._texturePath=n,s._loadJson(n),s.refreshRate=1,s}return u.d(t,e),t.prototype._loadJson=function(e){var t=this,n=function(){p.a.Log("No config file found in "+e+" trying to use ShadersStore or DOM element");try{t.setFragment(t._texturePath)}catch(e){p.a.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},r=e+"/config.json",i=new So.a;i.open("GET",r),i.addEventListener("load",function(){if(200===i.status||i.responseText&&i.responseText.length>0)try{t._config=JSON.parse(i.response),t.updateShaderUniforms(),t.updateTextures(),t.setFragment(t._texturePath+"/custom"),t._animate=t._config.animate,t.refreshRate=t._config.refreshrate}catch(e){n()}else n()},!1),i.addEventListener("error",function(){n()},!1);try{i.send()}catch(e){p.a.Error("CustomProceduralTexture: Error on XHR send request.")}},t.prototype.isReady=function(){if(!e.prototype.isReady.call(this))return!1;for(var t in this._textures)if(!this._textures[t].isReady())return!1;return!0},t.prototype.render=function(t){var n=this.getScene();this._animate&&n&&(this._time+=.03*n.getAnimationRatio(),this.updateShaderUniforms()),e.prototype.render.call(this,t)},t.prototype.updateTextures=function(){for(var e=0;e<this._config.sampler2Ds.length;e++)this.setTexture(this._config.sampler2Ds[e].sample2Dname,new Ge.a(this._texturePath+"/"+this._config.sampler2Ds[e].textureRelativeUrl,this.getScene()))},t.prototype.updateShaderUniforms=function(){if(this._config)for(var e=0;e<this._config.uniforms.length;e++){var t=this._config.uniforms[e];switch(t.type){case"float":this.setFloat(t.name,t.value);break;case"color3":this.setColor3(t.name,new o.e(t.r,t.g,t.b));break;case"color4":this.setColor4(t.name,new o.f(t.r,t.g,t.b,t.a));break;case"vector2":this.setVector2(t.name,new o.w(t.x,t.y));break;case"vector3":this.setVector3(t.name,new o.x(t.x,t.y,t.z))}}this.setFloat("time",this._time)},Object.defineProperty(t.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!0,configurable:!0}),t}(To);zt.a.ShadersStore.noisePixelShader="\n\nuniform float brightness;\nuniform float persistence;\nuniform float timeScale;\n\nvarying vec2 vUV;\n\nvec2 hash22(vec2 p)\n{\np=p*mat2(127.1,311.7,269.5,183.3);\np=-1.0+2.0*fract(sin(p)*43758.5453123);\nreturn sin(p*6.283+timeScale);\n}\nfloat interpolationNoise(vec2 p)\n{\nvec2 pi=floor(p);\nvec2 pf=p-pi;\nvec2 w=pf*pf*(3.-2.*pf);\nfloat f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));\nfloat f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));\nfloat f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));\nfloat f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));\nfloat xm1=mix(f00,f10,w.x);\nfloat xm2=mix(f01,f11,w.x);\nfloat ym=mix(xm1,xm2,w.y);\nreturn ym;\n}\nfloat perlinNoise2D(float x,float y)\n{\nfloat sum=0.0;\nfloat frequency=0.0;\nfloat amplitude=0.0;\nfor(int i=0; i<OCTAVES; i++)\n{\nfrequency=pow(2.0,float(i));\namplitude=pow(persistence,float(i));\nsum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;\n}\nreturn sum;\n}\n\nvoid main(void)\n{\nfloat x=abs(vUV.x);\nfloat y=abs(vUV.y);\nfloat noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);\ngl_FragColor=vec4(noise,noise,noise,1.0);\n}\n";var Po=function(e){function t(t,n,r,i,o){void 0===n&&(n=256),void 0===r&&(r=P.a.LastCreatedScene);var a=e.call(this,t,n,"noise",r,i,o)||this;return a._time=0,a.brightness=.2,a.octaves=3,a.persistence=.8,a.animationSpeedFactor=1,a.autoClear=!1,a._updateShaderUniforms(),a}return u.d(t,e),t.prototype._updateShaderUniforms=function(){var e=this.getScene();e&&(this._time+=e.getAnimationRatio()*this.animationSpeedFactor*.01,this.setFloat("brightness",this.brightness),this.setFloat("persistence",this.persistence),this.setFloat("timeScale",this._time))},t.prototype._getDefines=function(){return"#define OCTAVES "+(0|this.octaves)},t.prototype.render=function(t){this._updateShaderUniforms(),e.prototype.render.call(this,t)},t.prototype.serialize=function(){var e={customType:"BABYLON.NoiseProceduralTexture"};return e.brightness=this.brightness,e.octaves=this.octaves,e.persistence=this.persistence,e.animationSpeedFactor=this.animationSpeedFactor,e.size=this.getSize().width,e.generateMipMaps=this._generateMipMaps,e},t.Parse=function(e,n){var r=new t(e.name,e.size,n,void 0,e.generateMipMaps);return r.brightness=e.brightness,r.octaves=e.octaves,r.persistence=e.persistence,r.animationSpeedFactor=e.animationSpeedFactor,r},t}(To);a.a.RegisteredTypes["BABYLON.NoiseProceduralTexture"]=Po;var Mo=function(e){function t(t,n,r,i,o,a,s,l,u){void 0===i&&(i=m.a.TEXTUREFORMAT_RGBA),void 0===o&&(o=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===a&&(a=!1),void 0===s&&(s=!1),void 0===l&&(l=m.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null);var c=e.call(this,"",t)||this;return c._texture=t.getEngine().createRawCubeTexture(n,r,i,o,a,s,l,u),c}return u.d(t,e),t.prototype.update=function(e,t,n,r,i){void 0===i&&(i=null),this._texture.getEngine().updateRawCubeTexture(this._texture,e,t,n,r,i)},t.prototype.updateRGBDAsync=function(e,n,r,i){return void 0===n&&(n=null),void 0===r&&(r=.8),void 0===i&&(i=0),t._UpdateRGBDAsync(this._texture,e,n,r,i)},t.prototype.clone=function(){var e=this;return D.a.Clone(function(){var n=e.getScene(),r=e._texture,i=new t(n,r._bufferViewArray,r.width,r.format,r.type,r.generateMipMaps,r.invertY,r.samplingMode,r._compression);return r.dataSource===ze.a.DATASOURCE_CUBERAW_RGBD&&i.updateRGBDAsync(r._bufferViewArrayArray,r._sphericalPolynomial,r._lodGenerationScale,r._lodGenerationOffset),i},this)},t._UpdateRGBDAsync=function(e,t,n,r,i){return e._dataSource=ze.a.DATASOURCE_CUBERAW_RGBD,e._bufferViewArrayArray=t,e._lodGenerationScale=r,e._lodGenerationOffset=i,e._sphericalPolynomial=n,yi.UploadLevelsAsync(e,t).then(function(){e.isReady=!0})},t}(Hr),Ro=function(e){function t(t,n,r,i,o,a,s,l,u,c){void 0===s&&(s=!0),void 0===l&&(l=!1),void 0===u&&(u=Ge.a.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=m.a.TEXTURETYPE_UNSIGNED_INT);var h=e.call(this,null,a,!s,l)||this;return h.format=o,h._engine=a.getEngine(),h._texture=a.getEngine().createRawTexture3D(t,n,r,i,o,s,l,u,void 0,c),h.is3D=!0,h}return u.d(t,e),t.prototype.update=function(e){this._texture&&this._engine.updateRawTexture3D(this._texture,e,this._texture.format,this._texture.invertY,null,this._texture.type)},t}(Ge.a),Co=function(e){function t(t,n,r,i){var a=e.call(this,t,n,r,i,!0)||this;return a.refractionPlane=new o.n(0,1,0,1),a.depth=2,a.onBeforeRenderObservable.add(function(){r.clipPlane=a.refractionPlane}),a.onAfterRenderObservable.add(function(){r.clipPlane=null}),a}return u.d(t,e),t.prototype.clone=function(){var e=this.getScene();if(!e)return this;var n=this.getSize(),r=new t(this.name,n.width,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.refractionPlane=this.refractionPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r.depth=this.depth,r},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);return t.mirrorPlane=this.refractionPlane.asArray(),t.depth=this.depth,t},t}(un),wo=function(e){function t(n,r,i){var a=e.call(this,i.scene)||this;return r&&(i.engine||i.scene)?(i=u.a({},t.DefaultOptions,i),a._engine=i.engine||i.scene.getEngine(),a._generateMipMaps=i.generateMipMaps,a._samplingMode=i.samplingMode,a._textureMatrix=o.j.Identity(),a.name=n,a.element=r,a._isVideo=r instanceof HTMLVideoElement,a.anisotropicFilteringLevel=1,a._createInternalTexture(),a):a}return u.d(t,e),t.prototype._createInternalTexture=function(){var e=0,t=0;this._isVideo?(e=this.element.videoWidth,t=this.element.videoHeight):(e=this.element.width,t=this.element.height),this._texture=this._engine.createDynamicTexture(e,t,this._generateMipMaps,this._samplingMode),this.update()},t.prototype.getTextureMatrix=function(){return this._textureMatrix},t.prototype.update=function(e){if(void 0===e&&(e=null),null!=this._texture)if(this._isVideo){var t=this.element;if(t.readyState<t.HAVE_CURRENT_DATA)return;this._engine.updateVideoTexture(this._texture,t,null===e||e)}else{var n=this.element;this._engine.updateDynamicTexture(this._texture,n,null===e||e,!1)}},t.DefaultOptions={generateMipMaps:!1,samplingMode:m.a.TEXTURE_BILINEAR_SAMPLINGMODE,engine:null,scene:null},t}(Gr.a),Oo=function(){function e(e){this._pendingActions=new Array,this._workerInfos=e.map(function(e){return{worker:e,active:!1}})}return e.prototype.dispose=function(){for(var e=0,t=this._workerInfos;e<t.length;e++)t[e].worker.terminate();delete this._workerInfos,delete this._pendingActions},e.prototype.push=function(e){for(var t=0,n=this._workerInfos;t<n.length;t++){var r=n[t];if(!r.active)return void this._execute(r,e)}this._pendingActions.push(e)},e.prototype._execute=function(e,t){var n=this;e.active=!0,t(e.worker,function(){e.active=!1;var t=n._pendingActions.shift();t&&n._execute(e,t)})},e}();function Io(e){return"function"==typeof importScripts?(importScripts(e),Promise.resolve()):new Promise(function(t,n){ye.h.LoadScript(e,function(){t()},function(e){n(new Error(e))})})}function Do(e,t,n){var r=t&&e||n;if(r)return Io(r).then(function(){return new Promise(function(e){DracoDecoderModule({wasmBinary:t}).then(function(t){e({module:t})})})})}function Lo(e,t,n,r,i){var o=new e.DecoderBuffer;o.Init(t,t.byteLength);var a,s,l=new e.Decoder;try{var u=l.GetEncodedGeometryType(o);switch(u){case e.TRIANGULAR_MESH:a=new e.Mesh,s=l.DecodeBufferToMesh(o,a);break;case e.POINT_CLOUD:a=new e.PointCloud,s=l.DecodeBufferToPointCloud(o,a);break;default:throw new Error("Invalid geometry type "+u)}if(!s.ok()||!a.ptr)throw new Error(s.error_msg());var c=a.num_points();if(u===e.TRIANGULAR_MESH){var h=a.num_faces(),d=new e.DracoInt32Array;try{for(var f=new Uint32Array(3*h),p=0;p<h;p++){l.GetFaceFromMesh(a,p,d);var m=3*p;f[m+0]=d.GetValue(0),f[m+1]=d.GetValue(1),f[m+2]=d.GetValue(2)}r(f)}finally{e.destroy(d)}}var g=function(t,n){var r=new e.DracoFloat32Array;try{l.GetAttributeFloatForAllPoints(a,n,r);for(var o=new Float32Array(c*n.num_components()),s=0;s<o.length;s++)o[s]=r.GetValue(s);i(t,o)}finally{e.destroy(r)}};if(n)for(var _ in n){var v=n[_];g(_,l.GetAttributeByUniqueId(a,v))}else{var y={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var _ in y)-1!==(v=l.GetAttributeId(a,e[y[_]]))&&g(_,l.GetAttribute(a,v))}}finally{a&&e.destroy(a),e.destroy(l),e.destroy(o)}}function Fo(e){return"object"!=typeof document||"string"!=typeof e?e:ye.h.GetAbsoluteUrl(e)}var No=function(){function e(t){void 0===t&&(t=e.DefaultNumWorkers);var n,r=e.Configuration.decoder,i=r.wasmUrl&&r.wasmBinaryUrl&&"object"==typeof WebAssembly?(n=Fo(r.wasmBinaryUrl),new Promise(function(e,t){ye.h.LoadFile(n,function(t){e(t)},void 0,void 0,!0,function(e,n){t(n)})})):Promise.resolve(void 0);t&&"function"==typeof Worker?this._workerPoolPromise=i.then(function(e){for(var n=""+Io+Do+Lo+"("+function(){var e;onmessage=function(t){var n=t.data;switch(n.id){case"init":var r=n.decoder;e=Do(r.wasmUrl,r.wasmBinary,r.fallbackUrl),postMessage("done");break;case"decodeMesh":if(!e)throw new Error("Draco decoder module is not available");e.then(function(e){Lo(e.module,n.dataView,n.attributes,function(e){postMessage({id:"indices",value:e},[e.buffer])},function(e,t){postMessage({id:e,value:t},[t.buffer])}),postMessage("done")})}}}+")()",i=URL.createObjectURL(new Blob([n],{type:"application/javascript"})),o=new Array(t),a=0;a<o.length;a++)o[a]=new Promise(function(t,n){var o=new Worker(i),a=function e(t){o.removeEventListener("error",e),o.removeEventListener("message",s),n(t)},s=function e(n){"done"===n.data&&(o.removeEventListener("error",a),o.removeEventListener("message",e),t(o))};o.addEventListener("error",a),o.addEventListener("message",s),o.postMessage({id:"init",decoder:{wasmUrl:Fo(r.wasmUrl),wasmBinary:e,fallbackUrl:Fo(r.fallbackUrl)}})});return Promise.all(o).then(function(e){return new Oo(e)})}):this._decoderModulePromise=i.then(function(e){return Do(r.wasmUrl,e,r.fallbackUrl)})}return Object.defineProperty(e,"DecoderAvailable",{get:function(){var t=e.Configuration.decoder;return!!(t.wasmUrl&&t.wasmBinaryUrl&&"object"==typeof WebAssembly||t.fallbackUrl)},enumerable:!0,configurable:!0}),e.GetDefaultNumWorkers=function(){return"object"==typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},Object.defineProperty(e,"Default",{get:function(){return e._Default||(e._Default=new e),e._Default},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._workerPoolPromise&&this._workerPoolPromise.then(function(e){e.dispose()}),delete this._workerPoolPromise,delete this._decoderModulePromise},e.prototype.whenReadyAsync=function(){return this._workerPoolPromise?this._workerPoolPromise.then(function(){}):this._decoderModulePromise?this._decoderModulePromise.then(function(){}):Promise.resolve()},e.prototype.decodeMeshAsync=function(e,t){var n=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this._workerPoolPromise)return this._workerPoolPromise.then(function(e){return new Promise(function(r,i){e.push(function(e,o){var a=new Tn.a,s=function t(n){e.removeEventListener("error",t),e.removeEventListener("message",l),i(n),o()},l=function t(n){"done"===n.data?(e.removeEventListener("error",s),e.removeEventListener("message",t),r(a),o()):"indices"===n.data.id?a.indices=n.data.value:a.set(n.data.value,n.data.id)};e.addEventListener("error",s),e.addEventListener("message",l);var u=new Uint8Array(n.byteLength);u.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),e.postMessage({id:"decodeMesh",dataView:u,attributes:t},[u.buffer])})})});if(this._decoderModulePromise)return this._decoderModulePromise.then(function(e){var r=new Tn.a;return Lo(e.module,n,t,function(e){r.indices=e},function(e,t){r.set(t,e)}),r});throw new Error("Draco decoder module is not available")},e.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}},e.DefaultNumWorkers=e.GetDefaultNumWorkers(),e._Default=null,e}(),Bo=n(49),Uo=0,ko=function(){function e(e,t,n){this.pos=e,this.normal=t,this.uv=n}return e.prototype.clone=function(){return new e(this.pos.clone(),this.normal.clone(),this.uv.clone())},e.prototype.flip=function(){this.normal=this.normal.scale(-1)},e.prototype.interpolate=function(t,n){return new e(o.x.Lerp(this.pos,t.pos,n),o.x.Lerp(this.normal,t.normal,n),o.w.Lerp(this.uv,t.uv,n))},e}(),Vo=function(){function e(e,t){this.normal=e,this.w=t}return e.FromPoints=function(t,n,r){var i=r.subtract(t),a=n.subtract(t);if(0===i.lengthSquared()||0===a.lengthSquared())return null;var s=o.x.Normalize(o.x.Cross(i,a));return new e(s,o.x.Dot(s,t))},e.prototype.clone=function(){return new e(this.normal.clone(),this.w)},e.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},e.prototype.splitPolygon=function(t,n,r,i,a){var s,l,u=0,c=[];for(s=0;s<t.vertices.length;s++){var h=(l=o.x.Dot(this.normal,t.vertices[s].pos)-this.w)<-e.EPSILON?2:l>e.EPSILON?1:0;u|=h,c.push(h)}switch(u){case 0:(o.x.Dot(this.normal,t.plane.normal)>0?n:r).push(t);break;case 1:i.push(t);break;case 2:a.push(t);break;case 3:var d,f=[],p=[];for(s=0;s<t.vertices.length;s++){var m=(s+1)%t.vertices.length,g=c[s],_=c[m],v=t.vertices[s],y=t.vertices[m];if(2!==g&&f.push(v),1!==g&&p.push(2!==g?v.clone():v),3==(g|_)){l=(this.w-o.x.Dot(this.normal,v.pos))/o.x.Dot(this.normal,y.pos.subtract(v.pos));var b=v.interpolate(y,l);f.push(b),p.push(b.clone())}}f.length>=3&&(d=new Go(f,t.shared)).plane&&i.push(d),p.length>=3&&(d=new Go(p,t.shared)).plane&&a.push(d)}},e.EPSILON=1e-5,e}(),Go=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=Vo.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map(function(e){return e.clone()}),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},e}(),zo=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=new Array,n=new Array,r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var n=new Array,r=new Array,i=0;i<t.length;i++)this.plane.splitPolygon(t[i],this.polygons,this.polygons,n,r);n.length&&(this.front||(this.front=new e),this.front.build(n)),r.length&&(this.back||(this.back=new e),this.back.build(r))}},e}(),jo=function(){function e(){this.polygons=new Array}return e.FromMesh=function(t){var n,r,i,a,s,l,u,c,h,d,f=new Array,p=null;if(!(t instanceof fe.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";t.computeWorldMatrix(!0),u=t.getWorldMatrix(),c=t.position.clone(),h=t.rotation.clone(),t.rotationQuaternion&&(p=t.rotationQuaternion.clone()),d=t.scaling.clone();for(var m=t.getIndices(),g=t.getVerticesData(Sn.b.PositionKind),_=t.getVerticesData(Sn.b.NormalKind),v=t.getVerticesData(Sn.b.UVKind),y=t.subMeshes,b=0,E=y.length;b<E;b++)for(var x=y[b].indexStart,T=y[b].indexCount+y[b].indexStart;x<T;x+=3){l=[];for(var S=0;S<3;S++){var A=new o.x(_[3*m[x+S]],_[3*m[x+S]+1],_[3*m[x+S]+2]);i=new o.w(v[2*m[x+S]],v[2*m[x+S]+1]);var P=new o.x(g[3*m[x+S]],g[3*m[x+S]+1],g[3*m[x+S]+2]);a=o.x.TransformCoordinates(P,u),r=o.x.TransformNormal(A,u),n=new ko(a,r,i),l.push(n)}(s=new Go(l,{subMeshId:b,meshId:Uo,materialIndex:y[b].materialIndex})).plane&&f.push(s)}var M=e.FromPolygons(f);return M.matrix=u,M.position=c,M.rotation=h,M.scaling=d,M.rotationQuaternion=p,Uo++,M},e.FromPolygons=function(t){var n=new e;return n.polygons=t,n},e.prototype.clone=function(){var t=new e;return t.polygons=this.polygons.map(function(e){return e.clone()}),t.copyTransformAttributes(this),t},e.prototype.union=function(t){var n=new zo(this.clone().polygons),r=new zo(t.clone().polygons);return n.clipTo(r),r.clipTo(n),r.invert(),r.clipTo(n),r.invert(),n.build(r.allPolygons()),e.FromPolygons(n.allPolygons()).copyTransformAttributes(this)},e.prototype.unionInPlace=function(e){var t=new zo(this.polygons),n=new zo(e.polygons);t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),this.polygons=t.allPolygons()},e.prototype.subtract=function(t){var n=new zo(this.clone().polygons),r=new zo(t.clone().polygons);return n.invert(),n.clipTo(r),r.clipTo(n),r.invert(),r.clipTo(n),r.invert(),n.build(r.allPolygons()),n.invert(),e.FromPolygons(n.allPolygons()).copyTransformAttributes(this)},e.prototype.subtractInPlace=function(e){var t=new zo(this.polygons),n=new zo(e.polygons);t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),this.polygons=t.allPolygons()},e.prototype.intersect=function(t){var n=new zo(this.clone().polygons),r=new zo(t.clone().polygons);return n.invert(),r.clipTo(n),r.invert(),n.clipTo(r),r.clipTo(n),n.build(r.allPolygons()),n.invert(),e.FromPolygons(n.allPolygons()).copyTransformAttributes(this)},e.prototype.intersectInPlace=function(e){var t=new zo(this.polygons),n=new zo(e.polygons);t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),this.polygons=t.allPolygons()},e.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},e.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},e.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},e.prototype.buildMeshGeometry=function(e,t,n){var r=this.matrix.clone();r.invert();var i,a,s,l=new fe.a(e,t),u=[],c=[],h=[],d=[],f=o.x.Zero(),p=o.x.Zero(),m=o.w.Zero(),g=this.polygons,_=[0,0,0],v={},y=0,b={};n&&g.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var E=0,x=g.length;E<x;E++){b[(i=g[E]).shared.meshId]||(b[i.shared.meshId]={}),b[i.shared.meshId][i.shared.subMeshId]||(b[i.shared.meshId][i.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:i.shared.materialIndex}),s=b[i.shared.meshId][i.shared.subMeshId];for(var T=2,S=i.vertices.length;T<S;T++){_[0]=0,_[1]=T-1,_[2]=T;for(var A=0;A<3;A++){f.copyFrom(i.vertices[_[A]].pos),p.copyFrom(i.vertices[_[A]].normal),m.copyFrom(i.vertices[_[A]].uv);var P=o.x.TransformCoordinates(f,r),M=o.x.TransformNormal(p,r);void 0!==(a=v[P.x+","+P.y+","+P.z])&&h[3*a]===M.x&&h[3*a+1]===M.y&&h[3*a+2]===M.z&&d[2*a]===m.x&&d[2*a+1]===m.y||(u.push(P.x,P.y,P.z),d.push(m.x,m.y),h.push(p.x,p.y,p.z),a=v[P.x+","+P.y+","+P.z]=u.length/3-1),c.push(a),s.indexStart=Math.min(y,s.indexStart),s.indexEnd=Math.max(y,s.indexEnd),y++}}}if(l.setVerticesData(Sn.b.PositionKind,u),l.setVerticesData(Sn.b.NormalKind,h),l.setVerticesData(Sn.b.UVKind,d),l.setIndices(c,null),n){var R,C=0;for(var w in l.subMeshes=new Array,b){for(var O in R=-1,b[w])s=b[w][O],Bo.b.CreateFromIndices(s.materialIndex+C,s.indexStart,s.indexEnd-s.indexStart+1,l),R=Math.max(s.materialIndex,R);C+=++R}}return l},e.prototype.toMesh=function(e,t,n,r){var i=this.buildMeshGeometry(e,n,r);return i.material=t,i.position.copyFrom(this.position),i.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(i.rotationQuaternion=this.rotationQuaternion.clone()),i.scaling.copyFrom(this.scaling),i.computeWorldMatrix(!0),i},e}(),Ho=function(e){function t(t,n,r,i,a,s){void 0===i&&(i=1),void 0===a&&(a=60),void 0===s&&(s=!0);var l=e.call(this,t,r)||this;l._sectionPolygonPointsCount=4,l._running=!1,l._autoStart=s,l._generator=n,l._diameter=i,l._length=a,l._sectionVectors=[],l._sectionNormalVectors=[];for(var u=0;u<l._sectionPolygonPointsCount;u++)l._sectionVectors[u]=o.x.Zero(),l._sectionNormalVectors[u]=o.x.Zero();return l._createMesh(),l}return u.d(t,e),t.prototype.getClassName=function(){return"TrailMesh"},t.prototype._createMesh=function(){var e=new Tn.a,t=[],n=[],r=[],i=o.x.Zero();this._generator._boundingInfo&&(i=this._generator._boundingInfo.boundingBox.centerWorld);for(var a=2*Math.PI/this._sectionPolygonPointsCount,s=0;s<this._sectionPolygonPointsCount;s++)t.push(i.x+Math.cos(s*a)*this._diameter,i.y+Math.sin(s*a)*this._diameter,i.z);for(s=1;s<=this._length;s++){for(var l=0;l<this._sectionPolygonPointsCount;l++)t.push(i.x+Math.cos(l*a)*this._diameter,i.y+Math.sin(l*a)*this._diameter,i.z);var u=t.length/3-2*this._sectionPolygonPointsCount;for(l=0;l<this._sectionPolygonPointsCount-1;l++)r.push(u+l,u+l+this._sectionPolygonPointsCount,u+l+this._sectionPolygonPointsCount+1),r.push(u+l,u+l+this._sectionPolygonPointsCount+1,u+l+1);r.push(u+this._sectionPolygonPointsCount-1,u+this._sectionPolygonPointsCount-1+this._sectionPolygonPointsCount,u+this._sectionPolygonPointsCount),r.push(u+this._sectionPolygonPointsCount-1,u+this._sectionPolygonPointsCount,u)}Tn.a.ComputeNormals(t,r,n),e.positions=t,e.normals=n,e.indices=r,e.applyToMesh(this,!0),this._autoStart&&this.start()},t.prototype.start=function(){var e=this;this._running||(this._running=!0,this._beforeRenderObserver=this.getScene().onBeforeRenderObservable.add(function(){e.update()}))},t.prototype.stop=function(){this._beforeRenderObserver&&this._running&&(this._running=!1,this.getScene().onBeforeRenderObservable.remove(this._beforeRenderObserver))},t.prototype.update=function(){var e=this.getVerticesData(Sn.b.PositionKind),t=this.getVerticesData(Sn.b.NormalKind),n=this._generator.getWorldMatrix();if(e&&t){for(var r=3*this._sectionPolygonPointsCount;r<e.length;r++)e[r-3*this._sectionPolygonPointsCount]=e[r]-t[r]/this._length*this._diameter;for(r=3*this._sectionPolygonPointsCount;r<t.length;r++)t[r-3*this._sectionPolygonPointsCount]=t[r];var i=e.length-3*this._sectionPolygonPointsCount,a=2*Math.PI/this._sectionPolygonPointsCount;for(r=0;r<this._sectionPolygonPointsCount;r++)this._sectionVectors[r].copyFromFloats(Math.cos(r*a)*this._diameter,Math.sin(r*a)*this._diameter,0),this._sectionNormalVectors[r].copyFromFloats(Math.cos(r*a),Math.sin(r*a),0),o.x.TransformCoordinatesToRef(this._sectionVectors[r],n,this._sectionVectors[r]),o.x.TransformNormalToRef(this._sectionNormalVectors[r],n,this._sectionNormalVectors[r]);for(r=0;r<this._sectionPolygonPointsCount;r++)e[i+3*r]=this._sectionVectors[r].x,e[i+3*r+1]=this._sectionVectors[r].y,e[i+3*r+2]=this._sectionVectors[r].z,t[i+3*r]=this._sectionNormalVectors[r].x,t[i+3*r+1]=this._sectionNormalVectors[r].y,t[i+3*r+2]=this._sectionNormalVectors[r].z;this.updateVerticesData(Sn.b.PositionKind,e,!0,!1),this.updateVerticesData(Sn.b.NormalKind,t,!0,!1)}},t.prototype.clone=function(e,n){return void 0===e&&(e=""),new t(e,void 0===n?this._generator:n,this.getScene(),this._diameter,this._length,this._autoStart)},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t)},t.Parse=function(e,n){return new t(e.name,e._generator,n,e._diameter,e._length,e._autoStart)},t}(fe.a),Wo=n(111),Xo=n(72);Tn.a.CreateDisc=function(e){var t=new Array,n=new Array,r=new Array,i=new Array,o=e.radius||.5,a=e.tessellation||64,s=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,l=0===e.sideOrientation?0:e.sideOrientation||Tn.a.DEFAULTSIDE;t.push(0,0,0),i.push(.5,.5);for(var u=2*Math.PI*s,c=u/a,h=0;h<u;h+=c){var d=Math.cos(h),f=Math.sin(h),p=(d+1)/2,m=(1-f)/2;t.push(o*d,o*f,0),i.push(p,m)}1===s&&(t.push(t[3],t[4],t[5]),i.push(i[2],i[3]));for(var g=t.length/3,_=1;_<g-1;_++)n.push(_+1,0,_);Tn.a.ComputeNormals(t,n,r),Tn.a._ComputeSides(l,t,n,r,i,e.frontUVs,e.backUVs);var v=new Tn.a;return v.indices=n,v.positions=t,v.normals=r,v.uvs=i,v},fe.a.CreateDisc=function(e,t,n,r,i,o){void 0===r&&(r=null);var a={radius:t,tessellation:n,sideOrientation:o,updatable:i};return Yo.CreateDisc(e,a,r)};var Yo=function(){function e(){}return e.CreateDisc=function(e,t,n){void 0===n&&(n=null);var r=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Tn.a.CreateDisc(t).applyToMesh(r,t.updatable),r},e}();Tn.a.CreateTorusKnot=function(e){var t,n,r=new Array,i=new Array,a=new Array,s=new Array,l=e.radius||2,u=e.tube||.5,c=e.radialSegments||32,h=e.tubularSegments||32,d=e.p||2,f=e.q||3,p=0===e.sideOrientation?0:e.sideOrientation||Tn.a.DEFAULTSIDE,m=function(e){var t=Math.cos(e),n=Math.sin(e),r=f/d*e,i=Math.cos(r),a=l*(2+i)*.5*t,s=l*(2+i)*n*.5,u=l*Math.sin(r)*.5;return new o.x(a,s,u)};for(t=0;t<=c;t++){var g=t%c/c*2*d*Math.PI,_=m(g),v=m(g+.01),y=v.subtract(_),b=v.add(_),E=o.x.Cross(y,b);for(b=o.x.Cross(E,y),E.normalize(),b.normalize(),n=0;n<h;n++){var x=n%h/h*2*Math.PI,T=-u*Math.cos(x),S=u*Math.sin(x);i.push(_.x+T*b.x+S*E.x),i.push(_.y+T*b.y+S*E.y),i.push(_.z+T*b.z+S*E.z),s.push(t/c),s.push(n/h)}}for(t=0;t<c;t++)for(n=0;n<h;n++){var A=(n+1)%h,P=t*h+n,M=(t+1)*h+n,R=(t+1)*h+A,C=t*h+A;r.push(C),r.push(M),r.push(P),r.push(C),r.push(R),r.push(M)}Tn.a.ComputeNormals(i,r,a),Tn.a._ComputeSides(p,i,r,a,s,e.frontUVs,e.backUVs);var w=new Tn.a;return w.indices=r,w.positions=i,w.normals=a,w.uvs=s,w},fe.a.CreateTorusKnot=function(e,t,n,r,i,o,a,s,l,u){var c={radius:t,tube:n,radialSegments:r,tubularSegments:i,p:o,q:a,sideOrientation:u,updatable:l};return Ko.CreateTorusKnot(e,c,s)};var Ko=function(){function e(){}return e.CreateTorusKnot=function(e,t,n){var r=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Tn.a.CreateTorusKnot(t).applyToMesh(r,t.updatable),r},e}(),qo=function(e){function t(t,n){var r=e.call(this,t.x,t.y)||this;return r.index=n,r}return u.d(t,e),t}(o.w),Qo=function(){function e(){this.elements=new Array}return e.prototype.add=function(e){var t=this,n=new Array;return e.forEach(function(e){if(0===n.length||!e.equalsWithEpsilon(n[0])){var r=new qo(e,t.elements.length);n.push(r),t.elements.push(r)}}),n},e.prototype.computeBounds=function(){var e=new o.w(this.elements[0].x,this.elements[0].y),t=new o.w(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(n){n.x<e.x?e.x=n.x:n.x>t.x&&(t.x=n.x),n.y<e.y?e.y=n.y:n.y>t.y&&(t.y=n.y)}),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}},e}(),Zo=function(){function e(){}return e.Rectangle=function(e,t,n,r){return[new o.w(e,t),new o.w(n,t),new o.w(n,r),new o.w(e,r)]},e.Circle=function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=32);for(var i=new Array,a=0,s=2*Math.PI/r,l=0;l<r;l++)i.push(new o.w(t+Math.cos(a)*e,n+Math.sin(a)*e)),a-=s;return i},e.Parse=function(e){var t,n=e.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),r=[];for(t=0;t<(2147483646&n.length);t+=2)r.push(new o.w(n[t],n[t+1]));return r},e.StartingAt=function(e,t){return o.l.StartingAt(e,t)},e}(),Jo=function(){function e(e,t,n,r){var i;void 0===r&&(r=earcut),this._points=new Qo,this._outlinepoints=new Qo,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=e,this._scene=n||ge.b.LastCreatedScene,i=t instanceof o.l?t.getPoints():t,this._addToepoint(i),this._points.add(i),this._outlinepoints.add(i),void 0===this.bjsEarcut&&p.a.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this._epoints.push(r.x,r.y)}},e.prototype.addHole=function(e){this._points.add(e);var t=new Qo;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},e.prototype.build=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=0);var n=new fe.a(this._name,this._scene),r=this.buildVertexData(t);return n.setVerticesData(Sn.b.PositionKind,r.positions,e),n.setVerticesData(Sn.b.NormalKind,r.normals,e),n.setVerticesData(Sn.b.UVKind,r.uvs,e),n.setIndices(r.indices),n},e.prototype.buildVertexData=function(e){var t=this;void 0===e&&(e=0);var n=new Tn.a,r=new Array,i=new Array,o=new Array,a=this._points.computeBounds();this._points.elements.forEach(function(e){r.push(0,1,0),i.push(e.x,0,e.y),o.push((e.x-a.min.x)/a.width,(e.y-a.min.y)/a.height)});for(var s=new Array,l=this.bjsEarcut(this._epoints,this._eholes,2),u=0;u<l.length;u++)s.push(l[u]);if(e>0){var c=i.length/3;this._points.elements.forEach(function(t){r.push(0,-1,0),i.push(t.x,-e,t.y),o.push(1-(t.x-a.min.x)/a.width,1-(t.y-a.min.y)/a.height)});var h=s.length;for(u=0;u<h;u+=3){var d=s[u+0],f=s[u+1],p=s[u+2];s.push(p+c),s.push(f+c),s.push(d+c)}this.addSide(i,r,o,s,a,this._outlinepoints,e,!1),this._holes.forEach(function(n){t.addSide(i,r,o,s,a,n,e,!0)})}return n.indices=s,n.positions=i,n.normals=r,n.uvs=o,n},e.prototype.addSide=function(e,t,n,r,i,a,s,l){for(var u=e.length/3,c=0,h=0;h<a.elements.length;h++){var d,f=a.elements[h];d=h+1>a.elements.length-1?a.elements[0]:a.elements[h+1],e.push(f.x,0,f.y),e.push(f.x,-s,f.y),e.push(d.x,0,d.y),e.push(d.x,-s,d.y);var p=new o.x(f.x,0,f.y),m=new o.x(d.x,0,d.y).subtract(p),g=new o.x(0,1,0),_=o.x.Cross(m,g);_=_.normalize(),n.push(c/i.width,0),n.push(c/i.width,1),c+=m.length(),n.push(c/i.width,0),n.push(c/i.width,1),l?(t.push(_.x,_.y,_.z),t.push(_.x,_.y,_.z),t.push(_.x,_.y,_.z),t.push(_.x,_.y,_.z),r.push(u),r.push(u+2),r.push(u+1),r.push(u+1),r.push(u+2),r.push(u+3)):(t.push(-_.x,-_.y,-_.z),t.push(-_.x,-_.y,-_.z),t.push(-_.x,-_.y,-_.z),t.push(-_.x,-_.y,-_.z),r.push(u),r.push(u+1),r.push(u+2),r.push(u+1),r.push(u+3),r.push(u+2)),u+=4}},e}();Tn.a.CreatePolygon=function(e,t,n,r,i,a){for(var s=n||new Array(3),l=r,u=[],c=0;c<3;c++)void 0===s[c]&&(s[c]=new o.y(0,0,1,1)),l&&void 0===l[c]&&(l[c]=new o.f(1,1,1,1));for(var h=e.getVerticesData(Sn.b.PositionKind),d=e.getVerticesData(Sn.b.NormalKind),f=e.getVerticesData(Sn.b.UVKind),p=e.getIndices(),m=0,g=0,_=0;_<d.length;_+=3)Math.abs(d[_+1])<.001&&(g=1),Math.abs(d[_+1]-1)<.001&&(g=0),Math.abs(d[_+1]+1)<.001&&(g=2),f[2*(m=_/3)]=(1-f[2*m])*s[g].x+f[2*m]*s[g].z,f[2*m+1]=(1-f[2*m+1])*s[g].y+f[2*m+1]*s[g].w,l&&u.push(l[g].r,l[g].g,l[g].b,l[g].a);Tn.a._ComputeSides(t,h,p,d,f,i,a);var v=new Tn.a;if(v.indices=p,v.positions=h,v.normals=d,v.uvs=f,l){var y=t===Tn.a.DOUBLESIDE?u.concat(u):u;v.colors=y}return v},fe.a.CreatePolygon=function(e,t,n,r,i,o,a){void 0===a&&(a=earcut);var s={shape:t,holes:r,updatable:i,sideOrientation:o};return $o.CreatePolygon(e,s,n,a)},fe.a.ExtrudePolygon=function(e,t,n,r,i,o,a,s){void 0===s&&(s=earcut);var l={shape:t,holes:i,depth:n,updatable:o,sideOrientation:a};return $o.ExtrudePolygon(e,l,r,s)};var $o=function(){function e(){}return e.CreatePolygon=function(e,t,n,r){void 0===n&&(n=null),void 0===r&&(r=earcut),t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation);for(var i=t.shape,a=t.holes||[],s=t.depth||0,l=[],u=[],c=0;c<i.length;c++)l[c]=new o.w(i[c].x,i[c].z);l[0].equalsWithEpsilon(l[l.length-1],1e-8)&&l.pop();for(var h=new Jo(e,l,n||P.a.LastCreatedScene,r),d=0;d<a.length;d++){u=[];for(var f=0;f<a[d].length;f++)u.push(new o.w(a[d][f].x,a[d][f].z));h.addHole(u)}var p=h.build(t.updatable,s);return p._originalBuilderSideOrientation=t.sideOrientation,Tn.a.CreatePolygon(p,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs).applyToMesh(p,t.updatable),p},e.ExtrudePolygon=function(t,n,r,i){return void 0===r&&(r=null),void 0===i&&(i=earcut),e.CreatePolygon(t,n,r,i)},e}();fe.a.CreateLathe=function(e,t,n,r,i,o,a){var s={shape:t,radius:n,tessellation:r,sideOrientation:a,updatable:o};return ea.CreateLathe(e,s,i)};var ea=function(){function e(){}return e.CreateLathe=function(e,t,n){void 0===n&&(n=null);var r,i=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,a=void 0===t.closed||t.closed,s=t.shape,l=t.radius||1,u=t.tessellation||64,c=t.clip||0,h=t.updatable,d=fe.a._GetDefaultSideOrientation(t.sideOrientation),f=t.cap||fe.a.NO_CAP,p=2*Math.PI,m=new Array,g=t.invertUV||!1,_=0,v=0,y=p/u*i,b=new Array;for(_=0;_<=u-c;_++){for(b=[],f!=fe.a.CAP_START&&f!=fe.a.CAP_ALL||(b.push(new o.x(0,s[0].y,0)),b.push(new o.x(Math.cos(_*y)*s[0].x*l,s[0].y,Math.sin(_*y)*s[0].x*l))),v=0;v<s.length;v++)r=new o.x(Math.cos(_*y)*s[v].x*l,s[v].y,Math.sin(_*y)*s[v].x*l),b.push(r);f!=fe.a.CAP_END&&f!=fe.a.CAP_ALL||(b.push(new o.x(Math.cos(_*y)*s[s.length-1].x*l,s[s.length-1].y,Math.sin(_*y)*s[s.length-1].x*l)),b.push(new o.x(0,s[s.length-1].y,0))),m.push(b)}return to.CreateRibbon(e,{pathArray:m,closeArray:a,sideOrientation:d,updatable:h,invertUV:g,frontUVs:t.frontUVs,backUVs:t.backUVs},n)},e}();fe.a.CreateTube=function(e,t,n,r,i,o,a,s,l,u){var c={path:t,radius:n,tessellation:r,radiusFunction:i,arc:1,cap:o,updatable:s,sideOrientation:l,instance:u};return ta.CreateTube(e,c,a)};var ta=function(){function e(){}return e.CreateTube=function(e,t,n){void 0===n&&(n=null);var r=t.path,i=t.instance,a=1;void 0!==t.radius?a=t.radius:i&&(a=i._creationDataStorage.radius);var s=t.tessellation||64,l=t.radiusFunction||null,u=t.cap||fe.a.NO_CAP,c=t.invertUV||!1,h=t.updatable,d=fe.a._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;var f,p,m=function(e,t,n,r,i,a,s,l){for(var u,c,h,d,f=t.getTangents(),p=t.getNormals(),m=t.getDistances(),g=2*Math.PI/i*l,_=a||function(){return r},v=o.t.Matrix[0],y=s===fe.a.NO_CAP||s===fe.a.CAP_END?0:2,b=0;b<e.length;b++){c=_(b,m[b]),u=Array(),h=p[b];for(var E=0;E<i;E++)o.j.RotationAxisToRef(f[b],g*E,v),d=u[E]?u[E]:o.x.Zero(),o.x.TransformCoordinatesToRef(h,v,d),d.scaleInPlace(c).addInPlace(e[b]),u[E]=d;n[y]=u,y++}var x=function(t,n){for(var r=Array(),i=0;i<t;i++)r.push(e[n]);return r};switch(s){case fe.a.NO_CAP:break;case fe.a.CAP_START:n[0]=x(i,0),n[1]=n[2].slice(0);break;case fe.a.CAP_END:n[y]=n[y-1].slice(0),n[y+1]=x(i,e.length-1);break;case fe.a.CAP_ALL:n[0]=x(i,0),n[1]=n[2].slice(0),n[y]=n[y-1].slice(0),n[y+1]=x(i,e.length-1)}return n};if(i){var g=i._creationDataStorage,_=t.arc||g.arc;return p=m(r,f=g.path3D.update(r),g.pathArray,a,g.tessellation,l,g.cap,_),i=to.CreateRibbon("",{pathArray:p,instance:i}),g.path3D=f,g.pathArray=p,g.arc=_,g.radius=a,i}p=m(r,f=new o.m(r),new Array,a,s,l,u=u<0||u>3?0:u,t.arc);var v=to.CreateRibbon(e,{pathArray:p,closePath:!0,closeArray:!1,updatable:h,sideOrientation:d,invertUV:c,frontUVs:t.frontUVs,backUVs:t.backUVs},n);return v._creationDataStorage.pathArray=p,v._creationDataStorage.path3D=f,v._creationDataStorage.tessellation=s,v._creationDataStorage.cap=u,v._creationDataStorage.arc=t.arc,v._creationDataStorage.radius=a,v},e}();Tn.a.CreateIcoSphere=function(e){var t,n=e.sideOrientation||Tn.a.DEFAULTSIDE,r=e.radius||1,i=void 0===e.flat||e.flat,a=e.subdivisions||4,s=e.radiusX||r,l=e.radiusY||r,u=e.radiusZ||r,c=(1+Math.sqrt(5))/2,h=[-1,c,-0,1,c,0,-1,-c,0,1,-c,0,0,-1,-c,0,1,-c,0,-1,c,0,1,c,c,0,1,c,0,-1,-c,0,1,-c,0,-1],d=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],f=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],p=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],m=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],g=new Array,_=new Array,v=new Array,y=new Array,b=0,E=new Array(3),x=new Array(3);for(t=0;t<3;t++)E[t]=o.x.Zero(),x[t]=o.w.Zero();for(var T=0;T<20;T++){for(t=0;t<3;t++){var S=d[3*T+t];E[t].copyFromFloats(h[3*f[S]],h[3*f[S]+1],h[3*f[S]+2]),E[t].normalize().scaleInPlace(r),x[t].copyFromFloats(p[2*S]*(138/1024)+60/1024+m[T]*(-40/1024),p[2*S+1]*(239/1024)+26/1024+m[T]*(20/1024))}for(var A=function(e,t,n,r){var c,h=o.x.Lerp(E[0],E[2],t/a),d=o.x.Lerp(E[1],E[2],t/a),f=a===t?E[2]:o.x.Lerp(h,d,e/(a-t));if(f.normalize(),i){var p=o.x.Lerp(E[0],E[2],r/a),m=o.x.Lerp(E[1],E[2],r/a);c=o.x.Lerp(p,m,n/(a-r))}else c=new o.x(f.x,f.y,f.z);c.x/=s,c.y/=l,c.z/=u,c.normalize();var T=o.w.Lerp(x[0],x[2],t/a),S=o.w.Lerp(x[1],x[2],t/a),A=a===t?x[2]:o.w.Lerp(T,S,e/(a-t));_.push(f.x*s,f.y*l,f.z*u),v.push(c.x,c.y,c.z),y.push(A.x,A.y),g.push(b),b++},P=0;P<a;P++)for(var M=0;M+P<a;M++)A(M,P,M+1/3,P+1/3),A(M+1,P,M+1/3,P+1/3),A(M,P+1,M+1/3,P+1/3),M+P+1<a&&(A(M+1,P,M+2/3,P+2/3),A(M+1,P+1,M+2/3,P+2/3),A(M,P+1,M+2/3,P+2/3))}Tn.a._ComputeSides(n,_,g,v,y,e.frontUVs,e.backUVs);var R=new Tn.a;return R.indices=g,R.positions=_,R.normals=v,R.uvs=y,R},fe.a.CreateIcoSphere=function(e,t,n){return na.CreateIcoSphere(e,t,n)};var na=function(){function e(){}return e.CreateIcoSphere=function(e,t,n){void 0===n&&(n=null);var r=new fe.a(e,n);return t.sideOrientation=fe.a._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,Tn.a.CreateIcoSphere(t).applyToMesh(r,t.updatable),r},e}();fe.a.CreateDecal=function(e,t,n,r,i,o){var a={position:n,normal:r,size:i,angle:o};return ia.CreateDecal(e,t,a)};var ra,ia=function(){function e(){}return e.CreateDecal=function(e,t,n){var r=t.getIndices(),i=t.getVerticesData(Sn.b.PositionKind),a=t.getVerticesData(Sn.b.NormalKind),s=n.position||o.x.Zero(),l=n.normal||o.x.Up(),u=n.size||o.x.One(),c=n.angle||0;if(!l){var h=new o.x(0,0,1),d=t.getScene().activeCamera,f=o.x.TransformCoordinates(h,d.getWorldMatrix());l=d.globalPosition.subtract(f)}var p=-Math.atan2(l.z,l.x)-Math.PI/2,m=Math.sqrt(l.x*l.x+l.z*l.z),g=Math.atan2(l.y,m),_=o.j.RotationYawPitchRoll(p,g,c).multiply(o.j.Translation(s.x,s.y,s.z)),v=o.j.Invert(_),y=t.getWorldMatrix().multiply(v),b=new Tn.a;b.indices=[],b.positions=[],b.normals=[],b.uvs=[];for(var E=0,x=function(e){var t=new o.p;if(!r||!i||!a)return t;var n=r[e];return t.position=new o.x(i[3*n],i[3*n+1],i[3*n+2]),t.position=o.x.TransformCoordinates(t.position,y),t.normal=new o.x(a[3*n],a[3*n+1],a[3*n+2]),t.normal=o.x.TransformNormal(t.normal,y),t},T=function(e,t){if(0===e.length)return e;for(var n=.5*Math.abs(o.x.Dot(u,t)),r=function(e,r){var i=o.x.GetClipFactor(e.position,r.position,t,n);return new o.p(o.x.Lerp(e.position,r.position,i),o.x.Lerp(e.normal,r.normal,i))},i=new Array,a=0;a<e.length;a+=3){var s,l,c,h=null,d=null,f=null,p=null;switch(((s=o.x.Dot(e[a].position,t)-n>0)?1:0)+((l=o.x.Dot(e[a+1].position,t)-n>0)?1:0)+((c=o.x.Dot(e[a+2].position,t)-n>0)?1:0)){case 0:i.push(e[a]),i.push(e[a+1]),i.push(e[a+2]);break;case 1:if(s&&(h=e[a+1],d=e[a+2],f=r(e[a],h),p=r(e[a],d)),l){h=e[a],d=e[a+2],f=r(e[a+1],h),p=r(e[a+1],d),i.push(f),i.push(d.clone()),i.push(h.clone()),i.push(d.clone()),i.push(f.clone()),i.push(p);break}c&&(h=e[a],d=e[a+1],f=r(e[a+2],h),p=r(e[a+2],d)),h&&d&&f&&p&&(i.push(h.clone()),i.push(d.clone()),i.push(f),i.push(p),i.push(f.clone()),i.push(d.clone()));break;case 2:s||(d=r(h=e[a].clone(),e[a+1]),f=r(h,e[a+2]),i.push(h),i.push(d),i.push(f)),l||(d=r(h=e[a+1].clone(),e[a+2]),f=r(h,e[a]),i.push(h),i.push(d),i.push(f)),c||(d=r(h=e[a+2].clone(),e[a]),f=r(h,e[a+1]),i.push(h),i.push(d),i.push(f))}}return i},S=0;S<r.length;S+=3){var A=new Array;if(A.push(x(S)),A.push(x(S+1)),A.push(x(S+2)),A=T(A,new o.x(1,0,0)),A=T(A,new o.x(-1,0,0)),A=T(A,new o.x(0,1,0)),A=T(A,new o.x(0,-1,0)),A=T(A,new o.x(0,0,1)),0!==(A=T(A,new o.x(0,0,-1))).length)for(var P=0;P<A.length;P++){var M=A[P];b.indices.push(E),M.position.toArray(b.positions,3*E),M.normal.toArray(b.normals,3*E),b.uvs.push(.5+M.position.x/u.x),b.uvs.push(.5+M.position.y/u.y),E++}}var R=new fe.a(e,t.getScene());return b.applyToMesh(R),R.position=s.clone(),R.rotation=new o.x(g,p,c),R},e}(),oa=function(){function e(){}return e.CreateBox=function(e,t,n){return void 0===n&&(n=null),xr.a.CreateBox(e,t,n)},e.CreateSphere=function(e,t,n){return void 0===n&&(n=null),Pr.a.CreateSphere(e,t,n)},e.CreateDisc=function(e,t,n){return void 0===n&&(n=null),Yo.CreateDisc(e,t,n)},e.CreateIcoSphere=function(e,t,n){return void 0===n&&(n=null),na.CreateIcoSphere(e,t,n)},e.CreateRibbon=function(e,t,n){return void 0===n&&(n=null),to.CreateRibbon(e,t,n)},e.CreateCylinder=function(e,t,n){return void 0===n&&(n=null),Cn.a.CreateCylinder(e,t,n)},e.CreateTorus=function(e,t,n){return void 0===n&&(n=null),Rn.CreateTorus(e,t,n)},e.CreateTorusKnot=function(e,t,n){return void 0===n&&(n=null),Ko.CreateTorusKnot(e,t,n)},e.CreateLineSystem=function(e,t,n){return Mr.a.CreateLineSystem(e,t,n)},e.CreateLines=function(e,t,n){return void 0===n&&(n=null),Mr.a.CreateLines(e,t,n)},e.CreateDashedLines=function(e,t,n){return void 0===n&&(n=null),Mr.a.CreateDashedLines(e,t,n)},e.ExtrudeShape=function(e,t,n){return void 0===n&&(n=null),no.ExtrudeShape(e,t,n)},e.ExtrudeShapeCustom=function(e,t,n){return void 0===n&&(n=null),no.ExtrudeShapeCustom(e,t,n)},e.CreateLathe=function(e,t,n){return void 0===n&&(n=null),ea.CreateLathe(e,t,n)},e.CreatePlane=function(e,t,n){return void 0===n&&(n=null),Zr.a.CreatePlane(e,t,n)},e.CreateGround=function(e,t,n){return void 0===n&&(n=null),Pn.CreateGround(e,t,n)},e.CreateTiledGround=function(e,t,n){return void 0===n&&(n=null),Pn.CreateTiledGround(e,t,n)},e.CreateGroundFromHeightMap=function(e,t,n,r){return void 0===r&&(r=null),Pn.CreateGroundFromHeightMap(e,t,n,r)},e.CreatePolygon=function(e,t,n,r){return void 0===n&&(n=null),void 0===r&&(r=earcut),$o.CreatePolygon(e,t,n,r)},e.ExtrudePolygon=function(e,t,n,r){return void 0===n&&(n=null),void 0===r&&(r=earcut),$o.ExtrudePolygon(e,t,n,r)},e.CreateTube=function(e,t,n){return void 0===n&&(n=null),ta.CreateTube(e,t,n)},e.CreatePolyhedron=function(e,t,n){return void 0===n&&(n=null),Ir.CreatePolyhedron(e,t,n)},e.CreateDecal=function(e,t,n){return ia.CreateDecal(e,t,n)},e}(),aa=function(e,t,n){this.quality=e,this.distance=t,this.optimizeMesh=n},sa=function(){function e(){this.running=!1,this._simplificationArray=[]}return e.prototype.addTask=function(e){this._simplificationArray.push(e)},e.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},e.prototype.runSimplification=function(e){var t=this;if(e.parallelProcessing)e.settings.forEach(function(n){t.getSimplifier(e).simplify(n,function(r){e.mesh.addLODLevel(n.distance,r),r.isVisible=!0,n.quality===e.settings[e.settings.length-1].quality&&e.successCallback&&e.successCallback(),t.executeNext()})});else{var n=this.getSimplifier(e);ye.a.Run(e.settings.length,function(t){var r,i;r=e.settings[t.index],i=function(){t.executeNext()},n.simplify(r,function(t){e.mesh.addLODLevel(r.distance,t),t.isVisible=!0,i()})},function(){e.successCallback&&e.successCallback(),t.executeNext()})}},e.prototype.getSimplifier=function(e){switch(e.simplificationType){case ra.QUADRATIC:default:return new da(e.mesh)}},e}();!function(e){e[e.QUADRATIC=0]="QUADRATIC"}(ra||(ra={}));var la=function(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0},ua=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new ca,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}(),ca=function(){function e(e){this.data=new Array(10);for(var t=0;t<10;++t)e&&e[t]?this.data[t]=e[t]:this.data[t]=0}return e.prototype.det=function(e,t,n,r,i,o,a,s,l){return this.data[e]*this.data[i]*this.data[l]+this.data[n]*this.data[r]*this.data[s]+this.data[t]*this.data[o]*this.data[a]-this.data[n]*this.data[i]*this.data[a]-this.data[e]*this.data[o]*this.data[s]-this.data[t]*this.data[r]*this.data[l]},e.prototype.addInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var n=new e,r=0;r<10;++r)n.data[r]=this.data[r]+t.data[r];return n},e.FromData=function(t,n,r,i){return new e(e.DataFromNumbers(t,n,r,i))},e.DataFromNumbers=function(e,t,n,r){return[e*e,e*t,e*n,e*r,t*t,t*n,t*r,n*n,n*r,r*r]},e}(),ha=function(e,t){this.vertexId=e,this.triangleId=t},da=function(){function e(e){this._mesh=e,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=o.h}return e.prototype.simplify=function(e,t){var n=this;this.initDecimatedMesh(),ye.a.Run(this._mesh.subMeshes.length,function(t){n.initWithMesh(t.index,function(){n.runDecimation(e,t.index,function(){t.executeNext()})},e.optimizeMesh)},function(){setTimeout(function(){t(n._reconstructedMesh)},0)})},e.prototype.runDecimation=function(e,t,n){var r=this,i=~~(this.triangles.length*e.quality),a=0,s=this.triangles.length;ye.a.Run(this.decimationIterations,function(e){var t,n;s-a<=i?e.breakLoop():(t=e.index,n=function(){e.executeNext()},setTimeout(function(){t%5==0&&r.updateMesh(0===t);for(var e=0;e<r.triangles.length;++e)r.triangles[e].isDirty=!1;var l=1e-9*Math.pow(t+3,r.aggressiveness);ye.a.SyncAsyncForLoop(r.triangles.length,r.syncIterations,function(e){var t=~~((r.triangles.length/2+e)%r.triangles.length),n=r.triangles[t];if(n&&!(n.error[3]>l||n.deleted||n.isDirty))for(var i=0;i<3;++i)if(n.error[i]<l){var s=[],u=[],c=n.vertices[i],h=n.vertices[(i+1)%3];if(c.isBorder||h.isBorder)continue;var d=o.x.Zero();r.calculateError(c,h,d);var f=new Array;if(r.isFlipped(c,h,d,s,f))continue;if(r.isFlipped(h,c,d,u,f))continue;if(s.indexOf(!0)<0||u.indexOf(!0)<0)continue;var p=new Array;if(f.forEach(function(e){-1===p.indexOf(e)&&(e.deletePending=!0,p.push(e))}),p.length%2!=0)continue;c.q=h.q.add(c.q),c.updatePosition(d);var m=r.references.length;a=r.updateTriangles(c,c,s,a),a=r.updateTriangles(c,h,u,a);var g=r.references.length-m;if(g<=c.triangleCount){if(g)for(var _=0;_<g;_++)r.references[c.triangleStart+_]=r.references[m+_]}else c.triangleStart=m;c.triangleCount=g;break}},n,function(){return s-a<=i})},0))},function(){setTimeout(function(){r.reconstructMesh(t),n()},0)})},e.prototype.initWithMesh=function(e,t,n){var r=this;this.vertices=[],this.triangles=[];var i=this._mesh.getVerticesData(Sn.b.PositionKind),a=this._mesh.getIndices(),s=this._mesh.subMeshes[e],l=[],u=s.verticesCount;ye.a.SyncAsyncForLoop(u,this.syncIterations/4>>0,function(e){if(i){var t=e+s.verticesStart,a=o.x.FromArray(i,3*t),u=function(e){if(n)for(var t=0;t<r.vertices.length;++t)if(r.vertices[t].position.equals(e))return r.vertices[t];return null}(a)||new ua(a,r.vertices.length);u.originalOffsets.push(t),u.id===r.vertices.length&&r.vertices.push(u),l.push(u.id)}},function(){ye.a.SyncAsyncForLoop(s.indexCount/3,r.syncIterations,function(e){if(a){var t=3*(s.indexStart/3+e),n=a[t+0],i=a[t+1],o=a[t+2],u=r.vertices[l[n-s.verticesStart]],c=r.vertices[l[i-s.verticesStart]],h=r.vertices[l[o-s.verticesStart]],d=new la([u,c,h]);d.originalOffset=t,r.triangles.push(d)}},function(){r.init(t)})})},e.prototype.init=function(e){var t=this;ye.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(e){var n=t.triangles[e];n.normal=o.x.Cross(n.vertices[1].position.subtract(n.vertices[0].position),n.vertices[2].position.subtract(n.vertices[0].position)).normalize();for(var r=0;r<3;r++)n.vertices[r].q.addArrayInPlace(ca.DataFromNumbers(n.normal.x,n.normal.y,n.normal.z,-o.x.Dot(n.normal,n.vertices[0].position)))},function(){ye.a.SyncAsyncForLoop(t.triangles.length,t.syncIterations,function(e){for(var n=t.triangles[e],r=0;r<3;++r)n.error[r]=t.calculateError(n.vertices[r],n.vertices[(r+1)%3]);n.error[3]=Math.min(n.error[0],n.error[1],n.error[2])},function(){e()})})},e.prototype.reconstructMesh=function(e){var t,n,r,i=[];for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0;for(t=0;t<this.triangles.length;++t)if(!this.triangles[t].deleted){for(n=this.triangles[t],r=0;r<3;++r)n.vertices[r].triangleCount=1;i.push(n)}var o=this._reconstructedMesh.getVerticesData(Sn.b.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(Sn.b.NormalKind)||[],s=this._reconstructedMesh.getVerticesData(Sn.b.UVKind)||[],l=this._reconstructedMesh.getVerticesData(Sn.b.ColorKind)||[],u=this._mesh.getVerticesData(Sn.b.NormalKind),c=this._mesh.getVerticesData(Sn.b.UVKind),h=this._mesh.getVerticesData(Sn.b.ColorKind),d=0;for(t=0;t<this.vertices.length;++t){var f=this.vertices[t];f.id=d,f.triangleCount&&f.originalOffsets.forEach(function(e){u&&(o.push(f.position.x),o.push(f.position.y),o.push(f.position.z),a.push(u[3*e]),a.push(u[3*e+1]),a.push(u[3*e+2]),c&&c.length&&(s.push(c[2*e]),s.push(c[2*e+1])),h&&h.length&&(l.push(h[4*e]),l.push(h[4*e+1]),l.push(h[4*e+2]),l.push(h[4*e+3])),++d)})}var p=this._reconstructedMesh.getTotalIndices(),m=this._reconstructedMesh.getTotalVertices(),g=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var _=this._reconstructedMesh.getIndices(),v=this._mesh.getIndices();for(t=0;t<i.length;++t)n=i[t],[0,1,2].forEach(function(e){var t=v[n.originalOffset+e],r=n.vertices[e].originalOffsets.indexOf(t);r<0&&(r=0),_.push(n.vertices[e].id+r+m)});this._reconstructedMesh.setIndices(_),this._reconstructedMesh.setVerticesData(Sn.b.PositionKind,o),this._reconstructedMesh.setVerticesData(Sn.b.NormalKind,a),s.length>0&&this._reconstructedMesh.setVerticesData(Sn.b.UVKind,s),l.length>0&&this._reconstructedMesh.setVerticesData(Sn.b.ColorKind,l);var y=this._mesh.subMeshes[e];e>0&&(this._reconstructedMesh.subMeshes=[],g.forEach(function(e){Bo.b.AddToMesh(e.materialIndex,e.verticesStart,e.verticesCount,e.indexStart,e.indexCount,e.getMesh())}),Bo.b.AddToMesh(y.materialIndex,m,d,p,3*i.length,this._reconstructedMesh))},e.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new fe.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},e.prototype.isFlipped=function(e,t,n,r,i){for(var a=0;a<e.triangleCount;++a){var s=this.triangles[this.references[e.triangleStart+a].triangleId];if(!s.deleted){var l=this.references[e.triangleStart+a].vertexId,u=s.vertices[(l+1)%3],c=s.vertices[(l+2)%3];if(u!==t&&c!==t){var h=u.position.subtract(n);h=h.normalize();var d=c.position.subtract(n);if(d=d.normalize(),Math.abs(o.x.Dot(h,d))>.999)return!0;var f=o.x.Cross(h,d).normalize();if(r[a]=!1,o.x.Dot(f,s.normal)<.2)return!0}else r[a]=!0,i.push(s)}}return!1},e.prototype.updateTriangles=function(e,t,n,r){for(var i=r,o=0;o<t.triangleCount;++o){var a=this.references[t.triangleStart+o],s=this.triangles[a.triangleId];s.deleted||(n[o]&&s.deletePending?(s.deleted=!0,i++):(s.vertices[a.vertexId]=e,s.isDirty=!0,s.error[0]=this.calculateError(s.vertices[0],s.vertices[1])+s.borderFactor/2,s.error[1]=this.calculateError(s.vertices[1],s.vertices[2])+s.borderFactor/2,s.error[2]=this.calculateError(s.vertices[2],s.vertices[0])+s.borderFactor/2,s.error[3]=Math.min(s.error[0],s.error[1],s.error[2]),this.references.push(a)))}return i},e.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,n=[],r=[],i=this.vertices[e];for(t=0;t<i.triangleCount;++t)for(var o=this.triangles[this.references[i.triangleStart+t].triangleId],a=0;a<3;a++){for(var s=0,l=o.vertices[a];s<n.length&&r[s]!==l.id;)++s;s===n.length?(n.push(1),r.push(l.id)):n[s]++}for(t=0;t<n.length;++t)1===n[t]?this.vertices[r[t]].isBorder=!0:this.vertices[r[t]].isBorder=!1}},e.prototype.updateMesh=function(e){var t,n,r,i;if(void 0===e&&(e=!1),!e){var o=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||o.push(this.triangles[t]);this.triangles=o}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],r=0;r<3;++r)(i=n.vertices[r]).triangleCount++;var a=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=a,a+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var s=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],r=0;r<3;++r)s[(i=n.vertices[r]).triangleStart+i.triangleCount]=new ha(r,t),i.triangleCount++;this.references=s,e&&this.identifyBorder()},e.prototype.vertexError=function(e,t){var n=t.x,r=t.y,i=t.z;return e.data[0]*n*n+2*e.data[1]*n*r+2*e.data[2]*n*i+2*e.data[3]*n+e.data[4]*r*r+2*e.data[5]*r*i+2*e.data[6]*r+e.data[7]*i*i+2*e.data[8]*i+e.data[9]},e.prototype.calculateError=function(e,t,n){var r=e.q.add(t.q),i=e.isBorder&&t.isBorder,a=0,s=r.det(0,1,2,1,4,5,2,5,7);if(0===s||i){var l=e.position.add(t.position).divide(new o.x(2,2,2)),u=this.vertexError(r,e.position),c=this.vertexError(r,t.position),h=this.vertexError(r,l);(a=Math.min(u,c,h))===u?n&&n.copyFrom(e.position):a===c?n&&n.copyFrom(t.position):n&&n.copyFrom(l)}else n||(n=o.x.Zero()),n.x=-1/s*r.det(1,2,3,4,5,6,5,7,8),n.y=1/s*r.det(0,2,3,1,5,6,2,7,8),n.z=-1/s*r.det(0,1,3,1,4,6,2,5,8),a=this.vertexError(r,n);return a},e}();Object.defineProperty(W.a.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new sa;var e=this._getComponent(Te.a.NAME_SIMPLIFICATIONQUEUE);e||(e=new fa(this),this._addComponent(e))}return this._simplificationQueue},set:function(e){this._simplificationQueue=e},enumerable:!0,configurable:!0}),fe.a.prototype.simplify=function(e,t,n,r){return void 0===t&&(t=!0),void 0===n&&(n=ra.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:e,parallelProcessing:t,mesh:this,simplificationType:n,successCallback:r}),this};var fa=function(){function e(e){this.name=Te.a.NAME_SIMPLIFICATIONQUEUE,this.scene=e}return e.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(Te.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},e}(),pa=n(110),ma=n(78),ga=n(73);ge.b.OfflineProviderFactory=function(e,t,n){return void 0===n&&(n=!1),new va(e,t,n)};var _a,va=function(){function e(t,n,r){var i=this;void 0===r&&(r=!1),this._idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this._callbackManifestChecked=n,this._currentSceneUrl=e._ReturnFullUrlLocation(t),this._db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this._manifestVersionFound=0,this._mustUpdateRessources=!1,this._hasReachedQuota=!1,e.IDBStorageEnabled?r?(this._enableSceneOffline=!0,this._enableTexturesOffline=!0,this._manifestVersionFound=1,ye.h.SetImmediate(function(){i._callbackManifestChecked(!0)})):this._checkManifestFile():this._callbackManifestChecked(!0)}return Object.defineProperty(e.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),e.prototype._checkManifestFile=function(){var t=this,n=function(){t._enableSceneOffline=!1,t._enableTexturesOffline=!1,t._callbackManifestChecked(!1)},r=!1,i=this._currentSceneUrl+".manifest",o=new So.a;navigator.onLine&&(r=!0,i=i+(null==i.match(/\?/)?"?":"&")+Date.now()),o.open("GET",i),o.addEventListener("load",function(){if(200===o.status||e._ValidateXHRData(o,1))try{var r=JSON.parse(o.response);t._enableSceneOffline=r.enableSceneOffline,t._enableTexturesOffline=r.enableTexturesOffline&&e.IsUASupportingBlobStorage,r.version&&!isNaN(parseInt(r.version))&&(t._manifestVersionFound=r.version),t._callbackManifestChecked&&t._callbackManifestChecked(!0)}catch(e){n()}else n()},!1),o.addEventListener("error",function(){if(r){r=!1;var e=t._currentSceneUrl+".manifest";o.open("GET",e),o.send()}else n()},!1);try{o.send()}catch(e){p.a.Error("Error on XHR send request."),this._callbackManifestChecked(!1)}},e.prototype.open=function(e,t){var n=this,r=function(){n._isSupported=!1,t&&t()};if(this._idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this._db)e&&e();else{this._hasReachedQuota=!1,this._isSupported=!0;var i=this._idbFactory.open("babylonjs",1);i.onerror=function(){r()},i.onblocked=function(){p.a.Error("IDB request blocked. Please reload the page."),r()},i.onsuccess=function(){n._db=i.result,e()},i.onupgradeneeded=function(e){if(n._db=e.target.result,n._db)try{n._db.createObjectStore("scenes",{keyPath:"sceneUrl"}),n._db.createObjectStore("versions",{keyPath:"sceneUrl"}),n._db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(e){p.a.Error("Error while creating object stores. Exception: "+e.message),r()}}}else this._isSupported=!1,t&&t()},e.prototype.loadImage=function(t,n){var r=this,i=e._ReturnFullUrlLocation(t),o=function(){r._hasReachedQuota||null===r._db?n.src=t:r._saveImageIntoDBAsync(i,n)};this._mustUpdateRessources?o():this._loadImageFromDBAsync(i,n,o)},e.prototype._loadImageFromDBAsync=function(e,t,n){if(this._isSupported&&null!==this._db){var r,i=this._db.transaction(["textures"]);i.onabort=function(){t.src=e},i.oncomplete=function(){var i;if(r){var o=window.URL||window.webkitURL;i=o.createObjectURL(r.data),t.onerror=function(){p.a.Error("Error loading image from blob URL: "+i+" switching back to web url: "+e),t.src=e},t.src=i}else n()};var o=i.objectStore("textures").get(e);o.onsuccess=function(e){r=e.target.result},o.onerror=function(){p.a.Error("Error loading texture "+e+" from DB."),t.src=e}}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),t.src=e},e.prototype._saveImageIntoDBAsync=function(t,n){var r=this;if(this._isSupported){var i=function(){var e;if(o){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(o)}catch(n){e=t.createObjectURL(o)}}e&&(n.src=e)};if(e.IsUASupportingBlobStorage){var o,a=new So.a;a.open("GET",t),a.responseType="blob",a.addEventListener("load",function(){if(200===a.status&&r._db){o=a.response;var s=r._db.transaction(["textures"],"readwrite");s.onabort=function(e){try{var t=(e.srcElement||e.target).error;t&&"QuotaExceededError"===t.name&&(r._hasReachedQuota=!0)}catch(e){}i()},s.oncomplete=function(){i()};var l={textureUrl:t,data:o};try{var u=s.objectStore("textures").put(l);u.onsuccess=function(){},u.onerror=function(){i()}}catch(i){25===i.code&&(e.IsUASupportingBlobStorage=!1,r._enableTexturesOffline=!1),n.src=t}}else n.src=t},!1),a.addEventListener("error",function(){p.a.Error("Error in XHR request in BABYLON.Database."),n.src=t},!1),a.send()}else n.src=t}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),n.src=t},e.prototype._checkVersionFromDB=function(e,t){var n=this;this._loadVersionFromDBAsync(e,t,function(){n._saveVersionIntoDBAsync(e,t)})},e.prototype._loadVersionFromDBAsync=function(e,t,n){var r,i=this;if(this._isSupported&&this._db)try{var o=this._db.transaction(["versions"]);o.oncomplete=function(){r?i._manifestVersionFound!==r.data?(i._mustUpdateRessources=!0,n()):t(r.data):(i._mustUpdateRessources=!0,n())},o.onabort=function(){t(-1)};var a=o.objectStore("versions").get(e);a.onsuccess=function(e){r=e.target.result},a.onerror=function(){p.a.Error("Error loading version for scene "+e+" from DB."),t(-1)}}catch(e){p.a.Error("Error while accessing 'versions' object store (READ OP). Exception: "+e.message),t(-1)}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),t(-1)},e.prototype._saveVersionIntoDBAsync=function(e,t){var n=this;if(this._isSupported&&!this._hasReachedQuota&&this._db)try{var r=this._db.transaction(["versions"],"readwrite");r.onabort=function(e){try{var r=e.srcElement.error;r&&"QuotaExceededError"===r.name&&(n._hasReachedQuota=!0)}catch(e){}t(-1)},r.oncomplete=function(){t(n._manifestVersionFound)};var i={sceneUrl:e,data:this._manifestVersionFound},o=r.objectStore("versions").put(i);o.onsuccess=function(){},o.onerror=function(){p.a.Error("Error in DB add version request in BABYLON.Database.")}}catch(e){p.a.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+e.message),t(-1)}else t(-1)},e.prototype.loadFile=function(t,n,r,i,o){var a=this,s=e._ReturnFullUrlLocation(t),l=function(){a._saveFileAsync(s,n,r,o,i)};this._checkVersionFromDB(s,function(e){-1!==e?a._mustUpdateRessources?a._saveFileAsync(s,n,r,o,i):a._loadFileAsync(s,n,l):i&&i()})},e.prototype._loadFileAsync=function(e,t,n){if(this._isSupported&&this._db){var r,i;r=-1!==e.indexOf(".babylon")?"scenes":"textures";var o=this._db.transaction([r]);o.oncomplete=function(){i?t(i.data):n()},o.onabort=function(){n()};var a=o.objectStore(r).get(e);a.onsuccess=function(e){i=e.target.result},a.onerror=function(){p.a.Error("Error loading file "+e+" from DB."),n()}}else p.a.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),t()},e.prototype._saveFileAsync=function(t,n,r,i,o){var a=this;if(this._isSupported){var s;s=-1!==t.indexOf(".babylon")?"scenes":"textures";var l,u=new So.a;u.open("GET",t+"?"+Date.now()),i&&(u.responseType="arraybuffer"),r&&(u.onprogress=r),u.addEventListener("load",function(){if(200===u.status||u.status<400&&e._ValidateXHRData(u,i?6:1))if(l=i?u.response:u.responseText,!a._hasReachedQuota&&a._db){var r,c=a._db.transaction([s],"readwrite");c.onabort=function(e){try{var t=e.srcElement.error;t&&"QuotaExceededError"===t.name&&(a._hasReachedQuota=!0)}catch(e){}n(l)},c.oncomplete=function(){n(l)},r="scenes"===s?{sceneUrl:t,data:l,version:a._manifestVersionFound}:{textureUrl:t,data:l};try{var h=c.objectStore(s).put(r);h.onsuccess=function(){},h.onerror=function(){p.a.Error("Error in DB add file request in BABYLON.Database.")}}catch(e){n(l)}}else n(l);else u.status>=400&&o?o(u):n()},!1),u.addEventListener("error",function(){p.a.Error("error on XHR request."),n()},!1),u.send()}else p.a.Error("Error: IndexedDB not supported by your browser or Babylon.js Database is not open."),n()},e._ValidateXHRData=function(e,t){void 0===t&&(t=7);try{if(1&t){if(e.responseText&&e.responseText.length>0)return!0;if(1===t)return!1}if(2&t){var n=yo.GetTGAHeader(e.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(2===t)return!1}if(4&t){var r=new Uint8Array(e.response,0,3);return 68===r[0]&&68===r[1]&&83===r[2]}}catch(e){}return!1},e.IsUASupportingBlobStorage=!0,e.IDBStorageEnabled=!1,e._ParseURL=function(e){document.createElement("a").href=e;var t=e.substring(0,e.lastIndexOf("#")),n=e.substring(t.lastIndexOf("/")+1,e.length);return e.substring(0,e.indexOf(n,0))},e._ReturnFullUrlLocation=function(t){return-1===t.indexOf("http:/")&&-1===t.indexOf("https:/")?e._ParseURL(window.location.href)+t:t},e}(),ya=function(){function e(){this.direction1=new o.x(0,1,0),this.direction2=new o.x(0,1,0),this.minEmitBox=new o.x(-.5,-.5,-.5),this.maxEmitBox=new o.x(.5,.5,.5)}return e.prototype.startDirectionFunction=function(e,t,n){var r=I.a.RandomRange(this.direction1.x,this.direction2.x),i=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(r,i,a,e,t)},e.prototype.startPositionFunction=function(e,t,n){var r=I.a.RandomRange(this.minEmitBox.x,this.maxEmitBox.x),i=I.a.RandomRange(this.minEmitBox.y,this.maxEmitBox.y),a=I.a.RandomRange(this.minEmitBox.z,this.maxEmitBox.z);o.x.TransformCoordinatesFromFloatsToRef(r,i,a,e,t)},e.prototype.clone=function(){var t=new e;return M.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2),e.setVector3("minEmitBox",this.minEmitBox),e.setVector3("maxEmitBox",this.maxEmitBox)},e.prototype.getEffectDefines=function(){return"#define BOXEMITTER"},e.prototype.getClassName=function(){return"BoxParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e.minEmitBox=this.minEmitBox.asArray(),e.maxEmitBox=this.maxEmitBox.asArray(),e},e.prototype.parse=function(e){o.x.FromArrayToRef(e.direction1,0,this.direction1),o.x.FromArrayToRef(e.direction2,0,this.direction2),o.x.FromArrayToRef(e.minEmitBox,0,this.minEmitBox),o.x.FromArrayToRef(e.maxEmitBox,0,this.maxEmitBox)},e}(),ba=function(){function e(e,t,n){void 0===e&&(e=1),void 0===t&&(t=Math.PI),void 0===n&&(n=0),this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=t,this.radius=e}return Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._buildHeight()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this._buildHeight()},enumerable:!0,configurable:!0}),e.prototype._buildHeight=function(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1},e.prototype.startDirectionFunction=function(e,t,n){if(1===Math.abs(Math.cos(this._angle)))o.x.TransformNormalFromFloatsToRef(0,1,0,e,t);else{var r=n.position.subtract(e.getTranslation()).normalize(),i=I.a.RandomRange(0,this.directionRandomizer),a=I.a.RandomRange(0,this.directionRandomizer),s=I.a.RandomRange(0,this.directionRandomizer);r.x+=i,r.y+=a,r.z+=s,r.normalize(),o.x.TransformNormalFromFloatsToRef(r.x,r.y,r.z,e,t)}},e.prototype.startPositionFunction=function(e,t,n){var r,i=I.a.RandomRange(0,2*Math.PI);r=this.emitFromSpawnPointOnly?1e-4:1-(r=I.a.RandomRange(0,this.heightRange))*r;var a=this._radius-I.a.RandomRange(0,this._radius*this.radiusRange),s=(a*=r)*Math.sin(i),l=a*Math.cos(i),u=r*this._height;o.x.TransformCoordinatesFromFloatsToRef(s,u,l,e,t)},e.prototype.clone=function(){var t=new e(this._radius,this._angle,this.directionRandomizer);return M.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat2("radius",this._radius,this.radiusRange),e.setFloat("coneAngle",this._angle),e.setFloat2("height",this._height,this.heightRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){var e="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(e+="\n#define CONEEMITTERSPAWNPOINT"),e},e.prototype.getClassName=function(){return"ConeParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this._radius,e.angle=this._angle,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.angle=e.angle,this.directionRandomizer=e.directionRandomizer},e}(),Ea=function(){function e(e,t,n,r){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=0),this.radius=e,this.height=t,this.radiusRange=n,this.directionRandomizer=r}return e.prototype.startDirectionFunction=function(e,t,n){var r=n.position.subtract(e.getTranslation()).normalize(),i=I.a.RandomRange(-this.directionRandomizer/2,this.directionRandomizer/2),a=Math.atan2(r.x,r.z);a+=I.a.RandomRange(-Math.PI/2,Math.PI/2)*this.directionRandomizer,r.y=i,r.x=Math.sin(a),r.z=Math.cos(a),r.normalize(),o.x.TransformNormalFromFloatsToRef(r.x,r.y,r.z,e,t)},e.prototype.startPositionFunction=function(e,t,n){var r=I.a.RandomRange(-this.height/2,this.height/2),i=I.a.RandomRange(0,2*Math.PI),a=I.a.RandomRange((1-this.radiusRange)*(1-this.radiusRange),1),s=Math.sqrt(a)*this.radius,l=s*Math.cos(i),u=s*Math.sin(i);o.x.TransformCoordinatesFromFloatsToRef(l,r,u,e,t)},e.prototype.clone=function(){var t=new e(this.radius,this.directionRandomizer);return M.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER"},e.prototype.getClassName=function(){return"CylinderParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.height=this.height,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.height=e.height,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},e}(),xa=function(e){function t(t,n,r,i,a){void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=new o.x(0,1,0)),void 0===a&&(a=new o.x(0,1,0));var s=e.call(this,t,n,r)||this;return s.direction1=i,s.direction2=a,s}return u.d(t,e),t.prototype.startDirectionFunction=function(e,t,n){var r=I.a.RandomRange(this.direction1.x,this.direction2.x),i=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(r,i,a,e,t)},t.prototype.clone=function(){var e=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return M.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("height",this.height),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"},t.prototype.getClassName=function(){return"CylinderDirectedParticleEmitter"},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)},t}(Ea),Ta=function(){function e(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=0),this.radius=e,this.radiusRange=t,this.directionRandomizer=n}return e.prototype.startDirectionFunction=function(e,t,n){var r=n.position.subtract(e.getTranslation()).normalize(),i=I.a.RandomRange(0,this.directionRandomizer),a=I.a.RandomRange(0,this.directionRandomizer),s=I.a.RandomRange(0,this.directionRandomizer);r.x+=i,r.y+=a,r.z+=s,r.normalize(),o.x.TransformNormalFromFloatsToRef(r.x,r.y,r.z,e,t)},e.prototype.startPositionFunction=function(e,t,n){var r=this.radius-I.a.RandomRange(0,this.radius*this.radiusRange),i=I.a.RandomRange(0,1),a=I.a.RandomRange(0,2*Math.PI),s=Math.acos(2*i-1),l=r*Math.cos(a)*Math.sin(s),u=r*Math.cos(s),c=r*Math.sin(a)*Math.sin(s);o.x.TransformCoordinatesFromFloatsToRef(l,Math.abs(u),c,e,t)},e.prototype.clone=function(){var t=new e(this.radius,this.directionRandomizer);return M.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define HEMISPHERICEMITTER"},e.prototype.getClassName=function(){return"HemisphericParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},e}(),Sa=function(){function e(){this.direction1=new o.x(0,1,0),this.direction2=new o.x(0,1,0)}return e.prototype.startDirectionFunction=function(e,t,n){var r=I.a.RandomRange(this.direction1.x,this.direction2.x),i=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(r,i,a,e,t)},e.prototype.startPositionFunction=function(e,t,n){o.x.TransformCoordinatesFromFloatsToRef(0,0,0,e,t)},e.prototype.clone=function(){var t=new e;return M.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},e.prototype.getEffectDefines=function(){return"#define POINTEMITTER"},e.prototype.getClassName=function(){return"PointParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.direction1=this.direction1.asArray(),e.direction2=this.direction2.asArray(),e},e.prototype.parse=function(e){o.x.FromArrayToRef(e.direction1,0,this.direction1),o.x.FromArrayToRef(e.direction2,0,this.direction2)},e}(),Aa=function(){function e(e,t,n){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=0),this.radius=e,this.radiusRange=t,this.directionRandomizer=n}return e.prototype.startDirectionFunction=function(e,t,n){var r=n.position.subtract(e.getTranslation()).normalize(),i=I.a.RandomRange(0,this.directionRandomizer),a=I.a.RandomRange(0,this.directionRandomizer),s=I.a.RandomRange(0,this.directionRandomizer);r.x+=i,r.y+=a,r.z+=s,r.normalize(),o.x.TransformNormalFromFloatsToRef(r.x,r.y,r.z,e,t)},e.prototype.startPositionFunction=function(e,t,n){var r=this.radius-I.a.RandomRange(0,this.radius*this.radiusRange),i=I.a.RandomRange(0,1),a=I.a.RandomRange(0,2*Math.PI),s=Math.acos(2*i-1),l=r*Math.cos(a)*Math.sin(s),u=r*Math.cos(s),c=r*Math.sin(a)*Math.sin(s);o.x.TransformCoordinatesFromFloatsToRef(l,u,c,e,t)},e.prototype.clone=function(){var t=new e(this.radius,this.directionRandomizer);return M.a.DeepCopy(this,t),t},e.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setFloat("directionRandomizer",this.directionRandomizer)},e.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER"},e.prototype.getClassName=function(){return"SphereParticleEmitter"},e.prototype.serialize=function(){var e={};return e.type=this.getClassName(),e.radius=this.radius,e.radiusRange=this.radiusRange,e.directionRandomizer=this.directionRandomizer,e},e.prototype.parse=function(e){this.radius=e.radius,this.radiusRange=e.radiusRange,this.directionRandomizer=e.directionRandomizer},e}(),Pa=function(e){function t(t,n,r){void 0===t&&(t=1),void 0===n&&(n=new o.x(0,1,0)),void 0===r&&(r=new o.x(0,1,0));var i=e.call(this,t)||this;return i.direction1=n,i.direction2=r,i}return u.d(t,e),t.prototype.startDirectionFunction=function(e,t,n){var r=I.a.RandomRange(this.direction1.x,this.direction2.x),i=I.a.RandomRange(this.direction1.y,this.direction2.y),a=I.a.RandomRange(this.direction1.z,this.direction2.z);o.x.TransformNormalFromFloatsToRef(r,i,a,e,t)},t.prototype.clone=function(){var e=new t(this.radius,this.direction1,this.direction2);return M.a.DeepCopy(this,e),e},t.prototype.applyToShader=function(e){e.setFloat("radius",this.radius),e.setFloat("radiusRange",this.radiusRange),e.setVector3("direction1",this.direction1),e.setVector3("direction2",this.direction2)},t.prototype.getEffectDefines=function(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"},t.prototype.getClassName=function(){return"SphereDirectedParticleEmitter"},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.direction1.copyFrom(t.direction1),this.direction2.copyFrom(t.direction2)},t}(Aa),Ma=function(){function e(t){this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.noiseStrength=new o.x(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteRandomStartCell=!1,this.translationPivot=new o.w(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.worldOffset=new o.x(0,0,0),this.gravity=o.x.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new o.f(1,1,1,1),this.color2=new o.f(1,1,1,1),this.colorDead=new o.f(0,0,0,1),this.textureMask=new o.f(1,1,1,1),this._isSubEmitter=!1,this.billboardMode=m.a.PARTICLES_BILLBOARDMODE_ALL,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new vn.b,this.id=t,this.name=t}return Object.defineProperty(e.prototype,"noiseTexture",{get:function(){return this._noiseTexture},set:function(e){this._noiseTexture!==e&&(this._noiseTexture=e,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},set:function(e){this._isAnimationSheetEnabled!=e&&(this._isAnimationSheetEnabled=e,this._reset())},enumerable:!0,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype._hasTargetStopDurationDependantGradient=function(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0},e.prototype.getDragGradients=function(){return this._dragGradients},e.prototype.getLimitVelocityGradients=function(){return this._limitVelocityGradients},e.prototype.getColorGradients=function(){return this._colorGradients},e.prototype.getSizeGradients=function(){return this._sizeGradients},e.prototype.getColorRemapGradients=function(){return this._colorRemapGradients},e.prototype.getAlphaRemapGradients=function(){return this._alphaRemapGradients},e.prototype.getLifeTimeGradients=function(){return this._lifeTimeGradients},e.prototype.getAngularSpeedGradients=function(){return this._angularSpeedGradients},e.prototype.getVelocityGradients=function(){return this._velocityGradients},e.prototype.getStartSizeGradients=function(){return this._startSizeGradients},e.prototype.getEmitRateGradients=function(){return this._emitRateGradients},Object.defineProperty(e.prototype,"direction1",{get:function(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:o.x.Zero()},set:function(e){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"direction2",{get:function(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:o.x.Zero()},set:function(e){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minEmitBox",{get:function(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:o.x.Zero()},set:function(e){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxEmitBox",{get:function(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:o.x.Zero()},set:function(e){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBillboardBased",{get:function(){return this._isBillboardBased},set:function(e){this._isBillboardBased!==e&&(this._isBillboardBased=e,this._reset())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e)},enumerable:!0,configurable:!0}),e.prototype._attachImageProcessingConfiguration=function(e){e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration=e||this._scene.imageProcessingConfiguration)},e.prototype._reset=function(){},e.prototype._removeGradientAndTexture=function(e,t,n){if(!t)return this;for(var r=0,i=0,o=t;i<o.length;i++){if(o[i].gradient===e){t.splice(r,1);break}r++}return n&&n.dispose(),this},e.prototype.createPointEmitter=function(e,t){var n=new Sa;return n.direction1=e,n.direction2=t,this.particleEmitterType=n,n},e.prototype.createHemisphericEmitter=function(e,t){void 0===e&&(e=1),void 0===t&&(t=1);var n=new Ta(e,t);return this.particleEmitterType=n,n},e.prototype.createSphereEmitter=function(e,t){void 0===e&&(e=1),void 0===t&&(t=1);var n=new Aa(e,t);return this.particleEmitterType=n,n},e.prototype.createDirectedSphereEmitter=function(e,t,n){void 0===e&&(e=1),void 0===t&&(t=new o.x(0,1,0)),void 0===n&&(n=new o.x(0,1,0));var r=new Pa(e,t,n);return this.particleEmitterType=r,r},e.prototype.createCylinderEmitter=function(e,t,n,r){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=0);var i=new Ea(e,t,n,r);return this.particleEmitterType=i,i},e.prototype.createDirectedCylinderEmitter=function(e,t,n,r,i){void 0===e&&(e=1),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=new o.x(0,1,0)),void 0===i&&(i=new o.x(0,1,0));var a=new xa(e,t,n,r,i);return this.particleEmitterType=a,a},e.prototype.createConeEmitter=function(e,t){void 0===e&&(e=1),void 0===t&&(t=Math.PI/4);var n=new ba(e,t);return this.particleEmitterType=n,n},e.prototype.createBoxEmitter=function(e,t,n,r){var i=new ya;return this.particleEmitterType=i,this.direction1=e,this.direction2=t,this.minEmitBox=n,this.maxEmitBox=r,i},e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e}(),Ra=function(){function e(t){this.particleSystem=t,this.position=o.x.Zero(),this.direction=o.x.Zero(),this.color=new o.f(0,0,0,0),this.colorStep=new o.f(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new o.w(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new o.f(0,0,0,0),this._currentColor2=new o.f(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=e._Count++,this.particleSystem.isAnimationSheetEnabled&&this.updateCellInfoFromSystem()}return e.prototype.updateCellInfoFromSystem=function(){this.cellIndex=this.particleSystem.startSpriteCellID},e.prototype.updateCellIndex=function(){var e=this.age,t=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===t?(t=1,e=this._randomCellOffset):e+=this._randomCellOffset);var n=this._initialEndSpriteCellID-this._initialStartSpriteCellID,r=I.a.Clamp(e*t%this.lifeTime/this.lifeTime);this.cellIndex=this._initialStartSpriteCellID+r*n|0},e.prototype._inheritParticleInfoToSubEmitter=function(e){if(e.particleSystem.emitter.position){var t=e.particleSystem.emitter;t.position.copyFrom(this.position),e.inheritDirection&&(t.position.subtractToRef(this.direction,o.t.Vector3[0]),t.lookAt(o.t.Vector3[0],0,Math.PI/2))}else e.particleSystem.emitter.copyFrom(this.position);this.direction.scaleToRef(e.inheritedVelocityAmount/2,o.t.Vector3[0]),e.particleSystem._inheritedVelocityOffset.copyFrom(o.t.Vector3[0])},e.prototype._inheritParticleInfoToSubEmitters=function(){var e=this;this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach(function(t){e._inheritParticleInfoToSubEmitter(t)})},e.prototype._reset=function(){this.age=0,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0},e.prototype.copyTo=function(e){e.position.copyFrom(this.position),this._initialDirection?e._initialDirection?e._initialDirection.copyFrom(this._initialDirection):e._initialDirection=this._initialDirection.clone():e._initialDirection=null,e.direction.copyFrom(this.direction),e.color.copyFrom(this.color),e.colorStep.copyFrom(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e._randomCellOffset=this._randomCellOffset,e.size=this.size,e.scale.copyFrom(this.scale),e.angle=this.angle,e.angularSpeed=this.angularSpeed,e.particleSystem=this.particleSystem,e.cellIndex=this.cellIndex,e.id=this.id,e._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(e._currentColorGradient=this._currentColorGradient,e._currentColor1.copyFrom(this._currentColor1),e._currentColor2.copyFrom(this._currentColor2)),this._currentSizeGradient&&(e._currentSizeGradient=this._currentSizeGradient,e._currentSize1=this._currentSize1,e._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(e._currentAngularSpeedGradient=this._currentAngularSpeedGradient,e._currentAngularSpeed1=this._currentAngularSpeed1,e._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(e._currentVelocityGradient=this._currentVelocityGradient,e._currentVelocity1=this._currentVelocity1,e._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(e._currentLimitVelocityGradient=this._currentLimitVelocityGradient,e._currentLimitVelocity1=this._currentLimitVelocity1,e._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(e._currentDragGradient=this._currentDragGradient,e._currentDrag1=this._currentDrag1,e._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(e._initialStartSpriteCellID=this._initialStartSpriteCellID,e._initialEndSpriteCellID=this._initialEndSpriteCellID),this.particleSystem.useRampGradients&&e.remapData.copyFrom(this.remapData),this._randomNoiseCoordinates1&&(e._randomNoiseCoordinates1?(e._randomNoiseCoordinates1.copyFrom(this._randomNoiseCoordinates1),e._randomNoiseCoordinates2.copyFrom(this._randomNoiseCoordinates2)):(e._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),e._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))},e._Count=0,e}();!function(e){e[e.ATTACHED=0]="ATTACHED",e[e.END=1]="END"}(_a||(_a={}));var Ca=function(){function e(e){this.particleSystem=e,this.type=_a.END,this.inheritDirection=!1,this.inheritedVelocityAmount=0,e.emitter&&e.emitter.dispose||(e.emitter=new Fe.a("SubemitterSystemEmitter",e.getScene())),e.onDisposeObservable.add(function(){e.emitter&&e.emitter.dispose&&e.emitter.dispose()})}return e.prototype.clone=function(){var t=this.particleSystem.emitter;t?t instanceof o.x?t=t.clone():t instanceof Fe.a&&((t=new fe.a("",t.getScene())).isVisible=!1):t=new o.x;var n=new e(this.particleSystem.clone("",t));return n.type=this.type,n.inheritDirection=this.inheritDirection,n.inheritedVelocityAmount=this.inheritedVelocityAmount,n.particleSystem._disposeEmitterOnDispose=!0,n.particleSystem.disposeOnStop=!0,n},e.prototype.serialize=function(){var e={};return e.type=this.type,e.inheritDirection=this.inheritDirection,e.inheritedVelocityAmount=this.inheritedVelocityAmount,e.particleSystem=this.particleSystem.serialize(),e},e._ParseParticleSystem=function(e,t,n){throw be.a.WarnImport("ParseParticle")},e.Parse=function(t,n,r){var i=t.particleSystem,o=new e(e._ParseParticleSystem(i,n,r));return o.type=t.type,o.inheritDirection=t.inheritDirection,o.inheritedVelocityAmount=t.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o},e.prototype.dispose=function(){this.particleSystem.dispose()},e}();zt.a.ShadersStore.particlesPixelShader="\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\n\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n}",zt.a.ShadersStore.particlesVertexShader="\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos;\n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\nvoid main(void) {\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvec3 worldPos=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(worldPos,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0);\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(worldPos,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*vec4(viewPos,1.0);\n#endif\n#include<clipPlaneVertex>\n}";var wa=function(e){function t(t,n,r,a,s,l){void 0===a&&(a=null),void 0===s&&(s=!1),void 0===l&&(l=.01);var u=e.call(this,t)||this;return u._inheritedVelocityOffset=new o.x,u.onDisposeObservable=new i.c,u._particles=new Array,u._stockParticles=new Array,u._newPartsExcess=0,u._vertexBuffers={},u._scaledColorStep=new o.f(0,0,0,0),u._colorDiff=new o.f(0,0,0,0),u._scaledDirection=o.x.Zero(),u._scaledGravity=o.x.Zero(),u._currentRenderId=-1,u._useInstancing=!1,u._started=!1,u._stopped=!1,u._actualFrame=0,u._currentEmitRate1=0,u._currentEmitRate2=0,u._currentStartSize1=0,u._currentStartSize2=0,u._rawTextureWidth=256,u._useRampGradients=!1,u._disposeEmitterOnDispose=!1,u.recycleParticle=function(e){var t=u._particles.pop();t!==e&&t.copyTo(e),u._stockParticles.push(t)},u._createParticle=function(){var e;if(0!==u._stockParticles.length?(e=u._stockParticles.pop())._reset():e=new Ra(u),u._subEmitters&&u._subEmitters.length>0){var t=u._subEmitters[Math.floor(Math.random()*u._subEmitters.length)];e._attachedSubEmitters=[],t.forEach(function(t){if(t.type===_a.ATTACHED){var n=t.clone();e._attachedSubEmitters.push(n),n.particleSystem.start()}})}return e},u._emitFromParticle=function(e){if(u._subEmitters&&0!==u._subEmitters.length){var t=Math.floor(Math.random()*u._subEmitters.length);u._subEmitters[t].forEach(function(t){if(t.type===_a.END){var n=t.clone();e._inheritParticleInfoToSubEmitter(n),n.particleSystem._rootParticleSystem=u,u.activeSubSystems.push(n.particleSystem),n.particleSystem.start()}})}},u._capacity=n,u._epsilon=l,u._isAnimationSheetEnabled=s,u._scene=r||P.a.LastCreatedScene,u._attachImageProcessingConfiguration(null),u._customEffect=a,u._scene.particleSystems.push(u),u._useInstancing=u._scene.getEngine().getCaps().instancedArrays,u._createIndexBuffer(),u._createVertexBuffers(),u.particleEmitterType=new ya,u.updateFunction=function(e){var t=null,n=null;u.noiseTexture&&(t=u.noiseTexture.getSize(),n=u.noiseTexture.getContent());for(var r,i=function(){r=e[a];var i=u._scaledUpdateSpeed,s=r.age;if(r.age+=i,r.age>r.lifeTime){var l=r.age-s;i=(r.lifeTime-s)*i/l,r.age=r.lifeTime}var c=r.age/r.lifeTime;u._colorGradients&&u._colorGradients.length>0?ye.h.GetCurrentGradient(c,u._colorGradients,function(e,t,n){e!==r._currentColorGradient&&(r._currentColor1.copyFrom(r._currentColor2),t.getColorToRef(r._currentColor2),r._currentColorGradient=e),o.f.LerpToRef(r._currentColor1,r._currentColor2,n,r.color)}):(r.colorStep.scaleToRef(i,u._scaledColorStep),r.color.addInPlace(u._scaledColorStep),r.color.a<0&&(r.color.a=0)),u._angularSpeedGradients&&u._angularSpeedGradients.length>0&&ye.h.GetCurrentGradient(c,u._angularSpeedGradients,function(e,t,n){e!==r._currentAngularSpeedGradient&&(r._currentAngularSpeed1=r._currentAngularSpeed2,r._currentAngularSpeed2=t.getFactor(),r._currentAngularSpeedGradient=e),r.angularSpeed=I.a.Lerp(r._currentAngularSpeed1,r._currentAngularSpeed2,n)}),r.angle+=r.angularSpeed*i;var h=i;if(u._velocityGradients&&u._velocityGradients.length>0&&ye.h.GetCurrentGradient(c,u._velocityGradients,function(e,t,n){e!==r._currentVelocityGradient&&(r._currentVelocity1=r._currentVelocity2,r._currentVelocity2=t.getFactor(),r._currentVelocityGradient=e),h*=I.a.Lerp(r._currentVelocity1,r._currentVelocity2,n)}),r.direction.scaleToRef(h,u._scaledDirection),u._limitVelocityGradients&&u._limitVelocityGradients.length>0&&ye.h.GetCurrentGradient(c,u._limitVelocityGradients,function(e,t,n){e!==r._currentLimitVelocityGradient&&(r._currentLimitVelocity1=r._currentLimitVelocity2,r._currentLimitVelocity2=t.getFactor(),r._currentLimitVelocityGradient=e);var i=I.a.Lerp(r._currentLimitVelocity1,r._currentLimitVelocity2,n);r.direction.length()>i&&r.direction.scaleInPlace(u.limitVelocityDamping)}),u._dragGradients&&u._dragGradients.length>0&&ye.h.GetCurrentGradient(c,u._dragGradients,function(e,t,n){e!==r._currentDragGradient&&(r._currentDrag1=r._currentDrag2,r._currentDrag2=t.getFactor(),r._currentDragGradient=e);var i=I.a.Lerp(r._currentDrag1,r._currentDrag2,n);u._scaledDirection.scaleInPlace(1-i)}),r.position.addInPlace(u._scaledDirection),n&&t&&r._randomNoiseCoordinates1){var d=u._fetchR(r._randomNoiseCoordinates1.x,r._randomNoiseCoordinates1.y,t.width,t.height,n),f=u._fetchR(r._randomNoiseCoordinates1.z,r._randomNoiseCoordinates2.x,t.width,t.height,n),p=u._fetchR(r._randomNoiseCoordinates2.y,r._randomNoiseCoordinates2.z,t.width,t.height,n),m=o.t.Vector3[0],g=o.t.Vector3[1];m.copyFromFloats((2*d-1)*u.noiseStrength.x,(2*f-1)*u.noiseStrength.y,(2*p-1)*u.noiseStrength.z),m.scaleToRef(i,g),r.direction.addInPlace(g)}if(u.gravity.scaleToRef(i,u._scaledGravity),r.direction.addInPlace(u._scaledGravity),u._sizeGradients&&u._sizeGradients.length>0&&ye.h.GetCurrentGradient(c,u._sizeGradients,function(e,t,n){e!==r._currentSizeGradient&&(r._currentSize1=r._currentSize2,r._currentSize2=t.getFactor(),r._currentSizeGradient=e),r.size=I.a.Lerp(r._currentSize1,r._currentSize2,n)}),u._useRampGradients&&(u._colorRemapGradients&&u._colorRemapGradients.length>0&&ye.h.GetCurrentGradient(c,u._colorRemapGradients,function(e,t,n){var i=I.a.Lerp(e.factor1,t.factor1,n),o=I.a.Lerp(e.factor2,t.factor2,n);r.remapData.x=i,r.remapData.y=o-i}),u._alphaRemapGradients&&u._alphaRemapGradients.length>0&&ye.h.GetCurrentGradient(c,u._alphaRemapGradients,function(e,t,n){var i=I.a.Lerp(e.factor1,t.factor1,n),o=I.a.Lerp(e.factor2,t.factor2,n);r.remapData.z=i,r.remapData.w=o-i})),u._isAnimationSheetEnabled&&r.updateCellIndex(),r._inheritParticleInfoToSubEmitters(),r.age>=r.lifeTime)return u._emitFromParticle(r),r._attachedSubEmitters&&(r._attachedSubEmitters.forEach(function(e){e.particleSystem.disposeOnStop=!0,e.particleSystem.stop()}),r._attachedSubEmitters=null),u.recycleParticle(r),a--,"continue"},a=0;a<e.length;a++)i()},u}return u.d(t,e),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return this._useRampGradients},set:function(e){this._useRampGradients!==e&&(this._useRampGradients=e,this._resetEffect())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"particles",{get:function(){return this._particles},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ParticleSystem"},t.prototype._addFactorGradient=function(e,t,n,r){var i=new ye.d;i.gradient=t,i.factor1=n,i.factor2=r,e.push(i),e.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0})},t.prototype._removeFactorGradient=function(e,t){if(e)for(var n=0,r=0,i=e;r<i.length;r++){if(i[r].gradient===t){e.splice(n,1);break}n++}},t.prototype.addLifeTimeGradient=function(e,t,n){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,e,t,n),this},t.prototype.removeLifeTimeGradient=function(e){return this._removeFactorGradient(this._lifeTimeGradients,e),this},t.prototype.addSizeGradient=function(e,t,n){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,t,n),this},t.prototype.removeSizeGradient=function(e){return this._removeFactorGradient(this._sizeGradients,e),this},t.prototype.addColorRemapGradient=function(e,t,n){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,e,t,n),this},t.prototype.removeColorRemapGradient=function(e){return this._removeFactorGradient(this._colorRemapGradients,e),this},t.prototype.addAlphaRemapGradient=function(e,t,n){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,e,t,n),this},t.prototype.removeAlphaRemapGradient=function(e){return this._removeFactorGradient(this._alphaRemapGradients,e),this},t.prototype.addAngularSpeedGradient=function(e,t,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,t,n),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeFactorGradient(this._angularSpeedGradients,e),this},t.prototype.addVelocityGradient=function(e,t,n){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,t,n),this},t.prototype.removeVelocityGradient=function(e){return this._removeFactorGradient(this._velocityGradients,e),this},t.prototype.addLimitVelocityGradient=function(e,t,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,t,n),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeFactorGradient(this._limitVelocityGradients,e),this},t.prototype.addDragGradient=function(e,t,n){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,t,n),this},t.prototype.removeDragGradient=function(e){return this._removeFactorGradient(this._dragGradients,e),this},t.prototype.addEmitRateGradient=function(e,t,n){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,e,t,n),this},t.prototype.removeEmitRateGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},t.prototype.addStartSizeGradient=function(e,t,n){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,e,t,n),this},t.prototype.removeStartSizeGradient=function(e){return this._removeFactorGradient(this._emitRateGradients,e),this},t.prototype._createRampGradientTexture=function(){if(this._rampGradients&&this._rampGradients.length&&!this._rampGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),t=o.t.Color3[0],n=0;n<this._rawTextureWidth;n++){var r=n/this._rawTextureWidth;ye.h.GetCurrentGradient(r,this._rampGradients,function(r,i,a){o.e.LerpToRef(r.color,i.color,a,t),e[4*n]=255*t.r,e[4*n+1]=255*t.g,e[4*n+2]=255*t.b,e[4*n+3]=255})}this._rampGradientsTexture=je.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,Ge.a.NEAREST_SAMPLINGMODE)}},t.prototype.getRampGradients=function(){return this._rampGradients},t.prototype.addRampGradient=function(e,t){this._rampGradients||(this._rampGradients=[]);var n=new ye.b;return n.gradient=e,n.color=t,this._rampGradients.push(n),this._rampGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture(),this},t.prototype.removeRampGradient=function(e){return this._removeGradientAndTexture(e,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this},t.prototype.addColorGradient=function(e,t,n){this._colorGradients||(this._colorGradients=[]);var r=new ye.c;return r.gradient=e,r.color1=t,r.color2=n,this._colorGradients.push(r),this._colorGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this},t.prototype.removeColorGradient=function(e){if(!this._colorGradients)return this;for(var t=0,n=0,r=this._colorGradients;n<r.length;n++){if(r[n].gradient===e){this._colorGradients.splice(t,1);break}t++}return this},t.prototype._fetchR=function(e,t,n,r,i){return i[4*(((e=.5*Math.abs(e)+.5)*n%n|0)+((t=.5*Math.abs(t)+.5)*r%r|0)*n)]/255},t.prototype._reset=function(){this._resetEffect()},t.prototype._resetEffect=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._createVertexBuffers()},t.prototype._createVertexBuffers=function(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);var e=this._scene.getEngine();this._vertexData=new Float32Array(this._capacity*this._vertexBufferSize*(this._useInstancing?1:4)),this._vertexBuffer=new Sn.a(e,this._vertexData,!0,this._vertexBufferSize);var n=0,r=this._vertexBuffer.createVertexBuffer(Sn.b.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Sn.b.PositionKind]=r,n+=3;var i=this._vertexBuffer.createVertexBuffer(Sn.b.ColorKind,n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Sn.b.ColorKind]=i,n+=4;var o=this._vertexBuffer.createVertexBuffer("angle",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=o,n+=1;var a,s=this._vertexBuffer.createVertexBuffer("size",n,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=s,n+=2,this._isAnimationSheetEnabled){var l=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=l,n+=1}if(!this._isBillboardBased||this.billboardMode===t.BILLBOARDMODE_STRETCHED){var u=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=u,n+=3}if(this._useRampGradients){var c=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=c,n+=4}if(this._useInstancing){var h=new Float32Array([0,0,1,0,1,1,0,1]);this._spriteBuffer=new Sn.a(e,h,!1,2),a=this._spriteBuffer.createVertexBuffer("offset",0,2)}else a=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=a},t.prototype._createIndexBuffer=function(){if(!this._useInstancing){for(var e=[],t=0,n=0;n<this._capacity;n++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}},t.prototype.getCapacity=function(){return this._capacity},t.prototype.isAlive=function(){return this._alive},t.prototype.isStarted=function(){return this._started},t.prototype._prepareSubEmitterInternalArray=function(){var e=this;this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach(function(n){n instanceof t?e._subEmitters.push([new Ca(n)]):n instanceof Ca?e._subEmitters.push([n]):n instanceof Array&&e._subEmitters.push(n)})},t.prototype.start=function(e){var t=this;if(void 0===e&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(e)setTimeout(function(){t.start(0)},e);else{if(this._prepareSubEmitterInternalArray(),this._started=!0,this._stopped=!1,this._actualFrame=0,this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=new Array),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){this.emitter instanceof Fe.a&&this.emitter.computeWorldMatrix(!0);var n=this.noiseTexture;if(n&&n.onGeneratedObservable)n.onGeneratedObservable.addOnce(function(){setTimeout(function(){for(var e=0;e<t.preWarmCycles;e++)t.animate(!0),n.render()})});else for(var r=0;r<this.preWarmCycles;r++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}},t.prototype.stop=function(e){void 0===e&&(e=!0),this._stopped=!0,e&&this._stopSubEmitters()},t.prototype.reset=function(){this._stockParticles=[],this._particles=[]},t.prototype._appendParticleVertex=function(e,n,r,i){var o=e*this._vertexBufferSize;this._vertexData[o++]=n.position.x+this.worldOffset.x,this._vertexData[o++]=n.position.y+this.worldOffset.y,this._vertexData[o++]=n.position.z+this.worldOffset.z,this._vertexData[o++]=n.color.r,this._vertexData[o++]=n.color.g,this._vertexData[o++]=n.color.b,this._vertexData[o++]=n.color.a,this._vertexData[o++]=n.angle,this._vertexData[o++]=n.scale.x*n.size,this._vertexData[o++]=n.scale.y*n.size,this._isAnimationSheetEnabled&&(this._vertexData[o++]=n.cellIndex),this._isBillboardBased?this.billboardMode===t.BILLBOARDMODE_STRETCHED&&(this._vertexData[o++]=n.direction.x,this._vertexData[o++]=n.direction.y,this._vertexData[o++]=n.direction.z):n._initialDirection?(this._vertexData[o++]=n._initialDirection.x,this._vertexData[o++]=n._initialDirection.y,this._vertexData[o++]=n._initialDirection.z):(this._vertexData[o++]=n.direction.x,this._vertexData[o++]=n.direction.y,this._vertexData[o++]=n.direction.z),this._useRampGradients&&(this._vertexData[o++]=n.remapData.x,this._vertexData[o++]=n.remapData.y,this._vertexData[o++]=n.remapData.z,this._vertexData[o++]=n.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),0===i?i=this._epsilon:1===i&&(i=1-this._epsilon)),this._vertexData[o++]=r,this._vertexData[o++]=i)},t.prototype._stopSubEmitters=function(){this.activeSubSystems&&(this.activeSubSystems.forEach(function(e){e.stop(!0)}),this.activeSubSystems=new Array)},t.prototype._removeFromRoot=function(){if(this._rootParticleSystem){var e=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==e&&this._rootParticleSystem.activeSubSystems.splice(e,1),this._rootParticleSystem=null}},t.prototype._update=function(e){var t,n=this;if(this._alive=this._particles.length>0,this.emitter.position){var r=this.emitter;this._emitterWorldMatrix=r.getWorldMatrix()}else{var i=this.emitter;this._emitterWorldMatrix=o.j.Translation(i.x,i.y,i.z)}this.updateFunction(this._particles);for(var a,s=function(){if(l._particles.length===l._capacity)return"break";t=l._createParticle(),l._particles.push(t);var e=I.a.RandomRange(l.minEmitPower,l.maxEmitPower);if(l.startPositionFunction?l.startPositionFunction(l._emitterWorldMatrix,t.position,t):l.particleEmitterType.startPositionFunction(l._emitterWorldMatrix,t.position,t),l.startDirectionFunction?l.startDirectionFunction(l._emitterWorldMatrix,t.direction,t):l.particleEmitterType.startDirectionFunction(l._emitterWorldMatrix,t.direction,t),0===e?t._initialDirection?t._initialDirection.copyFrom(t.direction):t._initialDirection=t.direction.clone():t._initialDirection=null,t.direction.scaleInPlace(e),l.targetStopDuration&&l._lifeTimeGradients&&l._lifeTimeGradients.length>0){var r=I.a.Clamp(l._actualFrame/l.targetStopDuration);ye.h.GetCurrentGradient(r,l._lifeTimeGradients,function(e,n){var i=e,o=n,a=i.getFactor(),s=o.getFactor(),l=(r-i.gradient)/(o.gradient-i.gradient);t.lifeTime=I.a.Lerp(a,s,l)})}else t.lifeTime=I.a.RandomRange(l.minLifeTime,l.maxLifeTime);if(l._sizeGradients&&0!==l._sizeGradients.length?(t._currentSizeGradient=l._sizeGradients[0],t._currentSize1=t._currentSizeGradient.getFactor(),t.size=t._currentSize1,l._sizeGradients.length>1?t._currentSize2=l._sizeGradients[1].getFactor():t._currentSize2=t._currentSize1):t.size=I.a.RandomRange(l.minSize,l.maxSize),t.scale.copyFromFloats(I.a.RandomRange(l.minScaleX,l.maxScaleX),I.a.RandomRange(l.minScaleY,l.maxScaleY)),l._startSizeGradients&&l._startSizeGradients[0]&&l.targetStopDuration){var i=l._actualFrame/l.targetStopDuration;ye.h.GetCurrentGradient(i,l._startSizeGradients,function(e,r,i){e!==n._currentStartSizeGradient&&(n._currentStartSize1=n._currentStartSize2,n._currentStartSize2=r.getFactor(),n._currentStartSizeGradient=e);var o=I.a.Lerp(n._currentStartSize1,n._currentStartSize2,i);t.scale.scaleInPlace(o)})}l._angularSpeedGradients&&0!==l._angularSpeedGradients.length?(t._currentAngularSpeedGradient=l._angularSpeedGradients[0],t.angularSpeed=t._currentAngularSpeedGradient.getFactor(),t._currentAngularSpeed1=t.angularSpeed,l._angularSpeedGradients.length>1?t._currentAngularSpeed2=l._angularSpeedGradients[1].getFactor():t._currentAngularSpeed2=t._currentAngularSpeed1):t.angularSpeed=I.a.RandomRange(l.minAngularSpeed,l.maxAngularSpeed),t.angle=I.a.RandomRange(l.minInitialRotation,l.maxInitialRotation),l._velocityGradients&&l._velocityGradients.length>0&&(t._currentVelocityGradient=l._velocityGradients[0],t._currentVelocity1=t._currentVelocityGradient.getFactor(),l._velocityGradients.length>1?t._currentVelocity2=l._velocityGradients[1].getFactor():t._currentVelocity2=t._currentVelocity1),l._limitVelocityGradients&&l._limitVelocityGradients.length>0&&(t._currentLimitVelocityGradient=l._limitVelocityGradients[0],t._currentLimitVelocity1=t._currentLimitVelocityGradient.getFactor(),l._limitVelocityGradients.length>1?t._currentLimitVelocity2=l._limitVelocityGradients[1].getFactor():t._currentLimitVelocity2=t._currentLimitVelocity1),l._dragGradients&&l._dragGradients.length>0&&(t._currentDragGradient=l._dragGradients[0],t._currentDrag1=t._currentDragGradient.getFactor(),l._dragGradients.length>1?t._currentDrag2=l._dragGradients[1].getFactor():t._currentDrag2=t._currentDrag1),l._colorGradients&&0!==l._colorGradients.length?(t._currentColorGradient=l._colorGradients[0],t._currentColorGradient.getColorToRef(t.color),t._currentColor1.copyFrom(t.color),l._colorGradients.length>1?l._colorGradients[1].getColorToRef(t._currentColor2):t._currentColor2.copyFrom(t.color)):(a=I.a.RandomRange(0,1),o.f.LerpToRef(l.color1,l.color2,a,t.color),l.colorDead.subtractToRef(t.color,l._colorDiff),l._colorDiff.scaleToRef(1/t.lifeTime,t.colorStep)),l._isAnimationSheetEnabled&&(t._initialStartSpriteCellID=l.startSpriteCellID,t._initialEndSpriteCellID=l.endSpriteCellID),t.direction.addInPlace(l._inheritedVelocityOffset),l._useRampGradients&&(t.remapData=new o.y(0,1,0,1)),l.noiseTexture&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.copyFromFloats(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2.copyFromFloats(Math.random(),Math.random(),Math.random())):(t._randomNoiseCoordinates1=new o.x(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2=new o.x(Math.random(),Math.random(),Math.random()))),t._inheritParticleInfoToSubEmitters()},l=this,u=0;u<e&&"break"!==s();u++);},t._GetAttributeNamesOrOptions=function(e,t,n){void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1);var r=[Sn.b.PositionKind,Sn.b.ColorKind,"angle","offset","size"];return e&&r.push("cellIndex"),t||r.push("direction"),n&&r.push("remapData"),r},t._GetEffectCreationOptions=function(e){void 0===e&&(e=!1);var t=["invView","view","projection","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","textureMask","translationPivot","eyePosition"];return e&&t.push("particlesInfos"),t},t.prototype._getEffect=function(e){if(this._customEffect)return this._customEffect;var n=[];if(this._scene.clipPlane&&n.push("#define CLIPPLANE"),this._scene.clipPlane2&&n.push("#define CLIPPLANE2"),this._scene.clipPlane3&&n.push("#define CLIPPLANE3"),this._scene.clipPlane4&&n.push("#define CLIPPLANE4"),this._isAnimationSheetEnabled&&n.push("#define ANIMATESHEET"),e===t.BLENDMODE_MULTIPLY&&n.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&n.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(n.push("#define BILLBOARD"),this.billboardMode){case t.BILLBOARDMODE_Y:n.push("#define BILLBOARDY");break;case t.BILLBOARDMODE_STRETCHED:n.push("#define BILLBOARDSTRETCHED");break;case t.BILLBOARDMODE_ALL:}this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),n.push(this._imageProcessingConfigurationDefines.toString()));var r=n.join("\n");if(this._cachedDefines!==r){this._cachedDefines=r;var i=t._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&this.billboardMode!==t.BILLBOARDMODE_STRETCHED,this._useRampGradients),o=t._GetEffectCreationOptions(this._isAnimationSheetEnabled),a=["diffuseSampler","rampSampler"];vn.a&&(vn.a.PrepareUniforms(o,this._imageProcessingConfigurationDefines),vn.a.PrepareSamplers(a,this._imageProcessingConfigurationDefines)),this._effect=this._scene.getEngine().createEffect("particles",i,o,a,r)}return this._effect},t.prototype.animate=function(e){var t=this;if(void 0===e&&(e=!1),this._started){if(!e){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}var n;if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:this._scene.getAnimationRatio()),this.manualEmitCount>-1)n=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{var r=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){var i=this._actualFrame/this.targetStopDuration;ye.h.GetCurrentGradient(i,this._emitRateGradients,function(e,n,i){e!==t._currentEmitRateGradient&&(t._currentEmitRate1=t._currentEmitRate2,t._currentEmitRate2=n.getFactor(),t._currentEmitRateGradient=e),r=I.a.Lerp(t._currentEmitRate1,t._currentEmitRate2,i)})}n=r*this._scaledUpdateSpeed>>0,this._newPartsExcess+=r*this._scaledUpdateSpeed-n}if(this._newPartsExcess>1&&(n+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?n=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(n),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),!e){for(var o=0,a=0;a<this._particles.length;a++){var s=this._particles[a];this._appendParticleVertices(o,s),o+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}},t.prototype._appendParticleVertices=function(e,t){this._appendParticleVertex(e++,t,0,0),this._useInstancing||(this._appendParticleVertex(e++,t,1,0),this._appendParticleVertex(e++,t,1,1),this._appendParticleVertex(e++,t,0,1))},t.prototype.rebuild=function(){this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild()},t.prototype.isReady=function(){if(!(this.emitter&&this._imageProcessingConfiguration.isReady()&&this.particleTexture&&this.particleTexture.isReady()))return!1;if(this.blendMode!==t.BLENDMODE_MULTIPLYADD){if(!this._getEffect(this.blendMode).isReady())return!1}else{if(!this._getEffect(t.BLENDMODE_MULTIPLY).isReady())return!1;if(!this._getEffect(t.BLENDMODE_ADD).isReady())return!1}return!0},t.prototype._render=function(e){var n=this._getEffect(e),r=this._scene.getEngine();r.enableEffect(n);var i=this._scene.getViewMatrix();if(n.setTexture("diffuseSampler",this.particleTexture),n.setMatrix("view",i),n.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){var o=this.particleTexture.getBaseSize();n.setFloat3("particlesInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,o.width/this.spriteCellWidth)}if(n.setVector2("translationPivot",this.translationPivot),n.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased){var a=this._scene.activeCamera;n.setVector3("eyePosition",a.globalPosition)}if(this._rampGradientsTexture&&n.setTexture("rampSampler",this._rampGradientsTexture),this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var s=i.clone();s.invert(),n.setMatrix("invView",s),Wr.a.BindClipPlane(n,this._scene)}switch(r.bindBuffers(this._vertexBuffers,this._indexBuffer,n),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(n),e){case t.BLENDMODE_ADD:r.setAlphaMode(m.a.ALPHA_ADD);break;case t.BLENDMODE_ONEONE:r.setAlphaMode(m.a.ALPHA_ONEONE);break;case t.BLENDMODE_STANDARD:r.setAlphaMode(m.a.ALPHA_COMBINE);break;case t.BLENDMODE_MULTIPLY:r.setAlphaMode(m.a.ALPHA_MULTIPLY)}return this._useInstancing?r.drawArraysType(Mi.a.TriangleFanDrawMode,0,4,this._particles.length):r.drawElementsType(Mi.a.TriangleFillMode,0,6*this._particles.length),this._particles.length},t.prototype.render=function(){if(!this.isReady()||!this._particles.length)return 0;var e=this._scene.getEngine();e.setState(!1),this.forceDepthWrite&&e.setDepthWrite(!0);var n=0;return this.blendMode===t.BLENDMODE_MULTIPLYADD&&(n=this._render(t.BLENDMODE_MULTIPLY)+this._render(t.BLENDMODE_ADD)),n=this._render(this.blendMode),e.unbindInstanceAttributes(),e.setAlphaMode(m.a.ALPHA_DISABLE),n},t.prototype.dispose=function(e){if(void 0===e&&(e=!0),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._removeFromRoot(),this._subEmitters&&this._subEmitters.length){for(var t=0;t<this._subEmitters.length;t++)for(var n=0,r=this._subEmitters[t];n<r.length;n++)r[n].dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.emitter&&this.emitter.dispose&&this.emitter.dispose(!0),(t=this._scene.particleSystems.indexOf(this))>-1&&this._scene.particleSystems.splice(t,1),this._scene._activeParticleSystems.dispose(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.reset()},t.prototype.clone=function(e,n){var r=null,i=null;if(null!=this.customShader){var o=(i=this.customShader).shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";r=this._scene.getEngine().createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,o)}else this._customEffect&&(r=this._customEffect);var a=new t(e,this._capacity,this._scene,r);return a.customShader=i,M.a.DeepCopy(this,a,["particles","customShader","noiseTexture"]),void 0===n&&(n=this.emitter),a.noiseTexture=this.noiseTexture,a.emitter=n,this.particleTexture&&(a.particleTexture=new Ge.a(this.particleTexture.url,this._scene)),this._colorGradients&&this._colorGradients.forEach(function(e){a.addColorGradient(e.gradient,e.color1,e.color2)}),this._dragGradients&&this._dragGradients.forEach(function(e){a.addDragGradient(e.gradient,e.factor1,e.factor2)}),this._angularSpeedGradients&&this._angularSpeedGradients.forEach(function(e){a.addAngularSpeedGradient(e.gradient,e.factor1,e.factor2)}),this._emitRateGradients&&this._emitRateGradients.forEach(function(e){a.addEmitRateGradient(e.gradient,e.factor1,e.factor2)}),this._lifeTimeGradients&&this._lifeTimeGradients.forEach(function(e){a.addLifeTimeGradient(e.gradient,e.factor1,e.factor2)}),this._limitVelocityGradients&&this._limitVelocityGradients.forEach(function(e){a.addLimitVelocityGradient(e.gradient,e.factor1,e.factor2)}),this._sizeGradients&&this._sizeGradients.forEach(function(e){a.addSizeGradient(e.gradient,e.factor1,e.factor2)}),this._startSizeGradients&&this._startSizeGradients.forEach(function(e){a.addStartSizeGradient(e.gradient,e.factor1,e.factor2)}),this._velocityGradients&&this._velocityGradients.forEach(function(e){a.addVelocityGradient(e.gradient,e.factor1,e.factor2)}),this._rampGradients&&this._rampGradients.forEach(function(e){a.addRampGradient(e.gradient,e.color)}),this._colorRemapGradients&&this._colorRemapGradients.forEach(function(e){a.addColorRemapGradient(e.gradient,e.factor1,e.factor2)}),this._alphaRemapGradients&&this._alphaRemapGradients.forEach(function(e){a.addAlphaRemapGradient(e.gradient,e.factor1,e.factor2)}),this.preventAutoStart||a.start(),a},t.prototype.serialize=function(){var e={};if(t._Serialize(e,this),e.textureMask=this.textureMask.asArray(),e.customShader=this.customShader,e.preventAutoStart=this.preventAutoStart,this.subEmitters){e.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(var n=0,r=this._subEmitters;n<r.length;n++){for(var i=[],o=0,a=r[n];o<a.length;o++){var s=a[o];i.push(s.serialize())}e.subEmitters.push(i)}}return e},t._Serialize=function(e,t){if(e.name=t.name,e.id=t.id,e.capacity=t.getCapacity(),t.emitter.position){var n=t.emitter;e.emitterId=n.id}else{var r=t.emitter;e.emitter=r.asArray()}t.particleEmitterType&&(e.particleEmitterType=t.particleEmitterType.serialize()),t.particleTexture&&(e.textureName=t.particleTexture.name,e.invertY=t.particleTexture._invertY),D.a.AppendSerializedAnimations(t,e),e.beginAnimationOnStart=t.beginAnimationOnStart,e.beginAnimationFrom=t.beginAnimationFrom,e.beginAnimationTo=t.beginAnimationTo,e.beginAnimationLoop=t.beginAnimationLoop,e.startDelay=t.startDelay,e.renderingGroupId=t.renderingGroupId,e.isBillboardBased=t.isBillboardBased,e.billboardMode=t.billboardMode,e.minAngularSpeed=t.minAngularSpeed,e.maxAngularSpeed=t.maxAngularSpeed,e.minSize=t.minSize,e.maxSize=t.maxSize,e.minScaleX=t.minScaleX,e.maxScaleX=t.maxScaleX,e.minScaleY=t.minScaleY,e.maxScaleY=t.maxScaleY,e.minEmitPower=t.minEmitPower,e.maxEmitPower=t.maxEmitPower,e.minLifeTime=t.minLifeTime,e.maxLifeTime=t.maxLifeTime,e.emitRate=t.emitRate,e.gravity=t.gravity.asArray(),e.noiseStrength=t.noiseStrength.asArray(),e.color1=t.color1.asArray(),e.color2=t.color2.asArray(),e.colorDead=t.colorDead.asArray(),e.updateSpeed=t.updateSpeed,e.targetStopDuration=t.targetStopDuration,e.blendMode=t.blendMode,e.preWarmCycles=t.preWarmCycles,e.preWarmStepOffset=t.preWarmStepOffset,e.minInitialRotation=t.minInitialRotation,e.maxInitialRotation=t.maxInitialRotation,e.startSpriteCellID=t.startSpriteCellID,e.endSpriteCellID=t.endSpriteCellID,e.spriteCellChangeSpeed=t.spriteCellChangeSpeed,e.spriteCellWidth=t.spriteCellWidth,e.spriteCellHeight=t.spriteCellHeight,e.spriteRandomStartCell=t.spriteRandomStartCell,e.isAnimationSheetEnabled=t.isAnimationSheetEnabled;var i=t.getColorGradients();if(i){e.colorGradients=[];for(var o=0,a=i;o<a.length;o++){var s=a[o],l={gradient:s.gradient,color1:s.color1.asArray()};s.color2&&(l.color2=s.color2.asArray()),e.colorGradients.push(l)}}var u=t.getRampGradients();if(u){e.rampGradients=[];for(var c=0,h=u;c<h.length;c++){var d=h[c];l={gradient:d.gradient,color:d.color.asArray()},e.rampGradients.push(l)}e.useRampGradients=t.useRampGradients}var f=t.getColorRemapGradients();if(f){e.colorRemapGradients=[];for(var p=0,m=f;p<m.length;p++){var g=m[p];l={gradient:g.gradient,factor1:g.factor1},void 0!==g.factor2&&(l.factor2=g.factor2),e.colorRemapGradients.push(l)}}var _=t.getAlphaRemapGradients();if(_){e.alphaRemapGradients=[];for(var v=0,y=_;v<y.length;v++){var b=y[v];l={gradient:b.gradient,factor1:b.factor1},void 0!==b.factor2&&(l.factor2=b.factor2),e.alphaRemapGradients.push(l)}}var E=t.getSizeGradients();if(E){e.sizeGradients=[];for(var x=0,T=E;x<T.length;x++){var S=T[x];l={gradient:S.gradient,factor1:S.factor1},void 0!==S.factor2&&(l.factor2=S.factor2),e.sizeGradients.push(l)}}var A=t.getAngularSpeedGradients();if(A){e.angularSpeedGradients=[];for(var P=0,M=A;P<M.length;P++){var R=M[P];l={gradient:R.gradient,factor1:R.factor1},void 0!==R.factor2&&(l.factor2=R.factor2),e.angularSpeedGradients.push(l)}}var C=t.getVelocityGradients();if(C){e.velocityGradients=[];for(var w=0,O=C;w<O.length;w++){var I=O[w];l={gradient:I.gradient,factor1:I.factor1},void 0!==I.factor2&&(l.factor2=I.factor2),e.velocityGradients.push(l)}}var L=t.getDragGradients();if(L){e.dragyGradients=[];for(var F=0,N=L;F<N.length;F++){var B=N[F];l={gradient:B.gradient,factor1:B.factor1},void 0!==B.factor2&&(l.factor2=B.factor2),e.dragGradients.push(l)}}var U=t.getEmitRateGradients();if(U){e.emitRateGradients=[];for(var k=0,V=U;k<V.length;k++){var G=V[k];l={gradient:G.gradient,factor1:G.factor1},void 0!==G.factor2&&(l.factor2=G.factor2),e.emitRateGradients.push(l)}}var z=t.getStartSizeGradients();if(z){e.startSizeGradients=[];for(var j=0,H=z;j<H.length;j++){var W=H[j];l={gradient:W.gradient,factor1:W.factor1},void 0!==W.factor2&&(l.factor2=W.factor2),e.startSizeGradients.push(l)}}var X=t.getLifeTimeGradients();if(X){e.lifeTimeGradients=[];for(var Y=0,K=X;Y<K.length;Y++){var q=K[Y];l={gradient:q.gradient,factor1:q.factor1},void 0!==q.factor2&&(l.factor2=q.factor2),e.lifeTimeGradients.push(l)}}var Q=t.getLimitVelocityGradients();if(Q){e.limitVelocityGradients=[];for(var Z=0,J=Q;Z<J.length;Z++){var $=J[Z];l={gradient:$.gradient,factor1:$.factor1},void 0!==$.factor2&&(l.factor2=$.factor2),e.limitVelocityGradients.push(l)}e.limitVelocityDamping=t.limitVelocityDamping}t.noiseTexture&&(e.noiseTexture=t.noiseTexture.serialize())},t._Parse=function(e,t,n,r){if(e.textureName&&(t.particleTexture=new Ge.a(r+e.textureName,n,!1,void 0===e.invertY||e.invertY),t.particleTexture.name=e.textureName),e.emitterId||0===e.emitterId||void 0!==e.emitter?e.emitterId?t.emitter=n.getLastMeshByID(e.emitterId):t.emitter=o.x.FromArray(e.emitter):t.emitter=o.x.Zero(),void 0!==e.renderingGroupId&&(t.renderingGroupId=e.renderingGroupId),void 0!==e.isBillboardBased&&(t.isBillboardBased=e.isBillboardBased),void 0!==e.billboardMode&&(t.billboardMode=e.billboardMode),e.animations){for(var i=0;i<e.animations.length;i++){var s=e.animations[i],l=a.a.GetClass("BABYLON.Animation");l&&t.animations.push(l.Parse(s))}t.beginAnimationOnStart=e.beginAnimationOnStart,t.beginAnimationFrom=e.beginAnimationFrom,t.beginAnimationTo=e.beginAnimationTo,t.beginAnimationLoop=e.beginAnimationLoop}if(e.autoAnimate&&n.beginAnimation(t,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),t.startDelay=0|e.startDelay,t.minAngularSpeed=e.minAngularSpeed,t.maxAngularSpeed=e.maxAngularSpeed,t.minSize=e.minSize,t.maxSize=e.maxSize,e.minScaleX&&(t.minScaleX=e.minScaleX,t.maxScaleX=e.maxScaleX,t.minScaleY=e.minScaleY,t.maxScaleY=e.maxScaleY),void 0!==e.preWarmCycles&&(t.preWarmCycles=e.preWarmCycles,t.preWarmStepOffset=e.preWarmStepOffset),void 0!==e.minInitialRotation&&(t.minInitialRotation=e.minInitialRotation,t.maxInitialRotation=e.maxInitialRotation),t.minLifeTime=e.minLifeTime,t.maxLifeTime=e.maxLifeTime,t.minEmitPower=e.minEmitPower,t.maxEmitPower=e.maxEmitPower,t.emitRate=e.emitRate,t.gravity=o.x.FromArray(e.gravity),e.noiseStrength&&(t.noiseStrength=o.x.FromArray(e.noiseStrength)),t.color1=o.f.FromArray(e.color1),t.color2=o.f.FromArray(e.color2),t.colorDead=o.f.FromArray(e.colorDead),t.updateSpeed=e.updateSpeed,t.targetStopDuration=e.targetStopDuration,t.blendMode=e.blendMode,e.colorGradients)for(var u=0,c=e.colorGradients;u<c.length;u++){var h=c[u];t.addColorGradient(h.gradient,o.f.FromArray(h.color1),h.color2?o.f.FromArray(h.color2):void 0)}if(e.rampGradients){for(var d=0,f=e.rampGradients;d<f.length;d++){var p=f[d];t.addRampGradient(p.gradient,o.e.FromArray(p.color))}t.useRampGradients=e.useRampGradients}if(e.colorRemapGradients)for(var m=0,g=e.colorRemapGradients;m<g.length;m++){var _=g[m];t.addColorRemapGradient(_.gradient,void 0!==_.factor1?_.factor1:_.factor,_.factor2)}if(e.alphaRemapGradients)for(var v=0,y=e.alphaRemapGradients;v<y.length;v++){var b=y[v];t.addAlphaRemapGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2)}if(e.sizeGradients)for(var E=0,x=e.sizeGradients;E<x.length;E++){var T=x[E];t.addSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2)}if(e.sizeGradients)for(var S=0,A=e.sizeGradients;S<A.length;S++)T=A[S],t.addSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(e.angularSpeedGradients)for(var P=0,M=e.angularSpeedGradients;P<M.length;P++){var R=M[P];t.addAngularSpeedGradient(R.gradient,void 0!==R.factor1?R.factor1:R.factor,R.factor2)}if(e.velocityGradients)for(var C=0,w=e.velocityGradients;C<w.length;C++){var O=w[C];t.addVelocityGradient(O.gradient,void 0!==O.factor1?O.factor1:O.factor,O.factor2)}if(e.dragGradients)for(var I=0,D=e.dragGradients;I<D.length;I++){var L=D[I];t.addDragGradient(L.gradient,void 0!==L.factor1?L.factor1:L.factor,L.factor2)}if(e.emitRateGradients)for(var F=0,N=e.emitRateGradients;F<N.length;F++){var B=N[F];t.addEmitRateGradient(B.gradient,void 0!==B.factor1?B.factor1:B.factor,B.factor2)}if(e.startSizeGradients)for(var U=0,k=e.startSizeGradients;U<k.length;U++){var V=k[U];t.addStartSizeGradient(V.gradient,void 0!==V.factor1?V.factor1:V.factor,V.factor2)}if(e.lifeTimeGradients)for(var G=0,z=e.lifeTimeGradients;G<z.length;G++){var j=z[G];t.addLifeTimeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2)}if(e.limitVelocityGradients){for(var H=0,W=e.limitVelocityGradients;H<W.length;H++){var X=W[H];t.addLimitVelocityGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2)}t.limitVelocityDamping=e.limitVelocityDamping}var Y;if(e.noiseTexture&&(t.noiseTexture=To.Parse(e.noiseTexture,n,r)),e.particleEmitterType){switch(e.particleEmitterType.type){case"SphereParticleEmitter":Y=new Aa;break;case"SphereDirectedParticleEmitter":Y=new Pa;break;case"ConeEmitter":case"ConeParticleEmitter":Y=new ba;break;case"CylinderParticleEmitter":Y=new Ea;break;case"HemisphericParticleEmitter":Y=new Ta;break;case"BoxEmitter":case"BoxParticleEmitter":default:Y=new ya}Y.parse(e.particleEmitterType)}else(Y=new ya).parse(e);t.particleEmitterType=Y,t.startSpriteCellID=e.startSpriteCellID,t.endSpriteCellID=e.endSpriteCellID,t.spriteCellWidth=e.spriteCellWidth,t.spriteCellHeight=e.spriteCellHeight,t.spriteCellChangeSpeed=e.spriteCellChangeSpeed,t.spriteRandomStartCell=e.spriteRandomStartCell},t.Parse=function(e,n,r,i){void 0===i&&(i=!1);var a=e.name,s=null,l=null;if(e.customShader){var u=(l=e.customShader).shaderOptions.defines.length>0?l.shaderOptions.defines.join("\n"):"";s=n.getEngine().createEffectForParticles(l.shaderPath.fragmentElement,l.shaderOptions.uniforms,l.shaderOptions.samplers,u)}var c=new t(a,e.capacity,n,s,e.isAnimationSheetEnabled);if(c.customShader=l,e.id&&(c.id=e.id),e.subEmitters){c.subEmitters=[];for(var h=0,d=e.subEmitters;h<d.length;h++){for(var f=[],p=0,m=d[h];p<m.length;p++){var g=m[p];f.push(Ca.Parse(g,n,r))}c.subEmitters.push(f)}}return t._Parse(e,c,n,r),c.textureMask=o.f.FromArray(e.textureMask),e.preventAutoStart&&(c.preventAutoStart=e.preventAutoStart),i||c.preventAutoStart||c.start(),c},t.BILLBOARDMODE_Y=m.a.PARTICLES_BILLBOARDMODE_Y,t.BILLBOARDMODE_ALL=m.a.PARTICLES_BILLBOARDMODE_ALL,t.BILLBOARDMODE_STRETCHED=m.a.PARTICLES_BILLBOARDMODE_STRETCHED,t}(Ma);Ca._ParseParticleSystem=wa.Parse,zt.a.ShadersStore.gpuUpdateParticlesPixelShader="#version 300 es\nvoid main() {\ndiscard;\n}\n",zt.a.ShadersStore.gpuUpdateParticlesVertexShader="#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\nuniform mat4 emitterWM;\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\n\nin vec3 position;\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\n\nout vec3 outPosition;\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif\n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta;\n\nif (newAge>=life && stopFactor != 0.) {\nvec3 position;\nvec3 direction;\n\nvec4 randoms=getRandomVec4(seed.x);\n\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=mod(newAge,outLife);\n\noutSeed=seed;\n\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;\n#ifndef COLORGRADIENTS\n\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n\n#ifndef ANGULARSPEEDGRADIENTS\noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif\n\n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=vec3(0,0,0);\ndirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nposition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\ndirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\ndirection=position+directionRandomizer*randoms3;\n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nposition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\ndirection=position+directionRandomizer*randoms3;\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nposition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nangle=angle+((randoms3.x-0.5)*PI);\ndirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));\ndirection=normalize(direction);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.00001;\n#else\nfloat h=randoms2.y*height.y;\n\nh=1.-h*h;\n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h*height.x;\nposition=vec3(randX,randY,randZ);\n\nif (abs(cos(coneAngle)) == 1.0) {\ndirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\ndirection=position+directionRandomizer*randoms3;\n}\n#else\n\nposition=vec3(0.,0.,0.);\n\ndirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\noutPosition=(emitterWM*vec4(position,1.)).xyz;\nvec3 initial=(emitterWM*vec4(direction,0.)).xyz;\noutDirection=initial*power;\n#ifndef BILLBOARD\noutInitialDirection=initial;\n#endif\n#ifdef ANIMATESHEET\noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif\n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\noutPosition=position+direction*directionScale;\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS\noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif\n#ifndef BILLBOARD\noutInitialDirection=initialDirection;\n#endif\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nvec3 localPosition=outPosition-emitterWM[3].xyz;\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET\nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#endif\nfloat ratio=clamp(mod(offsetAge*cellInfos.z,life)/life,0.,1.0);\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}",zt.a.IncludesShadersStore.clipPlaneFragmentDeclaration2="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif",zt.a.ShadersStore.gpuRenderParticlesPixelShader="#version 300 es\nuniform sampler2D textureSampler;\nin vec2 vUV;\nin vec4 vColor;\nout vec4 outFragColor;\n#include<clipPlaneFragmentDeclaration2>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment>\nvec4 textureColor=texture(textureSampler,vUV);\noutFragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\noutFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\noutFragColor=applyImageProcessing(outFragColor);\n#endif\n#endif\n}\n",zt.a.IncludesShadersStore.clipPlaneVertexDeclaration2="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif",zt.a.ShadersStore.gpuRenderParticlesVertexShader="#version 300 es\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\nuniform vec3 worldOffset;\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 size;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nin vec3 direction;\n#endif\nin float angle;\n#ifdef ANIMATESHEET\nin float cellIndex;\n#endif\nin vec2 offset;\nin vec2 uv;\nout vec2 vUV;\nout vec4 vColor;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nin vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn (position+worldOffset)+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn (position+worldOffset)+alignedCorner;\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=(position+worldOffset)-eyePosition;\nyaxis.y=0.;\nvec3 worldPos=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=(position+worldOffset)-eyePosition;\nvec3 worldPos=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(worldPos,1.0));\n#else\n\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvec3 worldPos=rotate(yaxis,rotatedCorner);\n\nvec4 viewPosition=view*vec4(worldPos,1.0);\n#endif\ngl_Position=projection*viewPosition;\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4)\nvec4 worldPos=invView*viewPosition;\n#endif\n#include<clipPlaneVertex>\n}";var Oa=function(e){function t(t,n,r,o){void 0===o&&(o=!1);var a=e.call(this,t)||this;a.layerMask=268435455,a._accumulatedCount=0,a._targetIndex=0,a._currentRenderId=-1,a._started=!1,a._stopped=!1,a._timeDelta=0,a._actualFrame=0,a._rawTextureWidth=256,a.onDisposeObservable=new i.c,a.forceDepthWrite=!1,a._preWarmDone=!1,a._scene=r||P.a.LastCreatedScene,a._attachImageProcessingConfiguration(null),a._engine=a._scene.getEngine(),n.randomTextureSize||delete n.randomTextureSize;var s=u.a({capacity:5e4,randomTextureSize:a._engine.getCaps().maxTextureSize},n),l=n;isFinite(l)&&(s.capacity=l),a._capacity=s.capacity,a._activeCount=s.capacity,a._currentActiveCount=0,a._isAnimationSheetEnabled=o,a._scene.particleSystems.push(a),a._updateEffectOptions={attributes:["position","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]},a.particleEmitterType=new ya;for(var c=Math.min(a._engine.getCaps().maxTextureSize,s.randomTextureSize),h=[],d=0;d<c;++d)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());for(a._randomTexture=new je(new Float32Array(h),c,1,m.a.TEXTUREFORMAT_RGBA,a._scene,!1,!1,m.a.TEXTURE_NEAREST_SAMPLINGMODE,m.a.TEXTURETYPE_FLOAT),a._randomTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,a._randomTexture.wrapV=Ge.a.WRAP_ADDRESSMODE,h=[],d=0;d<c;++d)h.push(Math.random()),h.push(Math.random()),h.push(Math.random()),h.push(Math.random());return a._randomTexture2=new je(new Float32Array(h),c,1,m.a.TEXTUREFORMAT_RGBA,a._scene,!1,!1,m.a.TEXTURE_NEAREST_SAMPLINGMODE,m.a.TEXTURETYPE_FLOAT),a._randomTexture2.wrapU=Ge.a.WRAP_ADDRESSMODE,a._randomTexture2.wrapV=Ge.a.WRAP_ADDRESSMODE,a._randomTextureSize=c,a}return u.d(t,e),Object.defineProperty(t,"IsSupported",{get:function(){return!!P.a.LastCreatedEngine&&P.a.LastCreatedEngine.webGLVersion>1},enumerable:!0,configurable:!0}),t.prototype.getCapacity=function(){return this._capacity},Object.defineProperty(t.prototype,"activeParticleCount",{get:function(){return this._activeCount},set:function(e){this._activeCount=Math.min(e,this._capacity)},enumerable:!0,configurable:!0}),t.prototype.isReady=function(){return this._updateEffect?!!(this.emitter&&this._updateEffect.isReady()&&this._imageProcessingConfiguration.isReady()&&this._renderEffect.isReady()&&this.particleTexture&&this.particleTexture.isReady()):(this._recreateUpdateEffect(),this._recreateRenderEffect(),!1)},t.prototype.isStarted=function(){return this._started},t.prototype.start=function(e){var t=this;if(void 0===e&&(e=this.startDelay),!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";e?setTimeout(function(){t.start(0)},e):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this.getScene().beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._releaseBuffers(),this._releaseVAOs(),this._currentActiveCount=0,this._targetIndex=0},t.prototype.getClassName=function(){return"GPUParticleSystem"},t.prototype._removeGradientAndTexture=function(t,n,r){return e.prototype._removeGradientAndTexture.call(this,t,n,r),this._releaseBuffers(),this},t.prototype.addColorGradient=function(e,t,n){this._colorGradients||(this._colorGradients=[]);var r=new ye.c;return r.gradient=e,r.color1=t,this._colorGradients.push(r),this._colorGradients.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeColorGradient=function(e){return this._removeGradientAndTexture(e,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this},t.prototype._addFactorGradient=function(e,t,n){var r=new ye.d;r.gradient=t,r.factor1=n,e.push(r),e.sort(function(e,t){return e.gradient<t.gradient?-1:e.gradient>t.gradient?1:0}),this._releaseBuffers()},t.prototype.addSizeGradient=function(e,t){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,e,t),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeSizeGradient=function(e){return this._removeGradientAndTexture(e,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this},t.prototype.addAngularSpeedGradient=function(e,t){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,e,t),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeAngularSpeedGradient=function(e){return this._removeGradientAndTexture(e,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this},t.prototype.addVelocityGradient=function(e,t){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,e,t),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this},t.prototype.addLimitVelocityGradient=function(e,t){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,e,t),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeLimitVelocityGradient=function(e){return this._removeGradientAndTexture(e,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this},t.prototype.addDragGradient=function(e,t){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,e,t),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._releaseBuffers(),this},t.prototype.removeDragGradient=function(e){return this._removeGradientAndTexture(e,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this},t.prototype.addEmitRateGradient=function(e,t,n){return this},t.prototype.removeEmitRateGradient=function(e){return this},t.prototype.addStartSizeGradient=function(e,t,n){return this},t.prototype.removeStartSizeGradient=function(e){return this},t.prototype.addColorRemapGradient=function(e,t,n){return this},t.prototype.removeColorRemapGradient=function(){return this},t.prototype.addAlphaRemapGradient=function(e,t,n){return this},t.prototype.removeAlphaRemapGradient=function(){return this},t.prototype.addRampGradient=function(e,t){return this},t.prototype.removeRampGradient=function(){return this},t.prototype.getRampGradients=function(){return null},Object.defineProperty(t.prototype,"useRampGradients",{get:function(){return!1},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.addLifeTimeGradient=function(e,t,n){return this},t.prototype.removeLifeTimeGradient=function(e){return this},t.prototype._reset=function(){this._releaseBuffers()},t.prototype._createUpdateVAO=function(e){var t={};t.position=e.createVertexBuffer("position",0,3),t.age=e.createVertexBuffer("age",3,1),t.life=e.createVertexBuffer("life",4,1),t.seed=e.createVertexBuffer("seed",5,4),t.size=e.createVertexBuffer("size",9,3);var n=12;this._colorGradientsTexture||(t.color=e.createVertexBuffer("color",n,4),n+=4),t.direction=e.createVertexBuffer("direction",n,3),n+=3,this._isBillboardBased||(t.initialDirection=e.createVertexBuffer("initialDirection",n,3),n+=3),this._angularSpeedGradientsTexture?(t.angle=e.createVertexBuffer("angle",n,1),n+=1):(t.angle=e.createVertexBuffer("angle",n,2),n+=2),this._isAnimationSheetEnabled&&(t.cellIndex=e.createVertexBuffer("cellIndex",n,1),n+=1,this.spriteRandomStartCell&&(t.cellStartOffset=e.createVertexBuffer("cellStartOffset",n,1),n+=1)),this.noiseTexture&&(t.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",n,3),n+=3,t.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",n,3),n+=3);var r=this._engine.recordVertexArrayObject(t,null,this._updateEffect);return this._engine.bindArrayBuffer(null),r},t.prototype._createRenderVAO=function(e,t){var n={};n.position=e.createVertexBuffer("position",0,3,this._attributesStrideSize,!0),n.age=e.createVertexBuffer("age",3,1,this._attributesStrideSize,!0),n.life=e.createVertexBuffer("life",4,1,this._attributesStrideSize,!0),n.size=e.createVertexBuffer("size",9,3,this._attributesStrideSize,!0);var r=12;this._colorGradientsTexture||(n.color=e.createVertexBuffer("color",r,4,this._attributesStrideSize,!0),r+=4),this.billboardMode===wa.BILLBOARDMODE_STRETCHED&&(n.direction=e.createVertexBuffer("direction",r,3,this._attributesStrideSize,!0)),r+=3,this._isBillboardBased||(n.initialDirection=e.createVertexBuffer("initialDirection",r,3,this._attributesStrideSize,!0),r+=3),n.angle=e.createVertexBuffer("angle",r,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?r++:r+=2,this._isAnimationSheetEnabled&&(n.cellIndex=e.createVertexBuffer("cellIndex",r,1,this._attributesStrideSize,!0),r+=1,this.spriteRandomStartCell&&(n.cellStartOffset=e.createVertexBuffer("cellStartOffset",r,1,this._attributesStrideSize,!0),r+=1)),this.noiseTexture&&(n.noiseCoordinates1=e.createVertexBuffer("noiseCoordinates1",r,3,this._attributesStrideSize,!0),r+=3,n.noiseCoordinates2=e.createVertexBuffer("noiseCoordinates2",r,3,this._attributesStrideSize,!0),r+=3),n.offset=t.createVertexBuffer("offset",0,2),n.uv=t.createVertexBuffer("uv",2,2);var i=this._engine.recordVertexArrayObject(n,null,this._renderEffect);return this._engine.bindArrayBuffer(null),i},t.prototype._initialize=function(e){if(void 0===e&&(e=!1),!this._buffer0||e){var t=this._scene.getEngine(),n=new Array;this._attributesStrideSize=21,this._targetIndex=0,this.isBillboardBased||(this._attributesStrideSize+=3),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6);for(var r=0;r<this._capacity;r++)n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(0),n.push(0),n.push(0),this._colorGradientsTexture||(n.push(0),n.push(0),n.push(0),n.push(0)),n.push(0),n.push(0),n.push(0),this.isBillboardBased||(n.push(0),n.push(0),n.push(0)),n.push(0),this._angularSpeedGradientsTexture||n.push(0),this._isAnimationSheetEnabled&&(n.push(0),this.spriteRandomStartCell&&n.push(0)),this.noiseTexture&&(n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()));var i=new Float32Array([.5,.5,1,1,-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0]);this._buffer0=new Sn.a(t,n,!1,this._attributesStrideSize),this._buffer1=new Sn.a(t,n,!1,this._attributesStrideSize),this._spriteBuffer=new Sn.a(t,i,!1,4),this._updateVAO=[],this._updateVAO.push(this._createUpdateVAO(this._buffer0)),this._updateVAO.push(this._createUpdateVAO(this._buffer1)),this._renderVAO=[],this._renderVAO.push(this._createRenderVAO(this._buffer1,this._spriteBuffer)),this._renderVAO.push(this._createRenderVAO(this._buffer0,this._spriteBuffer)),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}},t.prototype._recreateUpdateEffect=function(){var e=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";this._isBillboardBased&&(e+="\n#define BILLBOARD"),this._colorGradientsTexture&&(e+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(e+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(e+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(e+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(e+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(e+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(e+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(e+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(e+="\n#define NOISE"),this._updateEffect&&this._updateEffectOptions.defines===e||(this._updateEffectOptions.transformFeedbackVaryings=["outPosition","outAge","outLife","outSeed","outSize"],this._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.defines=e,this._updateEffect=new zt.a("gpuUpdateParticles",this._updateEffectOptions,this._scene.getEngine()))},t.prototype._recreateRenderEffect=function(){var e="";if(this._scene.clipPlane&&(e="\n#define CLIPPLANE"),this._scene.clipPlane2&&(e="\n#define CLIPPLANE2"),this._scene.clipPlane3&&(e="\n#define CLIPPLANE3"),this._scene.clipPlane4&&(e="\n#define CLIPPLANE4"),this.blendMode===wa.BLENDMODE_MULTIPLY&&(e="\n#define BLENDMULTIPLYMODE"),this._isBillboardBased)switch(e+="\n#define BILLBOARD",this.billboardMode){case wa.BILLBOARDMODE_Y:e+="\n#define BILLBOARDY";break;case wa.BILLBOARDMODE_STRETCHED:e+="\n#define BILLBOARDSTRETCHED";break;case wa.BILLBOARDMODE_ALL:}if(this._colorGradientsTexture&&(e+="\n#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&(e+="\n#define ANIMATESHEET"),this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),e+="\n"+this._imageProcessingConfigurationDefines.toString()),!this._renderEffect||this._renderEffect.defines!==e){var t=["worldOffset","view","projection","colorDead","invView","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","sheetInfos","translationPivot","eyePosition"],n=["textureSampler","colorGradientSampler"];vn.a&&(vn.a.PrepareUniforms(t,this._imageProcessingConfigurationDefines),vn.a.PrepareSamplers(n,this._imageProcessingConfigurationDefines)),this._renderEffect=new zt.a("gpuRenderParticles",["position","age","life","size","color","offset","uv","direction","initialDirection","angle","cellIndex"],t,n,this._scene.getEngine(),e)}},t.prototype.animate=function(e){void 0===e&&(e=!1),this._timeDelta=this.updateSpeed*(e?this.preWarmStepOffset:this._scene.getAnimationRatio()),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()},t.prototype._createFactorGradientTexture=function(e,t){var n=this[t];if(e&&e.length&&!n){for(var r=new Float32Array(this._rawTextureWidth),i=0;i<this._rawTextureWidth;i++){var o=i/this._rawTextureWidth;ye.h.GetCurrentGradient(o,e,function(e,t,n){r[i]=I.a.Lerp(e.factor1,t.factor1,n)})}this[t]=je.CreateRTexture(r,this._rawTextureWidth,1,this._scene,!1,!1,Ge.a.NEAREST_SAMPLINGMODE)}},t.prototype._createSizeGradientTexture=function(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")},t.prototype._createAngularSpeedGradientTexture=function(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")},t.prototype._createVelocityGradientTexture=function(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")},t.prototype._createLimitVelocityGradientTexture=function(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")},t.prototype._createDragGradientTexture=function(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")},t.prototype._createColorGradientTexture=function(){if(this._colorGradients&&this._colorGradients.length&&!this._colorGradientsTexture){for(var e=new Uint8Array(4*this._rawTextureWidth),t=o.t.Color4[0],n=0;n<this._rawTextureWidth;n++){var r=n/this._rawTextureWidth;ye.h.GetCurrentGradient(r,this._colorGradients,function(r,i,a){o.f.LerpToRef(r.color1,i.color1,a,t),e[4*n]=255*t.r,e[4*n+1]=255*t.g,e[4*n+2]=255*t.b,e[4*n+3]=255*t.a})}this._colorGradientsTexture=je.CreateRGBATexture(e,this._rawTextureWidth,1,this._scene,!1,!1,Ge.a.NEAREST_SAMPLINGMODE)}},t.prototype.render=function(e){if(void 0===e&&(e=!1),!this._started)return 0;if(this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture(),this._recreateUpdateEffect(),this._recreateRenderEffect(),!this.isReady())return 0;if(!e){if(!this._preWarmDone&&this.preWarmCycles){for(var t=0;t<this.preWarmCycles;t++)this.animate(!0),this.render(!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getFrameId())return 0;this._currentRenderId=this._scene.getFrameId()}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){var n=0|this._accumulatedCount;this._accumulatedCount-=n,this._currentActiveCount=Math.min(this._activeCount,this._currentActiveCount+n)}if(!this._currentActiveCount)return 0;var r;if(this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._updateEffect.setFloat("currentCount",this._currentActiveCount),this._updateEffect.setFloat("timeDelta",this._timeDelta),this._updateEffect.setFloat("stopFactor",this._stopped?0:1),this._updateEffect.setTexture("randomSampler",this._randomTexture),this._updateEffect.setTexture("randomSampler2",this._randomTexture2),this._updateEffect.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateEffect.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateEffect.setDirectColor4("color1",this.color1),this._updateEffect.setDirectColor4("color2",this.color2)),this._updateEffect.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateEffect.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateEffect.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateEffect.setVector3("gravity",this.gravity),this._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._sizeGradientsTexture),this._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._angularSpeedGradientsTexture),this._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._velocityGradientsTexture),this._limitVelocityGradientsTexture&&(this._updateEffect.setTexture("limitVelocityGradientSampler",this._limitVelocityGradientsTexture),this._updateEffect.setFloat("limitVelocityDamping",this.limitVelocityDamping)),this._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._dragGradientsTexture),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateEffect),this._isAnimationSheetEnabled&&this._updateEffect.setFloat3("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed),this.noiseTexture&&(this._updateEffect.setTexture("noiseSampler",this.noiseTexture),this._updateEffect.setVector3("noiseStrength",this.noiseStrength)),this.emitter.position)r=this.emitter.getWorldMatrix();else{var i=this.emitter;r=o.j.Translation(i.x,i.y,i.z)}if(this._updateEffect.setMatrix("emitterWM",r),this._engine.bindVertexArrayObject(this._updateVAO[this._targetIndex],null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(!0),this._engine.drawArraysType(Mi.a.PointListDrawMode,0,this._currentActiveCount),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),!e){this._engine.enableEffect(this._renderEffect);var a=this._scene.getViewMatrix();if(this._renderEffect.setMatrix("view",a),this._renderEffect.setMatrix("projection",this._scene.getProjectionMatrix()),this._renderEffect.setTexture("textureSampler",this.particleTexture),this._renderEffect.setVector2("translationPivot",this.translationPivot),this._renderEffect.setVector3("worldOffset",this.worldOffset),this._colorGradientsTexture?this._renderEffect.setTexture("colorGradientSampler",this._colorGradientsTexture):this._renderEffect.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){var s=this.particleTexture.getBaseSize();this._renderEffect.setFloat3("sheetInfos",this.spriteCellWidth/s.width,this.spriteCellHeight/s.height,s.width/this.spriteCellWidth)}if(this._isBillboardBased){var l=this._scene.activeCamera;this._renderEffect.setVector3("eyePosition",l.globalPosition)}if(this._scene.clipPlane||this._scene.clipPlane2||this._scene.clipPlane3||this._scene.clipPlane4){var u=a.clone();u.invert(),this._renderEffect.setMatrix("invView",u),Wr.a.BindClipPlane(this._renderEffect,this._scene)}switch(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._renderEffect),this.blendMode){case wa.BLENDMODE_ADD:this._engine.setAlphaMode(m.a.ALPHA_ADD);break;case wa.BLENDMODE_ONEONE:this._engine.setAlphaMode(m.a.ALPHA_ONEONE);break;case wa.BLENDMODE_STANDARD:this._engine.setAlphaMode(m.a.ALPHA_COMBINE);break;case wa.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(m.a.ALPHA_MULTIPLY)}this.forceDepthWrite&&this._engine.setDepthWrite(!0),this._engine.bindVertexArrayObject(this._renderVAO[this._targetIndex],null),this._engine.drawArraysType(Mi.a.TriangleFanDrawMode,0,4,this._currentActiveCount),this._engine.setAlphaMode(m.a.ALPHA_DISABLE)}this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);var c=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=c,this._currentActiveCount},t.prototype.rebuild=function(){this._initialize(!0)},t.prototype._releaseBuffers=function(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null)},t.prototype._releaseVAOs=function(){if(this._updateVAO){for(var e=0;e<this._updateVAO.length;e++)this._engine.releaseVertexArrayObject(this._updateVAO[e]);for(this._updateVAO=[],e=0;e<this._renderVAO.length;e++)this._engine.releaseVertexArrayObject(this._renderVAO[e]);this._renderVAO=[]}},t.prototype.dispose=function(e){void 0===e&&(e=!0);var t=this._scene.particleSystems.indexOf(this);t>-1&&this._scene.particleSystems.splice(t,1),this._releaseBuffers(),this._releaseVAOs(),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),e&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),e&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.clone=function(e,n){var r=new t(e,{capacity:this._capacity,randomTextureSize:this._randomTextureSize},this._scene);return M.a.DeepCopy(this,r),void 0===n&&(n=this.emitter),r.emitter=n,this.particleTexture&&(r.particleTexture=new Ge.a(this.particleTexture.url,this._scene)),r},t.prototype.serialize=function(){var e={};return wa._Serialize(e,this),e.activeParticleCount=this.activeParticleCount,e},t.Parse=function(e,n,r,i){void 0===i&&(i=!1);var o=new t(e.name,{capacity:e.capacity,randomTextureSize:e.randomTextureSize},n);return e.activeParticleCount&&(o.activeParticleCount=e.activeParticleCount),wa._Parse(e,o,n,r),e.preventAutoStart&&(o.preventAutoStart=e.preventAutoStart),i||o.preventAutoStart||o.start(),o},t}(Ma),Ia=function(){function e(){this.systems=new Array}return Object.defineProperty(e.prototype,"emitterNode",{get:function(){return this._emitterNode},enumerable:!0,configurable:!0}),e.prototype.setEmitterAsSphere=function(e,t,n){this._emitterNode&&this._emitterNode.dispose(),this._emitterCreationOptions={kind:"Sphere",options:e,renderingGroupId:t};var r=Pr.a.CreateSphere("emitterSphere",{diameter:e.diameter,segments:e.segments},n);r.renderingGroupId=t;var i=new yn.a("emitterSphereMaterial",n);i.emissiveColor=e.color,r.material=i;for(var o=0,a=this.systems;o<a.length;o++)a[o].emitter=r;this._emitterNode=r},e.prototype.start=function(e){for(var t=0,n=this.systems;t<n.length;t++){var r=n[t];e&&(r.emitter=e),r.start()}},e.prototype.dispose=function(){for(var e=0,t=this.systems;e<t.length;e++)t[e].dispose();this.systems=[],this._emitterNode&&(this._emitterNode.dispose(),this._emitterNode=null)},e.prototype.serialize=function(){for(var e={systems:[]},t=0,n=this.systems;t<n.length;t++){var r=n[t];e.systems.push(r.serialize())}return this._emitterNode&&(e.emitter=this._emitterCreationOptions),e},e.Parse=function(t,n,r){void 0===r&&(r=!1);var i=new e,a=m.a.PARTICLES_BaseAssetsUrl+"/textures/";n=n||P.a.LastCreatedScene;for(var s=0,l=t.systems;s<l.length;s++){var u=l[s];i.systems.push(r?Oa.Parse(u,n,a,!0):wa.Parse(u,n,a,!0))}if(t.emitter){var c=t.emitter.options;switch(t.emitter.kind){case"Sphere":i.setEmitterAsSphere({diameter:c.diameter,segments:c.segments,color:o.e.FromArray(c.color)},t.emitter.renderingGroupId,n)}}return i},e}(),Da=function(){function e(){}return e.CreateDefault=function(e,t,n,r){var i;return void 0===t&&(t=500),void 0===r&&(r=!1),(i=r?new Oa("default system",{capacity:t},n):new wa("default system",t,n)).emitter=e,i.particleTexture=new Ge.a("https://www.babylonjs.com/assets/Flare.png",i.getScene()),i.createConeEmitter(.1,Math.PI/4),i.color1=new o.f(1,1,1,1),i.color2=new o.f(1,1,1,1),i.colorDead=new o.f(1,1,1,0),i.minSize=.1,i.maxSize=.1,i.minEmitPower=2,i.maxEmitPower=2,i.updateSpeed=1/60,i.emitRate=30,i},e.CreateAsync=function(t,n,r){void 0===r&&(r=!1),n||(n=P.a.LastCreatedScene);var i={};return n._addPendingData(i),new Promise(function(o,a){if(r&&!Oa.IsSupported)return n._removePendingData(i),a("Particle system with GPU is not supported.");ye.h.LoadFile(e.BaseAssetsUrl+"/systems/"+t+".json",function(e){n._removePendingData(i);var t=JSON.parse(e.toString());return o(Ia.Parse(t,n,r))},void 0,void 0,void 0,function(){return n._removePendingData(i),a("An error occured while the creation of your particle system. Check if your type '"+t+"' exists.")})})},e.ExportSet=function(e){for(var t=new Ia,n=0,r=e;n<r.length;n++){var i=r[n];t.systems.push(i)}return t},e.BaseAssetsUrl=m.a.PARTICLES_BaseAssetsUrl,e}();r.a.AddParser(Te.a.NAME_PARTICLESYSTEM,function(e,t,n,i){var o=r.a.GetIndividualParser(Te.a.NAME_PARTICLESYSTEM);if(o&&void 0!==e.particleSystems&&null!==e.particleSystems)for(var a=0,s=e.particleSystems.length;a<s;a++){var l=e.particleSystems[a];n.particleSystems.push(o(l,t,i))}}),r.a.AddIndividualParser(Te.a.NAME_PARTICLESYSTEM,function(e,t,n){return e.activeParticleCount?Oa.Parse(e,t,n):wa.Parse(e,t,n)}),ge.b.prototype.createEffectForParticles=function(e,t,n,r,i,o,a){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");var s=wa._GetAttributeNamesOrOptions(),l=wa._GetEffectCreationOptions();return-1===r.indexOf(" BILLBOARD")&&(r+="\n#define BILLBOARD\n"),-1===n.indexOf("diffuseSampler")&&n.push("diffuseSampler"),this.createEffect({vertex:"particles",fragmentElement:e},s,l.concat(t),n,r,i,o,a)},fe.a.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var n=this.getScene().particleSystems[t];n.emitter===this&&e.push(n)}return e},fe.a.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var n=0;n<this.getScene().particleSystems.length;n++){var r=this.getScene().particleSystems[n],i=r.emitter;i.position&&-1!==t.indexOf(i)&&e.push(r)}return e};var La=function(){function e(e,t,n,r,i,a,s,l){void 0===l&&(l=null),this.idx=0,this.color=new o.f(1,1,1,1),this.position=o.x.Zero(),this.rotation=o.x.Zero(),this.scaling=o.x.One(),this.uvs=new o.y(0,0,1,1),this.velocity=o.x.Zero(),this.pivot=o.x.Zero(),this.translateFromPivot=!1,this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this.cullingStrategy=Fe.a.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this._globalPosition=o.x.Zero(),this.idx=e,this._pos=t,this._ind=n,this._model=r,this.shapeId=i,this.idxInShape=a,this._sps=s,l&&(this._modelBoundingInfo=l,this._boundingInfo=new Jn.a(l.minimum,l.maximum))}return Object.defineProperty(e.prototype,"scale",{get:function(){return this.scaling},set:function(e){this.scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(e){this.rotationQuaternion=e},enumerable:!0,configurable:!0}),e.prototype.intersectsMesh=function(e){return!(!this._boundingInfo||!e._boundingInfo)&&(this._sps._bSphereOnly?$n.a.Intersects(this._boundingInfo.boundingSphere,e._boundingInfo.boundingSphere):this._boundingInfo.intersects(e._boundingInfo,!1))},e.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},e.prototype.getRotationMatrix=function(e){var t;if(this.rotationQuaternion)t=this.rotationQuaternion;else{t=o.t.Quaternion[0];var n=this.rotation;o.q.RotationYawPitchRollToRef(n.y,n.x,n.z,t)}t.toRotationMatrix(e)},e}(),Fa=function(e,t,n,r,i,o){this._indicesLength=0,this.shapeID=e,this._shape=t,this._indicesLength=n,this._shapeUV=r,this._positionFunction=i,this._vertexFunction=o},Na=function(){this.ind=0,this.indicesLength=0,this.sqDistance=0},Ba=function(e,t){return t.sqDistance-e.sqDistance},Ua=function(){function e(e,t,n){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!0,this.counter=0,this.vars={},this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._shapeCounter=0,this._copy=new La(0,0,0,null,0,0,this),this._color=new o.f(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._mustUnrotateFixedNormals=!1,this._particlesIntersect=!1,this._needs32Bits=!1,this.name=e,this._scene=t||P.a.LastCreatedScene,this._camera=t.activeCamera,this._pickable=!!n&&n.isPickable,this._depthSort=!!n&&n.enableDepthSort,this._particlesIntersect=!!n&&n.particleIntersection,this._bSphereOnly=!!n&&n.boundingSphereOnly,this._bSphereRadiusFactor=n&&n.bSphereRadiusFactor?n.bSphereRadiusFactor:1,n&&void 0!==n.updatable?this._updatable=n.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),this._depthSort&&(this.depthSortedParticles=[])}return e.prototype.buildMesh=function(){if(0===this.nbParticles){var e=Yo.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(e,1),e.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),this.recomputeNormals&&Tn.a.ComputeNormals(this._positions32,this._indices32,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var t=new Tn.a;t.indices=this._depthSort?this._indices:this._indices32,t.set(this._positions32,Sn.b.PositionKind),t.set(this._normals32,Sn.b.NormalKind),this._uvs32.length>0&&t.set(this._uvs32,Sn.b.UVKind),this._colors32.length>0&&t.set(this._colors32,Sn.b.ColorKind);var n=new fe.a(this.name,this._scene);return t.applyToMesh(n,this._updatable),this.mesh=n,this.mesh.isPickable=this._pickable,this._depthSort||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),n},e.prototype.digest=function(e,t){var n=t&&t.facetNb||1,r=t&&t.number||0,i=t&&t.delta||0,a=e.getVerticesData(Sn.b.PositionKind),s=e.getIndices(),l=e.getVerticesData(Sn.b.UVKind),u=e.getVerticesData(Sn.b.ColorKind),c=e.getVerticesData(Sn.b.NormalKind),h=0,d=s.length/3;r?(r=r>d?d:r,n=Math.round(d/r),i=0):n=n>d?d:n;for(var f=[],p=[],m=[],g=[],_=o.x.Zero(),v=n;h<d;){h>d-(n=v+Math.floor((1+i)*Math.random()))&&(n=d-h),f.length=0,p.length=0,m.length=0,g.length=0;for(var y=0,b=3*h;b<3*(h+n);b++){p.push(y);var E=s[b];f.push(a[3*E],a[3*E+1],a[3*E+2]),l&&m.push(l[2*E],l[2*E+1]),u&&g.push(u[4*E],u[4*E+1],u[4*E+2],u[4*E+3]),y++}var x,T,S=this.nbParticles,A=this._posToShape(f),P=this._uvsToShapeUV(m);for(x=0;x<A.length;x++)_.addInPlace(A[x]);for(_.scaleInPlace(1/A.length),x=0;x<A.length;x++)A[x].subtractInPlace(_);this._particlesIntersect&&(T=new Jn.a(_,_));var M=new Fa(this._shapeCounter,A,3*n,P,null,null),R=this._positions.length,C=this._indices.length;this._meshBuilder(this._index,A,this._positions,p,this._indices,m,this._uvs,g,this._colors,c,this._normals,S,0,null),this._addParticle(S,R,C,M,this._shapeCounter,0,T),this.particles[this.nbParticles].position.addInPlace(_),this._index+=A.length,S++,this.nbParticles++,this._shapeCounter++,h+=n}return this},e.prototype._unrotateFixedNormals=function(){for(var e=0,t=0,n=o.t.Vector3[0],r=o.t.Quaternion[0],i=o.t.Matrix[0],a=0;a<this.particles.length;a++){var s=this.particles[a],l=s._model._shape;if(s.rotationQuaternion)s.rotationQuaternion.conjugateToRef(r);else{var u=s.rotation;o.q.RotationYawPitchRollToRef(u.y,u.x,u.z,r),r.conjugateInPlace()}r.toRotationMatrix(i);for(var c=0;c<l.length;c++)t=e+3*c,o.x.TransformNormalFromFloatsToRef(this._normals32[t],this._normals32[t+1],this._normals32[t+2],i,n),n.toArray(this._fixedNormal32,t);e=t+3}},e.prototype._resetCopy=function(){var e=this._copy;e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.copyFromFloats(0,0,1,1),e.color=null,e.translateFromPivot=!1},e.prototype._meshBuilder=function(e,t,n,r,i,a,s,l,u,c,h,d,f,p){var m,g=0,_=0,v=0;this._resetCopy();var y=this._copy;p&&p.positionFunction&&(p.positionFunction(y,d,f),this._mustUnrotateFixedNormals=!0);var b=o.t.Matrix[0],E=o.t.Vector3[0],x=o.t.Vector3[1],T=o.t.Vector3[2],S=o.t.Vector3[3];for(y.getRotationMatrix(b),y.pivot.multiplyToRef(y.scaling,S),y.translateFromPivot?T.setAll(0):T.copyFrom(S),m=0;m<t.length;m++){if(E.copyFrom(t[m]),p&&p.vertexFunction&&p.vertexFunction(y,E,m),E.multiplyInPlace(y.scaling).subtractInPlace(S),o.x.TransformCoordinatesToRef(E,b,x),x.addInPlace(T).addInPlace(y.position),n.push(x.x,x.y,x.z),a){var A=y.uvs;s.push((A.z-A.x)*a[g]+A.x,(A.w-A.y)*a[g+1]+A.y),g+=2}if(y.color)this._color=y.color;else{var P=this._color;l&&void 0!==l[_]?(P.r=l[_],P.g=l[_+1],P.b=l[_+2],P.a=l[_+3]):(P.r=1,P.g=1,P.b=1,P.a=1)}u.push(this._color.r,this._color.g,this._color.b,this._color.a),_+=4,!this.recomputeNormals&&c&&(E.x=c[v],E.y=c[v+1],E.z=c[v+2],o.x.TransformNormalToRef(E,b,E),h.push(E.x,E.y,E.z),v+=3)}for(m=0;m<r.length;m++){var M=e+r[m];i.push(M),M>65535&&(this._needs32Bits=!0)}if(this._pickable){var R=r.length/3;for(m=0;m<R;m++)this.pickedParticles.push({idx:d,faceId:m})}return this._depthSort&&this.depthSortedParticles.push(new Na),y},e.prototype._posToShape=function(e){for(var t=[],n=0;n<e.length;n+=3)t.push(o.x.FromArray(e,n));return t},e.prototype._uvsToShapeUV=function(e){var t=[];if(e)for(var n=0;n<e.length;n++)t.push(e[n]);return t},e.prototype._addParticle=function(e,t,n,r,i,o,a){void 0===a&&(a=null);var s=new La(e,t,n,r,i,o,this,a);return this.particles.push(s),s},e.prototype.addShape=function(e,t,n){var r,i=e.getVerticesData(Sn.b.PositionKind),o=e.getIndices(),a=e.getVerticesData(Sn.b.UVKind),s=e.getVerticesData(Sn.b.ColorKind),l=e.getVerticesData(Sn.b.NormalKind);this._particlesIntersect&&(r=e.getBoundingInfo());for(var u,c,h=this._posToShape(i),d=this._uvsToShapeUV(a),f=n?n.positionFunction:null,p=n?n.vertexFunction:null,m=new Fa(this._shapeCounter,h,o.length,d,f,p),g=this.nbParticles,_=0;_<t;_++){var v=this._positions.length,y=this._indices.length;c=this._meshBuilder(this._index,h,this._positions,o,this._indices,a,this._uvs,s,this._colors,l,this._normals,g,_,n),this._updatable&&((u=this._addParticle(g,v,y,m,this._shapeCounter,_,r)).position.copyFrom(c.position),u.rotation.copyFrom(c.rotation),c.rotationQuaternion&&u.rotationQuaternion&&u.rotationQuaternion.copyFrom(c.rotationQuaternion),c.color&&u.color&&u.color.copyFrom(c.color),u.scaling.copyFrom(c.scaling),u.uvs.copyFrom(c.uvs)),this._index+=h.length,g++}return this.nbParticles+=t,this._shapeCounter++,this._shapeCounter-1},e.prototype._rebuildParticle=function(e){this._resetCopy();var t=this._copy;e._model._positionFunction&&e._model._positionFunction(t,e.idx,e.idxInShape);var n=o.t.Matrix[0],r=o.t.Vector3[0],i=o.t.Vector3[1],a=o.t.Vector3[2],s=o.t.Vector3[3];t.getRotationMatrix(n),e.pivot.multiplyToRef(e.scaling,s),t.translateFromPivot?a.copyFromFloats(0,0,0):a.copyFrom(s);for(var l=e._model._shape,u=0;u<l.length;u++)r.copyFrom(l[u]),e._model._vertexFunction&&e._model._vertexFunction(t,r,u),r.multiplyInPlace(t.scaling).subtractInPlace(s),o.x.TransformCoordinatesToRef(r,n,i),i.addInPlace(a).addInPlace(t.position).toArray(this._positions32,e._pos+3*u);e.position.setAll(0),e.rotation.setAll(0),e.rotationQuaternion=null,e.scaling.setAll(1),e.uvs.setAll(0),e.pivot.setAll(0),e.translateFromPivot=!1,e.parentId=null},e.prototype.rebuildMesh=function(){for(var e=0;e<this.particles.length;e++)this._rebuildParticle(this.particles[e]);return this.mesh.updateVerticesData(Sn.b.PositionKind,this._positions32,!1,!1),this},e.prototype.setParticles=function(e,t,n){if(void 0===e&&(e=0),void 0===t&&(t=this.nbParticles-1),void 0===n&&(n=!0),!this._updatable)return this;this.beforeUpdateParticles(e,t,n);var r=o.t.Matrix[0],i=o.t.Matrix[1],a=this.mesh,s=this._colors32,l=this._positions32,u=this._normals32,c=this._uvs32,h=this._indices32,d=this._indices,f=this._fixedNormal32,p=o.t.Vector3,m=p[5].copyFromFloats(1,0,0),g=p[6].copyFromFloats(0,1,0),_=p[7].copyFromFloats(0,0,1),v=p[8].setAll(Number.MAX_VALUE),y=p[9].setAll(-Number.MAX_VALUE),b=p[10].setAll(0);if((this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(i)),this.billboard){var E=p[0];this._camera.getDirectionToRef(o.c.Z,E),o.x.TransformNormalToRef(E,i,_),_.normalize();var x=this._camera.getViewMatrix(!0);o.x.TransformNormalFromFloatsToRef(x.m[1],x.m[5],x.m[9],i,g),o.x.CrossToRef(g,_,m),g.normalize(),m.normalize()}this._depthSort&&o.x.TransformCoordinatesToRef(this._camera.globalPosition,i,b),o.j.IdentityToRef(r);var T=0,S=0,A=0,P=0,M=0,R=0,C=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),t=t>=this.nbParticles?this.nbParticles-1:t,this._computeBoundingBox&&(0!=e||t!=this.nbParticles-1)){var w=this.mesh._boundingInfo;w&&(v.copyFrom(w.minimum),y.copyFrom(w.maximum))}var O=(S=this.particles[e]._pos)/3|0;P=4*O,R=2*O;for(var I=e;I<=t;I++){var D=this.particles[I];this.updateParticle(D);var L=D._model._shape,F=D._model._shapeUV,N=D._rotationMatrix,B=D.position,U=D.rotation,k=D.scaling,V=D._globalPosition;if(this._depthSort&&this._depthSortParticles){var G=this.depthSortedParticles[I];G.ind=D._ind,G.indicesLength=D._model._indicesLength,G.sqDistance=o.x.DistanceSquared(D.position,b)}if(!D.alive||D._stillInvisible&&!D.isVisible)S+=3*(C=L.length),P+=4*C,R+=2*C;else{if(D.isVisible){D._stillInvisible=!1;var z=p[12];if(D.pivot.multiplyToRef(k,z),this.billboard&&(U.x=0,U.y=0),(this._computeParticleRotation||this.billboard)&&D.getRotationMatrix(r),null!==D.parentId){var j=this.particles[D.parentId],H=j._rotationMatrix,W=j._globalPosition,X=B.x*H[1]+B.y*H[4]+B.z*H[7],Y=B.x*H[0]+B.y*H[3]+B.z*H[6],K=B.x*H[2]+B.y*H[5]+B.z*H[8];if(V.x=W.x+Y,V.y=W.y+X,V.z=W.z+K,this._computeParticleRotation||this.billboard){var q=r.m;N[0]=q[0]*H[0]+q[1]*H[3]+q[2]*H[6],N[1]=q[0]*H[1]+q[1]*H[4]+q[2]*H[7],N[2]=q[0]*H[2]+q[1]*H[5]+q[2]*H[8],N[3]=q[4]*H[0]+q[5]*H[3]+q[6]*H[6],N[4]=q[4]*H[1]+q[5]*H[4]+q[6]*H[7],N[5]=q[4]*H[2]+q[5]*H[5]+q[6]*H[8],N[6]=q[8]*H[0]+q[9]*H[3]+q[10]*H[6],N[7]=q[8]*H[1]+q[9]*H[4]+q[10]*H[7],N[8]=q[8]*H[2]+q[9]*H[5]+q[10]*H[8]}}else V.x=B.x,V.y=B.y,V.z=B.z,(this._computeParticleRotation||this.billboard)&&(q=r.m,N[0]=q[0],N[1]=q[1],N[2]=q[2],N[3]=q[4],N[4]=q[5],N[5]=q[6],N[6]=q[8],N[7]=q[9],N[8]=q[10]);var Q=p[11];for(D.translateFromPivot?Q.setAll(0):Q.copyFrom(z),C=0;C<L.length;C++){T=S+3*C,A=P+4*C,M=R+2*C,(E=p[0]).copyFrom(L[C]),this._computeParticleVertex&&this.updateParticleVertex(D,E,C);var Z=E.x*k.x-z.x,J=E.y*k.y-z.y,$=E.z*k.z-z.z;Y=Z*N[0]+J*N[3]+$*N[6],X=Z*N[1]+J*N[4]+$*N[7],K=Z*N[2]+J*N[5]+$*N[8],Y+=Q.x,X+=Q.y,K+=Q.z;var ee=l[T]=V.x+m.x*Y+g.x*X+_.x*K,te=l[T+1]=V.y+m.y*Y+g.y*X+_.y*K,ne=l[T+2]=V.z+m.z*Y+g.z*X+_.z*K;if(this._computeBoundingBox&&(v.minimizeInPlaceFromFloats(ee,te,ne),y.maximizeInPlaceFromFloats(ee,te,ne)),!this._computeParticleVertex){var re=f[T],ie=f[T+1],oe=f[T+2],ae=re*N[0]+ie*N[3]+oe*N[6],se=re*N[1]+ie*N[4]+oe*N[7],le=re*N[2]+ie*N[5]+oe*N[8];u[T]=m.x*ae+g.x*se+_.x*le,u[T+1]=m.y*ae+g.y*se+_.y*le,u[T+2]=m.z*ae+g.z*se+_.z*le}if(this._computeParticleColor&&D.color){var ue=D.color,ce=this._colors32;ce[A]=ue.r,ce[A+1]=ue.g,ce[A+2]=ue.b,ce[A+3]=ue.a}if(this._computeParticleTexture){var he=D.uvs;c[M]=F[2*C]*(he.z-he.x)+he.x,c[M+1]=F[2*C+1]*(he.w-he.y)+he.y}}}else for(D._stillInvisible=!0,C=0;C<L.length;C++)A=P+4*C,M=R+2*C,l[T=S+3*C]=l[T+1]=l[T+2]=0,u[T]=u[T+1]=u[T+2]=0,this._computeParticleColor&&D.color&&(ue=D.color,s[A]=ue.r,s[A+1]=ue.g,s[A+2]=ue.b,s[A+3]=ue.a),this._computeParticleTexture&&(he=D.uvs,c[M]=F[2*C]*(he.z-he.x)+he.x,c[M+1]=F[2*C+1]*(he.w-he.y)+he.y);if(this._particlesIntersect){var de=D._boundingInfo,fe=de.boundingBox,pe=de.boundingSphere,me=D._modelBoundingInfo;if(!this._bSphereOnly){var ge=me.boundingBox.vectors,_e=p[1],ve=p[2];_e.setAll(Number.MAX_VALUE),ve.setAll(-Number.MAX_VALUE);for(var ye=0;ye<8;ye++){var be=ge[ye].x*k.x,Ee=ge[ye].y*k.y,xe=ge[ye].z*k.z,Te=(Y=be*N[0]+Ee*N[3]+xe*N[6],X=be*N[1]+Ee*N[4]+xe*N[7],K=be*N[2]+Ee*N[5]+xe*N[8],B.x+m.x*Y+g.x*X+_.x*K),Se=B.y+m.y*Y+g.y*X+_.y*K,Ae=B.z+m.z*Y+g.z*X+_.z*K;_e.minimizeInPlaceFromFloats(Te,Se,Ae),ve.maximizeInPlaceFromFloats(Te,Se,Ae)}fe.reConstruct(_e,ve,a._worldMatrix)}var Pe=me.minimum.multiplyToRef(k,p[1]),Me=me.maximum.multiplyToRef(k,p[2]),Re=Me.addToRef(Pe,p[3]).scaleInPlace(.5).addInPlace(V),Ce=Me.subtractToRef(Pe,p[4]).scaleInPlace(.5*this._bSphereRadiusFactor),we=Re.subtractToRef(Ce,p[1]),Oe=Re.addToRef(Ce,p[2]);pe.reConstruct(we,Oe,a._worldMatrix)}S=T+3,P=A+4,R=M+2}}if(n){if(this._computeParticleColor&&a.updateVerticesData(Sn.b.ColorKind,s,!1,!1),this._computeParticleTexture&&a.updateVerticesData(Sn.b.UVKind,c,!1,!1),a.updateVerticesData(Sn.b.PositionKind,l,!1,!1),!a.areNormalsFrozen||a.isFacetDataEnabled){if(this._computeParticleVertex||a.isFacetDataEnabled){var Ie=a.isFacetDataEnabled?a.getFacetDataParameters():null;Tn.a.ComputeNormals(l,h,u,Ie);for(var De=0;De<u.length;De++)f[De]=u[De]}a.areNormalsFrozen||a.updateVerticesData(Sn.b.NormalKind,u,!1,!1)}if(this._depthSort&&this._depthSortParticles){var Le=this.depthSortedParticles;Le.sort(Ba);for(var Fe=Le.length,Ne=0,Be=0;Be<Fe;Be++){var Ue=Le[Be].indicesLength,ke=Le[Be].ind;for(De=0;De<Ue;De++)h[Ne]=d[ke+De],Ne++}a.updateIndices(h)}}return this._computeBoundingBox&&(a._boundingInfo?a._boundingInfo.reConstruct(v,y,a._worldMatrix):a._boundingInfo=new Jn.a(v,y,a._worldMatrix)),this.afterUpdateParticles(e,t,n),this},e.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},e.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},e.prototype.setVisibilityBox=function(e){var t=e/2;this.mesh._boundingInfo=new Jn.a(new o.x(-t,-t,-t),new o.x(t,t,t))},Object.defineProperty(e.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(e){this._isVisibilityBoxLocked=e,this.mesh.getBoundingInfo().isLocked=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(e){this._computeParticleRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(e){this._computeParticleColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(e){this._computeParticleTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(e){this._computeParticleVertex=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(e){this._computeBoundingBox=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(e){this._depthSortParticles=e},enumerable:!0,configurable:!0}),e.prototype.initParticles=function(){},e.prototype.recycleParticle=function(e){return e},e.prototype.updateParticle=function(e){return e},e.prototype.updateParticleVertex=function(e,t,n){return t},e.prototype.beforeUpdateParticles=function(e,t,n){},e.prototype.afterUpdateParticles=function(e,t,n){},e}();W.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},W.a.prototype.enablePhysics=function(e,t){if(void 0===e&&(e=null),this._physicsEngine)return!0;var n=this._getComponent(Te.a.NAME_PHYSICSENGINE);n||(n=new Ga(this),this._addComponent(n));try{return this._physicsEngine=new Zi(e,t),!0}catch(e){return p.a.Error(e.message),!1}},W.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},W.a.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},W.a.prototype.deleteCompoundImpostor=function(e){var t=e.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},W.a.prototype._advancePhysicsEngineStep=function(e){this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this))},Object.defineProperty(Fe.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(e){var t=this;this._physicsImpostor!==e&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=e,e&&(this._disposePhysicsObserver=this.onDisposeObservable.add(function(){t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)})))},enumerable:!0,configurable:!0}),Fe.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},Fe.a.prototype.applyImpulse=function(e,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(e,t),this):this},Fe.a.prototype.setPhysicsLinkWith=function(e,t,n,r){return this.physicsImpostor&&e.physicsImpostor?(this.physicsImpostor.createJoint(e.physicsImpostor,Qi.e.HingeJoint,{mainPivot:t,connectedPivot:n,nativeParams:r}),this):this};var ka,Va,Ga=function(){function e(e){var t=this;this.name=Te.a.NAME_PHYSICSENGINE,this.scene=e,this.scene.onBeforePhysicsObservable=new i.c,this.scene.onAfterPhysicsObservable=new i.c,this.scene.getDeterministicFrameTime=function(){return t.scene._physicsEngine?1e3*t.scene._physicsEngine.getTimeStep():1e3/60}}return e.prototype.register=function(){},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},e}(),za=function(){function e(e){this._scene=e,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||p.a.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return e.prototype.applyRadialExplosionImpulse=function(e,t,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var i=this._physicsEngine.getImpostors();if(0===i.length)return null;"number"==typeof t&&((t=new Ya).radius=t,t.strength=n||t.strength,t.falloff=r||t.falloff);var o=new ja(this._scene,t),a=Array();return i.forEach(function(t){var n=o.getImpostorHitData(t,e);n&&(t.applyImpulse(n.force,n.contactPoint),a.push({impostor:t,hitData:n}))}),o.triggerAffectedImpostorsCallback(a),o.dispose(!1),o},e.prototype.applyRadialExplosionForce=function(e,t,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var i=this._physicsEngine.getImpostors();if(0===i.length)return null;"number"==typeof t&&((t=new Ya).radius=t,t.strength=n||t.strength,t.falloff=r||t.falloff);var o=new ja(this._scene,t),a=Array();return i.forEach(function(t){var n=o.getImpostorHitData(t,e);n&&(t.applyForce(n.force,n.contactPoint),a.push({impostor:t,hitData:n}))}),o.triggerAffectedImpostorsCallback(a),o.dispose(!1),o},e.prototype.gravitationalField=function(e,t,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new Ya).radius=t,t.strength=n||t.strength,t.falloff=r||t.falloff);var i=new Ha(this,this._scene,e,t);return i.dispose(!1),i},e.prototype.updraft=function(e,t,n,r,i){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new Ka).radius=t,t.strength=n||t.strength,t.height=r||t.height,t.updraftMode=i||t.updraftMode);var o=new Wa(this._scene,e,t);return o.dispose(!1),o},e.prototype.vortex=function(e,t,n,r){if(!this._physicsEngine)return p.a.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;"number"==typeof t&&((t=new qa).radius=t,t.strength=n||t.strength,t.height=r||t.height);var i=new Xa(this._scene,e,t);return i.dispose(!1),i},e}(),ja=function(){function e(e,t){this._scene=e,this._options=t,this._dataFetched=!1,this._options=u.a({},new Ya,this._options)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.getImpostorHitData=function(e,t){if(0===e.mass)return null;if(!this._intersectsWithSphere(e,t,this._options.radius))return null;if("Mesh"!==e.object.getClassName()&&"InstancedMesh"!==e.object.getClassName())return null;var n=e.getObjectCenter().subtract(t),r=new Ot.a(t,n,this._options.radius).intersectsMesh(e.object).pickedPoint;if(!r)return null;var i=o.x.Distance(t,r);if(i>this._options.radius)return null;var a=this._options.falloff===ka.Constant?this._options.strength:this._options.strength*(1-i/this._options.radius);return{force:n.multiplyByFloats(a,a,a),contactPoint:r,distanceFromOrigin:i}},e.prototype.triggerAffectedImpostorsCallback=function(e){this._options.affectedImpostorsCallback&&this._options.affectedImpostorsCallback(e)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout(function(){t._dataFetched||t._sphere.dispose()},0)},e.prototype._prepareSphere=function(){this._sphere||(this._sphere=Pr.a.CreateSphere("radialExplosionEventSphere",this._options.sphere,this._scene),this._sphere.isVisible=!1)},e.prototype._intersectsWithSphere=function(e,t,n){var r=e.object;return this._prepareSphere(),this._sphere.position=t,this._sphere.scaling=new o.x(2*n,2*n,2*n),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(r,!0)},e}(),Ha=function(){function e(e,t,n,r){this._physicsHelper=e,this._scene=t,this._origin=n,this._options=r,this._dataFetched=!1,this._options=u.a({},new Ya,this._options),this._tickCallback=this._tick.bind(this),this._options.strength=-1*this._options.strength}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout(function(){t._dataFetched||t._sphere.dispose()},0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);else{var e=this._physicsHelper.applyRadialExplosionForce(this._origin,this._options);e&&(this._sphere=e.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}(),Wa=function(){function e(e,t,n){this._scene=e,this._origin=t,this._options=n,this._originTop=o.x.Zero(),this._originDirection=o.x.Zero(),this._cylinderPosition=o.x.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=u.a({},new Ka,this._options),this._origin.addToRef(new o.x(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new o.x(0,this._options.height,0),this._originTop),this._options.updraftMode===Va.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),this._cylinder&&(e?this._cylinder.dispose():setTimeout(function(){t._dataFetched||t._cylinder.dispose()},0))},e.prototype.getImpostorHitData=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;var t=e.getObjectCenter();if(this._options.updraftMode===Va.Perpendicular)var n=this._originDirection;else n=t.subtract(this._originTop);var r=o.x.Distance(this._origin,t),i=-1*this._options.strength;return{force:n.multiplyByFloats(i,i,i),contactPoint:t,distanceFromOrigin:r}},e.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach(function(t){var n=e.getImpostorHitData(t);n&&t.applyForce(n.force,n.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=Cn.a.CreateCylinder("updraftEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},e}(),Xa=function(){function e(e,t,n){this._scene=e,this._origin=t,this._options=n,this._originTop=o.x.Zero(),this._cylinderPosition=o.x.Zero(),this._dataFetched=!1,this._physicsEngine=this._scene.getPhysicsEngine(),this._options=u.a({},new qa,this._options),this._origin.addToRef(new o.x(0,this._options.height/2,0),this._cylinderPosition),this._origin.addToRef(new o.x(0,this._options.height,0),this._originTop),this._tickCallback=this._tick.bind(this),this._prepareCylinder()}return e.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._cylinder.dispose():setTimeout(function(){t._dataFetched||t._cylinder.dispose()},0)},e.prototype.getImpostorHitData=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;if("Mesh"!==e.object.getClassName()&&"InstancedMesh"!==e.object.getClassName())return null;var t=e.getObjectCenter(),n=new o.x(this._origin.x,t.y,this._origin.z),r=t.subtract(n),i=new Ot.a(n,r,this._options.radius).intersectsMesh(e.object),a=i.pickedPoint;if(!a)return null;var s=i.distance/this._options.radius,l=a.normalize();if(s>this._options.centripetalForceThreshold&&(l=l.negate()),s>this._options.centripetalForceThreshold)var u=l.x*this._options.centripetalForceMultiplier,c=l.y*this._options.updraftForceMultiplier,h=l.z*this._options.centripetalForceMultiplier;else{var d=o.x.Cross(n,t).normalize();u=(d.x+l.x)*this._options.centrifugalForceMultiplier,c=this._originTop.y*this._options.updraftForceMultiplier,h=(d.z+l.z)*this._options.centrifugalForceMultiplier}var f=new o.x(u,c,h);return{force:f=f.multiplyByFloats(this._options.strength,this._options.strength,this._options.strength),contactPoint:t,distanceFromOrigin:s}},e.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach(function(t){var n=e.getImpostorHitData(t);n&&t.applyForce(n.force,n.contactPoint)})},e.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=Cn.a.CreateCylinder("vortexEventCylinder",{height:this._options.height,diameter:2*this._options.radius},this._scene),this._cylinder.isVisible=!1)},e.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},e}(),Ya=function(){this.radius=5,this.strength=10,this.falloff=ka.Constant,this.sphere={segments:32,diameter:1}},Ka=function(){this.radius=5,this.strength=10,this.height=10,this.updraftMode=Va.Center},qa=function(){this.radius=5,this.strength=10,this.height=10,this.centripetalForceThreshold=.7,this.centripetalForceMultiplier=5,this.centrifugalForceMultiplier=.5,this.updraftForceMultiplier=.02};!function(e){e[e.Constant=0]="Constant",e[e.Linear=1]="Linear"}(ka||(ka={})),function(e){e[e.Center=0]="Center",e[e.Perpendicular=1]="Perpendicular"}(Va||(Va={})),zt.a.ShadersStore.blackAndWhitePixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void)\n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11));\nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}";var Qa=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,"blackAndWhite",["degree"],null,n,r,i,o,a)||this;return s.degree=1,s.onApplyObservable.add(function(e){e.setFloat("degree",s.degree)}),s}return u.d(t,e),t}(jt),Za=function(){function e(e,t,n,r){this._name=t,this._singleInstance=r||!0,this._getPostProcesses=n,this._cameras={},this._indicesForCamera={},this._postProcesses={}}return Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var e in this._postProcesses)if(this._postProcesses.hasOwnProperty(e))for(var t=this._postProcesses[e],n=0;n<t.length;n++)if(!t[n].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype._update=function(){},e.prototype._attachCameras=function(e){var t,n=this,r=ye.h.MakeArray(e||this._cameras);if(r)for(var i=0;i<r.length;i++){var o=r[i],a=o.name;if(t=this._singleInstance?0:a,!this._postProcesses[t]){var s=this._getPostProcesses();s&&(this._postProcesses[t]=Array.isArray(s)?s:[s])}this._indicesForCamera[a]||(this._indicesForCamera[a]=[]),this._postProcesses[t].forEach(function(e){var t=o.attachPostProcess(e);n._indicesForCamera[a].push(t)}),this._cameras[a]||(this._cameras[a]=o)}},e.prototype._detachCameras=function(e){var t=ye.h.MakeArray(e||this._cameras);if(t)for(var n=0;n<t.length;n++){var r=t[n],i=r.name,o=this._postProcesses[this._singleInstance?0:i];o&&o.forEach(function(e){r.detachPostProcess(e)}),this._cameras[i]&&(this._cameras[i]=null)}},e.prototype._enable=function(e){var t=this,n=ye.h.MakeArray(e||this._cameras);if(n)for(var r=0;r<n.length;r++)for(var i=n[r],o=i.name,a=0;a<this._indicesForCamera[o].length;a++)void 0!==i._postProcesses[this._indicesForCamera[o][a]]&&null!==i._postProcesses[this._indicesForCamera[o][a]]||this._postProcesses[this._singleInstance?0:o].forEach(function(e){n[r].attachPostProcess(e,t._indicesForCamera[o][a])})},e.prototype._disable=function(e){var t=ye.h.MakeArray(e||this._cameras);if(t)for(var n=0;n<t.length;n++){var r=t[n],i=r.name;this._postProcesses[this._singleInstance?0:i].forEach(function(e){r.detachPostProcess(e)})}},e.prototype.getPostProcesses=function(e){return this._singleInstance?this._postProcesses[0]:e?this._postProcesses[e.name]:null},e}();zt.a.ShadersStore.extractHighlightsPixelShader="#include<helperFunctions>\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float threshold;\nuniform float exposure;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nfloat luma=getLuminance(gl_FragColor.rgb*exposure);\ngl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;\n}";var Ja=function(e){function t(t,n,r,i,a,s,l,u){void 0===l&&(l=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=!1);var c=e.call(this,t,"extractHighlights",["threshold","exposure"],null,n,r,i,a,s,null,l,void 0,null,u)||this;return c.threshold=.9,c._exposure=1,c._inputPostProcess=null,c.onApplyObservable.add(function(e){c._inputPostProcess&&e.setTextureFromPostProcess("textureSampler",c._inputPostProcess),e.setFloat("threshold",Math.pow(c.threshold,o.u)),e.setFloat("exposure",c._exposure)}),c}return u.d(t,e),t}(jt);zt.a.ShadersStore.bloomMergePixelShader="uniform sampler2D textureSampler;\nuniform sampler2D bloomBlur;\nvarying vec2 vUV;\nuniform float bloomWeight;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec3 blurred=texture2D(bloomBlur,vUV).rgb;\ngl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);\n}\n";var $a=function(e){function t(t,n,r,i,o,a,s,l,u,c,h){void 0===c&&(c=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1);var d=e.call(this,t,"bloomMerge",["bloomWeight"],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2","bloomBlur"],o,a,s,l,u,null,c,void 0,null,!0)||this;return d.weight=i,d.onApplyObservable.add(function(e){e.setTextureFromPostProcess("textureSampler",n),e.setTextureFromPostProcessOutput("bloomBlur",r),e.setFloat("bloomWeight",d.weight)}),h||d.updateEffect(),d}return u.d(t,e),t}(jt),es=function(e){function t(t,n,r,i,a,s){void 0===a&&(a=0),void 0===s&&(s=!1);var l=e.call(this,t.getEngine(),"bloom",function(){return l._effects},!0)||this;return l.bloomScale=n,l._effects=[],l._downscale=new Ja("highlights",1,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,s),l._blurX=new zr("horizontal blur",new o.w(1,0),10,n,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,void 0,s),l._blurX.alwaysForcePOT=!0,l._blurX.autoClear=!1,l._blurY=new zr("vertical blur",new o.w(0,1),10,n,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,void 0,s),l._blurY.alwaysForcePOT=!0,l._blurY.autoClear=!1,l.kernel=i,l._effects=[l._downscale,l._blurX,l._blurY],l._merge=new $a("bloomMerge",l._downscale,l._blurY,r,n,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,a,s),l._merge.autoClear=!1,l._effects.push(l._merge),l}return u.d(t,e),Object.defineProperty(t.prototype,"threshold",{get:function(){return this._downscale.threshold},set:function(e){this._downscale.threshold=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weight",{get:function(){return this._merge.weight},set:function(e){this._merge.weight=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kernel",{get:function(){return this._blurX.kernel/this.bloomScale},set:function(e){this._blurX.kernel=e*this.bloomScale,this._blurY.kernel=e*this.bloomScale},enumerable:!0,configurable:!0}),t.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[t].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Za);zt.a.ShadersStore.chromaticAberrationPixelShader="\nuniform sampler2D textureSampler;\n\nuniform float chromatic_aberration;\nuniform float radialIntensity;\nuniform vec2 direction;\nuniform vec2 centerPosition;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);\nvec2 directionOfEffect=direction;\nif(directionOfEffect.x == 0. && directionOfEffect.y == 0.){\ndirectionOfEffect=normalize(centered_screen_pos);\n}\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;\nfloat ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\noriginal.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);\ngl_FragColor=original;\n}";var ts=function(e){function t(t,n,r,i,a,s,l,u,c,h){void 0===c&&(c=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1);var d=e.call(this,t,"chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],i,a,s,l,u,null,c,void 0,null,h)||this;return d.aberrationAmount=30,d.radialIntensity=0,d.direction=new o.w(.707,.707),d.centerPosition=new o.w(.5,.5),d.onApplyObservable.add(function(e){e.setFloat("chromatic_aberration",d.aberrationAmount),e.setFloat("screen_width",n),e.setFloat("screen_height",r),e.setFloat("radialIntensity",d.radialIntensity),e.setFloat2("direction",d.direction.x,d.direction.y),e.setFloat2("centerPosition",d.centerPosition.x,d.centerPosition.y)}),d}return u.d(t,e),t}(jt);zt.a.ShadersStore.circleOfConfusionPixelShader="\nuniform sampler2D depthSampler;\n\nvarying vec2 vUV;\n\nuniform vec2 cameraMinMaxZ;\n\nuniform float focusDistance;\nuniform float cocPrecalculation;\nvoid main(void)\n{\nfloat depth=texture2D(depthSampler,vUV).r;\nfloat pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;\nfloat coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));\ncoc=clamp(coc,0.0,1.0);\ngl_FragColor=vec4(coc,depth,coc,1.0);\n}\n";var ns=function(e){function t(t,n,r,i,o,a,s,l,u){void 0===l&&(l=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===u&&(u=!1);var c=e.call(this,t,"circleOfConfusion",["cameraMinMaxZ","focusDistance","cocPrecalculation"],["depthSampler"],r,i,o,a,s,null,l,void 0,null,u)||this;return c.lensSize=50,c.fStop=1.4,c.focusDistance=2e3,c.focalLength=50,c._depthTexture=null,c._depthTexture=n,c.onApplyObservable.add(function(e){if(c._depthTexture){e.setTexture("depthSampler",c._depthTexture);var t=c.lensSize/c.fStop*c.focalLength/(c.focusDistance-c.focalLength);e.setFloat("focusDistance",c.focusDistance),e.setFloat("cocPrecalculation",t),e.setFloat2("cameraMinMaxZ",c._depthTexture.activeCamera.minZ,c._depthTexture.activeCamera.maxZ)}else p.a.Warn("No depth texture set on CircleOfConfusionPostProcess")}),c}return u.d(t,e),Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._depthTexture=e},enumerable:!0,configurable:!0}),t}(jt);zt.a.ShadersStore.colorCorrectionPixelShader="\nuniform sampler2D textureSampler;\nuniform sampler2D colorTable;\n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0;\n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width;\nfloat slicePixelSize=sliceSize/width;\nfloat sliceInnerSize=slicePixelSize*(width-1.0);\nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}";var rs=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,t,"colorCorrection",null,["colorTable"],r,i,o,a,s)||this;return l._colorTableTexture=new Ge.a(n,i.getScene(),!0,!1,Ge.a.TRILINEAR_SAMPLINGMODE),l._colorTableTexture.anisotropicFilteringLevel=1,l._colorTableTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,l._colorTableTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,l.onApply=function(e){e.setTexture("colorTable",l._colorTableTexture)},l}return u.d(t,e),t}(jt);zt.a.ShadersStore.convolutionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}";var is=function(e){function t(t,n,r,i,o,a,s,l){void 0===l&&(l=m.a.TEXTURETYPE_UNSIGNED_INT);var u=e.call(this,t,"convolution",["kernel","screenSize"],null,r,i,o,a,s,null,l)||this;return u.kernel=n,u.onApply=function(e){e.setFloat2("screenSize",u.width,u.height),e.setArray("kernel",u.kernel)},u}return u.d(t,e),t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],t}(jt),os=function(e){function t(t,n,r,i,o,a,s,l,u,c,h,d,f){void 0===l&&(l=null),void 0===u&&(u=Ge.a.BILINEAR_SAMPLINGMODE),void 0===d&&(d=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===f&&(f=!1);var p=e.call(this,t,r,i,o,a,u=m.a.TEXTURE_BILINEAR_SAMPLINGMODE,c,h,d=m.a.TEXTURETYPE_UNSIGNED_INT,"#define DOF 1\r\n",f)||this;return p.direction=r,p.onApplyObservable.add(function(e){null!=l&&e.setTextureFromPostProcess("textureSampler",l),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",s),n.activeCamera&&e.setFloat2("cameraMinMaxZ",n.activeCamera.minZ,n.activeCamera.maxZ)}),p}return u.d(t,e),t}(zr);zt.a.ShadersStore.depthOfFieldMergePixelShader="uniform sampler2D textureSampler;\nvarying vec2 vUV;\nuniform sampler2D circleOfConfusionSampler;\nuniform sampler2D blurStep0;\n#if BLUR_LEVEL>0\nuniform sampler2D blurStep1;\n#endif\n#if BLUR_LEVEL>1\nuniform sampler2D blurStep2;\n#endif\nvoid main(void)\n{\nfloat coc=texture2D(circleOfConfusionSampler,vUV).r;\n#if BLUR_LEVEL == 0\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred0=texture2D(blurStep0,vUV);\ngl_FragColor=mix(original,blurred0,coc);\n#endif\n#if BLUR_LEVEL == 1\nif(coc<0.5){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(original,blurred1,coc/0.5);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);\n}\n#endif\n#if BLUR_LEVEL == 2\nif(coc<0.33){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(original,blurred2,coc/0.33);\n}else if(coc<0.66){\nvec4 blurred1=texture2D(blurStep1,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);\n}\n#endif\n}\n";var as,ss=function(){},ls=function(e){function t(t,n,r,i,o,a,s,l,u,c,h){void 0===c&&(c=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1);var d=e.call(this,t,"depthOfFieldMerge",[],["circleOfConfusionSampler","blurStep0","blurStep1","blurStep2"],o,a,s,l,u,null,c,void 0,null,!0)||this;return d.blurSteps=i,d.onApplyObservable.add(function(e){e.setTextureFromPostProcess("textureSampler",n),e.setTextureFromPostProcessOutput("circleOfConfusionSampler",r),i.forEach(function(t,n){e.setTextureFromPostProcessOutput("blurStep"+(i.length-n-1),t)})}),h||d.updateEffect(),d}return u.d(t,e),t.prototype.updateEffect=function(t,n,r,i,o,a){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),t||(t="",t+="#define BLUR_LEVEL "+(this.blurSteps.length-1)+"\n"),e.prototype.updateEffect.call(this,t,n,r,i,o,a)},t}(jt);!function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(as||(as={}));var us=function(e){function t(t,n,r,i,a){void 0===r&&(r=as.Low),void 0===i&&(i=0),void 0===a&&(a=!1);var s=e.call(this,t.getEngine(),"depth of field",function(){return s._effects},!0)||this;s._effects=[],s._circleOfConfusion=new ns("circleOfConfusion",n,1,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,i,a),s._depthOfFieldBlurY=[],s._depthOfFieldBlurX=[];var l=1,u=15;switch(r){case as.High:l=3,u=51;break;case as.Medium:l=2,u=31;break;default:u=15,l=1}for(var c=u/Math.pow(2,l-1),h=1,d=0;d<l;d++){var f=new os("verticle blur",t,new o.w(0,1),c,h,null,s._circleOfConfusion,0==d?s._circleOfConfusion:null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,i,a);f.autoClear=!1,h=.75/Math.pow(2,d);var p=new os("horizontal blur",t,new o.w(1,0),c,h,null,s._circleOfConfusion,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,i,a);p.autoClear=!1,s._depthOfFieldBlurY.push(f),s._depthOfFieldBlurX.push(p)}for(s._effects=[s._circleOfConfusion],d=0;d<s._depthOfFieldBlurX.length;d++)s._effects.push(s._depthOfFieldBlurY[d]),s._effects.push(s._depthOfFieldBlurX[d]);return s._dofMerge=new ls("dofMerge",s._circleOfConfusion,s._circleOfConfusion,s._depthOfFieldBlurX,h,null,Ge.a.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,i,a),s._dofMerge.autoClear=!1,s._effects.push(s._dofMerge),s}return u.d(t,e),Object.defineProperty(t.prototype,"focalLength",{get:function(){return this._circleOfConfusion.focalLength},set:function(e){this._circleOfConfusion.focalLength=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fStop",{get:function(){return this._circleOfConfusion.fStop},set:function(e){this._circleOfConfusion.fStop=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"focusDistance",{get:function(){return this._circleOfConfusion.focusDistance},set:function(e){this._circleOfConfusion.focusDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lensSize",{get:function(){return this._circleOfConfusion.lensSize},set:function(e){this._circleOfConfusion.lensSize=e},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DepthOfFieldEffect"},Object.defineProperty(t.prototype,"depthTexture",{set:function(e){this._circleOfConfusion.depthTexture=e},enumerable:!0,configurable:!0}),t.prototype.disposeEffects=function(e){for(var t=0;t<this._effects.length;t++)this._effects[t].dispose(e)},t.prototype._updateEffects=function(){for(var e=0;e<this._effects.length;e++)this._effects[e].updateEffect()},t.prototype._isReady=function(){for(var e=0;e<this._effects.length;e++)if(!this._effects[e].isReady())return!1;return!0},t}(Za);zt.a.ShadersStore.displayPassPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}";var cs=function(e){function t(t,n,r,i,o,a){return e.call(this,t,"displayPass",["passSampler"],["passSampler"],n,r,i,o,a)||this}return u.d(t,e),t}(jt);zt.a.ShadersStore.filterPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}";var hs=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,t,"filter",["kernelMatrix"],null,r,i,o,a,s)||this;return l.kernelMatrix=n,l.onApply=function(e){e.setMatrix("kernelMatrix",l.kernelMatrix)},l}return u.d(t,e),t}(jt);zt.a.ShadersStore.fxaaPixelShader="uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\n#ifndef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\nreturn;\n}\n#endif\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan)\n{\nlumaS=lumaE;\n}\nif (horzSpan)\n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan)\n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN)\n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN)\n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN)\n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP)\n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan)\n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\n#ifdef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\n}\nelse\n{\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}\n#else\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n#endif\n}",zt.a.ShadersStore.fxaaVertexShader="\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}";var ds=function(e){function t(t,n,r,i,o,a,s){void 0===r&&(r=null),void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT);var l=e.call(this,t,"fxaa",["texelSize"],null,n,r,i||Ge.a.BILINEAR_SAMPLINGMODE,o,a,null,s,"fxaa",void 0,!0)||this,u=l._getDefines();return l.updateEffect(u),l.onApplyObservable.add(function(e){var t=l.texelSize;e.setFloat2("texelSize",t.x,t.y)}),l}return u.d(t,e),t.prototype._getDefines=function(){var e=this.getEngine();if(!e)return null;var t=e.getGlInfo();return t&&t.renderer&&t.renderer.toLowerCase().indexOf("mali")>-1?"#define MALI 1\n":null},t}(jt);zt.a.ShadersStore.grainPixelShader="#include<helperFunctions>\n\nuniform sampler2D textureSampler;\n\nuniform float intensity;\nuniform float animatedSeed;\n\nvarying vec2 vUV;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec2 seed=vUV*(animatedSeed);\nfloat grain=dither(seed,intensity);\n\nfloat lum=getLuminance(gl_FragColor.rgb);\nfloat grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;\ngl_FragColor.rgb+=grain*grainAmount;\ngl_FragColor.rgb=max(gl_FragColor.rgb,0.0);\n}";var fs=function(e){function t(t,n,r,i,o,a,s,l){void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1);var u=e.call(this,t,"grain",["intensity","animatedSeed"],[],n,r,i,o,a,null,s,void 0,null,l)||this;return u.intensity=30,u.animated=!1,u.onApplyObservable.add(function(e){e.setFloat("intensity",u.intensity),e.setFloat("animatedSeed",u.animated?Math.random()+1:1)}),u}return u.d(t,e),t}(jt);zt.a.ShadersStore.highlightsPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void)\n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);\n}";var ps=function(e){function t(t,n,r,i,o,a,s){return void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT),e.call(this,t,"highlights",null,null,n,r,i,o,a,null,s)||this}return u.d(t,e),t}(jt);zt.a.IncludesShadersStore.mrtFragmentDeclaration="#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n",zt.a.ShadersStore.geometryPixelShader="#extension GL_EXT_draw_buffers : require\nprecision highp float;\nprecision highp int;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef VELOCITY\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\n\ngl_FragData[1]=vec4(normalize(vNormalV),1.0);\n\n#ifdef POSITION\ngl_FragData[POSITION_INDEX]=vec4(vPosition,1.0);\n#endif\n#ifdef VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);\n#endif\n}",zt.a.ShadersStore.geometryVertexShader="precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef VELOCITY\nuniform mat4 previousWorld;\nuniform mat4 previousViewProjection;\n#ifdef BONES_VELOCITY_ENABLED\n#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\n\nvCurrentPosition=viewProjection*finalWorld*vec4(position,1.0);\nvPreviousPosition=previousViewProjection*previousWorld*vec4(position,1.0);\n#endif\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(position,1.0));\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));\nvViewPos=view*pos;\n#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(position,1.0);\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(position,1.0);\n#else\nvPreviousPosition=previousViewProjection*previousWorld*vec4(position,1.0);\n#endif\n#endif\n#ifdef POSITION\nvPosition=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}";var ms=function(){function e(t,n){void 0===n&&(n=1),this._previousTransformationMatrices={},this._previousBonesTransformationMatrices={},this.excludedSkinnedMeshesFromVelocity=[],this._enablePosition=!1,this._enableVelocity=!1,this._positionIndex=-1,this._velocityIndex=-1,this._scene=t,this._ratio=n,e._SceneComponentInitialization(this._scene),this._createRenderTargets()}return Object.defineProperty(e.prototype,"renderList",{set:function(e){this._multiRenderTarget.renderList=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),e.prototype.getTextureIndex=function(t){switch(t){case e.POSITION_TEXTURE_TYPE:return this._positionIndex;case e.VELOCITY_TEXTURE_TYPE:return this._velocityIndex;default:return-1}},Object.defineProperty(e.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(e){this._enablePosition=e,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableVelocity",{get:function(){return this._enableVelocity},set:function(e){this._enableVelocity=e,e||(this._previousTransformationMatrices={}),this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._ratio},enumerable:!0,configurable:!0}),e.prototype.isReady=function(e,t){var n=e.getMaterial();if(n&&n.disableDepthWrite)return!1;var r=[],i=[Sn.b.PositionKind,Sn.b.NormalKind],o=e.getMesh();n&&n.needAlphaTesting()&&(r.push("#define ALPHATEST"),o.isVerticesDataPresent(Sn.b.UVKind)&&(i.push(Sn.b.UVKind),r.push("#define UV1")),o.isVerticesDataPresent(Sn.b.UV2Kind)&&(i.push(Sn.b.UV2Kind),r.push("#define UV2"))),this._enablePosition&&(r.push("#define POSITION"),r.push("#define POSITION_INDEX "+this._positionIndex)),this._enableVelocity&&(r.push("#define VELOCITY"),r.push("#define VELOCITY_INDEX "+this._velocityIndex),-1===this.excludedSkinnedMeshesFromVelocity.indexOf(o)&&r.push("#define BONES_VELOCITY_ENABLED")),o.useBones&&o.computeBonesUsingShaders?(i.push(Sn.b.MatricesIndicesKind),i.push(Sn.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(i.push(Sn.b.MatricesIndicesExtraKind),i.push(Sn.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),r.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0"),t&&(r.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3")),r.push("#define RENDER_TARGET_COUNT "+this._multiRenderTarget.textures.length);var a=r.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("geometry",i,["world","mBones","viewProjection","diffuseMatrix","view","previousWorld","previousViewProjection","mPreviousBones"],["diffuseSampler"],a,void 0,void 0,void 0,{buffersCount:this._enablePosition?3:2})),this._effect.isReady()},e.prototype.getGBuffer=function(){return this._multiRenderTarget},Object.defineProperty(e.prototype,"samples",{get:function(){return this._multiRenderTarget.samples},set:function(e){this._multiRenderTarget.samples=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.getGBuffer().dispose()},e.prototype._createRenderTargets=function(){var e=this,t=this._scene.getEngine(),n=2;if(this._enablePosition&&(this._positionIndex=n,n++),this._enableVelocity&&(this._velocityIndex=n,n++),this._multiRenderTarget=new Eo("gBuffer",{width:t.getRenderWidth()*this._ratio,height:t.getRenderHeight()*this._ratio},n,this._scene,{generateMipMaps:!1,generateDepthTexture:!0,defaultType:m.a.TEXTURETYPE_FLOAT}),this.isSupported){this._multiRenderTarget.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(e){e.clear(new o.f(0,0,0,1),!0,!0,!0)});var r=function(t){var n=t.getRenderingMesh(),r=e._scene,i=r.getEngine(),a=t.getMaterial();if(a){if(e._enableVelocity&&!e._previousTransformationMatrices[n.uniqueId]&&(e._previousTransformationMatrices[n.uniqueId]={world:o.j.Identity(),viewProjection:r.getTransformMatrix()},n.skeleton)){var s=n.skeleton.getTransformMatrices(n);e._previousBonesTransformationMatrices[n.uniqueId]=e._copyBonesTransformationMatrices(s,new Float32Array(s.length))}i.setState(a.backFaceCulling,0,!1,r.useRightHandedSystem);var l=n._getInstancesRenderList(t._id);if(!l.mustReturn){var u=i.getCaps().instancedArrays&&null!==l.visibleInstances[t._id];if(e.isReady(t,u)){if(i.enableEffect(e._effect),n._bind(t,e._effect,Mi.a.TriangleFillMode),e._effect.setMatrix("viewProjection",r.getTransformMatrix()),e._effect.setMatrix("view",r.getViewMatrix()),a&&a.needAlphaTesting()){var c=a.getAlphaTestTexture();c&&(e._effect.setTexture("diffuseSampler",c),e._effect.setMatrix("diffuseMatrix",c.getTextureMatrix()))}n.useBones&&n.computeBonesUsingShaders&&n.skeleton&&(e._effect.setMatrices("mBones",n.skeleton.getTransformMatrices(n)),e._enableVelocity&&e._effect.setMatrices("mPreviousBones",e._previousBonesTransformationMatrices[n.uniqueId])),e._enableVelocity&&(e._effect.setMatrix("previousWorld",e._previousTransformationMatrices[n.uniqueId].world),e._effect.setMatrix("previousViewProjection",e._previousTransformationMatrices[n.uniqueId].viewProjection)),n._processRendering(t,e._effect,Mi.a.TriangleFillMode,l,u,function(t,n){return e._effect.setMatrix("world",n)})}e._enableVelocity&&(e._previousTransformationMatrices[n.uniqueId].world=n.getWorldMatrix().clone(),e._previousTransformationMatrices[n.uniqueId].viewProjection=e._scene.getTransformMatrix().clone(),n.skeleton&&e._copyBonesTransformationMatrices(n.skeleton.getTransformMatrices(n),e._previousBonesTransformationMatrices[n.uniqueId]))}}};this._multiRenderTarget.customRenderFunction=function(e,n,i,o){var a;if(o.length){for(t.setColorWrite(!1),a=0;a<o.length;a++)r(o.data[a]);t.setColorWrite(!0)}for(a=0;a<e.length;a++)r(e.data[a]);for(a=0;a<n.length;a++)r(n.data[a])}}},e.prototype._copyBonesTransformationMatrices=function(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t},e.POSITION_TEXTURE_TYPE=1,e.VELOCITY_TEXTURE_TYPE=2,e._SceneComponentInitialization=function(e){throw be.a.WarnImport("GeometryBufferRendererSceneComponent")},e}();Object.defineProperty(W.a.prototype,"geometryBufferRenderer",{get:function(){this._geometryBufferRenderer},set:function(e){e&&e.isSupported&&(this._geometryBufferRenderer=e)},enumerable:!0,configurable:!0}),W.a.prototype.enableGeometryBufferRenderer=function(e){return void 0===e&&(e=1),this._geometryBufferRenderer?this._geometryBufferRenderer:(this._geometryBufferRenderer=new ms(this,e),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null),this._geometryBufferRenderer)},W.a.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)};var gs=function(){function e(e){this.name=Te.a.NAME_GEOMETRYBUFFERRENDERER,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Te.a.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype._gatherRenderTargets=function(e){this.scene._geometryBufferRenderer&&e.push(this.scene._geometryBufferRenderer.getGBuffer())},e}();ms._SceneComponentInitialization=function(e){var t=e._getComponent(Te.a.NAME_GEOMETRYBUFFERRENDERER);t||(t=new gs(e),e._addComponent(t))},zt.a.ShadersStore.motionBlurPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D velocitySampler;\nuniform float motionStrength;\nuniform float motionScale;\nuniform vec2 screenSize;\nvoid main(void)\n{\n#ifdef GEOMETRY_SUPPORTED\nvec2 texelSize=1.0/screenSize;\nvec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;\nvec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));\nvelocity*=motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint samplesCount=int(clamp(speed,1.0,SAMPLES));\nvelocity=normalize(velocity)*texelSize;\nfloat hlim=float(-samplesCount)*0.5+0.5;\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(SAMPLES); ++i)\n{\nif (i>=samplesCount)\nbreak;\nvec2 offset=vUV+velocity*(hlim+float(i));\nresult+=texture2D(textureSampler,offset);\n}\ngl_FragColor=result/float(samplesCount);\ngl_FragColor.a=1.0;\n#else\ngl_FragColor=texture2D(textureSampler,vUV);\n#endif\n}\n";var _s=function(e){function t(t,n,r,i,a,s,l,u,c){void 0===u&&(u=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===c&&(c=!1);var h=e.call(this,t,"motionBlur",["motionStrength","motionScale","screenSize"],["velocitySampler"],r,i,a,s,l,"#define GEOMETRY_SUPPORTED\n#define SAMPLES 64.0",u,void 0,null,c)||this;return h.motionStrength=1,h._motionBlurSamples=32,h._geometryBufferRenderer=n.enableGeometryBufferRenderer(),h._geometryBufferRenderer?(h._geometryBufferRenderer.enableVelocity=!0,h.onApply=function(e){if(e.setVector2("screenSize",new o.w(h.width,h.height)),e.setFloat("motionScale",n.getAnimationRatio()),e.setFloat("motionStrength",h.motionStrength),h._geometryBufferRenderer){var t=h._geometryBufferRenderer.getTextureIndex(ms.VELOCITY_TEXTURE_TYPE);e.setTexture("velocitySampler",h._geometryBufferRenderer.getGBuffer().textures[t])}}):(p.a.Warn("Multiple Render Target support needed to compute object based motion blur"),h.updateEffect()),h}return u.d(t,e),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this._motionBlurSamples=e,this._geometryBufferRenderer&&this.updateEffect("#define GEOMETRY_SUPPORTED\n#define SAMPLES "+e.toFixed(1))},enumerable:!0,configurable:!0}),t.prototype.excludeSkinnedMesh=function(e){this._geometryBufferRenderer&&e.skeleton&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.push(e)},t.prototype.removeExcludedSkinnedMesh=function(e){if(this._geometryBufferRenderer&&e.skeleton){var t=this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.indexOf(e);-1!==t&&this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity.splice(t,1)}},t.prototype.dispose=function(t){this._geometryBufferRenderer&&(this._geometryBufferRenderer._previousTransformationMatrices={},this._geometryBufferRenderer._previousBonesTransformationMatrices={},this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity=[]),e.prototype.dispose.call(this,t)},t}(jt);zt.a.ShadersStore.refractionPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}";var vs=function(e){function t(t,n,r,i,o,a,s,l,u,c){var h=e.call(this,t,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],a,s,l,u,c)||this;return h.color=r,h.depth=i,h.colorLevel=o,h._ownRefractionTexture=!0,h.onActivateObservable.add(function(e){h._refTexture=h._refTexture||new Ge.a(n,e.getScene())}),h.onApplyObservable.add(function(e){e.setColor3("baseColor",h.color),e.setFloat("depth",h.depth),e.setFloat("colorLevel",h.colorLevel),e.setTexture("refractionSampler",h._refTexture)}),h}return u.d(t,e),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refTexture},set:function(e){this._refTexture&&this._ownRefractionTexture&&this._refTexture.dispose(),this._refTexture=e,this._ownRefractionTexture=!1},enumerable:!0,configurable:!0}),t.prototype.dispose=function(t){this._refTexture&&this._ownRefractionTexture&&(this._refTexture.dispose(),this._refTexture=null),e.prototype.dispose.call(this,t)},t}(jt);zt.a.ShadersStore.sharpenPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform vec2 sharpnessAmounts;\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 color=texture2D(textureSampler,vUV);\nvec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1)) -\ncolor*4.0;\ngl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);\n}";var ys=function(e){function t(t,n,r,i,o,a,s,l){void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1);var u=e.call(this,t,"sharpen",["sharpnessAmounts","screenSize"],null,n,r,i,o,a,null,s,void 0,null,l)||this;return u.colorAmount=1,u.edgeAmount=.3,u.onApply=function(e){e.setFloat2("screenSize",u.width,u.height),e.setFloat2("sharpnessAmounts",u.edgeAmount,u.colorAmount)},u}return u.d(t,e),t}(jt),bs=function(){function e(e,t){this.engine=e,this._name=t,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(e.prototype,"isSupported",{get:function(){for(var e in this._renderEffects)if(this._renderEffects.hasOwnProperty(e)&&!this._renderEffects[e].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),e.prototype.addEffect=function(e){this._renderEffects[e._name]=e},e.prototype._rebuild=function(){},e.prototype._enableEffect=function(e,t){var n=this._renderEffects[e];n&&n._enable(ye.h.MakeArray(t||this._cameras))},e.prototype._disableEffect=function(e,t){var n=this._renderEffects[e];n&&n._disable(ye.h.MakeArray(t||this._cameras))},e.prototype._attachCameras=function(e,t){var n=ye.h.MakeArray(e||this._cameras);if(n){var r,i=[];for(r=0;r<n.length;r++){var o=n[r],a=o.name;-1===this._cameras.indexOf(o)?this._cameras[a]=o:t&&i.push(r)}for(r=0;r<i.length;r++)e.splice(i[r],1);for(var s in this._renderEffects)this._renderEffects.hasOwnProperty(s)&&this._renderEffects[s]._attachCameras(n)}},e.prototype._detachCameras=function(e){var t=ye.h.MakeArray(e||this._cameras);if(t){for(var n in this._renderEffects)this._renderEffects.hasOwnProperty(n)&&this._renderEffects[n]._detachCameras(t);for(var r=0;r<t.length;r++)this._cameras.splice(this._cameras.indexOf(t[r]),1)}},e.prototype._update=function(){for(var e in this._renderEffects)this._renderEffects.hasOwnProperty(e)&&this._renderEffects[e]._update();for(var t=0;t<this._cameras.length;t++){var n=this._cameras[t].name;this._renderEffectsForIsolatedPass[n]&&this._renderEffectsForIsolatedPass[n]._update()}},e.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},e.prototype._enableMSAAOnFirstPostProcess=function(e){var t=Object.keys(this._renderEffects);if(1===this.engine.webGLVersion)return!1;if(t.length>0){var n=this._renderEffects[t[0]].getPostProcesses();n&&(n[0].samples=e)}return!0},e.prototype.dispose=function(){},u.c([Object(D.c)()],e.prototype,"_name",void 0),e}(),Es=function(){function e(){this._renderPipelines={}}return Object.defineProperty(e.prototype,"supportedPipelines",{get:function(){var e=[];for(var t in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(t)){var n=this._renderPipelines[t];n.isSupported&&e.push(n)}return e},enumerable:!0,configurable:!0}),e.prototype.addPipeline=function(e){this._renderPipelines[e._name]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,n){void 0===n&&(n=!1);var r=this._renderPipelines[e];r&&r._attachCameras(t,n)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var n=this._renderPipelines[e];n&&n._detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,n){var r=this._renderPipelines[e];r&&r._enableEffect(t,n)},e.prototype.disableEffectInPipeline=function(e,t,n){var r=this._renderPipelines[e];r&&r._disableEffect(t,n)},e.prototype.update=function(){for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var t=this._renderPipelines[e];t.isSupported?t._update():(t.dispose(),delete this._renderPipelines[e])}},e.prototype._rebuild=function(){for(var e in this._renderPipelines)this._renderPipelines.hasOwnProperty(e)&&this._renderPipelines[e]._rebuild()},e.prototype.dispose=function(){for(var e in this._renderPipelines)this._renderPipelines.hasOwnProperty(e)&&this._renderPipelines[e].dispose()},e}();Object.defineProperty(W.a.prototype,"postProcessRenderPipelineManager",{get:function(){if(!this._postProcessRenderPipelineManager){var e=this._getComponent(Te.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER);e||(e=new xs(this),this._addComponent(e)),this._postProcessRenderPipelineManager=new Es}return this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0});var xs=function(){function e(e){this.name=Te.a.NAME_POSTPROCESSRENDERPIPELINEMANAGER,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Te.a.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,this,this._gatherRenderTargets)},e.prototype.rebuild=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager._rebuild()},e.prototype.dispose=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.dispose()},e.prototype._gatherRenderTargets=function(){this.scene._postProcessRenderPipelineManager&&this.scene._postProcessRenderPipelineManager.update()},e}(),Ts=function(e){function t(t,n,r,i,o){void 0===t&&(t=""),void 0===n&&(n=!0),void 0===r&&(r=P.a.LastCreatedScene),void 0===o&&(o=!0);var a=e.call(this,r.getEngine(),t)||this;a._camerasToBeAttached=[],a.SharpenPostProcessId="SharpenPostProcessEffect",a.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",a.FxaaPostProcessId="FxaaPostProcessEffect",a.ChromaticAberrationPostProcessId="ChromaticAberrationPostProcessEffect",a.GrainPostProcessId="GrainPostProcessEffect",a._glowLayer=null,a.animations=[],a._imageProcessingConfigurationObserver=null,a._sharpenEnabled=!1,a._bloomEnabled=!1,a._depthOfFieldEnabled=!1,a._depthOfFieldBlurLevel=as.Low,a._fxaaEnabled=!1,a._imageProcessingEnabled=!0,a._bloomScale=.5,a._chromaticAberrationEnabled=!1,a._grainEnabled=!1,a._buildAllowed=!0,a._resizeObserver=null,a._hardwareScaleLevel=1,a._bloomKernel=64,a._bloomWeight=.15,a._bloomThreshold=.9,a._samples=1,a._hasCleared=!1,a._prevPostProcess=null,a._prevPrevPostProcess=null,a._depthOfFieldSceneObserver=null,a._cameras=i||r.cameras,a._cameras=a._cameras.slice(),a._camerasToBeAttached=a._cameras.slice(),a._buildAllowed=o,a._scene=r;var s=a._scene.getEngine().getCaps();a._hdr=n&&(s.textureHalfFloatRender||s.textureFloatRender),a._hdr?s.textureHalfFloatRender?a._defaultPipelineTextureType=m.a.TEXTURETYPE_HALF_FLOAT:s.textureFloatRender&&(a._defaultPipelineTextureType=m.a.TEXTURETYPE_FLOAT):a._defaultPipelineTextureType=m.a.TEXTURETYPE_UNSIGNED_INT,r.postProcessRenderPipelineManager.addPipeline(a);var l=a._scene.getEngine();return a.sharpen=new ys("sharpen",1,null,Ge.a.BILINEAR_SAMPLINGMODE,l,!1,a._defaultPipelineTextureType,!0),a._sharpenEffect=new Za(l,a.SharpenPostProcessId,function(){return a.sharpen},!0),a.depthOfField=new us(a._scene,null,a._depthOfFieldBlurLevel,a._defaultPipelineTextureType,!0),a.bloom=new es(a._scene,a._bloomScale,a._bloomWeight,a.bloomKernel,a._defaultPipelineTextureType,!0),a.chromaticAberration=new ts("ChromaticAberration",l.getRenderWidth(),l.getRenderHeight(),1,null,Ge.a.BILINEAR_SAMPLINGMODE,l,!1,a._defaultPipelineTextureType,!0),a._chromaticAberrationEffect=new Za(l,a.ChromaticAberrationPostProcessId,function(){return a.chromaticAberration},!0),a.grain=new fs("Grain",1,null,Ge.a.BILINEAR_SAMPLINGMODE,l,!1,a._defaultPipelineTextureType,!0),a._grainEffect=new Za(l,a.GrainPostProcessId,function(){return a.grain},!0),a._resizeObserver=l.onResizeObservable.add(function(){a._hardwareScaleLevel=l.getHardwareScalingLevel(),a.bloomKernel=a.bloomKernel}),a._imageProcessingConfigurationObserver=a._scene.imageProcessingConfiguration.onUpdateParameters.add(function(){a.bloom._downscale._exposure=a._scene.imageProcessingConfiguration.exposure}),a._buildPipeline(),a}return u.d(t,e),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharpenEnabled",{get:function(){return this._sharpenEnabled},set:function(e){this._sharpenEnabled!==e&&(this._sharpenEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomKernel",{get:function(){return this._bloomKernel},set:function(e){this._bloomKernel=e,this.bloom.kernel=e/this._hardwareScaleLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(e){this._bloomWeight!==e&&(this.bloom.weight=e,this._bloomWeight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomThreshold",{get:function(){return this._bloomThreshold},set:function(e){this._bloomThreshold!==e&&(this.bloom.threshold=e,this._bloomThreshold=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._rebuildBloom(),this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype._rebuildBloom=function(){var e=this.bloom;this.bloom=new es(this._scene,this.bloomScale,this._bloomWeight,this.bloomKernel,this._defaultPipelineTextureType,!1),this.bloom.threshold=e.threshold;for(var t=0;t<this._cameras.length;t++)e.disposeEffects(this._cameras[t])},Object.defineProperty(t.prototype,"depthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthOfFieldBlurLevel",{get:function(){return this._depthOfFieldBlurLevel},set:function(e){if(this._depthOfFieldBlurLevel!==e){this._depthOfFieldBlurLevel=e;var t=this.depthOfField;this.depthOfField=new us(this._scene,null,this._depthOfFieldBlurLevel,this._defaultPipelineTextureType,!1),this.depthOfField.focalLength=t.focalLength,this.depthOfField.focusDistance=t.focusDistance,this.depthOfField.fStop=t.fStop,this.depthOfField.lensSize=t.lensSize;for(var n=0;n<this._cameras.length;n++)t.disposeEffects(this._cameras[n]);this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._imageProcessingEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glowLayerEnabled",{get:function(){return null!=this._glowLayer},set:function(e){e&&!this._glowLayer?this._glowLayer=new wi("",this._scene):!e&&this._glowLayer&&(this._glowLayer.dispose(),this._glowLayer=null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glowLayer",{get:function(){return this._glowLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberrationEnabled",{get:function(){return this._chromaticAberrationEnabled},set:function(e){this._chromaticAberrationEnabled!==e&&(this._chromaticAberrationEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grainEnabled",{get:function(){return this._grainEnabled},set:function(e){this._grainEnabled!==e&&(this._grainEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"DefaultRenderingPipeline"},t.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},t.prototype._setAutoClearAndTextureSharing=function(e,t){void 0===t&&(t=!1),this._hasCleared?e.autoClear=!1:(e.autoClear=!0,this._scene.autoClear=!1,this._hasCleared=!0),t||(this._prevPrevPostProcess?e.shareOutputWith(this._prevPrevPostProcess):e.useOwnOutput(),this._prevPostProcess&&(this._prevPrevPostProcess=this._prevPostProcess),this._prevPostProcess=e)},t.prototype._buildPipeline=function(){var e=this;if(this._buildAllowed){this._scene.autoClear=!0;var t=this._scene.getEngine();if(this._disposePostProcesses(),null!==this._cameras&&(this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._cameras=this._camerasToBeAttached.slice()),this._reset(),this._prevPostProcess=null,this._prevPrevPostProcess=null,this._hasCleared=!1,this.depthOfFieldEnabled){if(this._cameras.length>1){for(var n=0,r=this._cameras;n<r.length;n++){var i=r[n];(o=this._scene.enableDepthRenderer(i)).useOnlyInActiveCamera=!0}this._depthOfFieldSceneObserver=this._scene.onAfterRenderTargetsRenderObservable.add(function(t){e._cameras.indexOf(t.activeCamera)>-1&&(e.depthOfField.depthTexture=t.enableDepthRenderer(t.activeCamera).getDepthMap())})}else{this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);var o=this._scene.enableDepthRenderer(this._cameras[0]);this.depthOfField.depthTexture=o.getDepthMap()}this.depthOfField._isReady()||this.depthOfField._updateEffects(),this.addEffect(this.depthOfField),this._setAutoClearAndTextureSharing(this.depthOfField._effects[0],!0)}else this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver);this.bloomEnabled&&(this.bloom._isReady()||this.bloom._updateEffects(),this.addEffect(this.bloom),this._setAutoClearAndTextureSharing(this.bloom._effects[0],!0)),this._imageProcessingEnabled&&(this.imageProcessing=new xn("imageProcessing",1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._defaultPipelineTextureType),this._hdr?(this.addEffect(new Za(t,this.ImageProcessingPostProcessId,function(){return e.imageProcessing},!0)),this._setAutoClearAndTextureSharing(this.imageProcessing)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.sharpenEnabled&&(this.sharpen.isReady()||this.sharpen.updateEffect(),this.addEffect(this._sharpenEffect),this._setAutoClearAndTextureSharing(this.sharpen)),this.grainEnabled&&(this.grain.isReady()||this.grain.updateEffect(),this.addEffect(this._grainEffect),this._setAutoClearAndTextureSharing(this.grain)),this.chromaticAberrationEnabled&&(this.chromaticAberration.isReady()||this.chromaticAberration.updateEffect(),this.addEffect(this._chromaticAberrationEffect),this._setAutoClearAndTextureSharing(this.chromaticAberration)),this.fxaaEnabled&&(this.fxaa=new ds("fxaa",1,null,Ge.a.BILINEAR_SAMPLINGMODE,t,!1,this._defaultPipelineTextureType),this.addEffect(new Za(t,this.FxaaPostProcessId,function(){return e.fxaa},!0)),this._setAutoClearAndTextureSharing(this.fxaa,!0)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this.samples)&&this.samples>1&&p.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")}},t.prototype._disposePostProcesses=function(e){void 0===e&&(e=!1);for(var t=0;t<this._cameras.length;t++){var n=this._cameras[t];this.imageProcessing&&this.imageProcessing.dispose(n),this.fxaa&&this.fxaa.dispose(n),e&&(this.sharpen&&this.sharpen.dispose(n),this.depthOfField&&(this._scene.onAfterRenderTargetsRenderObservable.remove(this._depthOfFieldSceneObserver),this.depthOfField.disposeEffects(n)),this.bloom&&this.bloom.disposeEffects(n),this.chromaticAberration&&this.chromaticAberration.dispose(n),this.grain&&this.grain.dispose(n),this._glowLayer&&this._glowLayer.dispose())}this.imageProcessing=null,this.fxaa=null,e&&(this.sharpen=null,this._sharpenEffect=null,this.depthOfField=null,this.bloom=null,this.chromaticAberration=null,this._chromaticAberrationEffect=null,this.grain=null,this._grainEffect=null,this._glowLayer=null)},t.prototype.addCamera=function(e){this._camerasToBeAttached.push(e),this._buildPipeline()},t.prototype.removeCamera=function(e){var t=this._camerasToBeAttached.indexOf(e);this._camerasToBeAttached.splice(t,1),this._buildPipeline()},t.prototype.dispose=function(){this._disposePostProcesses(!0),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),this._scene.autoClear=!0,this._resizeObserver&&(this._scene.getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this._scene.imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingConfigurationObserver),e.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="DefaultRenderingPipeline",e},t.Parse=function(e,n,r){return D.a.Parse(function(){return new t(e._name,e._name._hdr,n)},e,n,r)},u.c([Object(D.c)()],t.prototype,"sharpenEnabled",null),u.c([Object(D.c)()],t.prototype,"bloomKernel",null),u.c([Object(D.c)()],t.prototype,"_bloomWeight",void 0),u.c([Object(D.c)()],t.prototype,"_bloomThreshold",void 0),u.c([Object(D.c)()],t.prototype,"_hdr",void 0),u.c([Object(D.c)()],t.prototype,"bloomWeight",null),u.c([Object(D.c)()],t.prototype,"bloomThreshold",null),u.c([Object(D.c)()],t.prototype,"bloomScale",null),u.c([Object(D.c)()],t.prototype,"bloomEnabled",null),u.c([Object(D.c)()],t.prototype,"depthOfFieldEnabled",null),u.c([Object(D.c)()],t.prototype,"depthOfFieldBlurLevel",null),u.c([Object(D.c)()],t.prototype,"fxaaEnabled",null),u.c([Object(D.c)()],t.prototype,"samples",null),u.c([Object(D.c)()],t.prototype,"imageProcessingEnabled",null),u.c([Object(D.c)()],t.prototype,"glowLayerEnabled",null),u.c([Object(D.c)()],t.prototype,"chromaticAberrationEnabled",null),u.c([Object(D.c)()],t.prototype,"grainEnabled",null),t}(bs);a.a.RegisteredTypes["BABYLON.DefaultRenderingPipeline"]=Ts,zt.a.ShadersStore.lensHighlightsPixelShader="\nuniform sampler2D textureSampler;\n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",zt.a.ShadersStore.depthOfFieldPixelShader="\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance;\nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1\n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight;\n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV);\nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);\nfloat depth=texture2D(depthSampler,distorted_coords).r;\nfloat distance=near+(far-near)*depth;\nvec4 color=texture2D(textureSampler,vUV);\n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n";var Ss=function(e){function t(t,n,r,i,o){void 0===i&&(i=1);var a=e.call(this,r.getEngine(),t)||this;return a.LensChromaticAberrationEffect="LensChromaticAberrationEffect",a.HighlightsEnhancingEffect="HighlightsEnhancingEffect",a.LensDepthOfFieldEffect="LensDepthOfFieldEffect",a._pentagonBokehIsEnabled=!1,a._scene=r,a._depthTexture=r.enableDepthRenderer().getDepthMap(),n.grain_texture?a._grainTexture=n.grain_texture:a._createGrainTexture(),a._edgeBlur=n.edge_blur?n.edge_blur:0,a._grainAmount=n.grain_amount?n.grain_amount:0,a._chromaticAberration=n.chromatic_aberration?n.chromatic_aberration:0,a._distortion=n.distortion?n.distortion:0,a._highlightsGain=void 0!==n.dof_gain?n.dof_gain:-1,a._highlightsThreshold=n.dof_threshold?n.dof_threshold:1,a._dofDistance=void 0!==n.dof_focus_distance?n.dof_focus_distance:-1,a._dofAperture=n.dof_aperture?n.dof_aperture:1,a._dofDarken=n.dof_darken?n.dof_darken:0,a._dofPentagon=void 0===n.dof_pentagon||n.dof_pentagon,a._blurNoise=void 0===n.blur_noise||n.blur_noise,a._createChromaticAberrationPostProcess(i),a._createHighlightsPostProcess(i),a._createDepthOfFieldPostProcess(i/4),a.addEffect(new Za(r.getEngine(),a.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),a.addEffect(new Za(r.getEngine(),a.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),a.addEffect(new Za(r.getEngine(),a.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1===a._highlightsGain&&a._disableEffect(a.HighlightsEnhancingEffect,null),r.postProcessRenderPipelineManager.addPipeline(a),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,o),a}return u.d(t,e),t.prototype.getClassName=function(){return"LensRenderingPipeline"},Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edgeBlur",{get:function(){return this._edgeBlur},set:function(e){this.setEdgeBlur(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"grainAmount",{get:function(){return this._grainAmount},set:function(e){this.setGrainAmount(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chromaticAberration",{get:function(){return this._chromaticAberration},set:function(e){this.setChromaticAberration(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dofAperture",{get:function(){return this._dofAperture},set:function(e){this.setAperture(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edgeDistortion",{get:function(){return this._distortion},set:function(e){this.setEdgeDistortion(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dofDistortion",{get:function(){return this._dofDistance},set:function(e){this.setFocusDistance(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"darkenOutOfFocus",{get:function(){return this._dofDarken},set:function(e){this.setDarkenOutOfFocus(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurNoise",{get:function(){return this._blurNoise},set:function(e){this._blurNoise=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pentagonBokeh",{get:function(){return this._pentagonBokehIsEnabled},set:function(e){e?this.enablePentagonBokeh():this.disablePentagonBokeh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsGain",{get:function(){return this._highlightsGain},set:function(e){this.setHighlightsGain(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsThreshold",{get:function(){return this._highlightsThreshold},set:function(e){this.setHighlightsThreshold(e)},enumerable:!0,configurable:!0}),t.prototype.setEdgeBlur=function(e){this._edgeBlur=e},t.prototype.disableEdgeBlur=function(){this._edgeBlur=0},t.prototype.setGrainAmount=function(e){this._grainAmount=e},t.prototype.disableGrain=function(){this._grainAmount=0},t.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},t.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},t.prototype.setEdgeDistortion=function(e){this._distortion=e},t.prototype.disableEdgeDistortion=function(){this._distortion=0},t.prototype.setFocusDistance=function(e){this._dofDistance=e},t.prototype.disableDepthOfField=function(){this._dofDistance=-1},t.prototype.setAperture=function(e){this._dofAperture=e},t.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},t.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n"),this._pentagonBokehIsEnabled=!0},t.prototype.disablePentagonBokeh=function(){this._pentagonBokehIsEnabled=!1,this._highlightsPostProcess.updateEffect()},t.prototype.enableNoiseBlur=function(){this._blurNoise=!0},t.prototype.disableNoiseBlur=function(){this._blurNoise=!1},t.prototype.setHighlightsGain=function(e){this._highlightsGain=e},t.prototype.setHighlightsThreshold=function(e){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},t.prototype.disableHighlights=function(){this._highlightsGain=-1},t.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},t.prototype._createChromaticAberrationPostProcess=function(e){var t=this;this._chromaticAberrationPostProcess=new jt("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height","direction","radialIntensity","centerPosition"],[],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat("chromatic_aberration",t._chromaticAberration),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight()),e.setFloat("radialIntensity",1),e.setFloat2("direction",17,17),e.setFloat2("centerPosition",.5,.5)}},t.prototype._createHighlightsPostProcess=function(e){var t=this;this._highlightsPostProcess=new jt("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(e){e.setFloat("gain",t._highlightsGain),e.setFloat("threshold",t._highlightsThreshold),e.setTextureFromPostProcess("textureSampler",t._chromaticAberrationPostProcess),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight())}},t.prototype._createDepthOfFieldPostProcess=function(e){var t=this;this._depthOfFieldPostProcess=new jt("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture("depthSampler",t._depthTexture),e.setTexture("grainSampler",t._grainTexture),e.setTextureFromPostProcess("textureSampler",t._highlightsPostProcess),e.setTextureFromPostProcess("highlightsSampler",t._depthOfFieldPostProcess),e.setFloat("grain_amount",t._grainAmount),e.setBool("blur_noise",t._blurNoise),e.setFloat("screen_width",t._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",t._scene.getEngine().getRenderHeight()),e.setFloat("distortion",t._distortion),e.setBool("dof_enabled",-1!==t._dofDistance),e.setFloat("screen_distance",1/(.1-1/t._dofDistance)),e.setFloat("aperture",t._dofAperture),e.setFloat("darken",t._dofDarken),e.setFloat("edge_blur",t._edgeBlur),e.setBool("highlights",-1!==t._highlightsGain),t._scene.activeCamera&&(e.setFloat("near",t._scene.activeCamera.minZ),e.setFloat("far",t._scene.activeCamera.maxZ))}},t.prototype._createGrainTexture=function(){this._grainTexture=new bn("LensNoiseTexture",512,this._scene,!1,Ge.a.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,this._grainTexture.wrapV=Ge.a.WRAP_ADDRESSMODE;for(var e,t=this._grainTexture.getContext(),n=0;n<512;n++)for(var r=0;r<512;r++)e=Math.floor(255*(Math.random()*(.58-.42)+.42)),t.fillStyle="rgb("+e+", "+e+", "+e+")",t.fillRect(n,r,1,1);this._grainTexture.update(!1)},t}(bs);zt.a.ShadersStore.ssao2PixelShader="\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nfloat scales[16]=float[16](\n0.1,\n0.11406250000000001,\n0.131640625,\n0.15625,\n0.187890625,\n0.2265625,\n0.272265625,\n0.325,\n0.384765625,\n0.4515625,\n0.525390625,\n0.60625,\n0.694140625,\n0.7890625,\n0.891015625,\n1.0\n);\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform sampler2D normalSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\nfloat depth=texture2D(textureSampler,vUV).r;\nfloat depthSign=depth/abs(depth);\ndepth=depth*depthSign;\nvec3 normal=texture2D(normalSampler,vUV).rgb;\nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\n\nfloat dotProduct=dot(rvec,normal);\nrvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\nfloat sampleDepth=abs(texture2D(textureSampler,offset.xy).r);\n\ndifference=depthSign*samplePosition.z-sampleDepth;\nfloat rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);\nocclusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;\n}\nocclusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n",zt.a.ShadersStore.ssaoCombinePixelShader="uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nuniform vec4 viewport;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n";var As=function(e){function t(t,n,r,i){var o=e.call(this,n.getEngine(),t)||this;if(o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.maxZ=100,o.minZAspect=.2,o._samples=8,o._textureSamples=1,o._expensiveBlur=!0,o.radius=2,o.base=0,o._firstUpdate=!0,o._bits=new Uint32Array(1),o._scene=n,o._ratio=r,!o.isSupported)return p.a.Error("SSAO 2 needs WebGL 2 support."),o;var a=o._ratio.ssaoRatio||r,s=o._ratio.blurRatio||r,l=n.enableGeometryBufferRenderer();return o._createRandomTexture(),o._depthTexture=l.getGBuffer().textures[0],o._normalTexture=l.getGBuffer().textures[1],o._originalColorPostProcess=new Ht("SSAOOriginalSceneColor",1,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),o._originalColorPostProcess.samples=o.textureSamples,o._createSSAOPostProcess(1),o._createBlurPostProcess(a,s),o._createSSAOCombinePostProcess(s),o.addEffect(new Za(n.getEngine(),o.SSAOOriginalSceneColorEffect,function(){return o._originalColorPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAORenderEffect,function(){return o._ssaoPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurHRenderEffect,function(){return o._blurHPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurVRenderEffect,function(){return o._blurVPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOCombineRenderEffect,function(){return o._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(o),i&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,i),o}return u.d(t,e),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._ssaoPostProcess.updateEffect("#define SAMPLES "+e+"\n#define SSAO"),this._samples=e,this._sampleSphere=this._generateHemisphere(),this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureSamples",{get:function(){return this._textureSamples},set:function(e){this._textureSamples=e,this._originalColorPostProcess.samples=e,this._blurHPostProcess.samples=e,this._blurVPostProcess.samples=e,this._ssaoPostProcess.samples=e,this._ssaoCombinePostProcess.samples=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._expensiveBlur=e,this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){var e=P.a.LastCreatedEngine;return!!e&&e.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SSAO2RenderingPipeline"},t.prototype.dispose=function(t){void 0===t&&(t=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),t&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e,t){var n=this;this._samplerOffsets=[];for(var r=this.expensiveBlur,i=-8;i<8;i++)this._samplerOffsets.push(2*i+.5);this._blurHPostProcess=new jt("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],e,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(r?"1":"0")+"\n"),this._blurHPostProcess.onApply=function(e){n._scene.activeCamera&&(e.setFloat("outSize",n._ssaoCombinePostProcess.width>0?n._ssaoCombinePostProcess.width:n._originalColorPostProcess.width),e.setFloat("near",n._scene.activeCamera.minZ),e.setFloat("far",n._scene.activeCamera.maxZ),e.setFloat("radius",n.radius),e.setTexture("depthSampler",n._depthTexture),n._firstUpdate&&e.setArray("samplerOffsets",n._samplerOffsets))},this._blurVPostProcess=new jt("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],t,null,Ge.a.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+(r?"1":"0")+"\n"),this._blurVPostProcess.onApply=function(e){n._scene.activeCamera&&(e.setFloat("outSize",n._ssaoCombinePostProcess.height>0?n._ssaoCombinePostProcess.height:n._originalColorPostProcess.height),e.setFloat("near",n._scene.activeCamera.minZ),e.setFloat("far",n._scene.activeCamera.maxZ),e.setFloat("radius",n.radius),e.setTexture("depthSampler",n._depthTexture),n._firstUpdate&&(e.setArray("samplerOffsets",n._samplerOffsets),n._firstUpdate=!1))},this._blurHPostProcess.samples=this.textureSamples,this._blurVPostProcess.samples=this.textureSamples},t.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},t.prototype._radicalInverse_VdC=function(e){return this._bits[0]=e,this._bits[0]=(this._bits[0]<<16|this._bits[0]>>16)>>>0,this._bits[0]=(1431655765&this._bits[0])<<1|(2863311530&this._bits[0])>>>1>>>0,this._bits[0]=(858993459&this._bits[0])<<2|(3435973836&this._bits[0])>>>2>>>0,this._bits[0]=(252645135&this._bits[0])<<4|(4042322160&this._bits[0])>>>4>>>0,this._bits[0]=(16711935&this._bits[0])<<8|(4278255360&this._bits[0])>>>8>>>0,2.3283064365386963e-10*this._bits[0]},t.prototype._hammersley=function(e,t){return[e/t,this._radicalInverse_VdC(e)]},t.prototype._hemisphereSample_uniform=function(e,t){var n=2*t*Math.PI,r=1-(.85*e+.15),i=Math.sqrt(1-r*r);return new o.x(Math.cos(n)*i,Math.sin(n)*i,r)},t.prototype._generateHemisphere=function(){for(var e,t=this.samples,n=[],r=0;r<t;){if(t<16)e=this._hemisphereSample_uniform(Math.random(),Math.random());else{var i=this._hammersley(r,t);e=this._hemisphereSample_uniform(i[0],i[1])}n.push(e.x,e.y,e.z),r++}return n},t.prototype._createSSAOPostProcess=function(e){var t=this,n=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new jt("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+n+"\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){t._firstUpdate&&(e.setArray3("sampleSphere",t._sampleSphere),e.setFloat("randTextureTiles",32)),t._scene.activeCamera&&(e.setFloat("samplesFactor",1/t.samples),e.setFloat("totalStrength",t.totalStrength),e.setFloat2("texelSize",1/t._ssaoPostProcess.width,1/t._ssaoPostProcess.height),e.setFloat("radius",t.radius),e.setFloat("maxZ",t.maxZ),e.setFloat("minZAspect",t.minZAspect),e.setFloat("base",t.base),e.setFloat("near",t._scene.activeCamera.minZ),e.setFloat("far",t._scene.activeCamera.maxZ),e.setFloat("xViewport",Math.tan(t._scene.activeCamera.fov/2)*t._scene.getEngine().getAspectRatio(t._scene.activeCamera,!0)),e.setFloat("yViewport",Math.tan(t._scene.activeCamera.fov/2)),e.setMatrix("projection",t._scene.getProjectionMatrix()),e.setTexture("textureSampler",t._depthTexture),e.setTexture("normalSampler",t._normalTexture),e.setTexture("randomSampler",t._randomTexture))},this._ssaoPostProcess.samples=this.textureSamples},t.prototype._createSSAOCombinePostProcess=function(e){var t=this;this._ssaoCombinePostProcess=new jt("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){var n=t._scene.activeCamera.viewport;e.setVector4("viewport",o.t.Vector4[0].copyFromFloats(n.x,n.y,n.width,n.height)),e.setTextureFromPostProcess("originalColor",t._originalColorPostProcess)},this._ssaoCombinePostProcess.samples=this.textureSamples},t.prototype._createRandomTexture=function(){this._randomTexture=new bn("SSAORandomTexture",128,this._scene,!1,Ge.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Ge.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),t=function(e,t){return Math.random()*(t-e)+e},n=o.x.Zero(),r=0;r<128;r++)for(var i=0;i<128;i++)n.x=t(0,1),n.y=t(0,1),n.z=0,n.normalize(),n.scaleInPlace(255),n.x=Math.floor(n.x),n.y=Math.floor(n.y),e.fillStyle="rgb("+n.x+", "+n.y+", "+n.z+")",e.fillRect(r,i,1,1);this._randomTexture.update(!1)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return e.customType="SSAO2RenderingPipeline",e},t.Parse=function(e,n,r){return D.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r)},u.c([Object(D.c)()],t.prototype,"totalStrength",void 0),u.c([Object(D.c)()],t.prototype,"maxZ",void 0),u.c([Object(D.c)()],t.prototype,"minZAspect",void 0),u.c([Object(D.c)("samples")],t.prototype,"_samples",void 0),u.c([Object(D.c)("textureSamples")],t.prototype,"_textureSamples",void 0),u.c([Object(D.c)()],t.prototype,"_ratio",void 0),u.c([Object(D.c)("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),u.c([Object(D.c)()],t.prototype,"radius",void 0),u.c([Object(D.c)()],t.prototype,"base",void 0),t}(bs);a.a.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"]=As,zt.a.ShadersStore.ssaoPixelShader="\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n";var Ps=function(e){function t(t,n,r,i){var o=e.call(this,n.getEngine(),t)||this;o.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",o.SSAORenderEffect="SSAORenderEffect",o.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",o.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",o.SSAOCombineRenderEffect="SSAOCombineRenderEffect",o.totalStrength=1,o.radius=1e-4,o.area=.0075,o.fallOff=1e-6,o.base=.5,o._firstUpdate=!0,o._scene=n,o._createRandomTexture(),o._depthTexture=n.enableDepthRenderer().getDepthMap();var a=r.ssaoRatio||r,s=r.combineRatio||r;return o._originalColorPostProcess=new Ht("SSAOOriginalSceneColor",s,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),o._createSSAOPostProcess(a),o._createBlurPostProcess(a),o._createSSAOCombinePostProcess(s),o.addEffect(new Za(n.getEngine(),o.SSAOOriginalSceneColorEffect,function(){return o._originalColorPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAORenderEffect,function(){return o._ssaoPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurHRenderEffect,function(){return o._blurHPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOBlurVRenderEffect,function(){return o._blurVPostProcess},!0)),o.addEffect(new Za(n.getEngine(),o.SSAOCombineRenderEffect,function(){return o._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(o),i&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(t,i),o}return u.d(t,e),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"SSAORenderingPipeline"},t.prototype.dispose=function(t){void 0===t&&(t=!1);for(var n=0;n<this._scene.cameras.length;n++){var r=this._scene.cameras[n];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),t&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),e.prototype.dispose.call(this)},t.prototype._createBlurPostProcess=function(e){var t=this;this._blurHPostProcess=new zr("BlurH",new o.w(1,0),16,e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,m.a.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new zr("BlurV",new o.w(0,1),16,e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,m.a.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var e=t._blurHPostProcess.width/t._scene.getEngine().getRenderWidth();t._blurHPostProcess.kernel=16*e}),this._blurVPostProcess.onActivateObservable.add(function(){var e=t._blurVPostProcess.height/t._scene.getEngine().getRenderHeight();t._blurVPostProcess.kernel=16*e})},t.prototype._rebuild=function(){this._firstUpdate=!0,e.prototype._rebuild.call(this)},t.prototype._createSSAOPostProcess=function(e){var t=this,n=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new jt("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){t._firstUpdate&&(e.setArray3("sampleSphere",n),e.setFloat("samplesFactor",1/16),e.setFloat("randTextureTiles",4)),e.setFloat("totalStrength",t.totalStrength),e.setFloat("radius",t.radius),e.setFloat("area",t.area),e.setFloat("fallOff",t.fallOff),e.setFloat("base",t.base),e.setTexture("textureSampler",t._depthTexture),e.setTexture("randomSampler",t._randomTexture)}},t.prototype._createSSAOCombinePostProcess=function(e){var t=this;this._ssaoCombinePostProcess=new jt("ssaoCombine","ssaoCombine",[],["originalColor","viewport"],e,null,Ge.a.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setVector4("viewport",o.t.Vector4[0].copyFromFloats(0,0,1,1)),e.setTextureFromPostProcess("originalColor",t._originalColorPostProcess)}},t.prototype._createRandomTexture=function(){this._randomTexture=new bn("SSAORandomTexture",512,this._scene,!1,Ge.a.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=Ge.a.WRAP_ADDRESSMODE,this._randomTexture.wrapV=Ge.a.WRAP_ADDRESSMODE;for(var e=this._randomTexture.getContext(),t=function(e,t){return Math.random()*(t-e)+e},n=o.x.Zero(),r=0;r<512;r++)for(var i=0;i<512;i++)n.x=Math.floor(255*t(-1,1)),n.y=Math.floor(255*t(-1,1)),n.z=Math.floor(255*t(-1,1)),e.fillStyle="rgb("+n.x+", "+n.y+", "+n.z+")",e.fillRect(r,i,1,1);this._randomTexture.update(!1)},u.c([Object(D.c)()],t.prototype,"totalStrength",void 0),u.c([Object(D.c)()],t.prototype,"radius",void 0),u.c([Object(D.c)()],t.prototype,"area",void 0),u.c([Object(D.c)()],t.prototype,"fallOff",void 0),u.c([Object(D.c)()],t.prototype,"base",void 0),t}(bs);zt.a.ShadersStore.standardPixelShader="uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\n#ifndef AUTO_EXPOSURE\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\n#endif\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n";var Ms,Rs=function(e){function t(t,n,r,i,o){void 0===i&&(i=null);var a=e.call(this,n.getEngine(),t)||this;return a.downSampleX4PostProcess=null,a.brightPassPostProcess=null,a.blurHPostProcesses=[],a.blurVPostProcesses=[],a.textureAdderPostProcess=null,a.volumetricLightPostProcess=null,a.volumetricLightSmoothXPostProcess=null,a.volumetricLightSmoothYPostProcess=null,a.volumetricLightMergePostProces=null,a.volumetricLightFinalPostProcess=null,a.luminancePostProcess=null,a.luminanceDownSamplePostProcesses=[],a.hdrPostProcess=null,a.textureAdderFinalPostProcess=null,a.lensFlareFinalPostProcess=null,a.hdrFinalPostProcess=null,a.lensFlarePostProcess=null,a.lensFlareComposePostProcess=null,a.motionBlurPostProcess=null,a.depthOfFieldPostProcess=null,a.fxaaPostProcess=null,a.brightThreshold=1,a.blurWidth=512,a.horizontalBlur=!1,a.lensTexture=null,a.volumetricLightCoefficient=.2,a.volumetricLightPower=4,a.volumetricLightBlurScale=64,a.sourceLight=null,a.hdrMinimumLuminance=1,a.hdrDecreaseRate=.5,a.hdrIncreaseRate=.5,a.lensColorTexture=null,a.lensFlareStrength=20,a.lensFlareGhostDispersal=1.4,a.lensFlareHaloWidth=.7,a.lensFlareDistortionStrength=16,a.lensStarTexture=null,a.lensFlareDirtTexture=null,a.depthOfFieldDistance=10,a.depthOfFieldBlurWidth=64,a.motionStrength=1,a.animations=[],a._currentDepthOfFieldSource=null,a._fixedExposure=1,a._currentExposure=1,a._hdrAutoExposure=!1,a._hdrCurrentLuminance=1,a._bloomEnabled=!1,a._depthOfFieldEnabled=!1,a._vlsEnabled=!1,a._lensFlareEnabled=!1,a._hdrEnabled=!1,a._motionBlurEnabled=!1,a._fxaaEnabled=!1,a._motionBlurSamples=64,a._volumetricLightStepsCount=50,a._samples=1,a._cameras=o||[],a._scene=n,a._basePostProcess=i,a._ratio=r,a._floatTextureType=n.getEngine().getCaps().textureFloatRender?m.a.TEXTURETYPE_FLOAT:m.a.TEXTURETYPE_HALF_FLOAT,n.postProcessRenderPipelineManager.addPipeline(a),a._buildPipeline(),a}return u.d(t,e),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._fixedExposure},set:function(e){this._fixedExposure=e,this._currentExposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hdrAutoExposure",{get:function(){return this._hdrAutoExposure},set:function(e){if(this._hdrAutoExposure=e,this.hdrPostProcess){var t=["#define HDR"];e&&t.push("#define AUTO_EXPOSURE"),this.hdrPostProcess.updateEffect(t.join("\n"))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(e){if(this._vlsEnabled!==e){if(e&&!this._scene.enableGeometryBufferRenderer())return void p.a.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline");this._vlsEnabled=e,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+e.toFixed(1)),this._motionBlurSamples=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples!==e&&(this._samples=e,this._buildPipeline())},enumerable:!0,configurable:!0}),t.prototype._buildPipeline=function(){var e=this,t=this._ratio,n=this._scene;this._disposePostProcesses(),this._reset(),this._basePostProcess?this.originalPostProcess=this._basePostProcess:(this.originalPostProcess=new jt("HDRPass","standard",[],[],t,null,m.a.TEXTURE_BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.onApply=function(){e._currentDepthOfFieldSource=e.originalPostProcess}),(this._bloomEnabled||this._vlsEnabled||this._lensFlareEnabled||this._depthOfFieldEnabled||this._motionBlurEnabled)&&this.addEffect(new Za(n.getEngine(),"HDRPassPostProcess",function(){return e.originalPostProcess},!0)),this._currentDepthOfFieldSource=this.originalPostProcess,this._bloomEnabled&&(this._createDownSampleX4PostProcess(n,t/2),this._createBrightPassPostProcess(n,t/2),this._createBlurPostProcesses(n,t/4,1),this._createTextureAdderPostProcess(n,t),this.textureAdderFinalPostProcess=new jt("HDRDepthOfFieldSource","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",m.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRBaseDepthOfFieldSource",function(){return e.textureAdderFinalPostProcess},!0))),this._vlsEnabled&&(this._createVolumetricLightPostProcess(n,t),this.volumetricLightFinalPostProcess=new jt("HDRVLSFinal","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",m.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRVLSFinal",function(){return e.volumetricLightFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(n,t),this.lensFlareFinalPostProcess=new jt("HDRPostLensFlareDepthOfFieldSource","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",m.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return e.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(n,this._floatTextureType),this._createHdrPostProcess(n,t),this.hdrFinalPostProcess=new jt("HDRPostHDReDepthOfFieldSource","standard",[],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,"#define PASS_POST_PROCESS",m.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return e.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(n,t/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(n,t)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(n,t),this._fxaaEnabled&&(this.fxaaPostProcess=new ds("fxaa",1,null,Ge.a.BILINEAR_SAMPLINGMODE,n.getEngine(),!1,m.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(n.getEngine(),"HDRFxaa",function(){return e.fxaaPostProcess},!0))),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras),!this._enableMSAAOnFirstPostProcess(this._samples)&&this._samples>1&&p.a.Warn("MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0")},t.prototype._createDownSampleX4PostProcess=function(e,t){var n=this,r=new Array(32);this.downSampleX4PostProcess=new jt("HDRDownSampleX4","standard",["dsOffsets"],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DOWN_SAMPLE_X4",m.a.TEXTURETYPE_UNSIGNED_INT),this.downSampleX4PostProcess.onApply=function(e){for(var t=0,i=n.downSampleX4PostProcess.width,o=n.downSampleX4PostProcess.height,a=-2;a<2;a++)for(var s=-2;s<2;s++)r[t]=(a+.5)*(1/i),r[t+1]=(s+.5)*(1/o),t+=2;e.setArray2("dsOffsets",r)},this.addEffect(new Za(e.getEngine(),"HDRDownSampleX4",function(){return n.downSampleX4PostProcess},!0))},t.prototype._createBrightPassPostProcess=function(e,t){var n=this,r=new Array(8);this.brightPassPostProcess=new jt("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define BRIGHT_PASS",m.a.TEXTURETYPE_UNSIGNED_INT),this.brightPassPostProcess.onApply=function(e){var t=1/n.brightPassPostProcess.width,i=1/n.brightPassPostProcess.height;r[0]=-.5*t,r[1]=.5*i,r[2]=.5*t,r[3]=.5*i,r[4]=-.5*t,r[5]=-.5*i,r[6]=.5*t,r[7]=-.5*i,e.setArray2("dsOffsets",r),e.setFloat("brightThreshold",n.brightThreshold)},this.addEffect(new Za(e.getEngine(),"HDRBrightPass",function(){return n.brightPassPostProcess},!0))},t.prototype._createBlurPostProcesses=function(e,t,n,r){var i=this;void 0===r&&(r="blurWidth");var a=e.getEngine(),s=new zr("HDRBlurH_"+n,new o.w(1,0),this[r],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,m.a.TEXTURETYPE_UNSIGNED_INT),l=new zr("HDRBlurV_"+n,new o.w(0,1),this[r],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,m.a.TEXTURETYPE_UNSIGNED_INT);s.onActivateObservable.add(function(){var e=s.width/a.getRenderWidth();s.kernel=i[r]*e}),l.onActivateObservable.add(function(){var e=l.height/a.getRenderHeight();l.kernel=i.horizontalBlur?64*e:i[r]*e}),this.addEffect(new Za(e.getEngine(),"HDRBlurH"+n,function(){return s},!0)),this.addEffect(new Za(e.getEngine(),"HDRBlurV"+n,function(){return l},!0)),this.blurHPostProcesses.push(s),this.blurVPostProcesses.push(l)},t.prototype._createTextureAdderPostProcess=function(e,t){var n=this;this.textureAdderPostProcess=new jt("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define TEXTURE_ADDER",m.a.TEXTURETYPE_UNSIGNED_INT),this.textureAdderPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",n._vlsEnabled?n._currentDepthOfFieldSource:n.originalPostProcess),e.setTexture("lensSampler",n.lensTexture),e.setFloat("exposure",n._currentExposure),n._currentDepthOfFieldSource=n.textureAdderFinalPostProcess},this.addEffect(new Za(e.getEngine(),"HDRTextureAdder",function(){return n.textureAdderPostProcess},!0))},t.prototype._createVolumetricLightPostProcess=function(e,t){var n=this,r=e.enableGeometryBufferRenderer();r.enablePosition=!0;var i=r.getGBuffer();this.volumetricLightPostProcess=new jt("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],t/8,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var a=o.w.Zero();this.volumetricLightPostProcess.onApply=function(e){if(n.sourceLight&&n.sourceLight.getShadowGenerator()&&n._scene.activeCamera){var t=n.sourceLight.getShadowGenerator();e.setTexture("shadowMapSampler",t.getShadowMap()),e.setTexture("positionSampler",i.textures[2]),e.setColor3("sunColor",n.sourceLight.diffuse),e.setVector3("sunDirection",n.sourceLight.getShadowDirection()),e.setVector3("cameraPosition",n._scene.activeCamera.globalPosition),e.setMatrix("shadowViewProjection",t.getTransformMatrix()),e.setFloat("scatteringCoefficient",n.volumetricLightCoefficient),e.setFloat("scatteringPower",n.volumetricLightPower),a.x=n.sourceLight.getDepthMinZ(n._scene.activeCamera),a.y=n.sourceLight.getDepthMaxZ(n._scene.activeCamera),e.setVector2("depthValues",a)}},this.addEffect(new Za(e.getEngine(),"HDRVLS",function(){return n.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(e,t/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new jt("HDRVLSMerge","standard",[],["originalSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(e){e.setTextureFromPostProcess("originalSampler",n._bloomEnabled?n.textureAdderFinalPostProcess:n.originalPostProcess),n._currentDepthOfFieldSource=n.volumetricLightFinalPostProcess},this.addEffect(new Za(e.getEngine(),"HDRVLSMerge",function(){return n.volumetricLightMergePostProces},!0))},t.prototype._createLuminancePostProcesses=function(e,n){var r=this,i=Math.pow(3,t.LuminanceSteps);this.luminancePostProcess=new jt("HDRLuminance","standard",["lumOffsets"],[],{width:i,height:i},null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LUMINANCE",n);var a=[];this.luminancePostProcess.onApply=function(e){var t=1/r.luminancePostProcess.width,n=1/r.luminancePostProcess.height;a[0]=-.5*t,a[1]=.5*n,a[2]=.5*t,a[3]=.5*n,a[4]=-.5*t,a[5]=-.5*n,a[6]=.5*t,a[7]=-.5*n,e.setArray2("lumOffsets",a)},this.addEffect(new Za(e.getEngine(),"HDRLuminance",function(){return r.luminancePostProcess},!0));for(var s=t.LuminanceSteps-1;s>=0;s--){i=Math.pow(3,s);var l="#define LUMINANCE_DOWN_SAMPLE\n";0===s&&(l+="#define FINAL_DOWN_SAMPLER");var u=new jt("HDRLuminanceDownSample"+s,"standard",["dsOffsets","halfDestPixelSize"],[],{width:i,height:i},null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,l,n);this.luminanceDownSamplePostProcesses.push(u)}var c=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(t,n){var i=new Array(18);t.onApply=function(e){if(c){for(var o=0,a=-1;a<2;a++)for(var s=-1;s<2;s++)i[o]=a/c.width,i[o+1]=s/c.height,o+=2;e.setArray2("dsOffsets",i),e.setFloat("halfDestPixelSize",.5/c.width),c=n===r.luminanceDownSamplePostProcesses.length-1?r.luminancePostProcess:t}},n===r.luminanceDownSamplePostProcesses.length-1&&(t.onAfterRender=function(){var t=e.getEngine().readPixels(0,0,1,1),n=new o.y(1/16581375,1/65025,1/255,1);r._hdrCurrentLuminance=(t[0]*n.x+t[1]*n.y+t[2]*n.z+t[3]*n.w)/100}),r.addEffect(new Za(e.getEngine(),"HDRLuminanceDownSample"+n,function(){return t},!0))})},t.prototype._createHdrPostProcess=function(e,t){var n=this,r=["#define HDR"];this._hdrAutoExposure&&r.push("#define AUTO_EXPOSURE"),this.hdrPostProcess=new jt("HDR","standard",["averageLuminance"],["textureAdderSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,r.join("\n"),m.a.TEXTURETYPE_UNSIGNED_INT);var i=1,o=0,a=0;this.hdrPostProcess.onApply=function(t){if(t.setTextureFromPostProcess("textureAdderSampler",n._currentDepthOfFieldSource),o+=e.getEngine().getDeltaTime(),i<0)i=n._hdrCurrentLuminance;else{var r=(a-o)/1e3;n._hdrCurrentLuminance<i+n.hdrDecreaseRate*r?i+=n.hdrDecreaseRate*r:n._hdrCurrentLuminance>i-n.hdrIncreaseRate*r?i-=n.hdrIncreaseRate*r:i=n._hdrCurrentLuminance}n.hdrAutoExposure?n._currentExposure=n._fixedExposure/i:(i=I.a.Clamp(i,n.hdrMinimumLuminance,1e20),t.setFloat("averageLuminance",i)),a=o,n._currentDepthOfFieldSource=n.hdrFinalPostProcess},this.addEffect(new Za(e.getEngine(),"HDR",function(){return n.hdrPostProcess},!0))},t.prototype._createLensFlarePostProcess=function(e,t){var n=this;this.lensFlarePostProcess=new jt("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],t/2,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE",m.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(e.getEngine(),"HDRLensFlare",function(){return n.lensFlarePostProcess},!0)),this._createBlurPostProcesses(e,t/4,2),this.lensFlareComposePostProcess=new jt("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define LENS_FLARE_COMPOSE",m.a.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new Za(e.getEngine(),"HDRLensFlareCompose",function(){return n.lensFlareComposePostProcess},!0));var r=new o.w(0,0);this.lensFlarePostProcess.onApply=function(e){e.setTextureFromPostProcess("textureSampler",n._bloomEnabled?n.blurHPostProcesses[0]:n.originalPostProcess),e.setTexture("lensColorSampler",n.lensColorTexture),e.setFloat("strength",n.lensFlareStrength),e.setFloat("ghostDispersal",n.lensFlareGhostDispersal),e.setFloat("haloWidth",n.lensFlareHaloWidth),r.x=n.lensFlarePostProcess.width,r.y=n.lensFlarePostProcess.height,e.setVector2("resolution",r),e.setFloat("distortionStrength",n.lensFlareDistortionStrength)};var i=o.j.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),a=o.j.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(e){if(n._scene.activeCamera){e.setTextureFromPostProcess("otherSampler",n._currentDepthOfFieldSource),e.setTexture("lensDirtSampler",n.lensFlareDirtTexture),e.setTexture("lensStarSampler",n.lensStarTexture);var t=n._scene.activeCamera.getViewMatrix().getRow(0),r=n._scene.activeCamera.getViewMatrix().getRow(2),s=o.x.Dot(t.toVector3(),new o.x(1,0,0))+o.x.Dot(r.toVector3(),new o.x(0,0,1));s*=4;var l=o.j.FromValues(.5*Math.cos(s),-Math.sin(s),0,0,Math.sin(s),.5*Math.cos(s),0,0,0,0,1,0,0,0,0,1),u=a.multiply(l).multiply(i);e.setMatrix("lensStarMatrix",u),n._currentDepthOfFieldSource=n.lensFlareFinalPostProcess}}},t.prototype._createDepthOfFieldPostProcess=function(e,t){var n=this;this.depthOfFieldPostProcess=new jt("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define DEPTH_OF_FIELD",m.a.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",n._currentDepthOfFieldSource),e.setTexture("depthSampler",n._getDepthTexture()),e.setFloat("distance",n.depthOfFieldDistance)},this.addEffect(new Za(e.getEngine(),"HDRDepthOfField",function(){return n.depthOfFieldPostProcess},!0))},t.prototype._createMotionBlurPostProcess=function(e,t){var n=this;this.motionBlurPostProcess=new jt("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],t,null,Ge.a.BILINEAR_SAMPLINGMODE,e.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),m.a.TEXTURETYPE_UNSIGNED_INT);var r=0,i=o.j.Identity(),a=o.j.Identity(),s=o.j.Identity(),l=o.w.Zero();this.motionBlurPostProcess.onApply=function(t){(s=e.getProjectionMatrix().multiply(e.getViewMatrix())).invertToRef(a),t.setMatrix("inverseViewProjection",a),t.setMatrix("prevViewProjection",i),i=s,l.x=n.motionBlurPostProcess.width,l.y=n.motionBlurPostProcess.height,t.setVector2("screenSize",l),r=e.getEngine().getFps()/60,t.setFloat("motionScale",r),t.setFloat("motionStrength",n.motionStrength),t.setTexture("depthSampler",n._getDepthTexture())},this.addEffect(new Za(e.getEngine(),"HDRMotionBlur",function(){return n.motionBlurPostProcess},!0))},t.prototype._getDepthTexture=function(){return this._scene.getEngine().getCaps().drawBuffersExtension?this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]:this._scene.enableDepthRenderer().getDepthMap()},t.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var t=this._cameras[e];this.originalPostProcess&&this.originalPostProcess.dispose(t),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(t),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(t),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(t),this.textureAdderFinalPostProcess&&this.textureAdderFinalPostProcess.dispose(t),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(t),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(t),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(t),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(t),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(t),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(t),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(t);for(var n=0;n<this.luminanceDownSamplePostProcesses.length;n++)this.luminanceDownSamplePostProcesses[n].dispose(t);for(this.luminancePostProcess&&this.luminancePostProcess.dispose(t),this.hdrPostProcess&&this.hdrPostProcess.dispose(t),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(t),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(t),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(t),this.fxaaPostProcess&&this.fxaaPostProcess.dispose(t),n=0;n<this.blurHPostProcesses.length;n++)this.blurHPostProcesses[n].dispose(t);for(n=0;n<this.blurVPostProcesses.length;n++)this.blurVPostProcesses[n].dispose(t)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.fxaaPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},t.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),e.prototype.dispose.call(this)},t.prototype.serialize=function(){var e=D.a.Serialize(this);return this.sourceLight&&(e.sourceLightId=this.sourceLight.id),e.customType="StandardRenderingPipeline",e},t.Parse=function(e,n,r){var i=D.a.Parse(function(){return new t(e._name,n,e._ratio)},e,n,r);return e.sourceLightId&&(i.sourceLight=n.getLightByID(e.sourceLightId)),i},t.LuminanceSteps=6,u.c([Object(D.c)()],t.prototype,"brightThreshold",void 0),u.c([Object(D.c)()],t.prototype,"blurWidth",void 0),u.c([Object(D.c)()],t.prototype,"horizontalBlur",void 0),u.c([Object(D.c)()],t.prototype,"exposure",null),u.c([Object(D.m)("lensTexture")],t.prototype,"lensTexture",void 0),u.c([Object(D.c)()],t.prototype,"volumetricLightCoefficient",void 0),u.c([Object(D.c)()],t.prototype,"volumetricLightPower",void 0),u.c([Object(D.c)()],t.prototype,"volumetricLightBlurScale",void 0),u.c([Object(D.c)()],t.prototype,"hdrMinimumLuminance",void 0),u.c([Object(D.c)()],t.prototype,"hdrDecreaseRate",void 0),u.c([Object(D.c)()],t.prototype,"hdrIncreaseRate",void 0),u.c([Object(D.c)()],t.prototype,"hdrAutoExposure",null),u.c([Object(D.m)("lensColorTexture")],t.prototype,"lensColorTexture",void 0),u.c([Object(D.c)()],t.prototype,"lensFlareStrength",void 0),u.c([Object(D.c)()],t.prototype,"lensFlareGhostDispersal",void 0),u.c([Object(D.c)()],t.prototype,"lensFlareHaloWidth",void 0),u.c([Object(D.c)()],t.prototype,"lensFlareDistortionStrength",void 0),u.c([Object(D.m)("lensStarTexture")],t.prototype,"lensStarTexture",void 0),u.c([Object(D.m)("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),u.c([Object(D.c)()],t.prototype,"depthOfFieldDistance",void 0),u.c([Object(D.c)()],t.prototype,"depthOfFieldBlurWidth",void 0),u.c([Object(D.c)()],t.prototype,"motionStrength",void 0),u.c([Object(D.c)()],t.prototype,"_ratio",void 0),u.c([Object(D.c)()],t.prototype,"BloomEnabled",null),u.c([Object(D.c)()],t.prototype,"DepthOfFieldEnabled",null),u.c([Object(D.c)()],t.prototype,"LensFlareEnabled",null),u.c([Object(D.c)()],t.prototype,"HDREnabled",null),u.c([Object(D.c)()],t.prototype,"VLSEnabled",null),u.c([Object(D.c)()],t.prototype,"MotionBlurEnabled",null),u.c([Object(D.c)()],t.prototype,"fxaaEnabled",null),u.c([Object(D.c)()],t.prototype,"volumetricLightStepsCount",null),u.c([Object(D.c)()],t.prototype,"motionBlurSamples",null),u.c([Object(D.c)()],t.prototype,"samples",null),t}(bs);a.a.RegisteredTypes["BABYLON.StandardRenderingPipeline"]=Rs,zt.a.ShadersStore.tonemapPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb);\nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm);\ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(Ms||(Ms={}));var Cs=function(e){function t(t,n,r,i,o,a,s){void 0===o&&(o=m.a.TEXTURE_BILINEAR_SAMPLINGMODE),void 0===s&&(s=m.a.TEXTURETYPE_UNSIGNED_INT);var l=e.call(this,t,"tonemap",["_ExposureAdjustment"],null,1,i,o,a,!0,null,s)||this;l._operator=n,l.exposureAdjustment=r;var u="#define ";return l._operator===Ms.Hable?u+="HABLE_TONEMAPPING":l._operator===Ms.Reinhard?u+="REINHARD_TONEMAPPING":l._operator===Ms.HejiDawson?u+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":l._operator===Ms.Photographic&&(u+="PHOTOGRAPHIC_TONEMAPPING"),l.updateEffect(u),l.onApply=function(e){e.setFloat("_ExposureAdjustment",l.exposureAdjustment)},l}return u.d(t,e),t}(jt);zt.a.ShadersStore.depthVertexShader="\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",zt.a.ShadersStore.volumetricLightScatteringPixelShader="uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",zt.a.ShadersStore.volumetricLightScatteringPassPixelShader="#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n";var ws=function(e){function t(n,r,i,a,s,l,u,c,h){void 0===s&&(s=100),void 0===l&&(l=Ge.a.BILINEAR_SAMPLINGMODE);var d=e.call(this,n,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],r.postProcessRatio||r,i,l,u,c,"#define NUM_SAMPLES "+s)||this;return d._screenCoordinates=o.w.Zero(),d.customMeshPosition=o.x.Zero(),d.useCustomMeshPosition=!1,d.invert=!0,d.excludedMeshes=new Array,d.exposure=.3,d.decay=.96815,d.weight=.58767,d.density=.926,u=(h=null===i?h:i.getScene()).getEngine(),d._viewPort=new o.z(0,0,1,1).toGlobal(u.getRenderWidth(),u.getRenderHeight()),d.mesh=null!==a?a:t.CreateDefaultMesh("VolumetricLightScatteringMesh",h),d._createPass(h,r.passRatio||r),d.onActivate=function(e){d.isSupported||d.dispose(e),d.onActivate=null},d.onApplyObservable.add(function(e){d._updateMeshScreenCoordinates(h),e.setTexture("lightScatteringSampler",d._volumetricLightScatteringRTT),e.setFloat("exposure",d.exposure),e.setFloat("decay",d.decay),e.setFloat("weight",d.weight),e.setFloat("density",d.density),e.setVector2("meshPositionOnScreen",d._screenCoordinates)}),d}return u.d(t,e),Object.defineProperty(t.prototype,"useDiffuseColor",{get:function(){return p.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(e){p.a.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},t.prototype._isReady=function(e,t){var n=e.getMesh();if(n===this.mesh&&n.material)return n.material.isReady(n);var r=[],i=[Sn.b.PositionKind],o=e.getMaterial();o&&(o.needAlphaTesting()&&r.push("#define ALPHATEST"),n.isVerticesDataPresent(Sn.b.UVKind)&&(i.push(Sn.b.UVKind),r.push("#define UV1")),n.isVerticesDataPresent(Sn.b.UV2Kind)&&(i.push(Sn.b.UV2Kind),r.push("#define UV2"))),n.useBones&&n.computeBonesUsingShaders?(i.push(Sn.b.MatricesIndicesKind),i.push(Sn.b.MatricesWeightsKind),r.push("#define NUM_BONE_INFLUENCERS "+n.numBoneInfluencers),r.push("#define BonesPerMesh "+(n.skeleton?n.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0"),t&&(r.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3"));var a=r.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._volumetricLightScatteringPass=n.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},i,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],a)),this._volumetricLightScatteringPass.isReady()},t.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},t.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},t.prototype.dispose=function(t){var n=t.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==n&&t.getScene().customRenderTargets.splice(n,1),this._volumetricLightScatteringRTT.dispose(),e.prototype.dispose.call(this,t)},t.prototype.getPass=function(){return this._volumetricLightScatteringRTT},t.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)},t.prototype._createPass=function(e,t){var n=this,r=e.getEngine();this._volumetricLightScatteringRTT=new un("volumetricLightScatteringMap",{width:r.getRenderWidth()*t,height:r.getRenderHeight()*t},e,!1,!0,m.a.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,this._volumetricLightScatteringRTT.ignoreCameraViewport=!0;var i=this.getCamera();i?i.customRenderTargets.push(this._volumetricLightScatteringRTT):e.customRenderTargets.push(this._volumetricLightScatteringRTT);var a,s=function(e){var t=e.getRenderingMesh();if(!n._meshExcluded(t)){var r=e.getMaterial();if(r){var i=t.getScene(),o=i.getEngine();o.setState(r.backFaceCulling);var a=t._getInstancesRenderList(e._id);if(!a.mustReturn){var s=o.getCaps().instancedArrays&&null!==a.visibleInstances[e._id];if(n._isReady(e,s)){var l=n._volumetricLightScatteringPass;if(t===n.mesh&&(l=e.effect?e.effect:r.getEffect()),o.enableEffect(l),t._bind(e,l,Mi.a.TriangleFillMode),t===n.mesh)r.bind(t.getWorldMatrix(),t);else{if(n._volumetricLightScatteringPass.setMatrix("viewProjection",i.getTransformMatrix()),r&&r.needAlphaTesting()){var u=r.getAlphaTestTexture();n._volumetricLightScatteringPass.setTexture("diffuseSampler",u),u&&n._volumetricLightScatteringPass.setMatrix("diffuseMatrix",u.getTextureMatrix())}t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&n._volumetricLightScatteringPass.setMatrices("mBones",t.skeleton.getTransformMatrices(t))}t._processRendering(e,n._volumetricLightScatteringPass,Mi.a.TriangleFillMode,a,s,function(e,t){return l.setMatrix("world",t)})}}}}},l=new o.f(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){a=e.clearColor,e.clearColor=l}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){e.clearColor=a}),this._volumetricLightScatteringRTT.customRenderFunction=function(t,n,r,i){var o,a=e.getEngine();if(i.length){for(a.setColorWrite(!1),o=0;o<i.length;o++)s(i.data[o]);a.setColorWrite(!0)}for(o=0;o<t.length;o++)s(t.data[o]);for(o=0;o<n.length;o++)s(n.data[o]);if(r.length){for(o=0;o<r.length;o++){var l=r.data[o],u=l.getBoundingInfo();u&&e.activeCamera&&(l._alphaIndex=l.getMesh().alphaIndex,l._distanceToCamera=u.boundingSphere.centerWorld.subtract(e.activeCamera.position).length())}var c=r.data.slice(0,r.length);for(c.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(m.a.ALPHA_COMBINE),o=0;o<c.length;o++)s(c[o]);a.setAlphaMode(m.a.ALPHA_DISABLE)}}},t.prototype._updateMeshScreenCoordinates=function(e){var t,n=e.getTransformMatrix();t=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var r=o.x.Project(t,o.j.Identity(),n,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},t.CreateDefaultMesh=function(e,t){var n=fe.a.CreatePlane(e,1,t);n.billboardMode=Fe.a.BILLBOARDMODE_ALL;var r=new yn.a(e+"Material",t);return r.emissiveColor=new o.e(1,1,1),n.material=r,n},u.c([Object(D.o)()],t.prototype,"customMeshPosition",void 0),u.c([Object(D.c)()],t.prototype,"useCustomMeshPosition",void 0),u.c([Object(D.c)()],t.prototype,"invert",void 0),u.c([Object(D.k)()],t.prototype,"mesh",void 0),u.c([Object(D.c)()],t.prototype,"excludedMeshes",void 0),u.c([Object(D.c)()],t.prototype,"exposure",void 0),u.c([Object(D.c)()],t.prototype,"decay",void 0),u.c([Object(D.c)()],t.prototype,"weight",void 0),u.c([Object(D.c)()],t.prototype,"density",void 0),t}(jt);n(126),n(127),Object.defineProperty(W.a.prototype,"forceShowBoundingBoxes",{get:function(){return this._forceShowBoundingBoxes||!1},set:function(e){this._forceShowBoundingBoxes=e,e&&this.getBoundingBoxRenderer()},enumerable:!0,configurable:!0}),W.a.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new Os(this)),this._boundingBoxRenderer},Object.defineProperty(Fe.a.prototype,"showBoundingBox",{get:function(){return this._showBoundingBox||!1},set:function(e){this._showBoundingBox=e,e&&this.getScene().getBoundingBoxRenderer()},enumerable:!0,configurable:!0});var Os=function(){function e(e){this.name=Te.a.NAME_BOUNDINGBOXRENDERER,this.frontColor=new o.e(1,1,1),this.backColor=new o.e(.1,.1,.1),this.showBackLines=!0,this.renderList=new Gt.a(32),this._vertexBuffers={},this.scene=e,e._addComponent(this)}return e.prototype.register=function(){this.scene._beforeEvaluateActiveMeshStage.registerStep(Te.a.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset),this.scene._activeMeshStage.registerStep(Te.a.STEP_ACTIVEMESH_BOUNDINGBOXRENDERER,this,this._activeMesh),this.scene._evaluateSubMeshStage.registerStep(Te.a.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh),this.scene._afterRenderingGroupDrawStage.registerStep(Te.a.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render)},e.prototype._evaluateSubMesh=function(e,t){if(e.showSubMeshesBoundingBox){var n=t.getBoundingInfo();null!=n&&(n.boundingBox._tag=e.renderingGroupId,this.renderList.push(n.boundingBox))}},e.prototype._activeMesh=function(e,t){if(e.showBoundingBox||this.scene.forceShowBoundingBoxes){var n=e.getBoundingInfo();n.boundingBox._tag=t.renderingGroupId,this.renderList.push(n.boundingBox)}},e.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new go.a("colorShader",this.scene,"color",{attributes:[Sn.b.PositionKind],uniforms:["world","viewProjection","color"]});var e=this.scene.getEngine(),t=Tn.a.CreateBox({size:1});this._vertexBuffers[Sn.b.PositionKind]=new Sn.b(e,t.positions,Sn.b.PositionKind,!1),this._createIndexBuffer()}},e.prototype._createIndexBuffer=function(){var e=this.scene.getEngine();this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},e.prototype.rebuild=function(){var e=this._vertexBuffers[Sn.b.PositionKind];e&&e._rebuild(),this._createIndexBuffer()},e.prototype.reset=function(){this.renderList.reset()},e.prototype.render=function(e){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var t=this.scene.getEngine();t.setDepthWrite(!1),this._colorShader._preBind();for(var n=0;n<this.renderList.length;n++){var r=this.renderList.data[n];if(r._tag===e){var i=r.minimum,a=r.maximum.subtract(i),s=i.add(a.scale(.5)),l=o.j.Scaling(a.x,a.y,a.z).multiply(o.j.Translation(s.x,s.y,s.z)).multiply(r.getWorldMatrix());t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(t.setDepthFunctionToGreaterOrEqual(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(l),t.drawElementsType(Mi.a.LineListDrawMode,0,24)),t.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(l),t.drawElementsType(Mi.a.LineListDrawMode,0,24)}}this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0)}},e.prototype.renderOcclusionBoundingBox=function(e){if(this._prepareRessources(),this._colorShader.isReady()&&e._boundingInfo){var t=this.scene.getEngine();t.setDepthWrite(!1),t.setColorWrite(!1),this._colorShader._preBind();var n=e._boundingInfo.boundingBox,r=n.minimum,i=n.maximum.subtract(r),a=r.add(i.scale(.5)),s=o.j.Scaling(i.x,i.y,i.z).multiply(o.j.Translation(a.x,a.y,a.z)).multiply(n.getWorldMatrix());t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),t.setDepthFunctionToLess(),this.scene.resetCachedMaterial(),this._colorShader.bind(s),t.drawElementsType(Mi.a.LineListDrawMode,0,24),this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0),t.setColorWrite(!0)}},e.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var e=this._vertexBuffers[Sn.b.PositionKind];e&&(e.dispose(),this._vertexBuffers[Sn.b.PositionKind]=null),this.scene.getEngine()._releaseBuffer(this._indexBuffer)}},e}();zt.a.ShadersStore.depthPixelShader="#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);\n}";var Is=function(){function e(t,n,r){var i=this;void 0===n&&(n=m.a.TEXTURETYPE_FLOAT),void 0===r&&(r=null),this.useOnlyInActiveCamera=!1,this._scene=t,e._SceneComponentInitialization(this._scene),this._camera=r;var a=t.getEngine();this._depthMap=new un("depthMap",{width:a.getRenderWidth(),height:a.getRenderHeight()},this._scene,!1,!0,n),this._depthMap.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._depthMap.wrapV=Ge.a.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add(function(e){e.clear(new o.f(1,1,1,1),!0,!0,!0)});var s=function(e){var t=e.getRenderingMesh(),n=i._scene,r=n.getEngine(),o=e.getMaterial();if(o){r.setState(o.backFaceCulling,0,!1,n.useRightHandedSystem);var a=t._getInstancesRenderList(e._id);if(!a.mustReturn){var s=r.getCaps().instancedArrays&&null!==a.visibleInstances[e._id],l=i._camera||n.activeCamera;if(i.isReady(e,s)&&l){if(r.enableEffect(i._effect),t._bind(e,i._effect,Mi.a.TriangleFillMode),i._effect.setMatrix("viewProjection",n.getTransformMatrix()),i._effect.setFloat2("depthValues",l.minZ,l.minZ+l.maxZ),o&&o.needAlphaTesting()){var u=o.getAlphaTestTexture();u&&(i._effect.setTexture("diffuseSampler",u),i._effect.setMatrix("diffuseMatrix",u.getTextureMatrix()))}t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&i._effect.setMatrices("mBones",t.skeleton.getTransformMatrices(t)),t._processRendering(e,i._effect,Mi.a.TriangleFillMode,a,s,function(e,t){return i._effect.setMatrix("world",t)})}}}};this._depthMap.customRenderFunction=function(e,t,n,r){var i;if(r.length){for(a.setColorWrite(!1),i=0;i<r.length;i++)s(r.data[i]);a.setColorWrite(!0)}for(i=0;i<e.length;i++)s(e.data[i]);for(i=0;i<t.length;i++)s(t.data[i])}}return e.prototype.isReady=function(e,t){var n=e.getMaterial();if(n.disableDepthWrite)return!1;var r=[],i=[Sn.b.PositionKind],o=e.getMesh();n&&n.needAlphaTesting()&&n.getAlphaTestTexture()&&(r.push("#define ALPHATEST"),o.isVerticesDataPresent(Sn.b.UVKind)&&(i.push(Sn.b.UVKind),r.push("#define UV1")),o.isVerticesDataPresent(Sn.b.UV2Kind)&&(i.push(Sn.b.UV2Kind),r.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders?(i.push(Sn.b.MatricesIndicesKind),i.push(Sn.b.MatricesWeightsKind),o.numBoneInfluencers>4&&(i.push(Sn.b.MatricesIndicesExtraKind),i.push(Sn.b.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),r.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0"),t&&(r.push("#define INSTANCES"),i.push("world0"),i.push("world1"),i.push("world2"),i.push("world3"));var a=r.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("depth",i,["world","mBones","viewProjection","diffuseMatrix","depthValues"],["diffuseSampler"],a)),this._effect.isReady()},e.prototype.getDepthMap=function(){return this._depthMap},e.prototype.dispose=function(){this._depthMap.dispose()},e._SceneComponentInitialization=function(e){throw be.a.WarnImport("DepthRendererSceneComponent")},e}();W.a.prototype.enableDepthRenderer=function(e){if(!(e=e||this.activeCamera))throw"No camera available to enable depth renderer";if(this._depthRenderer||(this._depthRenderer={}),!this._depthRenderer[e.id]){var t=0;if(this.getEngine().getCaps().textureHalfFloatRender)t=m.a.TEXTURETYPE_HALF_FLOAT;else{if(!this.getEngine().getCaps().textureFloatRender)throw"Depth renderer does not support int texture type";t=m.a.TEXTURETYPE_FLOAT}this._depthRenderer[e.id]=new Is(this,t,e)}return this._depthRenderer[e.id]},W.a.prototype.disableDepthRenderer=function(e){(e=e||this.activeCamera)&&this._depthRenderer&&this._depthRenderer[e.id]&&(this._depthRenderer[e.id].dispose(),delete this._depthRenderer[e.id])};var Ds=function(){function e(e){this.name=Te.a.NAME_DEPTHRENDERER,this.scene=e}return e.prototype.register=function(){this.scene._gatherRenderTargetsStage.registerStep(Te.a.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,this,this._gatherRenderTargets),this.scene._gatherActiveCameraRenderTargetsStage.registerStep(Te.a.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,this,this._gatherActiveCameraRenderTargets)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){for(var e in this.scene._depthRenderer)this.scene._depthRenderer[e].dispose()},e.prototype._gatherRenderTargets=function(e){if(this.scene._depthRenderer)for(var t in this.scene._depthRenderer){var n=this.scene._depthRenderer[t];n.useOnlyInActiveCamera||e.push(n.getDepthMap())}},e.prototype._gatherActiveCameraRenderTargets=function(e){if(this.scene._depthRenderer)for(var t in this.scene._depthRenderer){var n=this.scene._depthRenderer[t];n.useOnlyInActiveCamera&&this.scene.activeCamera.id===t&&e.push(n.getDepthMap())}},e}();Is._SceneComponentInitialization=function(e){var t=e._getComponent(Te.a.NAME_DEPTHRENDERER);t||(t=new Ds(e),e._addComponent(t))},zt.a.ShadersStore.linePixelShader="uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",zt.a.ShadersStore.lineVertexShader="\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",Fe.a.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},Fe.a.prototype.enableEdgesRendering=function(e,t){return void 0===e&&(e=.95),void 0===t&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new Fs(this,e,t),this},Object.defineProperty(Fe.a.prototype,"edgesRenderer",{get:function(){return this._edgesRenderer},enumerable:!0,configurable:!0}),Xo.b.prototype.enableEdgesRendering=function(e,t){return void 0===e&&(e=.95),void 0===t&&(t=!1),this.disableEdgesRendering(),this._edgesRenderer=new Ns(this,e,t),this},Xo.a.prototype.enableEdgesRendering=function(e,t){return void 0===e&&(e=.95),void 0===t&&(t=!1),Xo.b.prototype.enableEdgesRendering.apply(this,arguments),this};var Ls=function(){this.edges=new Array,this.edgesConnectedCount=0},Fs=function(){function e(e,t,n,r){var i=this;void 0===t&&(t=.95),void 0===n&&(n=!1),void 0===r&&(r=!0),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this.isEnabled=!0,this._source=e,this._checkVerticesInsteadOfIndices=n,this._epsilon=t,this._prepareRessources(),r&&this._generateEdgesLines(),this._meshRebuildObserver=this._source.onRebuildObservable.add(function(){i._rebuild()}),this._meshDisposeObserver=this._source.onDisposeObservable.add(function(){i.dispose()})}return e.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new go.a("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},e.prototype._rebuild=function(){var e=this._buffers[Sn.b.PositionKind];e&&e._rebuild(),(e=this._buffers[Sn.b.NormalKind])&&e._rebuild();var t=this._source.getScene().getEngine();this._ib=t.createIndexBuffer(this._linesIndices)},e.prototype.dispose=function(){this._source.onRebuildObservable.remove(this._meshRebuildObserver),this._source.onDisposeObservable.remove(this._meshDisposeObserver);var e=this._buffers[Sn.b.PositionKind];e&&(e.dispose(),this._buffers[Sn.b.PositionKind]=null),(e=this._buffers[Sn.b.NormalKind])&&(e.dispose(),this._buffers[Sn.b.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},e.prototype._processEdgeForAdjacencies=function(e,t,n,r,i){return e===n&&t===r||e===r&&t===n?0:e===r&&t===i||e===i&&t===r?1:e===i&&t===n||e===n&&t===i?2:-1},e.prototype._processEdgeForAdjacenciesWithVertices=function(e,t,n,r,i){return e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(r)||e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(n)?0:e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(i)||e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(r)?1:e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(n)||e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(i)?2:-1},e.prototype._checkEdge=function(e,t,n,r,i){(void 0===t||o.x.Dot(n[e],n[t])<this._epsilon)&&this.createLine(r,i,this._linesPositions.length/3)},e.prototype.createLine=function(e,t,n){this._linesPositions.push(e.x,e.y,e.z,e.x,e.y,e.z,t.x,t.y,t.z,t.x,t.y,t.z),this._linesNormals.push(t.x,t.y,t.z,-1,t.x,t.y,t.z,1,e.x,e.y,e.z,-1,e.x,e.y,e.z,1),this._linesIndices.push(n,n+1,n+2,n,n+2,n+3)},e.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(Sn.b.PositionKind),t=this._source.getIndices();if(t&&e){var n,r,i=new Array,a=new Array;for(n=0;n<t.length;n+=3){r=new Ls;var s=t[n],l=t[n+1],u=t[n+2];r.p0=new o.x(e[3*s],e[3*s+1],e[3*s+2]),r.p1=new o.x(e[3*l],e[3*l+1],e[3*l+2]),r.p2=new o.x(e[3*u],e[3*u+1],e[3*u+2]);var c=o.x.Cross(r.p1.subtract(r.p0),r.p2.subtract(r.p1));c.normalize(),a.push(c),i.push(r)}for(n=0;n<i.length;n++){r=i[n];for(var h=n+1;h<i.length;h++){var d=i[h];if(3===r.edgesConnectedCount)break;if(3!==d.edgesConnectedCount)for(var f=t[3*h],p=t[3*h+1],m=t[3*h+2],g=0;g<3;g++){var _=0;if(void 0===r.edges[g]){switch(g){case 0:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p0,r.p1,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(t[3*n],t[3*n+1],f,p,m);break;case 1:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p1,r.p2,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(t[3*n+1],t[3*n+2],f,p,m);break;case 2:_=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(r.p2,r.p0,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(t[3*n+2],t[3*n],f,p,m)}if(-1!==_&&(r.edges[g]=h,d.edges[_]=n,r.edgesConnectedCount++,d.edgesConnectedCount++,3===r.edgesConnectedCount))break}}}}for(n=0;n<i.length;n++){var v=i[n];this._checkEdge(n,v.edges[0],a,v.p0,v.p1),this._checkEdge(n,v.edges[1],a,v.p1,v.p2),this._checkEdge(n,v.edges[2],a,v.p2,v.p0)}var y=this._source.getScene().getEngine();this._buffers[Sn.b.PositionKind]=new Sn.b(y,this._linesPositions,Sn.b.PositionKind,!1),this._buffers[Sn.b.NormalKind]=new Sn.b(y,this._linesNormals,Sn.b.NormalKind,!1,!1,4),this._ib=y.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},e.prototype.isReady=function(){return this._lineShader.isReady()},e.prototype.render=function(){var e=this._source.getScene();if(this.isReady()&&e.activeCamera){var t=e.getEngine();this._lineShader._preBind(),1!==this._source.edgesColor.a?t.setAlphaMode(m.a.ALPHA_COMBINE):t.setAlphaMode(m.a.ALPHA_DISABLE),t.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),e.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),e.activeCamera.mode===Ne.a.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",t.getAspectRatio(e.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),t.drawElementsType(Mi.a.TriangleFillMode,0,this._indicesCount),this._lineShader.unbind()}},e}(),Ns=function(e){function t(t,n,r){void 0===n&&(n=.95),void 0===r&&(r=!1);var i=e.call(this,t,n,r,!1)||this;return i._generateEdgesLines(),i}return u.d(t,e),t.prototype._generateEdgesLines=function(){var e=this._source.getVerticesData(Sn.b.PositionKind),t=this._source.getIndices();if(t&&e){for(var n=o.t.Vector3[0],r=o.t.Vector3[1],i=t.length-1,a=0,s=0;a<i;a+=2,s+=4)o.x.FromArrayToRef(e,3*t[a],n),o.x.FromArrayToRef(e,3*t[a+1],r),this.createLine(n,r,s);var l=this._source.getScene().getEngine();this._buffers[Sn.b.PositionKind]=new Sn.b(l,this._linesPositions,Sn.b.PositionKind,!1),this._buffers[Sn.b.NormalKind]=new Sn.b(l,this._linesNormals,Sn.b.NormalKind,!1,!1,4),this._ib=l.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},t}(Fs);zt.a.ShadersStore.outlinePixelShader="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}",zt.a.ShadersStore.outlineVertexShader="\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n",W.a.prototype.getOutlineRenderer=function(){return this._outlineRenderer||(this._outlineRenderer=new Bs(this)),this._outlineRenderer},Object.defineProperty(Fe.a.prototype,"renderOutline",{get:function(){return this._renderOutline},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOutline=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fe.a.prototype,"renderOverlay",{get:function(){return this._renderOverlay},set:function(e){e&&this.getScene().getOutlineRenderer(),this._renderOverlay=e},enumerable:!0,configurable:!0});var Bs=function(){function e(e){this.name=Te.a.NAME_OUTLINERENDERER,this.zOffset=1,this.scene=e,this._engine=e.getEngine(),this.scene._addComponent(this)}return e.prototype.register=function(){this.scene._beforeRenderingMeshStage.registerStep(Te.a.STEP_BEFORERENDERINGMESH_OUTLINE,this,this._beforeRenderingMesh),this.scene._afterRenderingMeshStage.registerStep(Te.a.STEP_AFTERRENDERINGMESH_OUTLINE,this,this._afterRenderingMesh)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){},e.prototype.render=function(e,t,n){var r=this;void 0===n&&(n=!1);var i=this.scene,o=i.getEngine(),a=o.getCaps().instancedArrays&&null!==t.visibleInstances[e._id]&&void 0!==t.visibleInstances[e._id];if(this.isReady(e,a)){var s=e.getRenderingMesh(),l=e.getMaterial();if(l&&i.activeCamera){if(o.enableEffect(this._effect),l.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(i.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",n?0:s.outlineWidth),this._effect.setColor4("color",n?s.overlayColor:s.outlineColor,n?s.overlayAlpha:l.alpha),this._effect.setMatrix("viewProjection",i.getTransformMatrix()),s.useBones&&s.computeBonesUsingShaders&&s.skeleton&&this._effect.setMatrices("mBones",s.skeleton.getTransformMatrices(s)),s._bind(e,this._effect,Mi.a.TriangleFillMode),l&&l.needAlphaTesting()){var u=l.getAlphaTestTexture();u&&(this._effect.setTexture("diffuseSampler",u),this._effect.setMatrix("diffuseMatrix",u.getTextureMatrix()))}o.setZOffset(-this.zOffset),s._processRendering(e,this._effect,Mi.a.TriangleFillMode,t,a,function(e,t){r._effect.setMatrix("world",t)}),o.setZOffset(0)}}},e.prototype.isReady=function(e,t){var n=[],r=[Sn.b.PositionKind,Sn.b.NormalKind],i=e.getMesh(),o=e.getMaterial();o&&(o.needAlphaTesting()&&(n.push("#define ALPHATEST"),i.isVerticesDataPresent(Sn.b.UVKind)&&(r.push(Sn.b.UVKind),n.push("#define UV1")),i.isVerticesDataPresent(Sn.b.UV2Kind)&&(r.push(Sn.b.UV2Kind),n.push("#define UV2"))),o.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH")),i.useBones&&i.computeBonesUsingShaders?(r.push(Sn.b.MatricesIndicesKind),r.push(Sn.b.MatricesWeightsKind),i.numBoneInfluencers>4&&(r.push(Sn.b.MatricesIndicesExtraKind),r.push(Sn.b.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+i.numBoneInfluencers),n.push("#define BonesPerMesh "+(i.skeleton?i.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),t&&(n.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this.scene.getEngine().createEffect("outline",r,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant"],["diffuseSampler"],a)),this._effect.isReady()},e.prototype._beforeRenderingMesh=function(t,n,r){if(this._savedDepthWrite=this._engine.getDepthWrite(),t.renderOutline){var i=n.getMaterial();i&&i.needAlphaBlending&&(this._engine.cacheStencilState(),this._engine.setDepthWrite(!1),this._engine.setColorWrite(!1),this._engine.setStencilBuffer(!0),this._engine.setStencilOperationPass(m.a.REPLACE),this._engine.setStencilFunction(m.a.ALWAYS),this._engine.setStencilMask(e._StencilReference),this._engine.setStencilFunctionReference(e._StencilReference),this.render(n,r,!0),this._engine.setColorWrite(!0),this._engine.setStencilFunction(m.a.NOTEQUAL)),this._engine.setDepthWrite(!1),this.render(n,r),this._engine.setDepthWrite(this._savedDepthWrite),i&&i.needAlphaBlending&&this._engine.restoreStencilState()}},e.prototype._afterRenderingMesh=function(e,t,n){if(e.renderOverlay){var r=this._engine.getAlphaMode();this._engine.setAlphaMode(m.a.ALPHA_COMBINE),this.render(t,n,!0),this._engine.setAlphaMode(r)}e.renderOutline&&this._savedDepthWrite&&(this._engine.setDepthWrite(!0),this._engine.setColorWrite(!1),this.render(t,n),this._engine.setColorWrite(!0))},e._StencilReference=4,e}(),Us=n(109),ks=function(){function e(e,t){this.name=e,this.color=new o.f(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this.isVisible=!0,this._manager=t,this._manager.sprites.push(this),this.position=o.x.Zero()}return Object.defineProperty(e.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(e,t,n,r,i){this._fromIndex=e,this._toIndex=t,this._loopAnimation=n,this._delay=r,this._animationStarted=!0,e<t?this._direction=1:(this._direction=-1,this._toIndex=e,this._fromIndex=t),this.cellIndex=e,this._time=0,this._onAnimationEnd=i},e.prototype.stopAnimation=function(){this._animationStarted=!1},e.prototype._animate=function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},e.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1)},e}();W.a.prototype._internalPickSprites=function(e,t,n,r){if(!Kn.a)return null;var i=null;if(!r){if(!this.activeCamera)return null;r=this.activeCamera}if(this.spriteManagers.length>0)for(var o=0;o<this.spriteManagers.length;o++){var a=this.spriteManagers[o];if(a.isPickable){var s=a.intersects(e,r,t,n);if(s&&s.hit&&(n||null==i||!(s.distance>=i.distance))&&(i=s,n))break}}return i||new Kn.a},W.a.prototype.pickSprite=function(e,t,n,r,i){return this.createPickingRayInCameraSpaceToRef(e,t,this._tempSpritePickingRay,i),this._internalPickSprites(this._tempSpritePickingRay,n,r,i)},W.a.prototype.pickSpriteWithRay=function(e,t,n,r){if(!this._tempSpritePickingRay)return null;if(!r){if(!this.activeCamera)return null;r=this.activeCamera}return Ot.a.TransformToRef(e,r.getViewMatrix(),this._tempSpritePickingRay),this._internalPickSprites(this._tempSpritePickingRay,t,n,r)},W.a.prototype.setPointerOverSprite=function(e){this._pointerOverSprite!==e&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(m.a.ACTION_OnPointerOutTrigger,l.a.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=e,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(m.a.ACTION_OnPointerOverTrigger,l.a.CreateNewFromSprite(this._pointerOverSprite,this)))},W.a.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};var Vs=function(){function e(e){this.name=Te.a.NAME_SPRITE,this.scene=e,this.scene.spriteManagers=new Array,this.scene._tempSpritePickingRay=Ot.a?Ot.a.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new i.c,this.scene.onAfterSpritesRenderingObservable=new i.c,this._spritePredicate=function(e){return!!e.actionManager&&e.isPickable&&e.actionManager.hasPointerTriggers}}return e.prototype.register=function(){this.scene._pointerMoveStage.registerStep(Te.a.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(Te.a.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(Te.a.STEP_POINTERUP_SPRITE,this,this._pointerUp)},e.prototype.rebuild=function(){},e.prototype.dispose=function(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();for(var e=this.scene.spriteManagers;e.length;)e[0].dispose()},e.prototype._pickSpriteButKeepRay=function(e,t,n,r,i){var o=this.scene.pickSprite(t,n,this._spritePredicate,r,i);return o&&(o.ray=e?e.ray:null),o},e.prototype._pointerMove=function(e,t,n,r,i){var o=this.scene;return r?o.setPointerOverSprite(null):(n=this._pickSpriteButKeepRay(n,e,t,!1,o.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite?(o.setPointerOverSprite(n.pickedSprite),o._pointerOverSprite&&o._pointerOverSprite.actionManager&&o._pointerOverSprite.actionManager.hoverCursor?i.style.cursor=o._pointerOverSprite.actionManager.hoverCursor:i.style.cursor=o.hoverCursor):o.setPointerOverSprite(null),n},e.prototype._pointerDown=function(e,t,n,r){var i=this.scene;if(i._pickedDownSprite=null,i.spriteManagers.length>0&&(n=i.pickSprite(e,t,this._spritePredicate,!1,i.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite&&n.pickedSprite.actionManager){switch(i._pickedDownSprite=n.pickedSprite,r.button){case 0:n.pickedSprite.actionManager.processTrigger(m.a.ACTION_OnLeftPickTrigger,l.a.CreateNewFromSprite(n.pickedSprite,i,r));break;case 1:n.pickedSprite.actionManager.processTrigger(m.a.ACTION_OnCenterPickTrigger,l.a.CreateNewFromSprite(n.pickedSprite,i,r));break;case 2:n.pickedSprite.actionManager.processTrigger(m.a.ACTION_OnRightPickTrigger,l.a.CreateNewFromSprite(n.pickedSprite,i,r))}n.pickedSprite.actionManager&&n.pickedSprite.actionManager.processTrigger(m.a.ACTION_OnPickDownTrigger,l.a.CreateNewFromSprite(n.pickedSprite,i,r))}return n},e.prototype._pointerUp=function(e,t,n,r){var i=this.scene;if(i.spriteManagers.length>0){var o=i.pickSprite(e,t,this._spritePredicate,!1,i.cameraToUseForPointers||void 0);o&&(o.hit&&o.pickedSprite&&o.pickedSprite.actionManager&&(o.pickedSprite.actionManager.processTrigger(m.a.ACTION_OnPickUpTrigger,l.a.CreateNewFromSprite(o.pickedSprite,i,r)),o.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||o.pickedSprite.actionManager.processTrigger(m.a.ACTION_OnPickTrigger,l.a.CreateNewFromSprite(o.pickedSprite,i,r)))),i._pickedDownSprite&&i._pickedDownSprite.actionManager&&i._pickedDownSprite!==o.pickedSprite&&i._pickedDownSprite.actionManager.processTrigger(m.a.ACTION_OnPickOutTrigger,l.a.CreateNewFromSprite(i._pickedDownSprite,i,r)))}return n},e}();zt.a.ShadersStore.spritesPixelShader="uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest)\n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",zt.a.ShadersStore.spritesVertexShader="\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) {\nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;\nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0);\n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}";var Gs,zs=function(){function e(e,t,n,r,o,a,s){if(void 0===a&&(a=.01),void 0===s&&(s=Ge.a.TRILINEAR_SAMPLINGMODE),this.name=e,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new i.c,this._vertexBuffers={},o._getComponent(Te.a.NAME_SPRITE)||o._addComponent(new Vs(o)),this._capacity=n,this._spriteTexture=new Ge.a(t,o,!0,!1,s),this._spriteTexture.wrapU=Ge.a.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=Ge.a.CLAMP_ADDRESSMODE,r.width&&r.height)this.cellWidth=r.width,this.cellHeight=r.height;else{if(void 0===r)return;this.cellWidth=r,this.cellHeight=r}this._epsilon=a,this._scene=o,this._scene.spriteManagers.push(this);for(var l=[],u=0,c=0;c<n;c++)l.push(u),l.push(u+1),l.push(u+2),l.push(u),l.push(u+2),l.push(u+3),u+=4;this._indexBuffer=o.getEngine().createIndexBuffer(l),this._vertexData=new Float32Array(16*n*4),this._buffer=new Sn.a(o.getEngine(),this._vertexData,!0,16);var h=this._buffer.createVertexBuffer(Sn.b.PositionKind,0,4),d=this._buffer.createVertexBuffer("options",4,4),f=this._buffer.createVertexBuffer("cellInfo",8,4),p=this._buffer.createVertexBuffer(Sn.b.ColorKind,12,4);this._vertexBuffers[Sn.b.PositionKind]=h,this._vertexBuffers.options=d,this._vertexBuffers.cellInfo=f,this._vertexBuffers[Sn.b.ColorKind]=p,this._effectBase=this._scene.getEngine().createEffect("sprites",[Sn.b.PositionKind,"options","cellInfo",Sn.b.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[Sn.b.PositionKind,"options","cellInfo",Sn.b.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._spriteTexture},set:function(e){this._spriteTexture=e},enumerable:!0,configurable:!0}),e.prototype._appendSpriteVertex=function(e,t,n,r,i){var o=16*e;0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),this._vertexData[o]=t.position.x,this._vertexData[o+1]=t.position.y,this._vertexData[o+2]=t.position.z,this._vertexData[o+3]=t.angle,this._vertexData[o+4]=t.width,this._vertexData[o+5]=t.height,this._vertexData[o+6]=n,this._vertexData[o+7]=r,this._vertexData[o+8]=t.invertU?1:0,this._vertexData[o+9]=t.invertV?1:0;var a=t.cellIndex/i>>0;this._vertexData[o+10]=t.cellIndex-a*i,this._vertexData[o+11]=a,this._vertexData[o+12]=t.color.r,this._vertexData[o+13]=t.color.g,this._vertexData[o+14]=t.color.b,this._vertexData[o+15]=t.color.a},e.prototype.intersects=function(e,t,n,r){for(var i=Math.min(this._capacity,this.sprites.length),a=o.x.Zero(),s=o.x.Zero(),l=Number.MAX_VALUE,u=null,c=o.x.Zero(),h=o.x.Zero(),d=t.getViewMatrix(),f=0;f<i;f++){var p=this.sprites[f];if(p){if(n){if(!n(p))continue}else if(!p.isPickable)continue;if(o.x.TransformCoordinatesToRef(p.position,d,h),a.copyFromFloats(h.x-p.width/2,h.y-p.height/2,h.z),s.copyFromFloats(h.x+p.width/2,h.y+p.height/2,h.z),e.intersectsBoxMinMax(a,s)){var m=o.x.Distance(h,e.origin);if(l>m&&(l=m,u=p,r))break}}}if(u){var g=new Kn.a;d.invertToRef(o.t.Matrix[0]),g.hit=!0,g.pickedSprite=u,g.distance=l;var _=o.t.Vector3[0];return _.copyFrom(e.direction),_.normalize(),_.scaleInPlace(l),e.origin.addToRef(_,c),g.pickedPoint=o.x.TransformCoordinates(c,o.t.Matrix[0]),g}return null},e.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()&&this.sprites.length){for(var e=this._scene.getEngine(),t=this._spriteTexture.getBaseSize(),n=e.getDeltaTime(),r=Math.min(this._capacity,this.sprites.length),i=t.width/this.cellWidth,o=0,a=!0,s=0;s<r;s++){var l=this.sprites[s];l&&l.isVisible&&(a=!1,l._animate(n),this._appendSpriteVertex(o++,l,0,0,i),this._appendSpriteVertex(o++,l,1,0,i),this._appendSpriteVertex(o++,l,1,1,i),this._appendSpriteVertex(o++,l,0,1,i))}if(!a){this._buffer.update(this._vertexData);var u=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==W.a.FOGMODE_NONE&&this.fogEnabled&&(u=this._effectFog),e.enableEffect(u);var c=this._scene.getViewMatrix();u.setTexture("diffuseSampler",this._spriteTexture),u.setMatrix("view",c),u.setMatrix("projection",this._scene.getProjectionMatrix()),u.setFloat2("textureInfos",this.cellWidth/t.width,this.cellHeight/t.height),this._scene.fogEnabled&&this._scene.fogMode!==W.a.FOGMODE_NONE&&this.fogEnabled&&(u.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),u.setColor3("vFogColor",this._scene.fogColor)),e.bindBuffers(this._vertexBuffers,this._indexBuffer,u),e.setDepthFunctionToLessOrEqual(),u.setBool("alphaTest",!0),e.setColorWrite(!1),e.drawElementsType(Mi.a.TriangleFillMode,0,o/4*6),e.setColorWrite(!0),u.setBool("alphaTest",!1),e.setAlphaMode(m.a.ALPHA_COMBINE),e.drawElementsType(Mi.a.TriangleFillMode,0,o/4*6),e.setAlphaMode(m.a.ALPHA_DISABLE)}}},e.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e}(),js=n(94),Hs=n(104);!function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.DONE=2]="DONE",e[e.ERROR=3]="ERROR"}(Gs||(Gs={}));var Ws,Xs=function(){function e(e){this.name=e,this._isCompleted=!1,this._taskState=Gs.INIT}return Object.defineProperty(e.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),e.prototype._setErrorObject=function(e,t){this._errorObject||(this._errorObject={message:e,exception:t})},e.prototype.run=function(e,t,n){var r=this;this._taskState=Gs.RUNNING,this.runTask(e,function(){r.onDoneCallback(t,n)},function(e,t){r.onErrorCallback(n,e,t)})},e.prototype.runTask=function(e,t,n){throw new Error("runTask is not implemented")},e.prototype.reset=function(){this._taskState=Gs.INIT},e.prototype.onErrorCallback=function(e,t,n){this._taskState=Gs.ERROR,this._errorObject={message:t,exception:n},this.onError&&this.onError(this,t,n),e()},e.prototype.onDoneCallback=function(e,t){try{this._taskState=Gs.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),e()}catch(e){this.onErrorCallback(t,"Task is done, error executing success callback(s)",e)}},e}(),Ys=function(e,t,n){this.remainingCount=e,this.totalCount=t,this.task=n},Ks=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.name=t,o.meshesNames=n,o.rootUrl=r,o.sceneFilename=i,o}return u.d(t,e),t.prototype.runTask=function(e,t,n){var r=this;fr.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,e,function(e,n,i,o){r.loadedMeshes=e,r.loadedParticleSystems=n,r.loadedSkeletons=i,r.loadedAnimationGroups=o,t()},null,function(e,t,r){n(t,r)})},t}(Xs),qs=function(e){function t(t,n){var r=e.call(this,t)||this;return r.name=t,r.url=n,r}return u.d(t,e),t.prototype.runTask=function(e,t,n){var r=this;e._loadFile(this.url,function(e){r.text=e,t()},void 0,!1,!1,function(e,t){e&&n(e.status+" "+e.statusText,t)})},t}(Xs),Qs=function(e){function t(t,n){var r=e.call(this,t)||this;return r.name=t,r.url=n,r}return u.d(t,e),t.prototype.runTask=function(e,t,n){var r=this;e._loadFile(this.url,function(e){r.data=e,t()},void 0,!0,!0,function(e,t){e&&n(e.status+" "+e.statusText,t)})},t}(Xs),Zs=function(e){function t(t,n){var r=e.call(this,t)||this;return r.name=t,r.url=n,r}return u.d(t,e),t.prototype.runTask=function(e,t,n){var r=this,i=new Image;ye.h.SetCorsBehavior(this.url,i),i.onload=function(){r.image=i,t()},i.onerror=function(e){n("Error loading image",e)},i.src=this.url},t}(Xs),Js=function(e){function t(t,n,r,i,o){void 0===o&&(o=Ge.a.TRILINEAR_SAMPLINGMODE);var a=e.call(this,t)||this;return a.name=t,a.url=n,a.noMipmap=r,a.invertY=i,a.samplingMode=o,a}return u.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new Ge.a(this.url,e,this.noMipmap,this.invertY,this.samplingMode,function(){t()},function(e,t){n(e,t)})},t}(Xs),$s=function(e){function t(t,n,r,i,o){var a=e.call(this,t)||this;return a.name=t,a.url=n,a.extensions=r,a.noMipmap=i,a.files=o,a}return u.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new Hr(this.url,e,this.extensions,this.noMipmap,this.files,function(){t()},function(e,t){n(e,t)})},t}(Xs),el=function(e){function t(t,n,r,i,o,a,s){void 0===i&&(i=!1),void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===s&&(s=!1);var l=e.call(this,t)||this;return l.name=t,l.url=n,l.size=r,l.noMipmap=i,l.generateHarmonics=o,l.gammaSpace=a,l.reserved=s,l}return u.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new Xi(this.url,e,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){t()},function(e,t){n(e,t)})},t}(Xs),tl=function(e){function t(t,n,r,i,o){void 0===i&&(i=!1),void 0===o&&(o=!0);var a=e.call(this,t)||this;return a.name=t,a.url=n,a.size=r,a.noMipmap=i,a.gammaSpace=o,a}return u.d(t,e),t.prototype.runTask=function(e,t,n){this.texture=new vo(this.url,e,this.size,this.noMipmap,this.gammaSpace,function(){t()},function(e,t){n(e,t)})},t}(Xs),nl=function(){function e(e){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new i.c,this.onTaskErrorObservable=new i.c,this.onTasksDoneObservable=new i.c,this.onProgressObservable=new i.c,this.useDefaultLoadingScreen=!0,this._scene=e}return e.prototype.addMeshTask=function(e,t,n,r){var i=new Ks(e,t,n,r);return this._tasks.push(i),i},e.prototype.addTextFileTask=function(e,t){var n=new qs(e,t);return this._tasks.push(n),n},e.prototype.addBinaryFileTask=function(e,t){var n=new Qs(e,t);return this._tasks.push(n),n},e.prototype.addImageTask=function(e,t){var n=new Zs(e,t);return this._tasks.push(n),n},e.prototype.addTextureTask=function(e,t,n,r,i){void 0===i&&(i=Ge.a.TRILINEAR_SAMPLINGMODE);var o=new Js(e,t,n,r,i);return this._tasks.push(o),o},e.prototype.addCubeTextureTask=function(e,t,n,r,i){var o=new $s(e,t,n,r,i);return this._tasks.push(o),o},e.prototype.addHDRCubeTextureTask=function(e,t,n,r,i,o,a){void 0===r&&(r=!1),void 0===i&&(i=!0),void 0===o&&(o=!1),void 0===a&&(a=!1);var s=new el(e,t,n,r,i,o,a);return this._tasks.push(s),s},e.prototype.addEquiRectangularCubeTextureAssetTask=function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var o=new tl(e,t,n,r,i);return this._tasks.push(o),o},e.prototype.removeTask=function(e){var t=this._tasks.indexOf(e);t>-1&&this._tasks.splice(t,1)},e.prototype._decreaseWaitingTasksCount=function(e){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,e),this.onProgressObservable.notifyObservers(new Ys(this._waitingTasksCount,this._totalTasksCount,e))}catch(e){p.a.Error("Error running progress callbacks."),console.log(e)}if(0===this._waitingTasksCount){try{this.onFinish&&this.onFinish(this._tasks);for(var t=this._tasks.slice(),n=0,r=t;n<r.length;n++)if((e=r[n]).taskState===Gs.DONE){var i=this._tasks.indexOf(e);i>-1&&this._tasks.splice(i,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(e){p.a.Error("Error running tasks-done callbacks."),console.log(e)}this._isLoading=!1,this._scene.getEngine().hideLoadingUI()}},e.prototype._runTask=function(e){var t=this,n=function(n,r){e._setErrorObject(n,r),t.onTaskError&&t.onTaskError(e),t.onTaskErrorObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)};e.run(this._scene,function(){try{t.onTaskSuccess&&t.onTaskSuccess(e),t.onTaskSuccessObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)}catch(e){n("Error executing task success callbacks",e)}},n)},e.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},e.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];t.taskState===Gs.INIT&&this._runTask(t)}return this},e.prototype.loadAsync=function(){var e=this;return new Promise(function(t,n){e.onTasksDoneObservable.addOnce(function(e){e&&e.length?n(e):t()})})},e}(),rl=function(){function e(){var e=this;this.promise=new Promise(function(t,n){e._resolve=t,e._reject=n})}return Object.defineProperty(e.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),e}(),il=function(){function e(e,t){this._meshesOrigins=[],this._toCenterVectors=[],this._scaledDirection=o.x.Zero(),this._newPosition=o.x.Zero(),this._centerPosition=o.x.Zero(),this._meshes=e.slice(),t?this._centerMesh=t:this._setCenterMesh();var n=this._meshes.indexOf(this._centerMesh);n>=0&&this._meshes.splice(n,1),this._centerPosition=this._centerMesh.getAbsolutePosition().clone();for(var r=0;r<this._meshes.length;r++)if(this._meshes[r]){var i=this._meshes[r];this._meshesOrigins[r]=i.getAbsolutePosition().clone(),this._toCenterVectors[r]=o.x.Zero(),i._boundingInfo&&this._centerMesh._boundingInfo&&i._boundingInfo.boundingBox.centerWorld.subtractToRef(this._centerMesh._boundingInfo.boundingBox.centerWorld,this._toCenterVectors[r])}}return e.prototype._setCenterMesh=function(){for(var e=o.x.Zero(),t=o.x.Zero(),n=Number.MAX_VALUE,r=0;r<this._meshes.length;r++)this._meshes[r]&&(a=(i=this._meshes[r]).getBoundingInfo())&&t.addInPlace(a.boundingBox.centerWorld);for(e=t.scale(1/this._meshes.length),r=0;r<this._meshes.length;r++){var i,a;if(this._meshes[r]&&(a=(i=this._meshes[r]).getBoundingInfo())){var s=a.boundingBox.centerWorld.subtract(e).lengthSquared();s<n&&(this._centerMesh=i,n=s)}}},e.prototype.getClassName=function(){return"MeshExploder"},e.prototype.getMeshes=function(){var e=this._meshes.slice();return e.unshift(this._centerMesh),e},e.prototype.explode=function(e){void 0===e&&(e=1);for(var t=0;t<this._meshes.length;t++)this._meshes[t]&&this._meshesOrigins[t]&&this._toCenterVectors[t]&&(this._toCenterVectors[t].scaleToRef(e,this._scaledDirection),this._meshesOrigins[t].addToRef(this._scaledDirection,this._newPosition),this._meshes[t].setAbsolutePosition(this._newPosition));this._centerMesh.setAbsolutePosition(this._centerPosition)},e}(),ol=function(){function e(e,t,n,r,i,o,a,s,l){this.onProcessFileCallback=function(){return!0},this._engine=e,this._currentScene=t,this._sceneLoadedCallback=n,this._progressCallback=r,this._additionalRenderLoopLogicCallback=i,this._textureLoadingCallback=o,this._startingProcessingFilesCallback=a,this._onReloadCallback=s,this._errorCallback=l}return Object.defineProperty(e,"FilesToLoad",{get:function(){return cr.a.FilesToLoad},enumerable:!0,configurable:!0}),e.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._dragEnterHandler=function(e){t.drag(e)},this._dragOverHandler=function(e){t.drag(e)},this._dropHandler=function(e){t.drop(e)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},e.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},e.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},e.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},e.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},e.prototype._traverseFolder=function(e,t,n,r){var i=this,o=e.createReader(),a=e.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");o.readEntries(function(e){n.count+=e.length;for(var o=0,s=e;o<s.length;o++){var l=s[o];l.isFile?l.file(function(e){e.correctName=a+e.name,t.push(e),0==--n.count&&r()}):l.isDirectory&&i._traverseFolder(l,t,n,r)}--n.count&&r()})},e.prototype._processFiles=function(t){for(var n=0;n<t.length;n++){var r=t[n].correctName.toLowerCase(),i=r.split(".").pop();this.onProcessFileCallback(t[n],r,i)&&("babylon"!==i&&"stl"!==i&&"obj"!==i&&"gltf"!==i&&"glb"!==i||-1!==r.indexOf(".binary.babylon")||-1!==r.indexOf(".incremental.babylon")||(this._sceneFileToLoad=t[n]),e.FilesToLoad[r]=t[n])}},e.prototype.loadFiles=function(e){var t=this;if(e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var n=new Array,r=[],i=e.dataTransfer?e.dataTransfer.items:null,o=0;o<this._filesToLoad.length;o++){var a=this._filesToLoad[o],s=a.name.toLowerCase(),l=void 0;if(a.correctName=s,i){var u=i[o];u.getAsEntry?l=u.getAsEntry():u.webkitGetAsEntry&&(l=u.webkitGetAsEntry())}l&&l.isDirectory?r.push(l):n.push(a)}if(0===r.length)this._processFiles(n),this._processReload();else for(var c={count:r.length},h=0,d=r;h<d.length;h++){var f=d[h];this._traverseFolder(f,n,c,function(){t._processFiles(n),0===c.count&&t._processReload()})}}},e.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},e.prototype.reload=function(){var e=this;this._sceneFileToLoad?(this._currentScene&&(p.a.errorsCount>0&&p.a.ClearLogCache(),this._engine.stopRenderLoop()),fr.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(t){e._progressCallback&&e._progressCallback(t)}).then(function(t){e._currentScene&&e._currentScene.dispose(),e._currentScene=t,e._sceneLoadedCallback&&e._sceneLoadedCallback(e._sceneFileToLoad,e._currentScene),e._currentScene.executeWhenReady(function(){e._engine.runRenderLoop(function(){e.renderFunction()})})}).catch(function(t){e._errorCallback&&e._errorCallback(e._sceneFileToLoad,e._currentScene,t.message)})):p.a.Error("Please provide a valid .babylon file.")},e}(),al=n(105),sl=n(106),ll=function(){function e(e){void 0===e&&(e=0),this.priority=e}return e.prototype.getDescription=function(){return""},e.prototype.apply=function(e,t){return!0},e}(),ul=function(e){function t(t,n,r){void 0===t&&(t=0),void 0===n&&(n=1024),void 0===r&&(r=.5);var i=e.call(this,t)||this;return i.priority=t,i.maximumSize=n,i.step=r,i}return u.d(t,e),t.prototype.getDescription=function(){return"Reducing render target texture size to "+this.maximumSize},t.prototype.apply=function(e,t){for(var n=!0,r=0;r<e.textures.length;r++){var i=e.textures[r];if(i.canRescale&&!i.getContext){var o=i.getSize();Math.max(o.width,o.height)>this.maximumSize&&(i.scale(this.step),n=!1)}}return n},t}(ll),cl=function(e){function t(t,n,r){void 0===t&&(t=0),void 0===n&&(n=2),void 0===r&&(r=.25);var i=e.call(this,t)||this;return i.priority=t,i.maximumScale=n,i.step=r,i._currentScale=-1,i._directionOffset=1,i}return u.d(t,e),t.prototype.getDescription=function(){return"Setting hardware scaling level to "+this._currentScale},t.prototype.apply=function(e,t){return-1===this._currentScale&&(this._currentScale=e.getEngine().getHardwareScalingLevel(),this._currentScale>this.maximumScale&&(this._directionOffset=-1)),this._currentScale+=this._directionOffset*this.step,e.getEngine().setHardwareScalingLevel(this._currentScale),1===this._directionOffset?this._currentScale>=this.maximumScale:this._currentScale<=this.maximumScale},t}(ll),hl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.getDescription=function(){return"Turning shadows on/off"},t.prototype.apply=function(e,t){return e.shadowsEnabled=t.isInImprovementMode,!0},t}(ll),dl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.getDescription=function(){return"Turning post-processes on/off"},t.prototype.apply=function(e,t){return e.postProcessesEnabled=t.isInImprovementMode,!0},t}(ll),fl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.getDescription=function(){return"Turning lens flares on/off"},t.prototype.apply=function(e,t){return e.lensFlaresEnabled=t.isInImprovementMode,!0},t}(ll),pl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.getDescription=function(){return this.onGetDescription?this.onGetDescription():"Running user defined callback"},t.prototype.apply=function(e,t){return!this.onApply||this.onApply(e,t)},t}(ll),ml=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.getDescription=function(){return"Turning particles on/off"},t.prototype.apply=function(e,t){return e.particlesEnabled=t.isInImprovementMode,!0},t}(ll),gl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u.d(t,e),t.prototype.getDescription=function(){return"Turning render targets off"},t.prototype.apply=function(e,t){return e.renderTargetsEnabled=t.isInImprovementMode,!0},t}(ll),_l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._canBeMerged=function(e){if(!(e instanceof fe.a))return!1;var t=e;return!t.isDisposed()&&!(!t.isVisible||!t.isEnabled())&&!(t.instances.length>0)&&!t.skeleton&&!t.hasLODLevels},t}return u.d(t,e),Object.defineProperty(t,"UpdateSelectionTree",{get:function(){return t._UpdateSelectionTree},set:function(e){t._UpdateSelectionTree=e},enumerable:!0,configurable:!0}),t.prototype.getDescription=function(){return"Merging similar meshes together"},t.prototype.apply=function(e,n,r){for(var i=e.meshes.slice(0),o=i.length,a=0;a<o;a++){var s=new Array,l=i[a];if(this._canBeMerged(l)){s.push(l);for(var u=a+1;u<o;u++){var c=i[u];this._canBeMerged(c)&&c.material===l.material&&c.checkCollisions===l.checkCollisions&&(s.push(c),o--,i.splice(u,1),u--)}s.length<2||fe.a.MergeMeshes(s,void 0,!0)}}var h=e;return h.createOrUpdateSelectionOctree&&(null!=r?r&&h.createOrUpdateSelectionOctree():t.UpdateSelectionTree&&h.createOrUpdateSelectionOctree()),!0},t._UpdateSelectionTree=!1,t}(ll),vl=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.prototype.addOptimization=function(e){return this.optimizations.push(e),this},e.prototype.addCustomOptimization=function(e,t,n){void 0===n&&(n=0);var r=new pl(n);return r.onApply=e,r.onGetDescription=t,this.optimizations.push(r),this},e.LowDegradationAllowed=function(t){var n=new e(t),r=0;return n.addOptimization(new _l(r)),n.addOptimization(new hl(r)),n.addOptimization(new fl(r)),r++,n.addOptimization(new dl(r)),n.addOptimization(new ml(r)),r++,n.addOptimization(new ul(r,1024)),n},e.ModerateDegradationAllowed=function(t){var n=new e(t),r=0;return n.addOptimization(new _l(r)),n.addOptimization(new hl(r)),n.addOptimization(new fl(r)),r++,n.addOptimization(new dl(r)),n.addOptimization(new ml(r)),r++,n.addOptimization(new ul(r,512)),r++,n.addOptimization(new gl(r)),r++,n.addOptimization(new cl(r,2)),n},e.HighDegradationAllowed=function(t){var n=new e(t),r=0;return n.addOptimization(new _l(r)),n.addOptimization(new hl(r)),n.addOptimization(new fl(r)),r++,n.addOptimization(new dl(r)),n.addOptimization(new ml(r)),r++,n.addOptimization(new ul(r,256)),r++,n.addOptimization(new gl(r)),r++,n.addOptimization(new cl(r,4)),n},e}(),yl=function(){function e(e,t,n,r){var o=this;if(void 0===n&&(n=!0),void 0===r&&(r=!1),this._isRunning=!1,this._currentPriorityLevel=0,this._targetFrameRate=60,this._trackerDuration=2e3,this._currentFrameRate=0,this._improvementMode=!1,this.onSuccessObservable=new i.c,this.onNewOptimizationAppliedObservable=new i.c,this.onFailureObservable=new i.c,this._options=t||new vl,this._options.targetFrameRate&&(this._targetFrameRate=this._options.targetFrameRate),this._options.trackerDuration&&(this._trackerDuration=this._options.trackerDuration),n)for(var a=0,s=0,l=this._options.optimizations;s<l.length;s++)l[s].priority=a++;this._improvementMode=r,this._scene=e||P.a.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add(function(){o._sceneDisposeObserver=null,o.dispose()})}return Object.defineProperty(e.prototype,"isInImprovementMode",{get:function(){return this._improvementMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPriorityLevel",{get:function(){return this._currentPriorityLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentFrameRate",{get:function(){return this._currentFrameRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetFrameRate",{get:function(){return this._targetFrameRate},set:function(e){this._targetFrameRate=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trackerDuration",{get:function(){return this._trackerDuration},set:function(e){this._trackerDuration=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizations",{get:function(){return this._options.optimizations},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this._isRunning=!1},e.prototype.reset=function(){this._currentPriorityLevel=0},e.prototype.start=function(){var e=this;this._isRunning||(this._isRunning=!0,this._scene.executeWhenReady(function(){setTimeout(function(){e._checkCurrentState()},e._trackerDuration)}))},e.prototype._checkCurrentState=function(){var e=this;if(this._isRunning){var t=this._scene,n=this._options;if(this._currentFrameRate=Math.round(t.getEngine().getFps()),this._improvementMode&&this._currentFrameRate<=this._targetFrameRate||!this._improvementMode&&this._currentFrameRate>=this._targetFrameRate)return this._isRunning=!1,void this.onSuccessObservable.notifyObservers(this);for(var r=!0,i=!0,o=0;o<n.optimizations.length;o++){var a=n.optimizations[o];a.priority===this._currentPriorityLevel&&(i=!1,r=r&&a.apply(t,this),this.onNewOptimizationAppliedObservable.notifyObservers(a))}if(i)return this._isRunning=!1,void this.onFailureObservable.notifyObservers(this);r&&this._currentPriorityLevel++,t.executeWhenReady(function(){setTimeout(function(){e._checkCurrentState()},e._trackerDuration)})}},e.prototype.dispose=function(){this.stop(),this.onSuccessObservable.clear(),this.onFailureObservable.clear(),this.onNewOptimizationAppliedObservable.clear(),this._sceneDisposeObserver&&this._scene.onDisposeObservable.remove(this._sceneDisposeObserver)},e.OptimizeAsync=function(t,n,r,i){var o=new e(t,n||vl.ModerateDegradationAllowed(),!1);return r&&o.onSuccessObservable.add(function(){r()}),i&&o.onFailureObservable.add(function(){i()}),o.start(),o},e}(),bl=[],El=function(e,t){bl[e.id]||e.doNotSerialize||(t.vertexData.push(e.serializeVerticeData()),bl[e.id]=!0)},xl=function(e,t){var n={},r=e._geometry;return r&&(e.getScene().getGeometryByID(r.id)||El(r,t.geometries)),e.serialize&&e.serialize(n),n},Tl=function(){function e(){}return e.ClearCache=function(){bl=[]},e.Serialize=function(t){var n,r,i,o={};if(e.ClearCache(),o.useDelayedTextureLoading=t.useDelayedTextureLoading,o.autoClear=t.autoClear,o.clearColor=t.clearColor.asArray(),o.ambientColor=t.ambientColor.asArray(),o.gravity=t.gravity.asArray(),o.collisionsEnabled=t.collisionsEnabled,t.fogMode&&0!==t.fogMode&&(o.fogMode=t.fogMode,o.fogColor=t.fogColor.asArray(),o.fogStart=t.fogStart,o.fogEnd=t.fogEnd,o.fogDensity=t.fogDensity),t.isPhysicsEnabled()){var a=t.getPhysicsEngine();a&&(o.physicsEnabled=!0,o.physicsGravity=a.gravity.asArray(),o.physicsEngine=a.getPhysicsPluginName())}t.metadata&&(o.metadata=t.metadata),o.morphTargetManagers=[];for(var s=0,l=t.meshes;s<l.length;s++){var u=(_=l[s]).morphTargetManager;u&&o.morphTargetManagers.push(u.serialize())}for(o.lights=[],n=0;n<t.lights.length;n++)(r=t.lights[n]).doNotSerialize||o.lights.push(r.serialize());for(o.cameras=[],n=0;n<t.cameras.length;n++){var c=t.cameras[n];c.doNotSerialize||o.cameras.push(c.serialize())}if(t.activeCamera&&(o.activeCameraID=t.activeCamera.id),D.a.AppendSerializedAnimations(t,o),t.reflectionProbes&&t.reflectionProbes.length>0)for(o.reflectionProbes=[],n=0;n<t.reflectionProbes.length;n++){var h=t.reflectionProbes[n];o.reflectionProbes.push(h.serialize())}for(o.materials=[],o.multiMaterials=[],n=0;n<t.materials.length;n++)(i=t.materials[n]).doNotSerialize||o.materials.push(i.serialize());for(o.multiMaterials=[],n=0;n<t.multiMaterials.length;n++){var d=t.multiMaterials[n];o.multiMaterials.push(d.serialize())}for(t.environmentTexture&&(o.environmentTexture=t.environmentTexture.name),o.skeletons=[],n=0;n<t.skeletons.length;n++){var f=t.skeletons[n];f.doNotSerialize||o.skeletons.push(f.serialize())}for(o.transformNodes=[],n=0;n<t.transformNodes.length;n++)o.transformNodes.push(t.transformNodes[n].serialize());o.geometries={},o.geometries.boxes=[],o.geometries.spheres=[],o.geometries.cylinders=[],o.geometries.toruses=[],o.geometries.grounds=[],o.geometries.planes=[],o.geometries.torusKnots=[],o.geometries.vertexData=[],bl=[];var p=t.getGeometries();for(n=0;n<p.length;n++){var g=p[n];g.isReady()&&El(g,o.geometries)}for(o.meshes=[],n=0;n<t.meshes.length;n++){var _;if((_=t.meshes[n])instanceof fe.a){var v=_;v.doNotSerialize||v.delayLoadState!==m.a.DELAYLOADSTATE_LOADED&&v.delayLoadState!==m.a.DELAYLOADSTATE_NONE||o.meshes.push(xl(v,o))}}for(o.particleSystems=[],n=0;n<t.particleSystems.length;n++)o.particleSystems.push(t.particleSystems[n].serialize());t.actionManager&&(o.actions=t.actionManager.serialize("scene"));for(var y=0,b=t._serializableComponents;y<b.length;y++)b[y].serialize(o);return o},e.SerializeMesh=function(t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);var i={};if(e.ClearCache(),t=t instanceof Array?t:[t],n||r)for(var o=0;o<t.length;++o)r&&t[o].getDescendants().forEach(function(e){e instanceof fe.a&&t.indexOf(e)<0&&t.push(e)}),n&&t[o].parent&&t.indexOf(t[o].parent)<0&&t.push(t[o].parent);return t.forEach(function(e){!function(e,t){if(e.delayLoadState===m.a.DELAYLOADSTATE_LOADED||e.delayLoadState===m.a.DELAYLOADSTATE_NONE){if(e.material)if(e.material instanceof ji.a){if(t.multiMaterials=t.multiMaterials||[],t.materials=t.materials||[],!t.multiMaterials.some(function(t){return t.id===e.material.id})){t.multiMaterials.push(e.material.serialize());for(var n=function(e){e&&(t.materials.some(function(t){return t.id===e.id})||t.materials.push(e.serialize()))},r=0,i=e.material.subMaterials;r<i.length;r++)n(i[r])}}else t.materials=t.materials||[],t.materials.some(function(t){return t.id===e.material.id})||t.materials.push(e.material.serialize());var o=e._geometry;o&&(t.geometries||(t.geometries={},t.geometries.boxes=[],t.geometries.spheres=[],t.geometries.cylinders=[],t.geometries.toruses=[],t.geometries.grounds=[],t.geometries.planes=[],t.geometries.torusKnots=[],t.geometries.vertexData=[]),El(o,t.geometries)),e.skeleton&&(t.skeletons=t.skeletons||[],t.skeletons.push(e.skeleton.serialize())),t.meshes=t.meshes||[],t.meshes.push(xl(e,t))}}(e,i)}),i},e}(),Sl=n(29),Al=function(){function e(){}return e.CreateResizedCopy=function(e,t,n,r){void 0===r&&(r=!0);var i=e.getScene(),o=i.getEngine(),a=new un("resized"+e.name,{width:t,height:n},i,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);a.wrapU=e.wrapU,a.wrapV=e.wrapV,a.uOffset=e.uOffset,a.vOffset=e.vOffset,a.uScale=e.uScale,a.vScale=e.vScale,a.uAng=e.uAng,a.vAng=e.vAng,a.wAng=e.wAng,a.coordinatesIndex=e.coordinatesIndex,a.level=e.level,a.anisotropicFilteringLevel=e.anisotropicFilteringLevel,a._texture.isReady=!1,e.wrapU=Ge.a.CLAMP_ADDRESSMODE,e.wrapV=Ge.a.CLAMP_ADDRESSMODE;var s=new Ht("pass",1,null,r?Ge.a.BILINEAR_SAMPLINGMODE:Ge.a.NEAREST_SAMPLINGMODE,o,!1,m.a.TEXTURETYPE_UNSIGNED_INT);return s.getEffect().executeWhenCompiled(function(){s.onApply=function(t){t.setTexture("textureSampler",e)};var t=a.getInternalTexture();t&&(i.postProcessManager.directRender([s],t),o.unBindFramebuffer(t),a.disposeFramebufferObjects(),s.dispose(),t.isReady=!0)}),a},e}(),Pl=function(){function e(t,n){if(void 0===n&&(n=null),!e.IsSupported(t))throw"Your browser does not support recording so far.";var r=t.getRenderingCanvas();if(!r)throw"The babylon engine must have a canvas to be recorded";this._canvas=r,this._canvas.isRecording=!1,this._options=u.a({},e._defaultOptions,n);var i=this._canvas.captureStream(this._options.fps);if(this._options.audioTracks)for(var o=0,a=this._options.audioTracks;o<a.length;o++){var s=a[o];i.addTrack(s)}this._mediaRecorder=new MediaRecorder(i,{mimeType:this._options.mimeType}),this._mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this._mediaRecorder.onerror=this._handleError.bind(this),this._mediaRecorder.onstop=this._handleStop.bind(this)}return e.IsSupported=function(e){var t=e.getRenderingCanvas();return!!t&&"function"==typeof t.captureStream},Object.defineProperty(e.prototype,"isRecording",{get:function(){return!!this._canvas&&this._canvas.isRecording},enumerable:!0,configurable:!0}),e.prototype.stopRecording=function(){this._canvas&&this._mediaRecorder&&this.isRecording&&(this._canvas.isRecording=!1,this._mediaRecorder.stop())},e.prototype.startRecording=function(e,t){var n=this;if(void 0===e&&(e="babylonjs.webm"),void 0===t&&(t=7),!this._canvas||!this._mediaRecorder)throw"Recorder has already been disposed";if(this.isRecording)throw"Recording already in progress";return t>0&&setTimeout(function(){n.stopRecording()},1e3*t),this._fileName=e,this._recordedChunks=[],this._resolve=null,this._reject=null,this._canvas.isRecording=!0,this._mediaRecorder.start(this._options.recordChunckSize),new Promise(function(e,t){n._resolve=e,n._reject=t})},e.prototype.dispose=function(){this._canvas=null,this._mediaRecorder=null,this._recordedChunks=[],this._fileName=null,this._resolve=null,this._reject=null},e.prototype._handleDataAvailable=function(e){e.data.size>0&&this._recordedChunks.push(e.data)},e.prototype._handleError=function(e){if(this.stopRecording(),!this._reject)throw new e.error;this._reject(e.error)},e.prototype._handleStop=function(){this.stopRecording();var e=new Blob(this._recordedChunks);this._resolve&&this._resolve(e),window.URL.createObjectURL(e),this._fileName&&ye.h.Download(e,this._fileName)},e._defaultOptions={mimeType:"video/webm",fps:25,recordChunckSize:3e3},e}(),Ml=function(){function e(){}return e.CreateScreenshot=function(e,t,n,r,i){var o,a;if(void 0===i&&(i="image/png"),n.precision)o=Math.round(e.getRenderWidth()*n.precision),a=Math.round(o/e.getAspectRatio(t));else if(n.width&&n.height)o=n.width,a=n.height;else if(n.width&&!n.height)o=n.width,a=Math.round(o/e.getAspectRatio(t));else if(n.height&&!n.width)a=n.height,o=Math.round(a*e.getAspectRatio(t));else{if(isNaN(n))return void p.a.Error("Invalid 'size' parameter !");a=n,o=n}ye.h._ScreenshotCanvas||(ye.h._ScreenshotCanvas=document.createElement("canvas")),ye.h._ScreenshotCanvas.width=o,ye.h._ScreenshotCanvas.height=a;var s=ye.h._ScreenshotCanvas.getContext("2d"),l=e.getRenderWidth()/e.getRenderHeight(),u=o,c=u/l;c>a&&(u=(c=a)*l);var h=Math.max(0,o-u)/2,d=Math.max(0,a-c)/2,f=e.getRenderingCanvas();s&&f&&s.drawImage(f,h,d,u,c),ye.h.EncodeScreenshotCanvasData(r,i)},e.CreateScreenshotUsingRenderTarget=function(e,t,n,r,i,o,a,s){var l,u;if(void 0===i&&(i="image/png"),void 0===o&&(o=1),void 0===a&&(a=!1),n.precision)l=Math.round(e.getRenderWidth()*n.precision),u=Math.round(l/e.getAspectRatio(t)),n={width:l,height:u};else if(n.width&&n.height)l=n.width,u=n.height;else if(n.width&&!n.height)l=n.width,u=Math.round(l/e.getAspectRatio(t)),n={width:l,height:u};else if(n.height&&!n.width)u=n.height,n={width:l=Math.round(u*e.getAspectRatio(t)),height:u};else{if(isNaN(n))return void p.a.Error("Invalid 'size' parameter !");u=n,l=n}var c=t.getScene(),h=null;c.activeCamera!==t&&(h=c.activeCamera,c.activeCamera=t);var d=e.getRenderingCanvas();if(d){var f={width:d.width,height:d.height};e.setSize(l,u),c.render();var g=new un("screenShot",n,c,!1,!1,m.a.TEXTURETYPE_UNSIGNED_INT,!1,Ge.a.NEAREST_SAMPLINGMODE);g.renderList=null,g.samples=o,a&&g.addPostProcess(new ds("antialiasing",1,c.activeCamera)),g.onAfterRenderObservable.add(function(){ye.h.DumpFramebuffer(l,u,e,r,i,s)}),c.incrementRenderId(),c.resetCachedMaterial(),g.render(!0),g.dispose(),h&&(c.activeCamera=h),e.setSize(f.width,f.height),t.getProjectionMatrix(!0)}else p.a.Error("No rendering canvas found !")},e}();ye.h.CreateScreenshot=Ml.CreateScreenshot,ye.h.CreateScreenshotUsingRenderTarget=Ml.CreateScreenshotUsingRenderTarget,function(e){e[e.Checkbox=0]="Checkbox",e[e.Slider=1]="Slider",e[e.Vector3=2]="Vector3",e[e.Quaternion=3]="Quaternion",e[e.Color3=4]="Color3"}(Ws||(Ws={})),n.d(t,"AbstractScene",function(){return r.a}),n.d(t,"Action",function(){return s}),n.d(t,"ActionEvent",function(){return l.a}),n.d(t,"ActionManager",function(){return R}),n.d(t,"Condition",function(){return c}),n.d(t,"ValueCondition",function(){return h}),n.d(t,"PredicateCondition",function(){return d}),n.d(t,"StateCondition",function(){return f}),n.d(t,"SwitchBooleanAction",function(){return g}),n.d(t,"SetStateAction",function(){return _}),n.d(t,"SetValueAction",function(){return v}),n.d(t,"IncrementValueAction",function(){return y}),n.d(t,"PlayAnimationAction",function(){return b}),n.d(t,"StopAnimationAction",function(){return E}),n.d(t,"DoNothingAction",function(){return x}),n.d(t,"CombineAction",function(){return T}),n.d(t,"ExecuteCodeAction",function(){return S}),n.d(t,"SetParentAction",function(){return A}),n.d(t,"PlaySoundAction",function(){return C}),n.d(t,"StopSoundAction",function(){return w}),n.d(t,"InterpolateValueAction",function(){return U}),n.d(t,"Animatable",function(){return q}),n.d(t,"_IAnimationState",function(){return N}),n.d(t,"Animation",function(){return B}),n.d(t,"TargetedAnimation",function(){return Q}),n.d(t,"AnimationGroup",function(){return Z}),n.d(t,"AnimationPropertiesOverride",function(){return J}),n.d(t,"EasingFunction",function(){return $}),n.d(t,"CircleEase",function(){return ee}),n.d(t,"BackEase",function(){return te}),n.d(t,"BounceEase",function(){return ne}),n.d(t,"CubicEase",function(){return re}),n.d(t,"ElasticEase",function(){return ie}),n.d(t,"ExponentialEase",function(){return oe}),n.d(t,"PowerEase",function(){return ae}),n.d(t,"QuadraticEase",function(){return se}),n.d(t,"QuarticEase",function(){return le}),n.d(t,"QuinticEase",function(){return ue}),n.d(t,"SineEase",function(){return ce}),n.d(t,"BezierCurveEase",function(){return he}),n.d(t,"RuntimeAnimation",function(){return H}),n.d(t,"AnimationEvent",function(){return de}),n.d(t,"AnimationKeyInterpolation",function(){return O}),n.d(t,"AnimationRange",function(){return L}),n.d(t,"KeepAssets",function(){return pe}),n.d(t,"AssetContainer",function(){return me}),n.d(t,"Analyser",function(){return _e}),n.d(t,"AudioEngine",function(){return ve}),n.d(t,"AudioSceneComponent",function(){return Se}),n.d(t,"Sound",function(){return Ee}),n.d(t,"SoundTrack",function(){return xe}),n.d(t,"WeightedSound",function(){return Ae}),n.d(t,"AutoRotationBehavior",function(){return Me}),n.d(t,"BouncingBehavior",function(){return Re}),n.d(t,"FramingBehavior",function(){return Ce}),n.d(t,"AttachToBoxBehavior",function(){return Oe}),n.d(t,"FadeInOutBehavior",function(){return Ie}),n.d(t,"MultiPointerScaleBehavior",function(){return Le}),n.d(t,"PointerDragBehavior",function(){return De.a}),n.d(t,"SixDofDragBehavior",function(){return Ue}),n.d(t,"Bone",function(){return K}),n.d(t,"BoneIKController",function(){return ke}),n.d(t,"BoneLookController",function(){return Ve}),n.d(t,"Skeleton",function(){return He}),n.d(t,"CameraInputTypes",function(){return We}),n.d(t,"CameraInputsManager",function(){return Xe}),n.d(t,"Camera",function(){return Ne.a}),n.d(t,"TargetCamera",function(){return yt}),n.d(t,"FreeCamera",function(){return bt}),n.d(t,"FreeCameraInputsManager",function(){return dt}),n.d(t,"TouchCamera",function(){return Et}),n.d(t,"ArcRotateCamera",function(){return xt}),n.d(t,"ArcRotateCameraInputsManager",function(){return nt}),n.d(t,"DeviceOrientationCamera",function(){return Tt}),n.d(t,"FlyCamera",function(){return At}),n.d(t,"FlyCameraInputsManager",function(){return St}),n.d(t,"FollowCamera",function(){return Rt}),n.d(t,"ArcFollowCamera",function(){return Ct}),n.d(t,"GamepadCamera",function(){return Vt}),n.d(t,"UniversalCamera",function(){return kt}),n.d(t,"VirtualJoysticksCamera",function(){return nn}),n.d(t,"ArcRotateCameraGamepadInput",function(){return Qe}),n.d(t,"ArcRotateCameraKeyboardMoveInput",function(){return Je}),n.d(t,"ArcRotateCameraMouseWheelInput",function(){return $e}),n.d(t,"ArcRotateCameraPointersInput",function(){return tt}),n.d(t,"ArcRotateCameraVRDeviceOrientationInput",function(){return rt}),n.d(t,"FlyCameraKeyboardInput",function(){return it}),n.d(t,"FlyCameraMouseInput",function(){return ot}),n.d(t,"FollowCameraKeyboardMoveInput",function(){return at}),n.d(t,"FollowCameraMouseWheelInput",function(){return st}),n.d(t,"FollowCameraPointersInput",function(){return lt}),n.d(t,"FreeCameraDeviceOrientationInput",function(){return ft}),n.d(t,"FreeCameraGamepadInput",function(){return pt}),n.d(t,"FreeCameraKeyboardMoveInput",function(){return ut}),n.d(t,"FreeCameraMouseInput",function(){return ct}),n.d(t,"FreeCameraTouchInput",function(){return ht}),n.d(t,"FreeCameraVirtualJoystickInput",function(){return vt}),n.d(t,"AnaglyphArcRotateCamera",function(){return Yt}),n.d(t,"AnaglyphFreeCamera",function(){return Kt}),n.d(t,"AnaglyphGamepadCamera",function(){return qt}),n.d(t,"AnaglyphUniversalCamera",function(){return Qt}),n.d(t,"StereoscopicArcRotateCamera",function(){return Jt}),n.d(t,"StereoscopicFreeCamera",function(){return $t}),n.d(t,"StereoscopicGamepadCamera",function(){return en}),n.d(t,"StereoscopicUniversalCamera",function(){return tn}),n.d(t,"VRCameraMetrics",function(){return rn}),n.d(t,"VRDeviceOrientationArcRotateCamera",function(){return dn}),n.d(t,"VRDeviceOrientationFreeCamera",function(){return fn}),n.d(t,"VRDeviceOrientationGamepadCamera",function(){return pn}),n.d(t,"OnAfterEnteringVRObservableEvent",function(){return Dn}),n.d(t,"VRExperienceHelper",function(){return Ln}),n.d(t,"WebVRFreeCamera",function(){return gn}),n.d(t,"WebXRCamera",function(){return Fn}),n.d(t,"WebXREnterExitUIButton",function(){return kn}),n.d(t,"WebXREnterExitUIOptions",function(){return Vn}),n.d(t,"WebXREnterExitUI",function(){return Gn}),n.d(t,"WebXRState",function(){return Mn}),n.d(t,"WebXRExperienceHelper",function(){return Un}),n.d(t,"WebXRController",function(){return zn}),n.d(t,"WebXRInput",function(){return jn}),n.d(t,"WebXRManagedOutputCanvas",function(){return Hn}),n.d(t,"WebXRSessionManager",function(){return Nn}),n.d(t,"Collider",function(){return Xn}),n.d(t,"DefaultCollisionCoordinator",function(){return Yn}),n.d(t,"PickingInfo",function(){return Kn.a}),n.d(t,"IntersectionInfo",function(){return qn.a}),n.d(t,"_MeshCollisionData",function(){return Qn.a}),n.d(t,"BoundingBox",function(){return Zn.a}),n.d(t,"BoundingInfo",function(){return Jn.a}),n.d(t,"BoundingSphere",function(){return $n.a}),n.d(t,"Ray",function(){return Ot.a}),n.d(t,"Octree",function(){return tr}),n.d(t,"OctreeBlock",function(){return er}),n.d(t,"OctreeSceneComponent",function(){return nr}),n.d(t,"AxesViewer",function(){return rr.AxesViewer}),n.d(t,"BoneAxesViewer",function(){return rr.BoneAxesViewer}),n.d(t,"DebugLayer",function(){return rr.DebugLayer}),n.d(t,"PhysicsViewer",function(){return rr.PhysicsViewer}),n.d(t,"RayHelper",function(){return rr.RayHelper}),n.d(t,"SkeletonViewer",function(){return rr.SkeletonViewer}),n.d(t,"Constants",function(){return m.a}),n.d(t,"InstancingAttributeInfo",function(){return ge.d}),n.d(t,"DepthTextureCreationOptions",function(){return ge.a}),n.d(t,"EngineCapabilities",function(){return ge.c}),n.d(t,"Engine",function(){return ge.b}),n.d(t,"EngineStore",function(){return P.a}),n.d(t,"NullEngineOptions",function(){return ir.b}),n.d(t,"NullEngine",function(){return ir.a}),n.d(t,"WebGLPipelineContext",function(){return sr.a}),n.d(t,"_OcclusionDataStorage",function(){return ar}),n.d(t,"_forceTransformFeedbackToBundle",function(){return!0}),n.d(t,"KeyboardEventTypes",function(){return Ze.a}),n.d(t,"KeyboardInfo",function(){return Ze.b}),n.d(t,"KeyboardInfoPre",function(){return Ze.c}),n.d(t,"PointerEventTypes",function(){return Pe.a}),n.d(t,"PointerInfoBase",function(){return Pe.c}),n.d(t,"PointerInfoPre",function(){return Pe.d}),n.d(t,"PointerInfo",function(){return Pe.b}),n.d(t,"ClipboardEventTypes",function(){return lr}),n.d(t,"ClipboardInfo",function(){return ur}),n.d(t,"DaydreamController",function(){return pr}),n.d(t,"GearVRController",function(){return mr}),n.d(t,"GenericController",function(){return gr}),n.d(t,"OculusTouchController",function(){return _r}),n.d(t,"PoseEnabledControllerType",function(){return Mt}),n.d(t,"PoseEnabledControllerHelper",function(){return Lt}),n.d(t,"PoseEnabledController",function(){return Ft}),n.d(t,"ViveController",function(){return vr}),n.d(t,"WebVRController",function(){return _n}),n.d(t,"WindowsMotionController",function(){return br}),n.d(t,"StickValues",function(){return Ye}),n.d(t,"Gamepad",function(){return Ke}),n.d(t,"GenericPad",function(){return qe}),n.d(t,"GamepadManager",function(){return Bt}),n.d(t,"GamepadSystemSceneComponent",function(){return Ut}),n.d(t,"Xbox360Button",function(){return It}),n.d(t,"Xbox360Dpad",function(){return Dt}),n.d(t,"Xbox360Pad",function(){return Nt}),n.d(t,"AxisDragGizmo",function(){return Er.a}),n.d(t,"AxisScaleGizmo",function(){return Ar}),n.d(t,"BoundingBoxGizmo",function(){return Rr}),n.d(t,"Gizmo",function(){return Tr.a}),n.d(t,"GizmoManager",function(){return Lr}),n.d(t,"PlaneRotationGizmo",function(){return Cr}),n.d(t,"PositionGizmo",function(){return Or}),n.d(t,"RotationGizmo",function(){return wr}),n.d(t,"ScaleGizmo",function(){return Dr}),n.d(t,"LightGizmo",function(){return Vr}),n.d(t,"EnvironmentHelper",function(){return Jr}),n.d(t,"PhotoDome",function(){return ei}),n.d(t,"_forceSceneHelpersToBundle",function(){return!0}),n.d(t,"VideoDome",function(){return Si}),n.d(t,"EngineInstrumentation",function(){return Ai}),n.d(t,"SceneInstrumentation",function(){return Pi}),n.d(t,"_TimeToken",function(){return or}),n.d(t,"EffectLayer",function(){return Ri}),n.d(t,"EffectLayerSceneComponent",function(){return Ci}),n.d(t,"GlowLayer",function(){return wi}),n.d(t,"HighlightLayer",function(){return Ii}),n.d(t,"Layer",function(){return Li}),n.d(t,"LayerSceneComponent",function(){return Di}),n.d(t,"LensFlare",function(){return Fi}),n.d(t,"LensFlareSystem",function(){return Ni}),n.d(t,"LensFlareSystemSceneComponent",function(){return Bi}),n.d(t,"Light",function(){return Fr.a}),n.d(t,"ShadowLight",function(){return Nr}),n.d(t,"DirectionalLight",function(){return Br}),n.d(t,"HemisphericLight",function(){return mn.a}),n.d(t,"PointLight",function(){return Vi}),n.d(t,"SpotLight",function(){return kr}),n.d(t,"ShadowGenerator",function(){return Ui}),n.d(t,"ShadowGeneratorSceneComponent",function(){return ki}),n.d(t,"DefaultLoadingScreen",function(){return Gi}),n.d(t,"SceneLoaderProgressEvent",function(){return dr}),n.d(t,"SceneLoader",function(){return fr}),n.d(t,"SceneLoaderFlags",function(){return hr.a}),n.d(t,"_BabylonLoaderRegistered",function(){return!0}),n.d(t,"ColorCurves",function(){return co.a}),n.d(t,"EffectFallbacks",function(){return zt.c}),n.d(t,"EffectCreationOptions",function(){return zt.b}),n.d(t,"Effect",function(){return zt.a}),n.d(t,"FresnelParameters",function(){return ho}),n.d(t,"ImageProcessingConfigurationDefines",function(){return vn.b}),n.d(t,"ImageProcessingConfiguration",function(){return vn.a}),n.d(t,"Material",function(){return Mi.a}),n.d(t,"MaterialDefines",function(){return Xr.a}),n.d(t,"MaterialHelper",function(){return Wr.a}),n.d(t,"MultiMaterial",function(){return ji.a}),n.d(t,"PushMaterial",function(){return Yr.a}),n.d(t,"ShaderMaterial",function(){return go.a}),n.d(t,"StandardMaterialDefines",function(){return yn.b}),n.d(t,"StandardMaterial",function(){return yn.a}),n.d(t,"BaseTexture",function(){return Gr.a}),n.d(t,"CubeTexture",function(){return Hr}),n.d(t,"EquiRectangularCubeTexture",function(){return vo}),n.d(t,"HDRCubeTexture",function(){return Xi}),n.d(t,"InternalTexture",function(){return ze.a}),n.d(t,"MirrorTexture",function(){return jr}),n.d(t,"MultiRenderTarget",function(){return Eo}),n.d(t,"RenderTargetTexture",function(){return un}),n.d(t,"Texture",function(){return Ge.a}),n.d(t,"UniformBuffer",function(){return an.a}),n.d(t,"MaterialFlags",function(){return Kr.a}),n.d(t,"BackgroundMaterial",function(){return Qr}),n.d(t,"PBRMaterialDefines",function(){return si}),n.d(t,"PBRBaseMaterial",function(){return li}),n.d(t,"PBRBaseSimpleMaterial",function(){return fo}),n.d(t,"PBRMaterial",function(){return ui}),n.d(t,"PBRMetallicRoughnessMaterial",function(){return po}),n.d(t,"PBRSpecularGlossinessMaterial",function(){return mo}),n.d(t,"ColorGradingTexture",function(){return _o}),n.d(t,"DynamicTexture",function(){return bn}),n.d(t,"ProceduralTexture",function(){return To}),n.d(t,"RawCubeTexture",function(){return Mo}),n.d(t,"RawTexture",function(){return je}),n.d(t,"RawTexture3D",function(){return Ro}),n.d(t,"RefractionTexture",function(){return Co}),n.d(t,"VideoTexture",function(){return Ti}),n.d(t,"HtmlElementTexture",function(){return wo}),n.d(t,"_DDSTextureLoader",function(){return vi}),n.d(t,"_ENVTextureLoader",function(){return bi}),n.d(t,"_KTXTextureLoader",function(){return xi}),n.d(t,"_TGATextureLoader",function(){return bo}),n.d(t,"CustomProceduralTexture",function(){return Ao}),n.d(t,"NoiseProceduralTexture",function(){return Po}),n.d(t,"ProceduralTextureSceneComponent",function(){return xo}),n.d(t,"Scalar",function(){return I.a}),n.d(t,"ToGammaSpace",function(){return o.u}),n.d(t,"ToLinearSpace",function(){return o.v}),n.d(t,"Epsilon",function(){return o.h}),n.d(t,"Color3",function(){return o.e}),n.d(t,"Color4",function(){return o.f}),n.d(t,"Vector2",function(){return o.w}),n.d(t,"Vector3",function(){return o.x}),n.d(t,"Vector4",function(){return o.y}),n.d(t,"Size",function(){return o.r}),n.d(t,"Quaternion",function(){return o.q}),n.d(t,"Matrix",function(){return o.j}),n.d(t,"Plane",function(){return o.n}),n.d(t,"Viewport",function(){return o.z}),n.d(t,"Frustum",function(){return o.i}),n.d(t,"Space",function(){return o.s}),n.d(t,"Axis",function(){return o.c}),n.d(t,"BezierCurve",function(){return o.d}),n.d(t,"Orientation",function(){return o.k}),n.d(t,"Angle",function(){return o.a}),n.d(t,"Arc2",function(){return o.b}),n.d(t,"Path2",function(){return o.l}),n.d(t,"Path3D",function(){return o.m}),n.d(t,"Curve3",function(){return o.g}),n.d(t,"PositionNormalVertex",function(){return o.p}),n.d(t,"PositionNormalTextureVertex",function(){return o.o}),n.d(t,"Tmp",function(){return o.t}),n.d(t,"SphericalHarmonics",function(){return ci.a}),n.d(t,"SphericalPolynomial",function(){return ci.b}),n.d(t,"AbstractMesh",function(){return Fe.a}),n.d(t,"Buffer",function(){return Sn.a}),n.d(t,"VertexBuffer",function(){return Sn.b}),n.d(t,"CSG",function(){return jo}),n.d(t,"Geometry",function(){return zi.a}),n.d(t,"GroundMesh",function(){return An}),n.d(t,"TrailMesh",function(){return Ho}),n.d(t,"InstancedMesh",function(){return Wo.a}),n.d(t,"LinesMesh",function(){return Xo.b}),n.d(t,"InstancedLinesMesh",function(){return Xo.a}),n.d(t,"_CreationDataStorage",function(){return fe.b}),n.d(t,"_InstancesBatch",function(){return fe.c}),n.d(t,"Mesh",function(){return fe.a}),n.d(t,"VertexData",function(){return Tn.a}),n.d(t,"MeshBuilder",function(){return oa}),n.d(t,"SimplificationSettings",function(){return aa}),n.d(t,"SimplificationQueue",function(){return sa}),n.d(t,"SimplificationType",function(){return ra}),n.d(t,"SimplicationQueueSceneComponent",function(){return fa}),n.d(t,"Polygon",function(){return Zo}),n.d(t,"PolygonMeshBuilder",function(){return Jo}),n.d(t,"BaseSubMesh",function(){return Bo.a}),n.d(t,"SubMesh",function(){return Bo.b}),n.d(t,"MeshLODLevel",function(){return pa.a}),n.d(t,"TransformNode",function(){return $r.a}),n.d(t,"BoxBuilder",function(){return xr.a}),n.d(t,"SphereBuilder",function(){return Pr.a}),n.d(t,"CylinderBuilder",function(){return Cn.a}),n.d(t,"LinesBuilder",function(){return Mr.a}),n.d(t,"PlaneBuilder",function(){return Zr.a}),n.d(t,"DataBuffer",function(){return ma.a}),n.d(t,"WebGLDataBuffer",function(){return ga.a}),n.d(t,"DracoCompression",function(){return No}),n.d(t,"DiscBuilder",function(){return Yo}),n.d(t,"RibbonBuilder",function(){return to}),n.d(t,"HemisphereBuilder",function(){return Ur}),n.d(t,"TorusBuilder",function(){return Rn}),n.d(t,"TorusKnotBuilder",function(){return Ko}),n.d(t,"PolygonBuilder",function(){return $o}),n.d(t,"ShapeBuilder",function(){return no}),n.d(t,"LatheBuilder",function(){return ea}),n.d(t,"GroundBuilder",function(){return Pn}),n.d(t,"TubeBuilder",function(){return ta}),n.d(t,"PolyhedronBuilder",function(){return Ir}),n.d(t,"IcoSphereBuilder",function(){return na}),n.d(t,"DecalBuilder",function(){return ia}),n.d(t,"MorphTarget",function(){return Yi}),n.d(t,"MorphTargetManager",function(){return Ki}),n.d(t,"Node",function(){return F.a}),n.d(t,"Database",function(){return va}),n.d(t,"BaseParticleSystem",function(){return Ma}),n.d(t,"GPUParticleSystem",function(){return Oa}),n.d(t,"Particle",function(){return Ra}),n.d(t,"ParticleHelper",function(){return Da}),n.d(t,"ParticleSystem",function(){return wa}),n.d(t,"_IDoNeedToBeInTheBuild",function(){return 42}),n.d(t,"ParticleSystemSet",function(){return Ia}),n.d(t,"SolidParticle",function(){return La}),n.d(t,"ModelShape",function(){return Fa}),n.d(t,"DepthSortedParticle",function(){return Na}),n.d(t,"SolidParticleSystem",function(){return Ua}),n.d(t,"SubEmitterType",function(){return _a}),n.d(t,"SubEmitter",function(){return Ca}),n.d(t,"BoxParticleEmitter",function(){return ya}),n.d(t,"ConeParticleEmitter",function(){return ba}),n.d(t,"CylinderParticleEmitter",function(){return Ea}),n.d(t,"CylinderDirectedParticleEmitter",function(){return xa}),n.d(t,"HemisphericParticleEmitter",function(){return Ta}),n.d(t,"PointParticleEmitter",function(){return Sa}),n.d(t,"SphereParticleEmitter",function(){return Aa}),n.d(t,"SphereDirectedParticleEmitter",function(){return Pa}),n.d(t,"PhysicsEngine",function(){return Zi}),n.d(t,"PhysicsEngineSceneComponent",function(){return Ga}),n.d(t,"PhysicsHelper",function(){return za}),n.d(t,"PhysicsRadialExplosionEventOptions",function(){return Ya}),n.d(t,"PhysicsUpdraftEventOptions",function(){return Ka}),n.d(t,"PhysicsVortexEventOptions",function(){return qa}),n.d(t,"PhysicsRadialImpulseFalloff",function(){return ka}),n.d(t,"PhysicsUpdraftMode",function(){return Va}),n.d(t,"PhysicsImpostor",function(){return qi.a}),n.d(t,"PhysicsJoint",function(){return Qi.e}),n.d(t,"DistanceJoint",function(){return Qi.a}),n.d(t,"MotorEnabledJoint",function(){return Qi.d}),n.d(t,"HingeJoint",function(){return Qi.c}),n.d(t,"Hinge2Joint",function(){return Qi.b}),n.d(t,"CannonJSPlugin",function(){return $i}),n.d(t,"AmmoJSPlugin",function(){return ro}),n.d(t,"OimoJSPlugin",function(){return eo}),n.d(t,"AnaglyphPostProcess",function(){return Xt}),n.d(t,"BlackAndWhitePostProcess",function(){return Qa}),n.d(t,"BloomEffect",function(){return es}),n.d(t,"BloomMergePostProcess",function(){return $a}),n.d(t,"BlurPostProcess",function(){return zr}),n.d(t,"ChromaticAberrationPostProcess",function(){return ts}),n.d(t,"CircleOfConfusionPostProcess",function(){return ns}),n.d(t,"ColorCorrectionPostProcess",function(){return rs}),n.d(t,"ConvolutionPostProcess",function(){return is}),n.d(t,"DepthOfFieldBlurPostProcess",function(){return os}),n.d(t,"DepthOfFieldEffectBlurLevel",function(){return as}),n.d(t,"DepthOfFieldEffect",function(){return us}),n.d(t,"DepthOfFieldMergePostProcessOptions",function(){return ss}),n.d(t,"DepthOfFieldMergePostProcess",function(){return ls}),n.d(t,"DisplayPassPostProcess",function(){return cs}),n.d(t,"ExtractHighlightsPostProcess",function(){return Ja}),n.d(t,"FilterPostProcess",function(){return hs}),n.d(t,"FxaaPostProcess",function(){return ds}),n.d(t,"GrainPostProcess",function(){return fs}),n.d(t,"HighlightsPostProcess",function(){return ps}),n.d(t,"ImageProcessingPostProcess",function(){return xn}),n.d(t,"MotionBlurPostProcess",function(){return _s}),n.d(t,"PassPostProcess",function(){return Ht}),n.d(t,"PassCubePostProcess",function(){return Wt}),n.d(t,"PostProcess",function(){return jt}),n.d(t,"PostProcessManager",function(){return sn.a}),n.d(t,"RefractionPostProcess",function(){return vs}),n.d(t,"SharpenPostProcess",function(){return ys}),n.d(t,"StereoscopicInterlacePostProcess",function(){return Zt}),n.d(t,"TonemappingOperator",function(){return Ms}),n.d(t,"TonemapPostProcess",function(){return Cs}),n.d(t,"VolumetricLightScatteringPostProcess",function(){return ws}),n.d(t,"VRDistortionCorrectionPostProcess",function(){return on}),n.d(t,"VRMultiviewToSingleviewPostProcess",function(){return hn}),n.d(t,"PostProcessRenderEffect",function(){return Za}),n.d(t,"PostProcessRenderPipeline",function(){return bs}),n.d(t,"PostProcessRenderPipelineManager",function(){return Es}),n.d(t,"PostProcessRenderPipelineManagerSceneComponent",function(){return xs}),n.d(t,"DefaultRenderingPipeline",function(){return Ts}),n.d(t,"LensRenderingPipeline",function(){return Ss}),n.d(t,"SSAO2RenderingPipeline",function(){return As}),n.d(t,"SSAORenderingPipeline",function(){return Ps}),n.d(t,"StandardRenderingPipeline",function(){return Rs}),n.d(t,"ReflectionProbe",function(){return io}),n.d(t,"BoundingBoxRenderer",function(){return Os}),n.d(t,"DepthRenderer",function(){return Is}),n.d(t,"DepthRendererSceneComponent",function(){return Ds}),n.d(t,"EdgesRenderer",function(){return Fs}),n.d(t,"LineEdgesRenderer",function(){return Ns}),n.d(t,"GeometryBufferRenderer",function(){return ms}),n.d(t,"GeometryBufferRendererSceneComponent",function(){return gs}),n.d(t,"OutlineRenderer",function(){return Bs}),n.d(t,"RenderingGroup",function(){return Us.a}),n.d(t,"RenderingGroupInfo",function(){return ln.a}),n.d(t,"RenderingManager",function(){return ln.b}),n.d(t,"UtilityLayerRenderer",function(){return Sr.a}),n.d(t,"Scene",function(){return W.a}),n.d(t,"SceneComponentConstants",function(){return Te.a}),n.d(t,"Stage",function(){return Te.b}),n.d(t,"Sprite",function(){return ks}),n.d(t,"SpriteManager",function(){return zs}),n.d(t,"SpriteSceneComponent",function(){return Vs}),n.d(t,"_AlphaState",function(){return js.a}),n.d(t,"_DepthCullingState",function(){return js.b}),n.d(t,"_StencilState",function(){return js.c}),n.d(t,"AndOrNotEvaluator",function(){return Hs.a}),n.d(t,"AssetTaskState",function(){return Gs}),n.d(t,"AbstractAssetTask",function(){return Xs}),n.d(t,"AssetsProgressEvent",function(){return Ys}),n.d(t,"MeshAssetTask",function(){return Ks}),n.d(t,"TextFileAssetTask",function(){return qs}),n.d(t,"BinaryFileAssetTask",function(){return Qs}),n.d(t,"ImageAssetTask",function(){return Zs}),n.d(t,"TextureAssetTask",function(){return Js}),n.d(t,"CubeTextureAssetTask",function(){return $s}),n.d(t,"HDRCubeTextureAssetTask",function(){return el}),n.d(t,"EquiRectangularCubeTextureAssetTask",function(){return tl}),n.d(t,"AssetsManager",function(){return nl}),n.d(t,"DDSTools",function(){return _i}),n.d(t,"expandToProperty",function(){return D.b}),n.d(t,"serialize",function(){return D.c}),n.d(t,"serializeAsTexture",function(){return D.m}),n.d(t,"serializeAsColor3",function(){return D.e}),n.d(t,"serializeAsFresnelParameters",function(){return D.h}),n.d(t,"serializeAsVector2",function(){return D.n}),n.d(t,"serializeAsVector3",function(){return D.o}),n.d(t,"serializeAsMeshReference",function(){return D.k}),n.d(t,"serializeAsColorCurves",function(){return D.g}),n.d(t,"serializeAsColor4",function(){return D.f}),n.d(t,"serializeAsImageProcessingConfiguration",function(){return D.i}),n.d(t,"serializeAsQuaternion",function(){return D.l}),n.d(t,"serializeAsMatrix",function(){return D.j}),n.d(t,"serializeAsCameraReference",function(){return D.d}),n.d(t,"SerializationHelper",function(){return D.a}),n.d(t,"Deferred",function(){return rl}),n.d(t,"EnvironmentTextureTools",function(){return yi}),n.d(t,"MeshExploder",function(){return il}),n.d(t,"FilesInput",function(){return ol}),n.d(t,"KhronosTextureContainer",function(){return Ei}),n.d(t,"EventState",function(){return i.a}),n.d(t,"Observer",function(){return i.d}),n.d(t,"MultiObserver",function(){return i.b}),n.d(t,"Observable",function(){return i.c}),n.d(t,"PerformanceMonitor",function(){return al.a}),n.d(t,"RollingAverage",function(){return al.b}),n.d(t,"PromisePolyfill",function(){return sl.a}),n.d(t,"SceneOptimization",function(){return ll}),n.d(t,"TextureOptimization",function(){return ul}),n.d(t,"HardwareScalingOptimization",function(){return cl}),n.d(t,"ShadowsOptimization",function(){return hl}),n.d(t,"PostProcessesOptimization",function(){return dl}),n.d(t,"LensFlaresOptimization",function(){return fl}),n.d(t,"CustomOptimization",function(){return pl}),n.d(t,"ParticlesOptimization",function(){return ml}),n.d(t,"RenderTargetsOptimization",function(){return gl}),n.d(t,"MergeMeshesOptimization",function(){return _l}),n.d(t,"SceneOptimizerOptions",function(){return vl}),n.d(t,"SceneOptimizer",function(){return yl}),n.d(t,"SceneSerializer",function(){return Tl}),n.d(t,"SmartArray",function(){return Gt.a}),n.d(t,"SmartArrayNoDuplicate",function(){return Gt.b}),n.d(t,"StringDictionary",function(){return gt.a}),n.d(t,"Tags",function(){return Sl.a}),n.d(t,"TextureTools",function(){return Al}),n.d(t,"TGATools",function(){return yo}),n.d(t,"ColorGradient",function(){return ye.c}),n.d(t,"Color3Gradient",function(){return ye.b}),n.d(t,"FactorGradient",function(){return ye.d}),n.d(t,"LoadFileError",function(){return ye.e}),n.d(t,"RetryStrategy",function(){return ye.g}),n.d(t,"Tools",function(){return ye.h}),n.d(t,"PerfCounter",function(){return ye.f}),n.d(t,"className",function(){return ye.i}),n.d(t,"AsyncLoop",function(){return ye.a}),n.d(t,"VideoRecorder",function(){return Pl}),n.d(t,"JoystickAxis",function(){return mt}),n.d(t,"VirtualJoystick",function(){return _t}),n.d(t,"WorkerPool",function(){return Oo}),n.d(t,"Logger",function(){return p.a}),n.d(t,"_TypeStore",function(){return a.a}),n.d(t,"FilesInputStore",function(){return cr.a}),n.d(t,"DeepCopier",function(){return M.a}),n.d(t,"PivotTools",function(){return Be.a}),n.d(t,"PrecisionDate",function(){return X.a}),n.d(t,"ScreenshotTools",function(){return Ml}),n.d(t,"WebRequest",function(){return So.a}),n.d(t,"InspectableType",function(){return Ws}),n.d(t,"CubeMapToSphericalPolynomialTools",function(){return hi.a}),n.d(t,"HDRTools",function(){return Wi}),n.d(t,"PanoramaToCubeMapTools",function(){return Hi})},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogFragmentDeclaration="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogFragment="#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogVertexDeclaration="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.morphTargetsVertexGlobalDeclaration="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.morphTargetsVertexDeclaration="#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.morphTargetsVertex="#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif"},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.Eval=function(t,n){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,n)}):e._HandleParenthesisContent(t,n))||"false"!==t&&e.Eval(t,n)},e._HandleParenthesisContent=function(t,n){var r;n=n||function(e){return"true"===e};var i=t.split("||");for(var o in i)if(i.hasOwnProperty(o)){var a=e._SimplifyNegation(i[o].trim()),s=a.split("&&");if(s.length>1)for(var l=0;l<s.length;++l){var u=e._SimplifyNegation(s[l].trim());if(!(r="true"!==u&&"false"!==u?"!"===u[0]?!n(u.substring(1)):n(u):"true"===u)){a="false";break}}if(r||"true"===a){r=!0;break}r="true"!==a&&"false"!==a?"!"===a[0]?!n(a.substring(1)):n(a):"true"===a}return r?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,function(e){return(e=e.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?e="false":"!false"===e&&(e="true"),e},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n(47),i=function(){function e(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new o(e)}return e.prototype.sampleFrame=function(e){if(void 0===e&&(e=r.a.Now),this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},e}(),o=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var n=this._samples[this._pos];t=n-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(n-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r,i=n(9);!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(r||(r={}));var o=function(){this.count=0,this.target=0,this.results=[]},a=function(){function e(e){var t=this;if(this._state=r.Pending,this._children=new Array,this._rejectWasConsumed=!1,e)try{e(function(e){t._resolve(e)},function(e){t._reject(e)})}catch(e){this._reject(e)}}return Object.defineProperty(e.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!0,configurable:!0}),e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype.then=function(t,n){var o=this,a=new e;return a._onFulfilled=t,a._onRejected=n,this._children.push(a),a._parent=this,this._state!==r.Pending&&i.h.SetImmediate(function(){if(o._state===r.Fulfilled||o._rejectWasConsumed){var e=a._resolve(o._result);if(null!=e)if(void 0!==e._state){var t=e;a._children.push(t),t._parent=a,a=t}else a._result=e}else a._reject(o._reason)}),a},e.prototype._moveChildren=function(e){var t,n=this;if((t=this._children).push.apply(t,e.splice(0,e.length)),this._children.forEach(function(e){e._parent=n}),this._state===r.Fulfilled)for(var i=0,o=this._children;i<o.length;i++)o[i]._resolve(this._result);else if(this._state===r.Rejected)for(var a=0,s=this._children;a<s.length;a++)s[a]._reject(this._reason)},e.prototype._resolve=function(e){try{this._state=r.Fulfilled;var t=null;if(this._onFulfilled&&(t=this._onFulfilled(e)),null!=t)if(void 0!==t._state){var n=t;n._parent=this,n._moveChildren(this._children),e=n._result}else e=t;this._result=e;for(var i=0,o=this._children;i<o.length;i++)o[i]._resolve(e);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(e){this._reject(e,!0)}},e.prototype._reject=function(e,t){if(void 0===t&&(t=!1),this._state=r.Rejected,this._reason=e,this._onRejected&&!t)try{this._onRejected(e),this._rejectWasConsumed=!0}catch(t){e=t}for(var n=0,i=this._children;n<i.length;n++){var o=i[n];this._rejectWasConsumed?o._resolve(null):o._reject(e)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},e.resolve=function(t){var n=new e;return n._resolve(t),n},e._RegisterForFulfillment=function(e,t,n){e.then(function(e){return t.results[n]=e,t.count++,t.count===t.target&&t.rootPromise._resolve(t.results),null},function(e){t.rootPromise._state!==r.Rejected&&t.rootPromise._reject(e)})},e.all=function(t){var n=new e,r=new o;if(r.target=t.length,r.rootPromise=n,t.length)for(var i=0;i<t.length;i++)e._RegisterForFulfillment(t[i],r,i);else n._resolve([]);return n},e.race=function(t){var n=new e;if(t.length)for(var r=0,i=t;r<i.length;r++)i[r].then(function(e){return n&&(n._resolve(e),n=null),null},function(e){n&&(n._reject(e),n=null)});return n},e}(),s=function(){function e(){}return e.Apply=function(e){void 0===e&&(e=!1),(e||"undefined"==typeof Promise)&&(window.Promise=a)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._collider=null,this._oldPositionForCollisions=new r.x(0,0,0),this._diffPositionForCollisions=new r.x(0,0,0)}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(28),i=n(0),o=n(3),a=function(){function e(e,t,n,i,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=null),this.index=e,this._opaqueSubMeshes=new r.a(256),this._transparentSubMeshes=new r.a(256),this._alphaTestSubMeshes=new r.a(256),this._depthOnlySubMeshes=new r.a(256),this._particleSystems=new r.a(256),this._spriteManagers=new r.a(256),this._edgesRenderers=new r.a(16),this._scene=t,this.opaqueSortCompareFn=n,this.alphaTestSortCompareFn=i,this.transparentSortCompareFn=o}return Object.defineProperty(e.prototype,"opaqueSortCompareFn",{set:function(t){this._opaqueSortCompareFn=t,this._renderOpaque=t?this.renderOpaqueSorted:e.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaTestSortCompareFn",{set:function(t){this._alphaTestSortCompareFn=t,this._renderAlphaTest=t?this.renderAlphaTestSorted:e.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transparentSortCompareFn",{set:function(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),e.prototype.render=function(e,t,n,r){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var i=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(i.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),i.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var a=i.getStencilBuffer();if(i.setStencilBuffer(!1),t&&this._renderSprites(),n&&this._renderParticles(r),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),i.setAlphaMode(o.a.ALPHA_DISABLE)),i.setStencilBuffer(!1),this._edgesRenderers.length){for(var s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();i.setAlphaMode(o.a.ALPHA_DISABLE)}i.setStencilBuffer(a)}},e.prototype.renderOpaqueSorted=function(t){return e.renderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderAlphaTestSorted=function(t){return e.renderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderTransparentSorted=function(t){return e.renderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},e.renderSorted=function(e,t,n,r){for(var a,s=0,l=n?n.globalPosition:i.x.Zero();s<e.length;s++)(a=e.data[s])._alphaIndex=a.getMesh().alphaIndex,a._distanceToCamera=a.getBoundingInfo().boundingSphere.centerWorld.subtract(l).length();var u=e.data.slice(0,e.length);for(t&&u.sort(t),s=0;s<u.length;s++){if(a=u[s],r){var c=a.getMaterial();if(c&&c.needDepthPrePass){var h=c.getScene().getEngine();h.setColorWrite(!1),h.setAlphaMode(o.a.ALPHA_DISABLE),a.render(!1),h.setColorWrite(!0)}}a.render(r)}},e.renderUnsorted=function(e){for(var t=0;t<e.length;t++)e.data[t].render(!1)},e.defaultTransparentSortCompare=function(t,n){return t._alphaIndex>n._alphaIndex?1:t._alphaIndex<n._alphaIndex?-1:e.backToFrontSortCompare(t,n)},e.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},e.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},e.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},e.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},e.prototype.dispatch=function(e,t,n){void 0===t&&(t=e.getMesh()),void 0===n&&(n=e.getMaterial()),null!=n&&(n.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):n.needAlphaTesting()?(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(n.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.push(t._edgesRenderer))},e.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},e.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},e.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var n=0;n<this._particleSystems.length;n++){var r=this._particleSystems.data[n];if(0!==(t&&t.layerMask&r.layerMask)){var i=r.emitter;i.position&&e&&-1===e.indexOf(i)||this._scene._activeParticles.addCount(r.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},e.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var n=this._spriteManagers.data[t];0!==(e&&e.layerMask&n.layerMask)&&n.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t){this.distance=e,this.mesh=t}},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(1),i=n(0),o=n(6),a=n(24),s=n(11),l=n(32),u=n(42);s.a._instancedMeshFactory=function(e,t){return new c(e,t)};var c=function(e){function t(t,n){var r=e.call(this,t,n.getScene())||this;return r._indexInSourceMeshInstanceArray=-1,n.addInstance(r),r._sourceMesh=n,r.position.copyFrom(n.position),r.rotation.copyFrom(n.rotation),r.scaling.copyFrom(n.scaling),n.rotationQuaternion&&(r.rotationQuaternion=n.rotationQuaternion.clone()),r.infiniteDistance=n.infiniteDistance,r.setPivotMatrix(n.getPivotMatrix()),r.refreshBoundingInfo(),r._syncSubMeshes(),r}return r.d(t,e),t.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),t.prototype._resyncLightSources=function(){},t.prototype._resyncLighSource=function(e){},t.prototype._removeLightSource=function(e){},Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&o.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},t.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(t.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},t.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},t.prototype.setVerticesData=function(e,t,n,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,n,r),this.sourceMesh},t.prototype.updateVerticesData=function(e,t,n,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,n,r),this.sourceMesh},t.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},t.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},t.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},t.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},t.prototype._activate=function(e,t){if(this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0;return!1},t.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},t.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==u.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var t=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,i.t.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD._masterMesh=t,i.t.Matrix[0]}return e.prototype.getWorldMatrix.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},t.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},t.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},t.prototype.clone=function(e,t,n){var r=this._sourceMesh.createInstance(e);if(l.a.DeepCopy(this,r,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!n)for(var i=0;i<this.getScene().meshes.length;i++){var o=this.getScene().meshes[i];o.parent===this&&o.clone(o.name,r)}return r.computeWorldMatrix(!0),r},t.prototype.dispose=function(t,n){void 0===n&&(n=!1),this._sourceMesh.removeInstance(this),e.prototype.dispose.call(this,t,n)},t}(a.a)},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.shadowsFragmentFunctions="#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#ifdef WEBGL2\n\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat shadow=texture2D(shadowSampler,uvDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\n\n\nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n\n\n\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;\nuv+=0.5;\nvec2 st=fract(uv);\nvec2 base_uv=floor(uv)-0.5;\nbase_uv*=shadowMapSizeAndInverse.y;\n\n\nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n\n\n\n\n\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\n\nfloat AAOffset=shadowMapSizeInverse*10.;\n\n\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\n\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\n\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\n\nshadow=mix(darkness,1.,shadow);\n\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#endif\n#endif\n"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.reflectionFunction="#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\n\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\n\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\n\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\n\nvec3 intersectPositionWS=vertexPos+origVec*distance;\n\nreturn intersectPositionWS-cubePos;\n}\n#endif\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=normalize(worldPos.xyz-vEyePosition.xyz);\n\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,vReflectionSize,vReflectionPosition);\n#endif\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vec3(reflectionMatrix*vec4(vPositionUVW,0));\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightFragment="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);\n#endif\n\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicTangent,anisotropicBitangent,anisotropy,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\n\npreInfo.roughness=sheenIntensity;\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n\n#ifdef CLEARCOAT\n\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearCoatRoughness,light{X}.vLightDiffuse.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearCoatNormalW,clearCoatAARoughnessFactors.x,clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\n\nabsorption=computeClearCoatLightingAbsorption(clearCoatNdotVRefract,preInfo.L,clearCoatNormalW,clearCoatColor,clearCoatThickness,clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\n\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w*info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w*info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.logDepthFragment="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.fogVertex="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.shadowsVertex="#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.logDepthVertex="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif"},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.lightsFragmentFunctions="\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpFragmentFunctions="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#endif\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv,sampler2D textureSampler,float scale)\n{\nvec3 map=texture2D(textureSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nreturn perturbNormal(cotangentFrame,uv,bumpSampler,vBumpInfos.y);\n}\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\nreturn cotangent_frame(normal,p,uv,vTangentSpaceParams);\n}\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpFragment="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else\nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#else\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.depthPrePass="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpVertexDeclaration="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvarying mat3 vTBN;\n#endif\n#endif\n"},function(e,t,n){"use strict";n(5).a.IncludesShadersStore.bumpVertex="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif"},function(e,t,n){"use strict";var r=n(5),i=(n(95),n(89),"colorPixelShader");r.a.ShadersStore[i]="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}"},function(e,t,n){"use strict";var r=n(5),i=(n(67),n(96),n(68),n(69),n(70),n(90),"colorVertexShader");r.a.ShadersStore[i]="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}"},function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return c}),n.d(t,"a",function(){return h});var r=n(1),i=n(6),o=n(10),a=n(92),s=n(26),l=n(3),u=n(78),c=function(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4},h=function(t){function n(n){void 0===n&&(n=new c);var r=t.call(this,null)||this;void 0===n.deterministicLockstep&&(n.deterministicLockstep=!1),void 0===n.lockstepMaxSteps&&(n.lockstepMaxSteps=4),r._options=n,r._caps=new o.c,r._caps.maxTexturesImageUnits=16,r._caps.maxVertexTextureImageUnits=16,r._caps.maxTextureSize=512,r._caps.maxCubemapTextureSize=512,r._caps.maxRenderTextureSize=512,r._caps.maxVertexAttribs=16,r._caps.maxVaryingVectors=16,r._caps.maxFragmentUniformVectors=16,r._caps.maxVertexUniformVectors=16,r._caps.standardDerivatives=!1,r._caps.astc=null,r._caps.s3tc=null,r._caps.pvrtc=null,r._caps.etc1=null,r._caps.etc2=null,r._caps.textureAnisotropicFilterExtension=null,r._caps.maxAnisotropy=0,r._caps.uintIndices=!1,r._caps.fragmentDepthSupported=!1,r._caps.highPrecisionShaderSupported=!0,r._caps.colorBufferFloat=!1,r._caps.textureFloat=!1,r._caps.textureFloatLinearFiltering=!1,r._caps.textureFloatRender=!1,r._caps.textureHalfFloat=!1,r._caps.textureHalfFloatLinearFiltering=!1,r._caps.textureHalfFloatRender=!1,r._caps.textureLOD=!1,r._caps.drawBuffersExtension=!1,r._caps.depthTextureExtension=!1,r._caps.vertexArrayObject=!1,r._caps.instancedArrays=!1,i.a.Log("Babylon.js v"+o.b.Version+" - Null engine");var a="undefined"!=typeof self?self:void 0!==e?e:window;return"undefined"==typeof URL&&(a.URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(a.Blob=function(){}),r}return r.d(n,t),n.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},n.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},n.prototype.getHardwareScalingLevel=function(){return 1},n.prototype.createVertexBuffer=function(e){var t=new u.a;return t.references=1,t},n.prototype.createIndexBuffer=function(e){var t=new u.a;return t.references=1,t},n.prototype.clear=function(e,t,n,r){void 0===r&&(r=!1)},n.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},n.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},n.prototype.setViewport=function(e,t,n){this._cachedViewport=e},n.prototype.createShaderProgram=function(e,t,n,r,i){return{__SPECTOR_rebuildProgram:null}},n.prototype.getUniforms=function(e,t){return[]},n.prototype.getAttributes=function(e,t){return[]},n.prototype.bindSamplers=function(e){this._currentEffect=null},n.prototype.enableEffect=function(e){this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e)},n.prototype.setState=function(e,t,n,r){void 0===t&&(t=0),void 0===r&&(r=!1)},n.prototype.setIntArray=function(e,t){},n.prototype.setIntArray2=function(e,t){},n.prototype.setIntArray3=function(e,t){},n.prototype.setIntArray4=function(e,t){},n.prototype.setFloatArray=function(e,t){},n.prototype.setFloatArray2=function(e,t){},n.prototype.setFloatArray3=function(e,t){},n.prototype.setFloatArray4=function(e,t){},n.prototype.setArray=function(e,t){},n.prototype.setArray2=function(e,t){},n.prototype.setArray3=function(e,t){},n.prototype.setArray4=function(e,t){},n.prototype.setMatrices=function(e,t){},n.prototype.setMatrix=function(e,t){},n.prototype.setMatrix3x3=function(e,t){},n.prototype.setMatrix2x2=function(e,t){},n.prototype.setFloat=function(e,t){},n.prototype.setFloat2=function(e,t,n){},n.prototype.setFloat3=function(e,t,n,r){},n.prototype.setBool=function(e,t){},n.prototype.setFloat4=function(e,t,n,r,i){},n.prototype.setColor3=function(e,t){},n.prototype.setColor4=function(e,t,n){},n.prototype.setAlphaMode=function(e,t){void 0===t&&(t=!1),this._alphaMode!==e&&(this._alphaState.alphaBlend=e!==l.a.ALPHA_DISABLE,t||this.setDepthWrite(e===l.a.ALPHA_DISABLE),this._alphaMode=e)},n.prototype.bindBuffers=function(e,t,n){},n.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},n.prototype.draw=function(e,t,n,r){},n.prototype.drawElementsType=function(e,t,n,r){},n.prototype.drawArraysType=function(e,t,n,r){},n.prototype._createTexture=function(){return{}},n.prototype._releaseTexture=function(e){},n.prototype.createTexture=function(e,t,n,r,i,o,a,u,c,h){void 0===i&&(i=l.a.TEXTURE_TRILINEAR_SAMPLINGMODE),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null);var d=new s.a(this,s.a.DATASOURCE_URL),f=String(e);return d.url=f,d.generateMipMaps=!t,d.samplingMode=i,d.invertY=n,d.baseWidth=this._options.textureSize,d.baseHeight=this._options.textureSize,d.width=this._options.textureSize,d.height=this._options.textureSize,h&&(d.format=h),d.isReady=!0,o&&o(),this._internalTexturesCache.push(d),d},n.prototype.createRenderTargetTexture=function(e,t){var n=new a.a;void 0!==t&&"object"==typeof t?(n.generateMipMaps=t.generateMipMaps,n.generateDepthBuffer=void 0===t.generateDepthBuffer||t.generateDepthBuffer,n.generateStencilBuffer=n.generateDepthBuffer&&t.generateStencilBuffer,n.type=void 0===t.type?l.a.TEXTURETYPE_UNSIGNED_INT:t.type,n.samplingMode=void 0===t.samplingMode?l.a.TEXTURE_TRILINEAR_SAMPLINGMODE:t.samplingMode):(n.generateMipMaps=t,n.generateDepthBuffer=!0,n.generateStencilBuffer=!1,n.type=l.a.TEXTURETYPE_UNSIGNED_INT,n.samplingMode=l.a.TEXTURE_TRILINEAR_SAMPLINGMODE);var r=new s.a(this,s.a.DATASOURCE_RENDERTARGET),i=e.width||e,o=e.height||e;return r._depthStencilBuffer={},r._framebuffer={},r.baseWidth=i,r.baseHeight=o,r.width=i,r.height=o,r.isReady=!0,r.samples=1,r.generateMipMaps=!!n.generateMipMaps,r.samplingMode=n.samplingMode,r.type=n.type,r._generateDepthBuffer=n.generateDepthBuffer,r._generateStencilBuffer=!!n.generateStencilBuffer,this._internalTexturesCache.push(r),r},n.prototype.updateTextureSamplingMode=function(e,t){t.samplingMode=e},n.prototype.bindFramebuffer=function(e,t,n,r,i){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._currentFramebuffer=e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer,this._cachedViewport&&!i&&this.setViewport(this._cachedViewport,n,r)},n.prototype.unBindFramebuffer=function(e,t,n){void 0===t&&(t=!1),this._currentRenderTarget=null,n&&(e._MSAAFramebuffer&&(this._currentFramebuffer=e._framebuffer),n()),this._currentFramebuffer=null},n.prototype.createDynamicVertexBuffer=function(e){var t=new u.a;return t.references=1,t.capacity=1,t},n.prototype.updateDynamicTexture=function(e,t,n,r,i){void 0===r&&(r=!1)},n.prototype.areAllEffectsReady=function(){return!0},n.prototype.getError=function(){return 0},n.prototype._getUnpackAlignement=function(){return 1},n.prototype._unpackFlipY=function(e){},n.prototype.updateDynamicIndexBuffer=function(e,t,n){void 0===n&&(n=0)},n.prototype.updateDynamicVertexBuffer=function(e,t,n,r){},n.prototype._bindTextureDirectly=function(e,t){return this._boundTexturesCache[this._activeChannel]!==t&&(this._boundTexturesCache[this._activeChannel]=t,!0)},n.prototype._bindTexture=function(e,t){e<0||this._bindTextureDirectly(0,t)},n.prototype._releaseBuffer=function(e){return e.references--,0===e.references},n.prototype.releaseEffects=function(){},n.prototype.displayLoadingUI=function(){},n.prototype.hideLoadingUI=function(){},n.prototype._uploadCompressedDataToTextureDirectly=function(e,t,n,r,i,o,a){void 0===o&&(o=0),void 0===a&&(a=0)},n.prototype._uploadDataToTextureDirectly=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0)},n.prototype._uploadArrayBufferViewToTexture=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0)},n.prototype._uploadImageToTexture=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0)},n}(o.b)}).call(this,n(119))},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"Debug",function(){return u});var r=n(97),i=n(74);n.d(t,"AbstractScene",function(){return r.AbstractScene}),n.d(t,"KeepAssets",function(){return r.KeepAssets}),n.d(t,"AssetContainer",function(){return r.AssetContainer}),n.d(t,"Node",function(){return r.Node}),n.d(t,"Scene",function(){return r.Scene}),n.d(t,"SceneComponentConstants",function(){return r.SceneComponentConstants}),n.d(t,"Stage",function(){return r.Stage}),n.d(t,"Action",function(){return r.Action}),n.d(t,"ActionEvent",function(){return r.ActionEvent}),n.d(t,"ActionManager",function(){return r.ActionManager}),n.d(t,"Condition",function(){return r.Condition}),n.d(t,"ValueCondition",function(){return r.ValueCondition}),n.d(t,"PredicateCondition",function(){return r.PredicateCondition}),n.d(t,"StateCondition",function(){return r.StateCondition}),n.d(t,"SwitchBooleanAction",function(){return r.SwitchBooleanAction}),n.d(t,"SetStateAction",function(){return r.SetStateAction}),n.d(t,"SetValueAction",function(){return r.SetValueAction}),n.d(t,"IncrementValueAction",function(){return r.IncrementValueAction}),n.d(t,"PlayAnimationAction",function(){return r.PlayAnimationAction}),n.d(t,"StopAnimationAction",function(){return r.StopAnimationAction}),n.d(t,"DoNothingAction",function(){return r.DoNothingAction}),n.d(t,"CombineAction",function(){return r.CombineAction}),n.d(t,"ExecuteCodeAction",function(){return r.ExecuteCodeAction}),n.d(t,"SetParentAction",function(){return r.SetParentAction}),n.d(t,"PlaySoundAction",function(){return r.PlaySoundAction}),n.d(t,"StopSoundAction",function(){return r.StopSoundAction}),n.d(t,"InterpolateValueAction",function(){return r.InterpolateValueAction}),n.d(t,"Animatable",function(){return r.Animatable}),n.d(t,"_IAnimationState",function(){return r._IAnimationState}),n.d(t,"Animation",function(){return r.Animation}),n.d(t,"TargetedAnimation",function(){return r.TargetedAnimation}),n.d(t,"AnimationGroup",function(){return r.AnimationGroup}),n.d(t,"AnimationPropertiesOverride",function(){return r.AnimationPropertiesOverride}),n.d(t,"EasingFunction",function(){return r.EasingFunction}),n.d(t,"CircleEase",function(){return r.CircleEase}),n.d(t,"BackEase",function(){return r.BackEase}),n.d(t,"BounceEase",function(){return r.BounceEase}),n.d(t,"CubicEase",function(){return r.CubicEase}),n.d(t,"ElasticEase",function(){return r.ElasticEase}),n.d(t,"ExponentialEase",function(){return r.ExponentialEase}),n.d(t,"PowerEase",function(){return r.PowerEase}),n.d(t,"QuadraticEase",function(){return r.QuadraticEase}),n.d(t,"QuarticEase",function(){return r.QuarticEase}),n.d(t,"QuinticEase",function(){return r.QuinticEase}),n.d(t,"SineEase",function(){return r.SineEase}),n.d(t,"BezierCurveEase",function(){return r.BezierCurveEase}),n.d(t,"RuntimeAnimation",function(){return r.RuntimeAnimation}),n.d(t,"AnimationEvent",function(){return r.AnimationEvent}),n.d(t,"AnimationKeyInterpolation",function(){return r.AnimationKeyInterpolation}),n.d(t,"AnimationRange",function(){return r.AnimationRange}),n.d(t,"Analyser",function(){return r.Analyser}),n.d(t,"AudioEngine",function(){return r.AudioEngine}),n.d(t,"AudioSceneComponent",function(){return r.AudioSceneComponent}),n.d(t,"Sound",function(){return r.Sound}),n.d(t,"SoundTrack",function(){return r.SoundTrack}),n.d(t,"WeightedSound",function(){return r.WeightedSound}),n.d(t,"Bone",function(){return r.Bone}),n.d(t,"BoneIKController",function(){return r.BoneIKController}),n.d(t,"BoneLookController",function(){return r.BoneLookController}),n.d(t,"Skeleton",function(){return r.Skeleton}),n.d(t,"CameraInputTypes",function(){return r.CameraInputTypes}),n.d(t,"CameraInputsManager",function(){return r.CameraInputsManager}),n.d(t,"Camera",function(){return r.Camera}),n.d(t,"TargetCamera",function(){return r.TargetCamera}),n.d(t,"FreeCamera",function(){return r.FreeCamera}),n.d(t,"FreeCameraInputsManager",function(){return r.FreeCameraInputsManager}),n.d(t,"TouchCamera",function(){return r.TouchCamera}),n.d(t,"ArcRotateCamera",function(){return r.ArcRotateCamera}),n.d(t,"ArcRotateCameraInputsManager",function(){return r.ArcRotateCameraInputsManager}),n.d(t,"DeviceOrientationCamera",function(){return r.DeviceOrientationCamera}),n.d(t,"FlyCamera",function(){return r.FlyCamera}),n.d(t,"FlyCameraInputsManager",function(){return r.FlyCameraInputsManager}),n.d(t,"FollowCamera",function(){return r.FollowCamera}),n.d(t,"ArcFollowCamera",function(){return r.ArcFollowCamera}),n.d(t,"GamepadCamera",function(){return r.GamepadCamera}),n.d(t,"UniversalCamera",function(){return r.UniversalCamera}),n.d(t,"VirtualJoysticksCamera",function(){return r.VirtualJoysticksCamera}),n.d(t,"Collider",function(){return r.Collider}),n.d(t,"DefaultCollisionCoordinator",function(){return r.DefaultCollisionCoordinator}),n.d(t,"PickingInfo",function(){return r.PickingInfo}),n.d(t,"IntersectionInfo",function(){return r.IntersectionInfo}),n.d(t,"_MeshCollisionData",function(){return r._MeshCollisionData}),n.d(t,"BoundingBox",function(){return r.BoundingBox}),n.d(t,"BoundingInfo",function(){return r.BoundingInfo}),n.d(t,"BoundingSphere",function(){return r.BoundingSphere}),n.d(t,"Ray",function(){return r.Ray}),n.d(t,"AxesViewer",function(){return r.AxesViewer}),n.d(t,"BoneAxesViewer",function(){return r.BoneAxesViewer}),n.d(t,"DebugLayer",function(){return r.DebugLayer}),n.d(t,"PhysicsViewer",function(){return r.PhysicsViewer}),n.d(t,"RayHelper",function(){return r.RayHelper}),n.d(t,"SkeletonViewer",function(){return r.SkeletonViewer}),n.d(t,"Constants",function(){return r.Constants}),n.d(t,"InstancingAttributeInfo",function(){return r.InstancingAttributeInfo}),n.d(t,"DepthTextureCreationOptions",function(){return r.DepthTextureCreationOptions}),n.d(t,"EngineCapabilities",function(){return r.EngineCapabilities}),n.d(t,"Engine",function(){return r.Engine}),n.d(t,"EngineStore",function(){return r.EngineStore}),n.d(t,"NullEngineOptions",function(){return r.NullEngineOptions}),n.d(t,"NullEngine",function(){return r.NullEngine}),n.d(t,"WebGLPipelineContext",function(){return r.WebGLPipelineContext}),n.d(t,"KeyboardEventTypes",function(){return r.KeyboardEventTypes}),n.d(t,"KeyboardInfo",function(){return r.KeyboardInfo}),n.d(t,"KeyboardInfoPre",function(){return r.KeyboardInfoPre}),n.d(t,"PointerEventTypes",function(){return r.PointerEventTypes}),n.d(t,"PointerInfoBase",function(){return r.PointerInfoBase}),n.d(t,"PointerInfoPre",function(){return r.PointerInfoPre}),n.d(t,"PointerInfo",function(){return r.PointerInfo}),n.d(t,"ClipboardEventTypes",function(){return r.ClipboardEventTypes}),n.d(t,"ClipboardInfo",function(){return r.ClipboardInfo}),n.d(t,"DaydreamController",function(){return r.DaydreamController}),n.d(t,"GearVRController",function(){return r.GearVRController}),n.d(t,"GenericController",function(){return r.GenericController}),n.d(t,"OculusTouchController",function(){return r.OculusTouchController}),n.d(t,"PoseEnabledControllerType",function(){return r.PoseEnabledControllerType}),n.d(t,"PoseEnabledControllerHelper",function(){return r.PoseEnabledControllerHelper}),n.d(t,"PoseEnabledController",function(){return r.PoseEnabledController}),n.d(t,"ViveController",function(){return r.ViveController}),n.d(t,"WebVRController",function(){return r.WebVRController}),n.d(t,"WindowsMotionController",function(){return r.WindowsMotionController}),n.d(t,"StickValues",function(){return r.StickValues}),n.d(t,"Gamepad",function(){return r.Gamepad}),n.d(t,"GenericPad",function(){return r.GenericPad}),n.d(t,"GamepadManager",function(){return r.GamepadManager}),n.d(t,"GamepadSystemSceneComponent",function(){return r.GamepadSystemSceneComponent}),n.d(t,"Xbox360Button",function(){return r.Xbox360Button}),n.d(t,"Xbox360Dpad",function(){return r.Xbox360Dpad}),n.d(t,"Xbox360Pad",function(){return r.Xbox360Pad}),n.d(t,"AxisDragGizmo",function(){return r.AxisDragGizmo}),n.d(t,"AxisScaleGizmo",function(){return r.AxisScaleGizmo}),n.d(t,"BoundingBoxGizmo",function(){return r.BoundingBoxGizmo}),n.d(t,"Gizmo",function(){return r.Gizmo}),n.d(t,"GizmoManager",function(){return r.GizmoManager}),n.d(t,"PlaneRotationGizmo",function(){return r.PlaneRotationGizmo}),n.d(t,"PositionGizmo",function(){return r.PositionGizmo}),n.d(t,"RotationGizmo",function(){return r.RotationGizmo}),n.d(t,"ScaleGizmo",function(){return r.ScaleGizmo}),n.d(t,"LightGizmo",function(){return r.LightGizmo}),n.d(t,"EnvironmentHelper",function(){return r.EnvironmentHelper}),n.d(t,"PhotoDome",function(){return r.PhotoDome}),n.d(t,"_forceSceneHelpersToBundle",function(){return r._forceSceneHelpersToBundle}),n.d(t,"VideoDome",function(){return r.VideoDome}),n.d(t,"EngineInstrumentation",function(){return r.EngineInstrumentation}),n.d(t,"SceneInstrumentation",function(){return r.SceneInstrumentation}),n.d(t,"_TimeToken",function(){return r._TimeToken}),n.d(t,"EffectLayer",function(){return r.EffectLayer}),n.d(t,"EffectLayerSceneComponent",function(){return r.EffectLayerSceneComponent}),n.d(t,"GlowLayer",function(){return r.GlowLayer}),n.d(t,"HighlightLayer",function(){return r.HighlightLayer}),n.d(t,"Layer",function(){return r.Layer}),n.d(t,"LayerSceneComponent",function(){return r.LayerSceneComponent}),n.d(t,"LensFlare",function(){return r.LensFlare}),n.d(t,"LensFlareSystem",function(){return r.LensFlareSystem}),n.d(t,"LensFlareSystemSceneComponent",function(){return r.LensFlareSystemSceneComponent}),n.d(t,"Light",function(){return r.Light}),n.d(t,"ShadowLight",function(){return r.ShadowLight}),n.d(t,"DirectionalLight",function(){return r.DirectionalLight}),n.d(t,"HemisphericLight",function(){return r.HemisphericLight}),n.d(t,"PointLight",function(){return r.PointLight}),n.d(t,"SpotLight",function(){return r.SpotLight}),n.d(t,"DefaultLoadingScreen",function(){return r.DefaultLoadingScreen}),n.d(t,"SceneLoaderProgressEvent",function(){return r.SceneLoaderProgressEvent}),n.d(t,"SceneLoader",function(){return r.SceneLoader}),n.d(t,"SceneLoaderFlags",function(){return r.SceneLoaderFlags}),n.d(t,"ColorCurves",function(){return r.ColorCurves}),n.d(t,"EffectFallbacks",function(){return r.EffectFallbacks}),n.d(t,"EffectCreationOptions",function(){return r.EffectCreationOptions}),n.d(t,"Effect",function(){return r.Effect}),n.d(t,"FresnelParameters",function(){return r.FresnelParameters}),n.d(t,"ImageProcessingConfigurationDefines",function(){return r.ImageProcessingConfigurationDefines}),n.d(t,"ImageProcessingConfiguration",function(){return r.ImageProcessingConfiguration}),n.d(t,"Material",function(){return r.Material}),n.d(t,"MaterialDefines",function(){return r.MaterialDefines}),n.d(t,"MaterialHelper",function(){return r.MaterialHelper}),n.d(t,"MultiMaterial",function(){return r.MultiMaterial}),n.d(t,"PushMaterial",function(){return r.PushMaterial}),n.d(t,"ShaderMaterial",function(){return r.ShaderMaterial}),n.d(t,"StandardMaterialDefines",function(){return r.StandardMaterialDefines}),n.d(t,"StandardMaterial",function(){return r.StandardMaterial}),n.d(t,"BaseTexture",function(){return r.BaseTexture}),n.d(t,"CubeTexture",function(){return r.CubeTexture}),n.d(t,"EquiRectangularCubeTexture",function(){return r.EquiRectangularCubeTexture}),n.d(t,"HDRCubeTexture",function(){return r.HDRCubeTexture}),n.d(t,"InternalTexture",function(){return r.InternalTexture}),n.d(t,"MirrorTexture",function(){return r.MirrorTexture}),n.d(t,"MultiRenderTarget",function(){return r.MultiRenderTarget}),n.d(t,"RenderTargetTexture",function(){return r.RenderTargetTexture}),n.d(t,"Texture",function(){return r.Texture}),n.d(t,"UniformBuffer",function(){return r.UniformBuffer}),n.d(t,"MaterialFlags",function(){return r.MaterialFlags}),n.d(t,"Scalar",function(){return r.Scalar}),n.d(t,"ToGammaSpace",function(){return r.ToGammaSpace}),n.d(t,"ToLinearSpace",function(){return r.ToLinearSpace}),n.d(t,"Epsilon",function(){return r.Epsilon}),n.d(t,"Color3",function(){return r.Color3}),n.d(t,"Color4",function(){return r.Color4}),n.d(t,"Vector2",function(){return r.Vector2}),n.d(t,"Vector3",function(){return r.Vector3}),n.d(t,"Vector4",function(){return r.Vector4}),n.d(t,"Size",function(){return r.Size}),n.d(t,"Quaternion",function(){return r.Quaternion}),n.d(t,"Matrix",function(){return r.Matrix}),n.d(t,"Plane",function(){return r.Plane}),n.d(t,"Viewport",function(){return r.Viewport}),n.d(t,"Frustum",function(){return r.Frustum}),n.d(t,"Space",function(){return r.Space}),n.d(t,"Axis",function(){return r.Axis}),n.d(t,"BezierCurve",function(){return r.BezierCurve}),n.d(t,"Orientation",function(){return r.Orientation}),n.d(t,"Angle",function(){return r.Angle}),n.d(t,"Arc2",function(){return r.Arc2}),n.d(t,"Path2",function(){return r.Path2}),n.d(t,"Path3D",function(){return r.Path3D}),n.d(t,"Curve3",function(){return r.Curve3}),n.d(t,"PositionNormalVertex",function(){return r.PositionNormalVertex}),n.d(t,"PositionNormalTextureVertex",function(){return r.PositionNormalTextureVertex}),n.d(t,"Tmp",function(){return r.Tmp}),n.d(t,"SphericalHarmonics",function(){return r.SphericalHarmonics}),n.d(t,"SphericalPolynomial",function(){return r.SphericalPolynomial}),n.d(t,"AbstractMesh",function(){return r.AbstractMesh}),n.d(t,"Buffer",function(){return r.Buffer}),n.d(t,"VertexBuffer",function(){return r.VertexBuffer}),n.d(t,"CSG",function(){return r.CSG}),n.d(t,"Geometry",function(){return r.Geometry}),n.d(t,"GroundMesh",function(){return r.GroundMesh}),n.d(t,"TrailMesh",function(){return r.TrailMesh}),n.d(t,"InstancedMesh",function(){return r.InstancedMesh}),n.d(t,"LinesMesh",function(){return r.LinesMesh}),n.d(t,"InstancedLinesMesh",function(){return r.InstancedLinesMesh}),n.d(t,"_CreationDataStorage",function(){return r._CreationDataStorage}),n.d(t,"_InstancesBatch",function(){return r._InstancesBatch}),n.d(t,"Mesh",function(){return r.Mesh}),n.d(t,"VertexData",function(){return r.VertexData}),n.d(t,"MeshBuilder",function(){return r.MeshBuilder}),n.d(t,"SimplificationSettings",function(){return r.SimplificationSettings}),n.d(t,"SimplificationQueue",function(){return r.SimplificationQueue}),n.d(t,"SimplificationType",function(){return r.SimplificationType}),n.d(t,"SimplicationQueueSceneComponent",function(){return r.SimplicationQueueSceneComponent}),n.d(t,"Polygon",function(){return r.Polygon}),n.d(t,"PolygonMeshBuilder",function(){return r.PolygonMeshBuilder}),n.d(t,"BaseSubMesh",function(){return r.BaseSubMesh}),n.d(t,"SubMesh",function(){return r.SubMesh}),n.d(t,"MeshLODLevel",function(){return r.MeshLODLevel}),n.d(t,"TransformNode",function(){return r.TransformNode}),n.d(t,"BoxBuilder",function(){return r.BoxBuilder}),n.d(t,"SphereBuilder",function(){return r.SphereBuilder}),n.d(t,"CylinderBuilder",function(){return r.CylinderBuilder}),n.d(t,"LinesBuilder",function(){return r.LinesBuilder}),n.d(t,"PlaneBuilder",function(){return r.PlaneBuilder}),n.d(t,"DataBuffer",function(){return r.DataBuffer}),n.d(t,"WebGLDataBuffer",function(){return r.WebGLDataBuffer}),n.d(t,"MorphTarget",function(){return r.MorphTarget}),n.d(t,"MorphTargetManager",function(){return r.MorphTargetManager}),n.d(t,"Database",function(){return r.Database}),n.d(t,"BaseParticleSystem",function(){return r.BaseParticleSystem}),n.d(t,"GPUParticleSystem",function(){return r.GPUParticleSystem}),n.d(t,"Particle",function(){return r.Particle}),n.d(t,"ParticleHelper",function(){return r.ParticleHelper}),n.d(t,"ParticleSystem",function(){return r.ParticleSystem}),n.d(t,"_IDoNeedToBeInTheBuild",function(){return r._IDoNeedToBeInTheBuild}),n.d(t,"ParticleSystemSet",function(){return r.ParticleSystemSet}),n.d(t,"SolidParticle",function(){return r.SolidParticle}),n.d(t,"ModelShape",function(){return r.ModelShape}),n.d(t,"DepthSortedParticle",function(){return r.DepthSortedParticle}),n.d(t,"SolidParticleSystem",function(){return r.SolidParticleSystem}),n.d(t,"SubEmitterType",function(){return r.SubEmitterType}),n.d(t,"SubEmitter",function(){return r.SubEmitter}),n.d(t,"PhysicsEngine",function(){return r.PhysicsEngine}),n.d(t,"PhysicsEngineSceneComponent",function(){return r.PhysicsEngineSceneComponent}),n.d(t,"PhysicsHelper",function(){return r.PhysicsHelper}),n.d(t,"PhysicsRadialExplosionEventOptions",function(){return r.PhysicsRadialExplosionEventOptions}),n.d(t,"PhysicsUpdraftEventOptions",function(){return r.PhysicsUpdraftEventOptions}),n.d(t,"PhysicsVortexEventOptions",function(){return r.PhysicsVortexEventOptions}),n.d(t,"PhysicsRadialImpulseFalloff",function(){return r.PhysicsRadialImpulseFalloff}),n.d(t,"PhysicsUpdraftMode",function(){return r.PhysicsUpdraftMode}),n.d(t,"PhysicsImpostor",function(){return r.PhysicsImpostor}),n.d(t,"PhysicsJoint",function(){return r.PhysicsJoint}),n.d(t,"DistanceJoint",function(){return r.DistanceJoint}),n.d(t,"MotorEnabledJoint",function(){return r.MotorEnabledJoint}),n.d(t,"HingeJoint",function(){return r.HingeJoint}),n.d(t,"Hinge2Joint",function(){return r.Hinge2Joint}),n.d(t,"AnaglyphPostProcess",function(){return r.AnaglyphPostProcess}),n.d(t,"BlackAndWhitePostProcess",function(){return r.BlackAndWhitePostProcess}),n.d(t,"BloomEffect",function(){return r.BloomEffect}),n.d(t,"BloomMergePostProcess",function(){return r.BloomMergePostProcess}),n.d(t,"BlurPostProcess",function(){return r.BlurPostProcess}),n.d(t,"ChromaticAberrationPostProcess",function(){return r.ChromaticAberrationPostProcess}),n.d(t,"CircleOfConfusionPostProcess",function(){return r.CircleOfConfusionPostProcess}),n.d(t,"ColorCorrectionPostProcess",function(){return r.ColorCorrectionPostProcess}),n.d(t,"ConvolutionPostProcess",function(){return r.ConvolutionPostProcess}),n.d(t,"DepthOfFieldBlurPostProcess",function(){return r.DepthOfFieldBlurPostProcess}),n.d(t,"DepthOfFieldEffectBlurLevel",function(){return r.DepthOfFieldEffectBlurLevel}),n.d(t,"DepthOfFieldEffect",function(){return r.DepthOfFieldEffect}),n.d(t,"DepthOfFieldMergePostProcessOptions",function(){return r.DepthOfFieldMergePostProcessOptions}),n.d(t,"DepthOfFieldMergePostProcess",function(){return r.DepthOfFieldMergePostProcess}),n.d(t,"DisplayPassPostProcess",function(){return r.DisplayPassPostProcess}),n.d(t,"ExtractHighlightsPostProcess",function(){return r.ExtractHighlightsPostProcess}),n.d(t,"FilterPostProcess",function(){return r.FilterPostProcess}),n.d(t,"FxaaPostProcess",function(){return r.FxaaPostProcess}),n.d(t,"GrainPostProcess",function(){return r.GrainPostProcess}),n.d(t,"HighlightsPostProcess",function(){return r.HighlightsPostProcess}),n.d(t,"ImageProcessingPostProcess",function(){return r.ImageProcessingPostProcess}),n.d(t,"MotionBlurPostProcess",function(){return r.MotionBlurPostProcess}),n.d(t,"PassPostProcess",function(){return r.PassPostProcess}),n.d(t,"PassCubePostProcess",function(){return r.PassCubePostProcess}),n.d(t,"PostProcess",function(){return r.PostProcess}),n.d(t,"PostProcessManager",function(){return r.PostProcessManager}),n.d(t,"RefractionPostProcess",function(){return r.RefractionPostProcess}),n.d(t,"SharpenPostProcess",function(){return r.SharpenPostProcess}),n.d(t,"StereoscopicInterlacePostProcess",function(){return r.StereoscopicInterlacePostProcess}),n.d(t,"TonemappingOperator",function(){return r.TonemappingOperator}),n.d(t,"TonemapPostProcess",function(){return r.TonemapPostProcess}),n.d(t,"VolumetricLightScatteringPostProcess",function(){return r.VolumetricLightScatteringPostProcess}),n.d(t,"VRDistortionCorrectionPostProcess",function(){return r.VRDistortionCorrectionPostProcess}),n.d(t,"VRMultiviewToSingleviewPostProcess",function(){return r.VRMultiviewToSingleviewPostProcess}),n.d(t,"ReflectionProbe",function(){return r.ReflectionProbe}),n.d(t,"BoundingBoxRenderer",function(){return r.BoundingBoxRenderer}),n.d(t,"DepthRenderer",function(){return r.DepthRenderer}),n.d(t,"DepthRendererSceneComponent",function(){return r.DepthRendererSceneComponent}),n.d(t,"EdgesRenderer",function(){return r.EdgesRenderer}),n.d(t,"LineEdgesRenderer",function(){return r.LineEdgesRenderer}),n.d(t,"GeometryBufferRenderer",function(){return r.GeometryBufferRenderer}),n.d(t,"GeometryBufferRendererSceneComponent",function(){return r.GeometryBufferRendererSceneComponent}),n.d(t,"OutlineRenderer",function(){return r.OutlineRenderer}),n.d(t,"RenderingGroup",function(){return r.RenderingGroup}),n.d(t,"RenderingGroupInfo",function(){return r.RenderingGroupInfo}),n.d(t,"RenderingManager",function(){return r.RenderingManager}),n.d(t,"UtilityLayerRenderer",function(){return r.UtilityLayerRenderer}),n.d(t,"Sprite",function(){return r.Sprite}),n.d(t,"SpriteManager",function(){return r.SpriteManager}),n.d(t,"SpriteSceneComponent",function(){return r.SpriteSceneComponent}),n.d(t,"_AlphaState",function(){return r._AlphaState}),n.d(t,"_DepthCullingState",function(){return r._DepthCullingState}),n.d(t,"_StencilState",function(){return r._StencilState}),n.d(t,"AndOrNotEvaluator",function(){return r.AndOrNotEvaluator}),n.d(t,"AssetTaskState",function(){return r.AssetTaskState}),n.d(t,"AbstractAssetTask",function(){return r.AbstractAssetTask}),n.d(t,"AssetsProgressEvent",function(){return r.AssetsProgressEvent}),n.d(t,"MeshAssetTask",function(){return r.MeshAssetTask}),n.d(t,"TextFileAssetTask",function(){return r.TextFileAssetTask}),n.d(t,"BinaryFileAssetTask",function(){return r.BinaryFileAssetTask}),n.d(t,"ImageAssetTask",function(){return r.ImageAssetTask}),n.d(t,"TextureAssetTask",function(){return r.TextureAssetTask}),n.d(t,"CubeTextureAssetTask",function(){return r.CubeTextureAssetTask}),n.d(t,"HDRCubeTextureAssetTask",function(){return r.HDRCubeTextureAssetTask}),n.d(t,"EquiRectangularCubeTextureAssetTask",function(){return r.EquiRectangularCubeTextureAssetTask}),n.d(t,"AssetsManager",function(){return r.AssetsManager}),n.d(t,"DDSTools",function(){return r.DDSTools}),n.d(t,"expandToProperty",function(){return r.expandToProperty}),n.d(t,"serialize",function(){return r.serialize}),n.d(t,"serializeAsTexture",function(){return r.serializeAsTexture}),n.d(t,"serializeAsColor3",function(){return r.serializeAsColor3}),n.d(t,"serializeAsFresnelParameters",function(){return r.serializeAsFresnelParameters}),n.d(t,"serializeAsVector2",function(){return r.serializeAsVector2}),n.d(t,"serializeAsVector3",function(){return r.serializeAsVector3}),n.d(t,"serializeAsMeshReference",function(){return r.serializeAsMeshReference}),n.d(t,"serializeAsColorCurves",function(){return r.serializeAsColorCurves}),n.d(t,"serializeAsColor4",function(){return r.serializeAsColor4}),n.d(t,"serializeAsImageProcessingConfiguration",function(){return r.serializeAsImageProcessingConfiguration}),n.d(t,"serializeAsQuaternion",function(){return r.serializeAsQuaternion}),n.d(t,"serializeAsMatrix",function(){return r.serializeAsMatrix}),n.d(t,"serializeAsCameraReference",function(){return r.serializeAsCameraReference}),n.d(t,"SerializationHelper",function(){return r.SerializationHelper}),n.d(t,"Deferred",function(){return r.Deferred}),n.d(t,"EnvironmentTextureTools",function(){return r.EnvironmentTextureTools}),n.d(t,"MeshExploder",function(){return r.MeshExploder}),n.d(t,"FilesInput",function(){return r.FilesInput}),n.d(t,"KhronosTextureContainer",function(){return r.KhronosTextureContainer}),n.d(t,"EventState",function(){return r.EventState}),n.d(t,"Observer",function(){return r.Observer}),n.d(t,"MultiObserver",function(){return r.MultiObserver}),n.d(t,"Observable",function(){return r.Observable}),n.d(t,"PerformanceMonitor",function(){return r.PerformanceMonitor}),n.d(t,"RollingAverage",function(){return r.RollingAverage}),n.d(t,"PromisePolyfill",function(){return r.PromisePolyfill}),n.d(t,"SceneOptimization",function(){return r.SceneOptimization}),n.d(t,"TextureOptimization",function(){return r.TextureOptimization}),n.d(t,"HardwareScalingOptimization",function(){return r.HardwareScalingOptimization}),n.d(t,"ShadowsOptimization",function(){return r.ShadowsOptimization}),n.d(t,"PostProcessesOptimization",function(){return r.PostProcessesOptimization}),n.d(t,"LensFlaresOptimization",function(){return r.LensFlaresOptimization}),n.d(t,"CustomOptimization",function(){return r.CustomOptimization}),n.d(t,"ParticlesOptimization",function(){return r.ParticlesOptimization}),n.d(t,"RenderTargetsOptimization",function(){return r.RenderTargetsOptimization}),n.d(t,"MergeMeshesOptimization",function(){return r.MergeMeshesOptimization}),n.d(t,"SceneOptimizerOptions",function(){return r.SceneOptimizerOptions}),n.d(t,"SceneOptimizer",function(){return r.SceneOptimizer}),n.d(t,"SceneSerializer",function(){return r.SceneSerializer}),n.d(t,"SmartArray",function(){return r.SmartArray}),n.d(t,"SmartArrayNoDuplicate",function(){return r.SmartArrayNoDuplicate}),n.d(t,"StringDictionary",function(){return r.StringDictionary}),n.d(t,"Tags",function(){return r.Tags}),n.d(t,"TextureTools",function(){return r.TextureTools}),n.d(t,"TGATools",function(){return r.TGATools}),n.d(t,"ColorGradient",function(){return r.ColorGradient}),n.d(t,"Color3Gradient",function(){return r.Color3Gradient}),n.d(t,"FactorGradient",function(){return r.FactorGradient}),n.d(t,"LoadFileError",function(){return r.LoadFileError}),n.d(t,"RetryStrategy",function(){return r.RetryStrategy}),n.d(t,"Tools",function(){return r.Tools}),n.d(t,"PerfCounter",function(){return r.PerfCounter}),n.d(t,"className",function(){return r.className}),n.d(t,"AsyncLoop",function(){return r.AsyncLoop}),n.d(t,"VideoRecorder",function(){return r.VideoRecorder}),n.d(t,"JoystickAxis",function(){return r.JoystickAxis}),n.d(t,"VirtualJoystick",function(){return r.VirtualJoystick}),n.d(t,"WorkerPool",function(){return r.WorkerPool}),n.d(t,"Logger",function(){return r.Logger}),n.d(t,"_TypeStore",function(){return r._TypeStore}),n.d(t,"FilesInputStore",function(){return r.FilesInputStore}),n.d(t,"DeepCopier",function(){return r.DeepCopier}),n.d(t,"PivotTools",function(){return r.PivotTools}),n.d(t,"PrecisionDate",function(){return r.PrecisionDate}),n.d(t,"ScreenshotTools",function(){return r.ScreenshotTools}),n.d(t,"WebRequest",function(){return r.WebRequest}),n.d(t,"InspectableType",function(){return r.InspectableType}),n.d(t,"AutoRotationBehavior",function(){return r.AutoRotationBehavior}),n.d(t,"BouncingBehavior",function(){return r.BouncingBehavior}),n.d(t,"FramingBehavior",function(){return r.FramingBehavior}),n.d(t,"AttachToBoxBehavior",function(){return r.AttachToBoxBehavior}),n.d(t,"FadeInOutBehavior",function(){return r.FadeInOutBehavior}),n.d(t,"MultiPointerScaleBehavior",function(){return r.MultiPointerScaleBehavior}),n.d(t,"PointerDragBehavior",function(){return r.PointerDragBehavior}),n.d(t,"SixDofDragBehavior",function(){return r.SixDofDragBehavior}),n.d(t,"ArcRotateCameraGamepadInput",function(){return r.ArcRotateCameraGamepadInput}),n.d(t,"ArcRotateCameraKeyboardMoveInput",function(){return r.ArcRotateCameraKeyboardMoveInput}),n.d(t,"ArcRotateCameraMouseWheelInput",function(){return r.ArcRotateCameraMouseWheelInput}),n.d(t,"ArcRotateCameraPointersInput",function(){return r.ArcRotateCameraPointersInput}),n.d(t,"ArcRotateCameraVRDeviceOrientationInput",function(){return r.ArcRotateCameraVRDeviceOrientationInput}),n.d(t,"FlyCameraKeyboardInput",function(){return r.FlyCameraKeyboardInput}),n.d(t,"FlyCameraMouseInput",function(){return r.FlyCameraMouseInput}),n.d(t,"FollowCameraKeyboardMoveInput",function(){return r.FollowCameraKeyboardMoveInput}),n.d(t,"FollowCameraMouseWheelInput",function(){return r.FollowCameraMouseWheelInput}),n.d(t,"FollowCameraPointersInput",function(){return r.FollowCameraPointersInput}),n.d(t,"FreeCameraDeviceOrientationInput",function(){return r.FreeCameraDeviceOrientationInput}),n.d(t,"FreeCameraGamepadInput",function(){return r.FreeCameraGamepadInput}),n.d(t,"FreeCameraKeyboardMoveInput",function(){return r.FreeCameraKeyboardMoveInput}),n.d(t,"FreeCameraMouseInput",function(){return r.FreeCameraMouseInput}),n.d(t,"FreeCameraTouchInput",function(){return r.FreeCameraTouchInput}),n.d(t,"FreeCameraVirtualJoystickInput",function(){return r.FreeCameraVirtualJoystickInput}),n.d(t,"AnaglyphArcRotateCamera",function(){return r.AnaglyphArcRotateCamera}),n.d(t,"AnaglyphFreeCamera",function(){return r.AnaglyphFreeCamera}),n.d(t,"AnaglyphGamepadCamera",function(){return r.AnaglyphGamepadCamera}),n.d(t,"AnaglyphUniversalCamera",function(){return r.AnaglyphUniversalCamera}),n.d(t,"StereoscopicArcRotateCamera",function(){return r.StereoscopicArcRotateCamera}),n.d(t,"StereoscopicFreeCamera",function(){return r.StereoscopicFreeCamera}),n.d(t,"StereoscopicGamepadCamera",function(){return r.StereoscopicGamepadCamera}),n.d(t,"StereoscopicUniversalCamera",function(){return r.StereoscopicUniversalCamera}),n.d(t,"VRCameraMetrics",function(){return r.VRCameraMetrics}),n.d(t,"VRDeviceOrientationArcRotateCamera",function(){return r.VRDeviceOrientationArcRotateCamera}),n.d(t,"VRDeviceOrientationFreeCamera",function(){return r.VRDeviceOrientationFreeCamera}),n.d(t,"VRDeviceOrientationGamepadCamera",function(){return r.VRDeviceOrientationGamepadCamera}),n.d(t,"OnAfterEnteringVRObservableEvent",function(){return r.OnAfterEnteringVRObservableEvent}),n.d(t,"VRExperienceHelper",function(){return r.VRExperienceHelper}),n.d(t,"WebVRFreeCamera",function(){return r.WebVRFreeCamera}),n.d(t,"WebXRCamera",function(){return r.WebXRCamera}),n.d(t,"WebXREnterExitUIButton",function(){return r.WebXREnterExitUIButton}),n.d(t,"WebXREnterExitUIOptions",function(){return r.WebXREnterExitUIOptions}),n.d(t,"WebXREnterExitUI",function(){return r.WebXREnterExitUI}),n.d(t,"WebXRState",function(){return r.WebXRState}),n.d(t,"WebXRExperienceHelper",function(){return r.WebXRExperienceHelper}),n.d(t,"WebXRController",function(){return r.WebXRController}),n.d(t,"WebXRInput",function(){return r.WebXRInput}),n.d(t,"WebXRManagedOutputCanvas",function(){return r.WebXRManagedOutputCanvas}),n.d(t,"WebXRSessionManager",function(){return r.WebXRSessionManager}),n.d(t,"Octree",function(){return r.Octree}),n.d(t,"OctreeBlock",function(){return r.OctreeBlock}),n.d(t,"OctreeSceneComponent",function(){return r.OctreeSceneComponent}),n.d(t,"_OcclusionDataStorage",function(){return r._OcclusionDataStorage}),n.d(t,"_forceTransformFeedbackToBundle",function(){return r._forceTransformFeedbackToBundle}),n.d(t,"ShadowGenerator",function(){return r.ShadowGenerator}),n.d(t,"ShadowGeneratorSceneComponent",function(){return r.ShadowGeneratorSceneComponent}),n.d(t,"_BabylonLoaderRegistered",function(){return r._BabylonLoaderRegistered}),n.d(t,"BackgroundMaterial",function(){return r.BackgroundMaterial}),n.d(t,"PBRMaterialDefines",function(){return r.PBRMaterialDefines}),n.d(t,"PBRBaseMaterial",function(){return r.PBRBaseMaterial}),n.d(t,"PBRBaseSimpleMaterial",function(){return r.PBRBaseSimpleMaterial}),n.d(t,"PBRMaterial",function(){return r.PBRMaterial}),n.d(t,"PBRMetallicRoughnessMaterial",function(){return r.PBRMetallicRoughnessMaterial}),n.d(t,"PBRSpecularGlossinessMaterial",function(){return r.PBRSpecularGlossinessMaterial}),n.d(t,"ColorGradingTexture",function(){return r.ColorGradingTexture}),n.d(t,"DynamicTexture",function(){return r.DynamicTexture}),n.d(t,"ProceduralTexture",function(){return r.ProceduralTexture}),n.d(t,"RawCubeTexture",function(){return r.RawCubeTexture}),n.d(t,"RawTexture",function(){return r.RawTexture}),n.d(t,"RawTexture3D",function(){return r.RawTexture3D}),n.d(t,"RefractionTexture",function(){return r.RefractionTexture}),n.d(t,"VideoTexture",function(){return r.VideoTexture}),n.d(t,"HtmlElementTexture",function(){return r.HtmlElementTexture}),n.d(t,"DracoCompression",function(){return r.DracoCompression}),n.d(t,"DiscBuilder",function(){return r.DiscBuilder}),n.d(t,"RibbonBuilder",function(){return r.RibbonBuilder}),n.d(t,"HemisphereBuilder",function(){return r.HemisphereBuilder}),n.d(t,"TorusBuilder",function(){return r.TorusBuilder}),n.d(t,"TorusKnotBuilder",function(){return r.TorusKnotBuilder}),n.d(t,"PolygonBuilder",function(){return r.PolygonBuilder}),n.d(t,"ShapeBuilder",function(){return r.ShapeBuilder}),n.d(t,"LatheBuilder",function(){return r.LatheBuilder}),n.d(t,"GroundBuilder",function(){return r.GroundBuilder}),n.d(t,"TubeBuilder",function(){return r.TubeBuilder}),n.d(t,"PolyhedronBuilder",function(){return r.PolyhedronBuilder}),n.d(t,"IcoSphereBuilder",function(){return r.IcoSphereBuilder}),n.d(t,"DecalBuilder",function(){return r.DecalBuilder}),n.d(t,"BoxParticleEmitter",function(){return r.BoxParticleEmitter}),n.d(t,"ConeParticleEmitter",function(){return r.ConeParticleEmitter}),n.d(t,"CylinderParticleEmitter",function(){return r.CylinderParticleEmitter}),n.d(t,"CylinderDirectedParticleEmitter",function(){return r.CylinderDirectedParticleEmitter}),n.d(t,"HemisphericParticleEmitter",function(){return r.HemisphericParticleEmitter}),n.d(t,"PointParticleEmitter",function(){return r.PointParticleEmitter}),n.d(t,"SphereParticleEmitter",function(){return r.SphereParticleEmitter}),n.d(t,"SphereDirectedParticleEmitter",function(){return r.SphereDirectedParticleEmitter}),n.d(t,"CannonJSPlugin",function(){return r.CannonJSPlugin}),n.d(t,"AmmoJSPlugin",function(){return r.AmmoJSPlugin}),n.d(t,"OimoJSPlugin",function(){return r.OimoJSPlugin}),n.d(t,"PostProcessRenderEffect",function(){return r.PostProcessRenderEffect}),n.d(t,"PostProcessRenderPipeline",function(){return r.PostProcessRenderPipeline}),n.d(t,"PostProcessRenderPipelineManager",function(){return r.PostProcessRenderPipelineManager}),n.d(t,"PostProcessRenderPipelineManagerSceneComponent",function(){return r.PostProcessRenderPipelineManagerSceneComponent}),n.d(t,"CubeMapToSphericalPolynomialTools",function(){return r.CubeMapToSphericalPolynomialTools}),n.d(t,"HDRTools",function(){return r.HDRTools}),n.d(t,"PanoramaToCubeMapTools",function(){return r.PanoramaToCubeMapTools}),n.d(t,"_DDSTextureLoader",function(){return r._DDSTextureLoader}),n.d(t,"_ENVTextureLoader",function(){return r._ENVTextureLoader}),n.d(t,"_KTXTextureLoader",function(){return r._KTXTextureLoader}),n.d(t,"_TGATextureLoader",function(){return r._TGATextureLoader}),n.d(t,"CustomProceduralTexture",function(){return r.CustomProceduralTexture}),n.d(t,"NoiseProceduralTexture",function(){return r.NoiseProceduralTexture}),n.d(t,"ProceduralTextureSceneComponent",function(){return r.ProceduralTextureSceneComponent}),n.d(t,"DefaultRenderingPipeline",function(){return r.DefaultRenderingPipeline}),n.d(t,"LensRenderingPipeline",function(){return r.LensRenderingPipeline}),n.d(t,"SSAO2RenderingPipeline",function(){return r.SSAO2RenderingPipeline}),n.d(t,"SSAORenderingPipeline",function(){return r.SSAORenderingPipeline}),n.d(t,"StandardRenderingPipeline",function(){return r.StandardRenderingPipeline});var o=void 0!==e?e:"undefined"!=typeof window?window:void 0;if(void 0!==o){o.BABYLON=a,o.BABYLON=o.BABYLON||{};var a=o.BABYLON;a.Debug=a.Debug||{};var s=[];for(var l in i)a.Debug[l]=i[l],s.push(l);for(var l in r)a[l]=r[l]}var u={AxesViewer:i.AxesViewer,BoneAxesViewer:i.BoneAxesViewer,PhysicsViewer:i.PhysicsViewer,SkeletonViewer:i.SkeletonViewer}}.call(this,n(119))}])}).call(this,n(31))},function(e,t,n){"use strict";n.d(t,"a",function(){return i});n(1);var r=n(27);function i(e,t,n){return(i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=Object(r.a)(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0);function i(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(i.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),i.FullScreenQuad=function(){var e=new r.bb(-1,1,1,-1,0,1),t=new r.eb(2,2),n=function(e){this._mesh=new r.Q(t,e)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,e)}}),n}()},function(e,t,n){(function(t){var n;e.exports=function e(t,r,i){function o(s,l){if(!r[s]){if(!t[s]){var u="function"==typeof n&&n;if(!l&&u)return n(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return o(n||e)},h,h.exports,e,t,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),a=e("../core/Sleeping"),s=(e("../render/Render"),e("../core/Common")),l=e("../geometry/Bounds"),u=e("../geometry/Axes");!function(){r._inertiaScale=4,r._nextCollidingGroupId=1,r._nextNonCollidingGroupId=-1,r._nextCategory=1,r.create=function(t){var n={id:s.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:0}},r=s.extend(n,t);return e(r,t),r},r.nextGroup=function(e){return e?r._nextNonCollidingGroupId--:r._nextCollidingGroupId++},r.nextCategory=function(){return r._nextCategory=r._nextCategory<<1,r._nextCategory};var e=function(e,t){t=t||{},r.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||o.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),i.rotate(e.vertices,e.angle,e.position),u.rotate(e.axes,e.angle),l.update(e.bounds,e.vertices,e.velocity),r.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var n=e.isStatic?"#2e2b44":s.choose(["#006BA6","#0496FF","#FFBC42","#D81159","#8F2D56"]);e.render.fillStyle=e.render.fillStyle||n,e.render.strokeStyle=e.render.strokeStyle||"#000",e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};r.set=function(e,t,n){var i;for(i in"string"===typeof t&&(i=t,(t={})[i]=n),t)if(n=t[i],t.hasOwnProperty(i))switch(i){case"isStatic":r.setStatic(e,n);break;case"isSleeping":a.set(e,n);break;case"mass":r.setMass(e,n);break;case"density":r.setDensity(e,n);break;case"inertia":r.setInertia(e,n);break;case"vertices":r.setVertices(e,n);break;case"position":r.setPosition(e,n);break;case"angle":r.setAngle(e,n);break;case"velocity":r.setVelocity(e,n);break;case"angularVelocity":r.setAngularVelocity(e,n);break;case"parts":r.setParts(e,n);break;default:e[i]=n}},r.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var r=e.parts[n];r.isStatic=t,t?(r._original={restitution:r.restitution,friction:r.friction,mass:r.mass,inertia:r.inertia,density:r.density,inverseMass:r.inverseMass,inverseInertia:r.inverseInertia},r.restitution=0,r.friction=1,r.mass=r.inertia=r.density=1/0,r.inverseMass=r.inverseInertia=0,r.positionPrev.x=r.position.x,r.positionPrev.y=r.position.y,r.anglePrev=r.angle,r.angularVelocity=0,r.speed=0,r.angularSpeed=0,r.motion=0):r._original&&(r.restitution=r._original.restitution,r.friction=r._original.friction,r.mass=r._original.mass,r.inertia=r._original.inertia,r.density=r._original.density,r.inverseMass=r._original.inverseMass,r.inverseInertia=r._original.inverseInertia,delete r._original)}},r.setMass=function(e,t){var n=e.inertia/(e.mass/6);e.inertia=n*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},r.setDensity=function(e,t){r.setMass(e,t*e.area),e.density=t},r.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},r.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=i.create(t,e),e.axes=u.fromVertices(e.vertices),e.area=i.area(e.vertices),r.setMass(e,e.density*e.area);var n=i.centre(e.vertices);i.translate(e.vertices,n,-1),r.setInertia(e,r._inertiaScale*i.inertia(e.vertices,e.mass)),i.translate(e.vertices,e.position),l.update(e.bounds,e.vertices,e.velocity)},r.setParts=function(e,t,n){var o;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,o=0;o<t.length;o++){var a=t[o];a!==e&&(a.parent=e,e.parts.push(a))}if(1!==e.parts.length){if(n="undefined"===typeof n||n){var s=[];for(o=0;o<t.length;o++)s=s.concat(t[o].vertices);i.clockwiseSort(s);var l=i.hull(s),u=i.centre(l);r.setVertices(e,l),i.translate(e.vertices,u)}var c=r._totalProperties(e);e.area=c.area,e.parent=e,e.position.x=c.centre.x,e.position.y=c.centre.y,e.positionPrev.x=c.centre.x,e.positionPrev.y=c.centre.y,r.setMass(e,c.mass),r.setInertia(e,c.inertia),r.setPosition(e,c.centre)}},r.setPosition=function(e,t){var n=o.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var r=0;r<e.parts.length;r++){var a=e.parts[r];a.position.x+=n.x,a.position.y+=n.y,i.translate(a.vertices,n),l.update(a.bounds,a.vertices,e.velocity)}},r.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var r=0;r<e.parts.length;r++){var a=e.parts[r];a.angle+=n,i.rotate(a.vertices,n,e.position),u.rotate(a.axes,n),l.update(a.bounds,a.vertices,e.velocity),r>0&&o.rotateAbout(a.position,n,e.position,a.position)}},r.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=o.magnitude(e.velocity)},r.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},r.translate=function(e,t){r.setPosition(e,o.add(e.position,t))},r.rotate=function(e,t,n){if(n){var i=Math.cos(t),o=Math.sin(t),a=e.position.x-n.x,s=e.position.y-n.y;r.setPosition(e,{x:n.x+(a*i-s*o),y:n.y+(a*o+s*i)}),r.setAngle(e,e.angle+t)}else r.setAngle(e,e.angle+t)},r.scale=function(e,t,n,o){var a=0,s=0;o=o||e.position;for(var c=0;c<e.parts.length;c++){var h=e.parts[c];i.scale(h.vertices,t,n,o),h.axes=u.fromVertices(h.vertices),h.area=i.area(h.vertices),r.setMass(h,e.density*h.area),i.translate(h.vertices,{x:-h.position.x,y:-h.position.y}),r.setInertia(h,r._inertiaScale*i.inertia(h.vertices,h.mass)),i.translate(h.vertices,{x:h.position.x,y:h.position.y}),c>0&&(a+=h.area,s+=h.inertia),h.position.x=o.x+(h.position.x-o.x)*t,h.position.y=o.y+(h.position.y-o.y)*n,l.update(h.bounds,h.vertices,e.velocity)}e.parts.length>1&&(e.area=a,e.isStatic||(r.setMass(e,e.density*a),r.setInertia(e,s))),e.circleRadius&&(t===n?e.circleRadius*=t:e.circleRadius=null)},r.update=function(e,t,n,r){var a=Math.pow(t*n*e.timeScale,2),s=1-e.frictionAir*n*e.timeScale,c=e.position.x-e.positionPrev.x,h=e.position.y-e.positionPrev.y;e.velocity.x=c*s*r+e.force.x/e.mass*a,e.velocity.y=h*s*r+e.force.y/e.mass*a,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*s*r+e.torque/e.inertia*a,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=o.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var d=0;d<e.parts.length;d++){var f=e.parts[d];i.translate(f.vertices,e.velocity),d>0&&(f.position.x+=e.velocity.x,f.position.y+=e.velocity.y),0!==e.angularVelocity&&(i.rotate(f.vertices,e.angularVelocity,e.position),u.rotate(f.axes,e.angularVelocity),d>0&&o.rotateAbout(f.position,e.angularVelocity,e.position,f.position)),l.update(f.bounds,f.vertices,e.velocity)}},r.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var r={x:t.x-e.position.x,y:t.y-e.position.y};e.torque+=r.x*n.y-r.y*n.x},r._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var r=e.parts[n],i=r.mass!==1/0?r.mass:1;t.mass+=i,t.area+=r.area,t.inertia+=r.inertia,t.centre=o.add(t.centre,o.mult(r.position,i))}return t.centre=o.div(t.centre,t.mass),t}}()},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31}],2:[function(e,t,n){var r={};t.exports=r;var i=e("../core/Events"),o=e("../core/Common"),a=e("../geometry/Bounds"),s=e("./Body");r.create=function(e){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},e)},r.setModified=function(e,t,n,i){if(e.isModified=t,n&&e.parent&&r.setModified(e.parent,t,n,i),i)for(var o=0;o<e.composites.length;o++){var a=e.composites[o];r.setModified(a,t,n,i)}},r.add=function(e,t){var n=[].concat(t);i.trigger(e,"beforeAdd",{object:t});for(var a=0;a<n.length;a++){var s=n[a];switch(s.type){case"body":if(s.parent!==s){o.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}r.addBody(e,s);break;case"constraint":r.addConstraint(e,s);break;case"composite":r.addComposite(e,s);break;case"mouseConstraint":r.addConstraint(e,s.constraint)}}return i.trigger(e,"afterAdd",{object:t}),e},r.remove=function(e,t,n){var o=[].concat(t);i.trigger(e,"beforeRemove",{object:t});for(var a=0;a<o.length;a++){var s=o[a];switch(s.type){case"body":r.removeBody(e,s,n);break;case"constraint":r.removeConstraint(e,s,n);break;case"composite":r.removeComposite(e,s,n);break;case"mouseConstraint":r.removeConstraint(e,s.constraint)}}return i.trigger(e,"afterRemove",{object:t}),e},r.addComposite=function(e,t){return e.composites.push(t),t.parent=e,r.setModified(e,!0,!0,!1),e},r.removeComposite=function(e,t,n){var i=o.indexOf(e.composites,t);if(-1!==i&&(r.removeCompositeAt(e,i),r.setModified(e,!0,!0,!1)),n)for(var a=0;a<e.composites.length;a++)r.removeComposite(e.composites[a],t,!0);return e},r.removeCompositeAt=function(e,t){return e.composites.splice(t,1),r.setModified(e,!0,!0,!1),e},r.addBody=function(e,t){return e.bodies.push(t),r.setModified(e,!0,!0,!1),e},r.removeBody=function(e,t,n){var i=o.indexOf(e.bodies,t);if(-1!==i&&(r.removeBodyAt(e,i),r.setModified(e,!0,!0,!1)),n)for(var a=0;a<e.composites.length;a++)r.removeBody(e.composites[a],t,!0);return e},r.removeBodyAt=function(e,t){return e.bodies.splice(t,1),r.setModified(e,!0,!0,!1),e},r.addConstraint=function(e,t){return e.constraints.push(t),r.setModified(e,!0,!0,!1),e},r.removeConstraint=function(e,t,n){var i=o.indexOf(e.constraints,t);if(-1!==i&&r.removeConstraintAt(e,i),n)for(var a=0;a<e.composites.length;a++)r.removeConstraint(e.composites[a],t,!0);return e},r.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),r.setModified(e,!0,!0,!1),e},r.clear=function(e,t,n){if(n)for(var i=0;i<e.composites.length;i++)r.clear(e.composites[i],t,!0);return t?e.bodies=e.bodies.filter(function(e){return e.isStatic}):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,r.setModified(e,!0,!0,!1),e},r.allBodies=function(e){for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(r.allBodies(e.composites[n]));return t},r.allConstraints=function(e){for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(r.allConstraints(e.composites[n]));return t},r.allComposites=function(e){for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(r.allComposites(e.composites[n]));return t},r.get=function(e,t,n){var i,o;switch(n){case"body":i=r.allBodies(e);break;case"constraint":i=r.allConstraints(e);break;case"composite":i=r.allComposites(e).concat(e)}return i?0===(o=i.filter(function(e){return e.id.toString()===t.toString()})).length?null:o[0]:null},r.move=function(e,t,n){return r.remove(e,t),r.add(n,t),e},r.rebase=function(e){for(var t=r.allBodies(e).concat(r.allConstraints(e)).concat(r.allComposites(e)),n=0;n<t.length;n++)t[n].id=o.nextId();return r.setModified(e,!0,!0,!1),e},r.translate=function(e,t,n){for(var i=n?r.allBodies(e):e.bodies,o=0;o<i.length;o++)s.translate(i[o],t);return r.setModified(e,!0,!0,!1),e},r.rotate=function(e,t,n,i){for(var o=Math.cos(t),a=Math.sin(t),l=i?r.allBodies(e):e.bodies,u=0;u<l.length;u++){var c=l[u],h=c.position.x-n.x,d=c.position.y-n.y;s.setPosition(c,{x:n.x+(h*o-d*a),y:n.y+(h*a+d*o)}),s.rotate(c,t)}return r.setModified(e,!0,!0,!1),e},r.scale=function(e,t,n,i,o){for(var a=o?r.allBodies(e):e.bodies,l=0;l<a.length;l++){var u=a[l],c=u.position.x-i.x,h=u.position.y-i.y;s.setPosition(u,{x:i.x+c*t,y:i.y+h*n}),s.scale(u,t,n)}return r.setModified(e,!0,!0,!1),e},r.bounds=function(e){for(var t=r.allBodies(e),n=[],i=0;i<t.length;i+=1){var o=t[i];n.push(o.bounds.min,o.bounds.max)}return a.create(n)}},{"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"./Body":1}],3:[function(e,t,n){var r={};t.exports=r;var i=e("./Composite"),o=(e("../constraint/Constraint"),e("../core/Common"));r.create=function(e){var t=i.create(),n={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-1/0,y:-1/0},max:{x:1/0,y:1/0}}};return o.extend(t,n,e)}},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(e,t,n){var r={};t.exports=r,r.create=function(e){return{id:r.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},r.id=function(e){return e.body.id+"_"+e.index}},{}],5:[function(e,t,n){var r={};t.exports=r;var i=e("./SAT"),o=e("./Pair"),a=e("../geometry/Bounds");r.collisions=function(e,t){for(var n=[],s=t.pairs.table,l=0;l<e.length;l++){var u=e[l][0],c=e[l][1];if((!u.isStatic&&!u.isSleeping||!c.isStatic&&!c.isSleeping)&&r.canCollide(u.collisionFilter,c.collisionFilter)&&a.overlaps(u.bounds,c.bounds))for(var h=u.parts.length>1?1:0;h<u.parts.length;h++)for(var d=u.parts[h],f=c.parts.length>1?1:0;f<c.parts.length;f++){var p=c.parts[f];if(d===u&&p===c||a.overlaps(d.bounds,p.bounds)){var m,g=o.id(d,p),_=s[g];m=_&&_.isActive?_.collision:null;var v=i.collides(d,p,m);v.collided&&n.push(v)}}}return n},r.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!==(e.mask&t.category)&&0!==(t.mask&e.category)}},{"../geometry/Bounds":26,"./Pair":7,"./SAT":11}],6:[function(e,t,n){var r={};t.exports=r;var i=e("./Pair"),o=e("./Detector"),a=e("../core/Common");r.create=function(e){var t={controller:r,detector:o.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return a.extend(t,e)},r.update=function(e,t,n,i){var o,a,s,l,u,c=n.world,h=e.buckets,d=!1;for(o=0;o<t.length;o++){var f=t[o];if((!f.isSleeping||i)&&!(f.bounds.max.x<c.bounds.min.x||f.bounds.min.x>c.bounds.max.x||f.bounds.max.y<c.bounds.min.y||f.bounds.min.y>c.bounds.max.y)){var p=r._getRegion(e,f);if(!f.region||p.id!==f.region.id||i){f.region&&!i||(f.region=p);var m=r._regionUnion(p,f.region);for(a=m.startCol;a<=m.endCol;a++)for(s=m.startRow;s<=m.endRow;s++){u=r._getBucketId(a,s),l=h[u];var g=a>=p.startCol&&a<=p.endCol&&s>=p.startRow&&s<=p.endRow,_=a>=f.region.startCol&&a<=f.region.endCol&&s>=f.region.startRow&&s<=f.region.endRow;!g&&_&&_&&l&&r._bucketRemoveBody(e,l,f),(f.region===p||g&&!_||i)&&(l||(l=r._createBucket(h,u)),r._bucketAddBody(e,l,f))}f.region=p,d=!0}}}d&&(e.pairsList=r._createActivePairsList(e))},r.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},r._regionUnion=function(e,t){var n=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),o=Math.min(e.startRow,t.startRow),a=Math.max(e.endRow,t.endRow);return r._createRegion(n,i,o,a)},r._getRegion=function(e,t){var n=t.bounds,i=Math.floor(n.min.x/e.bucketWidth),o=Math.floor(n.max.x/e.bucketWidth),a=Math.floor(n.min.y/e.bucketHeight),s=Math.floor(n.max.y/e.bucketHeight);return r._createRegion(i,o,a,s)},r._createRegion=function(e,t,n,r){return{id:e+","+t+","+n+","+r,startCol:e,endCol:t,startRow:n,endRow:r}},r._getBucketId=function(e,t){return"C"+e+"R"+t},r._createBucket=function(e,t){var n=e[t]=[];return n},r._bucketAddBody=function(e,t,n){for(var r=0;r<t.length;r++){var o=t[r];if(!(n.id===o.id||n.isStatic&&o.isStatic)){var a=i.id(n,o),s=e.pairs[a];s?s[2]+=1:e.pairs[a]=[n,o,1]}}t.push(n)},r._bucketRemoveBody=function(e,t,n){t.splice(a.indexOf(t,n),1);for(var r=0;r<t.length;r++){var o=t[r],s=i.id(n,o),l=e.pairs[s];l&&(l[2]-=1)}},r._createActivePairsList=function(e){var t,n,r=[];t=a.keys(e.pairs);for(var i=0;i<t.length;i++)(n=e.pairs[t[i]])[2]>0?r.push(n):delete e.pairs[t[i]];return r}},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(e,t,n){var r={};t.exports=r;var i=e("./Contact");r.create=function(e,t){var n=e.bodyA,i=e.bodyB,o=e.parentA,a=e.parentB,s={id:r.id(n,i),bodyA:n,bodyB:i,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:n.isSensor||i.isSensor,timeCreated:t,timeUpdated:t,inverseMass:o.inverseMass+a.inverseMass,friction:Math.min(o.friction,a.friction),frictionStatic:Math.max(o.frictionStatic,a.frictionStatic),restitution:Math.max(o.restitution,a.restitution),slop:Math.max(o.slop,a.slop)};return r.update(s,e,t),s},r.update=function(e,t,n){var o=e.contacts,a=t.supports,s=e.activeContacts,l=t.parentA,u=t.parentB;if(e.collision=t,e.inverseMass=l.inverseMass+u.inverseMass,e.friction=Math.min(l.friction,u.friction),e.frictionStatic=Math.max(l.frictionStatic,u.frictionStatic),e.restitution=Math.max(l.restitution,u.restitution),e.slop=Math.max(l.slop,u.slop),s.length=0,t.collided){for(var c=0;c<a.length;c++){var h=a[c],d=i.id(h),f=o[d];f?s.push(f):s.push(o[d]=i.create(h))}e.separation=t.depth,r.setActive(e,!0,n)}else!0===e.isActive&&r.setActive(e,!1,n)},r.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},r.id=function(e,t){return e.id<t.id?"A"+e.id+"B"+t.id:"A"+t.id+"B"+e.id}},{"./Contact":4}],8:[function(e,t,n){var r={};t.exports=r;var i=e("./Pair"),o=e("../core/Common");r._pairMaxIdleLife=1e3,r.create=function(e){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},r.update=function(e,t,n){var r,a,s,l,u=e.list,c=e.table,h=e.collisionStart,d=e.collisionEnd,f=e.collisionActive,p=[];for(h.length=0,d.length=0,f.length=0,l=0;l<t.length;l++)(r=t[l]).collided&&(a=i.id(r.bodyA,r.bodyB),p.push(a),(s=c[a])?(s.isActive?f.push(s):h.push(s),i.update(s,r,n)):(s=i.create(r,n),c[a]=s,h.push(s),u.push(s)));for(l=0;l<u.length;l++)(s=u[l]).isActive&&-1===o.indexOf(p,s.id)&&(i.setActive(s,!1,n),d.push(s))},r.removeOld=function(e,t){var n,i,o,a,s=e.list,l=e.table,u=[];for(a=0;a<s.length;a++)n=s[a],(i=n.collision).bodyA.isSleeping||i.bodyB.isSleeping?n.timeUpdated=t:t-n.timeUpdated>r._pairMaxIdleLife&&u.push(a);for(a=0;a<u.length;a++)o=u[a]-a,n=s[o],delete l[n.id],s.splice(o,1)},r.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}},{"../core/Common":14,"./Pair":7}],9:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vector"),o=e("./SAT"),a=e("../geometry/Bounds"),s=e("../factory/Bodies"),l=e("../geometry/Vertices");r.collides=function(e,t){for(var n=[],r=0;r<t.length;r++){var i=t[r];if(a.overlaps(i.bounds,e.bounds))for(var s=1===i.parts.length?0:1;s<i.parts.length;s++){var l=i.parts[s];if(a.overlaps(l.bounds,e.bounds)){var u=o.collides(l,e);if(u.collided){n.push(u);break}}}}return n},r.ray=function(e,t,n,o){o=o||1e-100;for(var a=i.angle(t,n),l=i.magnitude(i.sub(t,n)),u=.5*(n.x+t.x),c=.5*(n.y+t.y),h=s.rectangle(u,c,l,o,{angle:a}),d=r.collides(h,e),f=0;f<d.length;f+=1){var p=d[f];p.body=p.bodyB=p.bodyA}return d},r.region=function(e,t,n){for(var r=[],i=0;i<e.length;i++){var o=e[i],s=a.overlaps(o.bounds,t);(s&&!n||!s&&n)&&r.push(o)}return r},r.point=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];if(a.contains(i.bounds,t))for(var o=1===i.parts.length?0:1;o<i.parts.length;o++){var s=i.parts[o];if(a.contains(s.bounds,t)&&l.contains(s.vertices,t)){n.push(i);break}}}return n}},{"../factory/Bodies":23,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"./SAT":11}],10:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),a=e("../core/Common"),s=e("../geometry/Bounds");r._restingThresh=4,r._restingThreshTangent=6,r._positionDampen=.9,r._positionWarming=.8,r._frictionNormalMultiplier=5,r.preSolvePosition=function(e){var t,n,r;for(t=0;t<e.length;t++)(n=e[t]).isActive&&(r=n.activeContacts.length,n.collision.parentA.totalContacts+=r,n.collision.parentB.totalContacts+=r)},r.solvePosition=function(e,t){var n,i,a,s,l,u,c,h,d,f=o._temp[0],p=o._temp[1],m=o._temp[2],g=o._temp[3];for(n=0;n<e.length;n++)(i=e[n]).isActive&&!i.isSensor&&(a=i.collision,s=a.parentA,l=a.parentB,u=a.normal,c=o.sub(o.add(l.positionImpulse,l.position,f),o.add(s.positionImpulse,o.sub(l.position,a.penetration,p),m),g),i.separation=o.dot(u,c));for(n=0;n<e.length;n++)(i=e[n]).isActive&&!i.isSensor&&(a=i.collision,s=a.parentA,l=a.parentB,u=a.normal,d=(i.separation-i.slop)*t,(s.isStatic||l.isStatic)&&(d*=2),s.isStatic||s.isSleeping||(h=r._positionDampen/s.totalContacts,s.positionImpulse.x+=u.x*d*h,s.positionImpulse.y+=u.y*d*h),l.isStatic||l.isSleeping||(h=r._positionDampen/l.totalContacts,l.positionImpulse.x-=u.x*d*h,l.positionImpulse.y-=u.y*d*h))},r.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.totalContacts=0,0!==n.positionImpulse.x||0!==n.positionImpulse.y){for(var a=0;a<n.parts.length;a++){var l=n.parts[a];i.translate(l.vertices,n.positionImpulse),s.update(l.bounds,l.vertices,n.velocity),l.position.x+=n.positionImpulse.x,l.position.y+=n.positionImpulse.y}n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,o.dot(n.positionImpulse,n.velocity)<0?(n.positionImpulse.x=0,n.positionImpulse.y=0):(n.positionImpulse.x*=r._positionWarming,n.positionImpulse.y*=r._positionWarming)}}},r.preSolveVelocity=function(e){var t,n,r,i,a,s,l,u,c,h,d,f,p,m,g=o._temp[0],_=o._temp[1];for(t=0;t<e.length;t++)if((r=e[t]).isActive&&!r.isSensor)for(i=r.activeContacts,a=r.collision,s=a.parentA,l=a.parentB,u=a.normal,c=a.tangent,n=0;n<i.length;n++)h=i[n],d=h.vertex,f=h.normalImpulse,p=h.tangentImpulse,0===f&&0===p||(g.x=u.x*f+c.x*p,g.y=u.y*f+c.y*p,s.isStatic||s.isSleeping||(m=o.sub(d,s.position,_),s.positionPrev.x+=g.x*s.inverseMass,s.positionPrev.y+=g.y*s.inverseMass,s.anglePrev+=o.cross(m,g)*s.inverseInertia),l.isStatic||l.isSleeping||(m=o.sub(d,l.position,_),l.positionPrev.x-=g.x*l.inverseMass,l.positionPrev.y-=g.y*l.inverseMass,l.anglePrev-=o.cross(m,g)*l.inverseInertia))},r.solveVelocity=function(e,t){for(var n=t*t,i=o._temp[0],s=o._temp[1],l=o._temp[2],u=o._temp[3],c=o._temp[4],h=o._temp[5],d=0;d<e.length;d++){var f=e[d];if(f.isActive&&!f.isSensor){var p=f.collision,m=p.parentA,g=p.parentB,_=p.normal,v=p.tangent,y=f.activeContacts,b=1/y.length;m.velocity.x=m.position.x-m.positionPrev.x,m.velocity.y=m.position.y-m.positionPrev.y,g.velocity.x=g.position.x-g.positionPrev.x,g.velocity.y=g.position.y-g.positionPrev.y,m.angularVelocity=m.angle-m.anglePrev,g.angularVelocity=g.angle-g.anglePrev;for(var E=0;E<y.length;E++){var x=y[E],T=x.vertex,S=o.sub(T,m.position,s),A=o.sub(T,g.position,l),P=o.add(m.velocity,o.mult(o.perp(S),m.angularVelocity),u),M=o.add(g.velocity,o.mult(o.perp(A),g.angularVelocity),c),R=o.sub(P,M,h),C=o.dot(_,R),w=o.dot(v,R),O=Math.abs(w),I=a.sign(w),D=(1+f.restitution)*C,L=a.clamp(f.separation+C,0,1)*r._frictionNormalMultiplier,F=w,N=1/0;O>f.friction*f.frictionStatic*L*n&&(N=O,F=a.clamp(f.friction*I*n,-N,N));var B=o.cross(S,_),U=o.cross(A,_),k=b/(m.inverseMass+g.inverseMass+m.inverseInertia*B*B+g.inverseInertia*U*U);if(D*=k,F*=k,C<0&&C*C>r._restingThresh*n)x.normalImpulse=0;else{var V=x.normalImpulse;x.normalImpulse=Math.min(x.normalImpulse+D,0),D=x.normalImpulse-V}if(w*w>r._restingThreshTangent*n)x.tangentImpulse=0;else{var G=x.tangentImpulse;x.tangentImpulse=a.clamp(x.tangentImpulse+F,-N,N),F=x.tangentImpulse-G}i.x=_.x*D+v.x*F,i.y=_.y*D+v.y*F,m.isStatic||m.isSleeping||(m.positionPrev.x+=i.x*m.inverseMass,m.positionPrev.y+=i.y*m.inverseMass,m.anglePrev+=o.cross(S,i)*m.inverseInertia),g.isStatic||g.isSleeping||(g.positionPrev.x-=i.x*g.inverseMass,g.positionPrev.y-=i.y*g.inverseMass,g.anglePrev-=o.cross(A,i)*g.inverseInertia)}}}}},{"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],11:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vertices"),o=e("../geometry/Vector");r.collides=function(e,t,n){var a,s,l,u,c=!1;if(n){var h=e.parent,d=t.parent,f=h.speed*h.speed+h.angularSpeed*h.angularSpeed+d.speed*d.speed+d.angularSpeed*d.angularSpeed;c=n&&n.collided&&f<.2,u=n}else u={collided:!1,bodyA:e,bodyB:t};if(n&&c){var p=u.axisBody,m=p===e?t:e,g=[p.axes[n.axisNumber]];if(l=r._overlapAxes(p.vertices,m.vertices,g),u.reused=!0,l.overlap<=0)return u.collided=!1,u}else{if((a=r._overlapAxes(e.vertices,t.vertices,e.axes)).overlap<=0)return u.collided=!1,u;if((s=r._overlapAxes(t.vertices,e.vertices,t.axes)).overlap<=0)return u.collided=!1,u;a.overlap<s.overlap?(l=a,u.axisBody=e):(l=s,u.axisBody=t),u.axisNumber=l.axisNumber}u.bodyA=e.id<t.id?e:t,u.bodyB=e.id<t.id?t:e,u.collided=!0,u.depth=l.overlap,u.parentA=u.bodyA.parent,u.parentB=u.bodyB.parent,e=u.bodyA,t=u.bodyB,o.dot(l.axis,o.sub(t.position,e.position))<0?u.normal={x:l.axis.x,y:l.axis.y}:u.normal={x:-l.axis.x,y:-l.axis.y},u.tangent=o.perp(u.normal),u.penetration=u.penetration||{},u.penetration.x=u.normal.x*u.depth,u.penetration.y=u.normal.y*u.depth;var _=r._findSupports(e,t,u.normal),v=[];if(i.contains(e.vertices,_[0])&&v.push(_[0]),i.contains(e.vertices,_[1])&&v.push(_[1]),v.length<2){var y=r._findSupports(t,e,o.neg(u.normal));i.contains(t.vertices,y[0])&&v.push(y[0]),v.length<2&&i.contains(t.vertices,y[1])&&v.push(y[1])}return v.length<1&&(v=[_[0]]),u.supports=v,u},r._overlapAxes=function(e,t,n){for(var i,a,s=o._temp[0],l=o._temp[1],u={overlap:Number.MAX_VALUE},c=0;c<n.length;c++){if(a=n[c],r._projectToAxis(s,e,a),r._projectToAxis(l,t,a),(i=Math.min(s.max-l.min,l.max-s.min))<=0)return u.overlap=i,u;i<u.overlap&&(u.overlap=i,u.axis=a,u.axisNumber=c)}return u},r._projectToAxis=function(e,t,n){for(var r=o.dot(t[0],n),i=r,a=1;a<t.length;a+=1){var s=o.dot(t[a],n);s>i?i=s:s<r&&(r=s)}e.min=r,e.max=i},r._findSupports=function(e,t,n){for(var r,i,a,s,l=Number.MAX_VALUE,u=o._temp[0],c=t.vertices,h=e.position,d=0;d<c.length;d++)i=c[d],u.x=i.x-h.x,u.y=i.y-h.y,(r=-o.dot(n,u))<l&&(l=r,a=i);var f=a.index-1>=0?a.index-1:c.length-1;i=c[f],u.x=i.x-h.x,u.y=i.y-h.y,l=-o.dot(n,u),s=i;var p=(a.index+1)%c.length;return i=c[p],u.x=i.x-h.x,u.y=i.y-h.y,(r=-o.dot(n,u))<l&&(s=i),[a,s]}},{"../geometry/Vector":28,"../geometry/Vertices":29}],12:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),a=e("../core/Sleeping"),s=e("../geometry/Bounds"),l=e("../geometry/Axes"),u=e("../core/Common");r._warming=.4,r._torqueDampen=1,r._minLength=1e-6,r.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?o.add(t.bodyA.position,t.pointA):t.pointA,r=t.bodyB?o.add(t.bodyB.position,t.pointB):t.pointB,i=o.magnitude(o.sub(n,r));t.length="undefined"!==typeof t.length?t.length:i,t.id=t.id||u.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var a={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(a.type="pin",a.anchors=!1):t.stiffness<.9&&(a.type="spring"),t.render=u.extend(a,t.render),t},r.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var n=e[t],r=n.constraintImpulse;n.isStatic||0===r.x&&0===r.y&&0===r.angle||(n.position.x+=r.x,n.position.y+=r.y,n.angle+=r.angle)}},r.solveAll=function(e,t){for(var n=0;n<e.length;n+=1){var i=e[n],o=!i.bodyA||i.bodyA&&i.bodyA.isStatic,a=!i.bodyB||i.bodyB&&i.bodyB.isStatic;(o||a)&&r.solve(e[n],t)}for(n=0;n<e.length;n+=1)i=e[n],o=!i.bodyA||i.bodyA&&i.bodyA.isStatic,a=!i.bodyB||i.bodyB&&i.bodyB.isStatic,o||a||r.solve(e[n],t)},r.solve=function(e,t){var n=e.bodyA,i=e.bodyB,a=e.pointA,s=e.pointB;if(n||i){n&&!n.isStatic&&(o.rotate(a,n.angle-e.angleA,a),e.angleA=n.angle),i&&!i.isStatic&&(o.rotate(s,i.angle-e.angleB,s),e.angleB=i.angle);var l=a,u=s;if(n&&(l=o.add(n.position,a)),i&&(u=o.add(i.position,s)),l&&u){var c=o.sub(l,u),h=o.magnitude(c);h<r._minLength&&(h=r._minLength);var d,f,p,m,g,_=(h-e.length)/h,v=e.stiffness<1?e.stiffness*t:e.stiffness,y=o.mult(c,_*v),b=(n?n.inverseMass:0)+(i?i.inverseMass:0),E=(n?n.inverseInertia:0)+(i?i.inverseInertia:0),x=b+E;if(e.damping){var T=o.create();p=o.div(c,h),g=o.sub(i&&o.sub(i.position,i.positionPrev)||T,n&&o.sub(n.position,n.positionPrev)||T),m=o.dot(p,g)}n&&!n.isStatic&&(f=n.inverseMass/b,n.constraintImpulse.x-=y.x*f,n.constraintImpulse.y-=y.y*f,n.position.x-=y.x*f,n.position.y-=y.y*f,e.damping&&(n.positionPrev.x-=e.damping*p.x*m*f,n.positionPrev.y-=e.damping*p.y*m*f),d=o.cross(a,y)/x*r._torqueDampen*n.inverseInertia*(1-e.angularStiffness),n.constraintImpulse.angle-=d,n.angle-=d),i&&!i.isStatic&&(f=i.inverseMass/b,i.constraintImpulse.x+=y.x*f,i.constraintImpulse.y+=y.y*f,i.position.x+=y.x*f,i.position.y+=y.y*f,e.damping&&(i.positionPrev.x+=e.damping*p.x*m*f,i.positionPrev.y+=e.damping*p.y*m*f),d=o.cross(s,y)/x*r._torqueDampen*i.inverseInertia*(1-e.angularStiffness),i.constraintImpulse.angle+=d,i.angle+=d)}}},r.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],u=n.constraintImpulse;if(!(n.isStatic||0===u.x&&0===u.y&&0===u.angle)){a.set(n,!1);for(var c=0;c<n.parts.length;c++){var h=n.parts[c];i.translate(h.vertices,u),c>0&&(h.position.x+=u.x,h.position.y+=u.y),0!==u.angle&&(i.rotate(h.vertices,u.angle,n.position),l.rotate(h.axes,u.angle),c>0&&o.rotateAbout(h.position,u.angle,n.position,h.position)),s.update(h.bounds,h.vertices,n.velocity)}u.angle*=r._warming,u.x*=r._warming,u.y*=r._warming}}}},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],13:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vertices"),o=e("../core/Sleeping"),a=e("../core/Mouse"),s=e("../core/Events"),l=e("../collision/Detector"),u=e("./Constraint"),c=e("../body/Composite"),h=e("../core/Common"),d=e("../geometry/Bounds");r.create=function(e,t){var n=(e?e.mouse:null)||(t?t.mouse:null);n||(e&&e.render&&e.render.canvas?n=a.create(e.render.canvas):t&&t.element?n=a.create(t.element):(n=a.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var i=u.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),o={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:i,collisionFilter:{category:1,mask:4294967295,group:0}},l=h.extend(o,t);return s.on(e,"beforeUpdate",function(){var t=c.allBodies(e.world);r.update(l,t),r._triggerEvents(l)}),l},r.update=function(e,t){var n=e.mouse,r=e.constraint,a=e.body;if(0===n.button){if(r.bodyB)o.set(r.bodyB,!1),r.pointA=n.position;else for(var u=0;u<t.length;u++)if(a=t[u],d.contains(a.bounds,n.position)&&l.canCollide(a.collisionFilter,e.collisionFilter))for(var c=a.parts.length>1?1:0;c<a.parts.length;c++){var h=a.parts[c];if(i.contains(h.vertices,n.position)){r.pointA=n.position,r.bodyB=e.body=a,r.pointB={x:n.position.x-a.position.x,y:n.position.y-a.position.y},r.angleB=a.angle,o.set(a,!1),s.trigger(e,"startdrag",{mouse:n,body:a});break}}}else r.bodyB=e.body=null,r.pointB=null,a&&s.trigger(e,"enddrag",{mouse:n,body:a})},r._triggerEvents=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&s.trigger(e,"mousemove",{mouse:t}),n.mousedown&&s.trigger(e,"mousedown",{mouse:t}),n.mouseup&&s.trigger(e,"mouseup",{mouse:t}),a.clearSourceEvents(t)}},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../core/Sleeping":22,"../geometry/Bounds":26,"../geometry/Vertices":29,"./Constraint":12}],14:[function(e,n,r){(function(t){var r={};n.exports=r,function(){r._nextId=0,r._seed=0,r._nowStartTime=+new Date,r.extend=function(e,t){var n,i;"boolean"===typeof t?(n=2,i=t):(n=1,i=!0);for(var o=n;o<arguments.length;o++){var a=arguments[o];if(a)for(var s in a)i&&a[s]&&a[s].constructor===Object?e[s]&&e[s].constructor!==Object?e[s]=a[s]:(e[s]=e[s]||{},r.extend(e[s],i,a[s])):e[s]=a[s]}return e},r.clone=function(e,t){return r.extend({},t,e)},r.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},r.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),r=0;r<n.length;r++)t.push(e[n[r]]);return t}for(var i in e)t.push(e[i]);return t},r.get=function(e,t,n,r){t=t.split(".").slice(n,r);for(var i=0;i<t.length;i+=1)e=e[t[i]];return e},r.set=function(e,t,n,i,o){var a=t.split(".").slice(i,o);return r.get(e,t,0,-1)[a[a.length-1]]=n,n},r.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(r.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}return e},r.choose=function(e){return e[Math.floor(r.random()*e.length)]},r.isElement=function(e){return"undefined"!==typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isFunction=function(e){return"function"===typeof e},r.isPlainObject=function(e){return"object"===typeof e&&e.constructor===Object},r.isString=function(e){return"[object String]"===toString.call(e)},r.clamp=function(e,t,n){return e<t?t:e>n?n:e},r.sign=function(e){return e<0?-1:1},r.now=function(){if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return new Date-r._nowStartTime},r.random=function(e,t){return t="undefined"!==typeof t?t:1,(e="undefined"!==typeof e?e:0)+n()*(t-e)};var n=function(){return r._seed=(9301*r._seed+49297)%233280,r._seed/233280};r.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},r.logLevel=1,r.log=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.info=function(){console&&r.logLevel>0&&r.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.warn=function(){console&&r.logLevel>0&&r.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},r.nextId=function(){return r._nextId++},r.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},r.map=function(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n},r.topologicalSort=function(e){var t=[],n=[],i=[];for(var o in e)n[o]||i[o]||r._topologicalSort(o,n,i,e,t);return t},r._topologicalSort=function(e,t,n,i,o){var a=i[e]||[];n[e]=!0;for(var s=0;s<a.length;s+=1){var l=a[s];n[l]||t[l]||r._topologicalSort(l,t,n,i,o)}n[e]=!1,t[e]=!0,o.push(e)},r.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var n=arguments[t];n._chained?e.push.apply(e,n._chained):e.push(n)}var r=function(){for(var t,n=new Array(arguments.length),r=0,i=arguments.length;r<i;r++)n[r]=arguments[r];for(r=0;r<e.length;r+=1){var o=e[r].apply(t,n);"undefined"!==typeof o&&(t=o)}return t};return r._chained=e,r},r.chainPathBefore=function(e,t,n){return r.set(e,t,r.chain(n,r.get(e,t)))},r.chainPathAfter=function(e,t,n){return r.set(e,t,r.chain(r.get(e,t),n))},r._requireGlobal=function(n,r){var i="undefined"!==typeof window?window[n]:"undefined"!==typeof t?t[n]:null;return i||e(r)}}()}).call(this,"undefined"!==typeof t?t:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],15:[function(e,t,n){var r={};t.exports=r;var i=e("../body/World"),o=e("./Sleeping"),a=e("../collision/Resolver"),s=e("../render/Render"),l=e("../collision/Pairs"),u=(e("./Metrics"),e("../collision/Grid")),c=e("./Events"),h=e("../body/Composite"),d=e("../constraint/Constraint"),f=e("./Common"),p=e("../body/Body");r.create=function(e,t){t=f.isElement(e)?t:e,e=f.isElement(e)?e:null,t=t||{},(e||t.render)&&f.warn("Engine.create: engine.render is deprecated (see docs)");var n={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},timing:{timestamp:0,timeScale:1},broadphase:{controller:u}},r=f.extend(n,t);if(e||r.render){var o={element:e,controller:s};r.render=f.extend(o,r.render)}return r.render&&r.render.controller&&(r.render=r.render.controller.create(r.render)),r.render&&(r.render.engine=r),r.world=t.world||i.create(r.world),r.pairs=l.create(),r.broadphase=r.broadphase.controller.create(r.broadphase),r.metrics=r.metrics||{extended:!1},r},r.update=function(e,t,n){t=t||1e3/60,n=n||1;var i,s=e.world,u=e.timing,f=e.broadphase,p=[];u.timestamp+=t*u.timeScale;var m={timestamp:u.timestamp};c.trigger(e,"beforeUpdate",m);var g=h.allBodies(s),_=h.allConstraints(s);for(e.enableSleeping&&o.update(g,u.timeScale),r._bodiesApplyGravity(g,s.gravity),r._bodiesUpdate(g,t,u.timeScale,n,s.bounds),d.preSolveAll(g),i=0;i<e.constraintIterations;i++)d.solveAll(_,u.timeScale);d.postSolveAll(g),f.controller?(s.isModified&&f.controller.clear(f),f.controller.update(f,g,e,s.isModified),p=f.pairsList):p=g,s.isModified&&h.setModified(s,!1,!1,!0);var v=f.detector(p,e),y=e.pairs,b=u.timestamp;for(l.update(y,v,b),l.removeOld(y,b),e.enableSleeping&&o.afterCollisions(y.list,u.timeScale),y.collisionStart.length>0&&c.trigger(e,"collisionStart",{pairs:y.collisionStart}),a.preSolvePosition(y.list),i=0;i<e.positionIterations;i++)a.solvePosition(y.list,u.timeScale);for(a.postSolvePosition(g),d.preSolveAll(g),i=0;i<e.constraintIterations;i++)d.solveAll(_,u.timeScale);for(d.postSolveAll(g),a.preSolveVelocity(y.list),i=0;i<e.velocityIterations;i++)a.solveVelocity(y.list,u.timeScale);return y.collisionActive.length>0&&c.trigger(e,"collisionActive",{pairs:y.collisionActive}),y.collisionEnd.length>0&&c.trigger(e,"collisionEnd",{pairs:y.collisionEnd}),r._bodiesClearForces(g),c.trigger(e,"afterUpdate",m),e},r.merge=function(e,t){if(f.extend(e,t),t.world){e.world=t.world,r.clear(e);for(var n=h.allBodies(e.world),i=0;i<n.length;i++){var a=n[i];o.set(a,!1),a.id=f.nextId()}}},r.clear=function(e){var t=e.world;l.clear(e.pairs);var n=e.broadphase;if(n.controller){var r=h.allBodies(t);n.controller.clear(n),n.controller.update(n,r,e,!0)}},r._bodiesClearForces=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},r._bodiesApplyGravity=function(e,t){var n="undefined"!==typeof t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==n)for(var r=0;r<e.length;r++){var i=e[r];i.isStatic||i.isSleeping||(i.force.y+=i.mass*t.y*n,i.force.x+=i.mass*t.x*n)}},r._bodiesUpdate=function(e,t,n,r,i){for(var o=0;o<e.length;o++){var a=e[o];a.isStatic||a.isSleeping||p.update(a,t,n,r)}}},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":31,"./Common":14,"./Events":16,"./Metrics":18,"./Sleeping":22}],16:[function(e,t,n){var r={};t.exports=r;var i=e("./Common");r.on=function(e,t,n){for(var r,i=t.split(" "),o=0;o<i.length;o++)r=i[o],e.events=e.events||{},e.events[r]=e.events[r]||[],e.events[r].push(n);return n},r.off=function(e,t,n){if(t){"function"===typeof t&&(n=t,t=i.keys(e.events).join(" "));for(var r=t.split(" "),o=0;o<r.length;o++){var a=e.events[r[o]],s=[];if(n&&a)for(var l=0;l<a.length;l++)a[l]!==n&&s.push(a[l]);e.events[r[o]]=s}}else e.events={}},r.trigger=function(e,t,n){var r,o,a,s;if(e.events){n||(n={}),r=t.split(" ");for(var l=0;l<r.length;l++)if(o=r[l],a=e.events[o]){(s=i.clone(n,!1)).name=o,s.source=e;for(var u=0;u<a.length;u++)a[u].apply(e,[s])}}}},{"./Common":14}],17:[function(e,t,n){var r={};t.exports=r;var i=e("./Plugin"),o=e("./Common");r.name="matter-js",r.version="0.14.2",r.uses=[],r.used=[],r.use=function(){i.use(r,Array.prototype.slice.call(arguments))},r.before=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathBefore(r,e,t)},r.after=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathAfter(r,e,t)}},{"./Common":14,"./Plugin":20}],18:[function(e,t,n){},{"../body/Composite":2,"./Common":14}],19:[function(e,t,n){var r={};t.exports=r;var i=e("../core/Common");r.create=function(e){var t={};return e||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=t.element.getAttribute("data-pixel-ratio")||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio),i=e.changedTouches;i&&(t.button=0,e.preventDefault()),t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio),i=e.changedTouches;i?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var n=r._getRelativeMousePosition(e,t.element,t.pixelRatio),i=e.changedTouches;i&&e.preventDefault(),t.button=-1,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},r.setElement(t,t.element),t},r.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},r.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},r.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},r.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},r._getRelativeMousePosition=function(e,t,n){var r,i,o=t.getBoundingClientRect(),a=document.documentElement||document.body.parentNode||document.body,s=void 0!==window.pageXOffset?window.pageXOffset:a.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:a.scrollTop,u=e.changedTouches;return u?(r=u[0].pageX-o.left-s,i=u[0].pageY-o.top-l):(r=e.pageX-o.left-s,i=e.pageY-o.top-l),{x:r/(t.clientWidth/(t.width||t.clientWidth)*n),y:i/(t.clientHeight/(t.height||t.clientHeight)*n)}}},{"../core/Common":14}],20:[function(e,t,n){var r={};t.exports=r;var i=e("./Common");r._registry={},r.register=function(e){if(r.isPlugin(e)||i.warn("Plugin.register:",r.toString(e),"does not implement all required fields."),e.name in r._registry){var t=r._registry[e.name],n=r.versionParse(e.version).number,o=r.versionParse(t.version).number;n>o?(i.warn("Plugin.register:",r.toString(t),"was upgraded to",r.toString(e)),r._registry[e.name]=e):n<o?i.warn("Plugin.register:",r.toString(t),"can not be downgraded to",r.toString(e)):e!==t&&i.warn("Plugin.register:",r.toString(e),"is already registered to different plugin object")}else r._registry[e.name]=e;return e},r.resolve=function(e){return r._registry[r.dependencyParse(e).name]},r.toString=function(e){return"string"===typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},r.isPlugin=function(e){return e&&e.name&&e.version&&e.install},r.isUsed=function(e,t){return e.used.indexOf(t)>-1},r.isFor=function(e,t){var n=e.for&&r.dependencyParse(e.for);return!e.for||t.name===n.name&&r.versionSatisfies(t.version,n.range)},r.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var n=r.dependencies(e),o=i.topologicalSort(n),a=[],s=0;s<o.length;s+=1)if(o[s]!==e.name){var l=r.resolve(o[s]);l?r.isUsed(e,l.name)||(r.isFor(l,e)||(i.warn("Plugin.use:",r.toString(l),"is for",l.for,"but installed on",r.toString(e)+"."),l._warned=!0),l.install?l.install(e):(i.warn("Plugin.use:",r.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(a.push("\ud83d\udd36 "+r.toString(l)),delete l._warned):a.push("\u2705 "+r.toString(l)),e.used.push(l.name)):a.push("\u274c "+o[s])}a.length>0&&i.info(a.join("  "))}else i.warn("Plugin.use:",r.toString(e),"does not specify any dependencies to install.")},r.dependencies=function(e,t){var n=r.dependencyParse(e),o=n.name;if(!(o in(t=t||{}))){e=r.resolve(e)||e,t[o]=i.map(e.uses||[],function(t){r.isPlugin(t)&&r.register(t);var o=r.dependencyParse(t),a=r.resolve(t);return a&&!r.versionSatisfies(a.version,o.range)?(i.warn("Plugin.dependencies:",r.toString(a),"does not satisfy",r.toString(o),"used by",r.toString(n)+"."),a._warned=!0,e._warned=!0):a||(i.warn("Plugin.dependencies:",r.toString(t),"used by",r.toString(n),"could not be resolved."),e._warned=!0),o.name});for(var a=0;a<t[o].length;a+=1)r.dependencies(t[o][a],t);return t}},r.dependencyParse=function(e){return i.isString(e)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/.test(e)||i.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}):{name:e.name,range:e.range||e.version}},r.versionParse=function(e){/^\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?$/.test(e)||i.warn("Plugin.versionParse:",e,"is not a valid version or range.");var t=e.split("-");e=t[0];var n=isNaN(Number(e[0])),r=n?e.substr(1):e,o=i.map(r.split("."),function(e){return Number(e)});return{isRange:n,version:r,range:e,operator:n?e[0]:"",parts:o,prerelease:t[1],number:1e8*o[0]+1e4*o[1]+o[2]}},r.versionSatisfies=function(e,t){t=t||"*";var n=r.versionParse(t),i=n.parts,o=r.versionParse(e),a=o.parts;if(n.isRange){if("*"===n.operator||"*"===e)return!0;if("~"===n.operator)return a[0]===i[0]&&a[1]===i[1]&&a[2]>=i[2];if("^"===n.operator)return i[0]>0?a[0]===i[0]&&o.number>=n.number:i[1]>0?a[1]===i[1]&&a[2]>=i[2]:a[2]===i[2]}return e===t||"*"===e}},{"./Common":14}],21:[function(e,t,n){var r={};t.exports=r;var i=e("./Events"),o=e("./Engine"),a=e("./Common");!function(){var e,t,n;"undefined"!==typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e||(e=function(e){n=setTimeout(function(){e(a.now())},1e3/60)},t=function(){clearTimeout(n)}),r.create=function(e){var t=a.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},e);return t.delta=t.delta||1e3/t.fps,t.deltaMin=t.deltaMin||1e3/t.fps,t.deltaMax=t.deltaMax||1e3/(.5*t.fps),t.fps=1e3/t.delta,t},r.run=function(t,n){return"undefined"!==typeof t.positionIterations&&(n=t,t=r.create()),function i(o){t.frameRequestId=e(i),o&&t.enabled&&r.tick(t,n,o)}(),t},r.tick=function(e,t,n){var r,a=t.timing,s=1,l={timestamp:a.timestamp};i.trigger(e,"beforeTick",l),i.trigger(t,"beforeTick",l),e.isFixed?r=e.delta:(r=n-e.timePrev||e.delta,e.timePrev=n,e.deltaHistory.push(r),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),r=(r=(r=Math.min.apply(null,e.deltaHistory))<e.deltaMin?e.deltaMin:r)>e.deltaMax?e.deltaMax:r,s=r/e.delta,e.delta=r),0!==e.timeScalePrev&&(s*=a.timeScale/e.timeScalePrev),0===a.timeScale&&(s=0),e.timeScalePrev=a.timeScale,e.correction=s,e.frameCounter+=1,n-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((n-e.counterTimestamp)/1e3),e.counterTimestamp=n,e.frameCounter=0),i.trigger(e,"tick",l),i.trigger(t,"tick",l),t.world.isModified&&t.render&&t.render.controller&&t.render.controller.clear&&t.render.controller.clear(t.render),i.trigger(e,"beforeUpdate",l),o.update(t,r,s),i.trigger(e,"afterUpdate",l),t.render&&t.render.controller&&(i.trigger(e,"beforeRender",l),i.trigger(t,"beforeRender",l),t.render.controller.world(t.render),i.trigger(e,"afterRender",l),i.trigger(t,"afterRender",l)),i.trigger(e,"afterTick",l),i.trigger(t,"afterTick",l)},r.stop=function(e){t(e.frameRequestId)},r.start=function(e,t){r.run(e,t)}}()},{"./Common":14,"./Engine":15,"./Events":16}],22:[function(e,t,n){var r={};t.exports=r;var i=e("./Events");r._motionWakeThreshold=.18,r._motionSleepThreshold=.08,r._minBias=.9,r.update=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var o=e[i],a=o.speed*o.speed+o.angularSpeed*o.angularSpeed;if(0===o.force.x&&0===o.force.y){var s=Math.min(o.motion,a),l=Math.max(o.motion,a);o.motion=r._minBias*s+(1-r._minBias)*l,o.sleepThreshold>0&&o.motion<r._motionSleepThreshold*n?(o.sleepCounter+=1,o.sleepCounter>=o.sleepThreshold&&r.set(o,!0)):o.sleepCounter>0&&(o.sleepCounter-=1)}else r.set(o,!1)}},r.afterCollisions=function(e,t){for(var n=t*t*t,i=0;i<e.length;i++){var o=e[i];if(o.isActive){var a=o.collision,s=a.bodyA.parent,l=a.bodyB.parent;if(!(s.isSleeping&&l.isSleeping||s.isStatic||l.isStatic)&&(s.isSleeping||l.isSleeping)){var u=s.isSleeping&&!s.isStatic?s:l,c=u===s?l:s;!u.isStatic&&c.motion>r._motionWakeThreshold*n&&r.set(u,!1)}}}},r.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||i.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&i.trigger(e,"sleepEnd"))}},{"./Events":16}],23:[function(e,t,n){var r={};t.exports=r;var i,o=e("../geometry/Vertices"),a=e("../core/Common"),s=e("../body/Body"),l=e("../geometry/Bounds"),u=e("../geometry/Vector");r.rectangle=function(e,t,n,r,i){i=i||{};var l={label:"Rectangle Body",position:{x:e,y:t},vertices:o.fromPath("L 0 0 L "+n+" 0 L "+n+" "+r+" L 0 "+r)};if(i.chamfer){var u=i.chamfer;l.vertices=o.chamfer(l.vertices,u.radius,u.quality,u.qualityMin,u.qualityMax),delete i.chamfer}return s.create(a.extend({},l,i))},r.trapezoid=function(e,t,n,r,i,l){l=l||{};var u,c=(1-2*(i*=.5))*n,h=n*i,d=h+c,f=d+h;u=i<.5?"L 0 0 L "+h+" "+-r+" L "+d+" "+-r+" L "+f+" 0":"L 0 0 L "+d+" "+-r+" L "+f+" 0";var p={label:"Trapezoid Body",position:{x:e,y:t},vertices:o.fromPath(u)};if(l.chamfer){var m=l.chamfer;p.vertices=o.chamfer(p.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete l.chamfer}return s.create(a.extend({},p,l))},r.circle=function(e,t,n,i,o){i=i||{};var s={label:"Circle Body",circleRadius:n};o=o||25;var l=Math.ceil(Math.max(10,Math.min(o,n)));return l%2===1&&(l+=1),r.polygon(e,t,l,n,a.extend({},s,i))},r.polygon=function(e,t,n,i,l){if(l=l||{},n<3)return r.circle(e,t,i,l);for(var u=2*Math.PI/n,c="",h=.5*u,d=0;d<n;d+=1){var f=h+d*u,p=Math.cos(f)*i,m=Math.sin(f)*i;c+="L "+p.toFixed(3)+" "+m.toFixed(3)+" "}var g={label:"Polygon Body",position:{x:e,y:t},vertices:o.fromPath(c)};if(l.chamfer){var _=l.chamfer;g.vertices=o.chamfer(g.vertices,_.radius,_.quality,_.qualityMin,_.qualityMax),delete l.chamfer}return s.create(a.extend({},g,l))},r.fromVertices=function(e,t,n,r,c,h,d){var f,p,m,g,_,v,y,b,E;for(i||(i=a._requireGlobal("decomp","poly-decomp")),r=r||{},p=[],c="undefined"!==typeof c&&c,h="undefined"!==typeof h?h:.01,d="undefined"!==typeof d?d:10,i||a.warn("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull."),a.isArray(n[0])||(n=[n]),b=0;b<n.length;b+=1)if(g=n[b],(m=o.isConvex(g))||!i)g=m?o.clockwiseSort(g):o.hull(g),p.push({position:{x:e,y:t},vertices:g});else{var x=g.map(function(e){return[e.x,e.y]});i.makeCCW(x),!1!==h&&i.removeCollinearPoints(x,h);var T=i.quickDecomp(x);for(_=0;_<T.length;_++){var S=T[_],A=S.map(function(e){return{x:e[0],y:e[1]}});d>0&&o.area(A)<d||p.push({position:o.centre(A),vertices:A})}}for(_=0;_<p.length;_++)p[_]=s.create(a.extend(p[_],r));if(c)for(_=0;_<p.length;_++){var P=p[_];for(v=_+1;v<p.length;v++){var M=p[v];if(l.overlaps(P.bounds,M.bounds)){var R=P.vertices,C=M.vertices;for(y=0;y<P.vertices.length;y++)for(E=0;E<M.vertices.length;E++){var w=u.magnitudeSquared(u.sub(R[(y+1)%R.length],C[E])),O=u.magnitudeSquared(u.sub(R[y],C[(E+1)%C.length]));w<5&&O<5&&(R[y].isInternal=!0,C[E].isInternal=!0)}}}}return p.length>1?(f=s.create(a.extend({parts:p.slice(0)},r)),s.setPosition(f,{x:e,y:t}),f):p[0]}},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],24:[function(e,t,n){var r={};t.exports=r;var i=e("../body/Composite"),o=e("../constraint/Constraint"),a=e("../core/Common"),s=e("../body/Body"),l=e("./Bodies");r.stack=function(e,t,n,r,o,a,l){for(var u,c=i.create({label:"Stack"}),h=e,d=t,f=0,p=0;p<r;p++){for(var m=0,g=0;g<n;g++){var _=l(h,d,g,p,u,f);if(_){var v=_.bounds.max.y-_.bounds.min.y,y=_.bounds.max.x-_.bounds.min.x;v>m&&(m=v),s.translate(_,{x:.5*y,y:.5*v}),h=_.bounds.max.x+o,i.addBody(c,_),u=_,f+=1}else h+=o}d+=m+a,h=e}return c},r.chain=function(e,t,n,r,s,l){for(var u=e.bodies,c=1;c<u.length;c++){var h=u[c-1],d=u[c],f=h.bounds.max.y-h.bounds.min.y,p=h.bounds.max.x-h.bounds.min.x,m=d.bounds.max.y-d.bounds.min.y,g=d.bounds.max.x-d.bounds.min.x,_={bodyA:h,pointA:{x:p*t,y:f*n},bodyB:d,pointB:{x:g*r,y:m*s}},v=a.extend(_,l);i.addConstraint(e,o.create(v))}return e.label+=" Chain",e},r.mesh=function(e,t,n,r,s){var l,u,c,h,d,f=e.bodies;for(l=0;l<n;l++){for(u=1;u<t;u++)c=f[u-1+l*t],h=f[u+l*t],i.addConstraint(e,o.create(a.extend({bodyA:c,bodyB:h},s)));if(l>0)for(u=0;u<t;u++)c=f[u+(l-1)*t],h=f[u+l*t],i.addConstraint(e,o.create(a.extend({bodyA:c,bodyB:h},s))),r&&u>0&&(d=f[u-1+(l-1)*t],i.addConstraint(e,o.create(a.extend({bodyA:d,bodyB:h},s)))),r&&u<t-1&&(d=f[u+1+(l-1)*t],i.addConstraint(e,o.create(a.extend({bodyA:d,bodyB:h},s))))}return e.label+=" Mesh",e},r.pyramid=function(e,t,n,i,o,a,l){return r.stack(e,t,n,i,o,a,function(t,r,a,u,c,h){var d=Math.min(i,Math.ceil(n/2)),f=c?c.bounds.max.x-c.bounds.min.x:0;if(!(u>d)){var p=u=d-u,m=n-1-u;if(!(a<p||a>m)){1===h&&s.translate(c,{x:(a+(n%2===1?1:-1))*f,y:0});var g=c?a*f:0;return l(e+g+a*o,r,a,u,c,h)}}})},r.newtonsCradle=function(e,t,n,r,a){for(var s=i.create({label:"Newtons Cradle"}),u=0;u<n;u++){var c=l.circle(e+u*(1.9*r),t+a,r,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=o.create({pointA:{x:e+u*(1.9*r),y:t},bodyB:c});i.addBody(s,c),i.addConstraint(s,h)}return s},r.car=function(e,t,n,r,a){var u=s.nextGroup(!0),c=.5*-n+20,h=.5*n-20,d=i.create({label:"Car"}),f=l.rectangle(e,t,n,r,{collisionFilter:{group:u},chamfer:{radius:.5*r},density:2e-4}),p=l.circle(e+c,t+0,a,{collisionFilter:{group:u},friction:.8}),m=l.circle(e+h,t+0,a,{collisionFilter:{group:u},friction:.8}),g=o.create({bodyB:f,pointB:{x:c,y:0},bodyA:p,stiffness:1,length:0}),_=o.create({bodyB:f,pointB:{x:h,y:0},bodyA:m,stiffness:1,length:0});return i.addBody(d,f),i.addBody(d,p),i.addBody(d,m),i.addConstraint(d,g),i.addConstraint(d,_),d},r.softBody=function(e,t,n,i,o,s,u,c,h,d){h=a.extend({inertia:1/0},h),d=a.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var f=r.stack(e,t,n,i,o,s,function(e,t){return l.circle(e,t,c,h)});return r.mesh(f,n,i,u,d),f.label="Soft Body",f}},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":23}],25:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vector"),o=e("../core/Common");r.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var r=(n+1)%e.length,a=i.normalise({x:e[r].y-e[n].y,y:e[n].x-e[r].x}),s=0===a.y?1/0:a.x/a.y;s=s.toFixed(3).toString(),t[s]=a}return o.values(t)},r.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),r=Math.sin(t),i=0;i<e.length;i++){var o,a=e[i];o=a.x*n-a.y*r,a.y=a.x*r+a.y*n,a.x=o}}},{"../core/Common":14,"../geometry/Vector":28}],26:[function(e,t,n){var r={};t.exports=r,r.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&r.update(t,e),t},r.update=function(e,t,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var r=0;r<t.length;r++){var i=t[r];i.x>e.max.x&&(e.max.x=i.x),i.x<e.min.x&&(e.min.x=i.x),i.y>e.max.y&&(e.max.y=i.y),i.y<e.min.y&&(e.min.y=i.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},r.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},r.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},r.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},r.shift=function(e,t){var n=e.max.x-e.min.x,r=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+r}},{}],27:[function(e,t,n){var r={};t.exports=r,e("../geometry/Bounds");var i=e("../core/Common");r.pathToVertices=function(e,t){"undefined"===typeof window||"SVGPathSeg"in window||i.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,o,a,s,l,u,c,h,d,f,p,m,g=[],_=0,v=0,y=0;t=t||15;var b=function(e,t,n){var r=n%2===1&&n>1;if(!d||e!=d.x||t!=d.y){d&&r?(p=d.x,m=d.y):(p=0,m=0);var i={x:p+e,y:m+t};!r&&d||(d=i),g.push(i),v=p+e,y=m+t}},E=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":v=e.x,y=e.y;break;case"H":v=e.x;break;case"V":y=e.y}b(v,y,e.pathSegType)}};for(r._svgPathToAbsolute(e),a=e.getTotalLength(),u=[],n=0;n<e.pathSegList.numberOfItems;n+=1)u.push(e.pathSegList.getItem(n));for(c=u.concat();_<a;){if(f=e.getPathSegAtLength(_),(l=u[f])!=h){for(;c.length&&c[0]!=l;)E(c.shift());h=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":s=e.getPointAtLength(_),b(s.x,s.y,0)}_+=t}for(n=0,o=c.length;n<o;++n)E(c[n]);return g},r._svgPathToAbsolute=function(e){for(var t,n,r,i,o,a,s=e.pathSegList,l=0,u=0,c=s.numberOfItems,h=0;h<c;++h){var d=s.getItem(h),f=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in d&&(l=d.x),"y"in d&&(u=d.y);else switch("x1"in d&&(r=l+d.x1),"x2"in d&&(o=l+d.x2),"y1"in d&&(i=u+d.y1),"y2"in d&&(a=u+d.y2),"x"in d&&(l+=d.x),"y"in d&&(u+=d.y),f){case"m":s.replaceItem(e.createSVGPathSegMovetoAbs(l,u),h);break;case"l":s.replaceItem(e.createSVGPathSegLinetoAbs(l,u),h);break;case"h":s.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),h);break;case"v":s.replaceItem(e.createSVGPathSegLinetoVerticalAbs(u),h);break;case"c":s.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,u,r,i,o,a),h);break;case"s":s.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,u,o,a),h);break;case"q":s.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,u,r,i),h);break;case"t":s.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,u),h);break;case"a":s.replaceItem(e.createSVGPathSegArcAbs(l,u,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),h);break;case"z":case"Z":l=t,u=n}"M"!=f&&"m"!=f||(t=l,n=u)}}},{"../core/Common":14,"../geometry/Bounds":26}],28:[function(e,t,n){var r={};t.exports=r,r.create=function(e,t){return{x:e||0,y:t||0}},r.clone=function(e){return{x:e.x,y:e.y}},r.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},r.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},r.rotate=function(e,t,n){var r=Math.cos(t),i=Math.sin(t);n||(n={});var o=e.x*r-e.y*i;return n.y=e.x*i+e.y*r,n.x=o,n},r.rotateAbout=function(e,t,n,r){var i=Math.cos(t),o=Math.sin(t);r||(r={});var a=n.x+((e.x-n.x)*i-(e.y-n.y)*o);return r.y=n.y+((e.x-n.x)*o+(e.y-n.y)*i),r.x=a,r},r.normalise=function(e){var t=r.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},r.dot=function(e,t){return e.x*t.x+e.y*t.y},r.cross=function(e,t){return e.x*t.y-e.y*t.x},r.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},r.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},r.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},r.mult=function(e,t){return{x:e.x*t,y:e.y*t}},r.div=function(e,t){return{x:e.x/t,y:e.y/t}},r.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},r.neg=function(e){return{x:-e.x,y:-e.y}},r.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},r._temp=[r.create(),r.create(),r.create(),r.create(),r.create(),r.create()]},{}],29:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Vector"),o=e("../core/Common");r.create=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],o={x:i.x,y:i.y,index:r,body:t,isInternal:!1};n.push(o)}return n},r.fromPath=function(e,t){var n=[];return e.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,function(e,t,r){n.push({x:parseFloat(t),y:parseFloat(r)})}),r.create(n,t)},r.centre=function(e){for(var t,n,o,a=r.area(e,!0),s={x:0,y:0},l=0;l<e.length;l++)o=(l+1)%e.length,t=i.cross(e[l],e[o]),n=i.mult(i.add(e[l],e[o]),t),s=i.add(s,n);return i.div(s,6*a)},r.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return i.div(t,e.length)},r.area=function(e,t){for(var n=0,r=e.length-1,i=0;i<e.length;i++)n+=(e[r].x-e[i].x)*(e[r].y+e[i].y),r=i;return t?n/2:Math.abs(n)/2},r.inertia=function(e,t){for(var n,r,o=0,a=0,s=e,l=0;l<s.length;l++)r=(l+1)%s.length,n=Math.abs(i.cross(s[r],s[l])),o+=n*(i.dot(s[r],s[r])+i.dot(s[r],s[l])+i.dot(s[l],s[l])),a+=n;return t/6*(o/a)},r.translate=function(e,t,n){var r;if(n)for(r=0;r<e.length;r++)e[r].x+=t.x*n,e[r].y+=t.y*n;else for(r=0;r<e.length;r++)e[r].x+=t.x,e[r].y+=t.y;return e},r.rotate=function(e,t,n){if(0!==t){for(var r=Math.cos(t),i=Math.sin(t),o=0;o<e.length;o++){var a=e[o],s=a.x-n.x,l=a.y-n.y;a.x=n.x+(s*r-l*i),a.y=n.y+(s*i+l*r)}return e}},r.contains=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=e[(n+1)%e.length];if((t.x-r.x)*(i.y-r.y)+(t.y-r.y)*(r.x-i.x)>0)return!1}return!0},r.scale=function(e,t,n,o){if(1===t&&1===n)return e;var a,s;o=o||r.centre(e);for(var l=0;l<e.length;l++)a=e[l],s=i.sub(a,o),e[l].x=o.x+s.x*t,e[l].y=o.y+s.y*n;return e},r.chamfer=function(e,t,n,r,a){t="number"===typeof t?[t]:t||[8],n="undefined"!==typeof n?n:-1,r=r||2,a=a||14;for(var s=[],l=0;l<e.length;l++){var u=e[l-1>=0?l-1:e.length-1],c=e[l],h=e[(l+1)%e.length],d=t[l<t.length?l:t.length-1];if(0!==d){var f=i.normalise({x:c.y-u.y,y:u.x-c.x}),p=i.normalise({x:h.y-c.y,y:c.x-h.x}),m=Math.sqrt(2*Math.pow(d,2)),g=i.mult(o.clone(f),d),_=i.normalise(i.mult(i.add(f,p),.5)),v=i.sub(c,i.mult(_,m)),y=n;-1===n&&(y=1.75*Math.pow(d,.32)),(y=o.clamp(y,r,a))%2===1&&(y+=1);for(var b=Math.acos(i.dot(f,p)),E=b/y,x=0;x<y;x++)s.push(i.add(i.rotate(g,E*x),v))}else s.push(c)}return s},r.clockwiseSort=function(e){var t=r.mean(e);return e.sort(function(e,n){return i.angle(t,e)-i.angle(t,n)}),e},r.isConvex=function(e){var t,n,r,i,o=0,a=e.length;if(a<3)return null;for(t=0;t<a;t++)if(r=(t+2)%a,i=(e[n=(t+1)%a].x-e[t].x)*(e[r].y-e[n].y),(i-=(e[n].y-e[t].y)*(e[r].x-e[n].x))<0?o|=1:i>0&&(o|=2),3===o)return!1;return 0!==o||null},r.hull=function(e){var t,n,r=[],o=[];for((e=e.slice(0)).sort(function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y}),n=0;n<e.length;n+=1){for(t=e[n];o.length>=2&&i.cross3(o[o.length-2],o[o.length-1],t)<=0;)o.pop();o.push(t)}for(n=e.length-1;n>=0;n-=1){for(t=e[n];r.length>=2&&i.cross3(r[r.length-2],r[r.length-1],t)<=0;)r.pop();r.push(t)}return r.pop(),o.pop(),r.concat(o)}},{"../core/Common":14,"../geometry/Vector":28}],30:[function(e,t,n){var r=t.exports=e("../core/Matter");r.Body=e("../body/Body"),r.Composite=e("../body/Composite"),r.World=e("../body/World"),r.Contact=e("../collision/Contact"),r.Detector=e("../collision/Detector"),r.Grid=e("../collision/Grid"),r.Pairs=e("../collision/Pairs"),r.Pair=e("../collision/Pair"),r.Query=e("../collision/Query"),r.Resolver=e("../collision/Resolver"),r.SAT=e("../collision/SAT"),r.Constraint=e("../constraint/Constraint"),r.MouseConstraint=e("../constraint/MouseConstraint"),r.Common=e("../core/Common"),r.Engine=e("../core/Engine"),r.Events=e("../core/Events"),r.Mouse=e("../core/Mouse"),r.Runner=e("../core/Runner"),r.Sleeping=e("../core/Sleeping"),r.Plugin=e("../core/Plugin"),r.Bodies=e("../factory/Bodies"),r.Composites=e("../factory/Composites"),r.Axes=e("../geometry/Axes"),r.Bounds=e("../geometry/Bounds"),r.Svg=e("../geometry/Svg"),r.Vector=e("../geometry/Vector"),r.Vertices=e("../geometry/Vertices"),r.Render=e("../render/Render"),r.RenderPixi=e("../render/RenderPixi"),r.World.add=r.Composite.add,r.World.remove=r.Composite.remove,r.World.addComposite=r.Composite.addComposite,r.World.addBody=r.Composite.addBody,r.World.addConstraint=r.Composite.addConstraint,r.World.clear=r.Composite.clear,r.Engine.run=r.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Matter":17,"../core/Metrics":18,"../core/Mouse":19,"../core/Plugin":20,"../core/Runner":21,"../core/Sleeping":22,"../factory/Bodies":23,"../factory/Composites":24,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Svg":27,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31,"../render/RenderPixi":32}],31:[function(e,t,n){var r={};t.exports=r;var i=e("../core/Common"),o=e("../body/Composite"),a=e("../geometry/Bounds"),s=e("../core/Events"),l=e("../collision/Grid"),u=e("../geometry/Vector"),c=e("../core/Mouse");!function(){var e,t;"undefined"!==typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(i.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),r.create=function(e){var t={controller:r,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#18181d",wireframeBackground:"#0f0f13",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},o=i.extend(t,e);return o.canvas&&(o.canvas.width=o.options.width||o.canvas.width,o.canvas.height=o.options.height||o.canvas.height),o.mouse=e.mouse,o.engine=e.engine,o.canvas=o.canvas||n(o.options.width,o.options.height),o.context=o.canvas.getContext("2d"),o.textures={},o.bounds=o.bounds||{min:{x:0,y:0},max:{x:o.canvas.width,y:o.canvas.height}},1!==o.options.pixelRatio&&r.setPixelRatio(o,o.options.pixelRatio),i.isElement(o.element)?o.element.appendChild(o.canvas):o.canvas.parentNode||i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),o},r.run=function(t){!function n(i){t.frameRequestId=e(n),r.world(t)}()},r.stop=function(e){t(e.frameRequestId)},r.setPixelRatio=function(e,t){var n=e.options,r=e.canvas;"auto"===t&&(t=h(r)),n.pixelRatio=t,r.setAttribute("data-pixel-ratio",t),r.width=n.width*t,r.height=n.height*t,r.style.width=n.width+"px",r.style.height=n.height+"px",e.context.scale(t,t)},r.lookAt=function(e,t,n,r){r="undefined"===typeof r||r,t=i.isArray(t)?t:[t],n=n||{x:0,y:0};for(var o={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},a=0;a<t.length;a+=1){var s=t[a],l=s.bounds?s.bounds.min:s.min||s.position||s,u=s.bounds?s.bounds.max:s.max||s.position||s;l&&u&&(l.x<o.min.x&&(o.min.x=l.x),u.x>o.max.x&&(o.max.x=u.x),l.y<o.min.y&&(o.min.y=l.y),u.y>o.max.y&&(o.max.y=u.y))}var h=o.max.x-o.min.x+2*n.x,d=o.max.y-o.min.y+2*n.y,f=e.canvas.height,p=e.canvas.width,m=p/f,g=h/d,_=1,v=1;g>m?v=g/m:_=m/g,e.options.hasBounds=!0,e.bounds.min.x=o.min.x,e.bounds.max.x=o.min.x+h*_,e.bounds.min.y=o.min.y,e.bounds.max.y=o.min.y+d*v,r&&(e.bounds.min.x+=.5*h-h*_*.5,e.bounds.max.x+=.5*h-h*_*.5,e.bounds.min.y+=.5*d-d*v*.5,e.bounds.max.y+=.5*d-d*v*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),c.setOffset(e.mouse,e.bounds.min))},r.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,r=t/e.options.width,i=n/e.options.height;e.context.scale(1/r,1/i),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},r.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},r.world=function(e){var t,n=e.engine,i=n.world,h=e.canvas,d=e.context,p=e.options,m=o.allBodies(i),g=o.allConstraints(i),_=p.wireframes?p.wireframeBackground:p.background,v=[],y=[],b={timestamp:n.timing.timestamp};if(s.trigger(e,"beforeRender",b),e.currentBackground!==_&&f(e,_),d.globalCompositeOperation="source-in",d.fillStyle="transparent",d.fillRect(0,0,h.width,h.height),d.globalCompositeOperation="source-over",p.hasBounds){for(t=0;t<m.length;t++){var E=m[t];a.overlaps(E.bounds,e.bounds)&&v.push(E)}for(t=0;t<g.length;t++){var x=g[t],T=x.bodyA,S=x.bodyB,A=x.pointA,P=x.pointB;T&&(A=u.add(T.position,x.pointA)),S&&(P=u.add(S.position,x.pointB)),A&&P&&(a.contains(e.bounds,A)||a.contains(e.bounds,P))&&y.push(x)}r.startViewTransform(e),e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),c.setOffset(e.mouse,e.bounds.min))}else y=g,v=m;!p.wireframes||n.enableSleeping&&p.showSleeping?r.bodies(e,v,d):(p.showConvexHulls&&r.bodyConvexHulls(e,v,d),r.bodyWireframes(e,v,d)),p.showBounds&&r.bodyBounds(e,v,d),(p.showAxes||p.showAngleIndicator)&&r.bodyAxes(e,v,d),p.showPositions&&r.bodyPositions(e,v,d),p.showVelocity&&r.bodyVelocity(e,v,d),p.showIds&&r.bodyIds(e,v,d),p.showSeparations&&r.separations(e,n.pairs.list,d),p.showCollisions&&r.collisions(e,n.pairs.list,d),p.showVertexNumbers&&r.vertexNumbers(e,v,d),p.showMousePosition&&r.mousePosition(e,e.mouse,d),r.constraints(y,d),p.showBroadphase&&n.broadphase.controller===l&&r.grid(e,n.broadphase,d),p.showDebug&&r.debug(e,d),p.hasBounds&&r.endViewTransform(e),s.trigger(e,"afterRender",b)},r.debug=function(e,t){var n=t,r=e.engine,i=r.world,a=r.metrics,s=e.options;if(o.allBodies(i),r.timing.timestamp-(e.debugTimestamp||0)>=500){var l="";a.timing&&(l+="fps: "+Math.round(a.timing.fps)+"    "),e.debugString=l,e.debugTimestamp=r.timing.timestamp}if(e.debugString){n.font="12px Arial",s.wireframes?n.fillStyle="rgba(255,255,255,0.5)":n.fillStyle="rgba(0,0,0,0.5)";for(var u=e.debugString.split("\n"),c=0;c<u.length;c++)n.fillText(u[c],50,50+18*c)}},r.constraints=function(e,t){for(var n=t,r=0;r<e.length;r++){var o=e[r];if(o.render.visible&&o.pointA&&o.pointB){var a,s,l=o.bodyA,c=o.bodyB;if(a=l?u.add(l.position,o.pointA):o.pointA,"pin"===o.render.type)n.beginPath(),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath();else{if(s=c?u.add(c.position,o.pointB):o.pointB,n.beginPath(),n.moveTo(a.x,a.y),"spring"===o.render.type)for(var h,d=u.sub(s,a),f=u.perp(u.normalise(d)),p=Math.ceil(i.clamp(o.length/5,12,20)),m=1;m<p;m+=1)h=m%2===0?1:-1,n.lineTo(a.x+d.x*(m/p)+f.x*h*4,a.y+d.y*(m/p)+f.y*h*4);n.lineTo(s.x,s.y)}o.render.lineWidth&&(n.lineWidth=o.render.lineWidth,n.strokeStyle=o.render.strokeStyle,n.stroke()),o.render.anchors&&(n.fillStyle=o.render.strokeStyle,n.beginPath(),n.arc(a.x,a.y,3,0,2*Math.PI),n.arc(s.x,s.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},r.bodyShadows=function(e,t,n){for(var r=n,i=(e.engine,0);i<t.length;i++){var o=t[i];if(o.render.visible){if(o.circleRadius)r.beginPath(),r.arc(o.position.x,o.position.y,o.circleRadius,0,2*Math.PI),r.closePath();else{r.beginPath(),r.moveTo(o.vertices[0].x,o.vertices[0].y);for(var a=1;a<o.vertices.length;a++)r.lineTo(o.vertices[a].x,o.vertices[a].y);r.closePath()}var s=o.position.x-.5*e.options.width,l=o.position.y-.2*e.options.height,u=Math.abs(s)+Math.abs(l);r.shadowColor="rgba(0,0,0,0.15)",r.shadowOffsetX=.05*s,r.shadowOffsetY=.05*l,r.shadowBlur=1+12*Math.min(1,u/1e3),r.fill(),r.shadowColor=null,r.shadowOffsetX=null,r.shadowOffsetY=null,r.shadowBlur=null}}},r.bodies=function(e,t,n){var r,i,o,a,s=n,l=(e.engine,e.options),u=l.showInternalEdges||!l.wireframes;for(o=0;o<t.length;o++)if((r=t[o]).render.visible)for(a=r.parts.length>1?1:0;a<r.parts.length;a++)if((i=r.parts[a]).render.visible){if(l.showSleeping&&r.isSleeping?s.globalAlpha=.5*i.render.opacity:1!==i.render.opacity&&(s.globalAlpha=i.render.opacity),i.render.sprite&&i.render.sprite.texture&&!l.wireframes){var c=i.render.sprite,h=d(e,c.texture);s.translate(i.position.x,i.position.y),s.rotate(i.angle),s.drawImage(h,h.width*-c.xOffset*c.xScale,h.height*-c.yOffset*c.yScale,h.width*c.xScale,h.height*c.yScale),s.rotate(-i.angle),s.translate(-i.position.x,-i.position.y)}else{if(i.circleRadius)s.beginPath(),s.arc(i.position.x,i.position.y,i.circleRadius,0,2*Math.PI);else{s.beginPath(),s.moveTo(i.vertices[0].x,i.vertices[0].y);for(var f=1;f<i.vertices.length;f++)!i.vertices[f-1].isInternal||u?s.lineTo(i.vertices[f].x,i.vertices[f].y):s.moveTo(i.vertices[f].x,i.vertices[f].y),i.vertices[f].isInternal&&!u&&s.moveTo(i.vertices[(f+1)%i.vertices.length].x,i.vertices[(f+1)%i.vertices.length].y);s.lineTo(i.vertices[0].x,i.vertices[0].y),s.closePath()}l.wireframes?(s.lineWidth=1,s.strokeStyle="#bbb",s.stroke()):(s.fillStyle=i.render.fillStyle,i.render.lineWidth&&(s.lineWidth=i.render.lineWidth,s.strokeStyle=i.render.strokeStyle,s.stroke()),s.fill())}s.globalAlpha=1}},r.bodyWireframes=function(e,t,n){var r,i,o,a,s,l=n,u=e.options.showInternalEdges;for(l.beginPath(),o=0;o<t.length;o++)if((r=t[o]).render.visible)for(s=r.parts.length>1?1:0;s<r.parts.length;s++){for(i=r.parts[s],l.moveTo(i.vertices[0].x,i.vertices[0].y),a=1;a<i.vertices.length;a++)!i.vertices[a-1].isInternal||u?l.lineTo(i.vertices[a].x,i.vertices[a].y):l.moveTo(i.vertices[a].x,i.vertices[a].y),i.vertices[a].isInternal&&!u&&l.moveTo(i.vertices[(a+1)%i.vertices.length].x,i.vertices[(a+1)%i.vertices.length].y);l.lineTo(i.vertices[0].x,i.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},r.bodyConvexHulls=function(e,t,n){var r,i,o,a=n;for(a.beginPath(),i=0;i<t.length;i++)if((r=t[i]).render.visible&&1!==r.parts.length){for(a.moveTo(r.vertices[0].x,r.vertices[0].y),o=1;o<r.vertices.length;o++)a.lineTo(r.vertices[o].x,r.vertices[o].y);a.lineTo(r.vertices[0].x,r.vertices[0].y)}a.lineWidth=1,a.strokeStyle="rgba(255,255,255,0.2)",a.stroke()},r.vertexNumbers=function(e,t,n){var r,i,o,a=n;for(r=0;r<t.length;r++){var s=t[r].parts;for(o=s.length>1?1:0;o<s.length;o++){var l=s[o];for(i=0;i<l.vertices.length;i++)a.fillStyle="rgba(255,255,255,0.2)",a.fillText(r+"_"+i,l.position.x+.8*(l.vertices[i].x-l.position.x),l.position.y+.8*(l.vertices[i].y-l.position.y))}}},r.mousePosition=function(e,t,n){var r=n;r.fillStyle="rgba(255,255,255,0.8)",r.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},r.bodyBounds=function(e,t,n){var r=n,i=(e.engine,e.options);r.beginPath();for(var o=0;o<t.length;o++){var a=t[o];if(a.render.visible)for(var s=t[o].parts,l=s.length>1?1:0;l<s.length;l++){var u=s[l];r.rect(u.bounds.min.x,u.bounds.min.y,u.bounds.max.x-u.bounds.min.x,u.bounds.max.y-u.bounds.min.y)}}i.wireframes?r.strokeStyle="rgba(255,255,255,0.08)":r.strokeStyle="rgba(0,0,0,0.1)",r.lineWidth=1,r.stroke()},r.bodyAxes=function(e,t,n){var r,i,o,a,s=n,l=(e.engine,e.options);for(s.beginPath(),i=0;i<t.length;i++){var u=t[i],c=u.parts;if(u.render.visible)if(l.showAxes)for(o=c.length>1?1:0;o<c.length;o++)for(r=c[o],a=0;a<r.axes.length;a++){var h=r.axes[a];s.moveTo(r.position.x,r.position.y),s.lineTo(r.position.x+20*h.x,r.position.y+20*h.y)}else for(o=c.length>1?1:0;o<c.length;o++)for(r=c[o],a=0;a<r.axes.length;a++)s.moveTo(r.position.x,r.position.y),s.lineTo((r.vertices[0].x+r.vertices[r.vertices.length-1].x)/2,(r.vertices[0].y+r.vertices[r.vertices.length-1].y)/2)}l.wireframes?(s.strokeStyle="indianred",s.lineWidth=1):(s.strokeStyle="rgba(255, 255, 255, 0.4)",s.globalCompositeOperation="overlay",s.lineWidth=2),s.stroke(),s.globalCompositeOperation="source-over"},r.bodyPositions=function(e,t,n){var r,i,o,a,s=n,l=(e.engine,e.options);for(s.beginPath(),o=0;o<t.length;o++)if((r=t[o]).render.visible)for(a=0;a<r.parts.length;a++)i=r.parts[a],s.arc(i.position.x,i.position.y,3,0,2*Math.PI,!1),s.closePath();for(l.wireframes?s.fillStyle="indianred":s.fillStyle="rgba(0,0,0,0.5)",s.fill(),s.beginPath(),o=0;o<t.length;o++)(r=t[o]).render.visible&&(s.arc(r.positionPrev.x,r.positionPrev.y,2,0,2*Math.PI,!1),s.closePath());s.fillStyle="rgba(255,165,0,0.8)",s.fill()},r.bodyVelocity=function(e,t,n){var r=n;r.beginPath();for(var i=0;i<t.length;i++){var o=t[i];o.render.visible&&(r.moveTo(o.position.x,o.position.y),r.lineTo(o.position.x+2*(o.position.x-o.positionPrev.x),o.position.y+2*(o.position.y-o.positionPrev.y)))}r.lineWidth=3,r.strokeStyle="cornflowerblue",r.stroke()},r.bodyIds=function(e,t,n){var r,i,o=n;for(r=0;r<t.length;r++)if(t[r].render.visible){var a=t[r].parts;for(i=a.length>1?1:0;i<a.length;i++){var s=a[i];o.font="12px Arial",o.fillStyle="rgba(255,255,255,0.5)",o.fillText(s.id,s.position.x+10,s.position.y-10)}}},r.collisions=function(e,t,n){var r,i,o,a,s=n,l=e.options;for(s.beginPath(),o=0;o<t.length;o++)if((r=t[o]).isActive)for(i=r.collision,a=0;a<r.activeContacts.length;a++){var u=r.activeContacts[a],c=u.vertex;s.rect(c.x-1.5,c.y-1.5,3.5,3.5)}for(l.wireframes?s.fillStyle="rgba(255,255,255,0.7)":s.fillStyle="orange",s.fill(),s.beginPath(),o=0;o<t.length;o++)if((r=t[o]).isActive&&(i=r.collision,r.activeContacts.length>0)){var h=r.activeContacts[0].vertex.x,d=r.activeContacts[0].vertex.y;2===r.activeContacts.length&&(h=(r.activeContacts[0].vertex.x+r.activeContacts[1].vertex.x)/2,d=(r.activeContacts[0].vertex.y+r.activeContacts[1].vertex.y)/2),i.bodyB===i.supports[0].body||!0===i.bodyA.isStatic?s.moveTo(h-8*i.normal.x,d-8*i.normal.y):s.moveTo(h+8*i.normal.x,d+8*i.normal.y),s.lineTo(h,d)}l.wireframes?s.strokeStyle="rgba(255,165,0,0.7)":s.strokeStyle="orange",s.lineWidth=1,s.stroke()},r.separations=function(e,t,n){var r,i,o,a,s,l=n,u=e.options;for(l.beginPath(),s=0;s<t.length;s++)if((r=t[s]).isActive){i=r.collision,o=i.bodyA,a=i.bodyB;var c=1;a.isStatic||o.isStatic||(c=.5),a.isStatic&&(c=0),l.moveTo(a.position.x,a.position.y),l.lineTo(a.position.x-i.penetration.x*c,a.position.y-i.penetration.y*c),c=1,a.isStatic||o.isStatic||(c=.5),o.isStatic&&(c=0),l.moveTo(o.position.x,o.position.y),l.lineTo(o.position.x+i.penetration.x*c,o.position.y+i.penetration.y*c)}u.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},r.grid=function(e,t,n){var r=n,o=e.options;o.wireframes?r.strokeStyle="rgba(255,180,0,0.1)":r.strokeStyle="rgba(255,180,0,0.5)",r.beginPath();for(var a=i.keys(t.buckets),s=0;s<a.length;s++){var l=a[s];if(!(t.buckets[l].length<2)){var u=l.split(/C|R/);r.rect(.5+parseInt(u[1],10)*t.bucketWidth,.5+parseInt(u[2],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}r.lineWidth=1,r.stroke()},r.inspector=function(e,t){e.engine;var n,r=e.selected,i=e.render,o=i.options;if(o.hasBounds){var a=i.bounds.max.x-i.bounds.min.x,s=i.bounds.max.y-i.bounds.min.y,l=a/i.options.width,u=s/i.options.height;t.scale(1/l,1/u),t.translate(-i.bounds.min.x,-i.bounds.min.y)}for(var c=0;c<r.length;c++){var h=r[c].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),h.type){case"body":n=h.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var d=h.pointA;h.bodyA&&(d=h.pointB),t.beginPath(),t.arc(d.x,d.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),o.hasBounds&&t.setTransform(1,0,0,1,0,0)};var n=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},h=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/r},d=function(e,t){var n=e.textures[t];return n||((n=e.textures[t]=new Image).src=t,n)},f=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../geometry/Bounds":26,"../geometry/Vector":28}],32:[function(e,t,n){var r={};t.exports=r;var i=e("../geometry/Bounds"),o=e("../body/Composite"),a=e("../core/Common"),s=e("../core/Events"),l=e("../geometry/Vector");!function(){var e,t;"undefined"!==typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(a.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),r.create=function(e){a.warn("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)");var t={controller:r,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},n=a.extend(t,e),i=!n.options.wireframes&&"transparent"===n.options.background;return n.pixiOptions=n.pixiOptions||{view:n.canvas,transparent:i,antialias:!0,backgroundColor:e.background},n.mouse=e.mouse,n.engine=e.engine,n.renderer=n.renderer||new PIXI.WebGLRenderer(n.options.width,n.options.height,n.pixiOptions),n.container=n.container||new PIXI.Container,n.spriteContainer=n.spriteContainer||new PIXI.Container,n.canvas=n.canvas||n.renderer.view,n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.options.width,y:n.options.height}},s.on(n.engine,"beforeUpdate",function(){r.clear(n)}),n.textures={},n.sprites={},n.primitives={},n.container.addChild(n.spriteContainer),a.isElement(n.element)?n.element.appendChild(n.canvas):a.warn('No "render.element" passed, "render.canvas" was not inserted into document.'),n.canvas.oncontextmenu=function(){return!1},n.canvas.onselectstart=function(){return!1},n},r.run=function(t){!function n(i){t.frameRequestId=e(n),r.world(t)}()},r.stop=function(e){t(e.frameRequestId)},r.clear=function(e){for(var t=e.container,n=e.spriteContainer;t.children[0];)t.removeChild(t.children[0]);for(;n.children[0];)n.removeChild(n.children[0]);var r=e.sprites["bg-0"];e.textures={},e.sprites={},e.primitives={},e.sprites["bg-0"]=r,r&&t.addChildAt(r,0),e.container.addChild(e.spriteContainer),e.currentBackground=null,t.scale.set(1,1),t.position.set(0,0)},r.setBackground=function(e,t){if(e.currentBackground!==t){var n=t.indexOf&&-1!==t.indexOf("#"),r=e.sprites["bg-0"];if(n){var i=a.colorToNumber(t);e.renderer.backgroundColor=i,r&&e.container.removeChild(r)}else if(!r){var o=c(e,t);(r=e.sprites["bg-0"]=new PIXI.Sprite(o)).position.x=0,r.position.y=0,e.container.addChildAt(r,0)}e.currentBackground=t}},r.world=function(e){var t,n=e.engine,a=n.world,s=e.renderer,u=e.container,c=e.options,h=o.allBodies(a),d=o.allConstraints(a),f=[];c.wireframes?r.setBackground(e,c.wireframeBackground):r.setBackground(e,c.background);var p=e.bounds.max.x-e.bounds.min.x,m=e.bounds.max.y-e.bounds.min.y,g=p/e.options.width,_=m/e.options.height;if(c.hasBounds){for(t=0;t<h.length;t++){var v=h[t];v.render.sprite.visible=i.overlaps(v.bounds,e.bounds)}for(t=0;t<d.length;t++){var y=d[t],b=y.bodyA,E=y.bodyB,x=y.pointA,T=y.pointB;b&&(x=l.add(b.position,y.pointA)),E&&(T=l.add(E.position,y.pointB)),x&&T&&(i.contains(e.bounds,x)||i.contains(e.bounds,T))&&f.push(y)}u.scale.set(1/g,1/_),u.position.set(-e.bounds.min.x*(1/g),-e.bounds.min.y*(1/_))}else f=d;for(t=0;t<h.length;t++)r.body(e,h[t]);for(t=0;t<f.length;t++)r.constraint(e,f[t]);s.render(u)},r.constraint=function(e,t){e.engine;var n=t.bodyA,r=t.bodyB,i=t.pointA,o=t.pointB,s=e.container,l=t.render,u="c-"+t.id,c=e.primitives[u];c||(c=e.primitives[u]=new PIXI.Graphics),l.visible&&t.pointA&&t.pointB?(-1===a.indexOf(s.children,c)&&s.addChild(c),c.clear(),c.beginFill(0,0),c.lineStyle(l.lineWidth,a.colorToNumber(l.strokeStyle),1),n?c.moveTo(n.position.x+i.x,n.position.y+i.y):c.moveTo(i.x,i.y),r?c.lineTo(r.position.x+o.x,r.position.y+o.y):c.lineTo(o.x,o.y),c.endFill()):c.clear()},r.body=function(e,t){e.engine;var r=t.render;if(r.visible)if(r.sprite&&r.sprite.texture){var i="b-"+t.id,o=e.sprites[i],s=e.spriteContainer;o||(o=e.sprites[i]=n(e,t)),-1===a.indexOf(s.children,o)&&s.addChild(o),o.position.x=t.position.x,o.position.y=t.position.y,o.rotation=t.angle,o.scale.x=r.sprite.xScale||1,o.scale.y=r.sprite.yScale||1}else{var l="b-"+t.id,c=e.primitives[l],h=e.container;c||((c=e.primitives[l]=u(e,t)).initialAngle=t.angle),-1===a.indexOf(h.children,c)&&h.addChild(c),c.position.x=t.position.x,c.position.y=t.position.y,c.rotation=t.angle-c.initialAngle}};var n=function(e,t){var n=t.render,r=n.sprite.texture,i=c(e,r),o=new PIXI.Sprite(i);return o.anchor.x=t.render.sprite.xOffset,o.anchor.y=t.render.sprite.yOffset,o},u=function(e,t){var n,r=t.render,i=e.options,o=new PIXI.Graphics,s=a.colorToNumber(r.fillStyle),l=a.colorToNumber(r.strokeStyle),u=a.colorToNumber(r.strokeStyle),c=a.colorToNumber("#bbb"),h=a.colorToNumber("#CD5C5C");o.clear();for(var d=t.parts.length>1?1:0;d<t.parts.length;d++){n=t.parts[d],i.wireframes?(o.beginFill(0,0),o.lineStyle(1,c,1)):(o.beginFill(s,1),o.lineStyle(r.lineWidth,l,1)),o.moveTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y);for(var f=1;f<n.vertices.length;f++)o.lineTo(n.vertices[f].x-t.position.x,n.vertices[f].y-t.position.y);o.lineTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y),o.endFill(),(i.showAngleIndicator||i.showAxes)&&(o.beginFill(0,0),i.wireframes?o.lineStyle(1,h,1):o.lineStyle(1,u),o.moveTo(n.position.x-t.position.x,n.position.y-t.position.y),o.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2-t.position.x,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2-t.position.y),o.endFill())}return o},c=function(e,t){var n=e.textures[t];return n||(n=e.textures[t]=PIXI.Texture.fromImage(t)),n}}()},{"../body/Composite":2,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"../geometry/Vector":28}]},{},[30])(30)}).call(this,n(31))},function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";var r=!0,i="Invariant failed";t.a=function(e,t){if(!e)throw r?new Error(i):new Error(i+": "+(t||""))}},function(e,t,n){"use strict";var r=n(10);function i(e){return"/"===e.charAt(0)}function o(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e&&e.split("/")||[],r=t&&t.split("/")||[],a=e&&i(e),s=t&&i(t),l=a||s;if(e&&i(e)?r=n:n.length&&(r.pop(),r=r.concat(n)),!r.length)return"/";var u=void 0;if(r.length){var c=r[r.length-1];u="."===c||".."===c||""===c}else u=!1;for(var h=0,d=r.length;d>=0;d--){var f=r[d];"."===f?o(r,d):".."===f?(o(r,d),h++):h&&(o(r,d),h--)}if(!l)for(;h--;h)r.unshift("..");!l||""===r[0]||r[0]&&i(r[0])||r.unshift("");var p=r.join("/");return u&&"/"!==p.substr(-1)&&(p+="/"),p},s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var l=function e(t,n){if(t===n)return!0;if(null==t||null==n)return!1;if(Array.isArray(t))return Array.isArray(n)&&t.length===n.length&&t.every(function(t,r){return e(t,n[r])});var r="undefined"===typeof t?"undefined":s(t);if(r!==("undefined"===typeof n?"undefined":s(n)))return!1;if("object"===r){var i=t.valueOf(),o=n.valueOf();if(i!==t||o!==n)return e(i,o);var a=Object.keys(t),l=Object.keys(n);return a.length===l.length&&a.every(function(r){return e(t[r],n[r])})}return!1},u=n(14);function c(e){return"/"===e.charAt(0)?e:"/"+e}function h(e){return"/"===e.charAt(0)?e.substr(1):e}function d(e,t){return function(e,t){return new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(e)}(e,t)?e.substr(t.length):e}function f(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}function p(e){var t=e.pathname,n=e.search,r=e.hash,i=t||"/";return n&&"?"!==n&&(i+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(i+="#"===r.charAt(0)?r:"#"+r),i}function m(e,t,n,i){var o;"string"===typeof e?(o=function(e){var t=e||"/",n="",r="",i=t.indexOf("#");-1!==i&&(r=t.substr(i),t=t.substr(0,i));var o=t.indexOf("?");return-1!==o&&(n=t.substr(o),t=t.substr(0,o)),{pathname:t,search:"?"===n?"":n,hash:"#"===r?"":r}}(e)).state=t:(void 0===(o=Object(r.a)({},e)).pathname&&(o.pathname=""),o.search?"?"!==o.search.charAt(0)&&(o.search="?"+o.search):o.search="",o.hash?"#"!==o.hash.charAt(0)&&(o.hash="#"+o.hash):o.hash="",void 0!==t&&void 0===o.state&&(o.state=t));try{o.pathname=decodeURI(o.pathname)}catch(s){throw s instanceof URIError?new URIError('Pathname "'+o.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):s}return n&&(o.key=n),i?o.pathname?"/"!==o.pathname.charAt(0)&&(o.pathname=a(o.pathname,i.pathname)):o.pathname=i.pathname:o.pathname||(o.pathname="/"),o}function g(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash&&e.key===t.key&&l(e.state,t.state)}function _(){var e=null;var t=[];return{setPrompt:function(t){return e=t,function(){e===t&&(e=null)}},confirmTransitionTo:function(t,n,r,i){if(null!=e){var o="function"===typeof e?e(t,n):e;"string"===typeof o?"function"===typeof r?r(o,i):i(!0):i(!1!==o)}else i(!0)},appendListener:function(e){var n=!0;function r(){n&&e.apply(void 0,arguments)}return t.push(r),function(){n=!1,t=t.filter(function(e){return e!==r})}},notifyListeners:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.forEach(function(e){return e.apply(void 0,n)})}}}n.d(t,"a",function(){return T}),n.d(t,"b",function(){return R}),n.d(t,"d",function(){return w}),n.d(t,"c",function(){return m}),n.d(t,"f",function(){return g}),n.d(t,"e",function(){return p});var v=!("undefined"===typeof window||!window.document||!window.document.createElement);function y(e,t){t(window.confirm(e))}var b="popstate",E="hashchange";function x(){try{return window.history.state||{}}catch(e){return{}}}function T(e){void 0===e&&(e={}),v||Object(u.a)(!1);var t=window.history,n=function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history}(),i=!(-1===window.navigator.userAgent.indexOf("Trident")),o=e,a=o.forceRefresh,s=void 0!==a&&a,l=o.getUserConfirmation,h=void 0===l?y:l,g=o.keyLength,T=void 0===g?6:g,S=e.basename?f(c(e.basename)):"";function A(e){var t=e||{},n=t.key,r=t.state,i=window.location,o=i.pathname+i.search+i.hash;return S&&(o=d(o,S)),m(o,r,n)}function P(){return Math.random().toString(36).substr(2,T)}var M=_();function R(e){Object(r.a)(V,e),V.length=t.length,M.notifyListeners(V.location,V.action)}function C(e){(function(e){void 0===e.state&&navigator.userAgent.indexOf("CriOS")})(e)||I(A(e.state))}function w(){I(A(x()))}var O=!1;function I(e){if(O)O=!1,R();else{M.confirmTransitionTo(e,"POP",h,function(t){t?R({action:"POP",location:e}):function(e){var t=V.location,n=L.indexOf(t.key);-1===n&&(n=0);var r=L.indexOf(e.key);-1===r&&(r=0);var i=n-r;i&&(O=!0,N(i))}(e)})}}var D=A(x()),L=[D.key];function F(e){return S+p(e)}function N(e){t.go(e)}var B=0;function U(e){1===(B+=e)&&1===e?(window.addEventListener(b,C),i&&window.addEventListener(E,w)):0===B&&(window.removeEventListener(b,C),i&&window.removeEventListener(E,w))}var k=!1;var V={length:t.length,action:"POP",location:D,createHref:F,push:function(e,r){var i=m(e,r,P(),V.location);M.confirmTransitionTo(i,"PUSH",h,function(e){if(e){var r=F(i),o=i.key,a=i.state;if(n)if(t.pushState({key:o,state:a},null,r),s)window.location.href=r;else{var l=L.indexOf(V.location.key),u=L.slice(0,-1===l?0:l+1);u.push(i.key),L=u,R({action:"PUSH",location:i})}else window.location.href=r}})},replace:function(e,r){var i=m(e,r,P(),V.location);M.confirmTransitionTo(i,"REPLACE",h,function(e){if(e){var r=F(i),o=i.key,a=i.state;if(n)if(t.replaceState({key:o,state:a},null,r),s)window.location.replace(r);else{var l=L.indexOf(V.location.key);-1!==l&&(L[l]=i.key),R({action:"REPLACE",location:i})}else window.location.replace(r)}})},go:N,goBack:function(){N(-1)},goForward:function(){N(1)},block:function(e){void 0===e&&(e=!1);var t=M.setPrompt(e);return k||(U(1),k=!0),function(){return k&&(k=!1,U(-1)),t()}},listen:function(e){var t=M.appendListener(e);return U(1),function(){U(-1),t()}}};return V}var S="hashchange",A={hashbang:{encodePath:function(e){return"!"===e.charAt(0)?e:"!/"+h(e)},decodePath:function(e){return"!"===e.charAt(0)?e.substr(1):e}},noslash:{encodePath:h,decodePath:c},slash:{encodePath:c,decodePath:c}};function P(){var e=window.location.href,t=e.indexOf("#");return-1===t?"":e.substring(t+1)}function M(e){var t=window.location.href.indexOf("#");window.location.replace(window.location.href.slice(0,t>=0?t:0)+"#"+e)}function R(e){void 0===e&&(e={}),v||Object(u.a)(!1);var t=window.history,n=(window.navigator.userAgent.indexOf("Firefox"),e),i=n.getUserConfirmation,o=void 0===i?y:i,a=n.hashType,s=void 0===a?"slash":a,l=e.basename?f(c(e.basename)):"",h=A[s],b=h.encodePath,E=h.decodePath;function x(){var e=E(P());return l&&(e=d(e,l)),m(e)}var T=_();function R(e){Object(r.a)(V,e),V.length=t.length,T.notifyListeners(V.location,V.action)}var C=!1,w=null;function O(){var e=P(),t=b(e);if(e!==t)M(t);else{var n=x(),r=V.location;if(!C&&g(r,n))return;if(w===p(n))return;w=null,function(e){if(C)C=!1,R();else{T.confirmTransitionTo(e,"POP",o,function(t){t?R({action:"POP",location:e}):function(e){var t=V.location,n=F.lastIndexOf(p(t));-1===n&&(n=0);var r=F.lastIndexOf(p(e));-1===r&&(r=0);var i=n-r;i&&(C=!0,N(i))}(e)})}}(n)}}var I=P(),D=b(I);I!==D&&M(D);var L=x(),F=[p(L)];function N(e){t.go(e)}var B=0;function U(e){1===(B+=e)&&1===e?window.addEventListener(S,O):0===B&&window.removeEventListener(S,O)}var k=!1;var V={length:t.length,action:"POP",location:L,createHref:function(e){return"#"+b(l+p(e))},push:function(e,t){var n=m(e,void 0,void 0,V.location);T.confirmTransitionTo(n,"PUSH",o,function(e){if(e){var t=p(n),r=b(l+t);if(P()!==r){w=t,function(e){window.location.hash=e}(r);var i=F.lastIndexOf(p(V.location)),o=F.slice(0,-1===i?0:i+1);o.push(t),F=o,R({action:"PUSH",location:n})}else R()}})},replace:function(e,t){var n=m(e,void 0,void 0,V.location);T.confirmTransitionTo(n,"REPLACE",o,function(e){if(e){var t=p(n),r=b(l+t);P()!==r&&(w=t,M(r));var i=F.indexOf(p(V.location));-1!==i&&(F[i]=t),R({action:"REPLACE",location:n})}})},go:N,goBack:function(){N(-1)},goForward:function(){N(1)},block:function(e){void 0===e&&(e=!1);var t=T.setPrompt(e);return k||(U(1),k=!0),function(){return k&&(k=!1,U(-1)),t()}},listen:function(e){var t=T.appendListener(e);return U(1),function(){U(-1),t()}}};return V}function C(e,t,n){return Math.min(Math.max(e,t),n)}function w(e){void 0===e&&(e={});var t=e,n=t.getUserConfirmation,i=t.initialEntries,o=void 0===i?["/"]:i,a=t.initialIndex,s=void 0===a?0:a,l=t.keyLength,u=void 0===l?6:l,c=_();function h(e){Object(r.a)(b,e),b.length=b.entries.length,c.notifyListeners(b.location,b.action)}function d(){return Math.random().toString(36).substr(2,u)}var f=C(s,0,o.length-1),g=o.map(function(e){return m(e,void 0,"string"===typeof e?d():e.key||d())}),v=p;function y(e){var t=C(b.index+e,0,b.entries.length-1),r=b.entries[t];c.confirmTransitionTo(r,"POP",n,function(e){e?h({action:"POP",location:r,index:t}):h()})}var b={length:g.length,action:"POP",location:g[f],index:f,entries:g,createHref:v,push:function(e,t){var r=m(e,t,d(),b.location);c.confirmTransitionTo(r,"PUSH",n,function(e){if(e){var t=b.index+1,n=b.entries.slice(0);n.length>t?n.splice(t,n.length-t,r):n.push(r),h({action:"PUSH",location:r,index:t,entries:n})}})},replace:function(e,t){var r=m(e,t,d(),b.location);c.confirmTransitionTo(r,"REPLACE",n,function(e){e&&(b.entries[b.index]=r,h({action:"REPLACE",location:r}))})},go:y,goBack:function(){y(-1)},goForward:function(){y(1)},canGo:function(e){var t=b.index+e;return t>=0&&t<b.entries.length},block:function(e){return void 0===e&&(e=!1),c.setPrompt(e)},listen:function(e){return c.appendListener(e)}};return b}},function(e,t,n){"use strict";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}n.d(t,"a",function(){return i})},function(e,t,n){"use strict";var r=n(3),i=n.n(r),o=n(34),a=n.n(o),s=n(24),l=n.n(s),u=n(43),c=n.n(u),h=1073741823;var d=i.a.createContext||function(e,t){var n,i,o="__create-react-context-"+c()()+"__",s=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).emitter=function(e){var t=[];return{on:function(e){t.push(e)},off:function(e){t=t.filter(function(t){return t!==e})},get:function(){return e},set:function(n,r){e=n,t.forEach(function(t){return t(e,r)})}}}(t.props.value),t}a()(n,e);var r=n.prototype;return r.getChildContext=function(){var e;return(e={})[o]=this.emitter,e},r.componentWillReceiveProps=function(e){if(this.props.value!==e.value){var n,r=this.props.value,i=e.value;((o=r)===(a=i)?0!==o||1/o===1/a:o!==o&&a!==a)?n=0:(n="function"===typeof t?t(r,i):h,0!==(n|=0)&&this.emitter.set(e.value,n))}var o,a},r.render=function(){return this.props.children},n}(r.Component);s.childContextTypes=((n={})[o]=l.a.object.isRequired,n);var u=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).state={value:e.getValue()},e.onUpdate=function(t,n){0!==((0|e.observedBits)&n)&&e.setState({value:e.getValue()})},e}a()(n,t);var r=n.prototype;return r.componentWillReceiveProps=function(e){var t=e.observedBits;this.observedBits=void 0===t||null===t?h:t},r.componentDidMount=function(){this.context[o]&&this.context[o].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=void 0===e||null===e?h:e},r.componentWillUnmount=function(){this.context[o]&&this.context[o].off(this.onUpdate)},r.getValue=function(){return this.context[o]?this.context[o].get():e},r.render=function(){return(e=this.props.children,Array.isArray(e)?e[0]:e)(this.state.value);var e},n}(r.Component);return u.contextTypes=((i={})[o]=l.a.object,i),{Provider:s,Consumer:u}},f=n(16),p=n(15),m=n(14),g=n(35),_=n.n(g),v=n(10),y=(n(37),n(23));n(44);n.d(t,"a",function(){return P}),n.d(t,"b",function(){return E}),n.d(t,"d",function(){return A}),n.d(t,"c",function(){return b});var b=function(e){var t=d();return t.displayName=e,t}("Router"),E=function(e){function t(t){var n;return(n=e.call(this,t)||this).state={location:t.history.location},n._isMounted=!1,n._pendingLocation=null,t.staticContext||(n.unlisten=t.history.listen(function(e){n._isMounted?n.setState({location:e}):n._pendingLocation=e})),n}Object(f.a)(t,e),t.computeRootMatch=function(e){return{path:"/",url:"/",params:{},isExact:"/"===e}};var n=t.prototype;return n.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},n.componentWillUnmount=function(){this.unlisten&&this.unlisten()},n.render=function(){return i.a.createElement(b.Provider,{children:this.props.children||null,value:{history:this.props.history,location:this.state.location,match:t.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}})},t}(i.a.Component);i.a.Component;i.a.Component;var x={},T=1e4,S=0;function A(e,t){void 0===t&&(t={}),"string"===typeof t&&(t={path:t});var n=t,r=n.path,i=n.exact,o=void 0!==i&&i,a=n.strict,s=void 0!==a&&a,l=n.sensitive,u=void 0!==l&&l;return[].concat(r).reduce(function(t,n){if(!n)return null;if(t)return t;var r=function(e,t){var n=""+t.end+t.strict+t.sensitive,r=x[n]||(x[n]={});if(r[e])return r[e];var i=[],o={regexp:_()(e,i,t),keys:i};return S<T&&(r[e]=o,S++),o}(n,{end:o,strict:s,sensitive:u}),i=r.regexp,a=r.keys,l=i.exec(e);if(!l)return null;var c=l[0],h=l.slice(1),d=e===c;return o&&!d?null:{path:n,url:"/"===n&&""===c?"/":c,isExact:d,params:a.reduce(function(e,t,n){return e[t.name]=h[n],e},{})}},null)}var P=function(e){function t(){return e.apply(this,arguments)||this}return Object(f.a)(t,e),t.prototype.render=function(){var e=this;return i.a.createElement(b.Consumer,null,function(t){t||Object(m.a)(!1);var n=e.props.location||t.location,r=e.props.computedMatch?e.props.computedMatch:e.props.path?A(n.pathname,e.props):t.match,o=Object(v.a)({},t,{location:n,match:r}),a=e.props,s=a.children,l=a.component,u=a.render;(Array.isArray(s)&&0===s.length&&(s=null),"function"===typeof s)&&(void 0===(s=s(o))&&(s=null));return i.a.createElement(b.Provider,{value:o},s&&!function(e){return 0===i.a.Children.count(e)}(s)?s:o.match?l?i.a.createElement(l,o):u?u(o):null:null)})},t}(i.a.Component);function M(e){return"/"===e.charAt(0)?e:"/"+e}function R(e,t){if(!e)return t;var n=M(e);return 0!==t.pathname.indexOf(n)?t:Object(v.a)({},t,{pathname:t.pathname.substr(n.length)})}function C(e){return"string"===typeof e?e:Object(p.e)(e)}function w(e){return function(){Object(m.a)(!1)}}function O(){}i.a.Component;i.a.Component},function(e,t,n){"use strict";n.d(t,"a",function(){return a});n(1);var r=n(27),i=n(9);function o(e,t,n,a){return(o="undefined"!==typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,o){var a,s=Object(r.a)(e,t);if(s){if((a=Object.getOwnPropertyDescriptor(s,t)).set)return a.set.call(o,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(o,t)){if(!a.writable)return!1;a.value=n,Object.defineProperty(o,t,a)}else Object(i.a)(o,t,n);return!0})(e,t,n,a)}function a(e,t,n,r,i){if(!o(e,t,n,r||e)&&i)throw new Error("failed to set property");return n}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),i=n(11),o=function(e,t,n,o,a){i.a.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=o,this.clearAlpha=void 0!==a?a:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new r.m};o.prototype=Object.assign(Object.create(i.a.prototype),{constructor:o,render:function(e,t,n){var r,i,o=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=i),e.autoClear=o}})},function(e,t,n){"use strict";var r=n(0),i=n(22),o=n(11),a=function(e,t){o.a.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof r.pb?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=r.zb.clone(e.uniforms),this.material=new r.pb({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new o.a.FullScreenQuad(this.material)};a.prototype=Object.assign(Object.create(o.a.prototype),{constructor:a,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}});var s=function(e,t){o.a.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};s.prototype=Object.assign(Object.create(o.a.prototype),{constructor:s,render:function(e,t,n){var r,i,o=e.getContext(),a=e.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(r=0,i=1):(r=1,i=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,r,4294967295),a.buffers.stencil.setClear(i),a.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.buffers.stencil.setLocked(!0)}});var l=function(){o.a.call(this),this.needsSwap=!1};l.prototype=Object.create(o.a.prototype),Object.assign(l.prototype,{render:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}),n.d(t,"a",function(){return u});var u=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:r.H,magFilter:r.H,format:r.lb},o=e.getSize(new r.Ab);this._pixelRatio=e.getPixelRatio(),this._width=o.width,this._height=o.height,(t=new r.Db(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===i.a&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===a&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new a(i.a),this.clock=new r.l};Object.assign(u.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},removePass:function(e){var t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),i=!1,o=this.passes.length;for(n=0;n<o;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var a=this.renderer.getContext(),u=this.renderer.state.buffers.stencil;u.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),u.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==s&&(t instanceof s?i=!0:t instanceof l&&(i=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new r.Ab);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}});var c=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(c.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),c.FullScreenQuad=function(){var e=new r.bb(-1,1,1,-1,0,1),t=new r.eb(2,2),n=function(e){this._mesh=new r.Q(t,e)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,e)}}),n}()},function(e,t,n){"use strict";var r=n(0),i=n(11),o=n(22),a={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new r.m(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")};n.d(t,"a",function(){return s});var s=function(e,t,n,s){i.a.call(this),this.strength=void 0!==t?t:1,this.radius=n,this.threshold=s,this.resolution=void 0!==e?new r.Ab(e.x,e.y):new r.Ab(256,256),this.clearColor=new r.m(0,0,0);var l={minFilter:r.H,magFilter:r.H,format:r.lb};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var u=Math.round(this.resolution.x/2),c=Math.round(this.resolution.y/2);this.renderTargetBright=new r.Db(u,c,l),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var h=0;h<this.nMips;h++){var d=new r.Db(u,c,l);d.texture.name="UnrealBloomPass.h"+h,d.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(d);var f=new r.Db(u,c,l);f.texture.name="UnrealBloomPass.v"+h,f.texture.generateMipmaps=!1,this.renderTargetsVertical.push(f),u=Math.round(u/2),c=Math.round(c/2)}void 0===a&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");var p=a;this.highPassUniforms=r.zb.clone(p.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new r.pb({uniforms:this.highPassUniforms,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,defines:{}}),this.separableBlurMaterials=[];var m=[3,5,7,9,11];for(u=Math.round(this.resolution.x/2),c=Math.round(this.resolution.y/2),h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(m[h])),this.separableBlurMaterials[h].uniforms.texSize.value=new r.Ab(u,c),u=Math.round(u/2),c=Math.round(c/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new r.Bb(1,1,1),new r.Bb(1,1,1),new r.Bb(1,1,1),new r.Bb(1,1,1),new r.Bb(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===o.a&&console.error("THREE.UnrealBloomPass relies on CopyShader");var g=o.a;this.copyUniforms=r.zb.clone(g.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new r.pb({uniforms:this.copyUniforms,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,blending:r.a,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new r.m,this.oldClearAlpha=1,this.basic=new r.R,this.fsQuad=new i.a.FullScreenQuad(null)};s.prototype=Object.assign(Object.create(i.a.prototype),{constructor:s,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var n=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(n,i);for(var o=0;o<this.nMips;o++)this.renderTargetsHorizontal[o].setSize(n,i),this.renderTargetsVertical[o].setSize(n,i),this.separableBlurMaterials[o].uniforms.texSize.value=new r.Ab(n,i),n=Math.round(n/2),i=Math.round(i/2)},render:function(e,t,n,r,i){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var a=this.renderTargetBright,l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[l].uniforms.direction.value=s.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=s.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),a=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o},getSeperableBlurMaterial:function(e){return new r.pb({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new r.Ab(.5,.5)},direction:{value:new r.Ab(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new r.pb({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),s.BlurDirectionX=new r.Ab(1,0),s.BlurDirectionY=new r.Ab(0,1)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,"a",function(){return r})},function(e,t,n){e.exports=n(53)()},function(e,t,n){var r;r=function(){var e=JSON.parse('{"$":"dollar","%":"percent","&":"and","<":"less",">":"greater","|":"or","\xa2":"cent","\xa3":"pound","\xa4":"currency","\xa5":"yen","\xa9":"(c)","\xaa":"a","\xae":"(r)","\xba":"o","\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xc6":"AE","\xc7":"C","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xd0":"D","\xd1":"N","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xdd":"Y","\xde":"TH","\xdf":"ss","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xe6":"ae","\xe7":"c","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xf0":"d","\xf1":"n","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xfd":"y","\xfe":"th","\xff":"y","\u0100":"A","\u0101":"a","\u0102":"A","\u0103":"a","\u0104":"A","\u0105":"a","\u0106":"C","\u0107":"c","\u010c":"C","\u010d":"c","\u010e":"D","\u010f":"d","\u0110":"DJ","\u0111":"dj","\u0112":"E","\u0113":"e","\u0116":"E","\u0117":"e","\u0118":"e","\u0119":"e","\u011a":"E","\u011b":"e","\u011e":"G","\u011f":"g","\u0122":"G","\u0123":"g","\u0128":"I","\u0129":"i","\u012a":"i","\u012b":"i","\u012e":"I","\u012f":"i","\u0130":"I","\u0131":"i","\u0136":"k","\u0137":"k","\u013b":"L","\u013c":"l","\u013d":"L","\u013e":"l","\u0141":"L","\u0142":"l","\u0143":"N","\u0144":"n","\u0145":"N","\u0146":"n","\u0147":"N","\u0148":"n","\u0150":"O","\u0151":"o","\u0152":"OE","\u0153":"oe","\u0154":"R","\u0155":"r","\u0158":"R","\u0159":"r","\u015a":"S","\u015b":"s","\u015e":"S","\u015f":"s","\u0160":"S","\u0161":"s","\u0162":"T","\u0163":"t","\u0164":"T","\u0165":"t","\u0168":"U","\u0169":"u","\u016a":"u","\u016b":"u","\u016e":"U","\u016f":"u","\u0170":"U","\u0171":"u","\u0172":"U","\u0173":"u","\u0179":"Z","\u017a":"z","\u017b":"Z","\u017c":"z","\u017d":"Z","\u017e":"z","\u0192":"f","\u01a0":"O","\u01a1":"o","\u01af":"U","\u01b0":"u","\u01c8":"LJ","\u01c9":"lj","\u01cb":"NJ","\u01cc":"nj","\u0218":"S","\u0219":"s","\u021a":"T","\u021b":"t","\u02da":"o","\u0386":"A","\u0388":"E","\u0389":"H","\u038a":"I","\u038c":"O","\u038e":"Y","\u038f":"W","\u0390":"i","\u0391":"A","\u0392":"B","\u0393":"G","\u0394":"D","\u0395":"E","\u0396":"Z","\u0397":"H","\u0398":"8","\u0399":"I","\u039a":"K","\u039b":"L","\u039c":"M","\u039d":"N","\u039e":"3","\u039f":"O","\u03a0":"P","\u03a1":"R","\u03a3":"S","\u03a4":"T","\u03a5":"Y","\u03a6":"F","\u03a7":"X","\u03a8":"PS","\u03a9":"W","\u03aa":"I","\u03ab":"Y","\u03ac":"a","\u03ad":"e","\u03ae":"h","\u03af":"i","\u03b0":"y","\u03b1":"a","\u03b2":"b","\u03b3":"g","\u03b4":"d","\u03b5":"e","\u03b6":"z","\u03b7":"h","\u03b8":"8","\u03b9":"i","\u03ba":"k","\u03bb":"l","\u03bc":"m","\u03bd":"n","\u03be":"3","\u03bf":"o","\u03c0":"p","\u03c1":"r","\u03c2":"s","\u03c3":"s","\u03c4":"t","\u03c5":"y","\u03c6":"f","\u03c7":"x","\u03c8":"ps","\u03c9":"w","\u03ca":"i","\u03cb":"y","\u03cc":"o","\u03cd":"y","\u03ce":"w","\u0401":"Yo","\u0402":"DJ","\u0404":"Ye","\u0406":"I","\u0407":"Yi","\u0408":"J","\u0409":"LJ","\u040a":"NJ","\u040b":"C","\u040f":"DZ","\u0410":"A","\u0411":"B","\u0412":"V","\u0413":"G","\u0414":"D","\u0415":"E","\u0416":"Zh","\u0417":"Z","\u0418":"I","\u0419":"J","\u041a":"K","\u041b":"L","\u041c":"M","\u041d":"N","\u041e":"O","\u041f":"P","\u0420":"R","\u0421":"S","\u0422":"T","\u0423":"U","\u0424":"F","\u0425":"H","\u0426":"C","\u0427":"Ch","\u0428":"Sh","\u0429":"Sh","\u042a":"U","\u042b":"Y","\u042c":"","\u042d":"E","\u042e":"Yu","\u042f":"Ya","\u0430":"a","\u0431":"b","\u0432":"v","\u0433":"g","\u0434":"d","\u0435":"e","\u0436":"zh","\u0437":"z","\u0438":"i","\u0439":"j","\u043a":"k","\u043b":"l","\u043c":"m","\u043d":"n","\u043e":"o","\u043f":"p","\u0440":"r","\u0441":"s","\u0442":"t","\u0443":"u","\u0444":"f","\u0445":"h","\u0446":"c","\u0447":"ch","\u0448":"sh","\u0449":"sh","\u044a":"u","\u044b":"y","\u044c":"","\u044d":"e","\u044e":"yu","\u044f":"ya","\u0451":"yo","\u0452":"dj","\u0454":"ye","\u0456":"i","\u0457":"yi","\u0458":"j","\u0459":"lj","\u045a":"nj","\u045b":"c","\u045f":"dz","\u0490":"G","\u0491":"g","\u0e3f":"baht","\u10d0":"a","\u10d1":"b","\u10d2":"g","\u10d3":"d","\u10d4":"e","\u10d5":"v","\u10d6":"z","\u10d7":"t","\u10d8":"i","\u10d9":"k","\u10da":"l","\u10db":"m","\u10dc":"n","\u10dd":"o","\u10de":"p","\u10df":"zh","\u10e0":"r","\u10e1":"s","\u10e2":"t","\u10e3":"u","\u10e4":"f","\u10e5":"k","\u10e6":"gh","\u10e7":"q","\u10e8":"sh","\u10e9":"ch","\u10ea":"ts","\u10eb":"dz","\u10ec":"ts","\u10ed":"ch","\u10ee":"kh","\u10ef":"j","\u10f0":"h","\u1e9e":"SS","\u1ea0":"A","\u1ea1":"a","\u1ea2":"A","\u1ea3":"a","\u1ea4":"A","\u1ea5":"a","\u1ea6":"A","\u1ea7":"a","\u1ea8":"A","\u1ea9":"a","\u1eaa":"A","\u1eab":"a","\u1eac":"A","\u1ead":"a","\u1eae":"A","\u1eaf":"a","\u1eb0":"A","\u1eb1":"a","\u1eb2":"A","\u1eb3":"a","\u1eb4":"A","\u1eb5":"a","\u1eb6":"A","\u1eb7":"a","\u1eb8":"E","\u1eb9":"e","\u1eba":"E","\u1ebb":"e","\u1ebc":"E","\u1ebd":"e","\u1ebe":"E","\u1ebf":"e","\u1ec0":"E","\u1ec1":"e","\u1ec2":"E","\u1ec3":"e","\u1ec4":"E","\u1ec5":"e","\u1ec6":"E","\u1ec7":"e","\u1ec8":"I","\u1ec9":"i","\u1eca":"I","\u1ecb":"i","\u1ecc":"O","\u1ecd":"o","\u1ece":"O","\u1ecf":"o","\u1ed0":"O","\u1ed1":"o","\u1ed2":"O","\u1ed3":"o","\u1ed4":"O","\u1ed5":"o","\u1ed6":"O","\u1ed7":"o","\u1ed8":"O","\u1ed9":"o","\u1eda":"O","\u1edb":"o","\u1edc":"O","\u1edd":"o","\u1ede":"O","\u1edf":"o","\u1ee0":"O","\u1ee1":"o","\u1ee2":"O","\u1ee3":"o","\u1ee4":"U","\u1ee5":"u","\u1ee6":"U","\u1ee7":"u","\u1ee8":"U","\u1ee9":"u","\u1eea":"U","\u1eeb":"u","\u1eec":"U","\u1eed":"u","\u1eee":"U","\u1eef":"u","\u1ef0":"U","\u1ef1":"u","\u1ef2":"Y","\u1ef3":"y","\u1ef4":"Y","\u1ef5":"y","\u1ef6":"Y","\u1ef7":"y","\u1ef8":"Y","\u1ef9":"y","\u2018":"\'","\u2019":"\'","\u201c":"\\"","\u201d":"\\"","\u2020":"+","\u2022":"*","\u2026":"...","\u20a0":"ecu","\u20a2":"cruzeiro","\u20a3":"french franc","\u20a4":"lira","\u20a5":"mill","\u20a6":"naira","\u20a7":"peseta","\u20a8":"rupee","\u20a9":"won","\u20aa":"new shequel","\u20ab":"dong","\u20ac":"euro","\u20ad":"kip","\u20ae":"tugrik","\u20af":"drachma","\u20b0":"penny","\u20b1":"peso","\u20b2":"guarani","\u20b3":"austral","\u20b4":"hryvnia","\u20b5":"cedi","\u20b9":"indian rupee","\u20bd":"russian ruble","\u20bf":"bitcoin","\u2120":"sm","\u2122":"tm","\u2202":"d","\u2206":"delta","\u2211":"sum","\u221e":"infinity","\u2665":"love","\u5143":"yuan","\u5186":"yen","\ufdfc":"rial"}');function t(t,n){if("string"!==typeof t)throw new Error("slugify: string argument expected");n="string"===typeof n?{replacement:n}:n||{};var r=t.split("").reduce(function(t,r){return t+(e[r]||r).replace(n.remove||/[^\w\s$*_+~.()'"!\-:@]/g,"")},"").trim().replace(/[-\s]+/g,n.replacement||"-");return n.lower?r.toLowerCase():r}return t.extend=function(t){for(var n in t)e[n]=t[n]},t},e.exports=r(),e.exports.default=r()},function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return d});var r=n(16),i=n(3),o=n.n(i),a=n(17),s=n(15),l=(n(24),n(10)),u=n(23),c=n(14);o.a.Component;var h=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).history=Object(s.b)(t.props),t}return Object(r.a)(t,e),t.prototype.render=function(){return o.a.createElement(a.b,{history:this.history,children:this.props.children})},t}(o.a.Component);var d=function(e){function t(){return e.apply(this,arguments)||this}Object(r.a)(t,e);var n=t.prototype;return n.handleClick=function(e,t){try{this.props.onClick&&this.props.onClick(e)}catch(n){throw e.preventDefault(),n}e.defaultPrevented||0!==e.button||this.props.target&&"_self"!==this.props.target||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)||(e.preventDefault(),(this.props.replace?t.replace:t.push)(this.props.to))},n.render=function(){var e=this,t=this.props,n=t.innerRef,r=(t.replace,t.to),i=Object(u.a)(t,["innerRef","replace","to"]);return o.a.createElement(a.c.Consumer,null,function(t){t||Object(c.a)(!1);var a="string"===typeof r?Object(s.c)(r,null,null,t.location):r,u=a?t.history.createHref(a):"";return o.a.createElement("a",Object(l.a)({},i,{onClick:function(n){return e.handleClick(n,t.history)},href:u,ref:n}))})},t}(o.a.Component)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1);function i(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(r.a)(e)););return e}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var n=this,i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:r.M.ROTATE,MIDDLE:r.M.DOLLY,RIGHT:r.M.PAN},this.target=new r.Bb;var o=new r.Bb,a=1,s=i.NONE,l=i.NONE,u=new r.Bb,c=new r.Ab,h=new r.Ab,d=new r.Bb,f=0,p=new r.Ab,m=new r.Ab,g=0,_=0,v=new r.Ab,y=new r.Ab;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var b={type:"change"},E={type:"start"},x={type:"end"};this.handleResize=function(){var e=n.domElement.getBoundingClientRect(),t=n.domElement.ownerDocument.documentElement;n.screen.left=e.left+window.pageXOffset-t.clientLeft,n.screen.top=e.top+window.pageYOffset-t.clientTop,n.screen.width=e.width,n.screen.height=e.height};var T=function(){var e=new r.Ab;return function(t,r){return e.set((t-n.screen.left)/n.screen.width,(r-n.screen.top)/n.screen.height),e}}(),S=function(){var e=new r.Ab;return function(t,r){return e.set((t-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(n.screen.height+2*(n.screen.top-r))/n.screen.width),e}}();function A(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(e.preventDefault(),e.stopPropagation(),s===i.NONE)switch(e.button){case n.mouseButtons.LEFT:s=i.ROTATE;break;case n.mouseButtons.MIDDLE:s=i.ZOOM;break;case n.mouseButtons.RIGHT:s=i.PAN;break;default:s=i.NONE}var t=l!==i.NONE?l:s;t!==i.ROTATE||n.noRotate?t!==i.ZOOM||n.noZoom?t!==i.PAN||n.noPan||(v.copy(T(e.pageX,e.pageY)),y.copy(v)):(p.copy(T(e.pageX,e.pageY)),m.copy(p)):(h.copy(S(e.pageX,e.pageY)),c.copy(h));n.domElement.ownerDocument.addEventListener("pointermove",P),n.domElement.ownerDocument.addEventListener("pointerup",M),n.dispatchEvent(E)}(e)}}function P(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===n.enabled)return;e.preventDefault(),e.stopPropagation();var t=l!==i.NONE?l:s;t!==i.ROTATE||n.noRotate?t!==i.ZOOM||n.noZoom?t!==i.PAN||n.noPan||y.copy(T(e.pageX,e.pageY)):m.copy(T(e.pageX,e.pageY)):(c.copy(h),h.copy(S(e.pageX,e.pageY)))}(e)}}function M(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===n.enabled)return;e.preventDefault(),e.stopPropagation(),s=i.NONE,n.domElement.ownerDocument.removeEventListener("pointermove",P),n.domElement.ownerDocument.removeEventListener("pointerup",M),n.dispatchEvent(x)}(e)}}function R(e){!1!==n.enabled&&(window.removeEventListener("keydown",R),l===i.NONE&&(e.keyCode!==n.keys[i.ROTATE]||n.noRotate?e.keyCode!==n.keys[i.ZOOM]||n.noZoom?e.keyCode!==n.keys[i.PAN]||n.noPan||(l=i.PAN):l=i.ZOOM:l=i.ROTATE))}function C(){!1!==n.enabled&&(l=i.NONE,window.addEventListener("keydown",R))}function w(e){if(!1!==n.enabled&&!0!==n.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:p.y-=.025*e.deltaY;break;case 1:p.y-=.01*e.deltaY;break;default:p.y-=25e-5*e.deltaY}n.dispatchEvent(E),n.dispatchEvent(x)}}function O(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:s=i.TOUCH_ROTATE,h.copy(S(e.touches[0].pageX,e.touches[0].pageY)),c.copy(h);break;default:s=i.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;_=g=Math.sqrt(t*t+r*r);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(T(o,a)),y.copy(v)}n.dispatchEvent(E)}}function I(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:c.copy(h),h.copy(S(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;_=Math.sqrt(t*t+r*r);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;y.copy(T(i,o))}}function D(e){if(!1!==n.enabled){switch(e.touches.length){case 0:s=i.NONE;break;case 1:s=i.TOUCH_ROTATE,h.copy(S(e.touches[0].pageX,e.touches[0].pageY)),c.copy(h)}n.dispatchEvent(x)}}function L(e){!1!==n.enabled&&e.preventDefault()}this.rotateCamera=function(){var e,t=new r.Bb,i=new r.jb,o=new r.Bb,a=new r.Bb,s=new r.Bb,l=new r.Bb;return function(){l.set(h.x-c.x,h.y-c.y,0),(e=l.length())?(u.copy(n.object.position).sub(n.target),o.copy(u).normalize(),a.copy(n.object.up).normalize(),s.crossVectors(a,o).normalize(),a.setLength(h.y-c.y),s.setLength(h.x-c.x),l.copy(a.add(s)),t.crossVectors(l,u).normalize(),e*=n.rotateSpeed,i.setFromAxisAngle(t,e),u.applyQuaternion(i),n.object.up.applyQuaternion(i),d.copy(t),f=e):!n.staticMoving&&f&&(f*=Math.sqrt(1-n.dynamicDampingFactor),u.copy(n.object.position).sub(n.target),i.setFromAxisAngle(d,f),u.applyQuaternion(i),n.object.up.applyQuaternion(i)),c.copy(h)}}(),this.zoomCamera=function(){var e;s===i.TOUCH_ZOOM_PAN?(e=g/_,g=_,n.object.isPerspectiveCamera?u.multiplyScalar(e):n.object.isOrthographicCamera?(n.object.zoom*=e,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(m.y-p.y)*n.zoomSpeed)&&e>0&&(n.object.isPerspectiveCamera?u.multiplyScalar(e):n.object.isOrthographicCamera?(n.object.zoom/=e,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),n.staticMoving?p.copy(m):p.y+=(m.y-p.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=new r.Ab,t=new r.Bb,i=new r.Bb;return function(){if(e.copy(y).sub(v),e.lengthSq()){if(n.object.isOrthographicCamera){var r=(n.object.right-n.object.left)/n.object.zoom/n.domElement.clientWidth,o=(n.object.top-n.object.bottom)/n.object.zoom/n.domElement.clientWidth;e.x*=r,e.y*=o}e.multiplyScalar(u.length()*n.panSpeed),i.copy(u).cross(n.object.up).setLength(e.x),i.add(t.copy(n.object.up).setLength(e.y)),n.object.position.add(i),n.target.add(i),n.staticMoving?v.copy(y):v.add(e.subVectors(y,v).multiplyScalar(n.dynamicDampingFactor))}}}(),this.checkDistances=function(){n.noZoom&&n.noPan||(u.lengthSq()>n.maxDistance*n.maxDistance&&(n.object.position.addVectors(n.target,u.setLength(n.maxDistance)),p.copy(m)),u.lengthSq()<n.minDistance*n.minDistance&&(n.object.position.addVectors(n.target,u.setLength(n.minDistance)),p.copy(m)))},this.update=function(){u.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,u),n.object.isPerspectiveCamera?(n.checkDistances(),n.object.lookAt(n.target),o.distanceToSquared(n.object.position)>1e-6&&(n.dispatchEvent(b),o.copy(n.object.position))):n.object.isOrthographicCamera?(n.object.lookAt(n.target),(o.distanceToSquared(n.object.position)>1e-6||a!==n.object.zoom)&&(n.dispatchEvent(b),o.copy(n.object.position),a=n.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){s=i.NONE,l=i.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),u.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(b),o.copy(n.object.position),a=n.object.zoom},this.dispose=function(){n.domElement.removeEventListener("contextmenu",L),n.domElement.removeEventListener("pointerdown",A),n.domElement.removeEventListener("wheel",w),n.domElement.removeEventListener("touchstart",O),n.domElement.removeEventListener("touchend",D),n.domElement.removeEventListener("touchmove",I),n.domElement.ownerDocument.removeEventListener("pointermove",P),n.domElement.ownerDocument.removeEventListener("pointerup",M),window.removeEventListener("keydown",R),window.removeEventListener("keyup",C)},this.domElement.addEventListener("contextmenu",L),this.domElement.addEventListener("pointerdown",A),this.domElement.addEventListener("wheel",w),this.domElement.addEventListener("touchstart",O),this.domElement.addEventListener("touchend",D),this.domElement.addEventListener("touchmove",I),this.domElement.ownerDocument.addEventListener("pointermove",P),this.domElement.ownerDocument.addEventListener("pointerup",M),window.addEventListener("keydown",R),window.addEventListener("keyup",C),this.handleResize(),this.update()};i.prototype=Object.create(r.s.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(l){i=!0,o=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(t,"a",function(){return r})},,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t,n){e.exports=n(51)},function(e,t,n){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){(function(t){"use strict";var r=n(4),i=n(8),o=n(3),a=n(9),s=n(2).Promise,l=n(16),u=n(17);e.exports=t.SC={initialize:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o.set("oauth_token",e.oauth_token),o.set("client_id",e.client_id),o.set("redirect_uri",e.redirect_uri),o.set("baseURL",e.baseURL),o.set("connectURL",e.connectURL)},get:function(e,t){return r.request("GET",e,t)},post:function(e,t){return r.request("POST",e,t)},put:function(e,t){return r.request("PUT",e,t)},delete:function(e){return r.request("DELETE",e)},upload:function(e){return r.upload(e)},connect:function(e){return a(e)},isConnected:function(){return void 0!==o.get("oauth_token")},oEmbed:function(e,t){return r.oEmbed(e,t)},resolve:function(e){return r.resolve(e)},Recorder:l,Promise:s,stream:function(e,t){return u(e,t)},connectCallback:function(){i.notifyDialog(this.location)}}}).call(t,function(){return this}())},function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports={SCAudio:n(1),SCAudioControllerHTML5Player:n(3),SCAudioControllerHLSMSEPlayer:n(5),SCAudioPublicApiStreamURLRetriever:n(12),MaestroCore:n(2),MaestroLoaders:n(11)}},function(e,t,n){window,e.exports=function(e){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=99)}([function(t,n){t.exports=e},function(e,t,n){"use strict";var r=n(5);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";e.exports=n(55)()?Symbol:n(54)},function(e,t,n){"use strict";var r=n(11),i=n(18),o=n(59),a=n(17);(e.exports=function(e,t){var n,o,s,l,u;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],null==e?(n=s=!0,o=!1):(n=a.call(e,"c"),o=a.call(e,"e"),s=a.call(e,"w")),u={value:t,configurable:n,enumerable:o,writable:s},l?r(i(l),u):u}).gs=function(e,t,n){var s,l,u,c;return"string"!=typeof e?(u=n,n=t,t=e,e=null):u=arguments[3],null==t?t=void 0:o(t)?null==n?n=void 0:o(n)||(u=n,n=void 0):(u=t,t=n=void 0),null==e?(s=!0,l=!1):(s=a.call(e,"c"),l=a.call(e,"e")),c={get:t,set:n,configurable:s,enumerable:l},u?r(i(u),c):c}},function(e,t,n){"use strict";var r=n(22)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t){return e.call(this,t||"There was no format available that a player was able to play.")||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.NOT_SUPPORTED_ERROR"},t}(i.errors.PlayerFatalError);t.NotSupportedError=o},function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call("");e.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||r.call(e)===i)||!1}},function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call(function(){return arguments}());e.exports=function(e){return r.call(e)===i}},function(e,t,n){"use strict";e.exports=n(20)()?Object.setPrototypeOf:n(19)},function(e,t,n){"use strict";var r,i=n(23),o=n(11),a=n(2),s=n(1),l=n(4),u=n(47),c=n(3),h=Object.defineProperty,d=Object.defineProperties;e.exports=r=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");d(this,{__list__:l("w",s(e)),__context__:l("w",t),__nextIndex__:l("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete r.prototype.constructor,d(r.prototype,o({_next:l(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:l(function(){return this._createResult(this._next())}),_createResult:l(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:l(function(e){return this.__list__[e]}),_unBind:l(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:l(function(){return"[object "+(this[c.toStringTag]||"Object")+"]"})},u({_onAdd:l(function(e){if(!(e>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__)return void h(this,"__redo__",l("c",[e]));this.__redo__.forEach(function(t,n){t>=e&&(this.__redo__[n]=++t)},this),this.__redo__.push(e)}}),_onDelete:l(function(e){var t;e>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(t=this.__redo__.indexOf(e))&&this.__redo__.splice(t,1),this.__redo__.forEach(function(t,n){t>e&&(this.__redo__[n]=--t)},this)))}),_onClear:l(function(){this.__redo__&&i.call(this.__redo__),this.__nextIndex__=0})}))),h(r.prototype,c.iterator,l(function(){return this}))},function(e,t,n){"use strict";e.exports=n(64)()?Object.assign:n(63)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAppState=function(){switch(window.document.hidden){case!0:return"background";case!1:return"foreground";default:return}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(97),i=n(96),o=n(95),a=n(94),s=n(93),l=n(92),u=n(91),c=n(90),h=n(89),d=n(88);t.renditions={httpMp3:r.httpMp3,httpAACHQ:d.httpAACHQ,hlsMp3:i.hlsMp3,encryptedHlsMp3:o.encryptedHlsMp3,hlsOpus:c.hlsOpus,encryptedHlsOpus:h.encryptedHlsOpus,hlsAACHQ:a.hlsAACHQ,encryptedHlsAACHQ:s.encryptedHlsAACHQ,apiMobile:l.apiMobile,maestroChromecast:u.maestroChromecast},t.allRenditions=Object.keys(t.renditions).map(function(e){return t.renditions[e]})},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=function(e){function t(){return e.call(this,"Failed to retrieve stream url.")||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.FAILED_RETRIEVING_URL"},t}(i.NotSupportedError);t.FailedRetrievingUrlError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=function(e){function t(){return e.call(this,"There were no stream URLs.")||this}return r(t,e),t.prototype.getCode=function(){return"SCAUDIO.NO_STREAMS"},t}(i.NotSupportedError);t.NoStreamsError=o},function(e,t,n){"use strict";var r=n(51);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not iterable");return e}},function(e,t,n){"use strict";e.exports=n(58)()?String.prototype.contains:n(57)},function(e,t,n){"use strict";var r=n(5),i=Array.prototype.forEach,o=Object.create;e.exports=function(e){var t=o(null);return i.call(arguments,function(e){r(e)&&function(e,t){var n;for(n in e)t[n]=e[n]}(Object(e),t)}),t}},function(e,t,n){"use strict";var r,i=n(66),o=n(1),a=Object.prototype.isPrototypeOf,s=Object.defineProperty,l={configurable:!0,enumerable:!1,writable:!0,value:void 0};r=function(e,t){if(o(e),null===t||i(t))return e;throw new TypeError("Prototype must be null or an object")},e.exports=function(e){var t,n;return e?(2===e.level?e.set?(n=e.set,t=function(e,t){return n.call(r(e,t),t),e}):t=function(e,t){return r(e,t).__proto__=t,e}:t=function e(t,n){var i;return r(t,n),(i=a.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===n&&(n=e.nullPolyfill),t.__proto__=n,i&&s(e.nullPolyfill,"__proto__",l),t},Object.defineProperty(t,"level",{configurable:!1,enumerable:!1,writable:!1,value:e.level})):null}(function(){var e,t=Object.create(null),n={},r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(r){try{(e=r.set).call(t,n)}catch(e){}if(Object.getPrototypeOf(t)===n)return{set:e,level:2}}return t.__proto__=n,Object.getPrototypeOf(t)===n?{level:2}:((t={}).__proto__=n,Object.getPrototypeOf(t)===n&&{level:1})}()),n(65)},function(e,t,n){"use strict";var r=Object.create,i=Object.getPrototypeOf,o={};e.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||r;return"function"==typeof e&&i(e(t(null),o))===o}},function(e,t,n){"use strict";var r=n(70),i=Math.max;e.exports=function(e){return i(0,r(e))}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(1);e.exports=function(){return r(this).length=0,this}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notSupportedError=new Error("Not supported.");var r=function(){this.supportsVolumeAutomation=!0,this.syncConfig={}};t.BaseController=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.BaseStreamUrlRetriever=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildFadeIn=function(e){return new r({startPos:0,endPos:e,startLevel:0,endLevel:1,fromEnd:!1})},t.buildFadeOut=function(e){return new r({startPos:e,endPos:0,startLevel:1,endLevel:0,fromEnd:!0})};var r=function(){function e(e){var t=e.startPos,n=e.endPos,r=e.startLevel,i=e.endLevel,o=e.fromEnd,a=void 0!==o&&o;if(t<0)throw new Error("startPos invalid.");if(n<0||!a&&n<t||a&&t<n)throw new Error("endPos invalid.");if(r<0||r>1)throw new Error("startLevel invalid.");if(i<0||i>1)throw new Error("endLevel invalid.");this._startPos=t,this._endPos=n,this._startLevel=r,this._endLevel=i,this._fromEnd=a}return e.prototype.calculate=function(e,t){var n=this._fromEnd?t-500-this._startPos:this._startPos,r=this._fromEnd?t-500-this._endPos:this._endPos;if(e<n)return{level:this._startLevel,nextCalculatePosition:n-e};if(e<=r){var i=(e-n)/(r-n),o=Math.cos(i*Math.PI)/-2+.5,a=this._startLevel+(this._endLevel-this._startLevel)*o;return{level:a,nextCalculatePosition:e}}return{level:this._endLevel,nextCalculatePosition:1/0}},e}();t.Fade=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(15),o=n(14);!function(e){e.NotSupportedError=r.NotSupportedError,e.NoStreamsError=i.NoStreamsError,e.FailedRetrievingUrlError=o.FailedRetrievingUrlError}(t.errors||(t.errors={}))},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SQ="sq",e.HQ="hq"}(r=t.Quality||(t.Quality={})),t.resolveQuality=function(e){switch(e){case r.SQ:return r.SQ;case r.HQ:return r.HQ}return null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e){var t=this;this._player=e,this._onConnectionRequired=new r.eventDispatcher.EventDispatcher,this._onConnectionRecovered=new r.eventDispatcher.EventDispatcher,this._connectionRequired=!1,this._connectionLossTimer=null,this.onConnectionRequired=this._onConnectionRequired.getHandle(),this.onConnectionRecovered=this._onConnectionRecovered.getHandle();var n=function(){return t._calculateIfConnectionRequired()};window.addEventListener("online",n),window.addEventListener("offline",n),this._calculateIfConnectionRequired(),e.onChange.subscribe(function(r){var i=r.loading,o=r.dead;o&&null!==t._connectionLossTimer&&(window.clearTimeout(t._connectionLossTimer),window.removeEventListener("online",n),window.removeEventListener("offline",n)),e.isDead()||void 0===i||t._calculateIfConnectionRequired()})}return e.prototype.isConnectionRequired=function(){return this._connectionRequired},e.prototype._calculateIfConnectionRequired=function(){var e=this,t=this._player.isLoading()&&"navigator"in window&&!window.navigator.onLine;t?null===this._connectionLossTimer&&(this._connectionLossTimer=window.setTimeout(function(){e._connectionLossTimer=null,e._connectionRequired=!0,e._onConnectionRequired.dispatch(void 0)},1500)):this._connectionRequired?(this._connectionRequired=!1,this._onConnectionRecovered.dispatch(void 0)):null!==this._connectionLossTimer&&(window.clearTimeout(this._connectionLossTimer),this._connectionLossTimer=null)},e}();t.ConnectionRequiredHelper=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLogId=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<20;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}},function(e,t,n){"use strict";function r(e,t){return void 0!==e?e:t}Object.defineProperty(t,"__esModule",{value:!0});var i=n(25),o=n(0);t.validatePlayerDependencies=function(e){if(!(e.streamUrlRetriever instanceof i.BaseStreamUrlRetriever))throw new Error("StreamUrlRetriever invalid.");if(void 0!==e.duration&&("number"!=typeof e.duration||e.duration<0))throw new Error("duration invalid.");if(void 0!==e.getURLOpts&&"object"!=typeof e.getURLOpts)throw new Error("getURLOpts invalid.");if(void 0!==e.preloadingEnabled&&"boolean"!=typeof e.preloadingEnabled)throw new Error("preloadingEnabled invalid.");if(void 0!==e.fadeOnPauseAndPlay&&"boolean"!=typeof e.fadeOnPauseAndPlay)throw new Error("fadeOnPauseAndPlay invalid.");if(void 0!==e.fadeOnSeek&&"boolean"!=typeof e.fadeOnSeek)throw new Error("fadeOnSeek invalid.");if(void 0!==e.mediaSessionEnabled&&"boolean"!=typeof e.mediaSessionEnabled)throw new Error("mediaSessionEnabled invalid.");if(void 0!==e.pausedMaxBufferLength&&("number"!=typeof e.pausedMaxBufferLength||e.pausedMaxBufferLength<0))throw new Error("pausedMaxBufferLength invalid.");if(void 0!==e.playingMaxBufferLength&&("number"!=typeof e.playingMaxBufferLength||e.playingMaxBufferLength<0))throw new Error("playingMaxBufferLength invalid.");if(void 0!==e.logger&&"function"!=typeof e.logger&&"object"!=typeof e.logger)throw new Error("logger invalid.");if(void 0!==e.audioReporter&&"function"!=typeof e.audioReporter)throw new Error("audioReporter invalid.");if(void 0!==e.audioCheckpointInterval&&("number"!=typeof e.audioCheckpointInterval||e.audioCheckpointInterval<0))throw new Error("audioCheckpointInterval invalid.");if(void 0!==e.audioPerformanceReporter&&"function"!=typeof e.audioPerformanceReporter)throw new Error("audioPerformanceReporter invalid.");if(void 0!==e.errorReporter&&"function"!=typeof e.errorReporter)throw new Error("errorReporter invalid.");if(void 0!==e.urlProviderRetryDelayCalculator&&"function"!=typeof e.urlProviderRetryDelayCalculator)throw new Error("urlProviderRetryDelayCalculator invalid.");return{controllers:e.controllers,streamUrlRetriever:e.streamUrlRetriever,getURLOpts:r(e.getURLOpts,{}),preloadingEnabled:r(e.preloadingEnabled,!1),pausedMaxBufferLength:r(e.pausedMaxBufferLength,2e3),playingMaxBufferLength:r(e.playingMaxBufferLength,9e4),fadeOnPauseAndPlay:r(e.fadeOnPauseAndPlay,!1),fadeOnSeek:r(e.fadeOnSeek,!1),audioCheckpointInterval:r(e.audioCheckpointInterval,3e4),urlProviderRetryDelayCalculator:r(e.urlProviderRetryDelayCalculator,o.helpers.retry.buildExponentialDelayCalculator()),streamUrlsExpire:r(e.streamUrlsExpire,!0),fetchEnabled:r(e.fetchEnabled,!0),duration:e.duration,audioReporter:e.audioReporter,audioPerformanceReporter:e.audioPerformanceReporter,errorReporter:e.errorReporter}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(13);t.NoMoreAttemptsError=new Error("No more attempts to retrieve URL."),t.retrieveUrl=function(e){var n=e.streamUrlRetriever,o=e.getURLOpts,a=e.logger,s=e.urlProviderRetryDelayCalculator;return new r.helpers.abortableJob.AbortableJob(function(){var e=r.helpers.deferred.buildDeferred(),l=r.helpers.retry.retry(s,function(t){var s=t.scheduleRetry,l=n.getUrl(o);return a.debug("Retrieving a URL..."),l.onCompletion(function(t){t?t.rendition&&i.allRenditions.indexOf(t.rendition)<0?(a.warn("Unknown rendition. Skipping...",t.rendition),n.excludeRendition(t.rendition),s()):!t.success&&t.error.isTransient()?(a.warn("Transient error retrieving url.",t.error),s()):e.resolve(t):(a.debug("No URL provided."),e.resolve(null))}),l.onError(function(t){t!==r.helpers.abortableJob.abortedError&&a.error("Error retrieving URL.",t),e.reject(t)}),{onCancel:function(){return l.abort()}}},{onNoMoreRetries:function(){return e.reject(t.NoMoreAttemptsError)}}).cancel;return{result:e.promise,abort:function(){return l()}}}).run()}},function(e,t,n){"use strict";function r(e,t){var n=e.getMemoryCacheController();n&&n.setMaxCacheSize(t)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(e,t){this._maxCacheSize=e,this._players=[],this._updateTimer=null,this._logger=i.logger.prefixLogger(t,"CacheManager"),this._logger.debug("Initialized with cache size "+e+" bytes.")}return e.prototype.setCacheSize=function(e){this._maxCacheSize!==e&&(this._logger.debug("Updating cache size to "+e+" bytes."),this._maxCacheSize=e,this._update())},e.prototype.addPlayer=function(e){var t=this;if(this._logger.debug("Adding player to cache manager."),e.isDead())this._logger.debug("Player was dead.");else{var n=this._players;e.onChange.subscribe(function(r){var i=r.playing,o=r.dead;!0===o?(t._logger.debug("Removing player that became dead."),n.splice(n.indexOf(e),1),t._update()):!0===i?(t._logger.debug("Updating because player started playing."),n.splice(n.indexOf(e),1),n.unshift(e),t._update()):!1===i&&(t._logger.debug("Updating because player became paused."),t._update())}),e.isPlaying()?n.unshift(e):n.push(e),this._update()}},e.prototype._update=function(){var e=this;if(this._updateTimer&&(window.clearTimeout(this._updateTimer),this._updateTimer=null),0!==this._players.length){var t=this._players.reduce(function(e,t){return t.isPlaying()?e.playingPlayers.push(t):e.pausedPlayers.push(t),e},{playingPlayers:[],pausedPlayers:[]}),n=t.playingPlayers,i=t.pausedPlayers,o=n.reduce(function(e,t){return e+(t.getMemoryCacheUsage()||0)},0),a=i.reduce(function(e,t){return e+(t.getMemoryCacheUsage()||0)},0);if(o>this._maxCacheSize){this._logger.debug("All playing players are using more than the max cache size. Cleaning...",o,this._maxCacheSize);var s=this._maxCacheSize/n.length;n.forEach(function(e){return r(e,s)}),i.forEach(function(e){return r(e,0)})}else this._logger.debug("Recalculating cache sizes...",o+a,this._maxCacheSize),n.concat(i).reduce(function(t,n){return r(n,Math.max(0,e._maxCacheSize-t)),t+(n.getMemoryCacheUsage()||0)},0);this._updateTimer=window.setTimeout(function(){return e._update()},2e4)}else this._logger.debug("There are no longer any players to manage.")},e}();t.CacheManager=o},function(e,t,n){"use strict";e.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},function(e,t,n){"use strict";var r=Array.prototype.forEach,i=Object.create;e.exports=function(e){var t=i(null);return r.call(arguments,function(e){t[e]=!0}),t}},function(e,t,n){"use strict";e.exports=n(35)("key","value","key+value")},function(e,t,n){"use strict";var r,i=n(9),o=n(4),a=n(10),s=n(3).toStringTag,l=n(36),u=Object.defineProperties,c=a.prototype._unBind;r=e.exports=function(e,t){return this instanceof r?(a.call(this,e.__mapKeysData__,e),t&&l[t]||(t="key+value"),void u(this,{__kind__:o("",t),__values__:o("w",e.__mapValuesData__)})):new r(e,t)},i&&i(r,a),r.prototype=Object.create(a.prototype,{constructor:o(r),_resolve:o(function(e){return"value"===this.__kind__?this.__values__[e]:"key"===this.__kind__?this.__list__[e]:[this.__list__[e],this.__values__[e]]}),_unBind:o(function(){this.__values__=null,c.call(this)}),toString:o(function(){return"[object Map Iterator]"})}),Object.defineProperty(r.prototype,s,o("c","Map Iterator"))},function(e,t,n){"use strict";var r,i=n(9),o=n(4),a=n(3),s=n(10),l=Object.defineProperty;r=e.exports=function(e){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");e=String(e),s.call(this,e),l(this,"__length__",o("",e.length))},i&&i(r,s),delete r.prototype.constructor,r.prototype=Object.create(s.prototype,{_next:o(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:o(function(e){var t,n=this.__list__[e];return this.__nextIndex__===this.__length__?n:(t=n.charCodeAt(0))>=55296&&t<=56319?n+this.__list__[this.__nextIndex__++]:n})}),l(r.prototype,a.toStringTag,o("c","String Iterator"))},function(e,t,n){"use strict";var r=n(2),i=n(1),o=Function.prototype.bind,a=Function.prototype.call,s=Object.keys,l=Object.prototype.propertyIsEnumerable;e.exports=function(e,t){return function(n,u){var c,h=arguments[2],d=arguments[3];return n=Object(i(n)),r(u),c=s(n),d&&c.sort("function"==typeof d?o.call(d,n):void 0),"function"!=typeof e&&(e=c[e]),a.call(e,c,function(e,r){return l.call(n,e)?a.call(u,h,n[e],e,n,r):t})}}},function(e,t,n){"use strict";e.exports=n(39)("forEach")},function(e,t,n){"use strict";var r=n(2),i=n(40),o=Function.prototype.call;e.exports=function(e,t){var n={},a=arguments[2];return r(t),i(e,function(e,r,i,s){n[r]=o.call(t,a,e,r,i,s)}),n}},function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call(n(22));e.exports=function(e){return"function"==typeof e&&r.call(e)===i}},function(e,t,n){"use strict";var r=n(3).iterator,i=n(8),o=n(42),a=n(21),s=n(2),l=n(1),u=n(5),c=n(7),h=Array.isArray,d=Function.prototype.call,f={configurable:!0,enumerable:!0,writable:!0,value:null},p=Object.defineProperty;e.exports=function(e){var t,n,m,g,_,v,y,b,E,x,T=arguments[1],S=arguments[2];if(e=Object(l(e)),u(T)&&s(T),this&&this!==Array&&o(this))t=this;else{if(!T){if(i(e))return 1!==(_=e.length)?Array.apply(null,e):((g=new Array(1))[0]=e[0],g);if(h(e)){for(g=new Array(_=e.length),n=0;n<_;++n)g[n]=e[n];return g}}g=[]}if(!h(e))if(void 0!==(E=e[r])){for(y=s(E).call(e),t&&(g=new t),b=y.next(),n=0;!b.done;)x=T?d.call(T,S,b.value,n):b.value,t?(f.value=x,p(g,n,f)):g[n]=x,b=y.next(),++n;_=n}else if(c(e)){for(_=e.length,t&&(g=new t),n=0,m=0;n<_;++n)x=e[n],n+1<_&&(v=x.charCodeAt(0))>=55296&&v<=56319&&(x+=e[++n]),x=T?d.call(T,S,x,m):x,t?(f.value=x,p(g,m,f)):g[m]=x,++m;_=m}if(void 0===_)for(_=a(e.length),t&&(g=new t(_)),n=0;n<_;++n)x=T?d.call(T,S,e[n],n):e[n],t?(f.value=x,p(g,n,f)):g[n]=x;return t&&(f.value=null,g.length=_),g}},function(e,t,n){"use strict";e.exports=function(){var e,t,n=Array.from;return"function"==typeof n&&(t=n(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},function(e,t,n){"use strict";e.exports=n(44)()?Array.from:n(43)},function(e,t,n){"use strict";var r=n(45),i=n(11),o=n(1);e.exports=function(e){var t=Object(o(e)),n=arguments[1],a=Object(arguments[2]);if(t!==e&&!n)return t;var s={};return n?r(n,function(t){(a.ensure||t in e)&&(s[t]=e[t])}):i(s,e),s}},function(e,t,n){"use strict";var r,i=n(46),o=n(18),a=n(2),s=n(41),l=n(2),u=n(1),c=Function.prototype.bind,h=Object.defineProperty,d=Object.prototype.hasOwnProperty;r=function(e,t,n){var r,o=u(t)&&l(t.value);return r=i(t),delete r.writable,delete r.value,r.get=function(){return!n.overwriteDefinition&&d.call(this,e)?o:(t.value=c.call(o,n.resolveContext?n.resolveContext(this):this),h(this,e,t),this[e])},r},e.exports=function(e){var t=o(arguments[1]);return null!=t.resolveContext&&a(t.resolveContext),s(e,function(e,n){return r(n,e,t)})}},function(e,t,n){"use strict";var r,i=n(9),o=n(17),a=n(4),s=n(3),l=n(10),u=Object.defineProperty;r=e.exports=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");l.call(this,e),t=t?o.call(t,"key+value")?"key+value":o.call(t,"key")?"key":"value":"value",u(this,"__kind__",a("",t))},i&&i(r,l),delete r.prototype.constructor,r.prototype=Object.create(l.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),u(r.prototype,s.toStringTag,a("c","Array Iterator"))},function(e,t,n){"use strict";var r=n(8),i=n(7),o=n(48),a=n(38),s=n(16),l=n(3).iterator;e.exports=function(e){return"function"==typeof s(e)[l]?e[l]():r(e)?new o(e):i(e)?new a(e):new o(e)}},function(e,t,n){"use strict";var r=n(8),i=n(2),o=n(7),a=n(49),s=Array.isArray,l=Function.prototype.call,u=Array.prototype.some;e.exports=function(e,t){var n,c,h,d,f,p,m,g,_=arguments[2];if(s(e)||r(e)?n="array":o(e)?n="string":e=a(e),i(t),h=function(){d=!0},"array"!==n)if("string"!==n)for(c=e.next();!c.done;){if(l.call(t,_,c.value,h),d)return;c=e.next()}else for(p=e.length,f=0;f<p&&(m=e[f],f+1<p&&(g=m.charCodeAt(0))>=55296&&g<=56319&&(m+=e[++f]),l.call(t,_,m,h),!d);++f);else u.call(e,function(e){return l.call(t,_,e,h),d})}},function(e,t,n){"use strict";var r=n(8),i=n(5),o=n(7),a=n(3).iterator,s=Array.isArray;e.exports=function(e){return!(!i(e)||!s(e)&&!o(e)&&!r(e)&&"function"!=typeof e[a])}},function(e,t,n){"use strict";e.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&"Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag])}},function(e,t,n){"use strict";var r=n(52);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not a symbol");return e}},function(e,t,n){"use strict";var r,i,o,a,s=n(4),l=n(53),u=Object.create,c=Object.defineProperties,h=Object.defineProperty,d=Object.prototype,f=u(null);if("function"==typeof Symbol){r=Symbol;try{String(r()),a=!0}catch(e){}}var p=function(){var e=u(null);return function(t){for(var n,r,i=0;e[t+(i||"")];)++i;return e[t+=i||""]=!0,h(d,n="@@"+t,s.gs(null,function(e){r||(r=!0,h(this,n,s(e)),r=!1)})),n}}();o=function(e){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return i(e)},e.exports=i=function e(t){var n;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return a?r(t):(n=u(o.prototype),t=void 0===t?"":String(t),c(n,{__description__:s("",t),__name__:s("",p(t))}))},c(i,{for:s(function(e){return f[e]?f[e]:f[e]=i(String(e))}),keyFor:s(function(e){var t;for(t in l(e),f)if(f[t]===e)return t}),hasInstance:s("",r&&r.hasInstance||i("hasInstance")),isConcatSpreadable:s("",r&&r.isConcatSpreadable||i("isConcatSpreadable")),iterator:s("",r&&r.iterator||i("iterator")),match:s("",r&&r.match||i("match")),replace:s("",r&&r.replace||i("replace")),search:s("",r&&r.search||i("search")),species:s("",r&&r.species||i("species")),split:s("",r&&r.split||i("split")),toPrimitive:s("",r&&r.toPrimitive||i("toPrimitive")),toStringTag:s("",r&&r.toStringTag||i("toStringTag")),unscopables:s("",r&&r.unscopables||i("unscopables"))}),c(o.prototype,{constructor:s(i),toString:s("",function(){return this.__name__})}),c(i.prototype,{toString:s(function(){return"Symbol ("+l(this).__description__+")"}),valueOf:s(function(){return l(this)})}),h(i.prototype,i.toPrimitive,s("",function(){var e=l(this);return"symbol"==typeof e?e:e.toString()})),h(i.prototype,i.toStringTag,s("c","Symbol")),h(o.prototype,i.toStringTag,s("c",i.prototype[i.toStringTag])),h(o.prototype,i.toPrimitive,s("c",i.prototype[i.toPrimitive]))},function(e,t,n){"use strict";var r={object:!0,symbol:!0};e.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!r[typeof Symbol.iterator]&&!!r[typeof Symbol.toPrimitive]&&!!r[typeof Symbol.toStringTag]}},function(e,t,n){"use strict";var r,i,o,a,s,l,u,c=n(4),h=n(2),d=Function.prototype.apply,f=Function.prototype.call,p=Object.create,m=Object.defineProperty,g=Object.defineProperties,_=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n,i;return h(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),d.call(t,this,arguments)}),n.__eeOnceListener__=t,this},o=function(e,t){var n,r,i,o;if(h(t),!_.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"==typeof(r=n[e]))for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},a=function(e){var t,n,r,i,o;if(_.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)d.call(r,this,o)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];d.call(i,this,o)}},s={on:r=function(e,t){var n;return h(t),_.call(this,"__ee__")?n=this.__ee__:(n=v.value=p(null),m(this,"__ee__",v),v.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:o,emit:a},l={on:c(r),once:c(i),off:c(o),emit:c(a)},u=g({},l),e.exports=t=function(e){return null==e?p(u):g(Object(e),l)},t.methods=s},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&!0===r.contains("dwa")&&!1===r.contains("foo")}},function(e,t,n){"use strict";e.exports=function(e){return"function"==typeof e}},function(e,t,n){"use strict";var r=n(5),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";e.exports=n(61)()?Object.keys:n(60)},function(e,t,n){"use strict";var r=n(62),i=n(1),o=Math.max;e.exports=function(e,t){var n,a,s,l=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},a=1;a<l;++a)t=arguments[a],r(t).forEach(s);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r,i=Object.create;n(20)()||(r=n(19)),e.exports=function(){var e,t,n;return r?1!==r.level?i:(e={},t={},n={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){return"__proto__"===e?void(t[e]={configurable:!0,enumerable:!1,writable:!0,value:void 0}):void(t[e]=n)}),Object.defineProperties(e,t),Object.defineProperty(r,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:e}),function(t,n){return i(null===t?e:t,n)}):i}()},function(e,t,n){"use strict";var r=n(5),i={function:!0,object:!0};e.exports=function(e){return r(e)&&i[typeof e]||!1}},function(e,t,n){"use strict";e.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},function(e,t,n){"use strict";e.exports=function(){var e=Math.sign;return"function"==typeof e&&1===e(10)&&-1===e(-20)}},function(e,t,n){"use strict";e.exports=n(68)()?Math.sign:n(67)},function(e,t,n){"use strict";var r=n(69),i=Math.abs,o=Math.floor;e.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?r(e)*o(i(e)):e}},function(e,t,n){"use strict";e.exports=function(e){return e!==e}},function(e,t,n){"use strict";e.exports=function(){var e=Number.isNaN;return"function"==typeof e&&!e({})&&e(NaN)&&!e(34)}},function(e,t,n){"use strict";e.exports=n(72)()?Number.isNaN:n(71)},function(e,t,n){"use strict";var r=n(73),i=n(21),o=n(1),a=Array.prototype.indexOf,s=Object.prototype.hasOwnProperty,l=Math.abs,u=Math.floor;e.exports=function(e){var t,n,c,h;if(!r(e))return a.apply(this,arguments);for(n=i(o(this).length),c=arguments[1],c=isNaN(c)?0:c>=0?u(c):i(this.length)-u(l(c)),t=c;t<n;++t)if(s.call(this,t)&&(h=this[t],r(h)))return t;return-1}},function(e,t,n){"use strict";var r,i=n(23),o=n(74),a=n(9),s=n(2),l=n(1),u=n(4),c=n(56),h=n(3),d=n(16),f=n(50),p=n(37),m=n(34),g=Function.prototype.call,_=Object.defineProperties,v=Object.getPrototypeOf;e.exports=r=function(){var e,t,n,i=arguments[0];if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");return n=m&&a&&Map!==r?a(new Map,v(this)):this,null!=i&&d(i),_(n,{__mapKeysData__:u("c",e=[]),__mapValuesData__:u("c",t=[])}),i?(f(i,function(n){var r=l(n)[0];n=n[1],-1===o.call(e,r)&&(e.push(r),t.push(n))},n),n):n},m&&(a&&a(r,Map),r.prototype=Object.create(Map.prototype,{constructor:u(r)})),c(_(r.prototype,{clear:u(function(){this.__mapKeysData__.length&&(i.call(this.__mapKeysData__),i.call(this.__mapValuesData__),this.emit("_clear"))}),delete:u(function(e){var t=o.call(this.__mapKeysData__,e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),this.emit("_delete",t,e),!0)}),entries:u(function(){return new p(this,"key+value")}),forEach:u(function(e){var t,n,r=arguments[1];for(s(e),t=this.entries(),n=t._next();void 0!==n;)g.call(e,r,this.__mapValuesData__[n],this.__mapKeysData__[n],this),n=t._next()}),get:u(function(e){var t=o.call(this.__mapKeysData__,e);if(-1!==t)return this.__mapValuesData__[t]}),has:u(function(e){return-1!==o.call(this.__mapKeysData__,e)}),keys:u(function(){return new p(this,"key")}),set:u(function(e,t){var n,r=o.call(this.__mapKeysData__,e);return-1===r&&(r=this.__mapKeysData__.push(e)-1,n=!0),this.__mapValuesData__[r]=t,n&&this.emit("_add",r,e),this}),size:u.gs(function(){return this.__mapKeysData__.length}),values:u(function(){return new p(this,"value")}),toString:u(function(){return"[object Map]"})})),Object.defineProperty(r.prototype,h.iterator,u(function(){return this.entries()})),Object.defineProperty(r.prototype,h.toStringTag,u("c","Map"))},function(e,t,n){"use strict";e.exports=function(){var e,t,n;if("function"!=typeof Map)return!1;try{e=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(e){return!1}return"[object Map]"===String(e)&&3===e.size&&"function"==typeof e.clear&&"function"==typeof e.delete&&"function"==typeof e.entries&&"function"==typeof e.forEach&&"function"==typeof e.get&&"function"==typeof e.has&&"function"==typeof e.keys&&"function"==typeof e.set&&"function"==typeof e.values&&(t=e.entries(),!1===(n=t.next()).done&&!!n.value&&"raz"===n.value[0]&&"one"===n.value[1])}},function(e,t,n){"use strict";e.exports=n(76)()?Map:n(75)},function(e,t,n){"use strict";function r(e){var t=e.split("//",2);return 1===t.length?t[0].split("/",1)[0]:t[1]?t[1].split("/",1)[0]:""}function i(e){var t=u.exec(e);return t&&t[0]||""}function o(e,t,n){return{name:t.name,preset:e.preset,bitrate:e.bitrate,protocol:e.rendition.scProtocol,host:r(n),url:i(n),format:e.rendition.scFormat,quality:e.quality}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(77),s=n(0),l=n(24),u=/^[^?#]*/,c=function(){function e(e){var t=e.logger,n=e.controllers,r=e.playerId,i=e.streamUrlsExpire,o=e.fetchEnabled,l=e.fadeOnPauseAndPlay,u=e.fadeOnSeek,c=e.cacheManager,h=e.providePlayer,d=e.removePlayer,f=e.streamUrlRetriever,p=e.getURLOpts,m=e.errorEventGenerator,g=e.audioPerformanceEventGenerator;this._quality=null,this._onQualityChanged=new s.eventDispatcher.EventDispatcher,this._controllerIndexByRendition=new a,this._controlledPlayerWithRendition=null,this.onQualityChanged=this._onQualityChanged.getHandle(),this._logger=s.logger.prefixLogger(t,"ControllerManager"),this._controllers=n,this._playerId=r,this._streamUrlsExpire=i,this._fetchEnabled=o,this._fadeOnPauseAndPlay=l,this._fadeOnSeek=u,this._cacheManager=c,this._providePlayer=h,this._removePlayer=d,this._streamUrlRetriever=f,this._getURLOpts=p,this._errorEventGenerator=m||null,this._audioPerformanceEventGenerator=g||null}return e.prototype.buildNextController=function(e,t){var n=this;if(this._controlledPlayerWithRendition)throw new Error("A player is already being controlled.");this._logger.debug("Building next controller.");var r=this._controllerIndexByRendition.get(e.rendition)||0;if(r>=this._controllers.length)this._logger.debug("No more controllers for this rendition."),t({excludeRendition:!0,immediateRetry:!0});else{var i=!1;this._manageController(e,this._controllers[r],function(o){if(i)throw new Error("performNextAction() already called");i=!0,"MOVE_ON"!==o&&"MOVE_ON_SAME_RENDITION"!==o||(n._logger.debug("Controller will not be used again."),n._controllerIndexByRendition.set(e.rendition,r+1)),"MOVE_ON_SAME_RENDITION"===o?n.buildNextController(e,t):t({excludeRendition:!1,immediateRetry:"MOVE_ON"===o})})}},e.prototype.releaseCurrentController=function(e){var t=e.retry;if(!this._controlledPlayerWithRendition)throw new Error("There is no player being controlled.");this._controlledPlayerWithRendition.releaseControl({retry:t})},e.prototype.getQuality=function(){return this._quality},e.prototype.getPlayerDetails=function(){if(!this._controlledPlayerWithRendition)throw new Error("There is no player being controlled.");var e=this._controlledPlayerWithRendition,t=e.initialUrlAndRendition,n=e.controller,r=e.controlledPlayer;return o(t,n,r.getUrl())},e.prototype._manageController=function(e,t,n){var r=this,i=function(){r._removePlayer(),r._controlledPlayerWithRendition=null,a&&a.kill()};if(this._logger.debug("Preparing controller.",t.name),!t.isRenditionSupported(e.rendition,{streamUrlExpires:this._streamUrlsExpire}))return this._logger.debug("Skipping controller because rendition not supported."),void n("MOVE_ON_SAME_RENDITION");var a,u=!1,c=function(e){var t=e.retry;u||(u=!0,r._logger.debug("Releasing control."),i(),n(t?"RETRY":"MOVE_ON"))};try{this._logger.debug("Building player.");var h=t.buildPlayer({logger:s.logger.prefixLogger(this._logger,t.name+"-Controller"),playerId:this._playerId,urlAndRendition:e,streamUrlExpires:this._streamUrlsExpire,fetchEnabled:this._fetchEnabled,releaseControl:c,fadeOnPauseAndPlay:this._fadeOnPauseAndPlay,fadeOnSeek:this._fadeOnSeek,getNewUrl:function(){return r._getNewUrlWithSameRendition(e.rendition)},reportError:function(n){r._errorEventGenerator&&r._errorEventGenerator.reportManualEvent(n,o(e,t,h?h.getUrl():e.url))},reportPerformance:function(e){!u&&r._audioPerformanceEventGenerator&&r._audioPerformanceEventGenerator.reportManualEvent(e)}});if(a=h.getPlayer(),u)this._logger.warn("Player released during constrution."),a.kill();else if(a.isDead()){var d=a.getFatalError();d instanceof s.errors.NotSupportedError?this._logger.debug("Player not supported (during construction)."):this._logger.error("Error during construction.",d),n("MOVE_ON_SAME_RENDITION")}else{this._logger.debug("Player built."),a.onChange.subscribe(function(e){var t=e.dead,n=e.fatalError;t&&(n&&r._logger.error("Fatal player error occurred.",n),c({retry:!1}))}),this._cacheManager.addPlayer(a),this._controlledPlayerWithRendition={controller:t,controlledPlayer:h,initialUrlAndRendition:e,releaseControl:c},this._providePlayer(h.getPlayer(),t.syncConfig,t.supportsVolumeAutomation),this._logger.debug("Player provided to proxy.");var f=e.quality||null;this._quality!==f&&(this._logger.debug("Quality changed.",f),this._quality=f,this._onQualityChanged.dispatch(f))}}catch(e){e===l.notSupportedError?this._logger.debug("Player not supported. Not constructed."):this._logger.error("Error during construction.",e),i(),n("MOVE_ON_SAME_RENDITION")}},e.prototype._getNewUrlWithSameRendition=function(e){var t=this,n=new s.helpers.abortableJob.AbortableJob(function(){var n=t._streamUrlRetriever.getUrl(t._getURLOpts),r=n.whenComplete().then(function(t){var n=null;return t&&t.success&&t.rendition===e&&(n=t.url),n});return{result:r,abort:function(){return n.abort()}}});return n.run()},e}();t.ControllerManager=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(12),o=1e3,a=function(){function e(e,t,n,i,a){this._checkpointTimer=null,this._logger=r.logger.prefixLogger(i,"AudioEventGenerator"),this._player=e,this._eventReporter=t,this._checkpointInterval=Math.max(o,n),this._getPlayerDetails=a,this._startReporting()}return e.prototype._startReporting=function(){var e=this,t=this._player;t.onChange.subscribe(function(n){var r=n.actuallyPlaying,i=n.ended;!0===r&&!t.isEnded()||!1===i&&t.isActuallyPlaying()?(e._checkpointTimer||(e._checkpointTimer=window.setInterval(function(){e._reportEvent("checkpoint")},e._checkpointInterval)),e._reportEvent("play")):(!1===r&&!t.isEnded()||!0===i&&t.isActuallyPlaying())&&(e._checkpointTimer&&(window.clearInterval(e._checkpointTimer),e._checkpointTimer=null),e._reportEvent("pause"))})},e.prototype._reportEvent=function(e){var t=this._getPlayerDetails();if(t){var n=this._player.getDuration();if(null===n)throw new Error("Duration should exist now.");var r={type:e,position:this._player.getPosition(),duration:n,preset:t.preset,quality:t.quality,playerType:t.name,appState:i.getAppState()};this._logger.debug("Generated audio event.",r),this._eventReporter(r)}else this._logger.warn("Cannot report event because there is no player.",e)},e}();t.AudioEventGenerator=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._delayFactor=0,this._lastRequestTime=0}return e.prototype.getDelay=function(e){var t=void 0===e?{}:e,n=t.maxDelay,r=void 0===n?3e4:n,i=t.numInstantRuns,o=void 0===i?5:i,a=Date.now()-this._lastRequestTime;this._lastRequestTime=Date.now(),this._delayFactor=Math.max(0,this._delayFactor-a/r),this._delayFactor++;var s=this._delayFactor-o;return s>0?Math.pow(2,s):0},e}();t.DecayingExponentialDelayCalculator=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(12),o=function(){function e(e,t,n,i,o,a){this._logger=r.logger.prefixLogger(a,"ErrorGenerator"),this._player=e,this._logCollector=t,this._logId=n,this._trackId=i,this._eventReporter=o,this._listenForProxyFatalError()}return e.prototype.reportManualEvent=function(e,t){"NOT_SUPPORTED_ERROR"!==e&&"HLS_MSE_PLAYER.NO_TRANSMUXER_ERROR"!==e&&(this._logger.debug("Reporting manual error event.",e),this._reportEvent(e,t))},e.prototype._listenForProxyFatalError=function(){var e=this;this._player.onError.subscribe(function(t){t instanceof r.errors.PlayerFatalError&&e._reportEvent(t.getCode())})},e.prototype._reportEvent=function(e,t){var n={errorCode:e,log:this._logCollector.getLog(),logId:this._logId,trackId:this._trackId,protocol:t&&t.protocol,playerType:t&&t.name?t.name:"MaestroUnknown",host:t&&t.host,bitrate:t&&t.bitrate,format:t&&t.format,preset:t&&t.preset,quality:t&&t.quality,url:t&&t.url,appState:i.getAppState()};this._logger.debug("Generated audio error event.",n),this._eventReporter(n)},e}();t.ErrorEventGenerator=o},function(e,t,n){"use strict";function r(e,t){var n=e.getBufferedTimeRanges();return n?o(n,function(e){return e.containsTime(t)})||new i.TimeRange(t,0):null}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=i.helpers.find,a=function(){function e(e){var t=e.proxy,n=e.getPlayer;this._getPlayer=n;var i=this._position=t.getPosition(),o=this._initialActualPlayer=n();if(o){var a=r(o,i);this._initialBuffered=a?a.end-i:null}else this._initialBuffered=null}return e.prototype.getPreloaded=function(){var e=this._initialBuffered;return null!==e&&this._initialActualPlayer&&this._getPlayer()===this._initialActualPlayer?0===e?"no":e>=2e3?"yes":"partial":null},e}();t.PreloadingCalculator=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=r.helpers.time.now,o=function(){function e(){this._start=null,this._end=null}return e.prototype.start=function(){if(this.isComplete())throw new Error("Timer completed.");this._start=i()},e.prototype.isComplete=function(){return null!==this._end},e.prototype.stop=function(){if(null===this._start)throw new Error("Not started.");this._end=i()},e.prototype.getTime=function(){if(null===this._end)throw new Error("Not completed.");return this._end-this._start},e}();t.Timer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(83),o=n(82),a=n(12),s=function(){function e(e,t,n,i,o){this._logger=r.logger.prefixLogger(i,"AudioPerformanceEventGenerator"),this._proxy=e,this._getPlayer=t,this._eventReporter=n,this._getPlayerDetails=o,this._measureGeneralEvents()}return e.prototype.reportManualEvent=function(e){this._logger.debug("Reporting manual audio performance event.",e),this._eventReporter(e)},e.prototype._measureGeneralEvents=function(){var e=this,t=this._proxy,n=null,r=null,a=null,s=null,l=null,u=null,c=null,h=!0;t.onChange.subscribe(function(d){var f=d.playing,p=d.actuallyPlaying,m=d.seek,g=d.seeking,_=d.stalled,v=d.ended,y=d.dead;if(!0!==y&&!1!==f||!s||(s.stop(),s.getTime()>=1e3&&e._reportEvent("rageSkip",s.getTime(),null),s=null),t.isDead())c&&window.clearTimeout(c);else{var b=t.getSeekState();t.isActuallyPlaying()||s||!(!0===f||t.isPlaying()&&!0===_)||(s=new i.Timer).start(),!0===f&&(n||((n=new i.Timer).start(),r=new o.PreloadingCalculator({proxy:t,getPlayer:e._getPlayer}),c=window.setTimeout(function(){e._reportEvent("longInitialBuffering",0,null)},3e4),0===t.getPosition()&&(h=!1))),!1===f&&(c&&window.clearTimeout(c),n&&!n.isComplete()&&(n=null)),!0===p&&(s=null,n&&!n.isComplete()&&(n.stop(),c&&window.clearTimeout(c),e._reportEvent("play",n.getTime(),r.getPreloaded()))),m&&"IN_PROGRESS"===m.state&&t.isReady()&&((a=new i.Timer).start(),l=new o.PreloadingCalculator({proxy:t,getPlayer:e._getPlayer}),!0===g&&e._reportEvent("seekStart",0,null)),(m&&"COMPLETED"===m.state&&!t.isStalled()||!1===_&&b&&"COMPLETED"===b.state)&&a&&(a.stop(),e._reportEvent("seek",a.getTime(),l.getPreloaded()),a=null),!0!==_||!t.isPlaying()||b&&"IN_PROGRESS"===b.state||n&&n.isComplete()&&((u=new i.Timer).start(),e._reportEvent("rebufferingStart",t.getPosition(),null)),!1===_&&(n&&n.isComplete()&&(s=null),u&&(u.stop(),e._reportEvent("rebufferingEnd",u.getTime(),null),u=null)),!0!==v||h||(e._reportEvent("uninterruptedPlay",0,null),h=!0);var E=b&&"IN_PROGRESS"===b.state;!E&&!0===_&&t.isActuallyPlaying()&&(h=!0)}})},e.prototype._reportEvent=function(e,t,n){var r=this._getPlayerDetails();if(r){var i={type:e,latency:t,protocol:r.protocol,playerType:r.name,host:r.host,bitrate:r.bitrate,format:r.format,preset:r.preset,quality:r.quality,preloaded:n||void 0,appState:a.getAppState()};this._logger.debug("Generated audio performance event.",i),this._eventReporter(i)}else this._logger.warn("Cannot report event because there is no player.",e,t)},e}();t.AudioPerformanceEventGenerator=s},function(e,t,n){"use strict";function r(e){return e.map(function(e){try{return JSON.stringify(e)}catch(e){return"<unavailable>"}})}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){void 0===e&&(e=200),this._bufferSize=e,this._log=[]}return e.prototype.getLog=function(){return this._log.map(function(e){return i({},e,{data:r(e.data)})})},e.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this._push({level:"debug",msg:e,data:t,time:Date.now()})},e.prototype.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this._push({level:"info",msg:e,data:t,time:Date.now()})},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this._push({level:"warn",msg:e,data:t,time:Date.now()})},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this._push({level:"error",msg:e,data:t,time:Date.now()})},e.prototype._push=function(e){this._log.push(e)>this._bufferSize&&this._log.shift()},e}();t.LogCollector=o},function(e,t,n){"use strict";function r(e,t,n){return Math.min(t,Math.max(e,n))}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(26),s=n(85),l=n(84),u=n(81),c=n(80),h=n(79),d=n(78),f=n(33),p=n(32),m=n(6),g=n(15),_=n(31),v=n(30),y=n(29),b=n(14),E=n(13),x=o.eventDispatcher.EventDispatcher,T=o.helpers.Promise,S=o.helpers.deferred.buildDeferred,A=new f.CacheManager(15e7,o.logger.noOpLogger),P=-1,M=[],R=1,C=!1;t.setGlobalVolume=function(e){if("number"!=typeof e)throw new Error("level must be a number.");if(e<0||e>1)throw new Error("Invalid volume level.");R=e,M.forEach(function(t){return t.setVolume(e)})},t.getGlobalVolume=function(){return R},t.setGlobalMuted=function(e){if("boolean"!=typeof e)throw new Error("muteEnabled must be a boolean.");C=e,M.forEach(function(t){return t.setMuted(e)})},t.getGlobalMuted=function(){return C},t.setCacheSize=function(e){if("number"!=typeof e||e<0)throw new Error("Invalid size.");A.setCacheSize(e)};var w=function(e){function t(t){var n=e.call(this,t)||this;n._onPreloadingEnabled=new x,n._onPreloadingDisabled=new x,n._retryDelayCalculator=new c.DecayingExponentialDelayCalculator,n._errorEventGenerator=null,n._fadeOutVolumeAutomator=null,n._volumeAutomators=[],n._volumeScale=1,n._userVolume=1,n._volumeAutomationSupported=!1,n._timer=null,n._pauseFadeTimer=null,n._pauseFadeDeferred=null,n._pauseFade=null,n._executionState={state:"IDLE"},n._preloadingListeners=[],n._retrieveAndBuildTimer=null,n._hadAStreamUrl=!1;var r=n._config=_.validatePlayerDependencies(t);n._preloadingEnabled=r.preloadingEnabled,n._getURLOpts=r.getURLOpts,n._controllers=r.controllers;var i=n._connectionRequiredHelper=new y.ConnectionRequiredHelper(n);n.onPreloadingEnabled=n._onPreloadingEnabled.getHandle(),n.onPreloadingDisabled=n._onPreloadingDisabled.getHandle(),n.onConnectionRequired=i.onConnectionRequired,n.onConnectionRecovered=i.onConnectionRecovered,n.onChange.subscribe(function(e){n.isDead()||((!1===e.playing||e.positionJumped||e.stalled||e.ended)&&n._completePauseFade(),n._pauseFade&&(!1===e.actuallyPlaying||e.ended||!0===e.playing)&&(n._removeVolumeAutomator(n._pauseFade),n._pauseFade=null),(e.positionJumped||void 0!==e.actuallyPlaying||void 0!==e.stalled)&&n._updateVolume(),void 0!==e.playing&&n._updateMaxBufferLength())});var a="SCAudio-"+ ++P,f=r.streamUrlRetriever.getTrackId();null!==f&&(a+="-"+f);var p=new s.LogCollector,m=o.logger.cloneLogger(p,n._logger);n._logger=o.logger.prefixLogger(m,a);var g=v.generateLogId();n._logger.info("Building player...",{ua:navigator.userAgent,getURLOpts:n._getURLOpts,logId:g}),M.push(n),n.setVolume(R,C),n._updateFadeOut();var b=null,E=null;r.audioPerformanceReporter&&(b=new l.AudioPerformanceEventGenerator(n,function(){return n._getPlayer()},r.audioPerformanceReporter,n._logger,function(){return n._getActivePlayerDetails()})),r.audioReporter&&new h.AudioEventGenerator(n,r.audioReporter,r.audioCheckpointInterval,n._logger,function(){return n._getActivePlayerDetails()}),r.errorReporter&&(E=n._errorEventGenerator=new u.ErrorEventGenerator(n,p,g,f,r.errorReporter,n._logger)),n._excludeUnsupportedRenditions();var T=n._controllerManager=new d.ControllerManager({logger:n._logger,controllers:r.controllers,playerId:a,streamUrlsExpire:r.streamUrlsExpire,fetchEnabled:r.fetchEnabled,fadeOnPauseAndPlay:r.fadeOnPauseAndPlay,fadeOnSeek:r.fadeOnSeek,cacheManager:A,providePlayer:function(e,t,r){n._volumeAutomationSupported=r,n._providePlayer(e,t),n._updateMaxBufferLength()},removePlayer:function(){n._getPlayer()&&n._removePlayer()},streamUrlRetriever:n._config.streamUrlRetriever,getURLOpts:n._getURLOpts,errorEventGenerator:E||void 0,audioPerformanceEventGenerator:b||void 0});if(n.onQualityChanged=T.onQualityChanged,void 0!==r.duration&&(n._logger.debug("Setting initial duration.",r.duration),n._setInitialDuration(r.duration)),n._preloadingEnabled)n._logger.debug("Preloading is enabled, so performing retrieve immediately."),n._retrieveAndBuild();else{n._logger.debug("Preloading is disabled, so deferring retrieve until either a play intent or preloading is enabled.");var S=function(){n._removePreloadingListeners(),n._logger.debug("Preloading now enabled or received a play request. Peforming retrieve."),n._retrieveAndBuild()};n._preloadingListeners.push(n.onPreloadingEnabled.subscribe(S),n.onPlayIntent.subscribe(S))}return n}return i(t,e),t.prototype.reload=function(e){void 0===e&&(e={}),this._ensureNotDead(),this._reloadStreamUrls(e)},t.prototype.enablePreloading=function(){this.isDead()||this._preloadingEnabled||(this._preloadingEnabled=!0,this._updateMaxBufferLength(),this._onPreloadingEnabled.dispatch(void 0))},t.prototype.disablePreloading=function(){this.isDead()||this._preloadingEnabled&&(this._preloadingEnabled=!1,this._updateMaxBufferLength(),this._onPreloadingDisabled.dispatch(void 0))},t.prototype.isPreloadingEnabled=function(){return this._preloadingEnabled},t.prototype.pauseAfterFade=function(e){var t=this;if(this._ensureNotDead(),this._pauseFadeDeferred)return this._pauseFadeDeferred.promise;if(!this.isPlaying()||!this.isActuallyPlaying())return T.resolve(this.pause());var n=S();this._pauseFadeDeferred=n;var r=this.getPosition();if(this._pauseFade)throw new Error("Fade should not already be assigned.");return this._pauseFade=new a.Fade({startPos:r,endPos:r+e,startLevel:1,endLevel:0}),this._addVolumeAutomator(this._pauseFade),this._pauseFadeTimer=window.setTimeout(function(){t._pauseFadeDeferred=null,n.resolve(t.pause({fadeDuration:0}))},e+50),n.promise},t.prototype.isConnectionRequired=function(){return this._connectionRequiredHelper.isConnectionRequired()},t.prototype.getQuality=function(){return this._controllerManager.getQuality()},t.prototype.getVolume=function(){return this._volumeAutomationSupported?this._userVolume:e.prototype.getVolume.call(this)},t.prototype._handleFatalError=function(e){this._logger.warn("Fatal error from current player.",e)},t.prototype._handleVolumeChange=function(t,n){this._userVolume=t,e.prototype._notifyVolumeChange.call(this,t,n),this._calculateAndSetVolume()},t.prototype._notifyVolumeChange=function(){},t.prototype._kill=function(){e.prototype._kill.call(this),this._timer&&window.clearTimeout(this._timer),this._abortPauseFade(),this._removePreloadingListeners(),M.splice(M.indexOf(this),1),"RETRIEVING_URL"===this._executionState.state?this._executionState.retrieveJob.abort():"CONTROLLING_PLAYER"===this._executionState.state&&this._controllerManager.releaseCurrentController({retry:!1}),this._executionState={state:"DEAD"},this._retrieveAndBuildTimer&&window.clearTimeout(this._retrieveAndBuildTimer)},t.prototype._excludeUnsupportedRenditions=function(){var e=this,t={streamUrlExpires:this._config.streamUrlsExpire},n=E.allRenditions.filter(function(n){return!e._controllers.some(function(e){return e.isRenditionSupported(n,t)})});n.forEach(function(t){e._config.streamUrlRetriever.excludeRendition(t)})},t.prototype._addVolumeAutomator=function(e){var t=this._volumeAutomators.indexOf(e);t<0&&(this._volumeAutomators.push(e),this._updateVolume())},t.prototype._removeVolumeAutomator=function(e){var t=this._volumeAutomators.indexOf(e);t>=0&&(this._volumeAutomators.splice(t,1),this._updateVolume())},t.prototype._removePreloadingListeners=function(){this._preloadingListeners.forEach(function(e){return e.remove()})},t.prototype._getActivePlayerDetails=function(){return"CONTROLLING_PLAYER"!==this._executionState.state?null:this._controllerManager.getPlayerDetails()},t.prototype._updateFadeOut=function(){this._fadeOutVolumeAutomator&&this._removeVolumeAutomator(this._fadeOutVolumeAutomator),this._getURLOpts.snippet&&(this._fadeOutVolumeAutomator=a.buildFadeOut(3e3),this._addVolumeAutomator(this._fadeOutVolumeAutomator))},t.prototype._handleUnexpectedError=function(e){try{e()}catch(e){this._logger.error("Unexpected error.",e),this._triggerError(new o.errors.PlayerFatalError("An unexpected error occurred.",e))}},t.prototype._retrieveAndBuild=function(){var e=this;this._handleUnexpectedError(function(){if(-1===["IDLE","WAITING_TO_RETRIEVE"].indexOf(e._executionState.state))throw new Error("Invalid state for retrieveAndBuild().");e._logger.debug("Retrieving URL...");var t=p.retrieveUrl({streamUrlRetriever:e._config.streamUrlRetriever,urlProviderRetryDelayCalculator:e._config.urlProviderRetryDelayCalculator,getURLOpts:e._getURLOpts,logger:e._logger});e._executionState={state:"RETRIEVING_URL",retrieveJob:t},t.onCompletion(function(t){if(e._logger.debug("Retrieved URL.",!!t),t&&t.success){e._hadAStreamUrl=!0;var n=!1,r=function(r){var i=r.excludeRendition,o=r.immediateRetry;e._handleUnexpectedError(function(){if(n)throw new Error("startOver called multiple times.");if(n=!0,i&&e._config.streamUrlRetriever.excludeRendition(t.rendition),e._executionState={state:"WAITING_TO_RETRIEVE"},e.isDead())e._logger.debug("Stopping execution because player is dead.");else if(o)e._logger.debug("Moving on immediately."),e._retrieveAndBuild();else{var r=e._retryDelayCalculator.getDelay();e._logger.debug("Will move on in "+r+"ms."),r?e._retrieveAndBuildTimer=window.setTimeout(function(){return e._retrieveAndBuild()},r):e._retrieveAndBuild()}})};e._handleUnexpectedError(function(){e._executionState={state:"CONTROLLING_PLAYER"},e._logger.debug("Building controller..."),e._controllerManager.buildNextController(t,r),e._logger.debug("Built controller.")})}else if(t&&t.rendition){if(e._logger.warn("Error retrieving URL. Moving on.",t.error),e._errorEventGenerator){var i="SCAUDIO.URL_RETRIEVER_ERROR."+e._config.streamUrlRetriever.name+"."+t.error.getCode();e._errorEventGenerator.reportManualEvent(i,{preset:t.preset,quality:t.quality,bitrate:t.bitrate,format:t.rendition.scFormat,protocol:t.rendition.scProtocol})}e._config.streamUrlRetriever.excludeRendition(t.rendition),e._executionState={state:"WAITING_TO_RETRIEVE"},e._retrieveAndBuild()}else t&&t.rendition&&e._logger.warn("Error retrieving URL for any rendition.",t.error),e._logger.info("Ran out of streams.",e._hadAStreamUrl),e._triggerError(e._hadAStreamUrl?new m.NotSupportedError:new g.NoStreamsError)}),t.onError(function(t){t!==o.helpers.abortableJob.abortedError&&(t===p.NoMoreAttemptsError?e._logger.error("Ran out of retries to retrieve URL."):e._logger.error("Unexpected error when retrieving a URL.",t),e._triggerError(new b.FailedRetrievingUrlError))})})},t.prototype._reloadStreamUrls=function(e){this._getURLOpts=e,this._updateFadeOut(),this._logger.info("Reloading stream URL's...",this._getURLOpts),"RETRIEVING_URL"===this._executionState.state?(this._logger.debug("Aborting current URL retrieve."),this._executionState.retrieveJob.abort(),this._executionState={state:"WAITING_TO_RETRIEVE"},this._retrieveAndBuild()):"CONTROLLING_PLAYER"===this._executionState.state?(this._logger.debug("Releasing controller."),this._controllerManager.releaseCurrentController({retry:!0})):this._logger.debug("Nothing to do."),this._logger.info("Reloaded stream URL's.")},t.prototype._completePauseFade=function(){if(this._pauseFadeDeferred){this._pauseFadeTimer&&window.clearTimeout(this._pauseFadeTimer);var e=this._pauseFadeDeferred;this._pauseFadeDeferred=null,e.resolve(this.pause())}},t.prototype._abortPauseFade=function(){this._pauseFadeTimer&&(window.clearTimeout(this._pauseFadeTimer),this._pauseFadeTimer=null),this._pauseFadeDeferred&&(this._pauseFadeDeferred.reject(new Error("Player was killed.")),this._pauseFadeDeferred=null)},t.prototype._updateVolume=function(){var e=this;if(this._volumeAutomationSupported){this._ensureNotDead(),this._timer&&(window.clearTimeout(this._timer),this._timer=null);var t=this.getDuration();if(null!==t){var n=this._volumeAutomators,i=this.getPosition(),o=1/0,a=1;n.forEach(function(e){var n=e.calculate(i,t),s=n.nextCalculatePosition,l=n.level;a*=r(0,1,l),s<o&&(o=s)}),this._volumeScale!==a&&(this._volumeScale=a,this._calculateAndSetVolume()),o<1/0&&this.isActuallyPlaying()&&!this.isStalled()&&(this._timer=window.setTimeout(function(){e._timer=null,e._updateVolume()},r(100,5e3,o-this.getPosition())))}}},t.prototype._calculateAndSetVolume=function(){this._volumeAutomationSupported?e.prototype._handleVolumeChange.call(this,this._userVolume*this._volumeScale,this.getMuted()):e.prototype._handleVolumeChange.call(this,this._userVolume,this.getMuted())},t.prototype._updateMaxBufferLength=function(){var e=this._getPlayer(),t=e&&e.getBufferController();t&&(this.isPlaying()?t.setMaxBufferLength(this._config.playingMaxBufferLength):t.setMaxBufferLength(this._preloadingEnabled?this._config.pausedMaxBufferLength:0))},t}(o.ProxyPlayerBase);t.Player=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){void 0===e&&(e="UNKNOWN"),void 0===t&&(t=!1),void 0===n&&(n=null),this._code=e,this._transient=t,this._cause=n}return e.prototype.isTransient=function(){return this._transient},e.prototype.getCode=function(){return this._code},e.prototype.getCause=function(){return this._cause},e}();t.UrlRetrieverError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.httpAACHQ={scProtocol:"http",scFormat:"aac",maestroFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedHlsOpus={scProtocol:"encrypted-hls",scFormat:"opus",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/ogg",audioCodec:{id:"opus"}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsOpus={scProtocol:"hls",scFormat:"opus",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/ogg",audioCodec:{id:"opus"}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maestroChromecast={scProtocol:"maestro.chromecast",maestroFormat:{}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiMobile={scProtocol:"sc.api-mobile",maestroFormat:{}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedHlsAACHQ={scProtocol:"encrypted-hls",scFormat:"aac",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsAACHQ={scProtocol:"hls",scFormat:"aac",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedHlsMp3={scProtocol:"encrypted-hls",scFormat:"mp3",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mpeg"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsMp3={scProtocol:"hls",scFormat:"mp3",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mpeg"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.httpMp3={scProtocol:"http",scFormat:"mp3",maestroFormat:{mimeType:"audio/mpeg"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(26);!function(e){e.Fade=r.Fade,e.buildFadeIn=r.buildFadeIn,e.buildFadeOut=r.buildFadeOut}(t.volumeAutomation||(t.volumeAutomation={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),t.version="23.1.0",t.buildNumber=845;var i=n(98);t.volumeAutomation=i.volumeAutomation;var o=n(25);t.BaseStreamUrlRetriever=o.BaseStreamUrlRetriever,r(n(24));var a=n(13);t.renditions=a.renditions,t.allRenditions=a.allRenditions;var s=n(87);t.UrlRetrieverError=s.UrlRetrieverError;var l=n(86);t.Player=l.Player,t.setGlobalVolume=l.setGlobalVolume,t.setGlobalMuted=l.setGlobalMuted,t.getGlobalVolume=l.getGlobalVolume,t.getGlobalMuted=l.getGlobalMuted,t.setCacheSize=l.setCacheSize;var u=n(28);t.Quality=u.Quality,t.resolveQuality=u.resolveQuality,r(n(27))}])}(n(2))},function(e,t,n){window,e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=97)}([function(e,t,n){"use strict";var r=n(4);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";e.exports=n(62)()?Symbol:n(61)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deferException=function(e){try{e()}catch(e){window.setTimeout(function(){throw e},0)}}},function(e,t,n){"use strict";var r=n(24)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"PLAYER_FATAL_ERROR"},t}(i.PlayerError);t.PlayerFatalError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),i=function(){function e(){this._listeners=[],this.dispatch=this.dispatch.bind(this)}return e.prototype.subscribe=function(e){var t=this,n={fn:e,payloads:[]};return this._listeners.push(n),{remove:function(){var e=t._listeners.indexOf(n);return e>=0&&(t._listeners.splice(e,1),!0)},retrieve:function(){return t._dispatchListenerPayloads(n)}}},e.prototype.dispatch=function(e,t){var n=this,i="number"==typeof t?{time:t}:t||{},o=void 0!==i.time?i.time:r.now(),a=this._listeners;a.forEach(function(t){return t.payloads.push({time:o,payload:e})});var s=!1;do{s=!a.some(function(e){var t=e.fn,r=e.payloads,i=r.shift();return!!i&&(n._callHandler(t,i),!0)})}while(!s)},e.prototype.getHandle=function(){return{subscribe:this.subscribe.bind(this)}},e.prototype._dispatchListenerPayloads=function(e){for(var t=e.fn,n=e.payloads;;){var r=n.shift();if(!r)break;this._callHandler(t,r)}},e.prototype._callHandler=function(e,t){try{e(t.payload,t.time)}catch(e){window.setTimeout(function(){throw e},0)}},e}();t.EventDispatcher=i},function(e,t,n){"use strict";var r=n(14),i=n(23),o=n(66),a=n(22);(e.exports=function(e,t){var n,o,s,l,u;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],null==e?(n=s=!0,o=!1):(n=a.call(e,"c"),o=a.call(e,"e"),s=a.call(e,"w")),u={value:t,configurable:n,enumerable:o,writable:s},l?r(i(l),u):u}).gs=function(e,t,n){var s,l,u,c;return"string"!=typeof e?(u=n,n=t,t=e,e=null):u=arguments[3],null==t?t=void 0:o(t)?null==n?n=void 0:o(n)||(u=n,n=void 0):(u=t,t=n=void 0),null==e?(s=!0,l=!1):(s=a.call(e,"c"),l=a.call(e,"e")),c={get:t,set:n,configurable:s,enumerable:l},u?r(i(u),c):c}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(95);t.Promise=r.Promise},function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call("");e.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||r.call(e)===i)||!1}},function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call(function(){return arguments}());e.exports=function(e){return r.call(e)===i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._msg=e,this._cause=t}return e.prototype.getCode=function(){return"PLAYER_ERROR"},e.prototype.getMsg=function(){return this._msg},e.prototype.getCause=function(){return this._cause},e}();t.PlayerError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),i=r.isIE();t.noOpLogger={debug:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},error:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},info:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},warn:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]}},t.consoleLogger={debug:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r;i?console.log(e,t):(r=console.debug||console.log).call.apply(r,[console,e].concat(t))},error:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r;i?console.log(e,t):(r=console.error||console.log).call.apply(r,[console,e].concat(t))},info:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r;i?console.log(e,t):(r=console.info||console.log).call.apply(r,[console,e].concat(t))},warn:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r;i?console.log(e,t):(r=console.warn||console.log).call.apply(r,[console,e].concat(t))}},t.prefixLogger=function(e,t){return{debug:function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return e.debug.apply(e,["["+t+"] "+n].concat(r))},error:function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return e.error.apply(e,["["+t+"] "+n].concat(r))},info:function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return e.info.apply(e,["["+t+"] "+n].concat(r))},warn:function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return e.warn.apply(e,["["+t+"] "+n].concat(r))}}},t.cloneLogger=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{debug:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return e.forEach(function(e){return e.debug.apply(e,[t].concat(n))})},error:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return e.forEach(function(e){return e.error.apply(e,[t].concat(n))})},info:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return e.forEach(function(e){return e.info.apply(e,[t].concat(n))})},warn:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return e.forEach(function(e){return e.warn.apply(e,[t].concat(n))})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8);t.buildDeferred=function(){var e,t,n=!1;return{promise:new r.Promise(function(n,r){e=n,t=r}),resolve:function(t){n||(n=!0,e(t))},reject:function(e){n||(n=!0,t(e))},isSettled:function(){return n}}}},function(e,t,n){"use strict";e.exports=n(71)()?Object.assign:n(70)},function(e,t,n){"use strict";e.exports=n(27)()?Object.setPrototypeOf:n(26)},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),o=function(e){function t(t,n,r){return void 0===r&&(r="The player that the proxy was controlling had a fatal error."),e.call(this,t,n,r)||this}return r(t,e),t.prototype.getCode=function(){return"PROXY_PLAYER_PROVIDED_PLAYER_FATAL_ERROR"},t}(i.ProxyProvidedPlayerError);t.ProxyProvidedPlayerFatalError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(e,t){var n=void 0;return e.some(function(e){return!!t(e)&&(n=e,!0)}),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.always=function(e,t){return e.then(t,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Date.now();t.now=function(){return"performance"in window&&window.performance.now?window.performance.now():Date.now()-r}},function(e,t,n){"use strict";var r,i=n(58),o=n(14),a=n(1),s=n(0),l=n(7),u=n(57),c=n(2),h=Object.defineProperty,d=Object.defineProperties;e.exports=r=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");d(this,{__list__:l("w",s(e)),__context__:l("w",t),__nextIndex__:l("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete r.prototype.constructor,d(r.prototype,o({_next:l(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:l(function(){return this._createResult(this._next())}),_createResult:l(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:l(function(e){return this.__list__[e]}),_unBind:l(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:l(function(){return"[object "+(this[c.toStringTag]||"Object")+"]"})},u({_onAdd:l(function(e){if(!(e>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__)return void h(this,"__redo__",l("c",[e]));this.__redo__.forEach(function(t,n){t>=e&&(this.__redo__[n]=++t)},this),this.__redo__.push(e)}}),_onDelete:l(function(e){var t;e>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(t=this.__redo__.indexOf(e))&&this.__redo__.splice(t,1),this.__redo__.forEach(function(t,n){t>e&&(this.__redo__[n]=--t)},this)))}),_onClear:l(function(){this.__redo__&&i.call(this.__redo__),this.__nextIndex__=0})}))),h(r.prototype,c.iterator,l(function(){return this}))},function(e,t,n){"use strict";var r=n(10),i=n(9),o=n(63),a=n(43),s=n(42),l=n(2).iterator;e.exports=function(e){return"function"==typeof s(e)[l]?e[l]():r(e)?new o(e):i(e)?new a(e):new o(e)}},function(e,t,n){"use strict";e.exports=n(65)()?String.prototype.contains:n(64)},function(e,t,n){"use strict";var r=n(4),i=Array.prototype.forEach,o=Object.create;e.exports=function(e){var t=o(null);return i.call(arguments,function(e){r(e)&&function(e,t){var n;for(n in e)t[n]=e[n]}(Object(e),t)}),t}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(4),i={function:!0,object:!0};e.exports=function(e){return r(e)&&i[typeof e]||!1}},function(e,t,n){"use strict";var r,i=n(25),o=n(0),a=Object.prototype.isPrototypeOf,s=Object.defineProperty,l={configurable:!0,enumerable:!1,writable:!0,value:void 0};r=function(e,t){if(o(e),null===t||i(t))return e;throw new TypeError("Prototype must be null or an object")},e.exports=function(e){var t,n;return e?(2===e.level?e.set?(n=e.set,t=function(e,t){return n.call(r(e,t),t),e}):t=function(e,t){return r(e,t).__proto__=t,e}:t=function e(t,n){var i;return r(t,n),(i=a.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===n&&(n=e.nullPolyfill),t.__proto__=n,i&&s(e.nullPolyfill,"__proto__",l),t},Object.defineProperty(t,"level",{configurable:!1,enumerable:!1,writable:!1,value:e.level})):null}(function(){var e,t=Object.create(null),n={},r=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(r){try{(e=r.set).call(t,n)}catch(e){}if(Object.getPrototypeOf(t)===n)return{set:e,level:2}}return t.__proto__=n,Object.getPrototypeOf(t)===n?{level:2}:((t={}).__proto__=n,Object.getPrototypeOf(t)===n&&{level:1})}()),n(74)},function(e,t,n){"use strict";var r=Object.create,i=Object.getPrototypeOf,o={};e.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||r;return"function"==typeof e&&i(e(t(null),o))===o}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),o=function(e){function t(t,n,r){void 0===r&&(r="The player that the proxy was controlling had an error.");var i=e.call(this,r)||this;return i._providedPlayerError=t,i._providedPlayer=n,i}return r(t,e),t.prototype.getCode=function(){return"PROXY_PLAYER_PROVIDED_PLAYER_ERROR"},t.prototype.getProvidedPlayerError=function(){return this._providedPlayerError},t.prototype.getProvidedPlayer=function(){return this._providedPlayer},t}(i.PlayerError);t.ProxyProvidedPlayerError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t.prototype.getCode=function(){return"IMPLEMENTATION_ERROR"},t}(i.PlayerFatalError);t.ImplementationError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(){function e(e,t){this._inCallback=!1,this._onExit=e,this._onEnter=t||null}return e.prototype.enter=function(e){var t=this;if(this._inCallback)return e?e(this._onEnterResultRetriever):void 0;this._inCallback=!0;var n=[],i=!1;this._onEnter&&(this._onEnterResultRetriever={getResult:function(e){i?r.deferException(function(){return e(t._onEnterError,t._onEnterResult)}):n.push(e)}});try{var o=e?e(this._onEnterResultRetriever):void 0;if(this._onEnter){this._onEnterError=void 0,this._onEnterResult=void 0;try{this._onEnterResult=this._onEnter()}catch(e){this._onEnterError=e}i=!0,n.forEach(function(e){return r.deferException(function(){return e(t._onEnterError,t._onEnterResult)})})}return o}finally{this._inCallback=!1,r.deferException(function(){return t._onExit(t._onEnterError,t._onEnterResult)})}},e}();t.OnExit=i},function(e,t,n){"use strict";function r(e){var t=Object.create(null);return Object.keys(e).forEach(function(n){t[n]=e[n]}),t}Object.defineProperty(t,"__esModule",{value:!0});var i=n(30),o=n(3),a=function(){},s=function(){function e(e,t){void 0===t&&(t={});var n=this;this._subscribers=[],this._onExit=new i.OnExit(function(){return n._after()},function(){return n._onEnter()}),this._beforeUpdateError=void 0,this._inAfterUpdate=!1,this._dead=!1,this._officiallyDead=!1,this._errors=[],this._state=r(e),this._initialState=r(e),this._beforeUpdate=t.beforeUpdate||function(){},this._afterUpdate=t.afterUpdate||a,this._afterDispatches=t.afterDispatches||a}return e.prototype.subscribe=function(e,t){var n=this;if(void 0===t&&(t=!0),this._dead){var i=!1;return{retrieve:function(){},remove:function(){return!i&&(i=!0)}}}var o={callback:e,localState:t?r(this._state):this._initialState};return this._subscribers.push(o),t||this._updateSubscriber(o),{remove:function(){var t=n._subscribers.map(function(e){return e.callback}).indexOf(e);return t>=0&&(n._subscribers.splice(t,1),!0)},retrieve:function(){n._updateSubscriber(o)}}},e.prototype.subscribeIndividual=function(e,t,n){return this.subscribe(function(n){var r=n[e];void 0!==r&&t(r)},n)},e.prototype.getHandle=function(){return{subscribe:this.subscribe.bind(this)}},e.prototype.getIndividualHandle=function(e){var t=this;return{subscribe:function(n){return t.subscribeIndividual(e,n)}}},e.prototype.update=function(e){var t=this;this._officiallyDead||(this._inAfterUpdate?e&&e(this._state,this._beforeUpdateError):this._onExit.enter(function(n){n.getResult(function(){try{e&&e(t._state,t._beforeUpdateError)}catch(e){t._errors.push(e)}})}))},e.prototype.getState=function(){return this._state},e.prototype.kill=function(){var e=this;this._dead||(this._dead=!0,window.setTimeout(function(){e._subscribers.splice(0),e._officiallyDead=!0},0))},e.prototype.isDead=function(){return this._dead},e.prototype._onEnter=function(){this._beforeUpdateError=void 0;try{this._beforeUpdate(this._state)}catch(e){this._beforeUpdateError=e}},e.prototype._after=function(){var e=this,t=this._errors;this._errors=[],o.deferException(function(){e._inAfterUpdate=!0;try{e._afterUpdate(e._state,{beforeUpdate:e._beforeUpdateError,update:t})}catch(t){throw e._inAfterUpdate=!1,t}e._inAfterUpdate=!1,e._subscribers.slice().forEach(function(t){return e._updateSubscriber(t)}),e._afterDispatches(e._state)})},e.prototype._updateSubscriber=function(e){var t=this._calculateDiff(e.localState);Object.keys(t).length&&(e.localState=r(this._state),o.deferException(function(){return e.callback(t,e.localState)}))},e.prototype._calculateDiff=function(e){var t=this,n=Object.create(null);return Object.keys(this._state).forEach(function(r){var i=t._state[r];i!==e[r]&&(n[r]=i)}),n},e}();t.StateManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LOADING=0]="LOADING",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.DEAD=3]="DEAD"}(t.State||(t.State={}))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=function(e){function t(t){return e.call(this,t||"The player cannot play the provided descriptor.")||this}return r(t,e),t.prototype.getCode=function(){return"NOT_SUPPORTED_ERROR"},t}(i.PlayerFatalError);t.NotSupportedError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(33),o=n(6),a=n(13),s=n(17),l=n(19),u=n(8),c=n(32),h=n(12),d=n(31),f=n(29),p=n(3),m="undefined"!=typeof navigator&&"mediaSession"in navigator,g=150,_=25,v=35,y=1e3,b=m?navigator.mediaSession:null,E=function(){function e(e){var t=this;this._stateManager=new d.StateManager({ended:!1,loading:!1,playing:!1,actuallyPlaying:!1,volume:1,muted:!1,isFading:!1,fadeRate:null,isFadingForSeek:!1,playDeferred:null,pauseDeferred:null,ready:!1,seeking:!1,seek:null,positionJumped:null,stalled:!0,duration:null,dead:!1,state:c.State.PAUSED,fatalError:null,errorOccurred:null,position:0},{afterUpdate:function(e,n){return t._afterUpdate(e,n)},afterDispatches:function(){return t._afterDispatches()},beforeUpdate:function(e){if(!e.dead&&(e.ready||!t._fatalErrorTriggered)){var n=t._getPosition(),r=e.duration;if(n<0)throw t._logger.error("Player provided invalid position.",n,r),t._triggerError(new f.ImplementationError("Player provided a position that was invalid.")),new Error("Player provided invalid position.");e.position=n,t._updateEndedInState(e)}}}),this._onError=new o.EventDispatcher,this._errors=[],this._fatalErrorTriggered=!1,this._loadingDelayTimer=null,this._stalled=!1,this._queuedDuration=null,this._readyDeferred=a.buildDeferred(),this._queuedSeekDeferreds=[],this._lastPlayError=null,this._lastPauseError=null,this._lastPlayedPosition=null,this._listenTimeBase=0,this._timePlaybackStarted=null,this._positionAfterLastUpdate=0,this._positionWhenStartedFadeOut=null,this._fadeStartAllowed=!1,this._seekFadeStartAllowed=!1,this._implementationIsFading=!1;var n=e.name;if(this._logger=h.prefixLogger(e.logger,"BasePlayer"+(n?"-"+n:"")),this._mediaSessionEnabled=!!e.mediaSessionEnabled,e.defaultFadeDuration&&e.defaultFadeDuration<0)throw new Error("defaultFadeDuration must be >= 0.");if(e.loadingDelay&&e.loadingDelay<0)throw new Error("loadingDelay must be >= 0.");this._defaultFadeDuration=void 0!==e.defaultFadeDuration?e.defaultFadeDuration:g,this._defaultSeekFadeOutDuration=void 0!==e.defaultSeekFadeOutDuration?e.defaultSeekFadeOutDuration:_,this._defaultSeekFadeInDuration=void 0!==e.defaultSeekFadeInDuration?e.defaultSeekFadeInDuration:v,this._loadingDelay=void 0!==e.loadingDelay?e.loadingDelay:y,this.onError=this._onError.getHandle(),this.whenReady=this._readyDeferred.promise,this._stateManager.subscribe(function(e,n){return t._onChange(e,n)}),this._stateManager.subscribe(function(e){var n=e.actuallyPlaying,r=e.seek;!0===n&&(t._fadeStartAllowed=!1),r&&"IN_PROGRESS"!==r.state&&(t._seekFadeStartAllowed=!1)}),this._stateManager.subscribe(function(e,n){var r=e.isFading,i=n.dead;!i&&!1===r&&t._implementationIsFading&&t._triggerError(new f.ImplementationError("Fade was still running when not allowed."))}),this._stateManager.subscribe(function(e,n){var r=e.playing,i=n.dead,o=n.fadeRate;if(!i&&void 0!==r)try{t._handlePlayPauseChange(r,{fadeRate:o||void 0}),r||(t._fadeStartAllowed=!1)}catch(e){t._triggerError(new f.ImplementationError("Exception occurred whilst handling play/pause change.",e))}}),this._stateManager.subscribe(function(e,n){var r=e.seek,i=n.dead;if(!i&&r&&"IN_PROGRESS"===r.state)try{t._seekFadeStartAllowed=!0,t._handleSeekChange(r.position,{fadeRate:{beforeSeek:r.fadeRate.beforeSeek||void 0,afterSeek:r.fadeRate.afterSeek||void 0}}),t._seekFadeStartAllowed=!1}catch(e){t._triggerError(new f.ImplementationError("Exception occurred whilst handling seek change.",e))}}),this.onChange=this._buildEventHandle(function(e,n){var r=n.ready;if(void 0!==r&&!0!==r)throw new Error("Ready state is invalid.");var i=n.duration;if(void 0!==i&&null===i)throw new Error("Duration state is invalid.");var o=n.dead;if(void 0!==o&&!0!==o)throw new Error("Dead state is invalid.");var a={ready:r,ended:n.ended,duration:i,volume:n.volume,muted:n.muted,playing:n.playing,actuallyPlaying:n.actuallyPlaying,stalled:n.stalled,loading:n.loading,fading:n.isFading,fadingForSeek:n.isFadingForSeek,playRejection:!1===n.playing&&t._lastPlayError||void 0,pauseRejection:!0===n.playing&&t._lastPauseError||void 0,seeking:n.seeking,seek:n.seek||void 0,positionJumped:void 0!==n.positionJumped||void 0,state:n.state,fatalError:n.fatalError||void 0,dead:o};Object.keys(a).some(function(e){return void 0!==a[e]})&&e(a)});var r=e.registerListeners;r&&p.deferException(function(){r({onChange:t.onChange,onError:t.onError})}),this._registerMediaSessionActionHandlers(),this._notifyMediaSessionPaused(),this.onDurationChange=this._buildEventHandle(function(e,t){var n=t.duration;void 0!==n&&null!==n&&e(n)}),this.onReady=this._buildEventHandle(function(e,t){var n=t.ready;!0===n&&e(void 0)}),this.onStateChange=this._buildEventHandle(function(e,t){var n=t.state;void 0!==n&&e(n)}),this.onVolumeChange=this._buildEventHandle(function(e,t,n){var r=t.volume,i=t.muted,o=n.volume,a=n.muted;void 0===r&&void 0===i||e({volume:o,muted:a})}),this.onPlay=this._buildEventHandle(function(e,t){var n=t.actuallyPlaying;!0===n&&e(void 0)}),this.onPlayIntent=this._buildEventHandle(function(e,t){var n=t.playing;!0===n&&e(void 0)}),this.onPlayRejection=this._buildEventHandle(function(e,n){var r=n.playing;!1===r&&t._lastPlayError&&e(t._lastPlayError)}),this.onPause=this._buildEventHandle(function(e,t){var n=t.actuallyPlaying;!1===n&&e(void 0)}),this.onPauseIntent=this._buildEventHandle(function(e,t){var n=t.playing;!1===n&&e(void 0)}),this.onPauseRejection=this._buildEventHandle(function(e,n){var r=n.playing;!0===r&&t._lastPauseError&&e(t._lastPauseError)}),this.onSeek=this._buildEventHandle(function(e,t){var n=t.seek;n&&"COMPLETED"===n.state&&e(void 0)}),this.onSeekIntent=this._buildEventHandle(function(e,t){var n=t.seeking;!0===n&&e(void 0)}),this.onSeekRejection=this._buildEventHandle(function(e,t){var n=t.seek;n&&"ERROR"===n.state&&e(n.error)}),this.onPositionJumped=this._buildEventHandle(function(e,t){var n=t.positionJumped;void 0!==n&&e(void 0)}),this.onEnded=this._buildEventHandle(function(e,t){var n=t.ended;!0===n&&e(void 0)}),this.onLeftEnded=this._buildEventHandle(function(e,t){var n=t.ended;!1===n&&e(void 0)}),this.onStallStart=this._buildEventHandle(function(e,t){var n=t.stalled;!0===n&&e(void 0)}),this.onStallEnd=this._buildEventHandle(function(e,t){var n=t.stalled;!1===n&&e(void 0)}),this.onLoadStart=this._buildEventHandle(function(e,t){var n=t.loading;!0===n&&e(void 0)}),this.onLoadEnd=this._buildEventHandle(function(e,t){var n=t.loading;!1===n&&e(void 0)}),this.onFadeStart=this._buildEventHandle(function(e,t){var n=t.isFading;!0===n&&e(void 0)}),this.onFadeEnd=this._buildEventHandle(function(e,t){var n=t.isFading;!1===n&&e(void 0)}),this.onFadeForSeekStart=this._buildEventHandle(function(e,t){var n=t.isFadingForSeek;!0===n&&e(void 0)}),this.onFadeForSeekEnd=this._buildEventHandle(function(e,t){var n=t.isFadingForSeek;!1===n&&e(void 0)})}return e.prototype.isReady=function(){return this._stateManager.getState().ready},e.prototype.getPosition=function(){return this._getPositionOrPositionSeekingTo()},e.prototype.getLastPlayedPosition=function(){var e=this._stateManager.getState(),t=e.actuallyPlaying,n=e.stalled;return t&&!n?this.getPosition():this._lastPlayedPosition},e.prototype.getListenTime=function(){var e=this._stateManager.getState(),t=e.actuallyPlaying,n=e.ended,r=this._listenTimeBase;return t&&!n&&(r+=l.now()-this._timePlaybackStarted),r},e.prototype.isStalled=function(){return this._stateManager.getState().stalled},e.prototype.isLoading=function(){return this._stateManager.getState().loading},e.prototype.isFading=function(){return this._stateManager.getState().isFading},e.prototype.isFadingForSeek=function(){return this._stateManager.getState().isFadingForSeek},e.prototype.isPlaying=function(){return this._stateManager.getState().playing},e.prototype.isActuallyPlaying=function(){return this._stateManager.getState().actuallyPlaying},e.prototype.isEnded=function(){return this._stateManager.getState().ended},e.prototype.getState=function(){return this._stateManager.getState().state},e.prototype.getBufferController=function(){return null},e.prototype.getMemoryCacheMaxSize=function(){return null},e.prototype.getMemoryCacheUsage=function(){return null},e.prototype.getMemoryCacheController=function(){return null},e.prototype.getFatalError=function(){return this._stateManager.getState().fatalError},e.prototype.isDead=function(){return this._stateManager.getState().dead},e.prototype.getVolume=function(){return this._stateManager.getState().volume},e.prototype.getMuted=function(){return this._stateManager.getState().muted},e.prototype.getDuration=function(){var e=this._stateManager.getState(),t=e.ready,n=e.duration;return t?n:null},e.prototype.setVolume=function(e,t){if(e<0||e>1)throw new Error("Volume must be >= 0 and <= 1.");if(!this._stateManager.getState().dead){var n=this._stateManager.getState().muted;void 0===t&&(t=n);try{this._handleVolumeChange(e,t)}catch(e){throw this._triggerError(new f.ImplementationError("Exception occurred updating volume.",e)),e}}},e.prototype.setMuted=function(e){this.setVolume(this._stateManager.getState().volume,e)},e.prototype.getCurrentBufferedTimeRange=function(){var e=this.getBufferedTimeRanges();if(!e)return null;var t=this.getPosition();return s.find(e,function(e){return e.containsTime(t)})||null},e.prototype.play=function(e){var t=this;this._ensureNotDead(),this._logger.debug("play() called.",e);var n=a.buildDeferred();try{return this._stateManager.update(function(r){if(r.playing)t._logger.debug("Intent is already to be playing.");else{t._logger.debug("Requesting play."),r.playing=!0;var i=t._extractFadeDuration(e);r.fadeRate=i?1/i:null,t._lastPlayError=null}r.playDeferred&&!r.playDeferred.isSettled()||(r.playDeferred=a.buildDeferred()),n.resolve(r.playDeferred.promise)}),n.promise}catch(e){return this._triggerError(new r.PlayerFatalError("Unexpected error when attempting to play.",e)),u.Promise.reject(e)}},e.prototype.pause=function(e){var t=this;this._ensureNotDead(),this._logger.debug("pause() called.",e);var n=a.buildDeferred();try{return this._stateManager.update(function(r){if(r.playing){t._logger.debug("Requesting pause."),t._positionWhenStartedFadeOut=t._getPositionOrPositionSeekingTo(),r.playing=!1;var i=t._extractFadeDuration(e);r.fadeRate=i?1/i*-1:null,t._fadeStartAllowed=!0,t._lastPauseError=null}else t._logger.debug("Intent is already to be paused.");r.pauseDeferred&&!r.pauseDeferred.isSettled()||(r.pauseDeferred=a.buildDeferred()),n.resolve(r.pauseDeferred.promise)}),n.promise}catch(e){return this._triggerError(new r.PlayerFatalError("Unexpected error when attempting to pause.",e)),u.Promise.reject(e)}},e.prototype.seek=function(e,t){var n=this;this._ensureNotDead(),this._logger.debug("seek() called.",e);var r=a.buildDeferred();return this._stateManager.update(function(i){if(e<0)n._logger.warn("Rejecting seek immediately as the position was negative."),r.reject(new Error("You were attempting to seek to a negative time."));else if(null!==i.duration&&e>i.duration)n._logger.warn("Rejecting seek immediately as the duration is now known, and the requested positon was past it."),r.reject(new Error("You were attempting to seek past the end of the media."));else{i.stalled||!i.actuallyPlaying||i.seek&&"IN_PROGRESS"===i.seek.state||(n._lastPlayedPosition=n._getPositionOrPositionSeekingTo());var o=a.buildDeferred();if(i.seek&&"IN_PROGRESS"===i.seek.state&&i.seek.position===e)n._logger.debug("Seek already requested to the same position.",e);else{n._logger.debug("Requesting seek.",e),i.seeking=!0,n._positionWhenStartedFadeOut=null;var s=n._extractSeekFadeDurations(t,e),l=s.fadeOutDuration?1/s.fadeOutDuration*-1:null,u=s.fadeInDuration?1/s.fadeInDuration:null;i.seek={state:"IN_PROGRESS",position:e,fadeRate:{beforeSeek:l,afterSeek:u}},i.positionJumped=Object.create(null)}n._queuedSeekDeferreds.push({position:e,deferred:o}),r.resolve(o.promise)}}),r.promise},e.prototype.getSeekState=function(){return this._stateManager.getState().seek},e.prototype.kill=function(){var e=this;this._stateManager.update(function(t){t.dead||(e._logger.debug("kill() called."),t.dead=!0)})},e.prototype._update=function(e){this._stateManager.update(function(){return e&&e()})},e.prototype._ensureNotDead=function(){if(this._stateManager.getState().dead)throw new Error("Player is dead.")},e.prototype._notifyStalled=function(e){this._ensureNotDead(),this._stalled!==e&&(this._logger.debug("notifyStalled() called.",e),this._stalled=e,this._stateManager.update())},e.prototype._getQueuedSeekPosition=function(){var e=this.getSeekState();return e&&"IN_PROGRESS"===e.state?e.position:null},e.prototype._provideDuration=function(e){var t=this;this._ensureNotDead(),this._stateManager.update(function(n){if(n.duration!==e){var r=t._getPositionOrPositionSeekingTo();if(e<0||n.ready&&r>e)throw t._triggerError(new f.ImplementationError("Attempt to update duration to an invalid value.")),new Error("Duration cannot be less than the current position.");t._logger.debug("provideDuration() called.",e),n.ready?n.duration=e:t._queuedDuration=e}})},e.prototype._notifyVolumeChange=function(e,t){if(e<0||e>1)throw this._triggerError(new f.ImplementationError("Volume was out of range.",e)),new Error("Volume was out of range.");this._stateManager.update(function(n){n.volume=e,n.muted=t})},e.prototype._notifyPlaying=function(e){var t=this;this._ensureNotDead(),this._stateManager.update(function(n){if(!n.ready)throw t._triggerError(new f.ImplementationError("Attempt to register playback as started before ready.")),new Error("Player must be ready first.");e!==n.actuallyPlaying&&(t._logger.debug("notifyPlaying() called.",e),e||n.seeking||n.stalled||(t._lastPlayedPosition=t._getPositionOrPositionSeekingTo()),n.actuallyPlaying=n.playing=e,e?(t._lastPlayError=null,t._fadeStartAllowed=!0):(n.isFading=!1,t._fadeStartAllowed=!1,t._lastPauseError=null))})},e.prototype._notifyPlayRejection=function(e){var t=this;this._ensureNotDead(),e=e||new Error("Unknown error."),this._stateManager.update(function(n){if(!n.ready)throw t._triggerError(new f.ImplementationError("Attempt to reject a play request before player ready.")),new Error("Player must be ready first.");if(n.actuallyPlaying||!n.playing)throw t._triggerError(new f.ImplementationError("Attempt to reject a play request when not valid.")),new Error("Playing state is incorrect.");t._logger.debug("notifyPlayRejection() called.",e),n.playing=!1,t._lastPlayError=e})},e.prototype._notifyPauseRejection=function(e){var t=this;this._ensureNotDead(),e=e||new Error("Unknown error."),this._stateManager.update(function(n){if(!n.ready)throw t._triggerError(new f.ImplementationError("Attempt to reject pause request before player ready.")),new Error("Player must be ready first.");if(!n.actuallyPlaying||n.playing)throw t._triggerError(new f.ImplementationError("Attempt to reject pause request when not valid.")),new Error("Playing state is incorrect.");t._logger.debug("notifyPauseRejection() called.",e),n.playing=!0,n.fadeRate&&(n.fadeRate*=-1),t._lastPauseError=e})},e.prototype._notifySeekRejection=function(e){var t=this;this._ensureNotDead(),e=e||new Error("Unknown error."),this._stateManager.update(function(n){if(!n.ready)throw t._triggerError(new f.ImplementationError("Attempt to reject seek request before player ready.")),new Error("Player must be ready first.");if(!n.seek||"IN_PROGRESS"!==n.seek.state)throw t._triggerError(new f.ImplementationError("Attempt to reject seek request when none requested.")),new Error("A seek hasn't been requested.");if(null!==n.duration&&n.position>n.duration)throw t._triggerError(new f.ImplementationError("Attempt to reject seek request after duration changed below current position.")),new Error("Attempt to reject seek request after duration changed below current position.");t._logger.debug("notifySeekRejection() called.",e),n.seeking=!1,n.seek={state:"ERROR",error:e},n.positionJumped=Object.create(null)})},e.prototype._notifyFading=function(e){var t=this;if(this._ensureNotDead(),e&&!this._fadeStartAllowed){var n="Attempt to register fade as starting when not allowed.";throw this._triggerError(new f.ImplementationError(n)),new Error(n)}this._implementationIsFading=e,this._stateManager.update(function(n){n.isFading!==e&&(t._logger.debug("notifyFading() called",e),e||n.playing||null===t._positionWhenStartedFadeOut||t.seek(t._positionWhenStartedFadeOut,{fadeInDuration:0,fadeOutDuration:0}).catch(function(e){t._logger.warn("Seek back to position where fade out started failed.",e)}),n.isFading=e)})},e.prototype._notifyFadingForSeek=function(e){var t=this;if(this._ensureNotDead(),e&&!this._seekFadeStartAllowed){var n="Attempt to register fade as starting for seek when not allowed.";throw this._triggerError(new f.ImplementationError(n)),new Error(n)}this._stateManager.update(function(n){n.isFadingForSeek!==e&&(t._logger.debug("notifyFadingForSeek() called",e),n.isFadingForSeek=e)})},e.prototype._signalReady=function(){var e=this;this._ensureNotDead(),this._stateManager.update(function(t){if(t.ready)throw e._triggerError(new f.ImplementationError("Attempt to signal ready twice.")),new Error("Ready already signalled.");if(null===e._queuedDuration)throw e._triggerError(new f.ImplementationError("Attempt to signal ready when duration unknown.")),new Error("Duration is still unknown.");e._logger.debug("signalReady() called."),t.ready=!0,t.duration=e._queuedDuration,t.seek&&"IN_PROGRESS"===t.seek.state&&t.seek.position>t.duration&&(t.seeking=!1,t.seek={state:"ERROR",error:new Error("You were attempting to seek past the end of the media.")})})},e.prototype._signalSeekComplete=function(){var e=this;this._ensureNotDead(),this._stateManager.update(function(t){if(!t.ready)throw e._triggerError(new f.ImplementationError("Attempt to signal seek as complete before player ready.")),new Error("Player must be ready first.");if(!t.seek||"IN_PROGRESS"!==t.seek.state)throw e._triggerError(new f.ImplementationError("Attempt to signal seek as complete when none requested.")),new Error("There shouldn't be a seek in progress.");var n=t.duration;if(t.seek&&"IN_PROGRESS"===t.seek.state&&t.seek.position>n)throw new Error("Seek cannot have completed given it was to a time greater than the duration.");e._logger.debug("signalSeekComplete() called."),e._seekFadeStartAllowed=!0,t.seek={state:"COMPLETED",position:t.seek.position,fadeRate:t.seek.fadeRate},t.seeking=!1,t.position=t.seek.position})},e.prototype._triggerError=function(e){var t=this;e instanceof r.PlayerFatalError&&(this._fatalErrorTriggered=!0),this._stateManager.update(function(n){var o=!1;if(n.ready&&e instanceof i.NotSupportedError&&(e=new f.ImplementationError("Invalid NotSupportedError."),o=!0),e instanceof r.PlayerFatalError?(e instanceof i.NotSupportedError?t._logger.info("NotSupportedError occurred.",e):t._logger.error("Fatal error occurred.",e),n.fatalError?t._logger.warn("A fatal error already occurred.",n.fatalError):n.fatalError=e,t._errors.push(e),n.errorOccurred=Object.create(null),n.dead=!0):(t._logger.warn("Non-fatal error occurred.",e),t._errors.push(e),n.errorOccurred=Object.create(null)),o)throw new Error("Not supported errors are only valid before the player is ready.")})},e.prototype._buildEventHandle=function(e){var t=this;return{subscribe:function(n){var r=function(e){return n(e,l.now())};return t._stateManager.subscribe(function(t,n){e(r,t,n)})}}},e.prototype._finalizeState=function(e){this._updateEndedInState(e);var t=this._getPositionOrPositionSeekingTo();if(e.dead)this._lastPlayError=new Error("Player was killed."),e.loading=!1,this._clearLoadingDelay(),!e.playing&&e.isFading&&null!==this._positionWhenStartedFadeOut&&(this._logger.debug("Fade out was in progress. Pretending it completed."),e.isFading=!1,e.position=this._positionWhenStartedFadeOut),e.stalled=!0,e.actuallyPlaying=!1,e.isFadingForSeek=!1,e.playing=!1,e.state=c.State.DEAD;else{var n=!e.ended&&(!e.ready||this._stalled||!(!e.seek||"IN_PROGRESS"!==e.seek.state));n&&!e.stalled&&!e.seeking&&e.actuallyPlaying&&(this._lastPlayedPosition=t),e.stalled=n;var r=!e.ended&&!e.isFading&&!e.isFadingForSeek&&(e.playing||e.actuallyPlaying)&&(e.stalled||e.playing!==e.actuallyPlaying);r?this._loadingDelay?this._scheduleLoadingDelay():e.loading=!0:(e.loading=!1,this._clearLoadingDelay()),this._positionAfterLastUpdate!==t&&(this._positionAfterLastUpdate=t,e.playing||e.actuallyPlaying||(e.positionJumped=Object.create(null))),e.state=this._calculateState(e)}},e.prototype._updateEndedInState=function(e){e.ended=e.ready&&this._getPositionOrPositionSeekingTo()===e.duration},e.prototype._scheduleLoadingDelay=function(){var e=this;this._loadingDelayTimer||(this._loadingDelayTimer=window.setTimeout(function(){e._stateManager.update(function(e){return e.loading=!0})},this._loadingDelay))},e.prototype._clearLoadingDelay=function(){this._loadingDelayTimer&&(window.clearTimeout(this._loadingDelayTimer),this._loadingDelayTimer=null)},e.prototype._getPositionOrPositionSeekingTo=function(){this._stateManager.update();var e=this._stateManager.getState();return e.seek&&"IN_PROGRESS"===e.seek.state?e.seek.position:e.isFading&&!e.playing&&null!==this._positionWhenStartedFadeOut?this._positionWhenStartedFadeOut:e.ready&&null!==e.duration?e.position:0},e.prototype._calculateState=function(e){var t=e.dead,n=e.loading,r=e.playing,i=e.ended;return t?c.State.DEAD:n?c.State.LOADING:r&&!i?c.State.PLAYING:c.State.PAUSED},e.prototype._registerMediaSessionActionHandlers=function(){var e=this;this._mediaSessionEnabled&&b&&(b.setActionHandler("play",function(){e.isDead()||e.play()}),b.setActionHandler("pause",function(){e.isDead()||e.pause()}),b.setActionHandler("seekbackward",function(){e.isDead()||e.seek(Math.max(0,e.getPosition()-5e3))}),b.setActionHandler("seekforward",function(){e.isDead()||e.seek(Math.min(e.getDuration()||0,e.getPosition()+5e3))}))},e.prototype._notifyMediaSessionPlaying=function(){this._mediaSessionEnabled&&b&&(b.playbackState="playing")},e.prototype._notifyMediaSessionPaused=function(){this._mediaSessionEnabled&&b&&(b.playbackState="paused")},e.prototype._extractFadeDuration=function(e){return void 0===e&&(e={}),void 0===e.fadeDuration?!this._stateManager.getState().playing||this._getPositionOrPositionSeekingTo()>0?this._defaultFadeDuration:0:e.fadeDuration>0?e.fadeDuration:0},e.prototype._extractSeekFadeDurations=function(e,t){var n,r;return void 0===e&&(e={}),n=void 0!==e.fadeOutDuration?e.fadeOutDuration>0?e.fadeOutDuration:0:this._defaultSeekFadeOutDuration,r=void 0!==e.fadeInDuration?e.fadeInDuration>0?e.fadeInDuration:0:t>0?this._defaultSeekFadeInDuration:0,{fadeOutDuration:n,fadeInDuration:r}},e.prototype._afterUpdate=function(e,t){if(t.beforeUpdate||t.update.length>0)this._logger.error("Errors occurred during state update. Killing player.",t),this._triggerError(new r.PlayerFatalError("Errors occurred during state update.",t));else if(!e.dead&&e.ready){var n=e.duration;null!==n&&!e.seeking&&e.position>n&&(this._logger.error("Player provided invalid position.",e.position,n),this._triggerError(new f.ImplementationError("Player provided a position that was invalid.")))}this._finalizeState(e)},e.prototype._afterDispatches=function(){var e=this,t=this._errors;this._errors=[],t.forEach(function(t){return e._onError.dispatch(t)})},e.prototype._onChange=function(e,t){var n=this,r=e.ready,i=e.dead,o=e.fatalError,a=e.playing,s=e.actuallyPlaying,u=e.ended;if(!0===r&&(this._logger.debug("Resolving ready deferred."),this._readyDeferred.resolve(void 0)),!0===s&&this._registerMediaSessionActionHandlers(),!0===a?this._notifyMediaSessionPlaying():!1===a&&this._notifyMediaSessionPaused(),t.pauseDeferred&&!t.pauseDeferred.isSettled()&&t.playing){var c=this._lastPauseError||new Error("Pause request aborted.");this._logger.debug("Rejecting pause deferred.",c),t.pauseDeferred.reject(c)}if(t.playDeferred&&!t.playDeferred.isSettled()&&!t.playing){var c=this._lastPlayError||new Error("Play request aborted.");this._logger.debug("Rejecting play deferred.",c),t.playDeferred.reject(c)}if(t.playDeferred&&!t.playDeferred.isSettled()&&t.actuallyPlaying&&(this._logger.debug("Resolving play deferred."),t.playDeferred.resolve(void 0)),!t.pauseDeferred||t.pauseDeferred.isSettled()||t.actuallyPlaying||(this._logger.debug("Resolving pause deferred."),t.pauseDeferred.resolve(void 0)),!0===s&&!t.ended||!1===u&&t.actuallyPlaying?this._timePlaybackStarted=l.now():(!1===s&&!t.ended||!0===u&&t.actuallyPlaying)&&(this._listenTimeBase+=l.now()-this._timePlaybackStarted,this._timePlaybackStarted=null),this._queuedSeekDeferreds=this._queuedSeekDeferreds.filter(function(e){var r=e.position,i=e.deferred;if(t.seek)if("IN_PROGRESS"!==t.seek.state){if(!t.stalled||"ERROR"===t.seek.state)return"ERROR"!==t.seek.state?(n._logger.debug("Resolving seek()."),i.resolve(void 0)):(n._logger.debug("Rejecting seek().",t.seek.error),i.reject(t.seek.error)),!1}else if("IN_PROGRESS"!==t.seek.state||t.seek.position!==r)return n._logger.debug("Rejecting seek() because another seek was requested.",r),i.reject(new Error("Seek request aborted because another seek was requested to a different position.")),!1;return!0}),!0===i){this._logger.debug("Calling _kill() on player.");try{this._kill(),this._logger.info("Player killed.")}catch(e){this._triggerError(new f.ImplementationError("Exception occurred in _kill().",e)),this._logger.error("Exception when implementation was being killed.",e)}if(!t.ready){var c=o||new Error("Player was killed.");this._logger.debug("Rejecting whenReady."),this._readyDeferred.reject(c)}this._queuedSeekDeferreds.forEach(function(e){var t=e.position,r=e.deferred,i=o||new Error("Seek aborted as player killed.");n._logger.debug("Rejecting seek().",t),r.reject(i)}),this._stateManager.kill(),this._logger.debug("Player dead.")}},e}();t.BasePlayer=E},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(34),a=n(11),s=n(5),l=n(12),u=n(6),c=n(28),h=n(16),d=function(e){function t(t){var n=e.call(this,t)||this;return n._onProvidedPlayerError=new u.EventDispatcher,n._errorHandler=null,n._changeHandler=null,n._player=null,n._instanceLock=null,n._playConfig=void 0,n._pauseConfig=void 0,n._seekConfig=void 0,n._lastPlayerPosition=0,n._synced=!1,n._unsyncInProgress=!1,n._logger=l.prefixLogger(n._logger,"ProxyPlayerBase"),n.onProvidedPlayerError=n._onProvidedPlayerError.getHandle(),n}return r(t,e),t.prototype.play=function(t){return this._playConfig=t,e.prototype.play.call(this)},t.prototype.pause=function(t){return this._pauseConfig=t,e.prototype.pause.call(this)},t.prototype.seek=function(t,n){return this._seekConfig=n,e.prototype.seek.call(this,t)},t.prototype.getBufferedTimeRanges=function(){return this._player&&this._synced?this._player.getBufferedTimeRanges():null},t.prototype.getCurrentBufferedTimeRange=function(){return this._player&&this._synced?this._player.getCurrentBufferedTimeRange():null},t.prototype.getMaxBufferLength=function(){return this._player&&this._synced?this._player.getMaxBufferLength():null},t.prototype._providePlayer=function(e,t){if(void 0===t&&(t={}),t=i({syncPosition:!0,syncVolume:!0},t),this._ensureNotDead(),this._player)throw new Error("A player has already been provided.");this._logger.debug("providePlayer() called."),this._instanceLock=Object.create(null),this._player=e,this._sync(t)},t.prototype._removePlayer=function(){var e=this;if(this._ensureNotDead(),!this._player)throw new Error("There is no player to remove.");if(this._unsyncInProgress)throw new Error("Player is currently unsyncing.");this._logger.debug("removePlayer() called."),this._instanceLock=null,this._unsync(),this._player=null,this.isReady()&&!this.isDead()&&this._update(function(){var t=null!==e._getQueuedSeekPosition();e._notifyFading(!1),t||null===e._getQueuedSeekPosition()||e._signalSeekComplete(),e._notifyFadingForSeek(!1),e._notifyStalled(!0)})},t.prototype._setInitialDuration=function(e){var t=this;if(this._ensureNotDead(),e<0)throw new Error("Cannot set duration to a value < 0.");null===this.getDuration()&&this._update(function(){t._ensureBelowPosition(e),t._provideDuration(e),t.isReady()||(t._signalReady(),t._handleSkippedSeek())})},t.prototype._triggerError=function(t){e.prototype._triggerError.call(this,t)},t.prototype._getPlayer=function(){return this.isDead()?null:this._player},t.prototype._handleVolumeChange=function(e,t){this._synced&&this._player?this._player.setVolume(e,t):this._notifyVolumeChange(e,t)},t.prototype._handlePlayPauseChange=function(e){var t=this,n=this._player;n&&this._update(function(){e?t._playAndHandleAbort(n):(t._pauseAndHandleAbort(n),n.isFading()&&t._notifyFading(!0))})},t.prototype._handleSeekChange=function(e){var t=this._player;if(t&&this._synced){var n=this._seekConfig;this._seekConfig=void 0,t.seek(e,n),t.isFadingForSeek()&&this._notifyFadingForSeek(!0)}},t.prototype._getPosition=function(){if(this._player&&this._synced){if(!this._changeHandler)throw new Error("Handler should exist.");if(this._changeHandler.retrieve(),this._synced)return this._player.getPosition()}return this._lastPlayerPosition},t.prototype._kill=function(){this._player&&(this._unsync(),this._player.kill()),this._player=null},t.prototype._handleSkippedSeek=function(){if(this._player&&this._synced){var e=this.getSeekState(),t=this._player.getSeekState();!e||"IN_PROGRESS"!==e.state||t&&"IN_PROGRESS"===t.state||(this._logger.debug("Signalling seek as complete on proxy because provided player isn't seeking."),this._signalSeekComplete())}},t.prototype._ensureBelowPosition=function(e){this.getPosition()>e&&(this._logger.debug("Capping position.",e),this.seek(e),this.isReady()&&(this._lastPlayerPosition=e,this._signalSeekComplete()))},t.prototype._sync=function(e){var t=this,n=this._player;if(!n)throw new Error("Player should have become available by now.");if(this._logger.debug("Syncing...",this.isPlaying(),this.isActuallyPlaying()),n.isDead()){this._logger.debug("Provided player is dead.");var r=n.getFatalError();r&&this._handleFatalError(r,n)}else this._errorHandler=n.onError.subscribe(function(e){e instanceof s.PlayerFatalError?t._onProvidedPlayerError.dispatch(new h.ProxyProvidedPlayerFatalError(e,n)):(t._triggerError(e),t._onProvidedPlayerError.dispatch(new c.ProxyProvidedPlayerError(e,n)))}),this._changeHandler=n.onChange.subscribe(function(e){t._update(function(){if(t._logger.debug("Handling changes.",e),e.dead)return t._logger.debug("Player has gone to DEAD state."),t._unsync(),void(t.isDead()||e.fatalError&&t._handleFatalError(e.fatalError,n));if(void 0===e.volume&&void 0===e.muted||t._notifyVolumeChange(n.getVolume(),n.getMuted()),void 0!==e.duration&&(t._ensureBelowPosition(e.duration),t._provideDuration(e.duration),t.isReady()||(t._signalReady(),t._handleSkippedSeek(),t._notifyStalled(n.isStalled()))),e.seek){var r=t.getSeekState();r&&"IN_PROGRESS"===r.state||"IN_PROGRESS"!==e.seek.state?r&&"IN_PROGRESS"===r.state&&("COMPLETED"===e.seek.state&&r.position===e.seek.position?(t._signalSeekComplete(),n.isFadingForSeek()&&t._notifyFadingForSeek(!0)):"COMPLETED"===e.seek.state&&r.position!==e.seek.position?t._notifySeekRejection(new Error("Another seek occurred to a different position.")):"IN_PROGRESS"===e.seek.state&&r.position!==e.seek.position?t.seek(e.seek.position):"ERROR"===e.seek.state&&t._notifySeekRejection(e.seek.error)):t.seek(e.seek.position)}void 0!==e.stalled&&t._notifyStalled(e.stalled),!1===e.playing&&e.playRejection?t.isActuallyPlaying()?(t._triggerError(new a.PlayerError("Paused because a player was provided that refused to play.")),t._notifyPlaying(!1)):t._notifyPlayRejection(e.playRejection):!1===e.playing&&(n.isActuallyPlaying()?t.pause():void 0===e.actuallyPlaying&&t.isReady()&&t._notifyPlaying(!1)),!0===e.playing&&e.pauseRejection?t._notifyPauseRejection(e.pauseRejection):!0===e.playing&&t.play(),void 0!==e.actuallyPlaying&&e.actuallyPlaying!==t.isActuallyPlaying()&&(t._notifyPlaying(e.actuallyPlaying),e.actuallyPlaying&&n.isFading()&&t._notifyFading(!0)),!1===e.fading&&t._notifyFading(!1),!1===e.fadingForSeek&&t._notifyFadingForSeek(!1)})}),this._update(function(){var r=t._instanceLock;try{if(t._notifyStalled(n.isStalled()),n.isReady()){var i=n.getDuration();t._ensureBelowPosition(i),t._provideDuration(i),t.isReady()||(t._logger.debug("Provided player is already ready. Making proxy player ready."),t._signalReady())}if(e.syncVolume&&(n.setVolume(t.getVolume(),t.getMuted()),t._instanceLock!==r))return;var o=t.getSeekState();if(e.syncPosition){t._logger.debug("Seeking to match position.");var a=t.getPosition();n.getPosition()!==a?n.seek(a):(t._logger.debug("Skipping seek because already at same position."),t.isReady()&&o&&"IN_PROGRESS"===o.state&&t._signalSeekComplete())}else if(o&&"IN_PROGRESS"===o.state){t._logger.debug("Seeking to match position because a seek has been queued.");var l=t._seekConfig;t._seekConfig=void 0,n.seek(t.getPosition(),l)}else{var u=n.getSeekState();u&&"IN_PROGRESS"===u.state&&(t._logger.debug("Seeking on proxy to match seek that is in progress on provided player."),t.seek(u.position))}if(t._instanceLock!==r)return;if(n.isActuallyPlaying()?(t._logger.debug("Provided player is already playing."),t.isActuallyPlaying()||(t._notifyPlaying(!0),n.isFading()&&t._notifyFading(!0))):n.isPlaying()?(t._logger.debug("Provided player is preparing to play."),t.play()):t.isPlaying()?(t._logger.debug("Calling play() on provided player to match proxy."),t._playAndHandleAbort(n)):t.isReady()&&t.isActuallyPlaying()&&(t._logger.debug("Switching to paused state, as provided player and proxy intended state is paused."),t._notifyPlaying(!1)),t._instanceLock!==r)return;t._synced=!0,t._notifyVolumeChange(n.getVolume(),n.getMuted())}catch(e){t._triggerError(new s.PlayerFatalError("Unexpected error occurred whilst syncing.",e))}})},t.prototype._playAndHandleAbort=function(e){var t=this._instanceLock;this._logger.debug("Calling play() on provided player.");var n=this._playConfig;this._playConfig=this._pauseConfig=void 0,e.play(n),this._instanceLock===t&&!e.isPlaying()&&this.isPlaying()&&(this._logger.debug("Provided player was not playing after play() call completed."),this.isActuallyPlaying()?(this._triggerError(new a.PlayerError("Paused because a player was provided that refused to play.")),this._notifyPlaying(!1)):this.pause())},t.prototype._pauseAndHandleAbort=function(e){var t=this._instanceLock;this._logger.debug("Calling pause() on provided player.");var n=this._pauseConfig;this._playConfig=this._pauseConfig=void 0,e.pause(n),this._instanceLock===t&&e.isPlaying()&&!this.isPlaying()&&(this._logger.debug("Provided player was not paused after pause() call completed."),this.play())},t.prototype._unsync=function(){if(this._logger.debug("Unsyncing..."),this._changeHandler&&(this._changeHandler.remove(),this._changeHandler=null),this._errorHandler&&(this._errorHandler.remove(),this._errorHandler=null),this._synced){this._synced=!1,this._unsyncInProgress=!0;var e=this._player;if(e)try{this._lastPlayerPosition=e.getPosition()}catch(e){this._logger.error("Error whilst unsyncing.",e)}this._unsyncInProgress=!1,this._logger.debug("Unsynced.",this.isPlaying(),this.isActuallyPlaying())}else this._logger.debug("Unsynced. (Sync never completed)")},t}(o.BasePlayer);t.ProxyPlayerBase=d},function(e,t,n){"use strict";function r(e){var t=navigator.userAgent.match(e);if(t&&t.length>=3){var n=parseInt(t[1],10),r=parseInt(t[2],10);if(!isNaN(n)&&!isNaN(r))return{major:n,minor:r}}return null}Object.defineProperty(t,"__esModule",{value:!0});var i="undefined"!=typeof navigator?navigator.userAgent:"",o=!/chrome|opera/i.test(i)&&/safari/i.test(i),a=i.indexOf("MSIE ")>=0||i.indexOf("Trident/")>=0,s=i.indexOf("Edge/")>=0,l=/Chrom(?:e|ium)/.test(i),u=i.toLowerCase().indexOf("firefox")>=0,c=/version\/(\d+)\.(\d+)/i,h=/Chrom(?:e|ium)\/([0-9]+)\.([0-9]+)\.([0-9]+)/,d=/Firefox\/(\d+)\.(\d+)/;t.isSafari=function(){return o},t.isFirefox=function(){return u},t.isChrome=function(){return l},t.isIE=function(){return a},t.isEdge=function(){return s},t.getSafariVersion=function(){return r(c)},t.getChromeVersion=function(){return r(h)},t.getFirefoxVersion=function(){return r(d)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(13),o=n(18),a=n(3),s=n(6);t.abortedError=new Error("Job aborted."),t.map=function(e,t){var n=t.convertResult,r=t.convertProgressUpdate,o=t.abortableJobOpts,a=t.passThroughAbort,u=void 0===a||a;return new l(function(){var t=e(),o=new s.EventDispatcher,a=!0,l=i.buildDeferred();return r&&t.onProgressUpdate(function(e){o.dispatch(r(e,a)),a=!1},{skipPast:!0}),t.onCompletion(function(e){try{l.resolve(n(e))}catch(e){l.reject(e)}}),t.onError(l.reject),{result:l.promise,progressUpdates:r?{onProgressUpdate:o,getProgressSoFar:function(){var e=t.getProgressSoFar();if(e){var n=r(e,a);return a=!1,n}return null}}:void 0,abort:function(){return u&&t.abort()}}},o)};var l=function(){function e(e,t){void 0===t&&(t={}),this._job=e,this._opts=t,this._counter=0,this._jobControl=null,this._promise=null,this._jobCompleted=!1}return e.prototype.run=function(){var e,n=this;if(this._jobControl)e=this._jobControl;else{try{e=this._jobControl=this._job()}catch(t){e=this._jobControl={result:r.Promise.reject(t)}}this._promise=e.result,o.always(this._promise,function(){n._jobCompleted=!0,n._opts.storeResult||(n._jobCompleted=!1,n._promise=null,n._jobControl=null)})}var s=this._promise;this._counter++;var l=i.buildDeferred(),u=!1,c=!1,h=void 0,d=!1,f=[],p=[],m=[];return o.always(s,function(){d||(u=!0,n._counter--),f.forEach(function(e){return e.remove()})}),s.then(function(e){d||(h=e,p.forEach(function(t){return a.deferException(function(){return t(e)})}),p.splice(0),l.resolve(e))},function(e){d||(c=!0,h=e,m.forEach(function(t){return t(e)}),m.splice(0),l.reject(e))}),{whenComplete:function(){return l.promise},onProgressUpdate:function(t,n){if(void 0===n&&(n={}),e.progressUpdates){if(!d&&!u){var r=e.progressUpdates.onProgressUpdate.subscribe(function(e){return t(e)});f.push(r)}if(!n.skipPast){var i=e.progressUpdates.getProgressSoFar();i&&t(i)}}},getProgressSoFar:function(){return e.progressUpdates?e.progressUpdates.getProgressSoFar():null},onCompletion:function(e){u?!c&&a.deferException(function(){return e(h)}):p.push(e)},onError:function(e){d?a.deferException(function(){return e(t.abortedError)}):u?c&&a.deferException(function(){return e(h)}):m.push(e)},hasCompleted:function(){return u},hasErrored:function(){return c},isAborted:function(){return d},abort:function(){d||u||(d=!0,f.forEach(function(e){return e.remove()}),0===--n._counter&&!n._jobCompleted&&n._jobControl&&n._jobControl.abort&&(n._jobControl.abort(),n._promise=null,n._jobControl=null),m.forEach(function(e){return a.deferException(function(){return e(t.abortedError)})}),l.reject(t.abortedError))}}},e}();t.AbortableJob=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){if(this.start=e,this.duration=t,t<0)throw new RangeError("Duration must be >= 0.");this.end=e+t}return e.normalizeRawTimeRanges=function(e){return e.slice(0).sort(function(e,t){return e.start-t.start}).reduce(function(e,t,n){var r=e.length-1;return n>0&&e[r].end>=t.start?e[r].end=t.end:e.push(t),e},[])},e.normalize=function(t){return e.normalizeRawTimeRanges(t.map(function(e){return{start:e.start,end:e.end}})).map(function(t){return new e(t.start,t.end-t.start)})},e.getCoverage=function(t){if(0===t.length)return new e(0,0);var n=1/0,r=0;return t.forEach(function(e){e.start<n&&(n=e.start),e.end>r&&(r=e.end)}),new e(n,r-n)},e.rangesContainTime=function(e,t){return t.some(function(t){return t.containsTime(e)})},e.prototype.containsTime=function(e){return this.start<=e&&this.end>e},e}();t.TimeRange=r},function(e,t,n){"use strict";e.exports="function"==typeof WeakMap&&"[object WeakMap]"===Object.prototype.toString.call(new WeakMap)},function(e,t,n){"use strict";var r=n(10),i=n(1),o=n(9),a=n(21),s=Array.isArray,l=Function.prototype.call,u=Array.prototype.some;e.exports=function(e,t){var n,c,h,d,f,p,m,g,_=arguments[2];if(s(e)||r(e)?n="array":o(e)?n="string":e=a(e),i(t),h=function(){d=!0},"array"!==n)if("string"!==n)for(c=e.next();!c.done;){if(l.call(t,_,c.value,h),d)return;c=e.next()}else for(p=e.length,f=0;f<p&&(m=e[f],f+1<p&&(g=m.charCodeAt(0))>=55296&&g<=56319&&(m+=e[++f]),l.call(t,_,m,h),!d);++f);else u.call(e,function(e){return l.call(t,_,e,h),d})}},function(e,t,n){"use strict";var r=n(10),i=n(4),o=n(9),a=n(2).iterator,s=Array.isArray;e.exports=function(e){return!(!i(e)||!s(e)&&!o(e)&&!r(e)&&"function"!=typeof e[a])}},function(e,t,n){"use strict";var r=n(41);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not iterable");return e}},function(e,t,n){"use strict";var r,i=n(15),o=n(7),a=n(2),s=n(20),l=Object.defineProperty;r=e.exports=function(e){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");e=String(e),s.call(this,e),l(this,"__length__",o("",e.length))},i&&i(r,s),delete r.prototype.constructor,r.prototype=Object.create(s.prototype,{_next:o(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:o(function(e){var t,n=this.__list__[e];return this.__nextIndex__===this.__length__?n:(t=n.charCodeAt(0))>=55296&&t<=56319?n+this.__list__[this.__nextIndex__++]:n})}),l(r.prototype,a.toStringTag,o("c","String Iterator"))},function(e,t,n){"use strict";var r=n(1),i=n(0),o=Function.prototype.bind,a=Function.prototype.call,s=Object.keys,l=Object.prototype.propertyIsEnumerable;e.exports=function(e,t){return function(n,u){var c,h=arguments[2],d=arguments[3];return n=Object(i(n)),r(u),c=s(n),d&&c.sort("function"==typeof d?o.call(d,n):void 0),"function"!=typeof e&&(e=c[e]),a.call(e,c,function(e,r){return l.call(n,e)?a.call(u,h,n[e],e,n,r):t})}}},function(e,t,n){"use strict";e.exports=n(44)("forEach")},function(e,t,n){"use strict";var r=n(1),i=n(45),o=Function.prototype.call;e.exports=function(e,t){var n={},a=arguments[2];return r(t),i(e,function(e,r,i,s){n[r]=o.call(t,a,e,r,i,s)}),n}},function(e,t,n){"use strict";e.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:e>0?1:-1}},function(e,t,n){"use strict";e.exports=function(){var e=Math.sign;return"function"==typeof e&&1===e(10)&&-1===e(-20)}},function(e,t,n){"use strict";e.exports=n(48)()?Math.sign:n(47)},function(e,t,n){"use strict";var r=n(49),i=Math.abs,o=Math.floor;e.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?r(e)*o(i(e)):e}},function(e,t,n){"use strict";var r=n(50),i=Math.max;e.exports=function(e){return i(0,r(e))}},function(e,t,n){"use strict";var r=Object.prototype.toString,i=r.call(n(24));e.exports=function(e){return"function"==typeof e&&r.call(e)===i}},function(e,t,n){"use strict";var r=n(2).iterator,i=n(10),o=n(52),a=n(51),s=n(1),l=n(0),u=n(4),c=n(9),h=Array.isArray,d=Function.prototype.call,f={configurable:!0,enumerable:!0,writable:!0,value:null},p=Object.defineProperty;e.exports=function(e){var t,n,m,g,_,v,y,b,E,x,T=arguments[1],S=arguments[2];if(e=Object(l(e)),u(T)&&s(T),this&&this!==Array&&o(this))t=this;else{if(!T){if(i(e))return 1!==(_=e.length)?Array.apply(null,e):((g=new Array(1))[0]=e[0],g);if(h(e)){for(g=new Array(_=e.length),n=0;n<_;++n)g[n]=e[n];return g}}g=[]}if(!h(e))if(void 0!==(E=e[r])){for(y=s(E).call(e),t&&(g=new t),b=y.next(),n=0;!b.done;)x=T?d.call(T,S,b.value,n):b.value,t?(f.value=x,p(g,n,f)):g[n]=x,b=y.next(),++n;_=n}else if(c(e)){for(_=e.length,t&&(g=new t),n=0,m=0;n<_;++n)x=e[n],n+1<_&&(v=x.charCodeAt(0))>=55296&&v<=56319&&(x+=e[++n]),x=T?d.call(T,S,x,m):x,t?(f.value=x,p(g,m,f)):g[m]=x,++m;_=m}if(void 0===_)for(_=a(e.length),t&&(g=new t(_)),n=0;n<_;++n)x=T?d.call(T,S,e[n],n):e[n],t?(f.value=x,p(g,n,f)):g[n]=x;return t&&(f.value=null,g.length=_),g}},function(e,t,n){"use strict";e.exports=function(){var e,t,n=Array.from;return"function"==typeof n&&(t=n(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},function(e,t,n){"use strict";e.exports=n(54)()?Array.from:n(53)},function(e,t,n){"use strict";var r=n(55),i=n(14),o=n(0);e.exports=function(e){var t=Object(o(e)),n=arguments[1],a=Object(arguments[2]);if(t!==e&&!n)return t;var s={};return n?r(n,function(t){(a.ensure||t in e)&&(s[t]=e[t])}):i(s,e),s}},function(e,t,n){"use strict";var r,i=n(56),o=n(23),a=n(1),s=n(46),l=n(1),u=n(0),c=Function.prototype.bind,h=Object.defineProperty,d=Object.prototype.hasOwnProperty;r=function(e,t,n){var r,o=u(t)&&l(t.value);return r=i(t),delete r.writable,delete r.value,r.get=function(){return!n.overwriteDefinition&&d.call(this,e)?o:(t.value=c.call(o,n.resolveContext?n.resolveContext(this):this),h(this,e,t),this[e])},r},e.exports=function(e){var t=o(arguments[1]);return null!=t.resolveContext&&a(t.resolveContext),s(e,function(e,n){return r(n,e,t)})}},function(e,t,n){"use strict";var r=n(0);e.exports=function(){return r(this).length=0,this}},function(e,t,n){"use strict";e.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&"Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag])}},function(e,t,n){"use strict";var r=n(59);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not a symbol");return e}},function(e,t,n){"use strict";var r,i,o,a,s=n(7),l=n(60),u=Object.create,c=Object.defineProperties,h=Object.defineProperty,d=Object.prototype,f=u(null);if("function"==typeof Symbol){r=Symbol;try{String(r()),a=!0}catch(e){}}var p=function(){var e=u(null);return function(t){for(var n,r,i=0;e[t+(i||"")];)++i;return e[t+=i||""]=!0,h(d,n="@@"+t,s.gs(null,function(e){r||(r=!0,h(this,n,s(e)),r=!1)})),n}}();o=function(e){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return i(e)},e.exports=i=function e(t){var n;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return a?r(t):(n=u(o.prototype),t=void 0===t?"":String(t),c(n,{__description__:s("",t),__name__:s("",p(t))}))},c(i,{for:s(function(e){return f[e]?f[e]:f[e]=i(String(e))}),keyFor:s(function(e){var t;for(t in l(e),f)if(f[t]===e)return t}),hasInstance:s("",r&&r.hasInstance||i("hasInstance")),isConcatSpreadable:s("",r&&r.isConcatSpreadable||i("isConcatSpreadable")),iterator:s("",r&&r.iterator||i("iterator")),match:s("",r&&r.match||i("match")),replace:s("",r&&r.replace||i("replace")),search:s("",r&&r.search||i("search")),species:s("",r&&r.species||i("species")),split:s("",r&&r.split||i("split")),toPrimitive:s("",r&&r.toPrimitive||i("toPrimitive")),toStringTag:s("",r&&r.toStringTag||i("toStringTag")),unscopables:s("",r&&r.unscopables||i("unscopables"))}),c(o.prototype,{constructor:s(i),toString:s("",function(){return this.__name__})}),c(i.prototype,{toString:s(function(){return"Symbol ("+l(this).__description__+")"}),valueOf:s(function(){return l(this)})}),h(i.prototype,i.toPrimitive,s("",function(){var e=l(this);return"symbol"==typeof e?e:e.toString()})),h(i.prototype,i.toStringTag,s("c","Symbol")),h(o.prototype,i.toStringTag,s("c",i.prototype[i.toStringTag])),h(o.prototype,i.toPrimitive,s("c",i.prototype[i.toPrimitive]))},function(e,t,n){"use strict";var r={object:!0,symbol:!0};e.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!r[typeof Symbol.iterator]&&!!r[typeof Symbol.toPrimitive]&&!!r[typeof Symbol.toStringTag]}},function(e,t,n){"use strict";var r,i=n(15),o=n(22),a=n(7),s=n(2),l=n(20),u=Object.defineProperty;r=e.exports=function(e,t){if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");l.call(this,e),t=t?o.call(t,"key+value")?"key+value":o.call(t,"key")?"key":"value":"value",u(this,"__kind__",a("",t))},i&&i(r,l),delete r.prototype.constructor,r.prototype=Object.create(l.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),u(r.prototype,s.toStringTag,a("c","Array Iterator"))},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&!0===r.contains("dwa")&&!1===r.contains("foo")}},function(e,t,n){"use strict";e.exports=function(e){return"function"==typeof e}},function(e,t,n){"use strict";var r=n(4),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";e.exports=n(68)()?Object.keys:n(67)},function(e,t,n){"use strict";var r=n(69),i=n(0),o=Math.max;e.exports=function(e,t){var n,a,s,l=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},a=1;a<l;++a)t=arguments[a],r(t).forEach(s);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r=Object.create(null),i=Math.random;e.exports=function(){var e;do{e=i().toString(36).slice(2)}while(r[e]);return e}},function(e,t,n){"use strict";var r=n(25);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not an Object");return e}},function(e,t,n){"use strict";var r,i=Object.create;n(27)()||(r=n(26)),e.exports=function(){var e,t,n;return r?1!==r.level?i:(e={},t={},n={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){return"__proto__"===e?void(t[e]={configurable:!0,enumerable:!1,writable:!0,value:void 0}):void(t[e]=n)}),Object.defineProperties(e,t),Object.defineProperty(r,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:e}),function(t,n){return i(null===t?e:t,n)}):i}()},function(e,t,n){"use strict";var r,i=n(15),o=n(73),a=n(0),s=n(72),l=n(7),u=n(21),c=n(40),h=n(2).toStringTag,d=n(39),f=Array.isArray,p=Object.defineProperty,m=Object.prototype.hasOwnProperty,g=Object.getPrototypeOf;e.exports=r=function(){var e,t=arguments[0];if(!(this instanceof r))throw new TypeError("Constructor requires 'new'");return e=d&&i&&WeakMap!==r?i(new WeakMap,g(this)):this,null!=t&&(f(t)||(t=u(t))),p(e,"__weakMapData__",l("c","$weakMap$"+s())),t?(c(t,function(t){a(t),e.set(t[0],t[1])}),e):e},d&&(i&&i(r,WeakMap),r.prototype=Object.create(WeakMap.prototype,{constructor:l(r)})),Object.defineProperties(r.prototype,{delete:l(function(e){return!!m.call(o(e),this.__weakMapData__)&&(delete e[this.__weakMapData__],!0)}),get:l(function(e){if(m.call(o(e),this.__weakMapData__))return e[this.__weakMapData__]}),has:l(function(e){return m.call(o(e),this.__weakMapData__)}),set:l(function(e,t){return p(o(e),this.__weakMapData__,l("c",t)),this}),toString:l(function(){return"[object WeakMap]"})}),p(r.prototype,h,l("c","WeakMap"))},function(e,t,n){"use strict";e.exports=function(){var e,t;if("function"!=typeof WeakMap)return!1;try{e=new WeakMap([[t={},"one"],[{},"two"],[{},"three"]])}catch(e){return!1}return"[object WeakMap]"===String(e)&&"function"==typeof e.set&&e.set({},1)===e&&"function"==typeof e.delete&&"function"==typeof e.has&&"one"===e.get(t)}},function(e,t,n){"use strict";e.exports=n(76)()?WeakMap:n(75)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(77),i=function(){function e(){this._map=new r}return e.prototype.get=function(e){return this._map.get(e)},e.prototype.set=function(e,t){this._map.set(e,t)},e.prototype.has=function(e){return this._map.has(e)},e.prototype.delete=function(e){return this._map.delete(e)},e}();t.SCWeakMap=i},function(e,t,n){!function(t){var n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,a={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var i=a.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=a.normalizePath(i.path),a.buildURLFromParts(i)}var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=a.normalizePath(o.path),a.buildURLFromParts(o)):t;var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=r.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(u.netLoc=s.netLoc,"/"!==o.path[0]))if(o.path){var c=s.path,h=c.substring(0,c.lastIndexOf("/")+1)+o.path;u.path=a.normalizePath(h)}else u.path=s.path,o.params||(u.params=s.params,o.query||(u.query=s.query));return null===u.path&&(u.path=n.alwaysNormalize?a.normalizePath(o.path):o.path),a.buildURLFromParts(u)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=a}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(79),i=/^.*\.([^\.;\?#]*).*$/;t.getExtension=function(e){var t=i.exec(e);return t?t[1].toLowerCase():null},t.buildAbsoluteUrl=function(e,t){return r.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.combine=function(e){var t=new Uint8Array(e.reduce(function(e,t){return e+t.byteLength},0)),n=0;return e.forEach(function(e){t.set(e,n),n+=e.byteLength}),t},t.fill=function(e,t){if(Uint8Array.prototype.fill)e.fill(t);else for(var n=0;n<e.length;n++)e[n]=t},t.forEach=function(e,t){if(Uint8Array.prototype.forEach)e.forEach(t);else for(var n=0;n<e.length;n++)t(e[n],n)},t.numberToUint8Array=function(e,t){if(void 0===t&&(t=!1),(e=Math.round(e))<0)throw new Error("Negative numbers not supported.");for(var n=Math.max(1,Math.ceil(Math.log(e+1)/Math.log(2)/8)),r=new Uint8Array(n),i=0;i<n;i++)r[t?i:n-1-i]=255&e,e>>>=8;return r},t.createVintBuffer=function(e){if(e<0||e>Math.pow(2,53))throw new Error("Unrepresentable value: "+e);var t;for(t=1;t<=8&&!(e<Math.pow(2,7*t)-1);t++);for(var n=new Uint8Array(t),r=1;r<=t;r++){var i=255&e;n[t-r]=i,e-=i,e/=Math.pow(2,8)}return n[0]|=1<<8-t,n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compact=function(e){return e.filter(function(e){return null!=e})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(18);t.promiseWithTimeout=function(e,t,n){return void 0===n&&(n=new Error("Timed out.")),new r.Promise(function(r,o){var a=window.setTimeout(function(){o(n)},t);i.always(e,function(e){return window.clearTimeout(a),e}).then(r,o)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i="undefined"!=typeof window&&"Map"in window;t.buildCache=function(){return i?new window.Map:new o};var o=function(){function e(){this._store=[]}return e.prototype.set=function(e,t){var n=r.find(this._store,function(t){return t.key===e});n?n.val=t:this._store.push({key:e,val:t})},e.prototype.get=function(e){var t=r.find(this._store,function(t){return t.key===e});if(t)return t.val},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);t.retry=function(e,t,n){void 0===n&&(n={});var i=null,o=0,a=!1,s=null;return function l(){var u=!1;s=t({attemptNum:o,scheduleRetry:function(){if(u)throw new Error("scheduleRetry() already called.");if(u=!0,s=null,a)return!1;var t=e(++o);if(null===t){var c=n.onNoMoreRetries;return c&&r.deferException(function(){return c()}),!1}return i=window.setTimeout(l,t),!0}})||null}(),{cancel:function(){a||(a=!0,i&&(window.clearTimeout(i),i=null),s&&s.onCancel())}}},t.buildExponentialDelayCalculator=function(e){var t=void 0===e?{}:e,n=t.timeBase,r=void 0===n?500:n,i=t.threshold,o=void 0===i?3:i,a=t.delayCap,s=void 0===a?45e3:a,l=t.jitter,u=void 0===l?200:l,c=t.maxAttempts,h=void 0===c?null:c;if(r<=0)throw new Error("Time base must be > 0.");if(o<=0)throw new Error("Threshold must be > 0.");if(null!==s&&s<=0)throw new Error("Delay cap must be null or > 0.");if(null!==h&&h<1)throw new Error("Max attempts must be >= 1.");return function(e){if(null!==h&&e>=h)return null;var t=e>0?Math.pow(2,e/o-1):0;return Math.min(t*r,s||1/0)+Math.round(Math.random()*u)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(37),o=n(85),a=n(30),s=n(17),l=n(84),u=n(19),c=n(8),h=n(83),d=n(18),f=n(82),p=n(81),m=n(3),g=n(36),_=n(80),v=n(78);!function(e){e.OnExit=a.OnExit,e.find=s.find,e.Promise=c.Promise,e.promiseWithTimeout=h.promiseWithTimeout,e.always=d.always,e.compact=f.compact,e.deferException=m.deferException,e.SCWeakMap=v.SCWeakMap,function(e){e.buildCache=l.buildCache}(e.cache||(e.cache={})),function(e){e.buildDeferred=r.buildDeferred}(e.deferred||(e.deferred={})),function(e){e.getExtension=_.getExtension,e.buildAbsoluteUrl=_.buildAbsoluteUrl}(e.url||(e.url={})),function(e){e.AbortableJob=i.AbortableJob,e.map=i.map,e.abortedError=i.abortedError}(e.abortableJob||(e.abortableJob={})),function(e){e.retry=o.retry,e.buildExponentialDelayCalculator=o.buildExponentialDelayCalculator}(e.retry||(e.retry={})),function(e){e.isSafari=g.isSafari,e.getSafariVersion=g.getSafariVersion,e.isIE=g.isIE,e.isEdge=g.isEdge,e.isFirefox=g.isFirefox,e.isChrome=g.isChrome,e.getChromeVersion=g.getChromeVersion,e.getFirefoxVersion=g.getFirefoxVersion}(e.browser||(e.browser={})),function(e){e.combine=p.combine,e.fill=p.fill,e.forEach=p.forEach,e.numberToUint8Array=p.numberToUint8Array,e.createVintBuffer=p.createVintBuffer}(e.arrayBuffer||(e.arrayBuffer={})),function(e){e.now=u.now}(e.time||(e.time={}))}(t.helpers||(t.helpers={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._msg=e,this._cause=t}return e.prototype.getMsg=function(){return this._msg},e.prototype.getCause=function(){return this._cause},e}();t.LoaderError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(87);!function(e){e.LoaderError=r.LoaderError}(t.loaderErrors||(t.loaderErrors={}))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),o=function(e){function t(t,n){return e.call(this,t||"The URL update failed for some reason.",n)||this}return r(t,e),t.prototype.getCode=function(){return"URL_UPDATE_ERROR"},t}(i.PlayerFatalError);t.URLUpdateError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(33),i=n(89),o=n(29),a=n(16),s=n(11),l=n(5);!function(e){e.PlayerError=s.PlayerError,e.PlayerFatalError=l.PlayerFatalError,e.NotSupportedError=r.NotSupportedError,e.URLUpdateError=i.URLUpdateError,e.ImplementationError=o.ImplementationError,e.ProxyProvidedPlayerFatalError=a.ProxyProvidedPlayerFatalError}(t.errors||(t.errors={}))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(12),a=n(35),s=n(16),l=function(e){function t(t){var n=e.call(this,t)||this;return n._onPlayerProvided=new i.EventDispatcher,n._onPlayerRemoved=new i.EventDispatcher,n._shouldPassThroughFatalErrors=!!t.shouldPassThroughFatalErrors,n.onPlayerProvided=n._onPlayerProvided.getHandle(),n.onPlayerRemoved=n._onPlayerRemoved.getHandle(),n._logger=o.prefixLogger(n._logger,"ProxyPlayer"),n}return r(t,e),t.prototype.providePlayer=function(e,t){void 0===t&&(t={}),this._providePlayer(e,t),this._onPlayerProvided.dispatch(e)},t.prototype.removePlayer=function(){var e=this._getPlayer();if(!e)throw new Error("There is no player to remove.");this._removePlayer(),this._onPlayerRemoved.dispatch(e)},t.prototype.setInitialDuration=function(e){this._setInitialDuration(e)},t.prototype.getPlayer=function(){return this._getPlayer()},t.prototype._handleFatalError=function(e,t){this._shouldPassThroughFatalErrors?this._triggerError(e):this._triggerError(new s.ProxyProvidedPlayerFatalError(e,t))},t}(a.ProxyPlayerBase);t.ProxyPlayer=l},function(e,t){},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(){p&&d&&(p=!1,d.length?f=d.concat(f):m=-1,f.length&&a())}function a(){if(!p){var e=i(o);p=!0;for(var t=f.length;t;){for(d=f,f=[];++m<t;)d&&d[m].run();m=-1,t=f.length}d=null,p=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var u,c,h=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(e){c=r}}();var d,f=[],p=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new s(e,t)),1!==f.length||p||i(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,n){(function(t,r){!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"function"==typeof e}function i(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<T;e+=2){var t=I[e],n=I[e+1];t(n),I[e]=void 0,I[e+1]=void 0}T=0}function a(e,t){var n=arguments,r=this,i=new this.constructor(l);void 0===i[L]&&y(i);var o=r._state;return o?function(){var e=n[o-1];P(function(){return v(o,i,e,r._result)})}():m(r,i,e,t),i}function s(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(l);return h(t,e),t}function l(){}function u(e){try{return e.then}catch(e){return U.error=e,U}}function c(t,n,r){n.constructor===t.constructor&&r===a&&n.constructor.resolve===s?function(e,t){t._state===N?f(e,t._result):t._state===B?p(e,t._result):m(t,void 0,function(t){return h(e,t)},function(t){return p(e,t)})}(t,n):r===U?p(t,U.error):void 0===r?f(t,n):e(r)?function(e,t,n){P(function(e){var r=!1,i=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,function(n){r||(r=!0,t!==n?h(e,n):f(e,n))},function(t){r||(r=!0,p(e,t))},e._label);!r&&i&&(r=!0,p(e,i))},e)}(t,n,r):f(t,n)}function h(e,t){e===t?p(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?c(e,t,u(t)):f(e,t)}function d(e){e._onerror&&e._onerror(e._result),g(e)}function f(e,t){e._state===F&&(e._result=t,e._state=N,0!==e._subscribers.length&&P(g,e))}function p(e,t){e._state===F&&(e._state=B,e._result=t,P(d,e))}function m(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+N]=n,i[o+B]=r,0===o&&e._state&&P(g,e)}function g(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?v(n,r,i,o):i(o);e._subscribers.length=0}}function _(){this.error=null}function v(t,n,r,i){var o=e(r),a=void 0,s=void 0,l=void 0,u=void 0;if(o){if((a=function(e,t){try{return e(t)}catch(e){return k.error=e,k}}(r,i))===k?(u=!0,s=a.error,a=null):l=!0,n===a)return void p(n,new TypeError("A promises callback cannot return that same promise."))}else a=i,l=!0;n._state!==F||(o&&l?h(n,a):u?p(n,s):t===N?f(n,a):t===B&&p(n,a))}function y(e){e[L]=V++,e._state=void 0,e._result=void 0,e._subscribers=[]}function b(e,t){this._instanceConstructor=e,this.promise=new e(l),this.promise[L]||y(this.promise),x(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&f(this.promise,this._result))):p(this.promise,new Error("Array Methods must be provided an Array"))}function E(e){this[L]=V++,this._result=this._state=void 0,this._subscribers=[],l!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof E?function(e,t){try{t(function(t){h(e,t)},function(t){p(e,t)})}catch(t){p(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var x=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},T=0,S=void 0,A=void 0,P=function(e,t){I[T]=e,I[T+1]=t,2===(T+=2)&&(A?A(o):D())},M="undefined"!=typeof window?window:void 0,R=M||{},C=R.MutationObserver||R.WebKitMutationObserver,w="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),O="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,I=new Array(1e3),D=void 0;D=w?function(){return t.nextTick(o)}:C?function(){var e=0,t=new C(o),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():O?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===M?function(){try{var e=n(92);return"undefined"!=typeof(S=e.runOnLoop||e.runOnContext)?function(){S(o)}:i()}catch(e){return i()}}():i();var L=Math.random().toString(36).substring(16),F=void 0,N=1,B=2,U=new _,k=new _,V=0;return b.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===F&&n<e;n++)this._eachEntry(t[n],n)},b.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===s){var i=u(e);if(i===a&&e._state!==F)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===E){var o=new n(l);c(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},b.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===F&&(this._remaining--,e===B?p(r,n):this._result[t]=n),0===this._remaining&&f(r,this._result)},b.prototype._willSettleAt=function(e,t){var n=this;m(e,void 0,function(e){return n._settledAt(N,t,e)},function(e){return n._settledAt(B,t,e)})},E.all=function(e){return new b(this,e).promise},E.race=function(e){var t=this;return new t(x(e)?function(n,r){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},E.resolve=s,E.reject=function(e){var t=new this(l);return p(t,e),t},E._setScheduler=function(e){A=e},E._setAsap=function(e){P=e},E._asap=P,E.prototype={constructor:E,then:a,catch:function(e){return this.then(null,e)}},E.polyfill=function(){var e=void 0;if("undefined"!=typeof r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=E},E.Promise=E,E})}).call(this,n(94),n(93))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(13),o=n(6),a=n(37),s=n(3);!function(e){e[e.PENDING=0]="PENDING",e[e.WAITING=1]="WAITING",e[e.IN_PROGRESS=2]="IN_PROGRESS",e[e.COMPLETED=3]="COMPLETED",e[e.ERRORED=4]="ERRORED"}(r=t.ResponseState||(t.ResponseState={}));var l=function(){function e(){var e=this;this._responseDeferred=i.buildDeferred(),this._requestStartCallbacks=[],this._parts=[],this._progressEventDispatcher=new o.EventDispatcher,this._cachedCompleteParts=null,this._state=r.PENDING,this._statusAndHeaders=null,this._getProgressSoFar=function(){if(!e._parts.length)return null;if(!e._statusAndHeaders)throw new Error("Headers should be set.");return{initial:!0,statusCode:e._statusAndHeaders.statusCode,headers:e._statusAndHeaders.headers,part:e._getDataSoFar()}};var t=new a.AbortableJob(function(){return{result:e._responseDeferred.promise,progressUpdates:{getProgressSoFar:e._getProgressSoFar,onProgressUpdate:e._progressEventDispatcher}}},{storeResult:!0});this._jobHandle=t.run()}return e.prototype.onProgress=function(e){this._jobHandle.onProgressUpdate(e)},e.prototype.getResponse=function(){return this._jobHandle.whenComplete()},e.prototype.onRequestStart=function(e){this._state!==r.PENDING?s.deferException(e):this._requestStartCallbacks.push(e)},e.prototype.onResponseReceived=function(e){this._jobHandle.onCompletion(e)},e.prototype.onError=function(e){this._jobHandle.onError(e)},e.prototype.hasRequestStarted=function(){return this._state!==r.PENDING},e.prototype.hasCompleted=function(){return this._state===r.COMPLETED||this._state===r.ERRORED},e.prototype.getState=function(){return this._state},e.prototype.abort=function(){-1===[r.ERRORED,r.COMPLETED].indexOf(this._state)&&(this._jobHandle.abort(),this._state=r.ERRORED,this._abort())},e.prototype._signalRequestStart=function(){this._enforceState(r.PENDING),this._state=r.WAITING,this._requestStartCallbacks.splice(0).forEach(function(e){return s.deferException(e)})},e.prototype._signalTimeout=function(){this._enforceState(r.WAITING,r.IN_PROGRESS),this._state=r.COMPLETED,this._requestStartCallbacks.splice(0),this._responseDeferred.resolve(null)},e.prototype._provideStatusAndHeaders=function(e,t){this._enforceState(r.WAITING),this._statusAndHeaders=e,this._state=r.IN_PROGRESS,this._providePart(t)},e.prototype._providePart=function(e){this._enforceState(r.IN_PROGRESS);var t=!this._parts.length;if(this._parts.push(e),!this._statusAndHeaders)throw new Error("Headers should be set.");this._progressEventDispatcher.dispatch({initial:t,statusCode:this._statusAndHeaders.statusCode,headers:this._statusAndHeaders.headers,part:e})},e.prototype._finalize=function(e){var t=this;if(e)this._enforceState(r.PENDING,r.WAITING,r.IN_PROGRESS),this._state=r.ERRORED,this._requestStartCallbacks.splice(0),this._responseDeferred.reject(e);else{if(this._enforceState(r.IN_PROGRESS),this._state=r.COMPLETED,!this._statusAndHeaders)throw new Error("Headers should be set.");this._responseDeferred.resolve({statusCode:this._statusAndHeaders.statusCode,headers:this._statusAndHeaders.headers,getData:function(){if(!t._parts.length)throw new Error("Unexpected error. No parts.");return t._cachedCompleteParts?t._cachedCompleteParts:t._cachedCompleteParts=t._getDataSoFar()}})}},e.prototype._getDataSoFar=function(){var e=this._parts.length;if(!e)throw new Error("No parts.");return 1===e?this._parts[0]:this._reduceParts(this._parts)},e.prototype._enforceState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(-1===e.indexOf(this._state))throw new Error("Invalid state. Got "+this._state+" Expecting one of "+e.join(","))},e}();t.LoaderRequest=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819;var r=n(6),i=n(96),o=n(12),a=n(91);t.ProxyPlayer=a.ProxyPlayer;var s=n(35);t.ProxyPlayerBase=s.ProxyPlayerBase;var l=n(90);t.errors=l.errors;var u=n(88);t.loaderErrors=u.loaderErrors;var c=n(86);t.helpers=c.helpers;var h=n(34);t.BasePlayer=h.BasePlayer;var d=n(32);t.State=d.State;var f=n(31);t.StateManager=f.StateManager;var p=n(38);t.TimeRange=p.TimeRange,function(e){e.EventDispatcher=r.EventDispatcher}(t.eventDispatcher||(t.eventDispatcher={})),function(e){e.LoaderRequest=i.LoaderRequest,e.ResponseState=i.ResponseState}(t.loader||(t.loader={})),function(e){e.noOpLogger=o.noOpLogger,e.consoleLogger=o.consoleLogger,e.prefixLogger=o.prefixLogger,e.cloneLogger=o.cloneLogger}(t.logger||(t.logger={}))}])},function(e,t,n){window,e.exports=function(e,t,n){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(0),o=new i.WebAudioContext,a=function(){function e(e,t){this._playerListeners=new r.helpers.SCWeakMap,this._playerWithElement=null,this._canActivate=!0,this._provideMediaElementErrorRunCheck={},this._element=document.createElement(e),this._logger=r.logger.prefixLogger(t,"MediaElementManager")}return e.prototype.activate=function(){this._canActivate&&(this._logger.debug("Activating media element."),this._element.load()),this._logger.debug("Activating web audio context."),o.activate()},e.prototype.registerPlayer=function(e,t){var n=this;if(this._playerListeners.has(e))throw new Error("Player already registered.");var r=function(){if(e.getMediaElement()!==n._element){n._playerWithElement&&(n._playerWithElement.getMediaElement()===n._element&&(n._logger.debug("Revoking media element from previous player."),n._playerWithElement.isPlaying()&&n._logger.warn("Revoking media element from a playing player."),n._playerWithElement.revokeMediaElement()),n._playerWithElement=null),n._canActivate=!1;var r=n._provideMediaElementErrorRunCheck={};n._logger.debug("Providing media element to new player."),e.provideMediaElement(n._element).catch(function(i){e.isDead()||n._provideMediaElementErrorRunCheck!==r||(n._logger.error("Error occurred providing media element to new player.",i),t(i))}),n._playerWithElement=e}},i=e.onChange.subscribe(function(e){var t=e.playing;t&&r()});this._playerListeners.set(e,i),e.getMediaElement()&&e.revokeMediaElement(),e.isPlaying()&&r()},e.prototype.unregisterPlayer=function(e){var t=this._playerListeners.get(e);t&&(t.remove(),this._playerWithElement===e&&(this._playerWithElement=null,e.getMediaElement()===this._element&&e.revokeMediaElement()),this._playerListeners.delete(e))},e.prototype.getWebAudioContext=function(){return o},e}();t.MediaElementManager=a},function(e,t){e.exports=n},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(1),a=n(0),s=function(e){function t(t){var n=e.call(this)||this;return n._mediaElementManager=t,n.name="MaestroHTML5",n}return r(t,e),t.errorQualifiesAbort=function(e){return!(e instanceof a.errors.WebAudioInitializeError)},t.prototype.isRenditionSupported=function(e,t){return("http"===e.scProtocol||-1!==["hls","encrypted-hls"].indexOf(e.scProtocol)&&!t.streamUrlExpires)&&a.HTML5Player.isFormatSupported(e.maestroFormat)},t.prototype.buildPlayer=function(e){var t=e.urlAndRendition,n=t.rendition,r=t.timeRetrieved;if(e.streamUrlExpires&&(["hls","encrypted-hls"].indexOf(n.scProtocol)>=0||void 0===r))throw i.notSupportedError;return new l(e,this._mediaElementManager)},t}(i.BaseController);t.HTML5PlayerController=s;var l=function(){function e(e,t){var n=this;this._config=e,this._mediaElementManager=t;var r=e.logger,i=e.playerId,o=e.urlAndRendition,l=e.streamUrlExpires,u=e.reportError,c=e.fadeOnPauseAndPlay,h=e.fadeOnSeek,d=e.releaseControl;this._logger=r;var f=o.rendition,p=o.timeRetrieved;if(l){if(void 0===p)throw new Error("Expecting timeUrlRetrieved to be set.");this._expirationConfig={urlExpires:!0,timeUrlRetrieved:p}}else this._expirationConfig={urlExpires:!1};var m=this._player=new a.HTML5Player({url:o.url,format:f.maestroFormat},{name:i,mediaElement:null,fadeSupportEnabled:c||h,defaultFadeDuration:c?void 0:0,defaultSeekFadeInDuration:h?void 0:0,defaultSeekFadeOutDuration:h?void 0:0,webAudioContext:this._mediaElementManager.getWebAudioContext(),logger:this._logger,registerListeners:function(e){var t=e.onError,r=e.onChange;t.subscribe(function(e){e instanceof a.errors.NetworkError&&n._hasExpired()?(n._logger.info("Releasing control as a network error occurred, and the URL has expired."),d({retry:!0})):(u(e.getCode()),s.errorQualifiesAbort(e)&&d({retry:!1}))}),r.subscribe(function(e){var t=e.dead,r=e.playing,i=e.actuallyPlaying,o=e.seeking,a=e.duration;return t?void d({retry:!1}):a===1/0?(n._logger.info("Releasing control because the duration was Infinity."),void d({retry:!1})):void(n._expirationConfig.urlExpires&&(r||i||o)&&n._checkIfUrlWillExpireBeforeEnd())})}});this._mediaElementManager.registerPlayer(m,function(){return d({retry:!1})})}return e.prototype.getPlayer=function(){return this._player},e.prototype.getUrl=function(){return this._config.urlAndRendition.url},e.prototype._checkIfUrlWillExpireBeforeEnd=function(){var e=this._player.getDuration(),t=this._getExpireTime();if(null!==e&&null!==t){var n=e-this._player.getPosition();o.helpers.time.now()+n>t&&(this._logger.info("Releasing control because stream URL would expire before reaching end."),this._config.releaseControl({retry:!0}))}},e.prototype._getExpireTime=function(){if(!this._expirationConfig.urlExpires)return null;var e=this._player.getDuration();return null===e?null:this._expirationConfig.timeUrlRetrieved+e+105e3},e.prototype._hasExpired=function(){var e=this._getExpireTime();return null!==e&&e<=o.helpers.time.now()},e}();t.ControlledPlayer=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="23.1.0",t.buildNumber=845;var r=n(4);t.HTML5PlayerController=r.HTML5PlayerController;var i=n(2);t.MediaElementManager=i.MediaElementManager;var o=n(0);t.HTML5Player=o.HTML5Player}])}(n(4),n(2),n(1))},function(e,t,n){window,e.exports=function(e){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.buildMimeTypeFromFormat=function(e,t){void 0===t&&(t={});var n=e.mimeType||t.mimeType;if(!n)return null;var i=e.audioCodec||t.audioCodec,o=e.videoCodec||t.videoCodec,a=r.helpers.compact([i,o]),s=a.length>0?'; codecs="'+a.map(function(e){return e.id}).join(",")+'"':"";return n+s}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t,n){return void 0===t&&(t="An error occurred when initializing web audio."),e.call(this,t,n)||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.WEB_AUDIO_INITIALIZE_ERROR"},t}(i.errors.PlayerError);t.WebAudioInitializeError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t,n){return void 0===t&&(t="An error occurred when activating web audio."),e.call(this,t,n)||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.WEB_AUDIO_ACTIVATION_ERROR"},t}(i.errors.PlayerFatalError);t.WebAudioActivationError=o},function(e,t,n){"use strict";function r(){return"AudioContext"in window&&(o.helpers.browser.isChrome()||s&&s.major>=48||o.helpers.browser.isEdge())}function i(){if(l)return l;if(!r())throw new Error("Web audio is not enabled.");var e=new window.AudioContext;if(!e.destination.maxChannelCount)throw t.WEB_AUDIO_NO_OUTPUT_CHANNELS_ERROR;return l={context:e,suspender:new a.WebAudioContextSuspender(e)}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(15),s=o.helpers.browser.getFirefoxVersion();t.WEB_AUDIO_ACTIVATION_TIMEOUT=5e3,t.WEB_AUDIO_ACTIVATION_TIMEOUT_ERROR=new Error("Web audio activation timed out."),t.WEB_AUDIO_NO_OUTPUT_CHANNELS_ERROR=new Error("Web audio found no output channels.");var l=null,u=function(){function e(){}return e.prototype.getAudioContextWithSuspender=function(){return r()?i():null},e.prototype.activate=function(){if(!r())return o.helpers.Promise.resolve(void 0);try{var e=i().context;return function(e){return e.state&&e.resume&&"running"!==e.state?o.helpers.promiseWithTimeout(e.resume(),t.WEB_AUDIO_ACTIVATION_TIMEOUT,t.WEB_AUDIO_ACTIVATION_TIMEOUT_ERROR):o.helpers.Promise.resolve()}(e)}catch(e){return o.helpers.Promise.reject(e)}},e}();t.WebAudioContext=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=function(e){function t(t){return e.call(this,"Web audio found no channels.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.WEB_AUDIO_INITIALIZE_NO_CHANNELS_ERROR"},t}(i.WebAudioInitializeError);t.WebAudioInitializeNoChannelsError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=function(e){function t(t){return e.call(this,"We timed out when trying to activate web audio.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.WEB_AUDIO_ACTIVATION_TIMEOUT_ERROR"},t}(i.WebAudioActivationError);t.WebAudioActivationTimeoutError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t){var n=e.call(this,"Unexpected error from media element.",t)||this;return n._error=t,n}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.UNEXPECTED_MEDIA_ELEMENT_ERROR_"+(this._error&&this._error.code||"UNKNWON")},t}(i.errors.PlayerFatalError);t.MediaElementError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return e.call(this,"An unrecoverable error occurred whilst decoding.")||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.DECODE_ERROR"},t}(i.errors.PlayerFatalError);t.DecodeError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return e.call(this,"An unrecoverable network error occurred.")||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.NETWORK_ERROR"},t}(i.errors.PlayerFatalError);t.NetworkError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.buildTimeRanges=function(e){for(var t=[],n=e.length,i=0;i<n;i++)t.push({end:1e3*e.end(i),start:1e3*e.start(i)});return r.TimeRange.normalizeRawTimeRanges(t).map(function(e){return new r.TimeRange(e.start,e.end-e.start)})}},function(e,t,n){"use strict";function r(e){try{var t=document.createElement("audio");return!!t.canPlayType(e)}catch(e){return!1}}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(10),s=n(17),l=n(9),u=n(8),c=n(7),h=n(16),d=n(6),f=n(2),p=n(5),m=n(3),g=n(4),_=n(1),v=o.helpers.deferred.buildDeferred,y=o.helpers.url.getExtension,b=o.helpers.Promise,E=o.helpers.browser,x=o.logger.prefixLogger,T=o.errors.NotSupportedError,S=o.errors.PlayerFatalError,A=new Error("Media element was revoked."),P=[],M=new o.helpers.SCWeakMap,R=null,C=o.helpers.retry.buildExponentialDelayCalculator({jitter:0,timeBase:50}),w=function(e){function t(t){var n=e.call(this,t)||this;n._duration=null,n._stallDetected=!1,n._fadeManagers=null,n._shouldCoverGlitch=!0,n._initialized=!1,n._muted=!1,n._volume=1,n._deferredProvideMediaElementCallback=null,n._playInProgress={inProgress:!1},n._lastStallCheckPos=null,n._stallCheckTimerId=null,n._timeWhenPositionChanged=0,n._endedOverride=!1,n._pauseEventTimer=null,n._positionWhenMediaElementRevoked=0,n._playingWhenMediaElementRevoked=!1,n._provideMediaElementDeferred=null,n._mediaElementAndState=null,n._listeners=[],n._currentSeek=null,n._playDetectionPosition=0,n._playDetectionTimer=null,n._playDetectionTimerNumAttempts=0,n._fadeRate=null,n._seekFadeRate=null,n._webAudioOrchestration=null,n._fadeEndedHandle=null,n._onSeekFadeOutCompleted=null,n._fadeRateAfterSeek=1/0,n._mediaElPlayShouldBeAborted=new o.helpers.SCWeakMap,n._mediaElPaused=new o.helpers.SCWeakMap,n._mediaElPlayTracker=null,n._logger=x(n._logger,"HTML5PlayerBase"),n._playerDependencies=t,n._webAudioContext=t.webAudioContext||R||(R=new g.WebAudioContext);var r=n._webAudioOrchestration=t.fadeSupportEnabled?n._initWebAudio():null;r&&(n._logger.debug("Fading supported."),n._fadeManagers={pausePlay:new s.FadeManager(r.context,r.gainNodes.pausePlay),seek:new s.FadeManager(r.context,r.gainNodes.seek)}),n._handleDurationUpdates();var i=void 0!==t.mediaElement?t.mediaElement:n._createDefaultMediaElement();i&&n.provideMediaElement(i).catch(function(e){return e===A?void n._logger.debug("Initial provideMediaElement() call was aborted."):void n._triggerError(new h.InitializeError(e))});var a=n._fadeManagers;return a&&n.onChange.subscribe(function(e){var t=e.stalled,r=e.seek,i=e.ended;if(i&&a.seek.getDirection()===s.FadeDirection.UP&&a.seek.isFading())n._logger.debug("Completing fade in after seek early because reached end."),a.seek.performFade(1/0),n._notifyFadingForSeek(!1);else{var o=n.getSeekState(),l=o&&"COMPLETED"===o.state,u=r&&"COMPLETED"===r.state;(!1===t&&l||u&&!n.isStalled())&&a.seek.getDirection()===s.FadeDirection.DOWN&&(n._logger.debug("Fading in after seek.",n._fadeRateAfterSeek),a.seek.performFade(n._fadeRateAfterSeek,function(){return n._notifyFadingForSeek(!1)}))}}),n._logger.info("Checking if the player can play the provided descriptor."),n._canPlayTimer=window.setTimeout(function(){n._canPlay().then(function(e){if(!n.isDead())return e instanceof o.errors.NotSupportedError?(n._logger.info("Player not supported.",e),void n._triggerError(e)):e?(n._logger.info("Player supported."),void n._initialize()):(n._logger.info("Player not supported."),void n._triggerError(new T))}).catch(function(e){n._logger.error("Unexpected error during can play check.",e),n._triggerError(new S("An unexpected error occured during initialization.",e))})},0),n}return i(t,e),t.isFormatSupported=function(e){var t=_.buildMimeTypeFromFormat(e);return!!t&&r(t)},t.prototype.getMediaElement=function(){return this._mediaElementAndState&&this._mediaElementAndState.element},t.prototype.provideMediaElement=function(e){var t=this;if(this._ensureNotDead(),this._mediaElementAndState)throw new Error("Already have a media element.");if(P.indexOf(e)>=0)throw new Error("The same media element is currently being used in another player.");if(!this._webAudioOrchestration&&M.has(e))throw new Error("The same media element has been used in another player with fading enabled.");P.push(e);var n=this._provideMediaElementDeferred=v();return this._update(function(){t._logger.debug("provideMediaElement() called.",e),t._initMediaElementLocal(e,!1);var r=t._mediaElementAndState={element:e,state:"INITIALIZING"},i=function(){t._logger.debug("Initializing media element."),t._initMediaElement(e,!0),t._addPausedHandlers(e),t._attachListeners();var i=t._listenToOnce("error",function(){t._provideMediaElementDeferred=null;var r=e.error,i=r?r.code:"unknown";t._logger.error("Error whilst initializing media element.",i),t.revokeMediaElement(),n.reject(new Error("Error when initializing media element. Error: "+i))},{earlyAttach:!0}),o=function(){null===t._getQueuedSeekPosition()&&t._positionWhenMediaElementRevoked>0?(t._logger.debug("Seeking to expected position..."),t._performSeek(t._positionWhenMediaElementRevoked,function(e){return void 0!==e?(t._provideMediaElementDeferred=null,t._logger.error("An error occurred when trying to seek to the expected position."),t.revokeMediaElement(),void n.reject(new Error("An error occurred when trying to restore the position."))):(t._logger.debug("Seeked to expected position."),void a())})):a()},a=function(){t.isPlaying()===t.isActuallyPlaying()&&t._playingWhenMediaElementRevoked?(t._logger.debug("Calling play to match previous state..."),t._mediaElementPlay().catch(function(e){t._provideMediaElementDeferred=null,t._logger.error("An error occurred when trying to play.",e),r===t._mediaElementAndState&&t.revokeMediaElement(),n.reject(new Error("Browser refused play() request on media element."))}),t._listenToOnce("play",function(){t._logger.debug("Play succeeded."),s()},{earlyAttach:!0})):s()},s=function(){return t._mediaElementAndState!==r?void t._triggerError(new S("Media element switched unexpectedly.")):(t._provideMediaElementDeferred=null,i.remove(),n.resolve(void 0),t._mediaElementAndState.state="STABLE",t._logger.debug("Finished putting element in expected state."),t._shouldCoverGlitch=!0,void(null!==t._duration&&t._update(function(){t.isReady()||t._signalReady(),t._handleDeferredPauseAndSeek()})))};t._listenToOnce("emptied",function(){t._logger.debug("Got emptied event from media element."),t._logger.debug("Putting media element in the state that is expected..."),o()},{earlyAttach:!0})};t._initialized?i():t._deferredProvideMediaElementCallback=i}),n.promise},t.prototype.revokeMediaElement=function(){var e=this;if(!this._mediaElementAndState)throw new Error("There is no media element to revoke.");this._deferredProvideMediaElementCallback=null,this._provideMediaElementDeferred&&(this._provideMediaElementDeferred.reject(A),this._provideMediaElementDeferred=null),this._logger.debug("revokeMediaElement() called."),this._detachListeners();var t=this._mediaElementAndState.element,n=P.indexOf(t);n>=0&&P.splice(n,1),this._onSeekFadeOutCompleted=null,this.isDead()||(this._positionWhenMediaElementRevoked=this.getPosition(),this._playingWhenMediaElementRevoked=this.isPlaying()),this._mediaElementAndState=null,this._initMediaElement(t,!1),this._removePausedHandlers(t),this._completeCurrentFade(),this._completeSeekFadeOutAndIn(),this._update(function(){e.isDead()||(!e.isPlaying()&&e.isActuallyPlaying()&&e._notifyPlaying(!1),e._handleStalled())})},t.prototype.getBufferedTimeRanges=function(){return this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state?a.buildTimeRanges(this._mediaElementAndState.element.buffered):[]},t.prototype.getMaxBufferLength=function(){return null},t.prototype._hasInitialized=function(){return this._initialized},t.prototype._inferFormat=function(e){var t=y(e);switch(t){case"mp3":return{mimeType:"audio/mpeg"};case"opus":return{mimeType:"audio/ogg",audioCodec:{id:"opus"}};case"mp4":return{mimeType:"video/mp4"};case"m4a":return{mimeType:"audio/mp4"};case"m3u8":return{mimeType:"application/x-mpegURL"};default:return{}}},t.prototype._canPlayType=function(e){return r(e)},t.prototype._initialize=function(){var e=this;this._initialized=!0,this._listenTo("error",function(){if("INITIALIZING"!==e._mediaElementAndState.state){var t=e._mediaElementAndState.element.error;switch(t&&t.code){case 2:e._triggerError(new l.NetworkError);break;case 3:e._triggerError(new u.DecodeError);break;default:e._logger.error("Unexpected error from media element.",t&&t.code,t&&t.message),e._triggerError(new c.MediaElementError(t))}}else e._logger.debug("An error occurred, but the media element is initializing, so ignoring...")},{earlyAttach:!0}),this._listenTo("play",function(){e._logger.debug("Media element play event."),e.isPlaying()||e.isActuallyPlaying()||!e._mediaElementAndState||e._isMediaElementPaused(e._mediaElementAndState.element)||(e._logger.debug("Calling play() because something external called play() on media element."),e.play())}),this._listenTo("playing",function(){e._logger.debug("Media element playing event."),e._mediaElementAndState&&!e._isMediaElementPaused(e._mediaElementAndState.element)?e._handlePlayingEvent():e._logger.debug("Ignoring playing event because media element is reporting it is paused.")}),this._listenTo("timeupdate",function(){return e._determineIfPlaying()}),this._listenTo("pause",function(){e._logger.debug("Media element pause event."),e._mediaElementAndState&&e._isMediaElementPaused(e._mediaElementAndState.element)?e._handlePauseEvent():e._logger.debug("Ignoring pause event because media element is reporting it is not paused.")}),this._listenTo("ended",function(){e._logger.debug("Media element ended event."),e._mediaElementAndState&&e._mediaElementAndState.element.ended?e._handleEndedEvent():e._logger.debug("Ignoring ended event because media element is reporting it is not ended.")}),this._listenTo("stalled",function(){e._logger.debug("Media element stalled event."),e._checkIfStalled()}),this._listenTo("volumechange",function(){e._mediaElementAndState&&e._notifyVolumeChangeFromMediaEl(e._mediaElementAndState.element)}),this._stallCheckTimerId=window.setInterval(function(){return e._checkIfStalled()},400),this._deferredProvideMediaElementCallback&&this._deferredProvideMediaElementCallback()},t.prototype._handleDurationChange=function(){var e=this,t=this._duration;null!==t&&this._update(function(){e._provideDuration(t),e._mediaElementAndState&&"STABLE"===e._mediaElementAndState.state&&(e._signalReady(),e._handleDeferredPauseAndSeek())})},t.prototype._createDefaultMediaElement=function(){return document.createElement(this._playerDependencies.mediaElementType||"audio")},t.prototype._handlePauseEvent=function(){var e=this;if(!this._mediaElementAndState)throw new Error("Media element should exist.");var t=this._mediaElementAndState.element;this.isActuallyPlaying()&&this._update(function(){t.ended||(e._notifyNotStalled(),e._completeCurrentFade(),e._completeSeekFadeOutAndIn(),e._notifyPlaying(!1))})},t.prototype._handlePlayingEvent=function(){var e=this,t=this._duration;if(null===t)throw new Error("Expecting duration to exist.");var n=this._getTruePosition();return n>=t?void this._logger.warn("Got a media element playing event and the positon was >= the duration.",n,t):this.isEnded()||this._shouldBeEnded()?void this._logger.warn("Got a media element playing event when the player is/should be ended."):void this._update(function(){e._notifyNotStalled(),e._determineIfPlaying(),e.isActuallyPlaying()||(e._playDetectionTimerNumAttempts=0,e._playDetectionTimer||(e._playDetectionTimer=window.setInterval(function(){return e._determineIfPlaying()},10)))})},t.prototype._handleEndedEvent=function(){return null!==this._getQueuedSeekPosition()?void this._logger.warn("Got a media element ended event but ignoring because a seek is in progress."):void this._update()},t.prototype._shouldBeEnded=function(){return this._endedOverride||this._mediaElementReportingEnded()},t.prototype._mediaElementReportingEnded=function(){return!!(this._mediaElementAndState&&this._mediaElementAndState.element.ended&&this._mediaElementAndState.element.paused)},t.prototype._handleDurationUpdates=function(){var e=this;this._listenToOnce("loadedmetadata",function(){return e._updateDurationFromMediaElement()},{reattach:!0,earlyAttach:!0}),this._listenTo("durationchange",function(){return e._updateDurationFromMediaElement()})},t.prototype._updateDurationFromMediaElement=function(){var e=this._mediaElementAndState;e&&(this._duration=1e3*e.element.duration,this._handleDurationChange())},t.prototype._handlePlayPauseChange=function(e,t){var n=this,r=t.fadeRate;this._fadeRate=r||null;var i=function(){n._mediaElementAndState&&"USABLE"===n._mediaElementAndState.state&&n._callMediaElementPause(n._mediaElementAndState.element),n._notifyFading(!1),n._completeSeekFadeOutAndIn(),n._notifyPlaying(!1)};if(this.isEnded())e?this._notifyPlaying(!0):i();else if(this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state){var o=this._playInProgress.inProgress||!this._isMediaElementPaused(this._mediaElementAndState.element);e&&!o?(this._fadeManagers&&this._fadeManagers.pausePlay.performFade(-1/0),this._playDetectionPosition=this._getTruePosition(),this._play(function(e){return n._notifyPlayRejection(e)})):!e&&o?this._update(function(){n._fadeManagers&&n._fadeManagers.pausePlay.getDirection()===s.FadeDirection.UP?(n._notifyFading(!0),n._fadeManagers.pausePlay.performFade(r||-1/0,function(){return i()})):i()}):e&&o?this._update(function(){n._fadeManagers&&n._fadeManagers.pausePlay.getDirection()===s.FadeDirection.DOWN&&n._fadeManagers.pausePlay.performFade(r||1/0,function(){return n._notifyFading(!1)}),n._notifyPlaying(!0)}):this._notifyPlaying(e)}},t.prototype._handleVolumeChange=function(e,t){if(this._mediaElementAndState){var n=this._mediaElementAndState.element;n.muted=t,n.volume=e,this._notifyVolumeChangeFromMediaEl(n)}else this._muted=t,this._volume=e,this._notifyVolumeChange(e,t)},t.prototype._handleSeekChange=function(e,t){var n=this,r=t.fadeRate;this._seekFadeRate=r,this._fadeRateAfterSeek=r.afterSeek||1/0;var i=this._mediaElementAndState;if(i&&"USABLE"===i.state){this._onSeekFadeOutCompleted=function(){n._onSeekFadeOutCompleted=null,l&&l.remove(),a&&a.seek.getDirection()===s.FadeDirection.DOWN&&(n._logger.debug("Fade out for seek completed.",e,r),a.seek.performFade(-1/0),n._notifyFadingForSeek(!1));var t=n._mediaElementReportingEnded();n._endedOverride=!1,n._performSeek(e,function(t){return void 0!==t?void n._triggerError(new o.errors.PlayerFatalError("An error occurred when trying to seek.",t)):(e===n._duration&&(n._endedOverride=!0),void n._update(function(){n.isActuallyPlaying()&&n._assumeStalled(),n._signalSeekComplete(),a&&(!n.isActuallyPlaying()||n._fadeRateAfterSeek===1/0||n.isEnded()?a.seek.performFade(1/0):n._notifyFadingForSeek(!0))}))}),t&&n.isPlaying()&&n._play(function(e){n._triggerError(new o.errors.PlayerFatalError("Error when trying to play after seek from end.",e))})},this._fadeEndedHandle&&(this._fadeEndedHandle.remove(),this._fadeEndedHandle=null);var a=this._fadeManagers,l=null,u=function(){n._onSeekFadeOutCompleted&&n._onSeekFadeOutCompleted()};this._update(function(){a&&(r.beforeSeek||r.afterSeek)?(n._logger.debug("Fading out ready for seek.",e,r),(a.seek.getDirection()===s.FadeDirection.UP||a.seek.isFading())&&n.isActuallyPlaying()&&r.beforeSeek&&!n._mediaElementReportingEnded()?(n._notifyFadingForSeek(!0),l=n._fadeEndedHandle=n._listenToOnce("ended",u),a.seek.performFade(r.beforeSeek||-1/0,u)):(a.seek.performFade(-1/0),u())):u()})}},t.prototype._performSeek=function(e,t){var n=this,r=this._mediaElementAndState;if(!r)throw new Error("Media element does not exist.");var i=this._currentSeek;i&&(this._currentSeek=null,i.abort());var o=r.element;if(o.currentTime!==e/1e3){var a=0;!function r(){var i=[],s=function(){n._currentSeek&&(n._currentSeek.abort(),n._currentSeek=null),t()};try{o.currentTime=e/1e3}catch(t){n._logger.warn("Error when trying to seek.",t,e)}n._playDetectionPosition=1e3*o.currentTime;var l=window.setTimeout(function(){n._logger.warn("Seek attempt failed. Retrying...",e,a),u(),r()},C(++a));i.push(n._listenToOnce("seeking",function(){window.clearTimeout(l)},{earlyAttach:!0})),i.push(n._listenToOnce("seeked",function(){var t=1e3*o.currentTime;Math.abs(t-e)<=100?s():(n._logger.warn("Seek attempt failed. Incorect position. Retrying...",t,e),u(),r())},{earlyAttach:!0}));var u=function(){i.forEach(function(e){return e.remove()}),window.clearTimeout(l)};n._currentSeek={abort:u}}()}else t()},t.prototype._getPosition=function(){var e=null!==this._duration?this._duration:1/0;if(!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)return this._positionWhenMediaElementRevoked;this._determineIfPlaying();var t=Math.min(this._getTruePosition(),e);return this._shouldBeEnded()?e:t},t.prototype._getTruePosition=function(){if(!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)throw new Error("Media element does not exist or is in invalid state.");var e=this._mediaElementAndState.element;return 1e3*e.currentTime},t.prototype._kill=function(){window.clearTimeout(this._canPlayTimer),this._playDetectionTimer&&window.clearInterval(this._playDetectionTimer),this._mediaElementAndState&&this.revokeMediaElement(),this._stallCheckTimerId&&window.clearInterval(this._stallCheckTimerId),this._webAudioOrchestration&&this._webAudioOrchestration.gainNodes.glitchCoverup.disconnect(this._webAudioOrchestration.context.destination),this._listeners=[]},t.prototype._listenToOnce=function(e,t,n){void 0===n&&(n={});var r=n.reattach,i=n.earlyAttach;void 0===r&&(r=!1),void 0===i&&(i=!1);var o=this._listenTo(e,function(e){o.remove(),t(e)},{reattach:r,earlyAttach:i});return o},t.prototype._listenTo=function(e,t,n){var r=this;void 0===n&&(n={});var i=n.reattach,o=n.earlyAttach;void 0===i&&(i=!0),void 0===o&&(o=!1);var a=function(n){if(s.attachedToElement)switch(e){case"play":var i=r._mediaElPlayShouldBeAborted.get(s.attachedToElement);if(r._mediaElPlayShouldBeAborted.delete(s.attachedToElement),i){r._logger.warn("Calling pause() on media element because the play request should have been rejected."),s.attachedToElement.pause();break}default:t(n)}else r._logger.warn("Got media element event after handler was removed. Ignoring.",n)},s={attachedToElement:null,handler:a,eventType:e,once:!1,reattach:i,earlyAttach:o};if(this._listeners.push(s),!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state&&!o)return{remove:function(){var e=r._listeners.indexOf(s);e>=0&&r._listeners.splice(e,1)}};var l=this._mediaElementAndState.element;return l.addEventListener(e,a,!1),s.attachedToElement=l,{remove:function(){var t=r._listeners.indexOf(s);t>=0&&(r._listeners.splice(t,1),s.attachedToElement=null,l.removeEventListener(e,a,!1))}}},t.prototype._notifyNotStalled=function(){this._stallDetected=!1,this._lastStallCheckPos=null,this._handleStalled()},t.prototype._assumeStalled=function(){this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state&&(this._lastStallCheckPos=this._mediaElementAndState.element.currentTime,this._timeWhenPositionChanged=0,this._stallDetected=!0,this._handleStalled())},t.prototype._initMediaElement=function(e,t){this._initMediaElementLocal(e,t)},t.prototype._callMediaElementPlay=function(e){var t=this;E.isEdge()&&this._mediaElPlayShouldBeAborted.set(e,!1);var n=this._mediaElPaused.get(e);n&&(n.paused=!1);var r=this._mediaElPlayTracker={},i=e.play();return n&&i&&i.catch&&i.catch(function(){r===t._mediaElPlayTracker&&(n.paused=!0)}),i},t.prototype._callMediaElementPause=function(e){this._playInProgress.inProgress=!1,E.isEdge()&&this._mediaElPlayShouldBeAborted.has(e)&&this._mediaElPlayShouldBeAborted.set(e,!0);var t=this._mediaElPaused.get(e);t&&(t.paused=!0),e.pause()},t.prototype._isMediaElementPaused=function(e){var t=this._mediaElPaused.get(e);return!t||t.paused},t.prototype._completeCurrentFade=function(){var e=this._fadeManagers;e&&(e.pausePlay.performFade(this.isPlaying()?1/0:-1/0),this.isDead()||this._notifyFading(!1))},t.prototype._completeSeekFadeOutAndIn=function(){var e=this,t=this._fadeManagers;t&&this._update(function(){t.seek.performFade(1/0),e.isDead()||(e._notifyFadingForSeek(!1),e._onSeekFadeOutCompleted&&e._onSeekFadeOutCompleted())})},t.prototype._determineIfPlaying=function(){var e=this;this._playDetectionTimer&&(!this.isPlaying()||++this._playDetectionTimerNumAttempts>=200)&&(window.clearInterval(this._playDetectionTimer),this._playDetectionTimer=null),this._update(function(){e._mediaElementAndState&&"USABLE"===e._mediaElementAndState.state&&(e.isDead()||!e.isReady()||!e.isPlaying()||e.isActuallyPlaying()||e._isMediaElementPaused(e._mediaElementAndState.element)||e._getTruePosition()===e._playDetectionPosition||(e._logger.debug("Detected that playback has started."),e._playDetectionTimer&&(window.clearInterval(e._playDetectionTimer),e._playDetectionTimer=null),e._notifyPlaying(!0),e._fadeManagers&&(e._notifyFading(!0),e._fadeManagers.pausePlay.performFade(e._fadeRate||1/0,function(){return e._notifyFading(!1)}))))})},t.prototype._initMediaElementLocal=function(e,t){if(e.setAttribute("msAudioCategory","BackgroundCapableMedia"),e.mozAudioChannelType="content",e.removeAttribute("src"),function(e){e.load()}(e),this._activateWebAudio(),this._pauseEventTimer&&(this._logger.debug("Clearing pause event timer."),window.clearTimeout(this._pauseEventTimer),this._pauseEventTimer=null),this._webAudioOrchestration&&this._webAudioOrchestration.mediaElementSource&&(this._logger.debug("Disconnecting media element from gain node."),this._webAudioOrchestration.mediaElementSource.disconnect(this._webAudioOrchestration.gainNodes.pausePlay),this._webAudioOrchestration.mediaElementSource=void 0),this._currentSeek&&(this._logger.debug("Aborting seek attempt."),this._currentSeek.abort(),this._currentSeek=null),t){this._webAudioOrchestration&&(this._logger.debug("Adding crossorigin attribute to media element because fading enabled."),e.setAttribute("crossorigin","anonymous"));var n=this._getUrlForMediaElement();if(this._logger.debug("Setting media element src.",n),e.src=n,e.volume=this._volume,e.muted=this._muted,this._webAudioOrchestration&&this._fadeManagers){this._logger.debug("Creating media element source node...");var r=M.get(e);if(r?this._logger.debug("Reusing media element source node."):(r=this._webAudioOrchestration.context.createMediaElementSource(e),M.set(e,r)),this._webAudioOrchestration.mediaElementSource=r,r.connect(this._webAudioOrchestration.gainNodes.pausePlay),this._logger.debug("Created media element source node."),this._shouldCoverGlitch){var i=this._webAudioOrchestration.context.currentTime,o=this._webAudioOrchestration.gainNodes.glitchCoverup;o.gain.setValueAtTime(0,i),o.gain.setValueAtTime(1,i+.1),this._shouldCoverGlitch=!1}}}e.playbackRate=1,e.setAttribute("preload","metadata"),this._callMediaElementPause(e),e.load()},t.prototype._addPausedHandlers=function(e){var t={removeListeners:function(){e.removeEventListener("play",n),e.removeEventListener("playing",n),e.removeEventListener("pause",n),e.removeEventListener("ended",n)},paused:!1},n=function(){t.paused=e.paused};n(),e.addEventListener("play",n),e.addEventListener("playing",n),e.addEventListener("pause",n),e.addEventListener("ended",n),this._mediaElPaused.set(e,t)},t.prototype._removePausedHandlers=function(e){var t=this._mediaElPaused.get(e);t&&t.removeListeners(),this._mediaElPaused.delete(e)},t.prototype._checkIfStalled=function(){if(this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state&&this.isActuallyPlaying()){var e=this._mediaElementAndState.element,t=e.currentTime,n=o.helpers.time.now();t!==this._lastStallCheckPos&&(this._timeWhenPositionChanged=n),this._stallDetected=e.readyState<=2||this._timeWhenPositionChanged<=n-500,this._lastStallCheckPos=t,this._handleStalled()}},t.prototype._handleStalled=function(){this._shouldBeEnded()&&null===this._getQueuedSeekPosition()?this.isEnded()||(this._logger.debug("Updating because stalled near end."),this._update()):this._notifyStalled(this._stallDetected||!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)},t.prototype._play=function(e){var t=this,n=this._activateWebAudio(),r={inProgress:!0};this._playInProgress=r,this._mediaElementPlay().then(function(){r.inProgress=!1,n.catch(function(e){t._logger.error("Error activating web audio.",e),e===g.WEB_AUDIO_ACTIVATION_TIMEOUT_ERROR?t._triggerError(new d.WebAudioActivationTimeoutError):t._triggerError(new m.WebAudioActivationError)})}).catch(function(n){return t._playInProgress!==r?void t._logger.debug("Ignoring play error because paused since.",n):(r.inProgress=!1,void(e&&e(n)))})},t.prototype._mediaElementPlay=function(){var e=this;if(!this._mediaElementAndState)throw new Error("Media element doesn't exist.");if(this._mediaElementReportingEnded())return this._logger.debug("Not calling play() because we are at the end. It will be called after a seek."),b.resolve();var t=this._mediaElementAndState.element,n=this._callMediaElementPlay(t);return new b(function(t,r){n?(n=n.then(function(){return t()})).catch&&(n=n.catch(function(n){"AbortError"===n.name?(e._logger.debug("Media element play() promise rejected with AbortError."),t()):r(n)})):t()})},t.prototype._notifyVolumeChangeFromMediaEl=function(e){this._volume=e.volume,this._muted=e.muted,this._notifyVolumeChange(e.volume,e.muted)},t.prototype._initWebAudio=function(){try{var e=this._webAudioContext.getAudioContextWithSuspender();if(!e)return this._logger.debug("WebAudio not supported/enabled."),null;this._logger.debug("WebAudio supported.");var t=e.context,n=e.suspender;n.watchPlayer(this);var r=t.createGain(),i=t.createGain(),o=t.createGain();return r.connect(i),i.connect(o),o.connect(t.destination),{context:t,suspender:n,gainNodes:{glitchCoverup:o,pausePlay:r,seek:i}}}catch(e){return e===g.WEB_AUDIO_NO_OUTPUT_CHANNELS_ERROR?this._triggerError(new p.WebAudioInitializeNoChannelsError(e)):this._triggerError(new f.WebAudioInitializeError(e)),this._logger.error("Failed initializing web audio.",e),null}},t.prototype._activateWebAudio=function(){return this._webAudioOrchestration?this._webAudioContext.activate():b.resolve(void 0)},t.prototype._handleDeferredPauseAndSeek=function(){var e=this;if(!this._mediaElementAndState||"STABLE"!==this._mediaElementAndState.state)throw new Error("Media element must be in the STABLE state.");this._logger.debug("Handling deferred pause and seek..."),this._mediaElementAndState.state="USABLE",this._attachListeners(),this._update(function(){e._handleStalled();var t=e._getQueuedSeekPosition();if(null!==t){var n=e._seekFadeRate?e._seekFadeRate.afterSeek:void 0;e._handleSeekChange(t,{fadeRate:{afterSeek:n}})}e.isPlaying()!==e.isActuallyPlaying()&&e._handlePlayPauseChange(e.isPlaying(),{fadeRate:e._fadeRate||void 0})})},t.prototype._detachListeners=function(){if(!this._mediaElementAndState)throw new Error("Media element doesn't exist.");var e=this._mediaElementAndState.element;this._listeners.forEach(function(t){t.attachedToElement&&(t.attachedToElement=null,e.removeEventListener(t.eventType,t.handler,!1))}),this._listeners=this._listeners.filter(function(e){return e.reattach})},t.prototype._attachListeners=function(){if(!this._mediaElementAndState)throw new Error("Media element doesn't exist.");this._logger.debug("Attaching listeners...");var e=this._mediaElementAndState,t=e.element,n=e.state;this._listeners.forEach(function(e){e.attachedToElement||!e.reattach||"USABLE"!==n&&!e.earlyAttach||(t.addEventListener(e.eventType,e.handler,!1),e.attachedToElement=t)}),this._logger.debug("Attached listeners.")},t}(o.BasePlayer);t.HTML5PlayerBase=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(1);!function(e){!function(e){e.buildTimeRanges=r.buildTimeRanges}(e.timeRanges||(e.timeRanges={})),function(e){e.buildMimeTypeFromFormat=i.buildMimeTypeFromFormat}(e.mimeType||(e.mimeType={}))}(t.helpers||(t.helpers={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(9),o=n(7),a=n(2),s=n(5),l=n(3),u=n(6);!function(e){e.DecodeError=r.DecodeError,e.NetworkError=i.NetworkError,e.MediaElementError=o.MediaElementError,e.WebAudioInitializeError=a.WebAudioInitializeError,e.WebAudioInitializeNoChannelsError=s.WebAudioInitializeNoChannelsError,e.WebAudioActivationError=l.WebAudioActivationError,e.WebAudioActivationTimeoutError=u.WebAudioActivationTimeoutError}(t.errors||(t.errors={}))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(11),a=n(1),s=i.helpers.Promise,l=function(e){function t(t,n){var r=e.call(this,n)||this;return r._descriptor=t,r._mimeType=t.format.mimeType||a.buildMimeTypeFromFormat(t.format,r._inferFormat(t.url)),r}return r(t,e),t.prototype._getUrlForMediaElement=function(){return this._descriptor.url},t.prototype._canPlay=function(){return this._mimeType&&this._canPlayType(this._mimeType)?s.resolve(!0):s.resolve(!1)},t}(o.HTML5PlayerBase);t.HTML5Player=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=2e4,i=function(){function e(e,t){void 0===t&&(t=r),this._audioContext=e,this._idleTime=t,this._players=[],this._prevPlayingCount=0,this._playingCount=0,this._timerId=null,this._suspendTimerId=null,this._suspendSupported="function"==typeof e.suspend}return e.prototype.watchPlayer=function(e){var t=this;!this._suspendSupported||e.isDead()||this._players.indexOf(e)>=0||(e.onChange.subscribe(function(n){var r=n.dead,i=n.playing;if(void 0!==i&&t._handleCountChange(i),r){var o=t._players.indexOf(e);o>=0&&(t._players.splice(o,1),!t._players.length&&t._suspendTimerId&&(window.clearInterval(t._suspendTimerId),t._suspendTimerId=null))}}),this._players.length||(this._suspendTimerId=window.setInterval(function(){0===t._playingCount&&null===t._timerId&&"suspended"!==t._audioContext.state&&t._scheduleSuspend(5e3)},5e3)),this._players.push(e),e.isPlaying()&&this._handleCountChange(!0))},e.prototype._handleCountChange=function(e){e?this._playingCount++:this._playingCount--,this._playingCount!==this._prevPlayingCount&&(this._prevPlayingCount=this._playingCount,0===this._playingCount?this._scheduleSuspend(this._idleTime):1===this._playingCount&&this._abortSuspend())},e.prototype._scheduleSuspend=function(e){var t=this;this._timerId=window.setTimeout(function(){t._timerId=null,t._audioContext.suspend()},e)},e.prototype._abortSuspend=function(){this._timerId&&(window.clearTimeout(this._timerId),this._timerId=null)},e}();t.WebAudioContextSuspender=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t){return e.call(this,"An error occurred when initializing the media element.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HTML5_PLAYER.INITIALIZE_ERROR"},t}(i.errors.PlayerFatalError);t.InitializeError=o},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"}(r=t.FadeDirection||(t.FadeDirection={}));var i=function(){function e(e,t){this._context=e,this._gain=t,this._currentFade={startTime:0,startValue:1,rate:0},this._fadeEndTimer=null}return e.prototype.isFading=function(){return!!this._fadeEndTimer},e.prototype.getDirection=function(){var e=this._currentFade,t=e.rate,n=e.startValue;return 0===t?0===n?r.DOWN:r.UP:t<0?r.DOWN:r.UP},e.prototype.performFade=function(e,t){var n=this;if(0===e)throw new Error("Rate cannot be 0.");this._fadeEndTimer&&window.clearTimeout(this._fadeEndTimer);var r=this._context.currentTime,i=this._gain;if(e===1/0||e===-1/0){i.gain.cancelScheduledValues(r);var o=e===1/0?1:0;i.gain.setValueAtTime(o,r),this._currentFade={startTime:r,startValue:o,rate:0},this._fadeEndTimer=null,t&&t()}else{var a=this._currentFade,s=function(e,t,n){return Math.min(t,Math.max(e,n))}(0,1,a.startValue+1e3*a.rate*(r-a.startTime)),l=e>0?1-s:s,u=l*(1/Math.abs(1e3*e)),c=r+u;this._currentFade={startTime:r,rate:e,startValue:s},i.gain.cancelScheduledValues(r),i.gain.setValueAtTime(s,r),i.gain.linearRampToValueAtTime(e>0?1:0,c),this._fadeEndTimer=window.setTimeout(function(){n._fadeEndTimer=null,t&&t()},1e3*u)}},e}();t.FadeManager=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819;var r=n(11);t.HTML5PlayerBase=r.HTML5PlayerBase;var i=n(14);t.HTML5Player=i.HTML5Player;var o=n(13);t.errors=o.errors;var a=n(12);t.helpers=a.helpers;var s=n(4);t.WebAudioContext=s.WebAudioContext}])}(n(2))},function(e,t,n){window,e.exports=function(e,t,n,r,i,o){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t,n){"use strict";function r(e){return e.match(h)[0]}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),a=n(4),s=n(3),l=n(2),u=n(1),c=n(0),h=/^[^\?#]*/,d=function(e){function t(t){var n=e.call(this)||this;return n._mediaElementManager=t,n.name="MaestroHLSMSE",n}return i(t,e),t.prototype.isRenditionSupported=function(e){return-1!==["hls","encrypted-hls"].indexOf(e.scProtocol)&&c.HLSMSEPlayer.isFormatSupported(e.maestroSegmentFormat||{})},t.prototype.buildPlayer=function(e){return new f(e,this._mediaElementManager)},t}(o.BaseController);t.HLSMSEPlayerController=d;var f=function(){function e(e,t){var n=this;this._config=e,this._mediaElementManager=t,this._urlRefreshRetrieveHandle=null;var i=e.logger,o=e.playerId,l=e.urlAndRendition,u=e.streamUrlExpires,h=e.reportError,d=e.fadeOnPauseAndPlay,f=e.fadeOnSeek,p=e.releaseControl,m=e.getNewUrl;this._currentUrl=l.url;var g=l.rendition.maestroSegmentFormat||{},_=this._buildPlaylist(l.url),v=this._player=new c.HLSMSEPlayer({playlist:_,segmentFormat:g},{name:o,mediaElement:null,fadeSupportEnabled:d||f,defaultFadeDuration:d?void 0:0,defaultSeekFadeInDuration:f?void 0:0,defaultSeekFadeOutDuration:f?void 0:0,logger:i,registerListeners:function(e){var t=e.onError,o=e.onChange;t.subscribe(function(e){if(u){if(e instanceof s.errors.URLUpdateError)return i.error("URL refresh failed for some reason.",e),void p({retry:!0});if(n._isErrorWhichShouldTriggerURLRefresh(e)){if(n._urlRefreshRetrieveHandle)return void i.debug("Got a 403 status code, but URL refresh already in progress.");i.info("Got a 403 status code. Peforming a URL refresh...");var t=n._urlRefreshRetrieveHandle=m();return void t.whenComplete().then(function(e){n._urlRefreshRetrieveHandle=null,e?r(e)!==r(n._currentUrl)?(i.warn("Got a new URL but the rendition did not match the original."),p({retry:!1})):(n._currentUrl=e,i.info("Got a new URL. Updating..."),v.switchPlaylist(n._buildPlaylist(e))):(i.warn("Could not get a new URL."),p({retry:!1}))}).catch(function(e){i.error("Unexpected error when trying to retrieve a new URL.",e),p({retry:!1})})}}h(e.getCode()),a.HTML5PlayerController.errorQualifiesAbort(e)&&p({retry:!1})}),o.subscribe(function(e){var t=e.dead;t&&(n._urlRefreshRetrieveHandle&&(n._urlRefreshRetrieveHandle.abort(),n._urlRefreshRetrieveHandle=null),p({retry:!1}))})}});this._mediaElementManager.registerPlayer(v,function(){return p({retry:!1})})}return e.prototype.getPlayer=function(){return this._player},e.prototype.getUrl=function(){return this._currentUrl},e.prototype._buildPlaylist=function(e){var t=new l.ArrayBufferLoader({fetchEnabled:this._config.fetchEnabled});return new u.PlaylistHLS({url:e,playlistLoader:l.stringLoader,segmentLoader:t,keyLoader:t,segmentFormat:this._config.urlAndRendition.rendition.maestroSegmentFormat||{},logger:this._config.logger})},e.prototype._isErrorWhichShouldTriggerURLRefresh=function(e){if(e instanceof c.errors.RetrievalError){var t=e.getCause();if(t instanceof c.retrievalErrors.UnacceptableResponseStatusCodeError)return 403===t.getStatusCode()}return!1},e}();t.ControlledPlayer=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="23.1.0",t.buildNumber=845;var r=n(6);t.HLSMSEPlayerController=r.HLSMSEPlayerController;var i=n(0);t.HLSMSEPlayer=i.HLSMSEPlayer}])}(n(6),n(10),n(11),n(2),n(3),n(1))},function(e,t,n){window,e.exports=function(e,t,n){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}([function(t,n){t.exports=e},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.PLAYLIST_UPDATE_ERROR"},t}(i.errors.PlayerFatalError);t.PlaylistUpdateError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return e.call(this,"A transmuxer could not be found.")||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.NO_TRANSMUXER_ERROR"},t}(i.errors.NotSupportedError);t.NoTransmuxerError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t){var n=e.call(this,"An error occurred when trying to retrieve a playlist/segment/key.",t)||this;return n._internalRetrievalError=t,n}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.RETRIEVAL_ERROR."+this._internalRetrievalError.getCode()},t}(i.errors.PlayerError);t.RetrievalError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t){return e.call(this,"An error occurred trying to initialize the buffer.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.INITIALIZE_ERROR"},t}(i.errors.PlayerFatalError);t.InitializeError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t){return e.call(this,"An error occurred trying to append to the buffer.",t)||this}return r(t,e),t.prototype.getCode=function(){return"HLS_MSE_PLAYER.APPEND_ERROR"},t}(i.errors.PlayerError);t.AppendError=o},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(4),o=n(1),a=n(2),s=n(3);!function(e){e.AppendError=r.AppendError,e.InitializeError=i.InitializeError,e.PlaylistUpdateError=o.PlaylistUpdateError,e.NoTransmuxerError=a.NoTransmuxerError,e.RetrievalError=s.RetrievalError}(t.errors||(t.errors={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=r.eventDispatcher.EventDispatcher,o=r.logger.prefixLogger,a=r.logger.noOpLogger,s=function(){function e(e,t,n,r,s){void 0===s&&(s=a);var l=this;this._onAppendQueued=new i,this._onAppendEnd=new i,this._needsInitData=!0,this._updateTimerId=null,this._gcTimerId=null,this._waitingForData=!1,this._started=!1,this._error=null,this._currentRetrieveHandle=null,this._logger=o(s,"SimpleMSE"),this.onAppendQueued=this._onAppendQueued.getHandle(),this.onAppendEnd=this._onAppendEnd.getHandle(),this._mse=e,this._getNextSegmentData=t,this._getPosition=n,this._onError=r,e.whenInitialized().then(function(){!l._error&&l._started&&(l._logger.debug("MSE initialized. Preparing to update."),l._prepareUpdate())}).catch(function(e){l._error||(l._logger.error("Error when waiting for MSE to initialize.",e),l._handleError(e||new Error("Error waiting for MSE to initialize.")))})}return e.prototype.start=function(){if(this._checkNotErrored(),this._started)throw new Error("Already started.");this._logger.debug("start() called."),this._scheduleGC(),this._started=!0,this._prepareUpdate()},e.prototype.kill=function(){this._error||(this._logger.debug("kill() called."),this._error=new Error("Killed."),this._clearTimers(),this._logger.debug("Killed."))},e.prototype.waitingForSegmentData=function(){return this._checkNotErrored(),this._waitingForData},e.prototype.provideNextSegmentData=function(e){if(this._checkNotErrored(),!this._waitingForData)throw new Error("Not waiting for data.");this._logger.debug("Segment data provided."),this._waitingForData=!1,this._update(e)},e.prototype._prepareUpdate=function(){if(!this._updateTimerId){var e=this._mse;if(e.hasInitialized()){var t=r.TimeRange.getCoverage(e.getBuffered());if(t.end<=this._getPosition()+15e3){this._logger.debug("Requesting next segment data.");var n=this._getNextSegmentData();n?(this._logger.debug("Got segment data."),this._update(n)):(this._logger.debug("Did not get any data."),this._waitingForData=!0)}else this._scheduleUpdate()}}},e.prototype._gc=function(){var e=this,t=this._mse;if(t.hasInitialized()){var n=r.TimeRange.getCoverage(t.getBuffered()),i=this._getPosition()-5e3;if(n.start<i){var o=new r.TimeRange(n.start,i-n.start);this._logger.debug("Removing media that has been played.",o),t.remove(o).then(function(){e._logger.debug("Removed media that has been played.",o),e._error||e._scheduleGC()}).catch(function(t){e._logger.error("Error when attempting to remove media that has been played.",o,t),e._error||e._scheduleGC()})}else this._scheduleGC()}else this._scheduleGC()},e.prototype._update=function(e){var t=this,n=e.data,i=e.eventRepresentation,o=this._mse;this._onAppendQueued.dispatch({segment:i}),this._logger.debug("Appending...",i);var a=[],s=!1,l=!1,u=!1,c=this._currentRetrieveHandle=n.run(),h=function e(){if(!s&&!t._error){var n=a.shift();n&&!n.byteLength?(t._logger.warn("Got 0 bytes to append. Skipping..."),e()):n?(s=!0,t._logger.debug("Appending part...",i,n.byteLength),o.append(n).then(function(){s=!1,l=!0,e()}).catch(function(e){t._error||(t._logger.error("Error updating MSE.",e,i),t._handleError(e||new Error("Error updating MSE.")))})):u&&(t._logger.debug("Append finished.",i),l||t._logger.warn("There was nothing to append."),t._currentRetrieveHandle=null,t._onAppendEnd.dispatch({segment:i}),t._prepareUpdate())}};c.onProgressUpdate(function(e){var n;n=t._needsInitData&&e.initData?r.helpers.arrayBuffer.combine([e.initData,e.data]):e.data,t._needsInitData=!1,a.push(n),h()}),c.onError(function(e){t._error||(t._logger.error("Error whilst retrieving data.",e,i),t._handleError(e||new Error("Error retrieving data for MSE.")))}),c.onCompletion(function(){t._logger.debug("Got all data for append.",i),u=!0,h()})},e.prototype._scheduleUpdate=function(){var e=this;this._updateTimerId=window.setTimeout(function(){e._updateTimerId=null,e._prepareUpdate()},500)},e.prototype._scheduleGC=function(){var e=this;this._gcTimerId||(this._gcTimerId=window.setTimeout(function(){e._gcTimerId=null,e._gc()},2e4))},e.prototype._checkNotErrored=function(){if(this._error)throw this._error},e.prototype._clearTimers=function(){this._updateTimerId&&(this._logger.debug("Clearing update timer."),window.clearTimeout(this._updateTimerId),this._updateTimerId=null),this._gcTimerId&&(window.clearTimeout(this._gcTimerId),this._gcTimerId=null),this._currentRetrieveHandle&&(this._currentRetrieveHandle.abort(),this._currentRetrieveHandle=null)},e.prototype._handleError=function(e){this._error||(this._error=e,this._logger.error("Error occurred.",e),this._clearTimers(),this._onError(e))},e}();t.SimpleMSE=s},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){(function(e){var n,r=function(e){"use strict";function t(e,n){return"undefined"==typeof e?t[0]:"undefined"!=typeof n?10===+n?V(e):Z(e,n):V(e)}function n(e,t){this.value=e,this.sign=t,this.isSmall=!1}function i(e){this.value=e,this.sign=e<0,this.isSmall=!0}function o(e){return-j<e&&e<j}function a(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function s(e){l(e);var t=e.length;if(t<4&&M(e,H)<0)switch(t){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*G;default:return e[0]+(e[1]+e[2]*G)*G}return e}function l(e){for(var t=e.length;0===e[--t];);e.length=t+1}function u(e){for(var t=new Array(e),n=-1;++n<e;)t[n]=0;return t}function c(e){return e>0?Math.floor(e):Math.ceil(e)}function h(e,t){var n,r,i=e.length,o=t.length,a=new Array(i),s=0,l=G;for(r=0;r<o;r++)n=e[r]+t[r]+s,s=n>=l?1:0,a[r]=n-s*l;for(;r<i;)n=e[r]+s,s=n===l?1:0,a[r++]=n-s*l;return s>0&&a.push(s),a}function d(e,t){return e.length>=t.length?h(e,t):h(t,e)}function f(e,t){var n,r,i=e.length,o=new Array(i),a=G;for(r=0;r<i;r++)n=e[r]-a+t,t=Math.floor(n/a),o[r]=n-t*a,t+=1;for(;t>0;)o[r++]=t%a,t=Math.floor(t/a);return o}function p(e,t){var n,r,i=e.length,o=t.length,a=new Array(i),s=0,u=G;for(n=0;n<o;n++)(r=e[n]-s-t[n])<0?(r+=u,s=1):s=0,a[n]=r;for(n=o;n<i;n++){if(!((r=e[n]-s)<0)){a[n++]=r;break}r+=u,a[n]=r}for(;n<i;n++)a[n]=e[n];return l(a),a}function m(e,t,r){var o;return M(e,t)>=0?o=p(e,t):(o=p(t,e),r=!r),"number"==typeof(o=s(o))?(r&&(o=-o),new i(o)):new n(o,r)}function g(e,t,r){var o,a,l=e.length,u=new Array(l),c=-t,h=G;for(o=0;o<l;o++)a=e[o]+c,c=Math.floor(a/h),a%=h,u[o]=a<0?a+h:a;return"number"==typeof(u=s(u))?(r&&(u=-u),new i(u)):new n(u,r)}function _(e,t){var n,r,i,o,a,s=e.length,c=t.length,h=s+c,d=u(h),f=G;for(i=0;i<s;++i){o=e[i];for(var p=0;p<c;++p)a=t[p],n=o*a+d[i+p],r=Math.floor(n/f),d[i+p]=n-r*f,d[i+p+1]+=r}return l(d),d}function v(e,t){var n,r,i=e.length,o=new Array(i),a=G,s=0;for(r=0;r<i;r++)n=e[r]*t+s,s=Math.floor(n/a),o[r]=n-s*a;for(;s>0;)o[r++]=s%a,s=Math.floor(s/a);return o}function y(e,t){for(var n=[];t-- >0;)n.push(0);return n.concat(e)}function b(e,t){var n=Math.max(e.length,t.length);if(n<=30)return _(e,t);n=Math.ceil(n/2);var r=e.slice(n),i=e.slice(0,n),o=t.slice(n),a=t.slice(0,n),s=b(i,a),u=b(r,o),c=b(d(i,r),d(a,o)),h=d(d(s,y(p(p(c,s),u),n)),y(u,2*n));return l(h),h}function E(e,t,r){return new n(e<G?v(t,e):_(t,a(e)),r)}function x(e){var t,n,r,i,o,a=e.length,s=u(a+a),c=G;for(r=0;r<a;r++){i=e[r],n=0-i*i;for(var h=r;h<a;h++)o=e[h],t=i*o*2+s[r+h]+n,n=Math.floor(t/c),s[r+h]=t-n*c;s[r+a]=n}return l(s),s}function T(e,t){var n,r,i,o,a,l,c,h=e.length,d=t.length,f=G,p=u(t.length),m=t[d-1],g=Math.ceil(f/(2*m)),_=v(e,g),y=v(t,g);for(_.length<=h&&_.push(0),y.push(0),m=y[d-1],r=h-d;r>=0;r--){for(n=f-1,_[r+d]!==m&&(n=Math.floor((_[r+d]*f+_[r+d-1])/m)),i=0,o=0,l=y.length,a=0;a<l;a++)i+=n*y[a],c=Math.floor(i/f),o+=_[r+a]-(i-c*f),i=c,o<0?(_[r+a]=o+f,o=-1):(_[r+a]=o,o=0);for(;0!==o;){for(n-=1,i=0,a=0;a<l;a++)(i+=_[r+a]-f+y[a])<0?(_[r+a]=i+f,i=0):(_[r+a]=i,i=1);o+=i}p[r]=n}return _=A(_,g)[0],[s(p),s(_)]}function S(e,t){for(var n,r,i,o,a,u=e.length,c=t.length,h=[],d=[],f=G;u;)if(d.unshift(e[--u]),l(d),M(d,t)<0)h.push(0);else{r=d.length,i=d[r-1]*f+d[r-2],o=t[c-1]*f+t[c-2],r>c&&(i=(i+1)*f),n=Math.ceil(i/o);do{if(M(a=v(t,n),d)<=0)break;n--}while(n);h.push(n),d=p(d,a)}return h.reverse(),[s(h),s(d)]}function A(e,t){var n,r,i,o,a=e.length,s=u(a),l=G;for(i=0,n=a-1;n>=0;--n)o=i*l+e[n],r=c(o/t),i=o-r*t,s[n]=0|r;return[s,0|i]}function P(e,r){var o,l,u=V(r),h=e.value,d=u.value;if(0===d)throw new Error("Cannot divide by zero");if(e.isSmall)return u.isSmall?[new i(c(h/d)),new i(h%d)]:[t[0],e];if(u.isSmall){if(1===d)return[e,t[0]];if(-1==d)return[e.negate(),t[0]];var f=Math.abs(d);if(f<G){o=A(h,f),l=s(o[0]);var p=o[1];return e.sign&&(p=-p),"number"==typeof l?(e.sign!==u.sign&&(l=-l),[new i(l),new i(p)]):[new n(l,e.sign!==u.sign),new i(p)]}d=a(f)}var m=M(h,d);if(-1===m)return[t[0],e];if(0===m)return[t[e.sign===u.sign?1:-1],t[0]];o=h.length+d.length<=200?T(h,d):S(h,d),l=o[0];var g=e.sign!==u.sign,_=o[1],v=e.sign;return"number"==typeof l?(g&&(l=-l),l=new i(l)):l=new n(l,g),"number"==typeof _?(v&&(_=-_),_=new i(_)):_=new n(_,v),[l,_]}function M(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var n=e.length-1;n>=0;n--)if(e[n]!==t[n])return e[n]>t[n]?1:-1;return 0}function R(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(25)||void 0))}function C(e){return("number"==typeof e||"string"==typeof e)&&+Math.abs(e)<=G||e instanceof n&&e.value.length<=1}function w(e,t,n){t=V(t);for(var i=e.isNegative(),o=t.isNegative(),a=i?e.not():e,s=o?t.not():t,l=0,u=0,c=null,h=null,d=[];!a.isZero()||!s.isZero();)c=P(a,K),l=c[1].toJSNumber(),i&&(l=K-1-l),h=P(s,K),u=h[1].toJSNumber(),o&&(u=K-1-u),a=c[0],s=h[0],d.push(n(l,u));for(var f=r(0!==n(i?1:0,o?1:0)?-1:0),p=d.length-1;p>=0;p-=1)f=f.multiply(K).add(r(d[p]));return f}function O(e){var t=e.value,n="number"==typeof t?t|q:t[0]+t[1]*G|Q;return n&-n}function I(e,t){return e=V(e),t=V(t),e.greater(t)?e:t}function D(e,t){return e=V(e),t=V(t),e.lesser(t)?e:t}function L(e,n){if(e=V(e).abs(),n=V(n).abs(),e.equals(n))return e;if(e.isZero())return n;if(n.isZero())return e;for(var r,i,o=t[1];e.isEven()&&n.isEven();)r=Math.min(O(e),O(n)),e=e.divide(r),n=n.divide(r),o=o.multiply(r);for(;e.isEven();)e=e.divide(O(e));do{for(;n.isEven();)n=n.divide(O(n));e.greater(n)&&(i=n,n=e,e=i),n=n.subtract(e)}while(!n.isZero());return o.isUnit()?e:e.multiply(o)}function F(e,n,r){var i,o=t[0],a=t[1];for(i=e.length-1;i>=0;i--)o=o.add(e[i].times(a)),a=a.times(n);return r?o.negate():o}function N(e){return e<=35?"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e):"<"+e+">"}function B(e,t){if((t=r(t)).isZero()){if(e.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(e.isZero())return{value:[0],isNegative:!1};if(e.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-e)).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var n=Array.apply(null,Array(+e-1)).map(Array.prototype.valueOf,[0,1]);return n.unshift([1]),{value:[].concat.apply([],n),isNegative:!1}}var i=!1;if(e.isNegative()&&t.isPositive()&&(i=!0,e=e.abs()),t.equals(1))return e.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(+e)).map(Number.prototype.valueOf,1),isNegative:i};for(var o,a=[],s=e;s.isNegative()||s.compareAbs(t)>=0;){o=s.divmod(t),s=o.quotient;var l=o.remainder;l.isNegative()&&(l=t.minus(l).abs(),s=s.next()),a.push(l.toJSNumber())}return a.push(s.toJSNumber()),{value:a.reverse(),isNegative:i}}function U(e,t){var n=B(e,t);return(n.isNegative?"-":"")+n.value.map(N).join("")}function k(e){if(o(+e)){var t=+e;if(t===c(t))return new i(t);throw new Error("Invalid integer: "+e)}var r="-"===e[0];r&&(e=e.slice(1));var a=e.split(/e/i);if(a.length>2)throw new Error("Invalid integer: "+a.join("e"));if(2===a.length){var s=a[1];if("+"===s[0]&&(s=s.slice(1)),(s=+s)!==c(s)||!o(s))throw new Error("Invalid integer: "+s+" is not a valid exponent.");var u=a[0],h=u.indexOf(".");if(h>=0&&(s-=u.length-h-1,u=u.slice(0,h)+u.slice(h+1)),s<0)throw new Error("Cannot include negative exponent part for integers");u+=new Array(s+1).join("0"),e=u}var d=/^([0-9][0-9]*)$/.test(e);if(!d)throw new Error("Invalid integer: "+e);for(var f=[],p=e.length,m=z,g=p-m;p>0;)f.push(+e.slice(g,p)),(g-=m)<0&&(g=0),p-=m;return l(f),new n(f,r)}function V(e){return"number"==typeof e?function(e){if(o(e)){if(e!==c(e))throw new Error(e+" is not an integer.");return new i(e)}return k(e.toString())}(e):"string"==typeof e?k(e):e}var G=1e7,z=7,j=9007199254740992,H=a(j),W=Math.log(j);n.prototype=Object.create(t.prototype),i.prototype=Object.create(t.prototype),n.prototype.add=function(e){var t=V(e);if(this.sign!==t.sign)return this.subtract(t.negate());var r=this.value,i=t.value;return t.isSmall?new n(f(r,Math.abs(i)),this.sign):new n(d(r,i),this.sign)},n.prototype.plus=n.prototype.add,i.prototype.add=function(e){var t=V(e),r=this.value;if(r<0!==t.sign)return this.subtract(t.negate());var s=t.value;if(t.isSmall){if(o(r+s))return new i(r+s);s=a(Math.abs(s))}return new n(f(s,Math.abs(r)),r<0)},i.prototype.plus=i.prototype.add,n.prototype.subtract=function(e){var t=V(e);if(this.sign!==t.sign)return this.add(t.negate());var n=this.value,r=t.value;return t.isSmall?g(n,Math.abs(r),this.sign):m(n,r,this.sign)},n.prototype.minus=n.prototype.subtract,i.prototype.subtract=function(e){var t=V(e),n=this.value;if(n<0!==t.sign)return this.add(t.negate());var r=t.value;return t.isSmall?new i(n-r):g(r,Math.abs(n),n>=0)},i.prototype.minus=i.prototype.subtract,n.prototype.negate=function(){return new n(this.value,!this.sign)},i.prototype.negate=function(){var e=this.sign,t=new i(-this.value);return t.sign=!e,t},n.prototype.abs=function(){return new n(this.value,!1)},i.prototype.abs=function(){return new i(Math.abs(this.value))},n.prototype.multiply=function(e){var r,i=V(e),o=this.value,s=i.value,l=this.sign!==i.sign;if(i.isSmall){if(0===s)return t[0];if(1===s)return this;if(-1===s)return this.negate();if((r=Math.abs(s))<G)return new n(v(o,r),l);s=a(r)}return function(e,t){return-.012*e-.012*t+15e-6*e*t>0}(o.length,s.length)?new n(b(o,s),l):new n(_(o,s),l)},n.prototype.times=n.prototype.multiply,i.prototype._multiplyBySmall=function(e){return o(e.value*this.value)?new i(e.value*this.value):E(Math.abs(e.value),a(Math.abs(this.value)),this.sign!==e.sign)},n.prototype._multiplyBySmall=function(e){return 0===e.value?t[0]:1===e.value?this:-1===e.value?this.negate():E(Math.abs(e.value),this.value,this.sign!==e.sign)},i.prototype.multiply=function(e){return V(e)._multiplyBySmall(this)},i.prototype.times=i.prototype.multiply,n.prototype.square=function(){return new n(x(this.value),!1)},i.prototype.square=function(){var e=this.value*this.value;return o(e)?new i(e):new n(x(a(Math.abs(this.value))),!1)},n.prototype.divmod=function(e){var t=P(this,e);return{quotient:t[0],remainder:t[1]}},i.prototype.divmod=n.prototype.divmod,n.prototype.divide=function(e){return P(this,e)[0]},i.prototype.over=i.prototype.divide=n.prototype.over=n.prototype.divide,n.prototype.mod=function(e){return P(this,e)[1]},i.prototype.remainder=i.prototype.mod=n.prototype.remainder=n.prototype.mod,n.prototype.pow=function(e){var n,r,a,s=V(e),l=this.value,u=s.value;if(0===u)return t[1];if(0===l)return t[0];if(1===l)return t[1];if(-1===l)return s.isEven()?t[1]:t[-1];if(s.sign)return t[0];if(!s.isSmall)throw new Error("The exponent "+s.toString()+" is too large.");if(this.isSmall&&o(n=Math.pow(l,u)))return new i(c(n));for(r=this,a=t[1];!0&u&&(a=a.times(r),--u),0!==u;)u/=2,r=r.square();return a},i.prototype.pow=n.prototype.pow,n.prototype.modPow=function(e,n){if(e=V(e),(n=V(n)).isZero())throw new Error("Cannot take modPow with modulus 0");for(var r=t[1],i=this.mod(n);e.isPositive();){if(i.isZero())return t[0];e.isOdd()&&(r=r.multiply(i).mod(n)),e=e.divide(2),i=i.square().mod(n)}return r},i.prototype.modPow=n.prototype.modPow,n.prototype.compareAbs=function(e){var t=V(e),n=this.value,r=t.value;return t.isSmall?1:M(n,r)},i.prototype.compareAbs=function(e){var t=V(e),n=Math.abs(this.value),r=t.value;return t.isSmall?(r=Math.abs(r),n===r?0:n>r?1:-1):-1},n.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=V(e),n=this.value,r=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:M(n,r)*(this.sign?-1:1)},n.prototype.compareTo=n.prototype.compare,i.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=V(e),n=this.value,r=t.value;return t.isSmall?n==r?0:n>r?1:-1:n<0!==t.sign?n<0?-1:1:n<0?1:-1},i.prototype.compareTo=i.prototype.compare,n.prototype.equals=function(e){return 0===this.compare(e)},i.prototype.eq=i.prototype.equals=n.prototype.eq=n.prototype.equals,n.prototype.notEquals=function(e){return 0!==this.compare(e)},i.prototype.neq=i.prototype.notEquals=n.prototype.neq=n.prototype.notEquals,n.prototype.greater=function(e){return this.compare(e)>0},i.prototype.gt=i.prototype.greater=n.prototype.gt=n.prototype.greater,n.prototype.lesser=function(e){return this.compare(e)<0},i.prototype.lt=i.prototype.lesser=n.prototype.lt=n.prototype.lesser,n.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},i.prototype.geq=i.prototype.greaterOrEquals=n.prototype.geq=n.prototype.greaterOrEquals,n.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},i.prototype.leq=i.prototype.lesserOrEquals=n.prototype.leq=n.prototype.lesserOrEquals,n.prototype.isEven=function(){return 0===(1&this.value[0])},i.prototype.isEven=function(){return 0===(1&this.value)},n.prototype.isOdd=function(){return 1===(1&this.value[0])},i.prototype.isOdd=function(){return 1===(1&this.value)},n.prototype.isPositive=function(){return!this.sign},i.prototype.isPositive=function(){return this.value>0},n.prototype.isNegative=function(){return this.sign},i.prototype.isNegative=function(){return this.value<0},n.prototype.isUnit=function(){return!1},i.prototype.isUnit=function(){return 1===Math.abs(this.value)},n.prototype.isZero=function(){return!1},i.prototype.isZero=function(){return 0===this.value},n.prototype.isDivisibleBy=function(e){var n=V(e),r=n.value;return 0!==r&&(1===r||(2===r?this.isEven():this.mod(n).equals(t[0])))},i.prototype.isDivisibleBy=n.prototype.isDivisibleBy,n.prototype.isPrime=function(){var n=R(this);if(n!==e)return n;for(var i,o,a,s,l=this.abs(),u=l.prev(),c=[2,3,5,7,11,13,17,19],h=u;h.isEven();)h=h.divide(2);for(a=0;a<c.length;a++)if(!(s=r(c[a]).modPow(h,l)).equals(t[1])&&!s.equals(u)){for(o=!0,i=h;o&&i.lesser(u);i=i.multiply(2))(s=s.square().mod(l)).equals(u)&&(o=!1);if(o)return!1}return!0},i.prototype.isPrime=n.prototype.isPrime,n.prototype.isProbablePrime=function(t){var n=R(this);if(n!==e)return n;for(var i=this.abs(),o=t===e?5:t,a=0;a<o;a++){var s=r.randBetween(2,i.minus(2));if(!s.modPow(i.prev(),i).isUnit())return!1}return!0},i.prototype.isProbablePrime=n.prototype.isProbablePrime,n.prototype.modInv=function(e){for(var t,n,i,o=r.zero,a=r.one,s=V(e),l=this.abs();!l.equals(r.zero);)t=s.divide(l),n=o,i=s,o=a,s=l,a=n.subtract(t.multiply(a)),l=i.subtract(t.multiply(l));if(!s.equals(1))throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===o.compare(0)&&(o=o.add(e)),this.isNegative()?o.negate():o},i.prototype.modInv=n.prototype.modInv,n.prototype.next=function(){var e=this.value;return this.sign?g(e,1,this.sign):new n(f(e,1),this.sign)},i.prototype.next=function(){var e=this.value;return e+1<j?new i(e+1):new n(H,!1)},n.prototype.prev=function(){var e=this.value;return this.sign?new n(f(e,1),!0):g(e,1,this.sign)},i.prototype.prev=function(){var e=this.value;return e-1>-j?new i(e-1):new n(H,!0)};for(var X=[1];2*X[X.length-1]<=G;)X.push(2*X[X.length-1]);var Y=X.length,K=X[Y-1];n.prototype.shiftLeft=function(e){if(!C(e))throw new Error(String(e)+" is too large for shifting.");if((e=+e)<0)return this.shiftRight(-e);var t=this;if(t.isZero())return t;for(;e>=Y;)t=t.multiply(K),e-=Y-1;return t.multiply(X[e])},i.prototype.shiftLeft=n.prototype.shiftLeft,n.prototype.shiftRight=function(e){var t;if(!C(e))throw new Error(String(e)+" is too large for shifting.");if((e=+e)<0)return this.shiftLeft(-e);for(var n=this;e>=Y;){if(n.isZero()||n.isNegative()&&n.isUnit())return n;t=P(n,K),n=t[1].isNegative()?t[0].prev():t[0],e-=Y-1}return(t=P(n,X[e]))[1].isNegative()?t[0].prev():t[0]},i.prototype.shiftRight=n.prototype.shiftRight,n.prototype.not=function(){return this.negate().prev()},i.prototype.not=n.prototype.not,n.prototype.and=function(e){return w(this,e,function(e,t){return e&t})},i.prototype.and=n.prototype.and,n.prototype.or=function(e){return w(this,e,function(e,t){return e|t})},i.prototype.or=n.prototype.or,n.prototype.xor=function(e){return w(this,e,function(e,t){return e^t})},i.prototype.xor=n.prototype.xor;var q=1<<30,Q=(G&-G)*(G&-G)|q;n.prototype.bitLength=function(){var e=this;return e.compareTo(r(0))<0&&(e=e.negate().subtract(r(1))),0===e.compareTo(r(0))?r(0):r(function e(t,n){if(n.compareTo(t)<=0){var i=e(t,n.square(n)),o=i.p,a=i.e,s=o.multiply(n);return s.compareTo(t)<=0?{p:s,e:2*a+1}:{p:o,e:2*a}}return{p:r(1),e:0}}(e,r(2)).e).add(r(1))},i.prototype.bitLength=n.prototype.bitLength;var Z=function(e,t){for(var n=e.length,r=Math.abs(t),o=0;o<n;o++){var a=e[o].toLowerCase();if("-"!==a&&/[a-z0-9]/.test(a)){if(/[0-9]/.test(a)&&+a>=r){if("1"===a&&1===r)continue;throw new Error(a+" is not a valid digit in base "+t+".")}if(a.charCodeAt(0)-87>=r)throw new Error(a+" is not a valid digit in base "+t+".")}}if(2<=t&&t<=36&&n<=W/Math.log(t)){var s=parseInt(e,t);if(isNaN(s))throw new Error(a+" is not a valid digit in base "+t+".");return new i(parseInt(e,t))}t=V(t);var l=[],u="-"===e[0];for(o=u?1:0;o<e.length;o++){var a=e[o].toLowerCase(),c=a.charCodeAt(0);if(48<=c&&c<=57)l.push(V(a));else if(97<=c&&c<=122)l.push(V(a.charCodeAt(0)-87));else{if("<"!==a)throw new Error(a+" is not a valid character");var h=o;do{o++}while(">"!==e[o]);l.push(V(e.slice(h+1,o)))}}return F(l,t,u)};n.prototype.toArray=function(e){return B(this,e)},i.prototype.toArray=function(e){return B(this,e)},n.prototype.toString=function(t){if(t===e&&(t=10),10!==t)return U(this,t);for(var n,r=this.value,i=r.length,o=String(r[--i]);--i>=0;)n=String(r[i]),o+="0000000".slice(n.length)+n;var a=this.sign?"-":"";return a+o},i.prototype.toString=function(t){return t===e&&(t=10),10!=t?U(this,t):String(this.value)},n.prototype.toJSON=i.prototype.toJSON=function(){return this.toString()},n.prototype.valueOf=function(){return parseInt(this.toString(),10)},n.prototype.toJSNumber=n.prototype.valueOf,i.prototype.valueOf=function(){return this.value},i.prototype.toJSNumber=i.prototype.valueOf;for(var J=0;J<1e3;J++)t[J]=new i(J),J>0&&(t[-J]=new i(-J));return t.one=t[1],t.zero=t[0],t.minusOne=t[-1],t.max=I,t.min=D,t.gcd=L,t.lcm=function(e,t){return e=V(e).abs(),t=V(t).abs(),e.divide(L(e,t)).multiply(t)},t.isInstance=function(e){return e instanceof n||e instanceof i},t.randBetween=function(e,t){e=V(e),t=V(t);var r=D(e,t),o=I(e,t).subtract(r).add(1);if(o.isSmall)return r.add(Math.floor(Math.random()*o));for(var a=o.value.length-1,l=[],u=!0,h=a;h>=0;h--){var d=u?o.value[h]:G,f=c(Math.random()*d);l.unshift(f),f<d&&(u=!1)}return l=s(l),r.add("number"==typeof l?new i(l):new n(l,!1))},t.fromArray=function(e,t,n){return F(e.map(V),V(t||10),n)},t}();"undefined"!=typeof e&&e.hasOwnProperty("exports")&&(e.exports=r),void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}).call(this,n(10)(e))},function(e,t,n){"use strict";function r(e,t){for(var n=e.byteLength,r=0;r<n;){var i=e.getUint32(r);if(1===i)throw new Error("Large atom size not supported.");0===i&&(i=n-r);var o=e.getUint32(r+4);if(t(o,new DataView(e.buffer,e.byteOffset+r+a,i-a)))break;r+=i}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(11),a=8,s=1936286840,l=1836019558,u=1953653094,c=1952867444;t.clearMP4InternalTimestamp=function(e,t){void 0===t&&(t=!1);var n=function(e){r(e,function(e,t){return e===c&&(a(t),!0)})},a=function(e){var n,r=e.getUint8(0);t?n=o(0):(n=o(e.getUint32(4)),r>0&&(n=(n=n.shiftLeft(32)).add(e.getUint32(8))),null===d&&(d=n),n=n.subtract(d)),r>0?(e.setUint32(4,n.shiftRight(32).toJSNumber()),e.setUint32(8,n.and(65535).toJSNumber())):e.setUint32(4,n.toJSNumber())},h=i.helpers.arrayBuffer.combine([e]),d=null;return r(new DataView(h.buffer,h.byteOffset,h.byteLength),function(e,t){switch(e){case s:!function(e){var t=e.getUint8(0);e.setUint32(12,0),t>0&&e.setUint32(16,0)}(t);break;case l:!function(e){r(e,function(e,t){return e===u&&(n(t),!0)})}(t)}return!1}),h}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(6),o=n(12),a=r.helpers.deferred.buildDeferred,s=i.helpers.timeRanges.buildTimeRanges,l=r.helpers.Promise,u=r.logger.prefixLogger,c=r.logger.noOpLogger,h=r.helpers.browser.isIE(),d=r.helpers.browser.isSafari(),f='audio/mp4; codecs="mp3"',p=r.helpers.browser.getSafariVersion(),m=r.helpers.browser.getChromeVersion(),g=d||!!(m&&m.major<=49),_=!!p&&p.major<10||!!m&&m.major<=49;t.killedError=new Error("MSE killed.");var v=function(){function e(e,t){var n=this.constructor;if(void 0===t&&(t=c),this._sourceBuffer=null,this._initialized=!1,this._initializeDeferred=a(),this._whenIdleDeferred=a(),this._error=null,this._dead=!1,this._eosSignalled=!1,this._pendingActions=[],this._currentAction=null,this._logger=u(t,"MSE"),this._onMediaSourceInit=this._onMediaSourceInit.bind(this),this._onMediaSourceEnded=this._onMediaSourceEnded.bind(this),this._onMediaSourceError=this._onMediaSourceError.bind(this),this._onSourceBufferUpdateEnd=this._onSourceBufferUpdateEnd.bind(this),this._onSourceBufferError=this._onSourceBufferError.bind(this),!n.isSupported(e))throw this._logger.error("Not supported."),new Error("Not supported.");d&&e===f&&(e="audio/mp4"),this._type=e,this._useSegmentsMode=_&&0===e.indexOf("audio/mp4"),this._mediaSource=new MediaSource,this._mediaSource.addEventListener("sourceopen",this._onMediaSourceInit,!1),this._mediaSource.addEventListener("error",this._onMediaSourceError,!1),this._url=URL.createObjectURL(this._mediaSource),this._logger.debug("Created URL.",this._url)}return e.isSupported=function(e){return!h&&"MediaSource"in window&&(!e||!(!d||e!==f)||!(p&&p.major<10&&"audio/mpeg"===e)&&!(m&&m.major<50&&'audio/webm; codecs="opus"'===e)&&MediaSource.isTypeSupported(e))},e.prototype.whenInitialized=function(){return this._initializeDeferred.promise},e.prototype.whenIdle=function(){return this._whenIdleDeferred?this._whenIdleDeferred.promise:l.resolve(void 0)},e.prototype.isIdle=function(){return this._dead||!this._whenIdleDeferred},e.prototype.hasInitialized=function(){return this._initialized},e.prototype.getError=function(){return this._error},e.prototype.getUrl=function(){return this._ensureNotDead(),this._url},e.prototype.getBuffered=function(){if(this._ensureNotDead(),!this._sourceBuffer)return[];try{return s(this._sourceBuffer.buffered)}catch(t){if("InvalidStateError"===t.name&&"Failed to read the 'buffered' property from 'SourceBuffer': This SourceBuffer has been removed from the parent media source."===t.message)return[];throw t}},e.prototype.append=function(e){if(this._ensureNotDead(),this._ensureInitialized(),this._ensureNotEOS(),this._logger.debug("append() called."),g&&0===this._type.indexOf("audio/mp4")){this._logger.debug("Rewriting internal timestamp to 0.");try{e=o.clearMP4InternalTimestamp(e,!this._useSegmentsMode)}catch(e){return this._logger.error("Error rewriting timestamps.",e),this._handleError(e),l.reject(e)}}var t=a();return this._pendingActions.push({type:"append",data:e,deferred:t}),this._performNextAction(),t.promise},e.prototype.remove=function(e){if(0===e.duration)throw new Error("Remove range must have a duration > 0.");this._ensureNotDead(),this._ensureInitialized(),this._ensureNotEOS(),this._logger.debug("remove() called.",e);var t=a();return this._pendingActions.push({type:"remove",range:e,deferred:t}),this._performNextAction(),t.promise},e.prototype.signalEOS=function(){this._ensureNotDead(),this._ensureInitialized(),this._ensureNotEOS(),this._logger.debug("signalEOS() called."),this._eosSignalled=!0;var e=a();return this._pendingActions.push({type:"eos",deferred:e}),this._performNextAction(),e.promise},e.prototype.eosSignalled=function(){return this._eosSignalled},e.prototype.kill=function(){if(!this._dead){if(this._logger.debug("kill() called."),this._dead=!0,this._sourceBuffer){this._sourceBuffer.removeEventListener("updateend",this._onSourceBufferUpdateEnd,!1),this._sourceBuffer.removeEventListener("error",this._onSourceBufferError,!1);try{this._mediaSource.removeSourceBuffer(this._sourceBuffer)}catch(e){this._logger.error("Error from removeSourceBuffer()",e)}}this._mediaSource.removeEventListener("sourceopen",this._onMediaSourceInit,!1),this._mediaSource.removeEventListener("sourceended",this._onMediaSourceEnded,!1),this._mediaSource.removeEventListener("error",this._onMediaSourceError,!1),URL.revokeObjectURL(this._url);var e=this._error||t.killedError,n=this._currentAction?[this._currentAction]:[];(n=n.concat(this._pendingActions)).forEach(function(t){t.deferred.reject(e)}),this._whenIdleDeferred||(this._whenIdleDeferred=a()),this._whenIdleDeferred.reject(e),this._initialized||this._initializeDeferred.reject(e),this._pendingActions.length=0,this._logger.debug("Killed.")}},e.prototype._ensureInitialized=function(){if(!this._initialized)throw new Error("Not initialized yet.")},e.prototype._ensureNotEOS=function(){if(this._eosSignalled)throw new Error("EOS signalled.")},e.prototype._ensureNotDead=function(){if(this._dead)throw new Error("MSE is dead.")},e.prototype._onMediaSourceInit=function(){this._logger.debug("MSE initialized."),this._mediaSource.removeEventListener("sourceopen",this._onMediaSourceInit,!1);try{this._logger.debug("Creating source buffer.",this._type),this._sourceBuffer=this._mediaSource.addSourceBuffer(this._type),this._sourceBuffer.mode=this._useSegmentsMode?"segments":"sequence",this._logger.debug("Using append mode: "+this._sourceBuffer.mode),this._sourceBuffer.addEventListener("updateend",this._onSourceBufferUpdateEnd,!1),this._sourceBuffer.addEventListener("error",this._onSourceBufferError,!1)}catch(e){this._handleError(e)}this._initializeDeferred.resolve(void 0),this._whenIdleDeferred.resolve(void 0),this._initialized=!0,this._performNextAction()},e.prototype._onMediaSourceEnded=function(){this._onSourceBufferUpdateEnd()},e.prototype._onMediaSourceError=function(e){this._handleError(e)},e.prototype._handleError=function(e){this._ensureNotDead(),this._logger.error("Error occurred.",e),this._error=e||new Error("Unknown error."),this.kill()},e.prototype._onSourceBufferUpdateEnd=function(){var e=this._currentAction;return this._logger.debug("Update ended.",this.getBuffered()),e?(this._currentAction=null,e.deferred.resolve(void 0),void this._performNextAction()):void this._handleError(new Error("No action in progress."))},e.prototype._onSourceBufferError=function(e){this._handleError(e)},e.prototype._performNextAction=function(){var e=this._whenIdleDeferred;if(!this._currentAction&&this._sourceBuffer){var t=this._pendingActions.shift();if(!t)return this._logger.debug("No more actions."),void(e&&(this._whenIdleDeferred=null,e.resolve(void 0)));switch(e||(this._whenIdleDeferred=a()),this._currentAction=t,this._logger.debug("Performing next action..."),t.type){case"append":var n=r.TimeRange.getCoverage(this.getBuffered());try{if("segments"===this._sourceBuffer.mode){var i=n.end/1e3;this._logger.debug("Setting timestampOffset because detected safari.",i);try{this._sourceBuffer.timestampOffset=i}catch(e){if(11!==e.code)throw e;this._logger.debug("Failed to set timestampOffset.",e)}}this._logger.debug("Calling appendBuffer()."),this._sourceBuffer.appendBuffer(t.data)}catch(e){this._handleError(e)}break;case"remove":try{var o=t.range;this._logger.debug("Calling remove().",o.start,o.end),this._sourceBuffer.remove(o.start/1e3,o.end/1e3)}catch(e){this._handleError(e)}break;case"eos":try{this._logger.debug("Calling endOfStream()."),this._sourceBuffer.removeEventListener("updateend",this._onSourceBufferUpdateEnd,!1),this._mediaSource.addEventListener("sourceended",this._onMediaSourceEnded,!1),this._mediaSource.endOfStream()}catch(e){this._handleError(e)}}}},e}();t.MSE=v},function(e,t,n){"use strict";function r(e){if(e.hasEnded()){var t=e.getCompleteDuration();if(null===t)throw new Error("Expected playlist duration to be available.");return t}return 1/0}function i(e){var t=s.TransmuxerFactory.retrieveTransmuxers(e),n=g(t,function(t){var n=l.helpers.mimeType.buildMimeTypeFromFormat(t.getOutputFormat(),e);return!!n&&u.MSE.isSupported(n)})||null;if(!n)return null;var r=n.getOutputFormat(),i=l.helpers.mimeType.buildMimeTypeFromFormat(r,e);return i?{transmuxer:n,mimeType:i}:null}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),s=n(7),l=n(6),u=n(13),c=n(9),h=n(5),d=n(4),f=n(3),p=n(2),m=n(1),g=a.helpers.find,_=a.helpers.Promise,v=a.helpers.time.now,y=a.errors.PlayerFatalError,b=a.eventDispatcher.EventDispatcher,E=a.logger.prefixLogger,x=a.helpers.abortableJob.abortedError,T=a.helpers.browser.getSafariVersion(),S=a.helpers.browser.isSafari(),A=a.helpers.browser.isFirefox(),P=a.helpers.browser.isEdge(),M=function(e){function t(t,n){var r=e.call(this,n)||this;if(r._onSegmentRequestQueued=new b,r._onSegmentRequestStart=new b,r._onSegmentRetrieved=new b,r._onSegmentRequestFailed=new b,r._onSegmentReady=new b,r._onSegmentAppendQueued=new b,r._onSegmentAppendEnd=new b,r._playlist=null,r._playlistSegmentRetriever=null,r._playlistUpdateJob=null,r._initialPlaylistRetrieveCompleted=!1,r._playlistUpdateTimer=null,r._earliestAllowedNextUpdateTime=v(),r._mse=null,r._simpleMSE=null,r._html5PlayerReady=!1,r._startPositionOffset=0,r._transmuxerAndMimeType=null,r._lastSegmentAppended=null,r._maxBufferLength=null,r._cacheSize=null,r._onFirstSegmentRetrieved=null,r._firstSegmentOffset=0,r._seekAttemptTimer=null,r._seekMetadataEventHandle=null,r._playlistUpdateEventHandle=null,r._playlistDuration=null,r._logger=E(r._logger,"HLSMSEPlayer"),void 0!==n.maxBufferLength&&n.maxBufferLength<0)throw new Error("maxBufferLength cannot be < 0.");if(void 0!==n.memoryCacheSize&&n.memoryCacheSize<0)throw new Error("memoryCacheSize cannot be < 0.");return r.onSegmentRequestQueued=r._onSegmentRequestQueued.getHandle(),r.onSegmentRequestStart=r._onSegmentRequestStart.getHandle(),r.onSegmentRetrieved=r._onSegmentRetrieved.getHandle(),r.onSegmentRequestFailed=r._onSegmentRequestFailed.getHandle(),r.onSegmentReady=r._onSegmentReady.getHandle(),r.onSegmentAppendQueued=r._onSegmentAppendQueued.getHandle(),r.onSegmentAppendEnd=r._onSegmentAppendEnd.getHandle(),r.__descriptor=t,r.__playerDependencies=n,r._queuedPlaylist=t.playlist,r}return o(t,e),t.isFormatSupported=function(e){return!!u.MSE.isSupported()&&!!i(e)},t.prototype.getBufferedTimeRanges=function(){var e=this._playlistSegmentRetriever;return e?a.TimeRange.normalize(e.getSegmentsWithData().map(function(e){return e.segment.getTimeRange()})):[]},t.prototype.getCompleteBufferedTimeRanges=function(){var e=this._playlistSegmentRetriever;return e?a.TimeRange.normalize(e.getSegmentsWithData().filter(function(e){return e.complete}).map(function(e){return e.segment.getTimeRange()})):[]},t.prototype.getMaxBufferLength=function(){return this._maxBufferLength},t.prototype.getBufferController=function(){var e=this;return{setMaxBufferLength:function(t){if(t<0)throw new Error("Max buffer length cannot be < 0.");e._logger.debug("Updating max buffer length.",t),e._maxBufferLength=t,e._playlistSegmentRetriever?e._playlistSegmentRetriever.updateMaxBufferLength(t):e._logger.debug("Cannot update right now. Playlist segment retriever doesn't exist.")}}},t.prototype.switchPlaylist=function(e){return this._logger.debug("Updating playlist."),this._hasInitialized()?(this._playlistSegmentRetriever&&(this._playlistSegmentRetriever.switchPlaylist(null),this._logger.debug("Removed current URL.")),this._disposePlaylist(),void this._setPlaylist(e)):(this._logger.debug("Cannot update right now. Still initializing."),void(this._queuedPlaylist=e))},t.prototype.getMemoryCacheMaxSize=function(){return null!==this._cacheSize?this._cacheSize:1e8},t.prototype.getMemoryCacheUsage=function(){return this._playlistSegmentRetriever?this._playlistSegmentRetriever.getCacheUsage():0},t.prototype.getMemoryCacheController=function(){var e=this;return{setMaxCacheSize:function(t){if(t<0)throw new Error("Max size cannot be < 0.");e._cacheSize=t,e._playlistSegmentRetriever&&e._playlistSegmentRetriever.updateCacheSize(t)}}},t.prototype._canPlay=function(){if(!u.MSE.isSupported())return this._logger.debug("MSE not supported."),_.resolve(!1);var e=this.__descriptor.segmentFormat,t=i(e);return t?(this._transmuxerAndMimeType=t,_.resolve(!0)):(this._logger.debug("No transmuxer found."),_.resolve(new p.NoTransmuxerError))},t.prototype._getUrlForMediaElement=function(){if(!this._mse)throw new Error("MSE does not exist.");return this._mse.getUrl()},t.prototype._handleDurationUpdates=function(){},t.prototype._signalReady=function(){this._html5PlayerReady=!0,this._initialPlaylistRetrieveCompleted&&e.prototype._signalReady.call(this)},t.prototype._initialize=function(){var t=this.__playerDependencies;if(null===this._maxBufferLength&&(void 0!==t.maxBufferLength?this._maxBufferLength=t.maxBufferLength:this._maxBufferLength=3e4),this._logger.debug("Initialized max buffer length.",this._maxBufferLength),null===this._cacheSize&&(void 0!==t.memoryCacheSize?this._cacheSize=t.memoryCacheSize:this._cacheSize=1e8),this._logger.debug("Initialized cache size.",this._cacheSize),e.prototype._initialize.call(this),!this._queuedPlaylist)throw new Error("Playlist should exist.");this._setPlaylist(this._queuedPlaylist),this._queuedPlaylist=null},t.prototype._initMediaElement=function(t,n){this._simpleMSE&&(this._simpleMSE.kill(),this._simpleMSE=null,this._logger.debug("Killed SimpleMSE.")),this._mse&&(this._mse.kill(),this._mse=null,this._logger.debug("Killed MSE.")),null!==this._seekAttemptTimer&&(window.clearTimeout(this._seekAttemptTimer),this._seekAttemptTimer=null,this._logger.debug("Cancelled seek attempt timer.")),this._onFirstSegmentRetrieved=null,this._seekMetadataEventHandle&&(this._seekMetadataEventHandle.remove(),this._seekMetadataEventHandle=null),n?(this._initMSE(),e.prototype._initMediaElement.call(this,t,!0)):e.prototype._initMediaElement.call(this,t,!1)},t.prototype._shouldBeEnded=function(){var t=this._lastSegmentAppended;if(!t||!t.isFinalSegment())return!1;if(!S)return e.prototype._shouldBeEnded.call(this);if(e.prototype._shouldBeEnded.call(this))return!0;if(!this.getMediaElement())return!1;var n=this._duration;return this._stallDetected&&null!==n&&this._getTruePosition()>=n-600},t.prototype._getTruePosition=function(){var e=this.getMediaElement();if(!e)throw new Error("Media element should exist.");return this._startPositionOffset+this._getMediaElementPosition()},t.prototype._handleSeekChange=function(t,n){e.prototype._handleSeekChange.call(this,t,n),this._playlistSegmentRetriever&&(this._logger.debug("Explicitly updating playlist segment retriever, as seek requested."),this._playlistSegmentRetriever.update(),this._findSegmentAndAppendToMSE())},t.prototype._performSeek=function(t,n){var r=this,i=this._simpleMSE,o=this._mse,s=this.getMediaElement();if(!o)throw new Error("MSE should exist.");if(!s)throw new Error("Media element should exist.");var l=!this._isMediaElementPaused(s);null!==this._seekAttemptTimer&&(window.clearTimeout(this._seekAttemptTimer),this._seekAttemptTimer=null,this._logger.debug("Cancelled previous seek attempt timer.")),this._seekMetadataEventHandle&&(this._seekMetadataEventHandle.remove(),this._seekMetadataEventHandle=null,this._logger.debug("Removed previous loaded metadata event handler.")),i&&i.kill(),o.kill(),this._logger.debug("SimpleMSE and MSE destroyed."),this._startPositionOffset=t;var u=!1;this._onFirstSegmentRetrieved=function(){return u=!0},this._logger.debug("Initializing MSE and SimpleMSE for new position."),this._initMSE();var c=this._mse.getUrl();if(this._logger.debug("Updated media element MSE src.",c),e.prototype._initMediaElement.call(this,s,!0),l){this._logger.debug("Calling play() on media element as it was playing previously.");var h=this._callMediaElementPlay(s);h&&h.catch&&h.catch(function(e){"AbortError"!==e.name&&(r._logger.error("Unexpected play() error.",e),r._triggerError(new y("Exception from calling play() after seek.",e)))})}var d=function(e){(T&&T.major<11||A)&&e<50&&(r._logger.debug("Tweaking offset to fix glitch issue."),e=50);var t=function(){r._startPositionOffset=Math.max(0,r._startPositionOffset-e),r._logger.debug("Updated start position offset.",r._startPositionOffset,e);var t=function t(){r._seekAttemptTimer=null,r._logger.debug("Attempting to seek to the required offset.",e);var i=r._mse?r._mse.getBuffered():[];if(!a.TimeRange.rangesContainTime(e,i))return r._logger.debug("Holding seek because not buffered yet.",e,i),void(r._seekAttemptTimer=window.setTimeout(t,50));s.currentTime=e/1e3;var o=1e3*s.currentTime,l=o-e;Math.abs(l)<=100?(r._logger.debug("Seeked to the required offset.",e,o,l),n()):(r._logger.warn("Seek attempt failed. Trying again shortly.",e,o,l),r._seekAttemptTimer=window.setTimeout(t,50))};t()};r._onFirstSegmentRetrieved=null,P||s.readyState===s.HAVE_METADATA?(r._logger.debug("Media element has metadata. Seeking to offset."),t()):(r._logger.debug("Media element has not loaded metadata. Waiting for metadata..."),r._seekMetadataEventHandle=r._listenToOnce("loadedmetadata",function(){r._seekMetadataEventHandle=null,r._logger.debug("Got metadata. Seeking to offset."),t()},{earlyAttach:!0}))};u?(this._logger.debug("First segment already retrieved. Preparing to seek to initial offset."),d(this._firstSegmentOffset)):(this._logger.debug("Waiting for first segment to be retrieved."),this._onFirstSegmentRetrieved=function(){r._logger.debug("First segment retrieved. Preparing to seek to initial offset."),d(r._firstSegmentOffset)})},t.prototype._kill=function(){this._simpleMSE&&(this._logger.debug("Killing SimpleMSE."),this._simpleMSE.kill(),this._simpleMSE=null),this._mse&&(this._logger.debug("Killing MSE."),this._mse.kill(),this._mse=null),this._playlistSegmentRetriever&&(this._logger.debug("Killing playlist segment retriever."),this._playlistSegmentRetriever.kill(),this._playlistSegmentRetriever=null),this._disposePlaylist(),e.prototype._kill.call(this)},t.prototype._disposePlaylist=function(){this._playlistUpdateJob&&(this._logger.debug("Aborting playlist retrieve job."),this._playlistUpdateJob.abort(),this._playlistUpdateJob=null),this._playlistUpdateTimer&&(window.clearTimeout(this._playlistUpdateTimer),this._playlistUpdateTimer=null),this._playlistUpdateEventHandle&&(this._playlistUpdateEventHandle.remove(),this._playlistUpdateEventHandle=null),this._playlist=null},t.prototype._initMSE=function(){var e=this;if(!this._transmuxerAndMimeType)throw new Error("Transmuxer should have been configured.");this._lastSegmentAppended=null;var t=new u.MSE(this._transmuxerAndMimeType.mimeType,this._logger),n=new c.SimpleMSE(t,function(){return e._getSegmentDataToAppendNext()},function(){return e._getMediaElementPosition()},function(t){e._triggerError(new h.AppendError(t))},this._logger);n.onAppendQueued.subscribe(this._onSegmentAppendQueued.dispatch),n.onAppendEnd.subscribe(function(t){if(S){var n=e.getMediaElement();n&&e._isMediaElementPaused(n)&&e.isActuallyPlaying()&&(e._logger.debug("Calling play() on media element because we just appended something and should be playing."),e._callMediaElementPlay(n))}e._onSegmentAppendEnd.dispatch(t)}),this._simpleMSE=n,n.start(),this._mse=t,t.whenInitialized().catch(function(t){t!==u.killedError&&(e._logger.error("Error during mse initialization.",t),e._triggerError(new d.InitializeError(t)))})},t.prototype._getMediaElementPosition=function(){var e=this.getMediaElement();if(!e)throw new Error("No media element.");return 1e3*e.currentTime},t.prototype._whenPlaylistRetrieved=function(){var t=this,n=this._playlist;if(!n)throw new Error("Playlist should have been retrieved.");this._playlistUpdateEventHandle=n.onUpdated.subscribe(function(){t._updateLocalDurationsFromPlaylist(),t._handleDurationChange(),t._schedulePlaylistUpdate()});var i=!this._initialPlaylistRetrieveCompleted;if(i)this._initialPlaylistRetrieveCompleted=!0;else{var o=r(n);if(this._playlistDuration<o)return this._logger.error("The duration from the new playlist was less than the previous one."),void this._triggerError(new m.PlaylistUpdateError("The duration from the new playlist was less than the previous one.",{oldDuration:this._playlistDuration,newDuration:o}))}if(!this._transmuxerAndMimeType)throw new Error("Transmuxer should have been configured.");if(this._playlistSegmentRetriever)this._logger.debug("Switching playlist for playlist segment retriever."),this._playlistSegmentRetriever.switchPlaylist(n);else{var a=this._maxBufferLength;if(null===a)throw new Error("maxBufferLength should have been initiaized by now.");this._logger.debug("Creating playlist segment retriever.");var l=this._cacheSize;if(null===l)throw new Error("cacheSize should be set.");var u=new s.PlaylistSegmentRetriever({playlist:n,getPosition:function(){return t.getPosition()},maxBufferLength:a,cacheSize:l,transmuxer:this._transmuxerAndMimeType.transmuxer,logger:this._logger});u.onSegmentRequestQueued.subscribe(this._onSegmentRequestQueued.dispatch),u.onSegmentRequestStart.subscribe(this._onSegmentRequestStart.dispatch),u.onSegmentRetrieved.subscribe(this._onSegmentRetrieved.dispatch),u.onSegmentRequestFailed.subscribe(this._onSegmentRequestFailed.dispatch),this._playlistSegmentRetriever=u,u.onError.subscribe(function(e){t._logger.error("Error from playlist segment retriever.",e),e instanceof s.retrievalErrors.RetrievalError?t._triggerError(new f.RetrievalError(e)):t._triggerError(new y("Unexpected error when trying to retrieve segment.",e))}),u.onSegmentDataRetrieveStarted.subscribe(function(e){var n=e.segment;t._logger.debug("Segment retrieve started.",n.getEventRepresentation()),t._findSegmentAndAppendToMSE(),t._updateLocalDurationsFromPlaylist(),t._handleDurationChange(),t._onSegmentReady.dispatch({segment:n.getEventRepresentation()})})}this._initialPlaylistRetrieveCompleted=!0,n.hasEnded()||this._schedulePlaylistUpdate(),this._updateLocalDurationsFromPlaylist(),this._update(function(){i&&t._html5PlayerReady&&e.prototype._signalReady.call(t),t._handleDurationChange()})},t.prototype._schedulePlaylistUpdate=function(){var e=this,t=this._playlist;if(!t)throw new Error("Playlist should exist.");if((!this._playlistUpdateJob||this._playlistUpdateJob.hasCompleted())&&(this._playlistUpdateTimer&&(window.clearTimeout(this._playlistUpdateTimer),this._playlistUpdateTimer=null),!t.hasEnded())){var n=this.isPlaying()?t.getDuration()-this.getPosition()-1e4:1/0,r=t.getExpireTime(),i=r?v()-r:1/0,o=Math.max(0,this._earliestAllowedNextUpdateTime-v()),a=Math.max(o,Math.min(n,i,t.getType()===s.PlaylistType.EVENT?1e4:1/0));a<1/0&&(this._earliestAllowedNextUpdateTime=v()+2e3,this._playlistUpdateTimer=window.setTimeout(function(){e._playlistUpdateTimer=null;var n=e._playlistUpdateJob=t.update();n.onError(function(t){t!==x&&(e._handlePlaylistUpdateError(t),e._schedulePlaylistUpdate())})},a))}},t.prototype._updateLocalDurationsFromPlaylist=function(){var e=this._playlist;if(!e)throw new Error("Missing playlist.");this._duration=r(e),this._playlistDuration=e.getDuration()},t.prototype._findSegmentAndAppendToMSE=function(){var e=this._simpleMSE;if(e&&e.waitingForSegmentData()){var t=this._getSegmentDataToAppendNext();t&&(this._logger.debug("Providing segment to SimpleMSE.",t.eventRepresentation),e.provideNextSegmentData(t))}},t.prototype._setPlaylist=function(e){var t=this;if(this._playlist)throw new Error("Playlist already exists.");this._playlist=e,this._playlistUpdateJob=this._playlist.update(),this._playlistUpdateJob.onCompletion(function(){t._logger.debug("Playlist retrieved."),t._whenPlaylistRetrieved()}),this._playlistUpdateJob.onError(function(e){e!==x&&t._handlePlaylistUpdateError(e)})},t.prototype._handlePlaylistUpdateError=function(e){this._logger.error("Error when retrieving playlist.",e),e instanceof s.retrievalErrors.RetrievalError?this._triggerError(new f.RetrievalError(e)):this._triggerError(new y("Unexpected error when retrieving playlist.",e))},t.prototype._getSegmentDataToAppendNext=function(){var e=this._lastSegmentAppended;this._logger.debug("Looking for segment to append next.",!!e);var t=this._playlistSegmentRetriever;if(!t)return this._logger.debug("No segment retriever."),null;if(e){var n=this._getSubsequentSegment(e);if(!n)return this._logger.debug("No segment found."),e.isFinalSegment()&&(this._logger.debug("The last segment we appended was the last one in the stream. Signalling EOS."),this._signalEOS()),null;var r=n.segment;return this._logger.debug("Found segment.",r.getEventRepresentation()),this._lastSegmentAppended=r,{data:n.dataRetrieveJob,eventRepresentation:r.getEventRepresentation()}}var i=this.getPosition(),n=g(t.getSegmentsWithData(),function(e){return e.segment.getTimeRange().containsTime(i)});if(!n)return this._logger.debug("No segment found.",i),null;var r=n.segment,o=n.dataRetrieveJob,a=this._firstSegmentOffset=i-r.getTimeRange().start,s=this.getMediaElement();if(!s)throw new Error("Media element should exist.");var l={data:o,eventRepresentation:r.getEventRepresentation()};if(!r.isFinalSegment())for(var u=r.getTimeRange().duration-a;u<1e3;){var c=this._getSubsequentSegment(r);if(!c)return this._logger.debug("Not enough segments to cover min append duration.",u),null;c.segment.isFinalSegment()?u=1/0:u+=c.segment.getTimeRange().duration}return this._logger.debug("Found initial segment.",r.getEventRepresentation()),this._lastSegmentAppended=r,this._onFirstSegmentRetrieved&&this._onFirstSegmentRetrieved(),l},t.prototype._getSubsequentSegment=function(e){var t=this._playlistSegmentRetriever;if(!t)return this._logger.debug("No segment retriever."),null;var n=t.getSegmentsWithData(),r=n[n.map(function(e){return e.segment.getSequenceNumber()}).indexOf(e.getSequenceNumber())+1];return r&&r.segment.getTimeRange().start===e.getTimeRange().end?r:null},t.prototype._signalEOS=function(){var e=this;this._logger.debug("Signalling EOS."),this._simpleMSE&&(this._simpleMSE.kill(),this._logger.debug("Killed SimpleMSE."),this._simpleMSE=null);var t=this._mse;t&&!t.eosSignalled()&&t.signalEOS().catch(function(n){if(t===e._mse){if("InvalidStateError"===n.name)return void e._logger.error("InvalidStateError occurred when signalling EOS.",n);e._logger.error("Error occurred when signalling EOS.",n),e._triggerError(new h.AppendError(n))}})},t}(l.HTML5PlayerBase);t.HLSMSEPlayer=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819;var r=n(14);t.HLSMSEPlayer=r.HLSMSEPlayer;var i=n(8);t.errors=i.errors;var o=n(7);t.retrievalErrors=o.retrievalErrors}])}(n(2),n(4),n(7))},function(e,t,n){window,e.exports=function(e,t,n){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=38)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getCode=function(){return"GENERIC"},e}();t.RetrievalError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPartialMatch=function(e,t){return!(e.mimeType&&t.mimeType!==e.mimeType||e.audioCodec&&(!t.audioCodec||t.audioCodec.id!==e.audioCodec.id)||e.videoCodec&&(!t.videoCodec||t.videoCodec.id!==e.videoCodec.id))}},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(5),o=n(21),a={rate:44100,id:3},s=a.rate;t.MP3ToMP4={getInputFormat:function(){return{mimeType:"audio/mpeg"}},getOutputFormat:function(){return{mimeType:"audio/mp4",audioCodec:{id:"mp3"}}},transmux:function(e){var t=new r.helpers.abortableJob.AbortableJob(function(){function t(){p.close(),m.flush()}function n(n){f=!0;try{t()}catch(e){}l.reject(n),e.abort()}var l=r.helpers.deferred.buildDeferred(),u=new r.eventDispatcher.EventDispatcher,c=[],h=!1,d=null,f=!1,p=new i.MP3Parser,m=new o.MP4Mux({audioTrackId:0,videoTrackId:-1,tracks:[{codecId:2,channels:2,samplerate:a.rate,samplesize:16,timescale:s}]});return m.ondata=function(e){f||(d?(c.push(e),u.dispatch({initData:d,data:e})):d=e)},p.onFrame=function(e){if(!f)try{var t=new Uint8Array(e.length+1),r=32;r|=a.id<<2,r|=2,r|=1,t[0]=r,t.set(e,1),m.pushPacket(8,t,0)}catch(e){n(e)}},e.onProgressUpdate(function(e){var t=e.data;!h&&e.initData&&(t=r.helpers.arrayBuffer.combine([e.initData,e.data])),h=!0;try{p.push(t)}catch(e){n(e)}}),e.onCompletion(function(e){try{t(),l.resolve(e)}catch(e){n(e)}}),e.onError(n),{result:l.promise,progressUpdates:{onProgressUpdate:u,getProgressSoFar:function(){return c.length?{initData:d,data:r.helpers.arrayBuffer.combine(c)}:null}},abort:function(){f=!0,e.abort(),t()}}});return t.run()}}},function(e,t,n){"use strict";function r(){this.buffer=null,this.bufferSize=0}t.__esModule=!0,t.MP3Parser=r;var i=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];r.prototype.push=function(e){var t;if(this.bufferSize>0){var n=e.length+this.bufferSize;if(!this.buffer||this.buffer.length<n){var r=new Uint8Array(n);this.bufferSize>0&&r.set(this.buffer.subarray(0,this.bufferSize)),this.buffer=r}this.buffer.set(e,this.bufferSize),this.bufferSize=n,e=this.buffer,t=n}else t=e.length;for(var i,o=0;o<t&&(i=this._parse(e,o,t))>0;)o+=i;var a=t-o;a>0&&(!this.buffer||this.buffer.length<a?this.buffer=new Uint8Array(e.subarray(o,t)):this.buffer.set(e.subarray(o,t))),this.bufferSize=a},r.prototype._parse=function(e,t,n){if(t+2>n)return-1;if(255===e[t]||224===(224&e[t+1])){if(t+24>n)return-1;var r=e[t+1]>>3&3,a=e[t+1]>>1&3,s=e[t+2]>>4&15,l=e[t+2]>>2&3,u=!!(2&e[t+2]);if(1!==r&&0!==s&&15!==s&&3!==l){var c=3===r?3-a:3===a?3:4,h=1e3*i[14*c+s-1],d=3===r?0:2===r?1:2,f=o[3*d+l],p=u?1:0,m=3===a?(3===r?12:6)*h/f+p<<2:(3===r?144:72)*h/f+p|0;return t+m>n?-1:(this.onFrame&&this.onFrame(new Uint8Array(e.subarray(t,t+m))),m)}}for(var g=t+2;g<n;){if(255===e[g-1]&&224===(224&e[g]))return this.onNoise&&this.onNoise(new Uint8Array(e.subarray(t,g-1))),g-t-1;g++}return-1},r.prototype.close=function(){this.bufferSize>0&&this.onNoise&&this.onNoise(new Uint8Array(this.buffer.subarray(0,this.bufferSize))),this.buffer=null,this.bufferSize=0,this.onClose&&this.onClose()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassThrough={getInputFormat:function(){return{}},getOutputFormat:function(){return{}},transmux:function(e){return e}}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"NO_DECRYPTOR"},t}(i.RetrievalError);t.NoDecryptorError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(e){function t(t){var n=e.call(this)||this;return n._statusCode=t,n}return r(t,e),t.prototype.getStatusCode=function(){return this._statusCode},t.prototype.getCode=function(){return"UNACCEPTABLE_RESPONSE_STATUS_CODE"},t}(i.RetrievalError);t.UnacceptableResponseStatusCodeError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this._playlist=e,this._url=t,this._sequenceNumber=n}return e.prototype.getPlaylist=function(){return this._playlist},e.prototype.getUrl=function(){return this._url},e.prototype.getSequenceNumber=function(){return this._sequenceNumber},e}();t.Segment=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(e){function t(t){var n=e.call(this)||this;return n._code=t,n}return r(t,e),t.prototype.getCode=function(){return"OGG_PARSER."+this._code},t}(i.RetrievalError);t.OggParserError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._url=e}return e.prototype.getUrl=function(){return this._url},e}();t.Playlist=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._playlist=e,this._url=t}return e.prototype.getPlaylist=function(){return this._playlist},e.prototype.getUrl=function(){return this._url},e}();t.Key=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this._playlist=e,this._url=t}return e.prototype.getPlaylist=function(){return this._playlist},e.prototype.getUrl=function(){return this._url},e}();t.InitData=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(12),o=n(11),a=n(9);!function(e){e.InitData=r.InitData,e.Key=i.Key,e.Playlist=o.Playlist,e.Segment=a.Segment}(t.events||(t.events={}))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCode=function(){return"UNSUPPORTED_ENCRYPTION_ERROR"},t}(i.RetrievalError);t.UnsupportedEncryptionError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(e){function t(t){var n=e.call(this)||this;return n._details=t,n}return r(t,e),t.prototype.getDetails=function(){return this._details},t.prototype.getCode=function(){return"PLAYLIST_PARSE"},t}(i.RetrievalError);t.PlaylistParseError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(16),o=n(10),a=n(1),s=n(8),l=n(15);!function(e){e.NoDecryptorError=r.NoDecryptorError,e.PlaylistParseError=i.PlaylistParseError,e.OggParserError=o.OggParserError,e.RetrievalError=a.RetrievalError,e.UnacceptableResponseStatusCodeError=s.UnacceptableResponseStatusCodeError,e.UnsupportedEncryptionError=l.UnsupportedEncryptionError}(t.retrievalErrors||(t.retrievalErrors={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.MP4ToMP4={getInputFormat:function(){return{mimeType:"audio/mp4"}},getOutputFormat:function(){return{mimeType:"audio/mp4"}},transmux:function(e){var t=new r.helpers.abortableJob.AbortableJob(function(){function t(t){n.reject(t),e.abort()}var n=r.helpers.deferred.buildDeferred(),i=new r.eventDispatcher.EventDispatcher,o=[],a=[],s=new Uint8Array(0),l=null,u=!1,c=function e(t){if(t.byteLength<4)s=t;else{if(null===l){var n=new DataView(t.buffer).getUint32(0);if(1===n)throw new Error("Large atom size not supported.");l=n}if(0!==l&&t.byteLength>=l){var r=new Uint8Array(t.buffer.slice(0,l));a.push(r),s=new Uint8Array(t.buffer.slice(l)),l=null,e(s)}else s=t}};return e.onProgressUpdate(function(e){var n=e.data;!u&&e.initData&&(n=r.helpers.arrayBuffer.combine([e.initData,e.data])),u=!0;try{var l=r.helpers.arrayBuffer.combine([s,n]);if(c(l),a.length){var h=r.helpers.arrayBuffer.combine(a);a.splice(0),o.push(h),i.dispatch({data:h})}}catch(e){t(e)}}),e.onCompletion(function(e){try{if(0===l)o.push(s),i.dispatch({data:s});else if(s.byteLength)throw new Error("Part way through an atom.");n.resolve(e)}catch(e){t(e)}}),e.onError(t),{result:n.promise,progressUpdates:{onProgressUpdate:i,getProgressSoFar:function(){return o.length?{data:r.helpers.arrayBuffer.combine(o)}:null}},abort:function(){e.abort()}}});return t.run()}}},function(e,t){e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(3),o=n(19);t.OggOpusToWebm={getInputFormat:function(){return{mimeType:"audio/ogg",audioCodec:{id:"opus"}}},getOutputFormat:function(){return{mimeType:"audio/webm",audioCodec:{id:"opus"}}},transmux:function(e){var t=new r.helpers.abortableJob.AbortableJob(function(){function t(t){d=!0,n.reject(t),e.abort()}var n=r.helpers.deferred.buildDeferred(),a=new r.eventDispatcher.EventDispatcher,s=[],l=null,u=new Uint8Array(0),c=!1,h=null,d=!1;return e.onProgressUpdate(function(e){if(!d){var n=[u,e.data];!c&&e.initData&&(n=[e.initData].concat(n)),c=!0;var f=r.helpers.arrayBuffer.combine(n);try{var p=i.retrievePages(f).pages,m=p.reduce(function(e,t){return e+t.entirePage.byteLength},0);u=new Uint8Array(f.buffer.slice(m));var g=i.retrievePackets(p);if(g.length&&!l){if(g.length<2)throw new Error("Expecting at least 2 opus packets.");var _=o.parseOpusHead(g[0]);_.outputGain>-2&&o.setOutputGain(g[0],-2),l=[g[0],g[1]],g=g.slice(2)}if(g.length&&l){s.push.apply(s,g);var v=o.buildWebm(l.concat(g));h||(h=v.initData),a.dispatch({initData:h,data:v.data})}}catch(e){t(e)}}}),e.onCompletion(function(e){u.byteLength?n.reject(new Error("Still data left in buffer.")):n.resolve(e)}),e.onError(t),{result:n.promise,progressUpdates:{onProgressUpdate:a,getProgressSoFar:function(){if(s.length&&l){var e=o.buildWebm(l.concat(s)).data;return{initData:h,data:e}}return null}},abort:function(){d=!0,e.abort()}}});return t.run()}}},function(e,t,n){"use strict";t.__esModule=!0;var r,i,o=function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};!function(e){!function(e){e.utf8decode=function(e){for(var t=new Uint8Array(4*e.length),n=0,r=0,i=e.length;r<i;r++){var o=e.charCodeAt(r);if(o<=127)t[n++]=o;else{if(55296<=o&&o<=56319){var a=e.charCodeAt(r+1);56320<=a&&a<=57343&&(o=((1023&o)<<10)+(1023&a)+65536,++r)}0!==(4292870144&o)?(t[n++]=248|o>>>24&3,t[n++]=128|o>>>18&63,t[n++]=128|o>>>12&63,t[n++]=128|o>>>6&63,t[n++]=128|63&o):0!==(4294901760&o)?(t[n++]=240|o>>>18&7,t[n++]=128|o>>>12&63,t[n++]=128|o>>>6&63,t[n++]=128|63&o):0!==(4294965248&o)?(t[n++]=224|o>>>12&15,t[n++]=128|o>>>6&63,t[n++]=128|63&o):(t[n++]=192|o>>>6&31,t[n++]=128|63&o)}}return t.subarray(0,n)},e.utf8encode=function(e){for(var t=0,n="";t<e.length;){var r=255&e[t++];if(r<=127)n+=String.fromCharCode(r);else{var i=192,o=5;do{var a=i>>1|128;if((r&a)===i)break;i=i>>1|128,--o}while(o>=0);if(o<=0)throw new Error("Invalid UTF8 character");for(var s=r&(1<<o)-1,l=5;l>=o;--l){var u=e[t++];if(128!==(192&u))throw new Error("Invalid UTF8 character sequence");s=s<<6|63&u}n+=s>=65536?String.fromCharCode(s-65536>>10&1023|55296,1023&s|56320):String.fromCharCode(s)}}return n}}(e.StringUtilities||(e.StringUtilities={}))}(i||(i={})),function(e){!function(e){function t(e){for(var t=e.length>>1,n=new Uint8Array(t),r=0;r<t;r++)n[r]=parseInt(e.substr(2*r,2),16);return n}function n(e){var t,n=0,l=r.RAW,u=e[n],c=u>>4,h=u>>2&3,d=2&u?16:8,f=1&u?2:1;switch(n++,c){case s:var p=e[n++];l=p,t=1024;break;case a:var m=e[n+1]>>3&3,g=e[n+1]>>1&3;t=1===g?3===m?1152:576:3===g?384:1152}return{codecDescription:o[c],codecId:c,data:e.subarray(n),rate:i[h],size:d,channels:f,samples:t,packetType:l}}var r,i=[5500,11025,22050,44100],o=["PCM","ADPCM","MP3","PCM le","Nellymouser16","Nellymouser8","Nellymouser","G.711 A-law","G.711 mu-law",null,"AAC","Speex","MP3 8khz"],a=2,s=10;!function(e){e[e.HEADER=0]="HEADER",e[e.RAW=1]="RAW"}(r||(r={}));var l,u,c,h=[null,"JPEG","Sorenson","Screen","VP6","VP6 alpha","Screen2","AVC"],d=4,f=7;!function(e){e[e.KEY=1]="KEY",e[e.INNER=2]="INNER",e[e.DISPOSABLE=3]="DISPOSABLE",e[e.GENERATED=4]="GENERATED",e[e.INFO=5]="INFO"}(l||(l={})),function(e){e[e.HEADER=0]="HEADER",e[e.NALU=1]="NALU",e[e.END=2]="END"}(u||(u={})),function(e){e[e.CAN_GENERATE_HEADER=0]="CAN_GENERATE_HEADER",e[e.NEED_HEADER_DATA=1]="NEED_HEADER_DATA",e[e.MAIN_PACKETS=2]="MAIN_PACKETS"}(c||(c={}));var p=function(){function i(e){var t=this;this.oncodecinfo=function(e){},this.ondata=function(e){throw new Error("MP4Mux.ondata is not set")},this.metadata=e,this.trackStates=this.metadata.tracks.map(function(e,n){var r={trackId:n+1,trackInfo:e,cachedDuration:0,samplesProcessed:0,initializationData:[]};return t.metadata.audioTrackId===n&&(t.audioTrackState=r),t.metadata.videoTrackId===n&&(t.videoTrackState=r),r},this),this._checkIfNeedHeaderData(),this.filePos=0,this.cachedPackets=[],this.chunkIndex=0}return i.prototype.pushPacket=function(e,t,i){switch(this.state===c.CAN_GENERATE_HEADER&&this._tryGenerateHeader(),e){case 8:var o=this.audioTrackState,l=n(t);if(!o||o.trackInfo.codecId!==l.codecId)throw new Error("Unexpected audio packet codec: "+l.codecDescription);switch(l.codecId){default:throw new Error("Unsupported audio codec: "+l.codecDescription);case a:break;case s:if(l.packetType===r.HEADER)return void o.initializationData.push(l.data)}this.cachedPackets.push({packet:l,timestamp:i,trackId:o.trackId});break;case 9:var p=this.videoTrackState,m=function(e){var t=0,n=e[t]>>4,r=15&e[t];t++;var i={frameType:n,codecId:r,codecDescription:h[r]};switch(r){case f:var o=e[t++];i.packetType=o,i.compositionTime=(e[t]<<24|e[t+1]<<16|e[t+2]<<8)>>8,t+=3;break;case d:i.packetType=u.NALU,i.horizontalOffset=e[t]>>4&15,i.verticalOffset=15&e[t],i.compositionTime=0,t++}return i.data=e.subarray(t),i}(t);if(!p||p.trackInfo.codecId!==m.codecId)throw new Error("Unexpected video packet codec: "+m.codecDescription);switch(m.codecId){default:throw new Error("unsupported video codec: "+m.codecDescription);case d:break;case f:if(m.packetType===u.HEADER)return void p.initializationData.push(m.data)}this.cachedPackets.push({packet:m,timestamp:i,trackId:p.trackId});break;default:throw new Error("unknown packet type: "+e)}this.state===c.NEED_HEADER_DATA&&this._tryGenerateHeader(),this.cachedPackets.length>=50&&this.state===c.MAIN_PACKETS&&this._chunk()},i.prototype.flush=function(){this.cachedPackets.length>0&&this._chunk()},i.prototype._checkIfNeedHeaderData=function(){this.trackStates.some(function(e){return e.trackInfo.codecId===s||e.trackInfo.codecId===f})?this.state=c.NEED_HEADER_DATA:this.state=c.CAN_GENERATE_HEADER},i.prototype._tryGenerateHeader=function(){var n=this.trackStates.every(function(e){switch(e.trackInfo.codecId){case s:case f:return e.initializationData.length>0;default:return!0}});if(n){for(var r=["isom"],i=[],o=0;o<this.trackStates.length;o++){var l,u=this.trackStates[o],h=u.trackInfo;switch(h.codecId){case s:var p=u.initializationData[0];l=new e.Iso.AudioSampleEntry("mp4a",1,h.channels,h.samplesize,h.samplerate);var m=new Uint8Array(41+p.length);m.set(t("0000000003808080"),0),m[8]=32+p.length,m.set(t("00020004808080"),9),m[16]=18+p.length,m.set(t("40150000000000FA000000000005808080"),17),m[34]=p.length,m.set(p,35),m.set(t("068080800102"),35+p.length),l.otherBoxes=[new e.Iso.RawTag("esds",m)];var g=p[0]>>3;u.mimeTypeCodec="mp4a.40."+g;break;case a:l=new e.Iso.AudioSampleEntry(".mp3",1,h.channels,h.samplesize,h.samplerate),u.mimeTypeCodec="mp3";break;case f:var _=u.initializationData[0];(l=new e.Iso.VideoSampleEntry("avc1",1,h.width,h.height)).otherBoxes=[new e.Iso.RawTag("avcC",_)];var v=_[1]<<16|_[2]<<8|_[3];u.mimeTypeCodec="avc1."+(16777216|v).toString(16).substr(1),r.push("iso2","avc1","mp41");break;case d:(l=new e.Iso.VideoSampleEntry("VP6F",1,h.width,h.height)).otherBoxes=[new e.Iso.RawTag("glbl",t("00"))],u.mimeTypeCodec="avc1.42001E";break;default:throw new Error("not supported track type")}var y,b=e.Iso.TrackHeaderFlags.TRACK_ENABLED|e.Iso.TrackHeaderFlags.TRACK_IN_MOVIE;u===this.audioTrackState?y=new e.Iso.TrackBox(new e.Iso.TrackHeaderBox(b,u.trackId,-1,0,0,1,o),new e.Iso.MediaBox(new e.Iso.MediaHeaderBox(h.timescale,-1,h.language),new e.Iso.HandlerBox("soun","SoundHandler"),new e.Iso.MediaInformationBox(new e.Iso.SoundMediaHeaderBox,new e.Iso.DataInformationBox(new e.Iso.DataReferenceBox([new e.Iso.DataEntryUrlBox(e.Iso.SELF_CONTAINED_DATA_REFERENCE_FLAG)])),new e.Iso.SampleTableBox(new e.Iso.SampleDescriptionBox([l]),new e.Iso.RawTag("stts",t("0000000000000000")),new e.Iso.RawTag("stsc",t("0000000000000000")),new e.Iso.RawTag("stsz",t("000000000000000000000000")),new e.Iso.RawTag("stco",t("0000000000000000")))))):u===this.videoTrackState&&(y=new e.Iso.TrackBox(new e.Iso.TrackHeaderBox(b,u.trackId,-1,h.width,h.height,0,o),new e.Iso.MediaBox(new e.Iso.MediaHeaderBox(h.timescale,-1,h.language),new e.Iso.HandlerBox("vide","VideoHandler"),new e.Iso.MediaInformationBox(new e.Iso.VideoMediaHeaderBox,new e.Iso.DataInformationBox(new e.Iso.DataReferenceBox([new e.Iso.DataEntryUrlBox(e.Iso.SELF_CONTAINED_DATA_REFERENCE_FLAG)])),new e.Iso.SampleTableBox(new e.Iso.SampleDescriptionBox([l]),new e.Iso.RawTag("stts",t("0000000000000000")),new e.Iso.RawTag("stsc",t("0000000000000000")),new e.Iso.RawTag("stsz",t("000000000000000000000000")),new e.Iso.RawTag("stco",t("0000000000000000"))))))),i.push(y)}var E=new e.Iso.MovieExtendsBox(null,[new e.Iso.TrackExtendsBox(1,1,0,0,0),new e.Iso.TrackExtendsBox(2,1,0,0,0)],null),x=new e.Iso.BoxContainerBox("udat",[new e.Iso.MetaBox(new e.Iso.RawTag("hdlr",t("00000000000000006D6469726170706C000000000000000000")),[new e.Iso.RawTag("ilst",t("00000025A9746F6F0000001D6461746100000001000000004C61766635342E36332E313034"))])]),T=new e.Iso.MovieHeaderBox(1e3,0,this.trackStates.length+1),S=new e.Iso.MovieBox(T,i,E,x),A=new e.Iso.FileTypeBox("isom",512,r),P=A.layout(0),M=S.layout(P),R=new Uint8Array(P+M);A.write(R),S.write(R),this.oncodecinfo(this.trackStates.map(function(e){return e.mimeTypeCodec})),this.ondata(R),this.filePos+=R.length,this.state=c.MAIN_PACKETS}},i.prototype._chunk=function(){var t=this.cachedPackets;if(this.videoTrackState){for(var n=t.length-1,r=this.videoTrackState.trackId;n>0&&(t[n].trackId!==r||t[n].packet.frameType!==l.KEY);)n--;n>0&&(t=t.slice(0,n))}if(0!==t.length){for(var i=[],o=0,u=[],c=[],h=0;h<this.trackStates.length;h++){var p=this.trackStates[h],m=p.trackInfo,g=p.trackId,_=t.filter(function(e){return e.trackId===g});if(0!==_.length){var v,y,b,E=new e.Iso.TrackFragmentBaseMediaDecodeTimeBox(p.cachedDuration);switch(c.push(o),m.codecId){case s:case a:b=[];for(var n=0;n<_.length;n++){var x=_[n].packet,T=Math.round(x.samples*m.timescale/m.samplerate);i.push(x.data),o+=x.data.length,b.push({duration:T,size:x.data.length}),p.samplesProcessed+=x.samples}var S=e.Iso.TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT;v=new e.Iso.TrackFragmentHeaderBox(S,g,0,0,0,0,e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS);var A=e.Iso.TrackRunFlags.DATA_OFFSET_PRESENT|e.Iso.TrackRunFlags.SAMPLE_DURATION_PRESENT|e.Iso.TrackRunFlags.SAMPLE_SIZE_PRESENT;y=new e.Iso.TrackRunBox(A,b,0,0),p.cachedDuration=Math.round(p.samplesProcessed*m.timescale/m.samplerate);break;case f:case d:b=[];for(var P=p.samplesProcessed,M=P*m.timescale/m.framerate,R=Math.round(M),n=0;n<_.length;n++){var C=_[n].packet;P++;var w=Math.round(P*m.timescale/m.framerate),O=w-R;R=w;var I=Math.round(P*m.timescale/m.framerate+C.compositionTime*m.timescale/1e3);i.push(C.data),o+=C.data.length;var D=C.frameType===l.KEY?e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS:e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_OTHER|e.Iso.SampleFlags.SAMPLE_IS_NOT_SYNC;b.push({duration:O,size:C.data.length,flags:D,compositionTimeOffset:I-w})}var S=e.Iso.TrackFragmentFlags.DEFAULT_SAMPLE_FLAGS_PRESENT;v=new e.Iso.TrackFragmentHeaderBox(S,g,0,0,0,0,e.Iso.SampleFlags.SAMPLE_DEPENDS_ON_NO_OTHERS);var A=e.Iso.TrackRunFlags.DATA_OFFSET_PRESENT|e.Iso.TrackRunFlags.SAMPLE_DURATION_PRESENT|e.Iso.TrackRunFlags.SAMPLE_SIZE_PRESENT|e.Iso.TrackRunFlags.SAMPLE_FLAGS_PRESENT|e.Iso.TrackRunFlags.SAMPLE_COMPOSITION_TIME_OFFSET;y=new e.Iso.TrackRunBox(A,b,0,0),p.cachedDuration=R,p.samplesProcessed=P;break;default:throw new Error("Un codec")}var L=new e.Iso.TrackFragmentBox(v,E,y);u.push(L)}}this.cachedPackets.splice(0,t.length);for(var F=new e.Iso.MovieFragmentHeaderBox(++this.chunkIndex),N=new e.Iso.MovieFragmentBox(F,u),B=N.layout(0),U=new e.Iso.MediaDataBox(i),k=U.layout(B),V=B+8,h=0;h<u.length;h++)u[h].run.dataOffset=V+c[h];var G=new Uint8Array(B+k);N.write(G),U.write(G),this.ondata(G),this.filePos+=G.length}},i}();e.MP4Mux=p,e.parseFLVMetadata=function(e){var t,n,r=[],i=-1,o=-1,l=+e.asGetPublicProperty("duration"),u=e.asGetPublicProperty("audiocodecid");switch(u){case a:case"mp3":t="mp3",n=a;break;case s:case"mp4a":t="mp4a",n=s;break;default:if(!isNaN(u))throw new Error("Unsupported audio codec: "+u);t=null,n=-1}var c,h,p=e.asGetPublicProperty("videocodecid");switch(p){case d:case"vp6f":c="vp6f",h=d;break;case f:case"avc1":c="avc1",h=f;break;default:if(!isNaN(p))throw new Error("Unsupported video codec: "+p);c=null,h=-1}var m=null===t?null:{codecDescription:t,codecId:n,language:"und",timescale:+e.asGetPublicProperty("audiosamplerate")||44100,samplerate:+e.asGetPublicProperty("audiosamplerate")||44100,channels:+e.asGetPublicProperty("audiochannels")||2,samplesize:16},g=null===c?null:{codecDescription:c,codecId:h,language:"und",timescale:6e4,framerate:+e.asGetPublicProperty("videoframerate")||+e.asGetPublicProperty("framerate"),width:+e.asGetPublicProperty("width"),height:+e.asGetPublicProperty("height")},_=e.asGetPublicProperty("trackinfo");if(_)for(var v=0;v<_.length;v++){var y=_[v],b=y.asGetPublicProperty("sampledescription")[0];b.asGetPublicProperty("sampletype")===u?(m.language=y.asGetPublicProperty("language"),m.timescale=+y.asGetPublicProperty("timescale")):b.asGetPublicProperty("sampletype")===p&&(g.language=y.asGetPublicProperty("language"),g.timescale=+y.asGetPublicProperty("timescale"))}return g&&(o=r.length,r.push(g)),m&&(i=r.length,r.push(m)),{tracks:r,duration:l,audioTrackId:i,videoTrackId:o}},e.splitMetadata=function(e){var t=[];return e.audioTrackId>=0&&t.push({tracks:[e.tracks[e.audioTrackId]],duration:e.duration,audioTrackId:0,videoTrackId:-1}),e.videoTrackId>=0&&t.push({tracks:[e.tracks[e.videoTrackId]],duration:e.duration,audioTrackId:-1,videoTrackId:0}),t}}(e.MP4||(e.MP4={}))}(r||(r={})),function(e){!function(e){!function(e){function t(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return Array.prototype.concat.apply(e,t)}function n(e,t,n){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function r(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}function a(e){return(e-h)/1e3|0}function s(e){return 65536*e|0}function l(e){return 1073741824*e|0}function u(e){return 256*e|0}var c=i.StringUtilities.utf8decode,h=-20828448e5,d=[1,0,0,0,1,0,0,0,1],f=[0,0,0],p=function(){function e(e,t){this.boxtype=e,"uuid"===e&&(this.userType=t)}return e.prototype.layout=function(e){this.offset=e;var t=8;return this.userType&&(t+=16),this.size=t,t},e.prototype.write=function(e){return n(e,this.offset,this.size),n(e,this.offset+4,r(this.boxtype)),this.userType?(e.set(this.userType,this.offset+8),24):8},e.prototype.toUint8Array=function(){var e=this.layout(0),t=new Uint8Array(e);return this.write(t),t},e}();e.Box=p;var m=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=e.call(this,t)||this;return i.version=n,i.flags=r,i}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,this.version<<24|this.flags),r+4},t}(p);e.FullBox=m;var g=function(e){function t(t,n,r){var i=e.call(this,"ftype")||this;return i.majorBrand=t,i.minorVersion=n,i.compatibleBrands=r,i}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4*(2+this.compatibleBrands.length),this.size},t.prototype.write=function(t){var i=this,o=e.prototype.write.call(this,t);return n(t,this.offset+o,r(this.majorBrand)),n(t,this.offset+o+4,this.minorVersion),o+=8,this.compatibleBrands.forEach(function(e){n(t,i.offset+o,r(e)),o+=4},this),o},t}(p);e.FileTypeBox=g;var _=function(e){function t(t,n){var r=e.call(this,t)||this;return r.children=n,r}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t);return this.children.forEach(function(e){e&&(n+=e.layout(t+n))}),this.size=n},t.prototype.write=function(t){var n=e.prototype.write.call(this,t);return this.children.forEach(function(e){e&&(n+=e.write(t))}),n},t}(p);e.BoxContainerBox=_;var v=function(e){function n(n,r,i,o){var a=e.call(this,"moov",t([n],r,[i,o]))||this;return a.header=n,a.tracks=r,a.extendsBox=i,a.userData=o,a}return o(n,e),n}(_);e.MovieBox=v;var y=function(e){function t(t,n,r,i,o,a,s,l){void 0===i&&(i=1),void 0===o&&(o=1),void 0===a&&(a=d),void 0===s&&(s=h),void 0===l&&(l=h);var u=e.call(this,"mvhd",0,0)||this;return u.timescale=t,u.duration=n,u.nextTrackId=r,u.rate=i,u.volume=o,u.matrix=a,u.creationTime=s,u.modificationTime=l,u}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+16+4+2+2+8+36+24+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,a(this.creationTime)),n(t,this.offset+r+4,a(this.modificationTime)),n(t,this.offset+r+8,this.timescale),n(t,this.offset+r+12,this.duration),r+=16,n(t,this.offset+r,s(this.rate)),n(t,this.offset+r+4,u(this.volume)<<16),n(t,this.offset+r+8,0),n(t,this.offset+r+12,0),r+=16,n(t,this.offset+r,s(this.matrix[0])),n(t,this.offset+r+4,s(this.matrix[1])),n(t,this.offset+r+8,s(this.matrix[2])),n(t,this.offset+r+12,s(this.matrix[3])),n(t,this.offset+r+16,s(this.matrix[4])),n(t,this.offset+r+20,s(this.matrix[5])),n(t,this.offset+r+24,l(this.matrix[6])),n(t,this.offset+r+28,l(this.matrix[7])),n(t,this.offset+r+32,l(this.matrix[8])),r+=36,n(t,this.offset+r,0),n(t,this.offset+r+4,0),n(t,this.offset+r+8,0),n(t,this.offset+r+12,0),n(t,this.offset+r+16,0),n(t,this.offset+r+20,0),r+=24,n(t,this.offset+r,this.nextTrackId),r+=4},t}(m);e.MovieHeaderBox=y,function(e){e[e.TRACK_ENABLED=1]="TRACK_ENABLED",e[e.TRACK_IN_MOVIE=2]="TRACK_IN_MOVIE",e[e.TRACK_IN_PREVIEW=4]="TRACK_IN_PREVIEW"}(e.TrackHeaderFlags||(e.TrackHeaderFlags={}));var b=function(e){function t(t,n,r,i,o,a,s,l,u,c,f){void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=d),void 0===c&&(c=h),void 0===f&&(f=h);var p=e.call(this,"tkhd",0,t)||this;return p.trackId=n,p.duration=r,p.width=i,p.height=o,p.volume=a,p.alternateGroup=s,p.layer=l,p.matrix=u,p.creationTime=c,p.modificationTime=f,p}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+20+8+6+2+36+8,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,a(this.creationTime)),n(t,this.offset+r+4,a(this.modificationTime)),n(t,this.offset+r+8,this.trackId),n(t,this.offset+r+12,0),n(t,this.offset+r+16,this.duration),r+=20,n(t,this.offset+r,0),n(t,this.offset+r+4,0),n(t,this.offset+r+8,this.layer<<16|this.alternateGroup),n(t,this.offset+r+12,u(this.volume)<<16),r+=16,n(t,this.offset+r,s(this.matrix[0])),n(t,this.offset+r+4,s(this.matrix[1])),n(t,this.offset+r+8,s(this.matrix[2])),n(t,this.offset+r+12,s(this.matrix[3])),n(t,this.offset+r+16,s(this.matrix[4])),n(t,this.offset+r+20,s(this.matrix[5])),n(t,this.offset+r+24,l(this.matrix[6])),n(t,this.offset+r+28,l(this.matrix[7])),n(t,this.offset+r+32,l(this.matrix[8])),r+=36,n(t,this.offset+r,s(this.width)),n(t,this.offset+r+4,s(this.height)),r+=8},t}(m);e.TrackHeaderBox=b;var E=function(e){function t(t,n,r,i,o){void 0===r&&(r="unk"),void 0===i&&(i=h),void 0===o&&(o=h);var a=e.call(this,"mdhd",0,0)||this;return a.timescale=t,a.duration=n,a.language=r,a.creationTime=i,a.modificationTime=o,a}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+16+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,a(this.creationTime)),n(t,this.offset+r+4,a(this.modificationTime)),n(t,this.offset+r+8,this.timescale),n(t,this.offset+r+12,this.duration),n(t,this.offset+r+16,function(e){return(31&e.charCodeAt(0))<<10|(31&e.charCodeAt(1))<<5|31&e.charCodeAt(2)}(this.language)<<16),r+20},t}(m);e.MediaHeaderBox=E;var x=function(e){function t(t,n){var r=e.call(this,"hdlr",0,0)||this;return r.handlerType=t,r.name=n,r._encodedName=c(r.name),r}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+8+12+(this._encodedName.length+1),this.size},t.prototype.write=function(t){var i=e.prototype.write.call(this,t);return n(t,this.offset+i,0),n(t,this.offset+i+4,r(this.handlerType)),n(t,this.offset+i+8,0),n(t,this.offset+i+12,0),n(t,this.offset+i+16,0),i+=20,t.set(this._encodedName,this.offset+i),t[this.offset+i+this._encodedName.length]=0,i+=this._encodedName.length+1},t}(m);e.HandlerBox=x;var T=function(e){function t(t){void 0===t&&(t=0);var n=e.call(this,"smhd",0,0)||this;return n.balance=t,n}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,u(this.balance)<<16),r+4},t}(m);e.SoundMediaHeaderBox=T;var S=function(e){function t(t,n){void 0===t&&(t=0),void 0===n&&(n=f);var r=e.call(this,"vmhd",0,0)||this;return r.graphicsMode=t,r.opColor=n,r}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+8,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,this.graphicsMode<<16|this.opColor[0]),n(t,this.offset+r+4,this.opColor[1]<<16|this.opColor[2]),r+8},t}(m);e.VideoMediaHeaderBox=S,e.SELF_CONTAINED_DATA_REFERENCE_FLAG=1;var A=function(t){function n(n,r){void 0===r&&(r=null);var i=t.call(this,"url ",0,n)||this;return i.location=r,n&e.SELF_CONTAINED_DATA_REFERENCE_FLAG||(i._encodedLocation=c(r)),i}return o(n,t),n.prototype.layout=function(e){var n=t.prototype.layout.call(this,e);return this._encodedLocation&&(n+=this._encodedLocation.length+1),this.size=n},n.prototype.write=function(e){var n=t.prototype.write.call(this,e);return this._encodedLocation&&(e.set(this._encodedLocation,this.offset+n),e[this.offset+n+this._encodedLocation.length]=0,n+=this._encodedLocation.length),n},n}(m);e.DataEntryUrlBox=A;var P=function(e){function t(t){var n=e.call(this,"dref",0,0)||this;return n.entries=t,n}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t)+4;return this.entries.forEach(function(e){n+=e.layout(t+n)}),this.size=n},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,this.entries.length),this.entries.forEach(function(e){r+=e.write(t)}),r},t}(m);e.DataReferenceBox=P;var M=function(e){function t(t){var n=e.call(this,"dinf",[t])||this;return n.dataReference=t,n}return o(t,e),t}(_);e.DataInformationBox=M;var R=function(e){function t(t){var n=e.call(this,"stsd",0,0)||this;return n.entries=t,n}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t);return n+=4,this.entries.forEach(function(e){n+=e.layout(t+n)}),this.size=n},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,this.entries.length),r+=4,this.entries.forEach(function(e){r+=e.write(t)}),r},t}(m);e.SampleDescriptionBox=R;var C=function(e){function t(t,n,r,i,o){var a=e.call(this,"stbl",[t,n,r,i,o])||this;return a.sampleDescriptions=t,a.timeToSample=n,a.sampleToChunk=r,a.sampleSizes=i,a.chunkOffset=o,a}return o(t,e),t}(_);e.SampleTableBox=C;var w=function(e){function t(t,n,r){var i=e.call(this,"minf",[t,n,r])||this;return i.header=t,i.info=n,i.sampleTable=r,i}return o(t,e),t}(_);e.MediaInformationBox=w;var O=function(e){function t(t,n,r){var i=e.call(this,"mdia",[t,n,r])||this;return i.header=t,i.handler=n,i.info=r,i}return o(t,e),t}(_);e.MediaBox=O;var I=function(e){function t(t,n){var r=e.call(this,"trak",[t,n])||this;return r.header=t,r.media=n,r}return o(t,e),t}(_);e.TrackBox=I;var D=function(e){function t(t,n,r,i,o){var a=e.call(this,"trex",0,0)||this;return a.trackId=t,a.defaultSampleDescriptionIndex=n,a.defaultSampleDuration=r,a.defaultSampleSize=i,a.defaultSampleFlags=o,a}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+20,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,this.trackId),n(t,this.offset+r+4,this.defaultSampleDescriptionIndex),n(t,this.offset+r+8,this.defaultSampleDuration),n(t,this.offset+r+12,this.defaultSampleSize),n(t,this.offset+r+16,this.defaultSampleFlags),r+20},t}(m);e.TrackExtendsBox=D;var L=function(e){function n(n,r,i){var o=e.call(this,"mvex",t([n],r,[i]))||this;return o.header=n,o.tracDefaults=r,o.levels=i,o}return o(n,e),n}(_);e.MovieExtendsBox=L;var F=function(e){function t(t,n){var r=e.call(this,"meta",0,0)||this;return r.handler=t,r.otherBoxes=n,r}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t);return n+=this.handler.layout(t+n),this.otherBoxes.forEach(function(e){n+=e.layout(t+n)}),this.size=n},t.prototype.write=function(t){var n=e.prototype.write.call(this,t);return n+=this.handler.write(t),this.otherBoxes.forEach(function(e){n+=e.write(t)}),n},t}(m);e.MetaBox=F;var N,B=function(e){function t(t){var n=e.call(this,"mfhd",0,0)||this;return n.sequenceNumber=t,n}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,this.sequenceNumber),r+4},t}(m);e.MovieFragmentHeaderBox=B,function(e){e[e.BASE_DATA_OFFSET_PRESENT=1]="BASE_DATA_OFFSET_PRESENT",e[e.SAMPLE_DESCRIPTION_INDEX_PRESENT=2]="SAMPLE_DESCRIPTION_INDEX_PRESENT",e[e.DEFAULT_SAMPLE_DURATION_PRESENT=8]="DEFAULT_SAMPLE_DURATION_PRESENT",e[e.DEFAULT_SAMPLE_SIZE_PRESENT=16]="DEFAULT_SAMPLE_SIZE_PRESENT",e[e.DEFAULT_SAMPLE_FLAGS_PRESENT=32]="DEFAULT_SAMPLE_FLAGS_PRESENT"}(N=e.TrackFragmentFlags||(e.TrackFragmentFlags={}));var U=function(e){function t(t,n,r,i,o,a,s){var l=e.call(this,"tfhd",0,t)||this;return l.trackId=n,l.baseDataOffset=r,l.sampleDescriptionIndex=i,l.defaultSampleDuration=o,l.defaultSampleSize=a,l.defaultSampleFlags=s,l}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t)+4,r=this.flags;return r&N.BASE_DATA_OFFSET_PRESENT&&(n+=8),r&N.SAMPLE_DESCRIPTION_INDEX_PRESENT&&(n+=4),r&N.DEFAULT_SAMPLE_DURATION_PRESENT&&(n+=4),r&N.DEFAULT_SAMPLE_SIZE_PRESENT&&(n+=4),r&N.DEFAULT_SAMPLE_FLAGS_PRESENT&&(n+=4),this.size=n},t.prototype.write=function(t){var r=e.prototype.write.call(this,t),i=this.flags;return n(t,this.offset+r,this.trackId),r+=4,i&N.BASE_DATA_OFFSET_PRESENT&&(n(t,this.offset+r,0),n(t,this.offset+r+4,this.baseDataOffset),r+=8),i&N.SAMPLE_DESCRIPTION_INDEX_PRESENT&&(n(t,this.offset+r,this.sampleDescriptionIndex),r+=4),i&N.DEFAULT_SAMPLE_DURATION_PRESENT&&(n(t,this.offset+r,this.defaultSampleDuration),r+=4),i&N.DEFAULT_SAMPLE_SIZE_PRESENT&&(n(t,this.offset+r,this.defaultSampleSize),r+=4),i&N.DEFAULT_SAMPLE_FLAGS_PRESENT&&(n(t,this.offset+r,this.defaultSampleFlags),r+=4),r},t}(m);e.TrackFragmentHeaderBox=U;var k=function(e){function t(t){var n=e.call(this,"tfdt",0,0)||this;return n.baseMediaDecodeTime=t,n}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+4,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,this.baseMediaDecodeTime),r+4},t}(m);e.TrackFragmentBaseMediaDecodeTimeBox=k;var V,G=function(e){function t(t,n,r){var i=e.call(this,"traf",[t,n,r])||this;return i.header=t,i.decodeTime=n,i.run=r,i}return o(t,e),t}(_);e.TrackFragmentBox=G,function(e){e[e.IS_LEADING_MASK=201326592]="IS_LEADING_MASK",e[e.SAMPLE_DEPENDS_ON_MASK=50331648]="SAMPLE_DEPENDS_ON_MASK",e[e.SAMPLE_DEPENDS_ON_OTHER=16777216]="SAMPLE_DEPENDS_ON_OTHER",e[e.SAMPLE_DEPENDS_ON_NO_OTHERS=33554432]="SAMPLE_DEPENDS_ON_NO_OTHERS",e[e.SAMPLE_IS_DEPENDED_ON_MASK=12582912]="SAMPLE_IS_DEPENDED_ON_MASK",e[e.SAMPLE_HAS_REDUNDANCY_MASK=3145728]="SAMPLE_HAS_REDUNDANCY_MASK",e[e.SAMPLE_PADDING_VALUE_MASK=917504]="SAMPLE_PADDING_VALUE_MASK",e[e.SAMPLE_IS_NOT_SYNC=65536]="SAMPLE_IS_NOT_SYNC",e[e.SAMPLE_DEGRADATION_PRIORITY_MASK=65535]="SAMPLE_DEGRADATION_PRIORITY_MASK"}(e.SampleFlags||(e.SampleFlags={})),function(e){e[e.DATA_OFFSET_PRESENT=1]="DATA_OFFSET_PRESENT",e[e.FIRST_SAMPLE_FLAGS_PRESENT=4]="FIRST_SAMPLE_FLAGS_PRESENT",e[e.SAMPLE_DURATION_PRESENT=256]="SAMPLE_DURATION_PRESENT",e[e.SAMPLE_SIZE_PRESENT=512]="SAMPLE_SIZE_PRESENT",e[e.SAMPLE_FLAGS_PRESENT=1024]="SAMPLE_FLAGS_PRESENT",e[e.SAMPLE_COMPOSITION_TIME_OFFSET=2048]="SAMPLE_COMPOSITION_TIME_OFFSET"}(V=e.TrackRunFlags||(e.TrackRunFlags={}));var z=function(e){function t(t,n,r,i){var o=e.call(this,"trun",1,t)||this;return o.samples=n,o.dataOffset=r,o.firstSampleFlags=i,o}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t)+4,r=this.samples.length,i=this.flags;return i&V.DATA_OFFSET_PRESENT&&(n+=4),i&V.FIRST_SAMPLE_FLAGS_PRESENT&&(n+=4),i&V.SAMPLE_DURATION_PRESENT&&(n+=4*r),i&V.SAMPLE_SIZE_PRESENT&&(n+=4*r),i&V.SAMPLE_FLAGS_PRESENT&&(n+=4*r),i&V.SAMPLE_COMPOSITION_TIME_OFFSET&&(n+=4*r),this.size=n},t.prototype.write=function(t){var r=e.prototype.write.call(this,t),i=this.samples.length,o=this.flags;n(t,this.offset+r,i),r+=4,o&V.DATA_OFFSET_PRESENT&&(n(t,this.offset+r,this.dataOffset),r+=4),o&V.FIRST_SAMPLE_FLAGS_PRESENT&&(n(t,this.offset+r,this.firstSampleFlags),r+=4);for(var a=0;a<i;a++){var s=this.samples[a];o&V.SAMPLE_DURATION_PRESENT&&(n(t,this.offset+r,s.duration),r+=4),o&V.SAMPLE_SIZE_PRESENT&&(n(t,this.offset+r,s.size),r+=4),o&V.SAMPLE_FLAGS_PRESENT&&(n(t,this.offset+r,s.flags),r+=4),o&V.SAMPLE_COMPOSITION_TIME_OFFSET&&(n(t,this.offset+r,s.compositionTimeOffset),r+=4)}return r},t}(m);e.TrackRunBox=z;var j=function(e){function n(n,r){var i=e.call(this,"moof",t([n],r))||this;return i.header=n,i.trafs=r,i}return o(n,e),n}(_);e.MovieFragmentBox=j;var H=function(e){function t(t){var n=e.call(this,"mdat")||this;return n.chunks=t,n}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t);return this.chunks.forEach(function(e){n+=e.length}),this.size=n},t.prototype.write=function(t){var n=this,r=e.prototype.write.call(this,t);return this.chunks.forEach(function(e){t.set(e,n.offset+r),r+=e.length},this),r},t}(p);e.MediaDataBox=H;var W=function(e){function t(t,n){var r=e.call(this,t)||this;return r.dataReferenceIndex=n,r}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+8,this.size},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,0),n(t,this.offset+r+4,this.dataReferenceIndex),r+8},t}(p);e.SampleEntry=W;var X=function(e){function t(t,n,r,i,o,a){void 0===r&&(r=2),void 0===i&&(i=16),void 0===o&&(o=44100),void 0===a&&(a=null);var s=e.call(this,t,n)||this;return s.channelCount=r,s.sampleSize=i,s.sampleRate=o,s.otherBoxes=a,s}return o(t,e),t.prototype.layout=function(t){var n=e.prototype.layout.call(this,t)+20;return this.otherBoxes&&this.otherBoxes.forEach(function(e){n+=e.layout(t+n)}),this.size=n},t.prototype.write=function(t){var r=e.prototype.write.call(this,t);return n(t,this.offset+r,0),n(t,this.offset+r+4,0),n(t,this.offset+r+8,this.channelCount<<16|this.sampleSize),n(t,this.offset+r+12,0),n(t,this.offset+r+16,this.sampleRate<<16),r+=20,this.otherBoxes&&this.otherBoxes.forEach(function(e){r+=e.write(t)}),r},t}(W);e.AudioSampleEntry=X,e.COLOR_NO_ALPHA_VIDEO_SAMPLE_DEPTH=24;var Y=function(t){function r(n,r,i,o,a,s,l,u,c,h){void 0===a&&(a=""),void 0===s&&(s=72),void 0===l&&(l=72),void 0===u&&(u=1),void 0===c&&(c=e.COLOR_NO_ALPHA_VIDEO_SAMPLE_DEPTH),void 0===h&&(h=null);var d=t.call(this,n,r)||this;if(d.width=i,d.height=o,d.compressorName=a,d.horizResolution=s,d.vertResolution=l,d.frameCount=u,d.depth=c,d.otherBoxes=h,a.length>31)throw new Error("invalid compressor name");return d}return o(r,t),r.prototype.layout=function(e){var n=t.prototype.layout.call(this,e)+16+12+4+2+32+2+2;return this.otherBoxes&&this.otherBoxes.forEach(function(t){n+=t.layout(e+n)}),this.size=n},r.prototype.write=function(e){var r=t.prototype.write.call(this,e);n(e,this.offset+r,0),n(e,this.offset+r+4,0),n(e,this.offset+r+8,0),n(e,this.offset+r+12,0),r+=16,n(e,this.offset+r,this.width<<16|this.height),n(e,this.offset+r+4,s(this.horizResolution)),n(e,this.offset+r+8,s(this.vertResolution)),r+=12,n(e,this.offset+r,0),n(e,this.offset+r+4,this.frameCount<<16),r+=6,e[this.offset+r]=this.compressorName.length;for(var i=0;i<31;i++)e[this.offset+r+i+1]=i<this.compressorName.length?127&this.compressorName.charCodeAt(i):0;return r+=32,n(e,this.offset+r,this.depth<<16|65535),r+=4,this.otherBoxes&&this.otherBoxes.forEach(function(t){r+=t.write(e)}),r},r}(W);e.VideoSampleEntry=Y;var K=function(e){function t(t,n){var r=e.call(this,t)||this;return r.data=n,r}return o(t,e),t.prototype.layout=function(t){return this.size=e.prototype.layout.call(this,t)+this.data.length,this.size},t.prototype.write=function(t){var n=e.prototype.write.call(this,t);return t.set(this.data,this.offset+n),n+this.data.length},t}(p);e.RawTag=K}(e.Iso||(e.Iso={}))}(e.MP4||(e.MP4={}))}(r||(r={})),t.MP4Mux=r.MP4.MP4Mux},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(5);t.MP3ToMP3={getInputFormat:function(){return{mimeType:"audio/mpeg"}},getOutputFormat:function(){return{mimeType:"audio/mpeg"}},transmux:function(e){var t=new r.helpers.abortableJob.AbortableJob(function(){function t(){h.close()}function n(n){c=!0;try{t()}catch(e){}o.reject(n),e.abort()}var o=r.helpers.deferred.buildDeferred(),a=new r.eventDispatcher.EventDispatcher,s=[],l=[],u=!1,c=!1,h=new i.MP3Parser;return h.onFrame=function(e){if(!c)try{l.push(e)}catch(e){n(e)}},e.onProgressUpdate(function(e){var t=e.data;!u&&e.initData&&(t=r.helpers.arrayBuffer.combine([e.initData,e.data])),u=!0;try{if(h.push(t),l.length){var i=r.helpers.arrayBuffer.combine(l);s.push(i),l.splice(0),a.dispatch({data:i})}}catch(e){n(e)}}),e.onCompletion(function(e){try{t(),o.resolve(e)}catch(e){n(e)}}),e.onError(n),{result:o.promise,progressUpdates:{onProgressUpdate:a,getProgressSoFar:function(){return s.length?{data:r.helpers.arrayBuffer.combine(s)}:null}},abort:function(){c=!0,e.abort(),t()}}});return t.run()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(22),o=n(4),a=n(20),s=n(18),l=[i.MP3ToMP3,s.MP4ToMP4,r.PassThrough,o.MP3ToMP4,a.OggOpusToWebm];t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23);t.TransmuxerFactory={retrieveTransmuxers:function(e,t){return i.default.filter(function(n){var i=n.getInputFormat(),o=n.getOutputFormat();return(!e||r.isPartialMatch(i,e))&&(!t||r.isPartialMatch(o,t))})},retrieveTransmuxer:function(e,n){return t.TransmuxerFactory.retrieveTransmuxers(e,n)[0]||null}}},function(e,t,n){"use strict";function r(e){var t=e.byteLength,n=new DataView(e),r=t&&n.getUint8(t-1);if(r){for(var i=t-r,o=new Uint8Array(i),a=0;a<i;a++)o[a]=n.getUint8(a);return o.buffer}return e}t.__esModule=!0,t.removePadding=r;var i=t.AESDecryptor=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},e.prototype.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],o=n[2],a=n[3],s=this.invSubMix,l=s[0],u=s[1],c=s[2],h=s[3],d=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)d[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var _=d[f],v=d[_],y=d[v],b=257*d[g]^16843008*g;r[f]=b<<24|b>>>8,i[f]=b<<16|b>>>16,o[f]=b<<8|b>>>24,a[f]=b,b=16843009*y^65537*v^257*_^16843008*f,l[g]=b<<24|b>>>8,u[g]=b<<16|b>>>16,c[g]=b<<8|b>>>24,h[g]=b,f?(f=_^d[d[d[y^_]]],p^=d[d[p]]):f=p=1}},e.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o=this.ksRows=4*(i+6+1),a=void 0,s=void 0,l=this.keySchedule=new Uint32Array(o),u=this.invKeySchedule=new Uint32Array(o),c=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],m=d[2],g=d[3],_=void 0,v=void 0;for(a=0;a<o;a++)a<i?_=l[a]=t[a]:(v=_,a%i===0?(v=c[(v=v<<8|v>>>24)>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v],v^=h[a/i|0]<<24):i>6&&a%i===4&&(v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v]),l[a]=_=(l[a-i]^v)>>>0);for(s=0;s<o;s++)a=o-s,v=3&s?l[a]:l[a-4],u[s]=s<4||a<=4?v:f[c[v>>>24]]^p[c[v>>>16&255]]^m[c[v>>>8&255]]^g[c[255&v]],u[s]=u[s]>>>0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,n,i){for(var o=this.keySize+6,a=this.invKeySchedule,s=this.invSBox,l=this.invSubMix,u=l[0],c=l[1],h=l[2],d=l[3],f=this.uint8ArrayToUint32Array_(n),p=f[0],m=f[1],g=f[2],_=f[3],v=new Int32Array(e),y=new Int32Array(v.length),b=void 0,E=void 0,x=void 0,T=void 0,S=void 0,A=void 0,P=void 0,M=void 0,R=void 0,C=void 0,w=void 0,O=void 0,I=void 0,D=void 0,L=this.networkToHostOrderSwap;t<v.length;){for(R=L(v[t]),C=L(v[t+1]),w=L(v[t+2]),O=L(v[t+3]),S=R^a[0],A=O^a[1],P=w^a[2],M=C^a[3],I=4,D=1;D<o;D++)b=u[S>>>24]^c[A>>16&255]^h[P>>8&255]^d[255&M]^a[I],E=u[A>>>24]^c[P>>16&255]^h[M>>8&255]^d[255&S]^a[I+1],x=u[P>>>24]^c[M>>16&255]^h[S>>8&255]^d[255&A]^a[I+2],T=u[M>>>24]^c[S>>16&255]^h[A>>8&255]^d[255&P]^a[I+3],S=b,A=E,P=x,M=T,I+=4;b=s[S>>>24]<<24^s[A>>16&255]<<16^s[P>>8&255]<<8^s[255&M]^a[I],E=s[A>>>24]<<24^s[P>>16&255]<<16^s[M>>8&255]<<8^s[255&S]^a[I+1],x=s[P>>>24]<<24^s[M>>16&255]<<16^s[S>>8&255]<<8^s[255&A]^a[I+2],T=s[M>>>24]<<24^s[S>>16&255]<<16^s[A>>8&255]<<8^s[255&P]^a[I+3],I+=3,y[t]=L(b^p),y[t+1]=L(T^m),y[t+2]=L(x^g),y[t+3]=L(E^_),p=R,m=C,g=w,_=O,t+=4}return i?r(y.buffer):y.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(25),o=null;t.JSCrypto={canDecrypt:function(e){return"AES-CBC"===e.cipher},decrypt:function(e,t){o||(o=new i.AESDecryptor);var n=o,a=new r.helpers.abortableJob.AbortableJob(function(){var o,a=new r.eventDispatcher.EventDispatcher,s=r.helpers.deferred.buildDeferred(),l=[],u=null,c=[],h=0,d=new Uint8Array(t.iv),f=!1;return n.expandKey(t.key.buffer),e.onProgressUpdate(function(e){f||(r.helpers.arrayBuffer.forEach(e,function(e){f||(h||(o=new Uint8Array(16)),o[h++]=e,16===h&&(c.push(o),h=0))}),c.length&&(function(e){var t=u;u=new Uint8Array(n.decrypt(e.buffer,0,d.buffer,!1));var r=e.byteLength-16;if(r<0)throw new Error("lastBlockOffset invalid.");for(var i=0;i<16;i++)d[i]=e[r+i];t&&(l.push(t),a.dispatch(t))}(r.helpers.arrayBuffer.combine(c)),c=[]))}),e.onCompletion(function(e){if(!f)if(h)s.reject(new Error("Reached end part way through block."));else{if(u){var t=new Uint8Array(i.removePadding(u.buffer));l.push(t),a.dispatch(t)}s.resolve(e)}}),e.onError(s.reject),{result:s.promise,abort:function(){f=!0,e.abort()},progressUpdates:{onProgressUpdate:a,getProgressSoFar:function(){return r.helpers.arrayBuffer.combine(l)}}}});return a.run()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(26),i=[r.JSCrypto];t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(27),o=r.helpers.find;t.DecryptorFactory={retrieveDecryptor:function(e){return o(i.default,function(t){return t.canDecrypt(e)})||null}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(28),o=n(7);t.getSegmentDownloadAndDecryptJob=function(e){var t=e.encryptionConfig,n=e.downloadAbortableJob,a=e.logger;return new r.helpers.abortableJob.AbortableJob(function(){var e=new r.eventDispatcher.EventDispatcher,s=r.helpers.deferred.buildDeferred(),l=null;if(t&&(a.info("Finding a decryptor..."),!(l=i.DecryptorFactory.retrieveDecryptor(t))))return a.error("Could not find a decryptor."),s.reject(new o.NoDecryptorError),{result:s.promise,progressUpdates:{onProgressUpdate:e,getProgressSoFar:function(){return null}}};var u=n.run(),c=null,h=[];return t&&l?((c=l.decrypt(u,t)).onProgressUpdate(function(t){h.push(t),e.dispatch(t)}),c.onError(function(e){e!==r.helpers.abortableJob.abortedError&&a.error("Error occurred during decryption.",e),s.reject(e),u.abort()})):u.onProgressUpdate(function(t){h.push(t),e.dispatch(t)}),u.onCompletion(function(){var e=function(){return s.resolve(void 0)};c?c.whenComplete().then(function(){return e()}):e()}),u.onError(s.reject),{result:s.promise,progressUpdates:{onProgressUpdate:e,getProgressSoFar:function(){return h.length?r.helpers.arrayBuffer.combine(h):null}},abort:function(){u.abort(),c&&c.abort()}}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(8);t.getSegmentDownloadJob=function(e){var t=e.delayCalculator,n=e.segmentEventRepresentation,o=e.url,a=e.loader,s=e.onSegmentRequestQueued,l=e.onSegmentRequestStart,u=e.onSegmentRequestFailed,c=e.onSegmentRetrieved,h=e.isResponseCodeAcceptable,d=e.isResponseCodeRetryable,f=e.logger;return new r.helpers.abortableJob.AbortableJob(function(){var e=r.helpers.deferred.buildDeferred(),p=new r.eventDispatcher.EventDispatcher,m=[],g=0,_=r.helpers.retry.retry(t,function(t){var _=t.scheduleRetry,v=!1,y=0;s.dispatch({segment:n}),f.debug("Requesting segment.",o);var b=a.request({url:o});b.onRequestStart(function(){return l.dispatch({segment:n})});var E=function(e){var t=e.byteLength;if(t)if((y+=t)<=g)f.debug("Already downloaded this part. Skipping...",y,g);else{var n=t-(y-g),r=new Uint8Array(e,n);g=y,m.push(r),p.dispatch(r)}};return b.onProgress(function(t){var r=t.initial,a=t.statusCode,s=t.part;if(r)if(h(a))f.debug("Segment response started.",o,a),E(s);else{var l=null;d(a)?f.debug("Segment response code was not acceptable. Will retry.",o,a):(f.debug("Segment response code was not acceptable.",o,a),l=new i.UnacceptableResponseStatusCodeError(a)),b.abort(),u.dispatch({segment:n,statusCode:a}),l?e.reject(l):(v=!0,_())}else f.debug("Got segment response part.",o,a),E(s)}),b.onResponseReceived(function(t){v||(t?(c.dispatch({segment:n,statusCode:t.statusCode}),e.resolve(void 0)):(f.warn("Segment request timed out.",o),u.dispatch({segment:n,statusCode:null}),_()))}),b.onError(function(t){v||t!==r.helpers.abortableJob.abortedError&&(t instanceof r.loaderErrors.LoaderError?(f.warn("Error from loader. Will retry",o,t),_()):(f.error("Unexpected error when requesting segment.",t),e.reject(t)))}),{onCancel:function(){f.debug("Aborting segment request.",o),b.hasCompleted()||b.abort(),u.dispatch({segment:n,aborted:!0})}}},{onNoMoreRetries:function(){return e.reject(new Error("No more retries for requesting segment."))}}).cancel;return{result:e.promise,progressUpdates:{onProgressUpdate:p,getProgressSoFar:function(){return m.length?r.helpers.arrayBuffer.combine(m):null}},abort:function(){return _()}}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.DefaultSegmentParser={getFormat:function(){return{}},parseSegmentData:function(e){return r.helpers.abortableJob.map(function(){return e},{convertProgressUpdate:function(e){return{data:e}},convertResult:function(e){return e}}).run()}}},function(e,t,n){"use strict";function r(e){var t=o.retrievePages(e).pages;if(t.length){var n=o.retrievePackets([t[0]])[0];if(n&&n.first){var r=1,i=t.slice(1).some(function(e,t){var n=!!(1&e.header.type[0]);return t>0&&!n||(r=t+2,!1)}),a=s(t.slice(0,r).map(function(e){return e.entirePage}));return{state:"PRESENT",initData:a,initDataEnded:i}}return{state:"NOT_PRESENT"}}return null}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(3),a=i.helpers.abortableJob.AbortableJob,s=i.helpers.arrayBuffer.combine,l=new i.helpers.SCWeakMap;t.OggOpusSegmentParser={getFormat:function(){return{mimeType:"audio/ogg",audioCodec:{id:"opus"}}},parseSegmentData:function(e,n,o){var u=new a(function(){var a=i.helpers.deferred.buildDeferred(),u=new i.eventDispatcher.EventDispatcher,c=[],h=null,d=null,f=null,p=function(t){a.reject(t),e.abort()},m=function(e){l.set(o,e),u.dispatch({initData:e,data:s(c)})};return e.onProgressUpdate(function(e){if(h&&"PRESENT"===h.state&&h.initDataEnded)c.push(e),u.dispatch({initData:h.initData,data:e});else if(h&&"NOT_PRESENT"===h.state)c.push(e);else{c.push(e);var a=s(c);if(h=r(a))if("NOT_PRESENT"===h.state){var g=l.get(o);n.getSequenceNumber()<=o.getFirstSegmentIndex()?p(new Error("Could not find init data.")):g?m((h={state:"PRESENT",initData:g,initDataEnded:!0}).initData):((d=o.getSegment(o.getFirstSegmentIndex())).onCompletion(function(e){var n=f=t.OggOpusSegmentParser.parseSegmentData(i.helpers.abortableJob.map(function(){return e.retrieveData()},{convertProgressUpdate:function(e){return e.initData?i.helpers.arrayBuffer.combine([e.initData,e.data]):e.data},convertResult:function(e){return e}}).run(),e,o);n.onProgressUpdate(function(e){var t=e.initData;if(n.abort(),!t){var r=new Error("OggOpusSegmentParser should always provide init data.");throw p(r),r}h={state:"PRESENT",initData:t,initDataEnded:!0},m(t)}),n.onError(function(e){e!==i.helpers.abortableJob.abortedError&&p(e)})}),d.onError(p))}else if("PRESENT"===h.state&&h.initDataEnded){if(c.splice(0),a.byteLength>h.initData.byteLength){var _=new Uint8Array(a.buffer.slice(h.initData.byteLength));c.push(_)}m(h.initData)}}}),e.onCompletion(function(e){h&&"PRESENT"===h.state&&!h.initDataEnded?(m(h.initData),a.resolve(e)):h&&"PRESENT"===h.state?a.resolve(e):a.reject(new Error("Could not find init data."))}),e.onError(p),{result:a.promise,progressUpdates:{onProgressUpdate:u,getProgressSoFar:function(){return h&&"PRESENT"===h.state&&h.initDataEnded?{initData:h.initData,data:s(c)}:null}},abort:function(){e.abort(),d&&d.abort(),f&&f.abort()}}});return u.run()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(32),i=n(31),o=[r.OggOpusSegmentParser,i.DefaultSegmentParser];t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(2),o=n(33),a=r.helpers.find;t.SegmentParserFactory={retrieveSegmentParser:function(e){var t=a(o.default,function(t){return i.isPartialMatch(t.getFormat(),e)});if(!t)throw new Error("No segment parser found.");return t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(9),o=n(34),a=n(30),s=n(29),l=r.helpers.abortableJob.AbortableJob,u=r.eventDispatcher.EventDispatcher,c=r.logger.noOpLogger,h=function(){function e(e){var t=e.url,n=e.sequenceNumber,h=e.playlist,d=e.timeRange,f=e.encryptionConfig,p=e.initData,m=e.format,g=e.loader,_=e.playlistEventRepresentation,v=e.logger,y=void 0===v?c:v,b=e.delayCalculator,E=void 0===b?r.helpers.retry.buildExponentialDelayCalculator():b,x=e.isResponseCodeAcceptable,T=void 0===x?function(e){return 200===e}:x,S=e.isResponseCodeRetryable,A=void 0===S?function(e){return!(e>=400&&e<500)}:S,P=this;this._onSegmentRequestQueued=new u,this._onSegmentRequestStart=new u,this._onSegmentRetrieved=new u,this._onSegmentRequestFailed=new u,this.onSegmentRequestQueued=this._onSegmentRequestQueued.getHandle(),this.onSegmentRequestStart=this._onSegmentRequestStart.getHandle(),this.onSegmentRetrieved=this._onSegmentRetrieved.getHandle(),this.onSegmentRequestFailed=this._onSegmentRequestFailed.getHandle(),this._sequenceNumber=n,this._playlist=h,this._timeRange=d,this._format=m;var M=this._segmentEventRepresentation=new i.Segment(_,t,n),R=a.getSegmentDownloadJob({delayCalculator:E,segmentEventRepresentation:M,url:t,loader:g,onSegmentRequestQueued:this._onSegmentRequestQueued,onSegmentRequestStart:this._onSegmentRequestStart,onSegmentRequestFailed:this._onSegmentRequestFailed,onSegmentRetrieved:this._onSegmentRetrieved,isResponseCodeAcceptable:T,isResponseCodeRetryable:A,logger:y}),C=s.getSegmentDownloadAndDecryptJob({encryptionConfig:f,downloadAbortableJob:R,logger:y});this._retrieveAbortableJob=new l(function(){var e=o.SegmentParserFactory.retrieveSegmentParser(P._format),t=new u,n=r.helpers.deferred.buildDeferred(),i=e.parseSegmentData(r.helpers.abortableJob.map(function(){return C.run()},{convertProgressUpdate:function(e,t){return t&&p?r.helpers.arrayBuffer.combine([p,e]):e},convertResult:function(e){return e}}).run(),P,P._playlist);return i.onProgressUpdate(t.dispatch,{skipPast:!0}),i.onCompletion(function(){return n.resolve(void 0)}),i.onError(n.reject),{result:n.promise,progressUpdates:{onProgressUpdate:t,getProgressSoFar:i.getProgressSoFar},abort:i.abort}})}return e.prototype.getFormat=function(){return this._format},e.prototype.getSequenceNumber=function(){return this._sequenceNumber},e.prototype.isFinalSegment=function(){var e=this._playlist;return e.hasEnded()&&e.getFirstSegmentIndex()+e.getSegmentCount()-1===this._sequenceNumber},e.prototype.getTimeRange=function(){return this._timeRange},e.prototype.getEventRepresentation=function(){return this._segmentEventRepresentation},e.prototype.retrieveData=function(){var e=this,t=new l(function(){var t=r.helpers.deferred.buildDeferred(),n=new u,i=[],o=e._retrieveAbortableJob.run(),a=void 0;return o.onProgressUpdate(function(e){var t=e.data,r=e.initData;i.length||(a=r),i.push(t),n.dispatch({data:t,initData:a})}),o.onCompletion(function(){t.resolve(void 0)}),o.onError(t.reject),{result:t.promise,progressUpdates:{onProgressUpdate:n,getProgressSoFar:function(){return i.length?{initData:a,data:r.helpers.arrayBuffer.combine(i)}:null}},abort:function(){return o.abort()}}});return t.run()},e}();t.Segment=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=r.eventDispatcher.EventDispatcher;!function(e){e[e.LIVE=0]="LIVE",e[e.EVENT=1]="EVENT",e[e.VOD=2]="VOD"}(t.PlaylistType||(t.PlaylistType={}));var o=function(){function e(){this._onPlaylistRequestQueued=new i,this._onPlaylistRequestStart=new i,this._onPlaylistRetrieved=new i,this._onPlaylistRequestFailed=new i,this._onPlaylistParseStart=new i,this._onPlaylistParseEnd=new i,this._onKeyRequestQueued=new i,this._onKeyRequestStart=new i,this._onKeyRetrieved=new i,this._onKeyRequestFailed=new i,this._onInitDataRequestQueued=new i,this._onInitDataRequestStart=new i,this._onInitDataRetrieved=new i,this._onInitDataRequestFailed=new i,this._onUpdated=new i,this.onPlaylistRequestQueued=this._onPlaylistRequestQueued.getHandle(),this.onPlaylistRequestStart=this._onPlaylistRequestStart.getHandle(),this.onPlaylistRetrieved=this._onPlaylistRetrieved.getHandle(),this.onPlaylistRequestFailed=this._onPlaylistRequestFailed.getHandle(),this.onPlaylistParseStart=this._onPlaylistParseStart.getHandle(),this.onPlaylistParseEnd=this._onPlaylistParseEnd.getHandle(),this.onKeyRequestQueued=this._onKeyRequestQueued.getHandle(),this.onKeyRequestStart=this._onKeyRequestStart.getHandle(),this.onKeyRetrieved=this._onKeyRetrieved.getHandle(),this.onKeyRequestFailed=this._onKeyRequestFailed.getHandle(),this.onInitDataRequestQueued=this._onInitDataRequestQueued.getHandle(),this.onInitDataRequestStart=this._onInitDataRequestStart.getHandle(),this.onInitDataRetrieved=this._onInitDataRetrieved.getHandle(),this.onInitDataRequestFailed=this._onInitDataRequestFailed.getHandle(),this.onUpdated=this._onUpdated.getHandle()}return e.prototype.update=function(){var e=this,t=this._update();return t.onCompletion(function(){return e._onUpdated.dispatch(void 0)}),t},e.prototype.getSegment=function(e){return this.getSegments(e,e+1)[0]},e.prototype.getSegments=function(e,t){var n=this.getSegmentCount(),r=this.getFirstSegmentIndex();if(void 0===t&&(t=r+n),void 0===e&&(e=r),e<r||t<e||t>r+n)throw new Error("Invalid range of segments.");for(var i=[],o=e;o<t;o++)i.push(this._getSegment(o));return i},e}();t.Playlist=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(3),a=n(10),s=n(2),l=i.helpers.find,u=i.eventDispatcher.EventDispatcher,c=i.helpers.abortableJob.abortedError,h=i.logger.prefixLogger,d=i.logger.noOpLogger;!function(e){e[e.RETRIEVING_SEGMENT=0]="RETRIEVING_SEGMENT",e[e.RETRIEVED_SEGMENT=1]="RETRIEVED_SEGMENT",e[e.RETRIEVING_DATA=2]="RETRIEVING_DATA",e[e.COMPLETE=3]="COMPLETE"}(r||(r={}));var f=function(){function e(e){this._onSegmentRequestQueued=new u,this._onSegmentRequestStart=new u,this._onSegmentRetrieved=new u,this._onSegmentRequestFailed=new u,this._onSegmentDataRetrieveStarted=new u,this._onSegmentReady=new u,this._onError=new u,this._segments=[],this._retrievingSegment=null,this._timerId=null,this._dead=!1;var t=e.playlist,n=e.getPosition,r=e.maxBufferLength,i=e.cacheSize,o=e.transmuxer,a=e.logger,s=void 0===a?d:a;if(this._logger=h(s,"PlaylistSegmentRetriever"),t&&!t.hasInitialUpdateCompleted())throw new Error("Playlist retrieve has not completed.");if(r<0)throw new Error("Max buffer length must be > 0.");if(i<0)throw new Error("Cache size must be > 0.");this.onSegmentRequestQueued=this._onSegmentRequestQueued.getHandle(),this.onSegmentRequestStart=this._onSegmentRequestStart.getHandle(),this.onSegmentRetrieved=this._onSegmentRetrieved.getHandle(),this.onSegmentRequestFailed=this._onSegmentRequestFailed.getHandle(),this.onSegmentDataRetrieveStarted=this._onSegmentDataRetrieveStarted.getHandle(),this.onSegmentReady=this._onSegmentReady.getHandle(),this.onError=this._onError.getHandle(),this._playlist=t,this._transmuxer=o,this._getPosition=n,this._maxBufferLength=r,this._cacheSize=i,this.update()}return e.prototype.updateMaxBufferLength=function(e){if(this._ensureNotDead(),e<0)throw new Error("Max buffer length must be > 0.");this._logger.debug("updateMaxBufferLength() called.",e),this._maxBufferLength=e,this.update()},e.prototype.updateCacheSize=function(e){if(this._ensureNotDead(),e<0)throw new Error("Cache size must be > 0.");this._cacheSize=e,this.update()},e.prototype.getCacheSize=function(){return this._cacheSize},e.prototype.getCacheUsage=function(){return this._segments.reduce(function(e,t){return t.state===r.RETRIEVING_DATA||t.state===r.COMPLETE?e+t.size:e},0)},e.prototype.switchPlaylist=function(e){if(this._ensureNotDead(),e&&!e.hasInitialUpdateCompleted())throw new Error("Playlist retrieve has not completed.");this._logger.debug("switchPlaylist() called."),this._abortCurrentRetrieve(),this._playlist=e,this._segments=this._segments.filter(function(e){return e.state===r.COMPLETE}),this.update()},e.prototype.getSegmentsWithData=function(){return this._ensureNotDead(),this._segments.filter(function(e){return e.state===r.RETRIEVING_DATA&&e.size||e.state===r.COMPLETE}).map(function(e){var t=e.segment,n=e.dataRetrieveJob;return{segment:t,dataRetrieveJob:n,complete:e.state===r.COMPLETE}})},e.prototype.update=function(){var e=this;this._ensureNotDead(),this._timerId&&(window.clearTimeout(this._timerId),this._timerId=null);var t=this._getPosition(),n=t,i=0;this._segments.some(function(e){if(e.state!==r.COMPLETE)return!1;var o=e.segment.getTimeRange();return o.containsTime(i)&&(i=o.end),!(o.end<t)&&(o.start>n||(n=o.end,!1))});var o=t+this._maxBufferLength,a=function(){var t=e._playlist;if(t){var r=t.hasEnded()&&n===t.getDuration();if(r)return n=i,t.getDuration()+i<o}return n<o}();if(!a)return this._abortCurrentRetrieve(),this._garbageCollect(t),void this._scheduleNextUpdate();var s=l(this._segments,function(e){if(e.state===r.RETRIEVED_SEGMENT||e.state===r.RETRIEVING_DATA){var t=e.segment.getTimeRange();return t.containsTime(n)}return!1});s?this._retrieveSegmentData(s):this._retrieveSegment(n),this._garbageCollect(t)},e.prototype.kill=function(){this._dead||(this._logger.debug("kill() called."),this._abortCurrentRetrieve(),this._dead=!0,this._timerId&&(this._logger.debug("Cancelling update timer."),window.clearTimeout(this._timerId)),this._segments=[],this._logger.debug("Killed."))},e.prototype._retrieveSegmentData=function(e){var t=this;if(e.state!==r.RETRIEVED_SEGMENT&&e.state!==r.RETRIEVING_DATA)throw new Error("Segment in incorrect state for data to be retrieved.");if(!this._retrievingSegment||this._retrievingSegment.state!==r.RETRIEVING_DATA||e.segment!==this._retrievingSegment.segment){this._abortCurrentRetrieve();var n=i.helpers.abortableJob.map(function(){return t._transmuxer.transmux(e.segment.retrieveData())},{convertResult:function(e){return e},convertProgressUpdate:function(e){return e},abortableJobOpts:{storeResult:!0}}),s=n.run(),l=!1,u=this._retrievingSegment={state:r.RETRIEVING_DATA,dataRetrieveJob:n,dataRetrieveJobHandle:s,segment:e.segment,size:0};this._switchSegment(e,u),s.onProgressUpdate(function(r){var i=u.size,o=i;!l&&r.initData&&(i+=r.initData.byteLength),l=!0,i+=r.data.byteLength,u.size=i,0===o&&i>0&&t._onSegmentDataRetrieveStarted.dispatch({segment:e.segment,dataRetrieveJob:n,complete:!1})}),s.onCompletion(function(){if(t._retrievingSegment=null,u.state!==r.RETRIEVING_DATA)throw new Error("Incorrect retrieval state.");t._switchSegment(u,{state:r.COMPLETE,dataRetrieveJob:u.dataRetrieveJob,dataRetrieveJobHandle:u.dataRetrieveJobHandle,segment:e.segment,size:u.size}),t._logger.debug("Segment retrieve completed.",e.segment.getEventRepresentation()),t.update(),t._onSegmentReady.dispatch({segment:e.segment,complete:!0,dataRetrieveJob:u.dataRetrieveJob})}),s.onError(function(n){n!==c&&(t._logger.error("Error retrieving segment data.",n,e.segment.getEventRepresentation()),t._scheduleNextUpdate(),n instanceof o.OggParserError&&(n=n instanceof o.ChecksumFailedError?new a.OggParserError("CHECKSUM_FAILED"):n instanceof o.NoSegmentsInPageError?new a.OggParserError("NO_SEGMENTS_IN_PAGE"):n instanceof o.PageFromDifferentBitstreamError?new a.OggParserError("PAGE_FROM_DIFFERENT_BITSTREAM"):n instanceof o.PageSequenceNumberDidNotIncrementError?new a.OggParserError("SEQUENCE_NUMBER_DID_NOT_INCREMENT"):n instanceof o.UnexpectedBOSError?new a.OggParserError("UNEXPECTED_BOS"):n instanceof o.UnexpectedEOSError?new a.OggParserError("UNEXPECTED_EOS"):new a.OggParserError("UNKNOWN")),t._onError.dispatch(n))})}},e.prototype._retrieveSegment=function(e){var t=this,n=this._retrievingSegment,i=this._playlist,o=i?i.getSegmentIndexContainingTime(e):null;if(!n||n.state!==r.RETRIEVING_SEGMENT||n.segmentIndex!==o)if(this._abortCurrentRetrieve(),i)if(null===o)this._scheduleNextUpdate();else{var a=i.getSegment(o);this._logger.debug("Retrieving segment.",o),a.onCompletion(function(e){if(t._logger.debug("Retrieved segment.",o),!s.isPartialMatch(t._transmuxer.getInputFormat(),e.getFormat())){var n=new Error("Segment format is not supported by transmuxer.");return t._logger.error("Segment incorrect format.",n),t._scheduleNextUpdate(),void t._onError.dispatch(n)}e.onSegmentRequestQueued.subscribe(t._onSegmentRequestQueued.dispatch),e.onSegmentRequestStart.subscribe(t._onSegmentRequestStart.dispatch),e.onSegmentRetrieved.subscribe(t._onSegmentRetrieved.dispatch),e.onSegmentRequestFailed.subscribe(t._onSegmentRequestFailed.dispatch),t._segments.splice(t._segments.indexOf(l),1);var i=e.getTimeRange(),a=t._segments.length;t._segments.some(function(e,t){return e.state!==r.RETRIEVING_SEGMENT&&e.segment.getTimeRange().start>i.start&&(a=t,!0)}),t._segments.splice(a,0,{state:r.RETRIEVED_SEGMENT,segment:e}),t._retrievingSegment=null,t.update()}),a.onError(function(e){e!==c&&(t._logger.error("Error retrieving segment.",e),t._scheduleNextUpdate(),t._onError.dispatch(e))});var l={state:r.RETRIEVING_SEGMENT,segmentIndex:o,segmentRetrieveJob:a};this._segments.push(l),this._retrievingSegment=l}else this._logger.debug("Cannot retrieve segment as there is no playlist."),this._scheduleNextUpdate()},e.prototype._abortCurrentRetrieve=function(){var e=this._retrievingSegment;e&&(e.state===r.RETRIEVING_SEGMENT?(this._logger.debug("Aborting segment retrieve job."),e.segmentRetrieveJob.abort()):e.state===r.RETRIEVING_DATA&&(this._logger.debug("Aborting segment data retrieve job."),e.dataRetrieveJobHandle.abort(),this._switchSegment(e,{state:r.RETRIEVED_SEGMENT,segment:e.segment})),this._retrievingSegment=null)},e.prototype._switchSegment=function(e,t){var n=this._segments.indexOf(e);if(-1===n)throw new Error("Old segment missing.");this._segments.splice(n,1,t)},e.prototype._garbageCollect=function(e){var t=this._segments,n=this._cacheSize,i=this.getCacheUsage();if(!(i<=n)){var o=this._playlist,a=o&&o.getCompleteDuration(),s=null!==a?a:1/0,l=e+this._maxBufferLength;l>s&&(l-=s)>=e||t.filter(function(t){return t.state===r.COMPLETE&&!function(e,t,n){var r=e.getTimeRange();return n!==t&&(n>t?r.end>t&&r.start<n:r.end>t||r.start<n)}(t.segment,e,l)}).map(function(t){var n=t.segment.getTimeRange(),r=n.start,i=Math.min(Math.abs(e-r),r+s-e);return{segment:t,distance:i,size:t.size}}).sort(function(e,t){return t.distance-e.distance}).some(function(e){return i<=n||(t.splice(t.indexOf(e.segment),1),i-=e.size,!1)})}},e.prototype._scheduleNextUpdate=function(){var e=this;this._timerId||(this._timerId=window.setTimeout(function(){e._timerId=null,e.update()},1e3))},e.prototype._ensureNotDead=function(){if(this._dead)throw new Error("Playlist segment retriever has been killed.")},e}();t.PlaylistSegmentRetriever=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819;var r=n(37);t.PlaylistSegmentRetriever=r.PlaylistSegmentRetriever;var i=n(36);t.Playlist=i.Playlist,t.PlaylistType=i.PlaylistType;var o=n(35);t.Segment=o.Segment;var a=n(24);t.TransmuxerFactory=a.TransmuxerFactory;var s=n(4);t.MP3ToMP4Transmuxer=s.MP3ToMP4;var l=n(6);t.PassThroughTransmuxer=l.PassThrough;var u=n(17);t.retrievalErrors=u.retrievalErrors;var c=n(14);t.events=c.events}])}(n(2),n(8),n(9))},function(e,t,n){window,e.exports=function(e){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=11)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._msg=e}return e.prototype.getMsg=function(){return this._msg},e}();t.OggParserError=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i.OggParserError);t.IncompletePageError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i.OggParserError);t.NoSegmentsInPageError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i.OggParserError);t.UnexpectedEOSError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i.OggParserError);t.UnexpectedBOSError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i.OggParserError);t.PageSequenceNumberDidNotIncrementError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i.OggParserError);t.PageFromDifferentBitstreamError=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(i.OggParserError);t.ChecksumFailedError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new Uint32Array([0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]);t.calculateCRC=function(e){var t=0;return e.forEach(function(e){for(var n=0;n<e.length;n++)t=t<<8^r[t>>24&255^e[n]]}),t>>>0}},function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e,t,n){if(void 0===n&&(n=1),t<0||t+n>e.byteLength)throw new Error("extract() out of bounds. "+t+" "+n+" "+e.byteLength);return e.slice(t,t+n)}function i(e,t){return void 0===t&&(t=!0),new DataView(e).getUint32(0,t)}function o(e){var t=new Uint8Array(e.buffer,e.byteOffset),n=t.byteLength;if(n<v)throw new p.IncompletePageError("Incomplete page.");var o=r(t,26);if(n<v+o[0])throw new p.IncompletePageError("Incomplete page.");var a=r(t,v,o[0]),u={version:r(t,4),type:r(t,5),granulePosition:r(t,6,8),bitstreamSerialNumber:r(t,14,4),pageSequenceNumber:r(t,18,4),checksum:r(t,22,4),pageSegments:o,segmentTable:a},c=[],h=v+o[0];if(a.forEach(function(e){if(n<h+e)throw new p.IncompletePageError("Incomplete page.");c.push(r(t,h,e)),h+=e}),!c.length)throw new f.NoSegmentsInPageError("No segments.");var d=s.calculateCRC([g,u.version,u.type,u.granulePosition,u.bitstreamSerialNumber,u.pageSequenceNumber,_,o,a].concat(c)),m=i(u.checksum.buffer);if(d!==m)throw new l.ChecksumFailedError("Checksum failed.");return{header:u,segments:c,entirePage:r(t,0,h)}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),s=n(8),l=n(7),u=n(6),c=n(5),h=n(4),d=n(3),f=n(2),p=n(1),m=a.helpers.arrayBuffer.combine,g=new Uint8Array([79,103,103,83]),_=new Uint8Array([0,0,0,0]),v=27;t.retrievePages=function(e){for(var t=e.buffer,n=[],r=e.byteOffset,i=!0;r<e.byteOffset+e.byteLength;){var a=new DataView(t,r);try{var s=o(a);n.push(s),r+=s.entirePage.byteLength}catch(e){if(e instanceof p.IncompletePageError){i=!1;break}throw e}}return{pages:n,eos:i}},t.parsePage=o,t.retrievePackets=function(e){if(!e.length)return[];var t=i(e[0].header.bitstreamSerialNumber.buffer),n=-1,r=null,o=[];return e.forEach(function(a,s){if(i(a.header.bitstreamSerialNumber.buffer)!==t)throw new u.PageFromDifferentBitstreamError("Got a page from a different bitstream.");var l=i(a.header.pageSequenceNumber.buffer);if(l<=n)throw new c.PageSequenceNumberDidNotIncrementError("Page sequence number was not greater than the previous one.");var f=l!==n+1;n=l;var p=a.header.type[0],g=!!(1&p),_=!!(2&p);if(_&&s>0)throw new h.UnexpectedBOSError("Got BOS on a page which is not the first.");var v=!!(4&p);if(v&&s!==e.length-1)throw new d.UnexpectedEOSError("Got EOS on a page which is not the last.");var y=0;f&&(r=null);var b=a.segments.length;a.segments.forEach(function(e,t){if(r?r.data=m([r.data,e]):g&&0===t||(r={granulePosition:null,pageSequenceNumber:n,packetOffset:y,discontinuity:f&&0===y,first:_&&0===y,last:!1,data:e},y++),r&&e.byteLength<255){var s=t===b-1;s&&(r.granulePosition=i(a.header.granulePosition.buffer)),r.last=v&&s,o.push(r),r=null}})}),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(10));var r=n(0);t.OggParserError=r.OggParserError;var i=n(7);t.ChecksumFailedError=i.ChecksumFailedError;var o=n(2);t.NoSegmentsInPageError=o.NoSegmentsInPageError;var a=n(6);t.PageFromDifferentBitstreamError=a.PageFromDifferentBitstreamError;var s=n(5);t.PageSequenceNumberDidNotIncrementError=s.PageSequenceNumberDidNotIncrementError;var l=n(4);t.UnexpectedBOSError=l.UnexpectedBOSError;var u=n(3);t.UnexpectedEOSError=u.UnexpectedEOSError;var c=n(1);t.IncompletePageError=c.IncompletePageError}])}(n(2))},function(e,t,n){window,e.exports=function(e){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=r.helpers.arrayBuffer,o=i.combine,a=i.numberToUint8Array,s=i.createVintBuffer;t.IDS={EBML:440786851,EBMLVersion:17030,EBMLReadVersion:17143,EBMLMaxIDLength:17138,EBMLMaxSizeLength:17139,DocType:17026,DocTypeVersion:17031,DocTypeReadVersion:17029,Segment:408125543,Info:357149030,Duration:17545,Tracks:374648427,TrackEntry:174,TrackNumber:215,TrackUID:29637,FlagLacing:156,CodecID:134,CodecDelay:22186,SeekPreRoll:22203,TrackType:131,Audio:225,Channels:159,SamplingFrequency:181,CodecPrivate:25506,Cluster:524531317,Timecode:231,SimpleBlock:163},t.encodeElement=function(e,t){var n=a(e),r=s(t.byteLength);return o([n,r,t])}},function(e,t,n){"use strict";function r(e){var t=e[0]>>>3&31;if(t>=c.length)throw new Error("Invalid configuration.");return c[t]}function i(e){if(!e.first)throw new Error("OpusHead is always in the first packet.");var t=e.data,n=new DataView(t.buffer),r=n.getUint8(9),i=n.getUint8(18),o=void 0,a=void 0,s=void 0;if(i>0){o=n.getUint8(18),a=n.getUint8(19),s=[];for(var l=0;l<r;l++)s.push(n.getUint8(20+l))}return{version:n.getUint8(8),channelCount:r,preSkip:n.getUint16(10,!0),inputSampleRate:n.getUint32(12,!0),outputGain:n.getInt16(16,!0)*Math.pow(2,-8),channelMapFamily:i,streamCount:o,twoChannelStreamCount:a,channelMappingTable:s}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(1),s=o.helpers.arrayBuffer,l=s.combine,u=s.numberToUint8Array,c=[10,20,40,60,10,20,40,60,10,20,40,60,10,20,10,20,2.5,5,10,20,2.5,5,10,20,2.5,5,10,20,2.5,5,10,20];t.parseOpusHead=i,t.setOutputGain=function(e,t){if(t>=128||t<-128)throw new Error("outputGainOverride invalid. It must be >= -128 and < 128.");i(e),new DataView(e.data.buffer).setInt16(16,Math.round(t*Math.pow(2,8)),!0)},t.buildWebm=function(e){var t=e[0];if(!t||!t.first)throw new Error("Missing start of stream.");var n=e.slice(2),o=i(t),s=0,c=n.map(function(e){var t=new Uint8Array(4);t[0]=129,new DataView(t.buffer).setInt16(1,s),t[3]=128;var n=function(e){var t=3&e[0];return 0===t?1:3!==t?2:63&e[1]}(e.data);return s+=n*r(e.data),a.encodeElement(a.IDS.SimpleBlock,l([t,e.data]))}),h=l([a.encodeElement(a.IDS.EBML,l([a.encodeElement(a.IDS.EBMLVersion,u(1)),a.encodeElement(a.IDS.EBMLReadVersion,u(1)),a.encodeElement(a.IDS.EBMLMaxIDLength,u(4)),a.encodeElement(a.IDS.EBMLMaxSizeLength,u(8)),a.encodeElement(a.IDS.DocType,new Uint8Array([119,101,98,109])),a.encodeElement(a.IDS.DocTypeVersion,u(1)),a.encodeElement(a.IDS.DocTypeReadVersion,u(2))])),a.encodeElement(a.IDS.Segment,a.encodeElement(a.IDS.Info,a.encodeElement(a.IDS.Duration,function(){var e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,s),e}()))),a.encodeElement(a.IDS.Tracks,a.encodeElement(a.IDS.TrackEntry,l([a.encodeElement(a.IDS.TrackNumber,u(1)),a.encodeElement(a.IDS.TrackUID,u(1)),a.encodeElement(a.IDS.FlagLacing,u(0)),a.encodeElement(a.IDS.CodecID,new Uint8Array([65,95,79,80,85,83])),a.encodeElement(a.IDS.CodecDelay,u(o.preSkip/48e3*1e9)),a.encodeElement(a.IDS.SeekPreRoll,new Uint8Array([4,196,180,0])),a.encodeElement(a.IDS.TrackType,u(2)),a.encodeElement(a.IDS.Audio,l([a.encodeElement(a.IDS.Channels,u(o.channelCount)),a.encodeElement(a.IDS.SamplingFrequency,new Uint8Array([64,231,112,0,0,0,0,0]))])),a.encodeElement(a.IDS.CodecPrivate,t.data)])))]),d=a.encodeElement(a.IDS.Cluster,function(){var e=[a.encodeElement(a.IDS.Timecode,u(0))];return e.push.apply(e,c),l(e)}());return{initData:h,data:d}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(2))}])}(n(2))},function(e,t,n){window,e.exports=function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";function r(e){return 0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1?e.slice(1,-1):e}function i(e){0===e.indexOf("0x")&&(e=e.substr(2));var t=new Uint16Array(8);if(e.length%4!==0)throw new f("Failed to parse IV (length is not multiple of 4).");for(var n=0;n<e.length;n+=4){var r=parseInt(e.substr(n,4),16);if(isNaN(r))throw new f("Failed to parse hex number in IV string.");t[n/4]=r}return new Uint8Array(t)}function o(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}function a(e){return!(e>=400&&e<500)}function s(e){var t,n={};for(M.lastIndex=0;null!==(t=M.exec(e));){var i=t[1].trim().toLowerCase(),o=r(t[2].trim());n[i]=o}return n}var l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var u,c=n(1),h=n(0),d=h.retrievalErrors.UnacceptableResponseStatusCodeError,f=h.retrievalErrors.PlaylistParseError,p=h.retrievalErrors.UnsupportedEncryptionError,m=c.helpers.abortableJob.AbortableJob,g=c.helpers.deferred.buildDeferred,_=c.helpers.cache.buildCache,v=c.helpers.retry,y=v.retry,b=v.buildExponentialDelayCalculator,E=c.helpers.Promise,x=c.helpers.find,T=c.helpers.url,S=c.logger.prefixLogger,A=c.logger.noOpLogger,P=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(MAP):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF): *(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE): *(\d+(?:@\d+(?:\.\d+)?)?)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g,M=/(.+?)=(.+?)(?:,|$)/g,R=/^\d*(\.\d+)?$/;!function(e){e[e.NONE=0]="NONE",e[e.AES_128=1]="AES_128",e[e.SAMPLE_AES=2]="SAMPLE_AES"}(u||(u={}));var C=function(e){function t(t){var n=t.url,r=t.playlistLoader,i=t.segmentLoader,o=t.keyLoader,s=void 0===o?null:o,l=t.segmentFormat,u=t.logger,f=void 0===u?A:u,p=t.delayCalculator,v=void 0===p?b():p,x=t.keyDelayCalculator,T=void 0===x?b():x,P=t.segmentDelayCalculator,M=t.isPlaylistResponseCodeAcceptable,R=void 0===M?function(e){return 200===e}:M,C=t.isPlaylistResponseCodeRetryable,w=void 0===C?a:C,O=t.isSegmentResponseCodeAcceptable,I=void 0===O?function(e){return 200===e}:O,D=t.isSegmentResponseCodeRetryable,L=void 0===D?a:D,F=t.isKeyResponseCodeAcceptable,N=void 0===F?function(e){return 200===e}:F,B=t.isKeyResponseCodeRetryable,U=void 0===B?a:B,k=e.call(this)||this;return k._keyRetrievalJobsCache=_(),k._initDataRetrievalJobsCache=_(),k._data=null,k._lastUpdateTime=null,k._playlistEventRepresentation=null,k._logger=S(f,"PlaylistHLS"),k._url=n,k._playlistLoader=r,k._segmentLoader=i,k._keyLoader=s,k._segmentFormat=l,k._keyDelayCalculator=T,k._isPlaylistResponseCodeAcceptable=R,k._isPlaylistResponseCodeRetryable=w,k._isSegmentResponseCodeAcceptable=I,k._isSegmentResponseCodeRetryable=L,k._isKeyOrInitDataResponseCodeAcceptable=N,k._isKeyOrInitDataResponseCodeRetryable=U,k._segmentDelayCalculator=P,k._downloadAbortableJob=new m(function(){var e=c.helpers.deferred.buildDeferred(),t=y(v,function(t){var r=t.scheduleRetry,i=new h.events.Playlist(n);k._onPlaylistRequestQueued.dispatch({playlist:i});var o=k._playlistLoader.request({url:n});return o.onRequestStart(function(){k._onPlaylistRequestStart.dispatch({playlist:i})}),k._logger.debug("Requesting playlist.",n),o.onResponseReceived(function(t){if(!t)return k._logger.warn("Playlist request timed out.",n),k._onPlaylistRequestFailed.dispatch({playlist:i,statusCode:null}),void r();var o=t.statusCode;if(k._isPlaylistResponseCodeAcceptable(o)){var a=t.getData();return a?(k._logger.debug("Got playlist response.",n,o),k._onPlaylistRetrieved.dispatch({playlist:i,statusCode:o}),void e.resolve({playlistContent:a,eventRepresentation:i})):(k._logger.warn("Playlist response contained no data.",n,o),k._onPlaylistRequestFailed.dispatch({playlist:i,statusCode:o}),void r())}return k._isPlaylistResponseCodeRetryable(o)?(k._logger.debug("Playlist response code was not acceptable. Will retry.",n,o),k._onPlaylistRequestFailed.dispatch({playlist:i,statusCode:o}),void r()):(k._logger.debug("Playlist response code was not acceptable.",n,o),k._onPlaylistRequestFailed.dispatch({playlist:i,statusCode:o}),void e.reject(new d(o)))}),o.onError(function(t){return t instanceof c.loaderErrors.LoaderError?(k._logger.warn("Error from loader. Will retry",n,t),void r()):void e.reject(t)}),{onCancel:function(){k._logger.debug("Aborting playlist request.",n),o.hasCompleted()||o.abort(),k._onPlaylistRequestFailed.dispatch({playlist:i,aborted:!0})}}},{onNoMoreRetries:function(){return e.reject(new Error("No more retries for requesting playlist."))}}).cancel;return{result:e.promise,abort:function(){return t()}}}),k._updateJob=new m(function(){if(k._data&&k._data.ended)return{result:E.resolve(void 0)};var e=g(),t=k._downloadAbortableJob.run();return t.onCompletion(function(t){var n=t.playlistContent,r=t.eventRepresentation;k._lastUpdateTime=c.helpers.time.now(),k._onPlaylistParseStart.dispatch({playlist:r});try{k._data=k._parsePlaylist(n)}catch(t){return k._logger.error("Error when parsing playlist.",t,n),void e.reject(t)}k._playlistEventRepresentation=r,k._onPlaylistParseEnd.dispatch({playlist:r}),e.resolve(void 0)}),t.onError(e.reject),{result:e.promise,abort:function(){return t.abort()}}}),k}return l(t,e),t.prototype.hasInitialUpdateCompleted=function(){return!!this._data},t.prototype.getType=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.type},t.prototype.getExpireTime=function(){var e=this._data,t=this._lastUpdateTime;if(!e||e.type!==h.PlaylistType.LIVE||null===t)return null;var n=e.segments.reduce(function(e,t){return e+t.timeRange.duration},0);return t+n/2},t.prototype.hasEnded=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.ended},t.prototype.getCompleteDuration=function(){return this._data&&this._data.ended?this._data.totalDuration:null},t.prototype.getDuration=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.totalDuration},t.prototype.getTargetDuration=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.targetDuration},t.prototype.getFirstSegmentIndex=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.mediaSequence},t.prototype.getSegmentCount=function(){if(!this._data)throw new Error("Not loaded yet.");return this._data.segments.length},t.prototype.getSegmentIndexContainingTime=function(e){var t=this._data;if(!t)throw new Error("Not loaded yet.");var n=x(t.segments,function(t){return t.timeRange.containsTime(e)});return n?t.mediaSequence+t.segments.indexOf(n):null},t.prototype._update=function(){return this._updateJob.run()},t.prototype._getSegment=function(e){var t=this,n=this._data;if(!n)throw new Error("Not loaded yet.");var r=n.segments[e-n.mediaSequence],i=new m(function(){var n=r.encryptionData,i=t._playlistEventRepresentation;if(!i)throw new Error("Playlist event representation should exist.");var o=t._buildEncryptionConfig(n,e),a=r.initDataUrl?t._retrieveInitData(r.initDataUrl):null,s=o.whenComplete().then(function(n){var o=function(o){return new h.Segment({url:r.url,sequenceNumber:e,playlist:t,timeRange:r.timeRange,format:t._segmentFormat,loader:t._segmentLoader,playlistEventRepresentation:i,logger:t._logger,delayCalculator:t._segmentDelayCalculator,isResponseCodeAcceptable:t._isSegmentResponseCodeAcceptable,isResponseCodeRetryable:t._isSegmentResponseCodeRetryable,encryptionConfig:n,initData:o})};return a?a.whenComplete().then(function(e){return o(e)}):o(void 0)});return{result:s,abort:function(){o.abort(),a&&a.abort()}}});return i.run()},t.prototype._buildEncryptionConfig=function(e,t){var n=this,r=new m(function(){if(e.method===u.NONE)return{result:E.resolve(void 0)};if(e.method!==u.AES_128)return n._logger.error("Unsupported encryption method.",e.method),{result:E.reject(new p)};var r=n._keyLoader;if(!r)return{result:E.reject(new Error("Encryption method not supported as no key loader provided."))};var i=n._retrieveKey(e.keyUrl),a=i.whenComplete().then(function(n){return{cipher:"AES-CBC",key:n,iv:e.iv||o(t)}});return{result:a,abort:function(){return i.abort()}}},{storeResult:!0});return r.run()},t.prototype._retrieveKey=function(e){var t=this,n=this._keyLoader;if(!n)throw new Error("No key loader.");var r=this._playlistEventRepresentation;if(!r)throw new Error("Playlist event representation should exist.");var i=new h.events.Key(r,e);return this._retrieveKeyOrInitData({url:e,loader:n,cache:this._keyRetrievalJobsCache,onRequestQueued:function(){return t._onKeyRequestQueued.dispatch({key:i})},onRequestStart:function(){return t._onKeyRequestStart.dispatch({key:i})},onRequestTimedOut:function(){t._onKeyRequestFailed.dispatch({key:i,statusCode:null})},onRequestFailed:function(e){t._onKeyRequestFailed.dispatch({key:i,statusCode:e})},onRequestAborted:function(){t._onKeyRequestFailed.dispatch({key:i,aborted:!0})},onRetrieved:function(e){t._onKeyRetrieved.dispatch({key:i,statusCode:e})},type:"key"})},t.prototype._retrieveInitData=function(e){var t=this,n=this._playlistEventRepresentation;if(!n)throw new Error("Playlist event representation should exist.");var r=new h.events.InitData(n,e);return this._retrieveKeyOrInitData({url:e,loader:this._segmentLoader,cache:this._initDataRetrievalJobsCache,onRequestQueued:function(){return t._onInitDataRequestQueued.dispatch({initData:r})},onRequestStart:function(){return t._onInitDataRequestStart.dispatch({initData:r})},onRequestTimedOut:function(){t._onInitDataRequestFailed.dispatch({initData:r,statusCode:null})},onRequestFailed:function(e){t._onInitDataRequestFailed.dispatch({initData:r,statusCode:e})},onRequestAborted:function(){t._onInitDataRequestFailed.dispatch({initData:r,aborted:!0})},onRetrieved:function(e){t._onInitDataRetrieved.dispatch({initData:r,statusCode:e})},type:"init data"})},t.prototype._retrieveKeyOrInitData=function(e){var t=this,n=e.url,r=e.loader,i=e.cache,o=e.onRequestQueued,a=e.onRequestStart,s=e.onRequestTimedOut,l=e.onRequestFailed,u=e.onRequestAborted,h=e.onRetrieved,f=e.type,p=i.get(n);return p?this._logger.debug(f+" retrieval already in progress.",n):(p=new m(function(){var e=c.helpers.deferred.buildDeferred(),i=y(t._keyDelayCalculator,function(i){var p=i.scheduleRetry;o();var m=r.request({url:n});return m.onRequestStart(a),t._logger.debug("Retrieving "+f+".",n),m.onResponseReceived(function(r){if(!r)return t._logger.warn(f+" request timed out.",n),s(),void p();var i=r.statusCode;if(t._isKeyOrInitDataResponseCodeAcceptable(i)){var o=r.getData();return o?(t._logger.debug("Got "+f+" response.",n,i),h(i),void e.resolve(new Uint8Array(o))):(t._logger.warn(f+" response contained no data.",n,i),l(i),void p())}return t._isKeyOrInitDataResponseCodeRetryable(i)?(t._logger.warn(f+" response code was not acceptable. Will retry.",n,i),l(i),void p()):(t._logger.warn(f+" response code was not acceptable.",n,i),l(i),void e.reject(new d(i)))}),m.onError(function(r){return r instanceof c.loaderErrors.LoaderError?(t._logger.warn("Error from loader. Will retry",n,r),void p()):void e.reject(r)}),{onCancel:function(){t._logger.debug("Aborting "+f+" request.",n),m.hasCompleted()||m.abort(),u()}}},{onNoMoreRetries:function(){return e.reject(new Error("No more retries for requesting "+f+"."))}}).cancel;return{result:e.promise,abort:function(){return i()}}},{storeResult:!0}),i.set(n,p)),p.run()},t.prototype._parsePlaylist=function(e){var t=this._data,n={version:null,type:h.PlaylistType.LIVE,mediaSequence:null,targetDuration:null,totalDuration:0,ended:!1},r=[],o={method:u.NONE},a=null,l=null;P.lastIndex=0;for(var d,p=0,m=!1;null!==(d=P.exec(e));){var g=d.filter(function(e,t){return 0!==t&&void 0!==e}).map(function(e,t){return 0===t?e.toLowerCase():e}),_=g[0],v=g.slice(1);if(0===p){if("extm3u"!==_)throw new f("First line did not contain EXTM3U tag.")}else{if(!m)switch(_){case"playlist-type":if(n.type!==h.PlaylistType.LIVE)throw new f("Already have playlist type.");switch(v[0].toLowerCase()){case"vod":n.type=h.PlaylistType.VOD;break;case"event":n.type=h.PlaylistType.EVENT;break;default:throw new f("Invalid playlist type.")}break;case"media-sequence":if(null!==n.mediaSequence)throw new f("Already have media sequence number.");var y=parseInt(v[0],10);if(y+""!==v[0])throw new f("Invalid media sequence number.");n.mediaSequence=y;break;case"targetduration":if(null!==n.targetDuration)throw new f("Already have target duration.");var b=parseInt(v[0],10);if(b+""!==v[0]||b<0)throw new f("Invalid target duration.");n.targetDuration=1e3*b;break;case"version":if(null!==n.version)throw new f("Already have version.");var E=parseInt(v[0],10);if(E+""!==v[0])throw new f("Invalid version.");if(E<3)throw new f("HLS version must be 3 or above.");n.version=E;break;default:m=!0}if(m)switch(_){case"key":var x=s(v[0]),S="method"in x?x.method.toLowerCase():null,A="uri"in x?T.buildAbsoluteUrl(this._url,x.uri):null,M="iv"in x?i(x.iv):null;if(!S)throw new f("Missing encryption method.");if(!A&&"none"!==S)throw new f("Missing key url.");switch(S){case"none":if(null!==A)throw new f("Key url not allowed.");if(null!==M)throw new f("IV not allowed.");o={method:u.NONE};break;case"aes-128":if(!A)throw new f("Key url required.");o={method:u.AES_128,keyUrl:A,iv:M};break;case"sample-aes":if(!A)throw new f("Key url required.");o={method:u.SAMPLE_AES,keyUrl:A,iv:M};break;default:throw new f("Unknown encryption method.")}break;case"map":var x=s(v[0]);if(!("uri"in x))throw new f("URI missing from EXT-X-MAP tag.");if("byterange"in x)throw new f("BYTERANGE in EXT-X-MAP tag is currently unsupported.");a=x.uri?T.buildAbsoluteUrl(this._url,x.uri):null;break;case"inf":if(!v[0].match(R))throw new f("Invalid segment duration.");l=1e3*parseFloat(v[0]);break;case"":if(n.ended)throw new f("Already received ENDLIST tag.");if(null===l)throw new f("Not received segment duration.");var C=T.buildAbsoluteUrl(this._url,v[0]);r.push({url:C,timeRange:new c.TimeRange(n.totalDuration,l),initDataUrl:a,encryptionData:o}),n.totalDuration+=l,l=null;break;case"endlist":if(n.ended)throw new f("Already had ENDLIST tag.");n.ended=!0;break;default:this._logger.warn("Unable to parse playlist line.",_)}}p++}var w=n.version,O=n.type,I=n.mediaSequence,D=n.targetDuration,L=n.ended,F=n.totalDuration;if(null===w)throw new f("Missing version.");if(null===D)throw new f("Missing target duration.");if(L&&O===h.PlaylistType.LIVE)throw new f("Cannot be ended if type is LIVE.");if(!L&&O===h.PlaylistType.VOD)throw new f("Must be ended if type is VOD.");if(null===I&&(I=0),t){if(t.type!==O)throw new f("Playlist type has changed since last update.");if(t.type===h.PlaylistType.EVENT&&I!==t.mediaSequence)throw new f("Media sequence number has changed. Not valid for EVENT playlist.");var N=t.segments[I-t.mediaSequence];if(!N)throw new f("Tracking lost. The last segment of the previous playlist is no longer in the new one.");var B=N.timeRange.start;r.forEach(function(e){var t=e.timeRange;e.timeRange=new c.TimeRange(t.start+B,t.duration)}),F+=B}return{version:w,type:O,mediaSequence:I,targetDuration:D,totalDuration:F,ended:L,segments:r}},t}(h.Playlist);t.PlaylistHLS=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819;var r=n(2);t.PlaylistHLS=r.PlaylistHLS}])}(n(7),n(2))},function(e,t,n){window,e.exports=function(e){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(t,n){t.exports=e},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(e){function t(t,n,r){void 0===n&&(n={}),void 0===r&&(r=2e4);var i=e.call(this)||this;if(i._responseStarted=!1,r<0)throw new Error("Invaid timeout.");i._timeoutTimer=window.setTimeout(function(){return i._onManualTimeout()},r),i._xhr=new XMLHttpRequest,i._xhr.addEventListener("load",function(){return i._onLoad()}),i._xhr.addEventListener("abort",function(){return i._onAbort()}),i._xhr.addEventListener("error",function(e){return i._onError(e)}),i._xhr.addEventListener("timeout",function(){return i._onTimeout()}),i._xhr.addEventListener("loadend",function(){return i._onLoadEnd()}),i._xhr.addEventListener("progress",function(){return i._onProgress()}),i._xhr.open("GET",t,!0),i._xhr.timeout=r;var o=i._getResponseType().some(function(e){return i._xhr.responseType=e,i._xhr.responseType===e});if(!o)throw new Error("Failed setting response type.");return Object.keys(n).forEach(function(e){return i._xhr.setRequestHeader(e,n[e])}),i._signalRequestStart(),i._xhr.send(),i}return r(t,e),t.prototype._abort=function(){this._xhr.abort()},t.prototype._onAbort=function(){this.hasCompleted()||this._onTimeout()},t.prototype._onManualTimeout=function(){this.hasCompleted()||(this._signalTimeout(),this._xhr.abort())},t.prototype._onTimeout=function(){this.hasCompleted()||this._signalTimeout()},t.prototype._onLoad=function(){if(!this.hasCompleted()){if(!this._isChunkedResponse()){var e=this._xhr;this._provideStatusAndHeaders({statusCode:e.status,headers:this._parseHeaders(e.getAllResponseHeaders()||"")},e.response)}this.hasCompleted()||this._finalize()}},t.prototype._onError=function(e){switch(this.getState()){case i.loader.ResponseState.COMPLETED:case i.loader.ResponseState.ERRORED:break;case i.loader.ResponseState.PENDING:if(0===this._xhr.status){this._provideStatusAndHeaders({statusCode:0,headers:{}},this._getEmptyData()),this._finalize();break}default:this._finalize(new i.loaderErrors.LoaderError("An error occurred.",e))}},t.prototype._onLoadEnd=function(){window.clearTimeout(this._timeoutTimer),this.hasCompleted()||this._finalize(new i.loaderErrors.LoaderError("Unexpected error occurred."))},t.prototype._onProgress=function(){if(!this.hasCompleted()){var e=this._xhr;this._isChunkedResponse()&&(this._responseStarted?this._providePart(e.response):(this._responseStarted=!0,this._provideStatusAndHeaders({statusCode:e.status,headers:this._parseHeaders(e.getAllResponseHeaders()||"")},e.response)))}},t.prototype._isChunkedResponse=function(){return"moz-chunked-arraybuffer"===this._xhr.responseType},t.prototype._parseHeaders=function(e){var t={};if(!e)return t;for(var n=e.split("\r\n"),r=0,i=n.length;r<i;r++){var o=n[r],a=o.indexOf(": ");if(a>0){var s=o.substring(0,a).trim(),l=o.substring(a+2);t[s]=l}}return t},t}(i.loader.LoaderRequest);t.LoaderRequest=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=i.helpers.browser.isFirefox(),a=function(e){function t(n,r,o){void 0===r&&(r={}),void 0===o&&(o=2e4);var a=e.call(this)||this;if(!t.isSupported())throw new Error("Not supported.");var s=a._abortController=new AbortController,l=new Request(n,{headers:r,redirect:"follow",signal:s.signal});a._signalRequestStart();var u=a._abortTimer=window.setTimeout(function(){a._signalTimeout(),a._abort()},o),c=fetch(l).then(function(e){var t={};if(e.headers.forEach(function(e,n){return t[e]=n}),a._provideStatusAndHeaders({statusCode:e.status,headers:t},new ArrayBuffer(0)),e.body){var n=e.body.getReader();return function e(){return n.read().then(function(t){var n=t.done,r=t.value;if(!n&&!a.hasCompleted())return a._providePart(r.buffer),e()})}()}return e.arrayBuffer().then(function(e){e&&a._providePart(e)})}).then(function(){a.hasCompleted()||a._finalize()}).catch(function(e){if(!a.hasCompleted()){var t=e instanceof i.loaderErrors.LoaderError?e:new i.loaderErrors.LoaderError(e);a._finalize(t)}});return i.helpers.always(c,function(){return window.clearTimeout(u)}),a}return r(t,e),t.isSupported=function(){return"fetch"in window&&"Request"in window&&"AbortController"in window&&!o},t.prototype._abort=function(){window.clearTimeout(this._abortTimer),this._abortController.abort()},t.prototype._reduceParts=function(e){return i.helpers.arrayBuffer.combine(e.map(function(e){return new Uint8Array(e)})).buffer},t}(i.loader.LoaderRequest);t.ArrayBufferLoaderRequest=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(1),a=i.helpers.browser.getFirefoxVersion(),s=a&&a.major>=60?["moz-chunked-arraybuffer","arraybuffer"]:["arraybuffer"],l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._getResponseType=function(){return s},t.prototype._getEmptyData=function(){return new ArrayBuffer(0)},t.prototype._reduceParts=function(e){return i.helpers.arrayBuffer.combine(e.map(function(e){return new Uint8Array(e)})).buffer},t}(o.LoaderRequest);t.ArrayBufferLoaderRequest=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(2),o=function(){function e(e){var t=(void 0===e?{}:e).fetchEnabled,n=void 0===t||t;this._fetchEnabled=n}return e.prototype.request=function(e){var t=e.url,n=e.headers,o=e.timeout;return this._fetchEnabled&&i.ArrayBufferLoaderRequest.isSupported()?new i.ArrayBufferLoaderRequest(t,n,o):new r.ArrayBufferLoaderRequest(t,n,o)},e}();t.ArrayBufferLoader=o,t.arrayBufferLoader=new o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=["text"],a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._getResponseType=function(){return o},t.prototype._getEmptyData=function(){return""},t.prototype._reduceParts=function(e){return e.join("")},t}(i.LoaderRequest);t.StringLoaderRequest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);t.stringLoader={request:function(e){var t=e.url,n=e.headers,i=e.timeout;return new r.StringLoaderRequest(t,n,i)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="29.0.0",t.buildNumber=1819;var r=n(6);t.stringLoader=r.stringLoader;var i=n(4);t.arrayBufferLoader=i.arrayBufferLoader,t.ArrayBufferLoader=i.ArrayBufferLoader}])}(n(2))},function(e,t,n){window,e.exports=function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){if(void 0===t&&(t=6e4),this._limit=e,this._period=t,this._jobs=[],this._jobsRunInPeriod=0,e<=0)throw new Error("limit must be > 0.");if(t<=0)throw new Error("period must be > 0.")}return e.prototype.execute=function(e){var t=this,n={job:e};return this._jobs.push(n),this._executeNextJob(),{abort:function(){var e=t._jobs.indexOf(n);e>=0&&t._jobs.splice(e,1)}}},e.prototype._executeNextJob=function(){var e=this;if(this._jobsRunInPeriod<this._limit){var t=this._jobs.shift();t&&(this._jobsRunInPeriod++,window.setTimeout(function(){e._jobsRunInPeriod--,e._executeNextJob()},this._period),t.job())}},e}();t.Limiter=r},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(1),a=n(0),s=i.helpers.abortableJob.AbortableJob,l=i.helpers.find,u=i.helpers.time,c=new a.Limiter(300,3e5),h=[o.renditions.encryptedHlsMp3,o.renditions.hlsMp3,o.renditions.encryptedHlsOpus,o.renditions.hlsOpus,o.renditions.httpMp3],d=function(e){function t(t){var n=t.loader,r=t.clientId,i=t.trackId,o=t.secretToken,a=void 0===o?null:o,s=t.requestAuthorization,l=void 0===s?null:s,u=t.excludedRenditions,c=void 0===u?[]:u,h=t.maxBitrate,d=void 0===h?1/0:h,f=t.endpointBaseUrl,p=void 0===f?"https://api.soundcloud.com/":f,m=t.encryptedStreamsEnabled,g=void 0!==m&&m,_=e.call(this)||this;if(_.name="PublicAPI",_._getUrlsJob=null,_._clearResponseTimer=null,!n)throw new Error("loader required.");if("string"!=typeof r)throw new Error("clientId invalid.");if("number"!=typeof i)throw new Error("trackId invalid.");if(null!==a&&"string"!=typeof a)throw new Error("secretToken invalid.");if(null!==l&&"string"!=typeof l)throw new Error("requestAuthorizaton invalid.");if("number"!=typeof d||d<=0)throw new Error("maxBitrate must be > 0.");if("string"!=typeof p)throw new Error("endpointBaseUrl must be > 0.");if("boolean"!=typeof g)throw new Error("encryptedStreamsEnabled invalid.");return _._loader=n,_._clientId=r,_._requestAuthorization=l,_._trackId=i,_._secretToken=a,_._endpointBaseUrl=p,_._encryptedStreamsEnabled=g,_._excludedRenditions=c,_._maxBitrate=d,_}return r(t,e),t.prototype.getTrackId=function(){return this._trackId},t.prototype.excludeRendition=function(e){this._excludedRenditions.indexOf(e)<0&&this._excludedRenditions.push(e)},t.prototype.updateRequestAuthorization=function(e){if(null!==e&&"string"!=typeof e)throw new Error("requestAuthorizaton invalid.");this._requestAuthorization=e},t.prototype.clearCache=function(){this._clearResponseTimer&&(window.clearTimeout(this._clearResponseTimer),this._clearResponseTimer=null),this._getUrlsJob=null},t.prototype.getMaxBitrate=function(){return this._maxBitrate},t.prototype.setMaxBitrate=function(e){if("number"!=typeof e||e<=0)throw new Error("maxBitrate must be > 0.");this._maxBitrate=e},t.prototype.getUrl=function(){var e=this,t=this._maxBitrate,n=this._excludedRenditions,r=new s(function(){var r=i.helpers.deferred.buildDeferred(),a=e._getUrls();return a.onCompletion(function(e){var i=e.urls,o=e.timeRetrieved,a=null;h.filter(function(e){return n.indexOf(e)<0}).some(function(e){var n=i.filter(function(t){return t.rendition===e}).map(function(e){return{url:e.url,bitrate:e.bitrate}}),r=l(n.sort(function(e,t){return t.bitrate-e.bitrate}),function(e){return e.bitrate<=t});return!!r&&(a={success:!0,url:r.url,rendition:e,bitrate:r.bitrate,timeRetrieved:o},!0)}),r.resolve(a)}),a.onError(function(e){e instanceof o.UrlRetrieverError?r.resolve({success:!1,error:e}):r.reject(e)}),{result:r.promise,abort:function(){return a.abort()}}});return r.run()},t.prototype._getUrls=function(){var e=this;return this._getUrlsJob||(this._getUrlsJob=new s(function(){var t=i.helpers.deferred.buildDeferred(),n=null,r=c.execute(function(){var r=e._requestAuthorization?{Authorization:e._requestAuthorization}:{},i=e._endpointBaseUrl+"i1/tracks/"+encodeURI(e._trackId+"")+"/streams?client_id="+encodeURIComponent(e._clientId);e._encryptedStreamsEnabled&&(i+="&with_encrypted_streams=true"),e._secretToken&&(i+="&secret_token="+encodeURIComponent(e._secretToken));var a=(n=e._loader.request({url:i,headers:r})).getResponse().then(function(e){if(!e)throw new o.UrlRetrieverError("TIMED_OUT",!0);if(200!==e.statusCode)throw new o.UrlRetrieverError("INVALID_STATUS_"+e.statusCode);var t=e.getData();if(!t)throw new o.UrlRetrieverError("NO_DATA");var n=u.now(),r=JSON.parse(t),i=[];return Object.keys(r).map(function(e){var t=e.split("_"),n=t[0],o=t[1],a=t[2],s=parseInt(a,10);if(n&&o&&!isNaN(s)){var u=l(h,function(e){return e.scProtocol===n&&e.scFormat===o});u&&i.push({rendition:u,bitrate:s,url:r[e]})}}),{urls:i,timeRetrieved:n}});a.then(t.resolve,t.reject)});return{result:t.promise,abort:function(){r.abort(),n&&n.abort()}}}),this._clearResponseTimer=window.setTimeout(function(){e._clearResponseTimer=null,e._getUrlsJob=null},5e3)),this._getUrlsJob.run()},t}(o.BaseStreamUrlRetriever);t.StreamUrlRetriever=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version="23.1.0",t.buildNumber=845;var r=n(3);t.StreamUrlRetriever=r.StreamUrlRetriever}])}(n(1),n(2))}])},function(e,t,n){var r;(function(e,i,o,a){(function(){"use strict";function s(e){return"function"==typeof e}function l(){return function(){setTimeout(u,1)}}function u(){for(var e=0;e<P;e+=2){var t=D[e],n=D[e+1];t(n),D[e]=void 0,D[e+1]=void 0}P=0}function c(){}function h(e,t){if(t.constructor===e.constructor)!function(e,t){t._state===F?p(e,t._result):t._state===N?m(e,t._result):g(t,void 0,function(t){d(e,t)},function(t){m(e,t)})}(e,t);else{var n=function(e){try{return e.then}catch(e){return B.error=e,B}}(t);n===B?m(e,B.error):void 0===n?p(e,t):s(n)?function(e,t,n){M(function(e){var r=!1,i=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,function(n){r||(r=!0,t!==n?d(e,n):p(e,n))},function(t){r||(r=!0,m(e,t))},e._label);!r&&i&&(r=!0,m(e,i))},e)}(e,t,n):p(e,t)}}function d(e,t){e===t?m(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?h(e,t):p(e,t)}function f(e){e._onerror&&e._onerror(e._result),_(e)}function p(e,t){e._state===L&&(e._result=t,e._state=F,0!==e._subscribers.length&&M(_,e))}function m(e,t){e._state===L&&(e._state=N,e._result=t,M(f,e))}function g(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+F]=n,i[o+N]=r,0===o&&e._state&&M(_,e)}function _(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,i,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?y(n,r,i,o):i(o);e._subscribers.length=0}}function v(){this.error=null}function y(e,t,n,r){var i,o,a,l,u=s(n);if(u){if((i=function(e,t){try{return e(t)}catch(e){return U.error=e,U}}(n,r))===U?(l=!0,o=i.error,i=null):a=!0,t===i)return void m(t,new TypeError("A promises callback cannot return that same promise."))}else i=r,a=!0;t._state!==L||(u&&a?d(t,i):l?m(t,o):e===F?p(t,i):e===N&&m(t,i))}function b(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(c),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?p(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&p(n.promise,n._result))):m(n.promise,n._validationError())}function E(e){this._id=H++,this._state=void 0,this._result=void 0,this._subscribers=[],c!==e&&(s(e)||function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof E||function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}(),function(e,t){try{t(function(t){d(e,t)},function(t){m(e,t)})}catch(t){m(e,t)}}(this,e))}var x,T,S,A=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},P=0,M=function(e,t){D[P]=e,D[P+1]=t,2===(P+=2)&&(T?T(u):S())},R="undefined"!=typeof window?window:void 0,C=R||{},w=C.MutationObserver||C.WebKitMutationObserver,O="undefined"!=typeof e&&"[object process]"==={}.toString.call(e),I="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,D=new Array(1e3);S=O?function(){var t=e.nextTick,n=e.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(n)&&"0"===n[1]&&"10"===n[2]&&(t=i),function(){t(u)}}():w?function(){var e=0,t=new w(u),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():I?function(){var e=new MessageChannel;return e.port1.onmessage=u,function(){e.port2.postMessage(0)}}():void 0===R?function(){try{var e=n(29);return x=e.runOnLoop||e.runOnContext,function(){x(u)}}catch(e){return l()}}():l();var L=void 0,F=1,N=2,B=new v,U=new v;b.prototype._validateInput=function(e){return A(e)},b.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},b.prototype._init=function(){this._result=new Array(this.length)};var k=b;b.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,i=0;n._state===L&&i<t;i++)e._eachEntry(r[i],i)},b.prototype._eachEntry=function(e,t){var n=this,r=n._instanceConstructor;!function(e){return"object"==typeof e&&null!==e}(e)?(n._remaining--,n._result[t]=e):e.constructor===r&&e._state!==L?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t)},b.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===L&&(r._remaining--,e===N?m(i,n):r._result[t]=n),0===r._remaining&&p(i,r._result)},b.prototype._willSettleAt=function(e,t){var n=this;g(e,void 0,function(e){n._settledAt(F,t,e)},function(e){n._settledAt(N,t,e)})};var V=function(e){return new k(this,e).promise},G=function(e){function t(e){d(r,e)}function n(e){m(r,e)}var r=new this(c);if(!A(e))return m(r,new TypeError("You must pass an array to race.")),r;for(var i=e.length,o=0;r._state===L&&o<i;o++)g(this.resolve(e[o]),void 0,t,n);return r},z=function(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return d(t,e),t},j=function(e){var t=new this(c);return m(t,e),t},H=0,W=E;E.all=V,E.race=G,E.resolve=z,E.reject=j,E._setScheduler=function(e){T=e},E._setAsap=function(e){M=e},E._asap=M,E.prototype={constructor:E,then:function(e,t){var n=this,r=n._state;if(r===F&&!e||r===N&&!t)return this;var i=new this.constructor(c),o=n._result;if(r){var a=arguments[r-1];M(function(){y(r,i,a,o)})}else g(n,i,e,t);return i},catch:function(e){return this.then(null,e)}};var X=function(){var e;if("undefined"!=typeof o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;t&&"[object Promise]"===Object.prototype.toString.call(t.resolve())&&!t.cast||(e.Promise=W)},Y={Promise:W,polyfill:X};n(23).amd?void 0!==(r=function(){return Y}.call(t,n,t,a))&&(a.exports=r):"undefined"!=typeof a&&a.exports?a.exports=Y:"undefined"!=typeof this&&(this.ES6Promise=Y),X()}).call(this)}).call(t,n(6),n(25).setImmediate,function(){return this}(),n(24)(e))},function(e,t){"use strict";var n={oauth_token:void 0,baseURL:"https://api.soundcloud.com",connectURL:"//connect.soundcloud.com",client_id:void 0,redirect_uri:void 0};e.exports={get:function(e){return n[e]},set:function(e,t){t&&(n[e]=t)}}},function(e,t,n){(function(t){"use strict";var r=n(3),i=n(20),o=n(2).Promise,a=function(e,n,r,i){var a=void 0,s=new o(function(o){var s=t.FormData&&r instanceof FormData;a=new XMLHttpRequest,a.upload&&a.upload.addEventListener("progress",i),a.open(e,n,!0),s||a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4===a.readyState&&o({responseText:a.responseText,request:a})},a.send(r)});return s.request=a,s},s=function e(t,n,r,i){var o=a(t,n,r,i),s=o.then(function(t){var n=t.responseText,r=t.request,i=function(e){var t=e.responseText,n=e.request,r=void 0,i=void 0;try{i=JSON.parse(t)}catch(e){}return i?i.errors&&(r={message:""},i.errors[0]&&i.errors[0].error_message&&(r={message:i.errors[0].error_message})):r=n?{message:"HTTP Error: "+n.status}:{message:"Unknown error"},r&&(r.status=n.status),{json:i,error:r}}({responseText:n,request:r});if(i.json&&"302 - Found"===i.json.status)return e("GET",i.json.location,null);if(200!==r.status&&i.error)throw i.error;return i.json});return s.request=o.request,s};e.exports={request:function(e,n){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments.length<=3||void 0===arguments[3]?function(){}:arguments[3],l=r.get("oauth_token"),u=r.get("client_id"),c={},h=t.FormData&&o instanceof FormData,d=void 0,f=void 0;return c.format="json",l?c.oauth_token=l:c.client_id=u,function(e,t,n){Object.keys(t).forEach(function(r){n?e.append(r,t[r]):e[r]=t[r]})}(o,c,h),"GET"!==e&&(d=h?o:i.encode(o),o={oauth_token:l}),n="/"!==n[0]?"/"+n:n,f=""+r.get("baseURL")+n+"?"+i.encode(o),s(e,f,d,a)},oEmbed:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t.element;delete t.element,t.url=e;var r="https://soundcloud.com/oembed.json?"+i.encode(t);return s("GET",r,null).then(function(e){return n&&e.html&&(n.innerHTML=e.html),e})},upload:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.asset_data||e.file,n=r.get("oauth_token")&&e.title&&t;if(!n)return new o(function(e,t){t({status:0,error_message:"oauth_token needs to be present and title and asset_data / file passed as parameters"})});var i=Object.keys(e),a=new FormData;return i.forEach(function(t){var n=e[t];"file"===t&&(t="asset_data",n=e.file),a.append("track["+t+"]",n)}),this.request("POST","/tracks",a,e.progress)},resolve:function(e){return this.request("GET","/resolve",{url:e,_status_code_map:{302:200}})}}}).call(t,function(){return this}())},function(e,t){"use strict";var n={};e.exports={get:function(e){return n[e]},set:function(e,t){n[e]=t}}},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(){p&&d&&(p=!1,d.length?f=d.concat(f):m=-1,f.length&&a())}function a(){if(!p){var e=i(o);p=!0;for(var t=f.length;t;){for(d=f,f=[];++m<t;)d&&d[m].run();m=-1,t=f.length}d=null,p=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===r||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function s(e,t){this.fun=e,this.array=t}function l(){}var u,c,h=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{c="function"==typeof clearTimeout?clearTimeout:r}catch(e){c=r}}();var d,f=[],p=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new s(e,t)),1!==f.length||p||i(a)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(22);t.extract=function(e){return e.split("?")[1]||""},t.parse=function(e){return"string"!=typeof e?{}:(e=e.trim().replace(/^(\?|#|&)/,""))?e.split("&").reduce(function(e,t){var n=t.replace(/\+/g," ").split("="),r=n.shift(),i=n.length>0?n.join("="):void 0;return r=decodeURIComponent(r),i=void 0===i?null:decodeURIComponent(i),e.hasOwnProperty(r)?Array.isArray(e[r])?e[r].push(i):e[r]=[e[r],i]:e[r]=i,e},{}):{}},t.stringify=function(e){return e?Object.keys(e).sort().map(function(t){var n=e[t];return Array.isArray(n)?n.sort().map(function(e){return r(t)+"="+r(e)}).join("&"):r(t)+"="+r(n)}).filter(function(e){return e.length>0}).join("&"):""}},function(e,t,n){"use strict";var r=n(7),i=n(5);e.exports={notifyDialog:function(e){var t=r.parse(e.search),n=r.parse(e.hash),o={oauth_token:t.access_token||n.access_token,dialog_id:t.state||n.state,error:t.error||n.error,error_description:t.error_description||n.error_description},a=i.get(o.dialog_id);a&&a.handleConnectResponse(o)}}},function(e,t,n){"use strict";var r=n(3),i=n(11),o=n(2).Promise,a=function(e){return r.set("oauth_token",e.oauth_token),e};e.exports=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=r.get("oauth_token");if(t)return new o(function(e){e({oauth_token:t})});var n={client_id:e.client_id||r.get("client_id"),redirect_uri:e.redirect_uri||r.get("redirect_uri"),response_type:"code_and_token",scope:e.scope||"non-expiring",display:"popup"};if(!n.client_id||!n.redirect_uri)throw new Error("Options client_id and redirect_uri must be passed");var s=new i(n);return s.open().then(a)}},function(e,t,n){"use strict";var r=n(2).Promise;e.exports=function(){var e={};return e.promise=new r(function(t,n){e.resolve=t,e.reject=n}),e}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(10),o=n(5),a=n(12),s=n(7),l="SoundCloud_Dialog",u=function(){return[l,Math.ceil(1e6*Math.random()).toString(16)].join("_")},c=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=u(),this.options=t,this.options.state=this.id,this.width=420,this.height=670,this.deferred=i()}return r(e,[{key:"open",value:function(){var e=function(e){return"https://soundcloud.com/connect?"+s.stringify(e)}(this.options);return this.popup=a.open(e,this.width,this.height),o.set(this.id,this),this.deferred.promise}},{key:"handleConnectResponse",value:function(e){var t=e.error;t?this.deferred.reject(e):this.deferred.resolve(e),this.popup.close()}}]),e}();e.exports=c},function(e,t){"use strict";e.exports={open:function(e,t,n){var r={},i=void 0;return r.location=1,r.width=t,r.height=n,r.left=window.screenX+(window.outerWidth-t)/2,r.top=window.screenY+(window.outerHeight-n)/2,r.toolbar="no",r.scrollbars="yes",i=Object.keys(r).map(function(e){return e+"="+r[e]}).join(", "),window.open(e,r.name,i)}}},function(e,t,n){"use strict";var r=n(19),i=n(1).MaestroCore,o=i.errors.PlayerFatalError,a=i.State,s=n(1).SCAudio.errors,l=s.NoStreamsError,u=s.NotSupportedError,c=1e3/60;e.exports=function(e){function t(){switch(e.getState()){case a.PLAYING:return"playing";case a.PAUSED:return e.isEnded()?"ended":"paused";case a.DEAD:return e.getFatalError()?"error":"dead";case a.LOADING:default:return"loading"}}var n=!1;e.onStateChange.subscribe(function(){return i.trigger("state-change",t())}),e.onPlay.subscribe(function(){i.trigger(n?"play-resume":"play-start"),n=!0}),e.onPlayIntent.subscribe(function(){return i.trigger("play")}),e.onPlayRejection.subscribe(function(e){return i.trigger("play-rejection",e)}),e.onPauseIntent.subscribe(function(){return i.trigger("pause")}),e.onSeek.subscribe(function(){return i.trigger("seeked")}),e.onSeekRejection.subscribe(function(e){return i.trigger("seek-rejection",e)}),e.onLoadStart.subscribe(function(){return i.trigger("buffering_start")}),e.onLoadEnd.subscribe(function(){return i.trigger("buffering_end")}),e.onEnded.subscribe(function(){return i.trigger("finish")}),e.onError.subscribe(function(e){e instanceof l?i.trigger("no_streams"):e instanceof u?i.trigger("no_protocol"):e instanceof o&&i.trigger("audio_error")});var i={play:e.play.bind(e),pause:e.pause.bind(e),seek:e.seek.bind(e),getVolume:e.getVolume.bind(e),setVolume:e.setVolume.bind(e),currentTime:e.getPosition.bind(e),getDuration:e.getDuration.bind(e),isBuffering:e.isLoading.bind(e),isPlaying:e.isPlaying.bind(e),isActuallyPlaying:e.isActuallyPlaying.bind(e),isEnded:e.isEnded.bind(e),isDead:e.isDead.bind(e),kill:e.kill.bind(e),hasErrored:function(){return!!e.getFatalError()},getState:t};return r.mixin(i),function(){function t(){window.clearTimeout(n),e.isPlaying()&&!e.isEnded()&&(n=window.setTimeout(t,c));var o=e.getPosition();o!==r&&(r=o,i.trigger("time",o))}var n=0,r=null;e.onChange.subscribe(function(e){var r=e.playing,i=e.seeking,o=e.dead;o?window.clearTimeout(n):void 0===r&&void 0===i||t()})}(),i}},function(e,t){(function(t){"use strict";var n=t.AudioContext||t.webkitAudioContext,r=null;e.exports=function(){return r||(r=new n)}}).call(t,function(){return this}())},function(e,t){(function(t){"use strict";var n=t.navigator.getUserMedia||t.navigator.webkitGetUserMedia||t.navigator.mozGetUserMedia;e.exports=function(e,r,i){n.call(t.navigator,e,r,i)}}).call(t,function(){return this}())},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(14),o=n(15),a=n(2).Promise,s=n(28),l=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.context=t.context||i(),this._recorder=null,this.source=t.source,this.stream=null}return r(e,[{key:"start",value:function(){var e=this;return function(){var e=this,t=this.context;return new a(function(n,r){e.source?e.source instanceof AudioNode?n(e.source):r(new Error("source needs to be an instance of AudioNode")):o({audio:!0},function(r){e.stream=r,e.source=t.createMediaStreamSource(r),n(e.source)}.bind(e),r)})}.call(this).then(function(t){return e._recorder=new s(t),e._recorder.record(),t})}},{key:"stop",value:function(){if(this._recorder&&this._recorder.stop(),this.stream)if(this.stream.stop)this.stream.stop();else if(this.stream.getTracks){var e=this.stream.getTracks()[0];e&&e.stop()}}},{key:"getBuffer",value:function(){var e=this;return new a(function(t,n){e._recorder?e._recorder.getBuffer(function(n){var r=e.context.sampleRate,i=e.context.createBuffer(2,n[0].length,r);i.getChannelData(0).set(n[0]),i.getChannelData(1).set(n[1]),t(i)}.bind(e)):n(new Error("Nothing has been recorded yet."))})}},{key:"getWAV",value:function(){var e=this;return new a(function(t,n){e._recorder?e._recorder.exportWAV(function(e){t(e)}):n(new Error("Nothing has been recorded yet."))})}},{key:"play",value:function(){var e=this;return this.getBuffer().then(function(t){var n=e.context.createBufferSource();return n.buffer=t,n.connect(e.context.destination),n.start(0),n})}},{key:"saveAs",value:function(e){return this.getWAV().then(function(t){s.forceDownload(t,e)})}},{key:"delete",value:function(){this._recorder&&(this._recorder.stop(),this._recorder.clear(),this._recorder=null),this.stream&&this.stream.stop()}}]),e}();e.exports=l},function(e,t,n){"use strict";var r=n(4),i=n(3),o=n(13),a=n(1).SCAudio,s=n(1).MaestroCore.logger,l=n(1).SCAudioPublicApiStreamURLRetriever.StreamUrlRetriever,u=n(1).SCAudioControllerHTML5Player.MediaElementManager,c=n(1).SCAudioControllerHTML5Player.HTML5PlayerController,h=n(1).SCAudioControllerHLSMSEPlayer.HLSMSEPlayerController,d=n(1).MaestroLoaders.stringLoader,f=new u("audio",s.noOpLogger);e.exports=function(e,t){var n=t?{secret_token:t}:{};return r.request("GET",e,n).then(function(e){var n=i.get("baseURL"),r=i.get("client_id"),u=i.get("oauth_token"),p=!1,m=new l({clientId:r,secretToken:t,trackId:e.id,requestAuthorization:u?"OAuth "+u:null,loader:d}),g=new a.Player({controllers:[new h(f),new c(f)],streamUrlRetriever:m,getURLOpts:{preview:"SNIP"===e.policy},streamUrlsExpire:!0,mediaSessionEnabled:!0,logger:s.noOpLogger});return g.onPlay.subscribe(function(){p||(p=!0,function(){var i=n+"/tracks/"+encodeURIComponent(e.id)+"/plays?client_id="+encodeURIComponent(r);t&&(i+="&secret_token="+encodeURIComponent(t));var o=new XMLHttpRequest;o.open("POST",i,!0),o.send()}())}),g.onEnded.subscribe(function(){g.pause()}),g.onPlayIntent.subscribe(function(){g.isEnded()&&g.seek(0)}),o(g)})},e.exports.activateAudioElement=function(){f.activate()}},function(e,t,n){!function(){var n,r=Array.prototype.forEach,i=Object.prototype.hasOwnProperty,o=Array.prototype.slice,a=0,s={keys:Object.keys||function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("keys() called on a non-object");var t,n=[];for(t in e)e.hasOwnProperty(t)&&(n[n.length]=t);return n},uniqueId:function(e){var t=++a+"";return e?e+t:t},has:function(e,t){return i.call(e,t)},each:function(e,t,n){if(null!=e)if(r&&e.forEach===r)e.forEach(t,n);else if(e.length===+e.length)for(var i=0,o=e.length;i<o;i++)t.call(n,e[i],i,e);else for(var a in e)this.has(e,a)&&t.call(n,e[a],a,e)},once:function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}}};n={on:function(e,t,n){if(!u(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!u(this,"once",e,[t,n])||!t)return this;var r=this,i=s.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,o,a,l,c,h,d;if(!this._events||!u(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(a=e?[e]:s.keys(this._events),l=0,c=a.length;l<c;l++)if(e=a[l],o=this._events[e]){if(this._events[e]=r=[],t||n)for(h=0,d=o.length;h<d;h++)i=o[h],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!u(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;for(var o in"object"==typeof t&&(n=this),e&&((r={})[e._listenerId]=e),r)r[o].off(t,n,this),i&&delete this._listeners[o];return this}};var l=/\s+/,u=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){for(var o=n.split(l),a=0,s=o.length;a<s;a++)e[t].apply(e,[o[a]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,o=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a,s);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}};s.each({listenTo:"on",listenToOnce:"once"},function(e,t){n[t]=function(t,n,r){var i=this._listeners||(this._listeners={}),o=t._listenerId||(t._listenerId=s.uniqueId("l"));return i[o]=t,"object"==typeof n&&(r=this),t[e](n,r,this),this}}),n.bind=n.on,n.unbind=n.off,n.mixin=function(e){return s.each(["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"],function(t){e[t]=this[t]},this),e},"undefined"!=typeof e&&e.exports&&(t=e.exports=n),t.BackboneEvents=n}()},function(e,t,n){e.exports=n(18)},function(e,t){e.exports={encode:function(e,t){function n(e){return e.filter(function(e){return"string"==typeof e&&e.length}).join("&")}function r(e){var t=Object.keys(e);return h?t.sort():t}function i(e,t){return n(r(t).map(function(n){return a(":name[:prop]".replace(/:name/,e).replace(/:prop/,n),t[n])}))}function o(e,t){return n(t.map(function(t){return a(":name[]".replace(/:name/,e),t)}))}function a(e,t){var n=encodeURIComponent,r=typeof t,a=null;return Array.isArray(t)?a=o(e,t):"string"===r?a=n(e)+"="+l(t):"number"===r?a=n(e)+"="+n(t).replace(/%20/g,"+"):"boolean"===r?a=n(e)+"="+t:"object"===r&&(null!==t?a=i(e,t):c||(a=n(e)+"=null")),a}function s(e){return"%"+("0"+e.charCodeAt(0).toString(16)).slice(-2).toUpperCase()}function l(e){return e.replace(/[^ !'()~\*]*/g,encodeURIComponent).replace(/ /g,"+").replace(/[!'()~\*]/g,s)}var u="object"==typeof t?t:{},c=u.ignorenull||!1,h=u.sorted||!1;return n(r(e).map(function(t){return a(t,e[t])}))}}},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){delete s[e]}function i(e){if(l)setTimeout(i,0,e);else{var t=s[e];if(t){l=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{r(e),l=!1}}}}if(!e.setImmediate){var o,a=1,s={},l=!1,u=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?o=function(e){t.nextTick(function(){i(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&i(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),o=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;i(t)},o=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;o=function(t){var n=u.createElement("script");n.onreadystatechange=function(){i(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():o=function(e){setTimeout(i,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return s[a]=r,o(a),a++},c.clearImmediate=r}}("undefined"==typeof self?"undefined"==typeof e?this:e:self)}).call(t,function(){return this}(),n(6))},function(e,t){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,n){(function(e){function r(e,t){this._id=e,this._clearFn=t}var i="undefined"!=typeof e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;t.setTimeout=function(){return new r(o.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new r(o.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(21),t.setImmediate="undefined"!=typeof self&&self.setImmediate||"undefined"!=typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||"undefined"!=typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(t,function(){return this}())},function(e,t){var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;(r=new i).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){return new Worker(t)}}},function(e,t,n){e.exports=function(){return n(26)('!function(t){function n(r){if(e[r])return e[r].exports;var a=e[r]={exports:{},id:r,loaded:!1};return t[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n){(function(t){function n(t){h=t.sampleRate,v=t.numChannels,s()}function e(t){for(var n=0;n<v;n++)p[n].push(t[n]);g+=t[0].length}function r(t){for(var n=[],e=0;e<v;e++)n.push(i(p[e],g));if(2===v)var r=f(n[0],n[1]);else var r=n[0];var a=l(r),o=new Blob([a],{type:t});this.postMessage(o)}function a(){for(var t=[],n=0;n<v;n++)t.push(i(p[n],g));this.postMessage(t)}function o(){g=0,p=[],s()}function s(){for(var t=0;t<v;t++)p[t]=[]}function i(t,n){for(var e=new Float32Array(n),r=0,a=0;a<t.length;a++)e.set(t[a],r),r+=t[a].length;return e}function f(t,n){for(var e=t.length+n.length,r=new Float32Array(e),a=0,o=0;a<e;)r[a++]=t[o],r[a++]=n[o],o++;return r}function c(t,n,e){for(var r=0;r<e.length;r++,n+=2){var a=Math.max(-1,Math.min(1,e[r]));t.setInt16(n,a<0?32768*a:32767*a,!0)}}function u(t,n,e){for(var r=0;r<e.length;r++)t.setUint8(n+r,e.charCodeAt(r))}function l(t){var n=new ArrayBuffer(44+2*t.length),e=new DataView(n);return u(e,0,"RIFF"),e.setUint32(4,36+2*t.length,!0),u(e,8,"WAVE"),u(e,12,"fmt "),e.setUint32(16,16,!0),e.setUint16(20,1,!0),e.setUint16(22,v,!0),e.setUint32(24,h,!0),e.setUint32(28,4*h,!0),e.setUint16(32,2*v,!0),e.setUint16(34,16,!0),u(e,36,"data"),e.setUint32(40,2*t.length,!0),c(e,44,t),e}var h,v,g=0,p=[];t.onmessage=function(t){switch(t.data.command){case"init":n(t.data.config);break;case"record":e(t.data.buffer);break;case"exportWAV":r(t.data.type);break;case"getBuffer":a();break;case"clear":o()}}}).call(n,function(){return this}())}]);\n//# sourceMappingURL=9f9aac32c9a7432b5555.worker.js.map',n.p+"9f9aac32c9a7432b5555.worker.js")}},function(e,t,n){var r=n(27),i=function(e,t){var n=t||{},i=n.bufferLen||4096,o=n.numChannels||2;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,i,o,o);var a=new r;a.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:o}});var s,l=!1;this.node.onaudioprocess=function(e){if(l){for(var t=[],n=0;n<o;n++)t.push(e.inputBuffer.getChannelData(n));a.postMessage({command:"record",buffer:t})}},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},this.record=function(){l=!0},this.stop=function(){l=!1},this.clear=function(){a.postMessage({command:"clear"})},this.getBuffer=function(e){s=e||n.callback,a.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(s=e||n.callback,t=t||n.type||"audio/wav",!s)throw new Error("Callback not set");a.postMessage({command:"exportWAV",type:t})},a.onmessage=function(e){var t=e.data;s(t)},e.connect(this.node),this.node.connect(this.context.destination)};i.forceDownload=function(e,t){var n=(window.URL||window.webkitURL).createObjectURL(e),r=window.document.createElement("a");r.href=n,r.download=t||"output.wav";var i=document.createEvent("Event");i.initEvent("click",!0,!0),r.dispatchEvent(i)},e.exports=i},function(e,t){}])},function(e,t,n){var r=n(55);e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}},function(e,t,n){var r=n(56);e.exports=f,e.exports.parse=o,e.exports.compile=function(e,t){return s(o(e,t))},e.exports.tokensToFunction=s,e.exports.tokensToRegExp=d;var i=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function o(e,t){for(var n,r=[],o=0,a=0,s="",c=t&&t.delimiter||"/";null!=(n=i.exec(e));){var h=n[0],d=n[1],f=n.index;if(s+=e.slice(a,f),a=f+h.length,d)s+=d[1];else{var p=e[a],m=n[2],g=n[3],_=n[4],v=n[5],y=n[6],b=n[7];s&&(r.push(s),s="");var E=null!=m&&null!=p&&p!==m,x="+"===y||"*"===y,T="?"===y||"*"===y,S=n[2]||c,A=_||v;r.push({name:g||o++,prefix:m||"",delimiter:S,optional:T,repeat:x,partial:E,asterisk:!!b,pattern:A?u(A):b?".*":"[^"+l(S)+"]+?"})}}return a<e.length&&(s+=e.substr(a)),s&&r.push(s),r}function a(e){return encodeURI(e).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function s(e){for(var t=new Array(e.length),n=0;n<e.length;n++)"object"===typeof e[n]&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(n,i){for(var o="",s=n||{},l=(i||{}).pretty?a:encodeURIComponent,u=0;u<e.length;u++){var c=e[u];if("string"!==typeof c){var h,d=s[c.name];if(null==d){if(c.optional){c.partial&&(o+=c.prefix);continue}throw new TypeError('Expected "'+c.name+'" to be defined')}if(r(d)){if(!c.repeat)throw new TypeError('Expected "'+c.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(c.optional)continue;throw new TypeError('Expected "'+c.name+'" to not be empty')}for(var f=0;f<d.length;f++){if(h=l(d[f]),!t[u].test(h))throw new TypeError('Expected all "'+c.name+'" to match "'+c.pattern+'", but received `'+JSON.stringify(h)+"`");o+=(0===f?c.prefix:c.delimiter)+h}}else{if(h=c.asterisk?encodeURI(d).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}):l(d),!t[u].test(h))throw new TypeError('Expected "'+c.name+'" to match "'+c.pattern+'", but received "'+h+'"');o+=c.prefix+h}}else o+=c}return o}}function l(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function u(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function c(e,t){return e.keys=t,e}function h(e){return e.sensitive?"":"i"}function d(e,t,n){r(t)||(n=t||n,t=[]);for(var i=(n=n||{}).strict,o=!1!==n.end,a="",s=0;s<e.length;s++){var u=e[s];if("string"===typeof u)a+=l(u);else{var d=l(u.prefix),f="(?:"+u.pattern+")";t.push(u),u.repeat&&(f+="(?:"+d+f+")*"),a+=f=u.optional?u.partial?d+"("+f+")?":"(?:"+d+"("+f+"))?":d+"("+f+")"}}var p=l(n.delimiter||"/"),m=a.slice(-p.length)===p;return i||(a=(m?a.slice(0,-p.length):a)+"(?:"+p+"(?=$))?"),a+=o?"$":i&&m?"":"(?="+p+"|$)",c(new RegExp("^"+a,h(n)),t)}function f(e,t,n){return r(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?function(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return c(e,t)}(e,t):r(e)?function(e,t,n){for(var r=[],i=0;i<e.length;i++)r.push(f(e[i],t,n).source);return c(new RegExp("(?:"+r.join("|")+")",h(n)),t)}(e,t,n):function(e,t,n){return d(o(e,n),t,n)}(e,t,n)}},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,a,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var u in n=Object(arguments[l]))i.call(n,u)&&(s[u]=n[u]);if(r){a=r(n);for(var c=0;c<a.length;c++)o.call(n,a[c])&&(s[a[c]]=n[a[c]])}}return s}},function(e,t,n){"use strict";e.exports=n(57)},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(47)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(0),i=function(){function e(e){r.K.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new s(e)}),this.register(function(e){return new u(e)}),this.register(function(e){return new c(e)}),this.register(function(e){return new l(e)}),this.register(function(e){return new o(e)}),this.register(function(e){return new h(e)})}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(r.K.prototype),{constructor:e,load:function(e,t,n,i){var o,a=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.L.extractUrlBase(e),this.manager.itemStart(e);var s=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},l=new r.t(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(n){try{a.parse(n,o,function(n){t(n),a.manager.itemEnd(e)},s)}catch(r){s(r)}},n,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,o,s){var l,u={},c={};if("string"===typeof e)l=e;else if(r.L.decodeText(new Uint8Array(e,0,4))===d){try{u[n.KHR_BINARY_GLTF]=new m(e)}catch(T){return void(s&&s(T))}l=u[n.KHR_BINARY_GLTF].content}else l=r.L.decodeText(new Uint8Array(e));var h=JSON.parse(l);if(void 0===h.asset||h.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var f=new W(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(var p=0;p<this.pluginCallbacks.length;p++){var v=this.pluginCallbacks[p](f);c[v.name]=v,u[v.name]=!0}if(h.extensionsUsed)for(p=0;p<h.extensionsUsed.length;++p){var E=h.extensionsUsed[p],x=h.extensionsRequired||[];switch(E){case n.KHR_MATERIALS_UNLIT:u[E]=new a;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:u[E]=new y;break;case n.KHR_DRACO_MESH_COMPRESSION:u[E]=new g(h,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:u[E]=new i(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:u[E]=new _;break;case n.KHR_MESH_QUANTIZATION:u[E]=new b;break;default:x.indexOf(E)>=0&&void 0===c[E]&&console.warn('THREE.GLTFLoader: Unknown extension "'+E+'".')}}f.setExtensions(u),f.setPlugins(c),f.parse(o,s)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function o(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function a(){this.name=n.KHR_MATERIALS_UNLIT}function s(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function l(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function u(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}function c(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function h(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}o.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},o.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var o,a=t.json,s=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],l=new r.m(16777215);void 0!==s.color&&l.fromArray(s.color);var u=void 0!==s.range?s.range:0;switch(s.type){case"directional":(o=new r.p(l)).target.position.set(0,0,-1),o.add(o.target);break;case"point":(o=new r.fb(l)).distance=u;break;case"spot":(o=new r.ub(l)).distance=u,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,void 0!==s.intensity&&(o.intensity=s.intensity),o.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(o),t.cache.add(n,i),i},o.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(e){return n._getNodeRef(t.cache,i,e)})},a.prototype.getMaterialType=function(){return r.R},a.prototype.extendParams=function(e,t,n){var i=[];e.color=new r.m(1,1,1),e.opacity=1;var o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var a=o.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==o.baseColorTexture&&i.push(n.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(i)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.T:null},s.prototype.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var s=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new r.Ab(s,-s)}return Promise.all(o)},l.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.T:null},l.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)},u.prototype.loadTexture=function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],o=n.images[i.source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,a)},c.prototype.loadTexture=function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var o=i.extensions[t],a=r.images[o.source],s=a.uri?n.options.manager.getHandler(a.uri):n.textureLoader;return this.detectSupport().then(function(i){if(i)return n.loadTextureImage(e,a,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})},c.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported},h.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,o.ready]).then(function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,a=r.byteStride,s=new ArrayBuffer(i*a),l=new Uint8Array(e[0],t,n);return o.decodeGltfBuffer(new Uint8Array(s),i,a,l,r.mode,r.filter),s})}return null};var d="glTF",f=12,p={JSON:1313821514,BIN:5130562};function m(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,f);if(this.header={magic:r.L.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==d)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-f,o=new DataView(e,f),a=0;a<i;){var s=o.getUint32(a,!0);a+=4;var l=o.getUint32(a,!0);if(a+=4,l===p.JSON){var u=new Uint8Array(e,f+a,s);this.content=r.L.decodeText(u)}else if(l===p.BIN){var c=f+a;this.body=e.slice(c,c+s)}a+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function g(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function _(){this.name=n.KHR_TEXTURE_TRANSFORM}function v(e){r.U.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new r.m).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var r in s)e.uniforms[r]=s[r];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function y(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return v},extendParams:function(e,t,n){var i=t.extensions[this.name];e.color=new r.m(1,1,1),e.opacity=1;var o=[];if(Array.isArray(i.diffuseFactor)){var a=i.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==i.diffuseTexture&&o.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new r.m(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new r.m(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var s=i.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",s)),o.push(n.assignTexture(e,"specularMap",s))}return Promise.all(o)},createMaterial:function(e){var t=new v(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=r.vb,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function b(){this.name=n.KHR_MESH_QUANTIZATION}function E(e,t,n,i){r.A.call(this,e,t,n,i)}g.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},s={},l={};for(var u in o){var c=D[u]||u.toLowerCase();a[c]=o[u]}for(u in e.attributes){c=D[u]||u.toLowerCase();if(void 0!==o[u]){var h=n.accessors[e.attributes[u]],d=C[h.componentType];l[c]=d,s[c]=!0===h.normalized}}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(t){r.decodeDracoFile(e,function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)},a,l)})})},_.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},v.prototype=Object.create(r.U.prototype),v.prototype.constructor=v,v.prototype.copy=function(e){return r.U.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},E.prototype=Object.create(r.A.prototype),E.prototype.constructor=E,E.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,o=0;o!==r;o++)t[o]=n[i+o];return t},E.prototype.beforeStart_=E.prototype.copySampleValue_,E.prototype.afterEnd_=E.prototype.copySampleValue_,E.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=2*a,l=3*a,u=r-t,c=(n-t)/u,h=c*c,d=h*c,f=e*l,p=f-l,m=-2*d+3*h,g=d-h,_=1-m,v=g-h+c,y=0;y!==a;y++){var b=o[p+y+a],E=o[p+y+s]*u,x=o[f+y+a],T=o[f+y]*u;i[y]=_*b+v*E+m*x+g*T}return i};var x=0,T=1,S=2,A=3,P=4,M=5,R=6,C={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},w={9728:r.W,9729:r.H,9984:r.Y,9985:r.J,9986:r.X,9987:r.I},O={33071:r.k,33648:r.V,10497:r.nb},I={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},D={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},L={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},F={CUBICSPLINE:void 0,LINEAR:r.C,STEP:r.B},N="OPAQUE",B="MASK",U="BLEND";function k(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e)}function V(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function G(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function z(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function j(e){var t=e.extensions&&e.extensions[n.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+H(t.attributes):e.indices+":"+H(e.attributes)+":"+e.mode}function H(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function W(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new r.x(this.options.manager):this.textureLoader=new r.wb(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new r.t(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function X(e,t,n){var i=t.attributes,o=[];function a(t,r){return n.getDependency("accessor",t).then(function(t){e.setAttribute(r,t)})}for(var s in i){var l=D[s]||s.toLowerCase();l in e.attributes||o.push(a(i[s],l))}if(void 0!==t.indices&&!e.index){var u=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});o.push(u)}return G(e,t),function(e,t,n){var i=t.attributes,o=new r.f;if(void 0!==i.POSITION){var a=(f=n.json.accessors[i.POSITION]).min,s=f.max;if(void 0!==a&&void 0!==s){o.set(new r.Bb(a[0],a[1],a[2]),new r.Bb(s[0],s[1],s[2]));var l=t.targets;if(void 0!==l){for(var u=new r.Bb,c=new r.Bb,h=0,d=l.length;h<d;h++){var f,p=l[h];if(void 0!==p.POSITION)a=(f=n.json.accessors[p.POSITION]).min,s=f.max,void 0!==a&&void 0!==s?(c.setX(Math.max(Math.abs(a[0]),Math.abs(s[0]))),c.setY(Math.max(Math.abs(a[1]),Math.abs(s[1]))),c.setZ(Math.max(Math.abs(a[2]),Math.abs(s[2]))),u.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}o.expandByVector(u)}e.boundingBox=o;var m=new r.sb;o.getCenter(m.center),m.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(o).then(function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,o=0,a=t.length;o<a&&(void 0!==(u=t[o]).POSITION&&(r=!0),void 0!==u.NORMAL&&(i=!0),!r||!i);o++);if(!r&&!i)return Promise.resolve(e);var s=[],l=[];for(o=0,a=t.length;o<a;o++){var u=t[o];if(r){var c=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;s.push(c)}i&&(c=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(s),Promise.all(l)]).then(function(t){var n=t[0],o=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=o),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}function Y(e,t){var n=e.getIndex();if(null===n){var i=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<o.count;a++)i.push(a);e.setIndex(i),n=e.getIndex()}var s=n.count-2,l=[];if(t===r.xb)for(a=1;a<=s;a++)l.push(n.getX(0)),l.push(n.getX(a)),l.push(n.getX(a+1));else for(a=0;a<s;a++)a%2===0?(l.push(n.getX(a)),l.push(n.getX(a+1)),l.push(n.getX(a+2))):(l.push(n.getX(a+2)),l.push(n.getX(a+1)),l.push(n.getX(a)));l.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(l),u}return W.prototype.setExtensions=function(e){this.extensions=e},W.prototype.setPlugins=function(e){this.plugins=e},W.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){var o={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};V(i,o,r),G(o,r),e(o)}).catch(t)},W.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var o=t[r].joints,a=0,s=o.length;a<s;a++)e[o[a]].isBone=!0;for(var l=0,u=e.length;l<u;l++){var c=e[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},W.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},W.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var r=n.clone();return r.name+="_instance_"+e.uses[t]++,r},W.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}},W.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n},W.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},W.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t},W.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,n){r.load(k(t.uri,i.path),e,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},W.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)})},W.prototype.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then(function(e){var o,a,s=e[0],l=I[i.type],u=C[i.componentType],c=u.BYTES_PER_ELEMENT,h=c*l,d=i.byteOffset||0,f=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;if(f&&f!==h){var m=Math.floor(d/f),g="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count,_=t.cache.get(g);_||(o=new u(s,m*f,i.count*f/c),_=new r.y(o,f/c),t.cache.add(g,_)),a=new r.z(_,l,d%f/c,p)}else o=null===s?new u(i.count*l):new u(s,d,i.count*l),a=new r.h(o,l,p);if(void 0!==i.sparse){var v=I.SCALAR,y=C[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,E=i.sparse.values.byteOffset||0,x=new y(e[1],b,i.sparse.count*v),T=new u(e[2],E,i.sparse.count*l);null!==s&&(a=new r.h(a.array.slice(),a.itemSize,a.normalized));for(var S=0,A=x.length;S<A;S++){var P=x[S];if(a.setX(P,T[S*l]),l>=2&&a.setY(P,T[S*l+1]),l>=3&&a.setZ(P,T[S*l+2]),l>=4&&a.setW(P,T[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})},W.prototype.loadTexture=function(e){var t,r,i=this.json,o=this.options,a=i.textures[e],s=a.extensions||{};return(t=s[n.MSFT_TEXTURE_DDS]?i.images[s[n.MSFT_TEXTURE_DDS].source]:i.images[a.source]).uri&&(r=o.manager.getHandler(t.uri)),r||(r=s[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,r)},W.prototype.loadTextureImage=function(e,t,n){var i=this,o=this.json,a=this.options,s=o.textures[e],l=self.URL||self.webkitURL,u=t.uri,c=!1,h=!0;return"image/jpeg"===t.mimeType&&(h=!1),void 0!==t.bufferView&&(u=i.getDependency("bufferView",t.bufferView).then(function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);h=6===n||4===n||3===n}c=!0;var r=new Blob([e],{type:t.mimeType});return u=l.createObjectURL(r)})),Promise.resolve(u).then(function(e){return new Promise(function(t,i){var o=t;!0===n.isImageBitmapLoader&&(o=function(e){t(new r.j(e))}),n.load(k(e,a.path),o,void 0,i)})}).then(function(t){!0===c&&l.revokeObjectURL(u),t.flipY=!1,s.name&&(t.name=s.name),h||(t.format=r.mb);var n=(o.samplers||{})[s.sampler]||{};return t.magFilter=w[n.magFilter]||r.H,t.minFilter=w[n.minFilter]||r.I,t.wrapS=O[n.wrapS]||r.nb,t.wrapT=O[n.wrapT]||r.nb,i.associations.set(t,{type:"textures",index:e}),t})},W.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then(function(o){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var a=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(a){var s=i.associations.get(o);o=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),i.associations.set(o,s)}}e[t]=o})},W.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=void 0!==t.attributes.tangent,o=void 0!==t.attributes.color,a=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,u=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,h=this.cache.get(c);h||(h=new r.hb,r.N.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(c,h)),n=h}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var d=this.cache.get(c);d||(d=new r.E,r.N.prototype.copy.call(d,n),d.color.copy(n.color),this.cache.add(c,d)),n=d}if(i||o||a||s||l){c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),s&&(c+="skinning:"),i&&(c+="vertex-tangents:"),o&&(c+="vertex-colors:"),a&&(c+="flat-shading:"),l&&(c+="morph-targets:"),u&&(c+="morph-normals:");var f=this.cache.get(c);f||(f=n.clone(),s&&(f.skinning=!0),o&&(f.vertexColors=!0),a&&(f.flatShading=!0),l&&(f.morphTargets=!0),u&&(f.morphNormals=!0),i&&(f.vertexTangents=!0,f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(c,f),this.associations.set(f,this.associations.get(n))),n=f}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n},W.prototype.getMaterialType=function(){return r.U},W.prototype.loadMaterial=function(e){var t,i=this,o=this.json,a=this.extensions,s=o.materials[e],l={},u=s.extensions||{},c=[];if(u[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),c.push(h.extendParams(l,s,i))}else if(u[n.KHR_MATERIALS_UNLIT]){var d=a[n.KHR_MATERIALS_UNLIT];t=d.getMaterialType(),c.push(d.extendParams(l,s,i))}else{var f=s.pbrMetallicRoughness||{};if(l.color=new r.m(1,1,1),l.opacity=1,Array.isArray(f.baseColorFactor)){var p=f.baseColorFactor;l.color.fromArray(p),l.opacity=p[3]}void 0!==f.baseColorTexture&&c.push(i.assignTexture(l,"map",f.baseColorTexture)),l.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,l.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(c.push(i.assignTexture(l,"metalnessMap",f.metallicRoughnessTexture)),c.push(i.assignTexture(l,"roughnessMap",f.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)})))}!0===s.doubleSided&&(l.side=r.r);var m=s.alphaMode||N;return m===U?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,m===B&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==r.R&&(c.push(i.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new r.Ab(1,-1),void 0!==s.normalTexture.scale&&l.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==r.R&&(c.push(i.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==r.R&&(l.emissive=(new r.m).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==r.R&&c.push(i.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(c).then(function(){var o;return o=t===v?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),s.name&&(o.name=s.name),o.map&&(o.map.encoding=r.Fb),o.emissiveMap&&(o.emissiveMap.encoding=r.Fb),G(o,s),i.associations.set(o,{type:"materials",index:e}),s.extensions&&V(a,o,s),o})},W.prototype.createUniqueName=function(e){for(var t=r.ib.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n},W.prototype.loadGeometries=function(e){var t=this,i=this.extensions,o=this.primitiveCache;function a(e){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return X(n,e,t)})}for(var s=[],l=0,u=e.length;l<u;l++){var c,h=e[l],d=j(h),f=o[d];if(f)s.push(f.promise);else c=h.extensions&&h.extensions[n.KHR_DRACO_MESH_COMPRESSION]?a(h):X(new r.i,h,t),o[d]={primitive:h,promise:c},s.push(c)}return Promise.all(s)},W.prototype.loadMesh=function(e){for(var t,n=this,i=this.json,o=this.extensions,a=i.meshes[e],s=a.primitives,l=[],u=0,c=s.length;u<c;u++){var h=void 0===s[u].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new r.U({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.v})),t.DefaultMaterial):this.getDependency("material",s[u].material);l.push(h)}return l.push(n.loadGeometries(s)),Promise.all(l).then(function(t){for(var i=t.slice(0,t.length-1),l=t[t.length-1],u=[],c=0,h=l.length;c<h;c++){var d,f=l[c],p=s[c],m=i[c];if(p.mode===P||p.mode===M||p.mode===R||void 0===p.mode)d=!0===a.isSkinnedMesh?new r.rb(f,m):new r.Q(f,m),!0===m.isMeshStandardMaterial&&m.side===r.r&&null!==f.getIndex()&&!0===f.hasAttribute("position")&&!0===f.hasAttribute("normal")&&!0===f.hasAttribute("uv")&&!1===f.hasAttribute("tangent")&&(f.computeTangents(),m.vertexTangents=!0),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),p.mode===M?d.geometry=Y(d.geometry,r.yb):p.mode===R&&(d.geometry=Y(d.geometry,r.xb));else if(p.mode===T)d=new r.G(f,m);else if(p.mode===A)d=new r.D(f,m);else if(p.mode===S)d=new r.F(f,m);else{if(p.mode!==x)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);d=new r.gb(f,m)}Object.keys(d.geometry.morphAttributes).length>0&&z(d,a),d.name=n.createUniqueName(a.name||"mesh_"+e),G(d,a),p.extensions&&V(o,d,p),n.assignFinalMaterial(d),u.push(d)}if(1===u.length)return u[0];var g=new r.w;for(c=0,h=u.length;c<h;c++)g.add(u[c]);return g})},W.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new r.cb(r.O.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new r.bb(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),G(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},W.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return n.inverseBindMatrices=e,n})},W.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],o=[],a=[],s=[],l=0,u=t.channels.length;l<u;l++){var c=t.channels[l],h=t.samplers[c.sampler],d=c.target,f=void 0!==d.node?d.node:d.id,p=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;n.push(this.getDependency("node",f)),i.push(this.getDependency("accessor",p)),o.push(this.getDependency("accessor",m)),a.push(h),s.push(d)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(s)]).then(function(n){for(var i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],u=[],c=0,h=i.length;c<h;c++){var d=i[c],f=o[c],p=a[c],m=s[c],g=l[c];if(void 0!==d){var _;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,L[g.path]){case L.weights:_=r.Z;break;case L.rotation:_=r.kb;break;case L.position:case L.scale:default:_=r.Cb}var v=d.name?d.name:d.uuid,y=void 0!==m.interpolation?F[m.interpolation]:r.C,b=[];L[g.path]===L.weights?d.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)}):b.push(v);var x=p.array;if(p.normalized){var T;if(x.constructor===Int8Array)T=1/127;else if(x.constructor===Uint8Array)T=1/255;else if(x.constructor==Int16Array)T=1/32767;else{if(x.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");T=1/65535}for(var S=new Float32Array(x.length),A=0,P=x.length;A<P;A++)S[A]=x[A]*T;x=S}for(A=0,P=b.length;A<P;A++){var M=new _(b[A]+"."+L[g.path],f.array,x,y);"CUBICSPLINE"===m.interpolation&&(M.createInterpolant=function(e){return new E(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(M)}}}var R=t.name?t.name:"animation_"+e;return new r.c(R,void 0,u)})},W.prototype.loadNode=function(e){var t=this.json,n=this.extensions,i=this,o=t.nodes[e],a=o.name?i.createUniqueName(o.name):"";return function(){var t=[];return void 0!==o.mesh&&t.push(i.getDependency("mesh",o.mesh).then(function(e){var t=i._getNodeRef(i.meshCache,o.mesh,e);return void 0!==o.weights&&t.traverse(function(e){if(e.isMesh)for(var t=0,n=o.weights.length;t<n;t++)e.morphTargetInfluences[t]=o.weights[t]}),t})),void 0!==o.camera&&t.push(i.getDependency("camera",o.camera).then(function(e){return i._getNodeRef(i.cameraCache,o.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){t.push(e)}),Promise.all(t)}().then(function(t){var s;if((s=!0===o.isBone?new r.e:t.length>1?new r.w:1===t.length?t[0]:new r.ab)!==t[0])for(var l=0,u=t.length;l<u;l++)s.add(t[l]);if(o.name&&(s.userData.name=o.name,s.name=a),G(s,o),o.extensions&&V(n,s,o),void 0!==o.matrix){var c=new r.P;c.fromArray(o.matrix),s.applyMatrix4(c)}else void 0!==o.translation&&s.position.fromArray(o.translation),void 0!==o.rotation&&s.quaternion.fromArray(o.rotation),void 0!==o.scale&&s.scale.fromArray(o.scale);return i.associations.set(s,{type:"nodes",index:e}),s})},W.prototype.loadScene=function(){function e(t,n,i,o){var a=i.nodes[t];return o.getDependency("node",t).then(function(e){return void 0===a.skin?e:o.getDependency("skin",a.skin).then(function(e){for(var n=[],r=0,i=(t=e).joints.length;r<i;r++)n.push(o.getDependency("node",t.joints[r]));return Promise.all(n)}).then(function(n){return e.traverse(function(e){if(e.isMesh){for(var i=[],o=[],a=0,s=n.length;a<s;a++){var l=n[a];if(l){i.push(l);var u=new r.P;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*a),o.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new r.qb(i,o),e.matrixWorld)}}),e});var t}).then(function(t){n.add(t);var r=[];if(a.children)for(var s=a.children,l=0,u=s.length;l<u;l++){var c=s[l];r.push(e(c,t,i,o))}return Promise.all(r)})}return function(t){var n=this.json,i=this.extensions,o=this.json.scenes[t],a=new r.w;o.name&&(a.name=this.createUniqueName(o.name)),G(a,o),o.extensions&&V(i,a,o);for(var s=o.nodes||[],l=[],u=0,c=s.length;u<c;u++)l.push(e(s[u],a,n,this));return Promise.all(l).then(function(){return a})}}(),e}()},function(e,t,n){e.exports=function(){var e=function e(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(e){e.preventDefault(),n(++r%i.children.length)},!1);var o=(performance||Date).now(),a=o,s=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-o,200),e>a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,i=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,u=3*a,c=2*a,h=3*a,d=15*a,f=74*a,p=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,l),g.fillStyle=t,g.fillText(e,u,c),g.fillRect(h,d,f,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h,d,f,p),{dom:m,update:function(l,_){r=Math.min(r,l),i=Math.max(i,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,d),g.fillStyle=t,g.fillText(o(l)+" "+e+" ("+o(r)+"-"+o(i)+")",u,c),g.drawImage(m,h+a,d,f-a,p,h,d,f-a,p),g.fillRect(h+f-a,d,a,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(h+f-a,d,a,o((1-l/_)*p))}}},e}()},function(e,t,n){"use strict";function r(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+r+","+i+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+o+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+u+",a:"+a+"}":"unknown format"}n.d(t,"a",function(){return le});var i=Array.prototype.forEach,o=Array.prototype.slice,a={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(i&&e.forEach&&e.forEach===i)e.forEach(t,n);else if(e.length===e.length+0){var r,o=void 0;for(o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var a in e)if(t.call(n,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,o=arguments;var a=n||!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,o)},t),a&&e.apply(i,o)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},s=[{litmus:a.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:r},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:r},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:r},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:r}}},{litmus:a.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:a.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:a.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b)&&a.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(a.isNumber(e.r)&&a.isNumber(e.g)&&a.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v)&&a.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(a.isNumber(e.h)&&a.isNumber(e.s)&&a.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],l=void 0,u=void 0,c=function(){u=!1;var e=arguments.length>1?a.toArray(arguments):arguments[0];return a.each(s,function(t){if(t.litmus(e))return a.each(t.conversions,function(t,n){if(l=t.read(e),!1===u&&!1!==l)return u=l,l.conversionName=n,l.conversion=t,a.BREAK}),a.BREAK}),u},h=void 0,d={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),l=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),o=i-r,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(h=8*t)|e&~(255<<h)}},f="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},_=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},y=function(){function e(){if(p(this,e),this.__state=c.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return m(e,[{key:"toString",value:function(){return r(this)}},{key:"toHexString",value:function(){return r(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function b(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(y.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(y.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function E(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(y.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(y.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}y.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=d.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");a.extend(e.__state,d.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},y.recalculateHSV=function(e){var t=d.rgb_to_hsv(e.r,e.g,e.b);a.extend(e.__state,{s:t.s,v:t.v}),a.isNaN(t.h)?a.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},y.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(y.prototype,"r",2),b(y.prototype,"g",1),b(y.prototype,"b",0),E(y.prototype,"h"),E(y.prototype,"s"),E(y.prototype,"v"),Object.defineProperty(y.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(y.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=d.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var x=function(){function e(t,n){p(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return m(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),T={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){a.each(e,function(e){T[e]=t})});var S=/(\d+(\.\d+)?)px/;function A(e){if("0"===e||a.isUndefined(e))return 0;var t=e.match(S);return a.isNull(t)?0:parseFloat(t[1])}var P={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,i=t;a.isUndefined(i)&&(i=!0),a.isUndefined(r)&&(r=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var i=n||{},o=T[t];if(!o)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var l=i.x||i.clientX||0,u=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,l,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;a.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(t,i.bubbles||!1,i.cancelable||!0)}a.defaults(s,r),e.dispatchEvent(s)},bind:function(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),P},unbind:function(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),P},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return P},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return P},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return A(t["border-left-width"])+A(t["border-right-width"])+A(t["padding-left"])+A(t["padding-right"])+A(t.width)},getHeight:function(e){var t=getComputedStyle(e);return A(t["border-top-width"])+A(t["border-bottom-width"])+A(t["padding-top"])+A(t["padding-bottom"])+A(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},M=function(e){function t(e,n){p(this,t);var r=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),P.bind(r.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return _(t,x),m(t,[{key:"setValue",value:function(e){var n=g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),R=function(e){function t(e,n,r){p(this,t);var i=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r,s=i;if(i.__select=document.createElement("select"),a.isArray(o)){var l={};a.each(o,function(e){l[e]=e}),o=l}return a.each(o,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),i.updateDisplay(),P.bind(i.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e)}),i.domElement.appendChild(i.__select),i}return _(t,x),m(t,[{key:"setValue",value:function(e){var n=g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return P.isActive(this.__select)?this:(this.__select.value=this.getValue(),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),C=function(e){function t(e,n){p(this,t);var r=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function o(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),P.bind(r.__input,"keyup",o),P.bind(r.__input,"change",o),P.bind(r.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),P.bind(r.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return _(t,x),m(t,[{key:"updateDisplay",value:function(){return P.isActive(this.__input)||(this.__input.value=this.getValue()),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function w(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var O=function(e){function t(e,n,r){p(this,t);var i=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,a.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=w(i.__impliedStep),i}return _(t,x),m(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=w(e),this}}]),t}();var I=function(e){function t(e,n,r){p(this,t);var i=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));i.__truncationSuspended=!1;var o=i,s=void 0;function l(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function u(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),s=e.clientY}function c(){P.unbind(window,"mousemove",u),P.unbind(window,"mouseup",c),l()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),P.bind(i.__input,"change",function(){var e=parseFloat(o.__input.value);a.isNaN(e)||o.setValue(e)}),P.bind(i.__input,"blur",function(){l()}),P.bind(i.__input,"mousedown",function(e){P.bind(window,"mousemove",u),P.bind(window,"mouseup",c),s=e.clientY}),P.bind(i.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,l())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return _(t,O),m(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}(this.getValue(),this.__precision),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function D(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var L=function(e){function t(e,n,r,i,o){p(this,t);var a=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:o})),s=a;function l(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(D(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){P.unbind(window,"mousemove",l),P.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(D(t,n.left,n.right,s.__min,s.__max))}function h(){P.unbind(window,"touchmove",c),P.unbind(window,"touchend",h),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),P.bind(a.__background,"mousedown",function(e){document.activeElement.blur(),P.bind(window,"mousemove",l),P.bind(window,"mouseup",u),l(e)}),P.bind(a.__background,"touchstart",function(e){if(1!==e.touches.length)return;P.bind(window,"touchmove",c),P.bind(window,"touchend",h),c(e)}),P.addClass(a.__background,"slider"),P.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return _(t,O),m(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),F=function(e){function t(e,n,r){p(this,t);var i=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,P.bind(i.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),P.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return _(t,x),m(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),N=function(e){function t(e,n){p(this,t);var r=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new y(r.getValue()),r.__temp=new y(0);var i=r;r.domElement=document.createElement("div"),P.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",P.bind(r.__input,"keydown",function(e){13===e.keyCode&&f.call(this)}),P.bind(r.__input,"blur",f),P.bind(r.__selector,"mousedown",function(){P.addClass(this,"drag").bind(window,"mouseup",function(){P.removeClass(i.__selector,"drag")})}),P.bind(r.__selector,"touchstart",function(){P.addClass(this,"drag").bind(window,"touchend",function(){P.removeClass(i.__selector,"drag")})});var o,s=document.createElement("div");function l(e){g(e),P.bind(window,"mousemove",g),P.bind(window,"touchmove",g),P.bind(window,"mouseup",h),P.bind(window,"touchend",h)}function u(e){_(e),P.bind(window,"mousemove",_),P.bind(window,"touchmove",_),P.bind(window,"mouseup",d),P.bind(window,"touchend",d)}function h(){P.unbind(window,"mousemove",g),P.unbind(window,"touchmove",g),P.unbind(window,"mouseup",h),P.unbind(window,"touchend",h),m()}function d(){P.unbind(window,"mousemove",_),P.unbind(window,"touchmove",_),P.unbind(window,"mouseup",d),P.unbind(window,"touchend",d),m()}function f(){var e=c(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function m(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function g(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,o=n.clientY,a=(r-t.left)/(t.right-t.left),s=1-(o-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function _(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return a.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),a.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),a.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),a.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),a.extend(s.style,{width:"100%",height:"100%",background:"none"}),U(s,"top","rgba(0,0,0,0)","#000"),a.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=r.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),P.bind(r.__saturation_field,"mousedown",l),P.bind(r.__saturation_field,"touchstart",l),P.bind(r.__field_knob,"mousedown",l),P.bind(r.__field_knob,"touchstart",l),P.bind(r.__hue_field,"mousedown",u),P.bind(r.__hue_field,"touchstart",u),r.__saturation_field.appendChild(s),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return _(t,x),m(t,[{key:"updateDisplay",value:function(){var e=c(this.getValue());if(!1!==e){var t=!1;a.each(y.COMPONENTS,function(n){if(!a.isUndefined(e[n])&&!a.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&a.extend(this.__color.__state,e)}a.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;a.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,U(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),a.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(),B=["-moz-","-o-","-webkit-","-ms-",""];function U(e,t,n,r){e.style.background="",a.each(B,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}var k=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(o){}},V=function(e,t){var n=e[t];return a.isArray(arguments[2])||a.isObject(arguments[2])?new R(e,t,arguments[2]):a.isNumber(n)?a.isNumber(arguments[2])&&a.isNumber(arguments[3])?a.isNumber(arguments[4])?new L(e,t,arguments[2],arguments[3],arguments[4]):new L(e,t,arguments[2],arguments[3]):a.isNumber(arguments[4])?new I(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new I(e,t,{min:arguments[2],max:arguments[3]}):a.isString(n)?new C(e,t):a.isFunction(n)?new F(e,t,""):a.isBoolean(n)?new M(e,t):null};var G=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},z=function(){function e(){p(this,e),this.backgroundElement=document.createElement("div"),a.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),P.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),a.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;P.bind(this.backgroundElement,"click",function(){t.hide()})}return m(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),a.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",P.unbind(e.domElement,"webkitTransitionEnd",t),P.unbind(e.domElement,"transitionend",t),P.unbind(e.domElement,"oTransitionEnd",t)};P.bind(this.domElement,"webkitTransitionEnd",t),P.bind(this.domElement,"transitionend",t),P.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-P.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-P.getHeight(this.domElement)/2+"px"}}]),e}();k(function(e){if(e&&"undefined"!==typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var j="Default",H=function(){try{return!!window.localStorage}catch(e){return!1}}(),W=void 0,X=!0,Y=void 0,K=!1,q=[],Q=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),P.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=a.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=a.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),a.isUndefined(r.load)?r.load={preset:j}:r.preset&&(r.load.preset=r.preset),a.isUndefined(r.parent)&&r.hideable&&q.push(this),r.resizable=a.isUndefined(r.parent)&&r.resizable,r.autoPlace&&a.isUndefined(r.scrollable)&&(r.scrollable=!0);var i=H&&"true"===localStorage.getItem(ne(this,"isLocal")),o=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,ae(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,s&&(s.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?P.addClass(n.__ul,e.CLASS_CLOSED):P.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(e){H&&(i=e,e?P.bind(window,"unload",o):P.unbind(window,"unload",o),localStorage.setItem(ne(n,"isLocal"),e))}}}),a.isUndefined(r.parent)){if(this.closed=r.closed||!1,P.addClass(this.domElement,e.CLASS_MAIN),P.makeSelectable(this.domElement,!1),H&&i){n.useLocalStorage=!0;var l=localStorage.getItem(ne(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,P.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(P.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(P.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),P.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===r.closed&&(r.closed=!0);var u=document.createTextNode(r.name);P.addClass(u,"controller-name"),s=Z(n,u);P.addClass(this.__ul,e.CLASS_CLOSED),P.addClass(s,"title"),P.bind(s,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(a.isUndefined(r.parent)&&(X&&(Y=document.createElement("div"),P.addClass(Y,"dg"),P.addClass(Y,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Y),X=!1),Y.appendChild(this.domElement),P.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ae(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},P.bind(window,"resize",this.__resizeHandler),P.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),P.bind(this.__ul,"transitionend",this.__resizeHandler),P.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&oe(this),o=function(){H&&"true"===localStorage.getItem(ne(n,"isLocal"))&&localStorage.setItem(ne(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,r.parent||function(){var e=n.getRoot();e.width+=1,a.defer(function(){e.width-=1})}()};function Z(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function J(e){P.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&P.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function $(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function ee(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o[j])return;a=o[j]}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function te(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new N(t,n);else{var o=[t,n].concat(r.factoryArgs);i=V.apply(e,o)}r.before instanceof x&&(r.before=r.before.__li),ee(e,i),P.addClass(i.domElement,"c");var s=document.createElement("span");P.addClass(s,"property-name"),s.innerHTML=i.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(i.domElement);var u=Z(e,l,r.before);return P.addClass(u,Q.CLASS_CONTROLLER_ROW),i instanceof N?P.addClass(u,"color"):P.addClass(u,f(i.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,a.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),te(e,n.object,n.property,{before:r,factoryArgs:[a.toArray(arguments)]})}if(a.isArray(t)||a.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),te(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof L){var r=new I(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});a.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}}),P.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof I){var i=function(t){if(a.isNumber(n.__min)&&a.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=te(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(r),i&&o.listen(),o}return t};n.min=a.compose(i,n.min),n.max=a.compose(i,n.max)}else n instanceof M?(P.bind(t,"click",function(){P.fakeEvent(n.__checkbox,"click")}),P.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof F?(P.bind(t,"click",function(){P.fakeEvent(n.__button,"click")}),P.bind(t,"mouseover",function(){P.addClass(n.__button,"hover")}),P.bind(t,"mouseout",function(){P.removeClass(n.__button,"hover")})):n instanceof N&&(P.addClass(t,"color"),n.updateDisplay=a.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=a.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&$(e.getRoot(),!0),t},n.setValue)}(e,u,i),e.__controllers.push(i),i}function ne(e,t){return document.location.href+"."+t}function re(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ie(e,t){t.style.display=e.useLocalStorage?"block":"none"}function oe(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){P.removeClass(e.__closeButton,Q.CLASS_DRAG),P.unbind(window,"mousemove",n),P.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),t=i.clientX,P.addClass(e.__closeButton,Q.CLASS_DRAG),P.bind(window,"mousemove",n),P.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),a.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),P.bind(e.__resize_handle,"mousedown",i),P.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ae(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function se(e,t){var n={};return a.each(e.__rememberedObjects,function(r,i){var o={},s=e.__rememberedObjectIndecesToControllers[i];a.each(s,function(e,n){o[n]=t?e.initialValue:e.getValue()}),n[i]=o}),n}Q.toggleHide=function(){K=!K,a.each(q,function(e){e.domElement.style.display=K?"none":""})},Q.CLASS_AUTO_PLACE="a",Q.CLASS_AUTO_PLACE_CONTAINER="ac",Q.CLASS_MAIN="main",Q.CLASS_CONTROLLER_ROW="cr",Q.CLASS_TOO_TALL="taller-than-window",Q.CLASS_CLOSED="closed",Q.CLASS_CLOSE_BUTTON="close-button",Q.CLASS_CLOSE_TOP="close-top",Q.CLASS_CLOSE_BOTTOM="close-bottom",Q.CLASS_DRAG="drag",Q.DEFAULT_WIDTH=245,Q.TEXT_CLOSED="Close Controls",Q.TEXT_OPEN="Open Controls",Q._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Q.toggleHide()},P.bind(window,"keydown",Q._keydownHandler,!1),a.extend(Q.prototype,{add:function(e,t){return te(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return te(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;a.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Y.removeChild(this.domElement);var e=this;a.each(this.__folders,function(t){e.removeFolder(t)}),P.unbind(window,"keydown",Q._keydownHandler,!1),J(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Q(t);this.__folders[e]=n;var r=Z(this,n.domElement);return P.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],J(e);var t=this;a.each(e.__folders,function(t){e.removeFolder(t)}),a.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=P.getOffset(e.__ul).top,n=0;a.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=P.getHeight(t))}),window.innerHeight-t-20<n?(P.addClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(P.removeClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&a.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:a.debounce(function(){this.onResize()},50),remember:function(){if(a.isUndefined(W)&&((W=new z).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;a.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");P.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),P.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",P.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",P.addClass(r,"button"),P.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",P.addClass(i,"button"),P.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",P.addClass(o,"button"),P.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?a.each(e.load.remembered,function(t,n){re(e,n,n===e.preset)}):re(e,j,!1);if(P.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(o),H){var l=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(ne(e,"isLocal"))&&u.setAttribute("checked","checked"),ie(e,l),P.bind(u,"change",function(){e.useLocalStorage=!e.useLocalStorage,ie(e,l)})}var h=document.getElementById("dg-new-constructor");P.bind(h,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||W.hide()}),P.bind(n,"click",function(){h.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),W.show(),h.focus(),h.select()}),P.bind(r,"click",function(){e.save()}),P.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),P.bind(o,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ae(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=se(this)),e.folders={},a.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=se(this),$(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[j]=se(this,!0)),this.load.remembered[e]=se(this),this.preset=e,re(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){a.each(this.__controllers,function(t){this.getRoot().load.remembered?ee(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),a.each(this.__folders,function(e){e.revert(e)}),e||$(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&G.call(window,function(){e(t)});a.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){a.each(this.__controllers,function(e){e.updateDisplay()}),a.each(this.__folders,function(e){e.updateDisplay()})}});var le=Q},function(e,t,n){var r;r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/libs",n(n.s=1)}([function(t,n){t.exports=e},function(e,t,n){"use strict";var r=n(0),i={name:"matter-attractors",version:"0.1.4",for:"matter-js@^0.12.0",install:function(e){e.after("Body.create",function(){i.Body.init(this)}),e.before("Engine.update",function(e){i.Engine.update(e)})},Body:{init:function(e){e.plugin.attractors=e.plugin.attractors||[]}},Engine:{update:function(e){for(var t=e.world,n=r.Composite.allBodies(t),i=0;i<n.length;i+=1){var o=n[i],a=o.plugin.attractors;if(a&&a.length>0)for(var s=0;s<n.length;s+=1){var l=n[s];if(l.id!==o.id)for(var u=0;u<a.length;u+=1){var c=a[u],h=c;r.Common.isFunction(c)&&(h=c(o,l)),h&&r.Body.applyForce(l,l.position,h)}}}}},Attractors:{gravityConstant:.001,gravity:function(e,t){var n=r.Vector.sub(t.position,e.position),o=r.Vector.magnitudeSquared(n)||1e-4,a=r.Vector.normalise(n),s=-i.Attractors.gravityConstant*(e.mass*t.mass/o),l=r.Vector.mult(a,s);r.Body.applyForce(e,e.position,r.Vector.neg(l)),r.Body.applyForce(t,t.position,l)}}};r.Plugin.register(i),e.exports=i}])},e.exports=r(n(12))},function(e,t,n){"use strict";(function(t){var n="__global_unique_id__";e.exports=function(){return t[n]=(t[n]||0)+1}}).call(this,n(31))},function(e,t,n){"use strict";var r=n(37),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return r.isMemo(e)?a:s[e.$$typeof]||i}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0};var u=Object.defineProperty,c=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(p){var i=f(n);i&&i!==p&&e(t,i,r)}var a=c(n);h&&(a=a.concat(h(n)));for(var s=l(t),m=l(n),g=0;g<a.length;++g){var _=a[g];if(!o[_]&&(!r||!r[_])&&(!m||!m[_])&&(!s||!s[_])){var v=d(n,_);try{u(t,_,v)}catch(y){}}}return t}return t}},,function(e,t,n){"use strict";var r=n(36),i=60103,o=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var a=60109,s=60110,l=60112;t.Suspense=60113;var u=60115,c=60116;if("function"===typeof Symbol&&Symbol.for){var h=Symbol.for;i=h("react.element"),o=h("react.portal"),t.Fragment=h("react.fragment"),t.StrictMode=h("react.strict_mode"),t.Profiler=h("react.profiler"),a=h("react.provider"),s=h("react.context"),l=h("react.forward_ref"),t.Suspense=h("react.suspense"),u=h("react.memo"),c=h("react.lazy")}var d="function"===typeof Symbol&&Symbol.iterator;function f(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function _(){}function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(f(85));this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=g.prototype;var y=v.prototype=new _;y.constructor=v,r(y,g.prototype),y.isPureReactComponent=!0;var b={current:null},E=Object.prototype.hasOwnProperty,x={key:!0,ref:!0,__self:!0,__source:!0};function T(e,t,n){var r,o={},a=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)E.call(t,r)&&!x.hasOwnProperty(r)&&(o[r]=t[r]);var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];o.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===o[r]&&(o[r]=l[r]);return{$$typeof:i,type:e,key:a,ref:s,props:o,_owner:b.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var A=/\/+/g;function P(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function M(e,t,n,r,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case o:l=!0}}if(l)return a=a(l=e),e=""===r?"."+P(l,0):r,Array.isArray(a)?(n="",null!=e&&(n=e.replace(A,"$&/")+"/"),M(a,t,n,"",function(e){return e})):null!=a&&(S(a)&&(a=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,n+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(A,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=""===r?".":r+":",Array.isArray(e))for(var u=0;u<e.length;u++){var c=r+P(s=e[u],u);l+=M(s,t,n,c,a)}else if("function"===typeof(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e)))for(e=c.call(e),u=0;!(s=e.next()).done;)l+=M(s=s.value,t,n,c=r+P(s,u++),a);else if("object"===s)throw t=""+e,Error(f(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function R(e,t,n){if(null==e)return e;var r=[],i=0;return M(e,r,"","",function(e){return t.call(n,e,i++)}),r}function C(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then(function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)},function(t){0===e._status&&(e._status=2,e._result=t)})}if(1===e._status)return e._result;throw e._result}var w={current:null};function O(){var e=w.current;if(null===e)throw Error(f(321));return e}var I={ReactCurrentDispatcher:w,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:R,forEach:function(e,t,n){R(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!S(e))throw Error(f(143));return e}},t.Component=g,t.PureComponent=v,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(f(267,e));var o=r({},e.props),a=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=b.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)E.call(t,c)&&!x.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=n;else if(1<c){u=Array(c);for(var h=0;h<c;h++)u[h]=arguments[h+2];o.children=u}return{$$typeof:i,type:e.type,key:a,ref:s,props:o,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=T,t.createFactory=function(e){var t=T.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:c,_payload:{_status:-1,_result:e},_init:C}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return O().useCallback(e,t)},t.useContext=function(e,t){return O().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return O().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return O().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return O().useLayoutEffect(e,t)},t.useMemo=function(e,t){return O().useMemo(e,t)},t.useReducer=function(e,t,n){return O().useReducer(e,t,n)},t.useRef=function(e){return O().useRef(e)},t.useState=function(e){return O().useState(e)},t.version="17.0.1"},function(e,t,n){"use strict";var r=n(3),i=n(36),o=n(48);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(a(227));var s=new Set,l={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(l[e]=t,e=0;e<t.length;e++)s.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f=Object.prototype.hasOwnProperty,p={},m={};function g(e,t,n,r,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){_[e]=new g(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];_[t]=new g(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){_[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){_[e]=new g(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){_[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){_[e]=new g(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){_[e]=new g(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){_[e]=new g(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){_[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=_.hasOwnProperty(t)?_[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!f.call(m,e)||!f.call(p,e)&&(d.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);_[t]=new g(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);_[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);_[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){_[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)}),_.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){_[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)});var E=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=60103,T=60106,S=60107,A=60108,P=60114,M=60109,R=60110,C=60112,w=60113,O=60120,I=60115,D=60116,L=60121,F=60128,N=60129,B=60130,U=60131;if("function"===typeof Symbol&&Symbol.for){var k=Symbol.for;x=k("react.element"),T=k("react.portal"),S=k("react.fragment"),A=k("react.strict_mode"),P=k("react.profiler"),M=k("react.provider"),R=k("react.context"),C=k("react.forward_ref"),w=k("react.suspense"),O=k("react.suspense_list"),I=k("react.memo"),D=k("react.lazy"),L=k("react.block"),k("react.scope"),F=k("react.opaque.id"),N=k("react.debug_trace_mode"),B=k("react.offscreen"),U=k("react.legacy_hidden")}var V,G="function"===typeof Symbol&&Symbol.iterator;function z(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=G&&e[G]||e["@@iterator"])?e:null}function j(e){if(void 0===V)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);V=t&&t[1]||""}return"\n"+V+e}var H=!1;function W(e,t){if(!e||H)return"";H=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s])return"\n"+i[a].replace(" at new "," at ")}while(1<=a&&0<=s);break}}}finally{H=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?j(e):""}function X(e){switch(e.tag){case 5:return j(e.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 22:return e=W(e.type._render,!1);case 1:return e=W(e.type,!0);default:return""}}function Y(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case T:return"Portal";case P:return"Profiler";case A:return"StrictMode";case w:return"Suspense";case O:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case R:return(e.displayName||"Context")+".Consumer";case M:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case I:return Y(e.type);case L:return Y(e._render);case D:t=e._payload,e=e._init;try{return Y(e(t))}catch(n){}}return null}function K(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Q(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Z(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function J(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=K(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=K(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,K(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&J(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function oe(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,function(e){null!=e&&(t+=e)}),t}(t.children))&&(e.children=t),e}function ae(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+K(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:K(n)}}function ue(e,t){var n=K(t.value),r=K(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ce(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var he={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function de(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?de(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var pe,me,ge=(me=function(e,t){if(e.namespaceURI!==he.svg||"innerHTML"in e)e.innerHTML=t;else{for((pe=pe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=pe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return me(e,t)})}:me);function _e(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var ve={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ye=["Webkit","ms","Moz","O"];function be(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||ve.hasOwnProperty(e)&&ve[e]?(""+t).trim():t+"px"}function Ee(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=be(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(ve).forEach(function(e){ye.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ve[t]=ve[e]})});var xe=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Te(e,t){if(t){if(xe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if(!("object"===typeof t.dangerouslySetInnerHTML&&"__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function Se(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ae(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Pe=null,Me=null,Re=null;function Ce(e){if(e=Zr(e)){if("function"!==typeof Pe)throw Error(a(280));var t=e.stateNode;t&&(t=$r(t),Pe(e.stateNode,e.type,t))}}function we(e){Me?Re?Re.push(e):Re=[e]:Me=e}function Oe(){if(Me){var e=Me,t=Re;if(Re=Me=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Ie(e,t){return e(t)}function De(e,t,n,r,i){return e(t,n,r,i)}function Le(){}var Fe=Ie,Ne=!1,Be=!1;function Ue(){null===Me&&null===Re||(Le(),Oe())}function ke(e,t){var n=e.stateNode;if(null===n)return null;var r=$r(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Ve=!1;if(h)try{var Ge={};Object.defineProperty(Ge,"passive",{get:function(){Ve=!0}}),window.addEventListener("test",Ge,Ge),window.removeEventListener("test",Ge,Ge)}catch(me){Ve=!1}var ze=!1,je=null,He=!1,We=null,Xe={onError:function(e){ze=!0,je=e}};function Ye(e,t,n,r,i,o,a,s,l){ze=!1,je=null,function(e,t,n,r,i,o,a,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(c){this.onError(c)}}.apply(Xe,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Qe(e){if(Ke(e)!==e)throw Error(a(188))}function Ze(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Qe(i),e;if(o===r)return Qe(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,l=i.child;l;){if(l===n){s=!0,n=i,r=o;break}if(l===r){s=!0,r=i,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,r=i;break}if(l===r){s=!0,r=o,n=i;break}l=l.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function Je(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var $e,et,tt,nt,rt=!1,it=[],ot=null,at=null,st=null,lt=new Map,ut=new Map,ct=[],ht="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dt(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function ft(e,t){switch(e){case"focusin":case"focusout":ot=null;break;case"dragenter":case"dragleave":at=null;break;case"mouseover":case"mouseout":st=null;break;case"pointerover":case"pointerout":lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ut.delete(t.pointerId)}}function pt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e=dt(t,n,r,i,o),null!==t&&(null!==(t=Zr(t))&&et(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function mt(e){var t=Qr(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void nt(e.lanePriority,function(){o.unstable_runWithPriority(e.priority,function(){tt(n)})})}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function gt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=Zr(n))&&et(t),e.blockedOn=n,!1;t.shift()}return!0}function _t(e,t,n){gt(e)&&n.delete(t)}function vt(){for(rt=!1;0<it.length;){var e=it[0];if(null!==e.blockedOn){null!==(e=Zr(e.blockedOn))&&$e(e);break}for(var t=e.targetContainers;0<t.length;){var n=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&it.shift()}null!==ot&&gt(ot)&&(ot=null),null!==at&&gt(at)&&(at=null),null!==st&&gt(st)&&(st=null),lt.forEach(_t),ut.forEach(_t)}function yt(e,t){e.blockedOn===t&&(e.blockedOn=null,rt||(rt=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,vt)))}function bt(e){function t(t){return yt(t,e)}if(0<it.length){yt(it[0],e);for(var n=1;n<it.length;n++){var r=it[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==ot&&yt(ot,e),null!==at&&yt(at,e),null!==st&&yt(st,e),lt.forEach(t),ut.forEach(t),n=0;n<ct.length;n++)(r=ct[n]).blockedOn===e&&(r.blockedOn=null);for(;0<ct.length&&null===(n=ct[0]).blockedOn;)mt(n),null===n.blockedOn&&ct.shift()}function Et(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xt={animationend:Et("Animation","AnimationEnd"),animationiteration:Et("Animation","AnimationIteration"),animationstart:Et("Animation","AnimationStart"),transitionend:Et("Transition","TransitionEnd")},Tt={},St={};function At(e){if(Tt[e])return Tt[e];if(!xt[e])return e;var t,n=xt[e];for(t in n)if(n.hasOwnProperty(t)&&t in St)return Tt[e]=n[t];return e}h&&(St=document.createElement("div").style,"AnimationEvent"in window||(delete xt.animationend.animation,delete xt.animationiteration.animation,delete xt.animationstart.animation),"TransitionEvent"in window||delete xt.transitionend.transition);var Pt=At("animationend"),Mt=At("animationiteration"),Rt=At("animationstart"),Ct=At("transitionend"),wt=new Map,Ot=new Map,It=["abort","abort",Pt,"animationEnd",Mt,"animationIteration",Rt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ct,"transitionEnd","waiting","waiting"];function Dt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Ot.set(r,t),wt.set(r,i),u(i,[r])}}(0,o.unstable_now)();var Lt=8;function Ft(e){if(0!==(1&e))return Lt=15,1;if(0!==(2&e))return Lt=14,2;if(0!==(4&e))return Lt=13,4;var t=24&e;return 0!==t?(Lt=12,t):0!==(32&e)?(Lt=11,32):0!==(t=192&e)?(Lt=10,t):0!==(256&e)?(Lt=9,256):0!==(t=3584&e)?(Lt=8,t):0!==(4096&e)?(Lt=7,4096):0!==(t=4186112&e)?(Lt=6,t):0!==(t=62914560&e)?(Lt=5,t):67108864&e?(Lt=4,67108864):0!==(134217728&e)?(Lt=3,134217728):0!==(t=805306368&e)?(Lt=2,t):0!==(1073741824&e)?(Lt=1,1073741824):(Lt=8,e)}function Nt(e,t){var n=e.pendingLanes;if(0===n)return Lt=0;var r=0,i=0,o=e.expiredLanes,a=e.suspendedLanes,s=e.pingedLanes;if(0!==o)r=o,i=Lt=15;else if(0!==(o=134217727&n)){var l=o&~a;0!==l?(r=Ft(l),i=Lt):0!==(s&=o)&&(r=Ft(s),i=Lt)}else 0!==(o=n&~a)?(r=Ft(o),i=Lt):0!==s&&(r=Ft(s),i=Lt);if(0===r)return 0;if(r=n&((0>(r=31-zt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&a)){if(Ft(t),i<=Lt)return t;Lt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-zt(t)),r|=e[n],t&=~i;return r}function Bt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ut(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=kt(24&~t))?Ut(10,t):e;case 10:return 0===(e=kt(192&~t))?Ut(8,t):e;case 8:return 0===(e=kt(3584&~t))&&(0===(e=kt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=kt(805306368&~t))&&(t=268435456),t}throw Error(a(358,e))}function kt(e){return e&-e}function Vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Gt(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-zt(t)]=n}var zt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(jt(e)/Ht|0)|0},jt=Math.log,Ht=Math.LN2;var Wt=o.unstable_UserBlockingPriority,Xt=o.unstable_runWithPriority,Yt=!0;function Kt(e,t,n,r){Ne||Le();var i=Qt,o=Ne;Ne=!0;try{De(i,e,t,n,r)}finally{(Ne=o)||Ue()}}function qt(e,t,n,r){Xt(Wt,Qt.bind(null,e,t,n,r))}function Qt(e,t,n,r){var i;if(Yt)if((i=0===(4&t))&&0<it.length&&-1<ht.indexOf(e))e=dt(null,e,t,n,r),it.push(e);else{var o=Zt(e,t,n,r);if(null===o)i&&ft(e,r);else{if(i){if(-1<ht.indexOf(e))return e=dt(o,e,t,n,r),void it.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return ot=pt(ot,e,t,n,r,i),!0;case"dragenter":return at=pt(at,e,t,n,r,i),!0;case"mouseover":return st=pt(st,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return lt.set(o,pt(lt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,ut.set(o,pt(ut.get(o)||null,e,t,n,r,i)),!0}return!1}(o,e,t,n,r))return;ft(e,r)}Cr(e,t,r,null,n)}}}function Zt(e,t,n,r){var i=Ae(r);if(null!==(i=Qr(i))){var o=Ke(i);if(null===o)i=null;else{var a=o.tag;if(13===a){if(null!==(i=qe(o)))return i;i=null}else if(3===a){if(o.stateNode.hydrate)return 3===o.tag?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null)}}return Cr(e,t,r,i,n),null}var Jt=null,$t=null,en=null;function tn(){if(en)return en;var e,t,n=$t,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return en=i.slice(e,1<t?1-t:void 0)}function nn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rn(){return!0}function on(){return!1}function an(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?rn:on,this.isPropagationStopped=on,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),t}var sn,ln,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hn=an(cn),dn=i({},cn,{view:0,detail:0}),fn=an(dn),pn=i({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(sn=e.screenX-un.screenX,ln=e.screenY-un.screenY):ln=sn=0,un=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),mn=an(pn),gn=an(i({},pn,{dataTransfer:0})),_n=an(i({},dn,{relatedTarget:0})),vn=an(i({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=an(i({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),bn=an(i({},cn,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function An(){return Sn}var Pn=an(i({},dn,{key:function(e){if(e.key){var t=En[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=nn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?nn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?nn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Mn=an(i({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rn=an(i({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),Cn=an(i({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),wn=an(i({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),On=[9,13,27,32],In=h&&"CompositionEvent"in window,Dn=null;h&&"documentMode"in document&&(Dn=document.documentMode);var Ln=h&&"TextEvent"in window&&!Dn,Fn=h&&(!In||Dn&&8<Dn&&11>=Dn),Nn=String.fromCharCode(32),Bn=!1;function Un(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function jn(e,t,n,r){we(r),0<(t=Or(t,"onChange")).length&&(n=new hn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,Wn=null;function Xn(e){Tr(e,0)}function Yn(e){if(Z(Jr(e)))return e}function Kn(e,t){if("change"===e)return t}var qn=!1;if(h){var Qn;if(h){var Zn="oninput"in document;if(!Zn){var Jn=document.createElement("div");Jn.setAttribute("oninput","return;"),Zn="function"===typeof Jn.oninput}Qn=Zn}else Qn=!1;qn=Qn&&(!document.documentMode||9<document.documentMode)}function $n(){Hn&&(Hn.detachEvent("onpropertychange",er),Wn=Hn=null)}function er(e){if("value"===e.propertyName&&Yn(Wn)){var t=[];if(jn(t,Wn,e,Ae(e)),e=Xn,Ne)e(t);else{Ne=!0;try{Ie(e,t)}finally{Ne=!1,Ue()}}}}function tr(e,t,n){"focusin"===e?($n(),Wn=n,(Hn=t).attachEvent("onpropertychange",er)):"focusout"===e&&$n()}function nr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Wn)}function rr(e,t){if("click"===e)return Yn(t)}function ir(e,t){if("input"===e||"change"===e)return Yn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},ar=Object.prototype.hasOwnProperty;function sr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!ar.call(t,n[r])||!or(e[n[r]],t[n[r]]))return!1;return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function cr(){for(var e=window,t=J();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=J((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var dr=h&&"documentMode"in document&&11>=document.documentMode,fr=null,pr=null,mr=null,gr=!1;function _r(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;gr||null==fr||fr!==J(r)||("selectionStart"in(r=fr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&sr(mr,r)||(mr=r,0<(r=Or(pr,"onSelect")).length&&(t=new hn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=fr)))}Dt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Dt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Dt(It,2);for(var vr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),yr=0;yr<vr.length;yr++)Ot.set(vr[yr],0);c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var br="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Er=new Set("cancel close invalid load scroll toggle".split(" ").concat(br));function xr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,l,u){if(Ye.apply(this,arguments),ze){if(!ze)throw Error(a(198));var c=je;ze=!1,je=null,He||(He=!0,We=c)}}(r,t,void 0,e),e.currentTarget=null}function Tr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==o&&i.isPropagationStopped())break e;xr(i,s,u),o=l}else for(a=0;a<r.length;a++){if(l=(s=r[a]).instance,u=s.currentTarget,s=s.listener,l!==o&&i.isPropagationStopped())break e;xr(i,s,u),o=l}}}if(He)throw e=We,He=!1,We=null,e}function Sr(e,t){var n=ei(t),r=e+"__bubble";n.has(r)||(Rr(t,e,2,!1),n.add(r))}var Ar="_reactListening"+Math.random().toString(36).slice(2);function Pr(e){e[Ar]||(e[Ar]=!0,s.forEach(function(t){Er.has(t)||Mr(t,!1,e,null),Mr(t,!0,e,null)}))}function Mr(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=n;if("selectionchange"===e&&9!==n.nodeType&&(o=n.ownerDocument),null!==r&&!t&&Er.has(e)){if("scroll"!==e)return;i|=2,o=r}var a=ei(o),s=e+"__"+(t?"capture":"bubble");a.has(s)||(t&&(i|=4),Rr(o,e,i,t),a.add(s))}function Rr(e,t,n,r){var i=Ot.get(t);switch(void 0===i?2:i){case 0:i=Kt;break;case 1:i=qt;break;default:i=Qt}n=i.bind(null,t,n,e),i=void 0,!Ve||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Cr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=Qr(s)))return;if(5===(l=a.tag)||6===l){r=o=a;continue e}s=s.parentNode}}r=r.return}!function(e,t,n){if(Be)return e(t,n);Be=!0;try{Fe(e,t,n)}finally{Be=!1,Ue()}}(function(){var r=o,i=Ae(n),a=[];e:{var s=wt.get(e);if(void 0!==s){var l=hn,u=e;switch(e){case"keypress":if(0===nn(n))break e;case"keydown":case"keyup":l=Pn;break;case"focusin":u="focus",l=_n;break;case"focusout":u="blur",l=_n;break;case"beforeblur":case"afterblur":l=_n;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=mn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Rn;break;case Pt:case Mt:case Rt:l=vn;break;case Ct:l=Cn;break;case"scroll":l=fn;break;case"wheel":l=wn;break;case"copy":case"cut":case"paste":l=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Mn}var c=0!==(4&t),h=!c&&"scroll"===e,d=c?null!==s?s+"Capture":null:s;c=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&(null!=(m=ke(p,d))&&c.push(wr(p,m,f)))),h)break;p=p.return}0<c.length&&(s=new l(s,u,null,n,i),a.push({event:s,listeners:c}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(u=n.relatedTarget||n.fromElement)||!Qr(u)&&!u[Kr])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(u=(u=n.relatedTarget||n.toElement)?Qr(u):null)&&(u!==(h=Ke(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=r),l!==u)){if(c=mn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=Mn,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?s:Jr(l),f=null==u?s:Jr(u),(s=new c(m,p+"leave",l,n,i)).target=h,s.relatedTarget=f,m=null,Qr(i)===r&&((c=new c(d,p+"enter",u,n,i)).target=f,c.relatedTarget=h,m=c),h=m,l&&u)e:{for(d=u,p=0,f=c=l;f;f=Ir(f))p++;for(f=0,m=d;m;m=Ir(m))f++;for(;0<p-f;)c=Ir(c),p--;for(;0<f-p;)d=Ir(d),f--;for(;p--;){if(c===d||null!==d&&c===d.alternate)break e;c=Ir(c),d=Ir(d)}c=null}else c=null;null!==l&&Dr(a,s,l,c,!1),null!==u&&null!==h&&Dr(a,h,u,c,!0)}if("select"===(l=(s=r?Jr(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Kn;else if(zn(s))if(qn)g=ir;else{g=nr;var _=tr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=rr);switch(g&&(g=g(e,r))?jn(a,g,n,i):(_&&_(e,s,r),"focusout"===e&&(_=s._wrapperState)&&_.controlled&&"number"===s.type&&ie(s,"number",s.value)),_=r?Jr(r):window,e){case"focusin":(zn(_)||"true"===_.contentEditable)&&(fr=_,pr=r,mr=null);break;case"focusout":mr=pr=fr=null;break;case"mousedown":gr=!0;break;case"contextmenu":case"mouseup":case"dragend":gr=!1,_r(a,n,i);break;case"selectionchange":if(dr)break;case"keydown":case"keyup":_r(a,n,i)}var v;if(In)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Vn?Un(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(Fn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Vn&&(v=tn()):($t="value"in(Jt=i)?Jt.value:Jt.textContent,Vn=!0)),0<(_=Or(r,y)).length&&(y=new bn(y,e,null,n,i),a.push({event:y,listeners:_}),v?y.data=v:null!==(v=kn(n))&&(y.data=v))),(v=Ln?function(e,t){switch(e){case"compositionend":return kn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Nn);case"textInput":return(e=t.data)===Nn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!In&&Un(e,t)?(e=tn(),en=$t=Jt=null,Vn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&(0<(r=Or(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=v))}Tr(a,t)})}function wr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Or(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=ke(e,n))&&r.unshift(wr(e,o,i)),null!=(o=ke(e,t))&&r.push(wr(e,o,i))),e=e.return}return r}function Ir(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Dr(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,l=s.alternate,u=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==u&&(s=u,i?null!=(l=ke(n,o))&&a.unshift(wr(n,l,s)):i||null!=(l=ke(n,o))&&a.push(wr(n,l,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}function Lr(){}var Fr=null,Nr=null;function Br(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Ur(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var kr="function"===typeof setTimeout?setTimeout:void 0,Vr="function"===typeof clearTimeout?clearTimeout:void 0;function Gr(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function zr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function jr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Hr=0;var Wr=Math.random().toString(36).slice(2),Xr="__reactFiber$"+Wr,Yr="__reactProps$"+Wr,Kr="__reactContainer$"+Wr,qr="__reactEvents$"+Wr;function Qr(e){var t=e[Xr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Kr]||n[Xr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=jr(e);null!==e;){if(n=e[Xr])return n;e=jr(e)}return t}n=(e=n).parentNode}return null}function Zr(e){return!(e=e[Xr]||e[Kr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Jr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function $r(e){return e[Yr]||null}function ei(e){var t=e[qr];return void 0===t&&(t=e[qr]=new Set),t}var ti=[],ni=-1;function ri(e){return{current:e}}function ii(e){0>ni||(e.current=ti[ni],ti[ni]=null,ni--)}function oi(e,t){ti[++ni]=e.current,e.current=t}var ai={},si=ri(ai),li=ri(!1),ui=ai;function ci(e,t){var n=e.type.contextTypes;if(!n)return ai;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function hi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function di(){ii(li),ii(si)}function fi(e,t,n){if(si.current!==ai)throw Error(a(168));oi(si,t),oi(li,n)}function pi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in e))throw Error(a(108,Y(t)||"Unknown",o));return i({},n,r)}function mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ai,ui=si.current,oi(si,e),oi(li,li.current),!0}function gi(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=pi(e,t,ui),r.__reactInternalMemoizedMergedChildContext=e,ii(li),ii(si),oi(si,e)):ii(li),oi(li,n)}var _i=null,vi=null,yi=o.unstable_runWithPriority,bi=o.unstable_scheduleCallback,Ei=o.unstable_cancelCallback,xi=o.unstable_shouldYield,Ti=o.unstable_requestPaint,Si=o.unstable_now,Ai=o.unstable_getCurrentPriorityLevel,Pi=o.unstable_ImmediatePriority,Mi=o.unstable_UserBlockingPriority,Ri=o.unstable_NormalPriority,Ci=o.unstable_LowPriority,wi=o.unstable_IdlePriority,Oi={},Ii=void 0!==Ti?Ti:function(){},Di=null,Li=null,Fi=!1,Ni=Si(),Bi=1e4>Ni?Si:function(){return Si()-Ni};function Ui(){switch(Ai()){case Pi:return 99;case Mi:return 98;case Ri:return 97;case Ci:return 96;case wi:return 95;default:throw Error(a(332))}}function ki(e){switch(e){case 99:return Pi;case 98:return Mi;case 97:return Ri;case 96:return Ci;case 95:return wi;default:throw Error(a(332))}}function Vi(e,t){return e=ki(e),yi(e,t)}function Gi(e,t,n){return e=ki(e),bi(e,t,n)}function zi(){if(null!==Li){var e=Li;Li=null,Ei(e)}ji()}function ji(){if(!Fi&&null!==Di){Fi=!0;var e=0;try{var t=Di;Vi(99,function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}}),Di=null}catch(n){throw null!==Di&&(Di=Di.slice(e+1)),bi(Pi,zi),n}finally{Fi=!1}}}var Hi=E.ReactCurrentBatchConfig;function Wi(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Xi=ri(null),Yi=null,Ki=null,qi=null;function Qi(){qi=Ki=Yi=null}function Zi(e){var t=Xi.current;ii(Xi),e.type._context._currentValue=t}function Ji(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function $i(e,t){Yi=e,qi=Ki=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(wa=!0),e.firstContext=null)}function eo(e,t){if(qi!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(qi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ki){if(null===Yi)throw Error(a(308));Ki=t,Yi.dependencies={lanes:0,firstContext:t,responders:null}}else Ki=Ki.next=t;return e._currentValue}var to=!1;function no(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function ro(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function io(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function oo(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ao(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function so(e,t,n,r){var o=e.updateQueue;to=!1;var a=o.firstBaseUpdate,s=o.lastBaseUpdate,l=o.shared.pending;if(null!==l){o.shared.pending=null;var u=l,c=u.next;u.next=null,null===s?a=c:s.next=c,s=u;var h=e.alternate;if(null!==h){var d=(h=h.updateQueue).lastBaseUpdate;d!==s&&(null===d?h.firstBaseUpdate=c:d.next=c,h.lastBaseUpdate=u)}}if(null!==a){for(d=o.baseState,s=0,h=c=u=null;;){l=a.lane;var f=a.eventTime;if((r&l)===l){null!==h&&(h=h.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,m=a;switch(l=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,l);break e}d=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null===(l="function"===typeof(p=m.payload)?p.call(f,d,l):p)||void 0===l)break e;d=i({},d,l);break e;case 2:to=!0}}null!==a.callback&&(e.flags|=32,null===(l=o.effects)?o.effects=[a]:l.push(a))}else f={eventTime:f,lane:l,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===h?(c=h=f,u=d):h=h.next=f,s|=l;if(null===(a=a.next)){if(null===(l=o.shared.pending))break;a=l.next,l.next=null,o.lastBaseUpdate=l,o.shared.pending=null}}null===h&&(u=d),o.baseState=u,o.firstBaseUpdate=c,o.lastBaseUpdate=h,Ds|=s,e.lanes=s,e.memoizedState=d}}function lo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var uo=(new r.Component).refs;function co(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ho={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=il(),i=ol(e),o=io(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),oo(e,o),al(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=il(),i=ol(e),o=io(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),oo(e,o),al(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=il(),r=ol(e),i=io(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),oo(e,i),al(e,r,n)}};function fo(e,t,n,r,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!sr(n,r)||!sr(i,o))}function po(e,t,n){var r=!1,i=ai,o=t.contextType;return"object"===typeof o&&null!==o?o=eo(o):(i=hi(t)?ui:si.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?ci(e,i):ai),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ho,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function mo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ho.enqueueReplaceState(t,t.state,null)}function go(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=uo,no(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=eo(o):(o=hi(t)?ui:si.current,i.context=ci(e,o)),so(e,n,i,r),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(co(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ho.enqueueReplaceState(i,i.state,null),so(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var _o=Array.isArray;function vo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===uo&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function yo(e,t){if("textarea"!==e.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function bo(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Fl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=kl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=vo(e,t,n),r.return=e,r):((r=Nl(n.type,n.key,n.props,null,e.mode,r)).ref=vo(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Vl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,o){return null===t||7!==t.tag?((t=Bl(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=kl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Nl(t.type,t.key,t.props,null,e.mode,n)).ref=vo(e,null,t),n.return=e,n;case T:return(t=Vl(t,e.mode,n)).return=e,t}if(_o(t)||z(t))return(t=Bl(t,e.mode,n,null)).return=e,t;yo(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?n.type===S?h(e,t,n.props.children,r,i):u(e,t,n,r):null;case T:return n.key===i?c(e,t,n,r):null}if(_o(n)||z(n))return null!==i?null:h(e,t,n,r,null);yo(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return e=e.get(null===r.key?n:r.key)||null,r.type===S?h(t,e,r.props.children,i,r.key):u(t,e,r,i);case T:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(_o(r)||z(r))return h(t,e=e.get(n)||null,r,i,null);yo(t,r)}return null}function m(i,a,s,l){for(var u=null,c=null,h=a,m=a=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var _=f(i,h,s[m],l);if(null===_){null===h&&(h=g);break}e&&h&&null===_.alternate&&t(i,h),a=o(_,a,m),null===c?u=_:c.sibling=_,c=_,h=g}if(m===s.length)return n(i,h),u;if(null===h){for(;m<s.length;m++)null!==(h=d(i,s[m],l))&&(a=o(h,a,m),null===c?u=h:c.sibling=h,c=h);return u}for(h=r(i,h);m<s.length;m++)null!==(g=p(h,i,m,s[m],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),a=o(g,a,m),null===c?u=g:c.sibling=g,c=g);return e&&h.forEach(function(e){return t(i,e)}),u}function g(i,s,l,u){var c=z(l);if("function"!==typeof c)throw Error(a(150));if(null==(l=c.call(l)))throw Error(a(151));for(var h=c=null,m=s,g=s=0,_=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var y=f(i,m,v.value,u);if(null===y){null===m&&(m=_);break}e&&m&&null===y.alternate&&t(i,m),s=o(y,s,g),null===h?c=y:h.sibling=y,h=y,m=_}if(v.done)return n(i,m),c;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=d(i,v.value,u))&&(s=o(v,s,g),null===h?c=v:h.sibling=v,h=v);return c}for(m=r(i,m);!v.done;g++,v=l.next())null!==(v=p(m,i,g,v.value,u))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),s=o(v,s,g),null===h?c=v:h.sibling=v,h=v);return e&&m.forEach(function(e){return t(i,e)}),c}return function(e,r,o,l){var u="object"===typeof o&&null!==o&&o.type===S&&null===o.key;u&&(o=o.props.children);var c="object"===typeof o&&null!==o;if(c)switch(o.$$typeof){case x:e:{for(c=o.key,u=r;null!==u;){if(u.key===c){switch(u.tag){case 7:if(o.type===S){n(e,u.sibling),(r=i(u,o.props.children)).return=e,e=r;break e}break;default:if(u.elementType===o.type){n(e,u.sibling),(r=i(u,o.props)).ref=vo(e,u,o),r.return=e,e=r;break e}}n(e,u);break}t(e,u),u=u.sibling}o.type===S?((r=Bl(o.props.children,e.mode,l,o.key)).return=e,e=r):((l=Nl(o.type,o.key,o.props,null,e.mode,l)).ref=vo(e,r,o),l.return=e,e=l)}return s(e);case T:e:{for(u=o.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),(r=i(r,o.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Vl(o,e.mode,l)).return=e,e=r}return s(e)}if("string"===typeof o||"number"===typeof o)return o=""+o,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,o)).return=e,e=r):(n(e,r),(r=kl(o,e.mode,l)).return=e,e=r),s(e);if(_o(o))return m(e,r,o,l);if(z(o))return g(e,r,o,l);if(c&&yo(e,o),"undefined"===typeof o&&!u)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(a(152,Y(e.type)||"Component"))}return n(e,r)}}var Eo=bo(!0),xo=bo(!1),To={},So=ri(To),Ao=ri(To),Po=ri(To);function Mo(e){if(e===To)throw Error(a(174));return e}function Ro(e,t){switch(oi(Po,t),oi(Ao,e),oi(So,To),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fe(null,"");break;default:t=fe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ii(So),oi(So,t)}function Co(){ii(So),ii(Ao),ii(Po)}function wo(e){Mo(Po.current);var t=Mo(So.current),n=fe(t,e.type);t!==n&&(oi(Ao,e),oi(So,n))}function Oo(e){Ao.current===e&&(ii(So),ii(Ao))}var Io=ri(0);function Do(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Lo=null,Fo=null,No=!1;function Bo(e,t){var n=Dl(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Uo(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function ko(e){if(No){var t=Fo;if(t){var n=t;if(!Uo(e,t)){if(!(t=zr(n.nextSibling))||!Uo(e,t))return e.flags=-1025&e.flags|2,No=!1,void(Lo=e);Bo(Lo,n)}Lo=e,Fo=zr(t.firstChild)}else e.flags=-1025&e.flags|2,No=!1,Lo=e}}function Vo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Lo=e}function Go(e){if(e!==Lo)return!1;if(!No)return Vo(e),No=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Ur(t,e.memoizedProps))for(t=Fo;t;)Bo(e,t),t=zr(t.nextSibling);if(Vo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){Fo=zr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}Fo=null}}else Fo=Lo?zr(e.stateNode.nextSibling):null;return!0}function zo(){Fo=Lo=null,No=!1}var jo=[];function Ho(){for(var e=0;e<jo.length;e++)jo[e]._workInProgressVersionPrimary=null;jo.length=0}var Wo=E.ReactCurrentDispatcher,Xo=E.ReactCurrentBatchConfig,Yo=0,Ko=null,qo=null,Qo=null,Zo=!1,Jo=!1;function $o(){throw Error(a(321))}function ea(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function ta(e,t,n,r,i,o){if(Yo=o,Ko=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Wo.current=null===e||null===e.memoizedState?Pa:Ma,e=n(r,i),Jo){o=0;do{if(Jo=!1,!(25>o))throw Error(a(301));o+=1,Qo=qo=null,t.updateQueue=null,Wo.current=Ra,e=n(r,i)}while(Jo)}if(Wo.current=Aa,t=null!==qo&&null!==qo.next,Yo=0,Qo=qo=Ko=null,Zo=!1,t)throw Error(a(300));return e}function na(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Qo?Ko.memoizedState=Qo=e:Qo=Qo.next=e,Qo}function ra(){if(null===qo){var e=Ko.alternate;e=null!==e?e.memoizedState:null}else e=qo.next;var t=null===Qo?Ko.memoizedState:Qo.next;if(null!==t)Qo=t,qo=e;else{if(null===e)throw Error(a(310));e={memoizedState:(qo=e).memoizedState,baseState:qo.baseState,baseQueue:qo.baseQueue,queue:qo.queue,next:null},null===Qo?Ko.memoizedState=Qo=e:Qo=Qo.next=e}return Qo}function ia(e,t){return"function"===typeof t?t(e):t}function oa(e){var t=ra(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=qo,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var l=s=o=null,u=i;do{var c=u.lane;if((Yo&c)===c)null!==l&&(l=l.next={lane:0,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),r=u.eagerReducer===e?u.eagerState:e(r,u.action);else{var h={lane:c,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};null===l?(s=l=h,o=r):l=l.next=h,Ko.lanes|=c,Ds|=c}u=u.next}while(null!==u&&u!==i);null===l?o=r:l.next=s,or(r,t.memoizedState)||(wa=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function aa(e){var t=ra(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);or(o,t.memoizedState)||(wa=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function sa(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Yo&e)===e)&&(t._workInProgressVersionPrimary=r,jo.push(t))),e)return n(t._source);throw jo.push(t),Error(a(350))}function la(e,t,n,r){var i=As;if(null===i)throw Error(a(349));var o=t._getVersion,s=o(t._source),l=Wo.current,u=l.useState(function(){return sa(i,t,n)}),c=u[1],h=u[0];u=Qo;var d=e.memoizedState,f=d.refs,p=f.getSnapshot,m=d.source;d=d.subscribe;var g=Ko;return e.memoizedState={refs:f,source:t,subscribe:r},l.useEffect(function(){f.getSnapshot=n,f.setSnapshot=c;var e=o(t._source);if(!or(s,e)){e=n(t._source),or(h,e)||(c(e),e=ol(g),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,a=e;0<a;){var l=31-zt(a),u=1<<l;r[l]|=e,a&=~u}}},[n,t,r]),l.useEffect(function(){return r(t._source,function(){var e=f.getSnapshot,n=f.setSnapshot;try{n(e(t._source));var r=ol(g);i.mutableReadLanes|=r&i.pendingLanes}catch(o){n(function(){throw o})}})},[t,r]),or(p,n)&&or(m,t)&&or(d,r)||((e={pending:null,dispatch:null,lastRenderedReducer:ia,lastRenderedState:h}).dispatch=c=Sa.bind(null,Ko,e),u.queue=e,u.baseQueue=null,h=sa(i,t,n),u.memoizedState=u.baseState=h),h}function ua(e,t,n){return la(ra(),e,t,n)}function ca(e){var t=na();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:ia,lastRenderedState:e}).dispatch=Sa.bind(null,Ko,e),[t.memoizedState,e]}function ha(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Ko.updateQueue)?(t={lastEffect:null},Ko.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function da(e){return e={current:e},na().memoizedState=e}function fa(){return ra().memoizedState}function pa(e,t,n,r){var i=na();Ko.flags|=e,i.memoizedState=ha(1|t,n,void 0,void 0===r?null:r)}function ma(e,t,n,r){var i=ra();r=void 0===r?null:r;var o=void 0;if(null!==qo){var a=qo.memoizedState;if(o=a.destroy,null!==r&&ea(r,a.deps))return void ha(t,n,o,r)}Ko.flags|=e,i.memoizedState=ha(1|t,n,o,r)}function ga(e,t){return pa(516,4,e,t)}function _a(e,t){return ma(516,4,e,t)}function va(e,t){return ma(4,2,e,t)}function ya(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ba(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ma(4,2,ya.bind(null,t,e),n)}function Ea(){}function xa(e,t){var n=ra();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ea(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ta(e,t){var n=ra();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ea(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Sa(e,t,n){var r=il(),i=ol(e),o={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?o.next=o:(o.next=a.next,a.next=o),t.pending=o,a=e.alternate,e===Ko||null!==a&&a===Ko)Jo=Zo=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,l=a(s,n);if(o.eagerReducer=a,o.eagerState=l,or(l,s))return}catch(u){}al(e,i,r)}}var Aa={readContext:eo,useCallback:$o,useContext:$o,useEffect:$o,useImperativeHandle:$o,useLayoutEffect:$o,useMemo:$o,useReducer:$o,useRef:$o,useState:$o,useDebugValue:$o,useDeferredValue:$o,useTransition:$o,useMutableSource:$o,useOpaqueIdentifier:$o,unstable_isNewReconciler:!1},Pa={readContext:eo,useCallback:function(e,t){return na().memoizedState=[e,void 0===t?null:t],e},useContext:eo,useEffect:ga,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,pa(4,2,ya.bind(null,t,e),n)},useLayoutEffect:function(e,t){return pa(4,2,e,t)},useMemo:function(e,t){var n=na();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=na();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Sa.bind(null,Ko,e),[r.memoizedState,e]},useRef:da,useState:ca,useDebugValue:Ea,useDeferredValue:function(e){var t=ca(e),n=t[0],r=t[1];return ga(function(){var t=Xo.transition;Xo.transition=1;try{r(e)}finally{Xo.transition=t}},[e]),n},useTransition:function(){var e=ca(!1),t=e[0];return da(e=function(e,t){var n=Ui();Vi(98>n?98:n,function(){e(!0)}),Vi(97<n?97:n,function(){var n=Xo.transition;Xo.transition=1;try{e(!1),t()}finally{Xo.transition=n}})}.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=na();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},la(r,e,t,n)},useOpaqueIdentifier:function(){if(No){var e=!1,t=function(e){return{$$typeof:F,toString:e,valueOf:e}}(function(){throw e||(e=!0,n("r:"+(Hr++).toString(36))),Error(a(355))}),n=ca(t)[1];return 0===(2&Ko.mode)&&(Ko.flags|=516,ha(5,function(){n("r:"+(Hr++).toString(36))},void 0,null)),t}return ca(t="r:"+(Hr++).toString(36)),t},unstable_isNewReconciler:!1},Ma={readContext:eo,useCallback:xa,useContext:eo,useEffect:_a,useImperativeHandle:ba,useLayoutEffect:va,useMemo:Ta,useReducer:oa,useRef:fa,useState:function(){return oa(ia)},useDebugValue:Ea,useDeferredValue:function(e){var t=oa(ia),n=t[0],r=t[1];return _a(function(){var t=Xo.transition;Xo.transition=1;try{r(e)}finally{Xo.transition=t}},[e]),n},useTransition:function(){var e=oa(ia)[0];return[fa().current,e]},useMutableSource:ua,useOpaqueIdentifier:function(){return oa(ia)[0]},unstable_isNewReconciler:!1},Ra={readContext:eo,useCallback:xa,useContext:eo,useEffect:_a,useImperativeHandle:ba,useLayoutEffect:va,useMemo:Ta,useReducer:aa,useRef:fa,useState:function(){return aa(ia)},useDebugValue:Ea,useDeferredValue:function(e){var t=aa(ia),n=t[0],r=t[1];return _a(function(){var t=Xo.transition;Xo.transition=1;try{r(e)}finally{Xo.transition=t}},[e]),n},useTransition:function(){var e=aa(ia)[0];return[fa().current,e]},useMutableSource:ua,useOpaqueIdentifier:function(){return aa(ia)[0]},unstable_isNewReconciler:!1},Ca=E.ReactCurrentOwner,wa=!1;function Oa(e,t,n,r){t.child=null===e?xo(t,null,n,r):Eo(t,e.child,n,r)}function Ia(e,t,n,r,i){n=n.render;var o=t.ref;return $i(t,i),r=ta(e,t,n,r,o,i),null===e||wa?(t.flags|=1,Oa(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,$a(e,t,i))}function Da(e,t,n,r,i,o){if(null===e){var a=n.type;return"function"!==typeof a||Ll(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Nl(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,La(e,t,a,r,i,o))}return a=e.child,0===(i&o)&&(i=a.memoizedProps,(n=null!==(n=n.compare)?n:sr)(i,r)&&e.ref===t.ref)?$a(e,t,o):(t.flags|=1,(e=Fl(a,r)).ref=t.ref,e.return=t,t.child=e)}function La(e,t,n,r,i,o){if(null!==e&&sr(e.memoizedProps,r)&&e.ref===t.ref){if(wa=!1,0===(o&i))return t.lanes=e.lanes,$a(e,t,o);0!==(16384&e.flags)&&(wa=!0)}return Ba(e,t,n,r,o)}function Fa(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},fl(t,n);else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},fl(t,e),null;t.memoizedState={baseLanes:0},fl(t,null!==o?o.baseLanes:n)}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,fl(t,r);return Oa(e,t,i,n),t.child}function Na(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Ba(e,t,n,r,i){var o=hi(n)?ui:si.current;return o=ci(t,o),$i(t,i),n=ta(e,t,n,r,o,i),null===e||wa?(t.flags|=1,Oa(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,$a(e,t,i))}function Ua(e,t,n,r,i){if(hi(n)){var o=!0;mi(t)}else o=!1;if($i(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),po(t,n,r),go(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,u=n.contextType;"object"===typeof u&&null!==u?u=eo(u):u=ci(t,u=hi(n)?ui:si.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==r||l!==u)&&mo(t,a,r,u),to=!1;var d=t.memoizedState;a.state=d,so(t,r,a,i),l=t.memoizedState,s!==r||d!==l||li.current||to?("function"===typeof c&&(co(t,n,c,r),l=t.memoizedState),(s=to||fo(t,n,s,r,d,l,u))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4)):("function"===typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=u,r=s):("function"===typeof a.componentDidMount&&(t.flags|=4),r=!1)}else{a=t.stateNode,ro(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:Wi(t.type,s),a.props=u,h=t.pendingProps,d=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=eo(l):l=ci(t,l=hi(n)?ui:si.current);var f=n.getDerivedStateFromProps;(c="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==h||d!==l)&&mo(t,a,r,l),to=!1,d=t.memoizedState,a.state=d,so(t,r,a,i);var p=t.memoizedState;s!==h||d!==p||li.current||to?("function"===typeof f&&(co(t,n,f,r),p=t.memoizedState),(u=to||fo(t,n,u,r,d,p,l))?(c||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=l,r=u):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=256),r=!1)}return ka(e,t,n,r,o,i)}function ka(e,t,n,r,i,o){Na(e,t);var a=0!==(64&t.flags);if(!r&&!a)return i&&gi(t,n,!1),$a(e,t,o);r=t.stateNode,Ca.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=Eo(t,e.child,null,o),t.child=Eo(t,null,s,o)):Oa(e,t,s,o),t.memoizedState=r.state,i&&gi(t,n,!0),t.child}function Va(e){var t=e.stateNode;t.pendingContext?fi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&fi(0,t.context,!1),Ro(e,t.containerInfo)}var Ga,za,ja,Ha,Wa={dehydrated:null,retryLane:0};function Xa(e,t,n){var r,i=t.pendingProps,o=Io.current,a=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(o|=1),oi(Io,1&o),null===e?(void 0!==i.fallback&&ko(t),e=i.children,o=i.fallback,a?(e=Ya(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Wa,e):"number"===typeof i.unstable_expectedLoadTime?(e=Ya(t,e,o,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Wa,t.lanes=33554432,e):((n=Ul({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,a?(i=qa(e,t,i.children,i.fallback,n),a=t.child,o=e.child.memoizedState,a.memoizedState=null===o?{baseLanes:n}:{baseLanes:o.baseLanes|n},a.childLanes=e.childLanes&~n,t.memoizedState=Wa,i):(n=Ka(e,t,i.children,n),t.memoizedState=null,n))}function Ya(e,t,n,r){var i=e.mode,o=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==o?(o.childLanes=0,o.pendingProps=t):o=Ul(t,i,0,null),n=Bl(n,i,r,null),o.return=e,n.return=e,o.sibling=n,e.child=o,n}function Ka(e,t,n,r){var i=e.child;return e=i.sibling,n=Fl(i,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function qa(e,t,n,r,i){var o=t.mode,a=e.child;e=a.sibling;var s={mode:"hidden",children:n};return 0===(2&o)&&t.child!==a?((n=t.child).childLanes=0,n.pendingProps=s,null!==(a=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Fl(a,s),null!==e?r=Fl(e,r):(r=Bl(r,o,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function Qa(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Ji(e.return,t)}function Za(e,t,n,r,i,o){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i,a.lastEffect=o)}function Ja(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Oa(e,t,r.children,n),0!==(2&(r=Io.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Qa(e,n);else if(19===e.tag)Qa(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(oi(Io,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Do(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Za(t,!1,i,n,o,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Do(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Za(t,!0,n,null,o,t.lastEffect);break;case"together":Za(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function $a(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ds|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Fl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Fl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function es(e,t){if(!No)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function ts(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return hi(t.type)&&di(),null;case 3:return Co(),ii(li),ii(si),Ho(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Go(t)?t.flags|=4:r.hydrate||(t.flags|=256)),za(t),null;case 5:Oo(t);var o=Mo(Po.current);if(n=t.type,null!==e&&null!=t.stateNode)ja(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(a(166));return null}if(e=Mo(So.current),Go(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[Xr]=t,r[Yr]=s,n){case"dialog":Sr("cancel",r),Sr("close",r);break;case"iframe":case"object":case"embed":Sr("load",r);break;case"video":case"audio":for(e=0;e<br.length;e++)Sr(br[e],r);break;case"source":Sr("error",r);break;case"img":case"image":case"link":Sr("error",r),Sr("load",r);break;case"details":Sr("toggle",r);break;case"input":ee(r,s),Sr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Sr("invalid",r);break;case"textarea":le(r,s),Sr("invalid",r)}for(var u in Te(n,s),e=null,s)s.hasOwnProperty(u)&&(o=s[u],"children"===u?"string"===typeof o?r.textContent!==o&&(e=["children",o]):"number"===typeof o&&r.textContent!==""+o&&(e=["children",""+o]):l.hasOwnProperty(u)&&null!=o&&"onScroll"===u&&Sr("scroll",r));switch(n){case"input":Q(r),re(r,s,!0);break;case"textarea":Q(r),ce(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Lr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(u=9===o.nodeType?o:o.ownerDocument,e===he.html&&(e=de(n)),e===he.html?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[Xr]=t,e[Yr]=r,Ga(e,t,!1,!1),t.stateNode=e,u=Se(n,r),n){case"dialog":Sr("cancel",e),Sr("close",e),o=r;break;case"iframe":case"object":case"embed":Sr("load",e),o=r;break;case"video":case"audio":for(o=0;o<br.length;o++)Sr(br[o],e);o=r;break;case"source":Sr("error",e),o=r;break;case"img":case"image":case"link":Sr("error",e),Sr("load",e),o=r;break;case"details":Sr("toggle",e),o=r;break;case"input":ee(e,r),o=$(e,r),Sr("invalid",e);break;case"option":o=oe(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=i({},r,{value:void 0}),Sr("invalid",e);break;case"textarea":le(e,r),o=se(e,r),Sr("invalid",e);break;default:o=r}Te(n,o);var c=o;for(s in c)if(c.hasOwnProperty(s)){var h=c[s];"style"===s?Ee(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&ge(e,h):"children"===s?"string"===typeof h?("textarea"!==n||""!==h)&&_e(e,h):"number"===typeof h&&_e(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(l.hasOwnProperty(s)?null!=h&&"onScroll"===s&&Sr("scroll",e):null!=h&&b(e,s,h,u))}switch(n){case"input":Q(e),re(e,r,!1);break;case"textarea":Q(e),ce(e);break;case"option":null!=r.value&&e.setAttribute("value",""+K(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ae(e,!!r.multiple,s,!1):null!=r.defaultValue&&ae(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Lr)}Br(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Ha(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));n=Mo(Po.current),Mo(So.current),Go(t)?(r=t.stateNode,n=t.memoizedProps,r[Xr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Xr]=t,t.stateNode=r)}return null;case 13:return ii(Io),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Go(t):n=null!==e.memoizedState,r&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Io.current)?0===ws&&(ws=3):(0!==ws&&3!==ws||(ws=4),null===As||0===(134217727&Ds)&&0===(134217727&Ls)||ul(As,Ms))),(r||n)&&(t.flags|=4),null);case 4:return Co(),za(t),null===e&&Pr(t.stateNode.containerInfo),null;case 10:return Zi(t),null;case 17:return hi(t.type)&&di(),null;case 19:if(ii(Io),null===(r=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(u=r.rendering))if(s)es(r,!1);else{if(0!==ws||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(u=Do(e))){for(t.flags|=64,es(r,!1),null!==(s=u.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(u=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,e=u.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return oi(Io,1&Io.current|2),t.child}e=e.sibling}null!==r.tail&&Bi()>Us&&(t.flags|=64,s=!0,es(r,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Do(u))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),es(r,!0),null===r.tail&&"hidden"===r.tailMode&&!u.alternate&&!No)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Bi()-r.renderingStartTime>Us&&1073741824!==n&&(t.flags|=64,s=!0,es(r,!1),t.lanes=33554432);r.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=r.last)?n.sibling=u:t.child=u,r.last=u)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Bi(),n.sibling=null,t=Io.current,oi(Io,s?1&t|2:1&t),n):null;case 23:case 24:return pl(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(a(156,t.tag))}function ns(e){switch(e.tag){case 1:hi(e.type)&&di();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Co(),ii(li),ii(si),Ho(),0!==(64&(t=e.flags)))throw Error(a(285));return e.flags=-4097&t|64,e;case 5:return Oo(e),null;case 13:return ii(Io),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return ii(Io),null;case 4:return Co(),null;case 10:return Zi(e),null;case 23:case 24:return pl(),null;default:return null}}function rs(e,t){try{var n="",r=t;do{n+=X(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i}}function is(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}Ga=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},za=function(){},ja=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Mo(So.current);var a,s=null;switch(n){case"input":o=$(e,o),r=$(e,r),s=[];break;case"option":o=oe(e,o),r=oe(e,r),s=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),s=[];break;case"textarea":o=se(e,o),r=se(e,r),s=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(e.onclick=Lr)}for(h in Te(n,r),n=null,o)if(!r.hasOwnProperty(h)&&o.hasOwnProperty(h)&&null!=o[h])if("style"===h){var u=o[h];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(l.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in r){var c=r[h];if(u=null!=o?o[h]:void 0,r.hasOwnProperty(h)&&c!==u&&(null!=c||null!=u))if("style"===h)if(u){for(a in u)!u.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&u[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(h,n)),n=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(s=s||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(l.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Sr("scroll",e),s||u===c||(s=[])):"object"===typeof c&&null!==c&&c.$$typeof===F?c.toString():(s=s||[]).push(h,c))}n&&(s=s||[]).push("style",n);var h=s;(t.updateQueue=h)&&(t.flags|=4)}},Ha=function(e,t,n,r){n!==r&&(t.flags|=4)};var os="function"===typeof WeakMap?WeakMap:Map;function as(e,t,n){(n=io(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){zs||(zs=!0,js=r),is(0,t)},n}function ss(e,t,n){(n=io(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return is(0,t),r(i)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Hs?Hs=new Set([this]):Hs.add(this),is(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var ls="function"===typeof WeakSet?WeakSet:Set;function us(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){wl(e,n)}else t.current=null}function cs(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Wi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Gr(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(a(163))}function hs(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(Ml(n,e),Pl(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:Wi(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&lo(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}lo(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Br(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&bt(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(a(163))}function ds(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"===typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty("display")?i.display:null,r.style.display=be("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function fs(e,t){if(vi&&"function"===typeof vi.onCommitFiberUnmount)try{vi.onCommitFiberUnmount(_i,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!==(4&r))Ml(t,n);else{r=t;try{i()}catch(o){wl(r,o)}}n=n.next}while(n!==e)}break;case 1:if(us(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){wl(t,o)}break;case 5:us(t);break;case 4:_s(e,t)}}function ps(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ms(e){return 5===e.tag||3===e.tag||4===e.tag}function gs(e){e:{for(var t=e.return;null!==t;){if(ms(t))break e;t=t.return}throw Error(a(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(a(161))}16&n.flags&&(_e(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ms(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?function e(t,n,r){var i=t.tag,o=5===i||6===i;if(o)t=o?t.stateNode:t.stateNode.instance,n?8===r.nodeType?r.parentNode.insertBefore(t,n):r.insertBefore(t,n):(8===r.nodeType?(n=r.parentNode,n.insertBefore(t,r)):(n=r,n.appendChild(t)),r=r._reactRootContainer,null!==r&&void 0!==r||null!==n.onclick||(n.onclick=Lr));else if(4!==i&&(t=t.child,null!==t))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t):function e(t,n,r){var i=t.tag,o=5===i||6===i;if(o)t=o?t.stateNode:t.stateNode.instance,n?r.insertBefore(t,n):r.appendChild(t);else if(4!==i&&(t=t.child,null!==t))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t)}function _s(e,t){for(var n,r,i=t,o=!1;;){if(!o){o=i.return;e:for(;;){if(null===o)throw Error(a(160));switch(n=o.stateNode,o.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}o=o.return}o=!0}if(5===i.tag||6===i.tag){e:for(var s=e,l=i,u=l;;)if(fs(s,u),null!==u.child&&4!==u.tag)u.child.return=u,u=u.child;else{if(u===l)break e;for(;null===u.sibling;){if(null===u.return||u.return===l)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}r?(s=n,l=i.stateNode,8===s.nodeType?s.parentNode.removeChild(l):s.removeChild(l)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(fs(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(o=!1)}i.sibling.return=i.return,i=i.sibling}}function vs(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3===(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(n[Yr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),Se(e,i),t=Se(e,r),i=0;i<o.length;i+=2){var s=o[i],l=o[i+1];"style"===s?Ee(n,l):"dangerouslySetInnerHTML"===s?ge(n,l):"children"===s?_e(n,l):b(n,s,l,t)}switch(e){case"input":ne(n,r);break;case"textarea":ue(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(o=r.value)?ae(n,!!r.multiple,o,!1):e!==!!r.multiple&&(null!=r.defaultValue?ae(n,!!r.multiple,r.defaultValue,!0):ae(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(a(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,bt(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Bs=Bi(),ds(t.child,!0)),void ys(t);case 19:return void ys(t);case 17:return;case 23:case 24:return void ds(t,null!==t.memoizedState)}throw Error(a(163))}function ys(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ls),t.forEach(function(t){var r=function(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Ui()?1:2:(0===el&&(el=Is),0===(t=kt(62914560&~el))&&(t=4194304))),n=il(),null!==(e=sl(e,t))&&(Gt(e,t,n),ll(e,n))}.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function bs(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Es=Math.ceil,xs=E.ReactCurrentDispatcher,Ts=E.ReactCurrentOwner,Ss=0,As=null,Ps=null,Ms=0,Rs=0,Cs=ri(0),ws=0,Os=null,Is=0,Ds=0,Ls=0,Fs=0,Ns=null,Bs=0,Us=1/0;function ks(){Us=Bi()+500}var Vs,Gs=null,zs=!1,js=null,Hs=null,Ws=!1,Xs=null,Ys=90,Ks=[],qs=[],Qs=null,Zs=0,Js=null,$s=-1,el=0,tl=0,nl=null,rl=!1;function il(){return 0!==(48&Ss)?Bi():-1!==$s?$s:$s=Bi()}function ol(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Ui()?1:2;if(0===el&&(el=Is),0!==Hi.transition){0!==tl&&(tl=null!==Ns?Ns.pendingLanes:0),e=el;var t=4186112&~tl;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Ui(),0!==(4&Ss)&&98===e?e=Ut(12,el):e=Ut(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),el),e}function al(e,t,n){if(50<Zs)throw Zs=0,Js=null,Error(a(185));if(null===(e=sl(e,t)))return null;Gt(e,t,n),e===As&&(Ls|=t,4===ws&&ul(e,Ms));var r=Ui();1===t?0!==(8&Ss)&&0===(48&Ss)?cl(e):(ll(e,n),0===Ss&&(ks(),zi())):(0===(4&Ss)||98!==r&&99!==r||(null===Qs?Qs=new Set([e]):Qs.add(e)),ll(e,n)),Ns=e}function sl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function ll(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,o=e.expirationTimes,s=e.pendingLanes;0<s;){var l=31-zt(s),u=1<<l,c=o[l];if(-1===c){if(0===(u&r)||0!==(u&i)){c=t,Ft(u);var h=Lt;o[l]=10<=h?c+250:6<=h?c+5e3:-1}}else c<=t&&(e.expiredLanes|=u);s&=~u}if(r=Nt(e,e===As?Ms:0),t=Lt,0===r)null!==n&&(n!==Oi&&Ei(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Oi&&Ei(n)}15===t?(n=cl.bind(null,e),null===Di?(Di=[n],Li=bi(Pi,ji)):Di.push(n),n=Oi):14===t?n=Gi(99,cl.bind(null,e)):n=Gi(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(a(358,e))}}(t),function e(t){$s=-1;tl=el=0;if(0!==(48&Ss))throw Error(a(327));var n=t.callbackNode;if(Al()&&t.callbackNode!==n)return null;var r=Nt(t,t===As?Ms:0);if(0===r)return null;var i=r;var o=Ss;Ss|=16;var s=_l();As===t&&Ms===i||(ks(),ml(t,i));for(;;)try{bl();break}catch(l){gl(t,l)}Qi();xs.current=s;Ss=o;null!==Ps?i=0:(As=null,Ms=0,i=ws);if(0!==(Is&Ls))ml(t,0);else if(0!==i){if(2===i&&(Ss|=64,t.hydrate&&(t.hydrate=!1,Gr(t.containerInfo)),0!==(r=Bt(t))&&(i=vl(t,r))),1===i)throw n=Os,ml(t,0),ul(t,r),ll(t,Bi()),n;switch(t.finishedWork=t.current.alternate,t.finishedLanes=r,i){case 0:case 1:throw Error(a(345));case 2:Tl(t);break;case 3:if(ul(t,r),(62914560&r)===r&&10<(i=Bs+500-Bi())){if(0!==Nt(t,0))break;if(((o=t.suspendedLanes)&r)!==r){il(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=kr(Tl.bind(null,t),i);break}Tl(t);break;case 4:if(ul(t,r),(4186112&r)===r)break;for(i=t.eventTimes,o=-1;0<r;){var u=31-zt(r);s=1<<u,(u=i[u])>o&&(o=u),r&=~s}if(r=o,10<(r=(120>(r=Bi()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Es(r/1960))-r)){t.timeoutHandle=kr(Tl.bind(null,t),r);break}Tl(t);break;case 5:Tl(t);break;default:throw Error(a(329))}}ll(t,Bi());return t.callbackNode===n?e.bind(null,t):null}.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function ul(e,t){for(t&=~Fs,t&=~Ls,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-zt(t),r=1<<n;e[n]=-1,t&=~r}}function cl(e){if(0!==(48&Ss))throw Error(a(327));if(Al(),e===As&&0!==(e.expiredLanes&Ms)){var t=Ms,n=vl(e,t);0!==(Is&Ls)&&(n=vl(e,t=Nt(e,t)))}else n=vl(e,t=Nt(e,0));if(0!==e.tag&&2===n&&(Ss|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(t=Bt(e))&&(n=vl(e,t))),1===n)throw n=Os,ml(e,0),ul(e,t),ll(e,Bi()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Tl(e),ll(e,Bi()),null}function hl(e,t){var n=Ss;Ss|=1;try{return e(t)}finally{0===(Ss=n)&&(ks(),zi())}}function dl(e,t){var n=Ss;Ss&=-2,Ss|=8;try{return e(t)}finally{0===(Ss=n)&&(ks(),zi())}}function fl(e,t){oi(Cs,Rs),Rs|=t,Is|=t}function pl(){Rs=Cs.current,ii(Cs)}function ml(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Vr(n)),null!==Ps)for(n=Ps.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&di();break;case 3:Co(),ii(li),ii(si),Ho();break;case 5:Oo(r);break;case 4:Co();break;case 13:case 19:ii(Io);break;case 10:Zi(r);break;case 23:case 24:pl()}n=n.return}As=e,Ps=Fl(e.current,null),Ms=Rs=Is=t,ws=0,Os=null,Fs=Ls=Ds=0}function gl(e,t){for(;;){var n=Ps;try{if(Qi(),Wo.current=Aa,Zo){for(var r=Ko.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Zo=!1}if(Yo=0,Qo=qo=Ko=null,Jo=!1,Ts.current=null,null===n||null===n.return){ws=1,Os=t,Ps=null;break}e:{var o=e,a=n.return,s=n,l=t;if(t=Ms,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l;if(0===(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var h=0!==(1&Io.current),d=a;do{var f;if(f=13===d.tag){var p=d.memoizedState;if(null!==p)f=null!==p.dehydrated;else{var m=d.memoizedProps;f=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!h)}}if(f){var g=d.updateQueue;if(null===g){var _=new Set;_.add(u),d.updateQueue=_}else g.add(u);if(0===(2&d.mode)){if(d.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var v=io(-1,1);v.tag=2,oo(s,v)}s.lanes|=1;break e}l=void 0,s=t;var y=o.pingCache;if(null===y?(y=o.pingCache=new os,l=new Set,y.set(u,l)):void 0===(l=y.get(u))&&(l=new Set,y.set(u,l)),!l.has(s)){l.add(s);var b=Ol.bind(null,o,u,s);u.then(b,b)}d.flags|=4096,d.lanes=t;break e}d=d.return}while(null!==d);l=Error((Y(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==ws&&(ws=2),l=rs(l,s),d=a;do{switch(d.tag){case 3:o=l,d.flags|=4096,t&=-t,d.lanes|=t,ao(d,as(0,o,t));break e;case 1:o=l;var E=d.type,x=d.stateNode;if(0===(64&d.flags)&&("function"===typeof E.getDerivedStateFromError||null!==x&&"function"===typeof x.componentDidCatch&&(null===Hs||!Hs.has(x)))){d.flags|=4096,t&=-t,d.lanes|=t,ao(d,ss(d,o,t));break e}}d=d.return}while(null!==d)}xl(n)}catch(T){t=T,Ps===n&&null!==n&&(Ps=n=n.return);continue}break}}function _l(){var e=xs.current;return xs.current=Aa,null===e?Aa:e}function vl(e,t){var n=Ss;Ss|=16;var r=_l();for(As===e&&Ms===t||ml(e,t);;)try{yl();break}catch(i){gl(e,i)}if(Qi(),Ss=n,xs.current=r,null!==Ps)throw Error(a(261));return As=null,Ms=0,ws}function yl(){for(;null!==Ps;)El(Ps)}function bl(){for(;null!==Ps&&!xi();)El(Ps)}function El(e){var t=Vs(e.alternate,e,Rs);e.memoizedProps=e.pendingProps,null===t?xl(e):Ps=t,Ts.current=null}function xl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=ts(n,t,Rs)))return void(Ps=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Rs)||0===(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=ns(t)))return n.flags&=2047,void(Ps=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ps=t);Ps=t=e}while(null!==t);0===ws&&(ws=5)}function Tl(e){var t=Ui();return Vi(99,function(e,t){do{Al()}while(null!==Xs);if(0!==(48&Ss))throw Error(a(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,o=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var s=e.eventTimes,l=e.expirationTimes;0<o;){var u=31-zt(o),c=1<<u;i[u]=0,s[u]=-1,l[u]=-1,o&=~c}if(null!==Qs&&0===(24&r)&&Qs.has(e)&&Qs.delete(e),e===As&&(Ps=As=null,Ms=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=Ss,Ss|=32,Ts.current=null,Fr=Yt,hr(s=cr())){if("selectionStart"in s)l={start:s.selectionStart,end:s.selectionEnd};else e:if(l=(l=s.ownerDocument)&&l.defaultView||window,(c=l.getSelection&&l.getSelection())&&0!==c.rangeCount){l=c.anchorNode,o=c.anchorOffset,u=c.focusNode,c=c.focusOffset;try{l.nodeType,u.nodeType}catch(P){l=null;break e}var h=0,d=-1,f=-1,p=0,m=0,g=s,_=null;t:for(;;){for(var v;g!==l||0!==o&&3!==g.nodeType||(d=h+o),g!==u||0!==c&&3!==g.nodeType||(f=h+c),3===g.nodeType&&(h+=g.nodeValue.length),null!==(v=g.firstChild);)_=g,g=v;for(;;){if(g===s)break t;if(_===l&&++p===o&&(d=h),_===u&&++m===c&&(f=h),null!==(v=g.nextSibling))break;_=(g=_).parentNode}g=v}l=-1===d||-1===f?null:{start:d,end:f}}else l=null;l=l||{start:0,end:0}}else l=null;Nr={focusedElem:s,selectionRange:l},Yt=!1,nl=null,rl=!1,Gs=r;do{try{Sl()}catch(P){if(null===Gs)throw Error(a(330));wl(Gs,P),Gs=Gs.nextEffect}}while(null!==Gs);nl=null,Gs=r;do{try{for(s=e;null!==Gs;){var y=Gs.flags;if(16&y&&_e(Gs.stateNode,""),128&y){var b=Gs.alternate;if(null!==b){var E=b.ref;null!==E&&("function"===typeof E?E(null):E.current=null)}}switch(1038&y){case 2:gs(Gs),Gs.flags&=-3;break;case 6:gs(Gs),Gs.flags&=-3,vs(Gs.alternate,Gs);break;case 1024:Gs.flags&=-1025;break;case 1028:Gs.flags&=-1025,vs(Gs.alternate,Gs);break;case 4:vs(Gs.alternate,Gs);break;case 8:_s(s,l=Gs);var x=l.alternate;ps(l),null!==x&&ps(x)}Gs=Gs.nextEffect}}catch(P){if(null===Gs)throw Error(a(330));wl(Gs,P),Gs=Gs.nextEffect}}while(null!==Gs);if(E=Nr,b=cr(),y=E.focusedElem,s=E.selectionRange,b!==y&&y&&y.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(y.ownerDocument.documentElement,y)){null!==s&&hr(y)&&(b=s.start,void 0===(E=s.end)&&(E=b),"selectionStart"in y?(y.selectionStart=b,y.selectionEnd=Math.min(E,y.value.length)):(E=(b=y.ownerDocument||document)&&b.defaultView||window).getSelection&&(E=E.getSelection(),l=y.textContent.length,x=Math.min(s.start,l),s=void 0===s.end?x:Math.min(s.end,l),!E.extend&&x>s&&(l=s,s=x,x=l),l=ur(y,x),o=ur(y,s),l&&o&&(1!==E.rangeCount||E.anchorNode!==l.node||E.anchorOffset!==l.offset||E.focusNode!==o.node||E.focusOffset!==o.offset)&&((b=b.createRange()).setStart(l.node,l.offset),E.removeAllRanges(),x>s?(E.addRange(b),E.extend(o.node,o.offset)):(b.setEnd(o.node,o.offset),E.addRange(b))))),b=[];for(E=y;E=E.parentNode;)1===E.nodeType&&b.push({element:E,left:E.scrollLeft,top:E.scrollTop});for("function"===typeof y.focus&&y.focus(),y=0;y<b.length;y++)(E=b[y]).element.scrollLeft=E.left,E.element.scrollTop=E.top}Yt=!!Fr,Nr=Fr=null,e.current=n,Gs=r;do{try{for(y=e;null!==Gs;){var T=Gs.flags;if(36&T&&hs(y,Gs.alternate,Gs),128&T){b=void 0;var S=Gs.ref;if(null!==S){var A=Gs.stateNode;switch(Gs.tag){case 5:b=A;break;default:b=A}"function"===typeof S?S(b):S.current=b}}Gs=Gs.nextEffect}}catch(P){if(null===Gs)throw Error(a(330));wl(Gs,P),Gs=Gs.nextEffect}}while(null!==Gs);Gs=null,Ii(),Ss=i}else e.current=n;if(Ws)Ws=!1,Xs=e,Ys=t;else for(Gs=r;null!==Gs;)t=Gs.nextEffect,Gs.nextEffect=null,8&Gs.flags&&((T=Gs).sibling=null,T.stateNode=null),Gs=t;if(0===(r=e.pendingLanes)&&(Hs=null),1===r?e===Js?Zs++:(Zs=0,Js=e):Zs=0,n=n.stateNode,vi&&"function"===typeof vi.onCommitFiberRoot)try{vi.onCommitFiberRoot(_i,n,void 0,64===(64&n.current.flags))}catch(P){}if(ll(e,Bi()),zs)throw zs=!1,e=js,js=null,e;return 0!==(8&Ss)?null:(zi(),null)}.bind(null,e,t)),null}function Sl(){for(;null!==Gs;){var e=Gs.alternate;rl||null===nl||(0!==(8&Gs.flags)?Je(Gs,nl)&&(rl=!0):13===Gs.tag&&bs(e,Gs)&&Je(Gs,nl)&&(rl=!0));var t=Gs.flags;0!==(256&t)&&cs(e,Gs),0===(512&t)||Ws||(Ws=!0,Gi(97,function(){return Al(),null})),Gs=Gs.nextEffect}}function Al(){if(90!==Ys){var e=97<Ys?97:Ys;return Ys=90,Vi(e,Rl)}return!1}function Pl(e,t){Ks.push(t,e),Ws||(Ws=!0,Gi(97,function(){return Al(),null}))}function Ml(e,t){qs.push(t,e),Ws||(Ws=!0,Gi(97,function(){return Al(),null}))}function Rl(){if(null===Xs)return!1;var e=Xs;if(Xs=null,0!==(48&Ss))throw Error(a(331));var t=Ss;Ss|=32;var n=qs;qs=[];for(var r=0;r<n.length;r+=2){var i=n[r],o=n[r+1],s=i.destroy;if(i.destroy=void 0,"function"===typeof s)try{s()}catch(u){if(null===o)throw Error(a(330));wl(o,u)}}for(n=Ks,Ks=[],r=0;r<n.length;r+=2){i=n[r],o=n[r+1];try{var l=i.create;i.destroy=l()}catch(u){if(null===o)throw Error(a(330));wl(o,u)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Ss=t,zi(),!0}function Cl(e,t,n){oo(e,t=as(0,t=rs(n,t),1)),t=il(),null!==(e=sl(e,1))&&(Gt(e,1,t),ll(e,t))}function wl(e,t){if(3===e.tag)Cl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Cl(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hs||!Hs.has(r))){var i=ss(n,e=rs(t,e),1);if(oo(n,i),i=il(),null!==(n=sl(n,1)))Gt(n,1,i),ll(n,i);else if("function"===typeof r.componentDidCatch&&(null===Hs||!Hs.has(r)))try{r.componentDidCatch(t,e)}catch(o){}break}}n=n.return}}function Ol(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=il(),e.pingedLanes|=e.suspendedLanes&n,As===e&&(Ms&n)===n&&(4===ws||3===ws&&(62914560&Ms)===Ms&&500>Bi()-Bs?ml(e,0):Fs|=n),ll(e,t)}function Il(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Dl(e,t,n,r){return new Il(e,t,n,r)}function Ll(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Fl(e,t){var n=e.alternate;return null===n?((n=Dl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Nl(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Ll(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Bl(n.children,i,o,t);case N:s=8,i|=16;break;case A:s=8,i|=1;break;case P:return(e=Dl(12,n,t,8|i)).elementType=P,e.type=P,e.lanes=o,e;case w:return(e=Dl(13,n,t,i)).type=w,e.elementType=w,e.lanes=o,e;case O:return(e=Dl(19,n,t,i)).elementType=O,e.lanes=o,e;case B:return Ul(n,i,o,t);case U:return(e=Dl(24,n,t,i)).elementType=U,e.lanes=o,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case M:s=10;break e;case R:s=9;break e;case C:s=11;break e;case I:s=14;break e;case D:s=16,r=null;break e;case L:s=22;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Dl(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Bl(e,t,n,r){return(e=Dl(7,e,r,t)).lanes=n,e}function Ul(e,t,n,r){return(e=Dl(23,e,r,t)).elementType=B,e.lanes=n,e}function kl(e,t,n){return(e=Dl(6,e,null,t)).lanes=n,e}function Vl(e,t,n){return(t=Dl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Gl(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Vt(0),this.expirationTimes=Vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vt(0),this.mutableSourceEagerHydrationData=null}function zl(e,t,n,r){var i=t.current,o=il(),s=ol(i);e:if(n){t:{if(Ke(n=n._reactInternals)!==n||1!==n.tag)throw Error(a(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(hi(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(a(171))}if(1===n.tag){var u=n.type;if(hi(u)){n=pi(n,u,l);break e}}n=l}else n=ai;return null===t.context?t.context=n:t.pendingContext=n,(t=io(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),oo(i,t),al(i,s,o),s}function jl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Hl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wl(e,t){Hl(e,t),(e=e.alternate)&&Hl(e,t)}function Xl(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Gl(e,t,null!=n&&!0===n.hydrate),t=Dl(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,no(t),e[Kr]=n.current,Pr(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function Yl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Kl(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=jl(a);s.call(e)}}zl(t,a,e,i)}else{if(o=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new Xl(e,0,t?{hydrate:!0}:void 0)}(n,r),a=o._internalRoot,"function"===typeof i){var l=i;i=function(){var e=jl(a);l.call(e)}}dl(function(){zl(t,a,e,i)})}return jl(a)}function ql(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yl(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Vs=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||li.current)wa=!0;else{if(0===(n&r)){switch(wa=!1,t.tag){case 3:Va(t),zo();break;case 5:wo(t);break;case 1:hi(t.type)&&mi(t);break;case 4:Ro(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;oi(Xi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?Xa(e,t,n):(oi(Io,1&Io.current),null!==(t=$a(e,t,n))?t.sibling:null);oi(Io,1&Io.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return Ja(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),oi(Io,Io.current),r)break;return null;case 23:case 24:return t.lanes=0,Fa(e,t,n)}return $a(e,t,n)}wa=0!==(16384&e.flags)}else wa=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=ci(t,si.current),$i(t,n),i=ta(null,t,r,e,i,n),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,hi(r)){var o=!0;mi(t)}else o=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,no(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&co(t,r,s,e),i.updater=ho,t.stateNode=i,i._reactInternals=t,go(t,r,e,n),t=ka(null,t,r,!0,o,n)}else t.tag=0,Oa(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(o=i._init)(i._payload),t.type=i,o=t.tag=function(e){if("function"===typeof e)return Ll(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===I)return 14}return 2}(i),e=Wi(i,e),o){case 0:t=Ba(null,t,i,e,n);break e;case 1:t=Ua(null,t,i,e,n);break e;case 11:t=Ia(null,t,i,e,n);break e;case 14:t=Da(null,t,i,Wi(i.type,e),r,n);break e}throw Error(a(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ba(e,t,r,i=t.elementType===r?i:Wi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ua(e,t,r,i=t.elementType===r?i:Wi(r,i),n);case 3:if(Va(t),r=t.updateQueue,null===e||null===r)throw Error(a(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,ro(e,t),so(t,r,null,n),(r=t.memoizedState.element)===i)zo(),t=$a(e,t,n);else{if((o=(i=t.stateNode).hydrate)&&(Fo=zr(t.stateNode.containerInfo.firstChild),Lo=t,o=No=!0),o){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(o=e[i])._workInProgressVersionPrimary=e[i+1],jo.push(o);for(n=xo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Oa(e,t,r,n),zo();t=t.child}return t;case 5:return wo(t),null===e&&ko(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,Ur(r,i)?s=null:null!==o&&Ur(r,o)&&(t.flags|=16),Na(e,t),Oa(e,t,s,n),t.child;case 6:return null===e&&ko(t),null;case 13:return Xa(e,t,n);case 4:return Ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Eo(t,null,r,n):Oa(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Ia(e,t,r,i=t.elementType===r?i:Wi(r,i),n);case 7:return Oa(e,t,t.pendingProps,n),t.child;case 8:case 12:return Oa(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value;var l=t.type._context;if(oi(Xi,l._currentValue),l._currentValue=o,null!==s)if(l=s.value,0===(o=or(l,o)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(l,o):1073741823))){if(s.children===i.children&&!li.current){t=$a(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var u=l.dependencies;if(null!==u){s=l.child;for(var c=u.firstContext;null!==c;){if(c.context===r&&0!==(c.observedBits&o)){1===l.tag&&((c=io(-1,n&-n)).tag=2,oo(l,c)),l.lanes|=n,null!==(c=l.alternate)&&(c.lanes|=n),Ji(l.return,n),u.lanes|=n;break}c=c.next}}else s=10===l.tag&&l.type===t.type?null:l.child;if(null!==s)s.return=l;else for(s=l;null!==s;){if(s===t){s=null;break}if(null!==(l=s.sibling)){l.return=s.return,s=l;break}s=s.return}l=s}Oa(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(o=t.pendingProps).children,$i(t,n),r=r(i=eo(i,o.unstable_observedBits)),t.flags|=1,Oa(e,t,r,n),t.child;case 14:return o=Wi(i=t.type,t.pendingProps),Da(e,t,i,o=Wi(i.type,o),r,n);case 15:return La(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Wi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,hi(r)?(e=!0,mi(t)):e=!1,$i(t,n),po(t,r,i),go(t,r,i,n),ka(null,t,r,!0,e,n);case 19:return Ja(e,t,n);case 23:case 24:return Fa(e,t,n)}throw Error(a(156,t.tag))},Xl.prototype.render=function(e){zl(e,this._internalRoot,null,null)},Xl.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;zl(null,e,null,function(){t[Kr]=null})},$e=function(e){13===e.tag&&(al(e,4,il()),Wl(e,4))},et=function(e){13===e.tag&&(al(e,67108864,il()),Wl(e,67108864))},tt=function(e){if(13===e.tag){var t=il(),n=ol(e);al(e,n,t),Wl(e,n)}},nt=function(e,t){return t()},Pe=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=$r(r);if(!i)throw Error(a(90));Z(r),ne(r,i)}}}break;case"textarea":ue(e,n);break;case"select":null!=(t=n.value)&&ae(e,!!n.multiple,t,!1)}},Ie=hl,De=function(e,t,n,r,i){var o=Ss;Ss|=4;try{return Vi(98,e.bind(null,t,n,r,i))}finally{0===(Ss=o)&&(ks(),zi())}},Le=function(){0===(49&Ss)&&(function(){if(null!==Qs){var e=Qs;Qs=null,e.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,ll(e,Bi())})}zi()}(),Al())},Fe=function(e,t){var n=Ss;Ss|=2;try{return e(t)}finally{0===(Ss=n)&&(ks(),zi())}};var Ql={Events:[Zr,Jr,$r,we,Oe,Al,{current:!1}]},Zl={findFiberByHostInstance:Qr,bundleType:0,version:"17.0.1",rendererPackageName:"react-dom"},Jl={bundleType:Zl.bundleType,version:Zl.version,rendererPackageName:Zl.rendererPackageName,rendererConfig:Zl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ze(e))?null:e.stateNode},findFiberByHostInstance:Zl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var $l=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$l.isDisabled&&$l.supportsFiber)try{_i=$l.inject(Jl),vi=$l}catch(me){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ql,t.createPortal=ql,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw Error(a(268,Object.keys(e)))}return e=null===(e=Ze(t))?null:e.stateNode},t.flushSync=function(e,t){var n=Ss;if(0!==(48&n))return e(t);Ss|=1;try{if(e)return Vi(99,e.bind(null,t))}finally{Ss=n,zi()}},t.hydrate=function(e,t,n){if(!Yl(t))throw Error(a(200));return Kl(null,e,t,!0,n)},t.render=function(e,t,n){if(!Yl(t))throw Error(a(200));return Kl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yl(e))throw Error(a(40));return!!e._reactRootContainer&&(dl(function(){Kl(null,null,e,!1,function(){e._reactRootContainer=null,e[Kr]=null})}),!0)},t.unstable_batchedUpdates=hl,t.unstable_createPortal=function(e,t){return ql(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Yl(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Kl(e,t,n,!1,r)},t.version="17.0.1"},function(e,t,n){"use strict";e.exports=n(49)},function(e,t,n){"use strict";var r,i,o,a;if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var c=null,h=null,d=function e(){if(null!==c)try{var n=t.unstable_now();c(!0,n),c=null}catch(r){throw setTimeout(e,0),r}};r=function(e){null!==c?setTimeout(r,0,e):(c=e,setTimeout(d,0))},i=function(e,t){h=setTimeout(e,t)},o=function(){clearTimeout(h)},t.unstable_shouldYield=function(){return!1},a=t.unstable_forceFrameRate=function(){}}else{var f=window.setTimeout,p=window.clearTimeout;if("undefined"!==typeof console){var m=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var g=!1,_=null,v=-1,y=5,b=0;t.unstable_shouldYield=function(){return t.unstable_now()>=b},a=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):y=0<e?Math.floor(1e3/e):5};var E=new MessageChannel,x=E.port2;E.port1.onmessage=function(){if(null!==_){var e=t.unstable_now();b=e+y;try{_(!0,e)?x.postMessage(null):(g=!1,_=null)}catch(n){throw x.postMessage(null),n}}else g=!1},r=function(e){_=e,g||(g=!0,x.postMessage(null))},i=function(e,n){v=f(function(){e(t.unstable_now())},n)},o=function(){p(v),v=-1}}function T(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<P(i,t)))break e;e[r]=t,e[n]=i,n=r}}function S(e){return void 0===(e=e[0])?null:e}function A(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var o=2*(r+1)-1,a=e[o],s=o+1,l=e[s];if(void 0!==a&&0>P(a,n))void 0!==l&&0>P(l,a)?(e[r]=l,e[s]=n,r=s):(e[r]=a,e[o]=n,r=o);else{if(!(void 0!==l&&0>P(l,n)))break e;e[r]=l,e[s]=n,r=s}}}return t}return null}function P(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var M=[],R=[],C=1,w=null,O=3,I=!1,D=!1,L=!1;function F(e){for(var t=S(R);null!==t;){if(null===t.callback)A(R);else{if(!(t.startTime<=e))break;A(R),t.sortIndex=t.expirationTime,T(M,t)}t=S(R)}}function N(e){if(L=!1,F(e),!D)if(null!==S(M))D=!0,r(B);else{var t=S(R);null!==t&&i(N,t.startTime-e)}}function B(e,n){D=!1,L&&(L=!1,o()),I=!0;var r=O;try{for(F(n),w=S(M);null!==w&&(!(w.expirationTime>n)||e&&!t.unstable_shouldYield());){var a=w.callback;if("function"===typeof a){w.callback=null,O=w.priorityLevel;var s=a(w.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?w.callback=s:w===S(M)&&A(M),F(n)}else A(M);w=S(M)}if(null!==w)var l=!0;else{var u=S(R);null!==u&&i(N,u.startTime-n),l=!1}return l}finally{w=null,O=r,I=!1}}var U=a;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){D||I||(D=!0,r(B))},t.unstable_getCurrentPriorityLevel=function(){return O},t.unstable_getFirstCallbackNode=function(){return S(M)},t.unstable_next=function(e){switch(O){case 1:case 2:case 3:var t=3;break;default:t=O}var n=O;O=t;try{return e()}finally{O=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=U,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=O;O=e;try{return t()}finally{O=n}},t.unstable_scheduleCallback=function(e,n,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:C++,callback:n,priorityLevel:e,startTime:a,expirationTime:l=a+l,sortIndex:-1},a>s?(e.sortIndex=a,T(R,e),null===S(M)&&e===S(R)&&(L?o():L=!0,i(N,a-s))):(e.sortIndex=l,T(M,e),D||I||(D=!0,r(B))),e},t.unstable_wrapCallback=function(e){var t=O;return function(){var n=O;O=t;try{return e.apply(this,arguments)}finally{O=n}}}},,function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(O){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),a=new R(r||[]);return o._invoke=function(e,t,n){var r=h;return function(i,o){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return w()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=A(a,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var l=c(e,t,n);if("normal"===l.type){if(r=n.done?p:d,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}(e,n,a),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(O){return{type:"throw",arg:O}}}e.wrap=u;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",m={};function g(){}function _(){}function v(){}var y={};y[o]=function(){return this};var b=Object.getPrototypeOf,E=b&&b(b(C([])));E&&E!==n&&r.call(E,o)&&(y=E);var x=v.prototype=g.prototype=Object.create(y);function T(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function S(e,t){var n;this._invoke=function(i,o){function a(){return new t(function(n,a){!function n(i,o,a,s){var l=c(e[i],e,o);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"===typeof h&&r.call(h,"__await")?t.resolve(h.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(h).then(function(e){u.value=e,a(u)},function(e){return n("throw",e,a,s)})}s(l.arg)}(i,o,n,a)})}return n=n?n.then(a,a):a()}}function A(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=c(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function C(e){if(e){var n=e[o];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:w}}function w(){return{value:t,done:!0}}return _.prototype=x.constructor=v,v.constructor=_,_.displayName=l(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,s,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},T(S.prototype),S.prototype[a]=function(){return this},e.AsyncIterator=S,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new S(u(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(x),l(x,s,"Generator"),x[o]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:C(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},,function(e,t,n){"use strict";var r=n(54);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,o,a){if(a!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"===typeof Symbol&&Symbol.for,i=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,l=r?Symbol.for("react.profiler"):60114,u=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,h=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,f=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116;function _(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case h:case d:case a:case l:case s:case p:return e;default:switch(e=e&&e.$$typeof){case c:case f:case u:return e;default:return t}}case g:case m:case o:return t}}}function v(e){return _(e)===d}t.typeOf=_,t.AsyncMode=h,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=u,t.Element=i,t.ForwardRef=f,t.Fragment=a,t.Lazy=g,t.Memo=m,t.Portal=o,t.Profiler=l,t.StrictMode=s,t.Suspense=p,t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===a||e===d||e===l||e===s||e===p||"object"===typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===m||e.$$typeof===u||e.$$typeof===c||e.$$typeof===f)},t.isAsyncMode=function(e){return v(e)||_(e)===h},t.isConcurrentMode=v,t.isContextConsumer=function(e){return _(e)===c},t.isContextProvider=function(e){return _(e)===u},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return _(e)===f},t.isFragment=function(e){return _(e)===a},t.isLazy=function(e){return _(e)===g},t.isMemo=function(e){return _(e)===m},t.isPortal=function(e){return _(e)===o},t.isProfiler=function(e){return _(e)===l},t.isStrictMode=function(e){return _(e)===s},t.isSuspense=function(e){return _(e)===p}}]]);
//# sourceMappingURL=2.103f93c9.chunk.js.map